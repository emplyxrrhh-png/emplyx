@using Emplyx.Shared.Employees
@inject Microsoft.Extensions.Localization.IStringLocalizer<Emplyx.Blazor.Resources.SharedResources> L
@inject Emplyx.Blazor.Services.AppUiMessagingService Messaging

<EditForm Model="_model" OnValidSubmit="HandleValidSubmit" OnInvalidSubmit="HandleInvalidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />
    <div class="row g-3">
        <div class="col-12 col-md-6">
            <label class="form-label">@L["Employees.Form.Name"]</label>
            <InputText class="form-control" @bind-Value="_model.DisplayName" />
            <ValidationMessage For="() => _model.DisplayName" />
        </div>
        <div class="col-12 col-md-3">
            <label class="form-label">@L["Employees.Form.Language"]</label>
            <InputText class="form-control" @bind-Value="_model.Language" />
            <ValidationMessage For="() => _model.Language" />
        </div>
        <div class="col-12 col-md-3">
            <label class="form-label">@L["Employees.Form.Code"]</label>
            <InputText class="form-control" @bind-Value="_model.Code" />
            <ValidationMessage For="() => _model.Code" />
        </div>
        <div class="col-12">
            <div class="form-check">
                <InputCheckbox class="form-check-input" @bind-Value="_model.ForgottenRight" />
                <label class="form-check-label">@L["Employees.Form.ForgottenRight"]</label>
            </div>
        </div>
    </div>
    <div class="mt-3 d-flex gap-2">
        <button type="submit" class="btn btn-primary btn-sm"><i class="bi bi-save"></i> @L["Employees.Form.Save"]</button>
        <button type="button" class="btn btn-outline-secondary btn-sm" @onclick="Cancel"><i class="bi bi-x-circle"></i> @L["Employees.Form.Cancel"]</button>
    </div>
</EditForm>

@code {
    [Parameter] public EventCallback<EmployeeEditModel> OnSaved { get; set; }
    [Parameter] public EventCallback OnCancelled { get; set; }

    private EmployeeEditModel _model = new();

    private async Task HandleValidSubmit()
    {
        Messaging.ShowToast(new Emplyx.Shared.UI.Notifications.AppToastOptions(
            L["Employees.Form.Title"], L["Employees.Form.Toast.Saved"], Emplyx.Shared.UI.Notifications.UiNotificationLevel.Success));
        await OnSaved.InvokeAsync(_model);
        _model = new(); // reset
    }

    private Task HandleInvalidSubmit()
    {
        // Could add telemetry or toast
        return Task.CompletedTask;
    }

    private async Task Cancel()
    {
        Messaging.ShowToast(new Emplyx.Shared.UI.Notifications.AppToastOptions(
            L["Employees.Form.Title"], L["Employees.Form.Toast.Cancelled"], Emplyx.Shared.UI.Notifications.UiNotificationLevel.Info));
        await OnCancelled.InvokeAsync();
        _model = new();
    }
}
