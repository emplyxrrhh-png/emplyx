"use strict";define("Repos/RepoDropdown",["require","exports","VSS/Platform/Context","VSS/Platform/RestClientBase","VSS/Platform/Util/Serialization","VSS/Core/Observable","VSS/Platform/Feature","Favorites/Dropdown/ArtifactDropdownProvider","react","VSS/Core/Util/String","VSSUI/ListBox","Favorites/Dropdown/ArtifactDropdown","VSS/Platform/Layout","VSSUI/Dropdown","VSSUI/Observer","VSSUI/Utilities/DropdownSelection","VSS/Features/PlatformUI/ContributedMenu","VSS/Platform/FPS","VSS/Platform/Location","VSSUI/Util"],(function(e,t,o,i,r,s,a,n,c,d,p,l,h,u,g,m,v,f,y,S){var I,R,b,w,P;I=t[P="Resources"]={},t[P].ManageRepositories="Manage repositories",t[P].ImportRepository="Import repository",t[P].NewRepository="New repository",t[P].RepositoryDropdownAriaLabel="{0} Repository",t[P].SearchRepositoriesWatermark="Filter repositories",t[P].SelectRepositoryShortcut="Select repository",function(e){R=t[e]={};class s extends i.RestClientBase{constructor(e){super(e)}async getRepositories(e,t,o,i){const r={includeLinks:t,includeAllUrls:o,includeHidden:i};return this.beginRequest({apiVersion:"7.2-preview.2",routeTemplate:"{project}/_apis/git/Repositories/{repositoryId}",routeValues:{project:e},queryParams:r})}async getRepositoriesPaged(e,t,o,i,s,a,n){const c={includeLinks:t,includeAllUrls:o,includeHidden:i,filterContains:s,$top:a,continuationToken:n};return this.beginRequest({apiVersion:"7.2-preview.1",routeTemplate:"_apis/git/{projectId}/repositoriesPaged",routeValues:{projectId:e},queryParams:c,returnRawResponse:!0}).then((async e=>{const t=await e.text().then(r.deserializeVssJsonObject);return t.continuationToken=e.headers.get("x-ms-continuationtoken"),t}))}}t[e].GitClientName="Repos.RepoDropdown.Git.IGitRestClient",t[e].getGitClient=function(o,i){return o.getRestClient(t[e].GitClientName,i)},o.RestClients.add(t[e].GitClientName,{factory:s,options:{resourceAreaId:"4e080c62-fa21-4fbc-8fef-2a10a2b38049",serviceInstanceType:"00025394-6065-48ca-87d9-7f5672854ef7"}})}("RestClientGit"),function(){t.GitRepositoryService={};class e extends o.VssService{constructor(){super(...arguments),this.repositoriesByProject={},this.repositoriesByProjectPaged={},this.enabledRepositoriesByProject={},this.pageSize=100}_serviceStart(e){super._serviceStart(e),this.pageSize=(0,a.isFeatureFlagEnabled)(this.pageContext,"Repos.PagedRepositoriesPageSize",!1)?1e3:100}getAllRepositories(e){let t=this.repositoriesByProject[e||""];if(!t){t=new s.ReadyableObservableArray;(0,R.getGitClient)(this.pageContext).getRepositories(e).then((e=>{t.value=e,t.ready.value=!0})),this.repositoriesByProject[e||""]=t}return t}getEnabledRepositories(e){let t=this.enabledRepositoriesByProject[e||""];if(!t){t=new s.ReadyableObservableArray,this.enabledRepositoriesByProject[e||""]=t;const o=this.getAllRepositories(e);o.ready.value?(t.value=o.value.filter((e=>!e.isDisabled)),t.ready.value=!0):o.ready.subscribe((()=>{o.ready.value&&(t.value=o.value.filter((e=>!e.isDisabled)),t.ready.value=!0)}))}return t}getPagedRepositories(e){let t=this.repositoriesByProjectPaged[e||""];if(!t){const o=new s.ReadyableObservableArray;t={items:o};(0,R.getGitClient)(this.pageContext).getRepositoriesPaged(e||"",!1,!1,!1,void 0,this.pageSize).then((i=>{t.continuationToken=i.continuationToken,o.value=i,o.ready.value=!0,this.repositoriesByProjectPaged[e||""]=t}))}return t}getMoreRepositories(e,t){const o=this.repositoriesByProjectPaged[e||""];if(!o)return this.getPagedRepositories(e);if(!o.continuationToken||o.continuationToken!==t)return o;const i=new s.ReadyableObservableArray,r={items:i};return(0,R.getGitClient)(this.pageContext).getRepositoriesPaged(e||"",!1,!1,!1,void 0,this.pageSize,t).then((t=>{r.continuationToken=t.continuationToken,i.push(...t),i.ready.value=!0,this.cacheRefs(r,e)})),r}searchRepositories(e,t,o){const i=this.repositoriesByProjectPaged[e||""];if(i){const e=i;if(!e.continuationToken){const o=e.items.value.filter((e=>-1!==e.name.toLowerCase().indexOf((null==t?void 0:t.toLowerCase())||""))),i=new s.ReadyableObservableArray(o);return i.ready.value=!0,{items:i}}}const r=new s.ReadyableObservableArray,a={items:r};return(0,R.getGitClient)(this.pageContext).getRepositoriesPaged(e||"",!1,!1,!1,t,this.pageSize,o).then((e=>{a.continuationToken=e.continuationToken,r.value=e,r.ready.value=!0})),a}cacheRefs(e,t){if(this.repositoriesByProjectPaged[t||""]){const o=this.repositoriesByProjectPaged[t||""],i=new s.ReadyableObservableArray([...o.items.value,...e.items.value]);i.ready.value=!0,this.repositoriesByProjectPaged[t||""]={items:i,continuationToken:e.continuationToken}}else this.repositoriesByProjectPaged[t||""]=e}}o.Services.add("IGitRepositoryService",{serviceFactory:e})}(),function(e){b=t[e]={};const o="Microsoft.TeamFoundation.Git.Repository";class i extends n.ArtifactDropdownProviderBase{constructor(e,t){super(),this.setSearchLoading=(e,t)=>{if(t&&e){this.searching.value||(this.searching.value=!0),this.lastFilterText||this.continuationToken&&this.groupedProvider.setGroupLoading("all-repositories",!1);if(this.groupedProvider.value.some((e=>e.id===this.getGroupLoadingItemId("all-repositories"))))return;const t=1e3;this.debounceFunction((()=>{this.removeSearchLoadingItem();const t=this.getSearchLoadingItem(e,"");this.groupedProvider.push(t)}),t)}else this.searching.value&&(this.searching.value=!1),this.timeout&&clearTimeout(this.timeout),this.removeSearchLoadingItem(),this.lastFilterText&&this.continuationToken&&this.groupedProvider.setGroupLoading("all-repositories",!0,this.getLoadingItem("all-repositories"));this.lastFilterText=e},this.removeSearchLoadingItem=()=>{const e=this.groupedProvider.value.findIndex((e=>e.id===this.getSearchLoadingItemId()));e>-1&&this.groupedProvider.splice(e,1)},this.getDropdownItems=e=>{if(this.isPagingEnabled){if(!e){const e=new s.ReadyableObservableArray;return e.ready.value=!0,e}const t=this.pageContext.getService("IVssPerformanceService");if(t.startScenario("repo-dropdown-get-paged-repositories",!1),this.items=new s.ReadyableObservableArray,!this.favoritesLoaded)return this.groupedProvider.setGroupLoading(e,!1),this.items;let o;o=this.repositories?{items:new s.ReadyableObservableArray(this.repositories,!0),continuationToken:""}:this.getRepositories();const i=i=>{var s;this.continuationToken=o.continuationToken||"",this.groupedProvider.setGroupLoading(e,!1);const a=i.map(r);a.sort(((e,t)=>(0,d.localeIgnoreCaseComparer)(e.name,t.name))),this.supportsTfvc&&a.unshift({name:"$/"+this.projectName,isTfvc:!0,id:"tfvc",isFork:!1}),t.endScenario("Repos","repo-dropdown-get-paged-repositories",!1),null===(s=this.onRepositoriesLoaded)||void 0===s||s.call(this,i),this.items.value=a,this.items.ready.value=!0};if(o.items.ready.value)i(o.items.value);else{const e=e=>{e&&i(o.items.value)};this.addObserver(o.items.ready,e)}return this.items}if(!this.items){const e=this.pageContext.getService("IVssPerformanceService");let t;if(e.startScenario("repo-dropdown-get-all-repositories",!1),this.items=new s.ReadyableObservableArray,this.repositories)t=new s.ReadyableObservableArray(this.repositories,!0);else{const e=this.pageContext.getService("IGitRepositoryService");t=e.getAllRepositories(this.projectId)}const o=t=>{var o;const i=t.map(r);i.sort(((e,t)=>(0,d.localeIgnoreCaseComparer)(e.name,t.name))),this.supportsTfvc&&i.unshift({name:"$/"+this.projectName,isTfvc:!0,id:"tfvc",isFork:!1}),e.endScenario("Repos","repo-dropdown-get-all-repositories",!1),null===(o=this.onRepositoriesLoaded)||void 0===o||o.call(this,t),this.items.value=i,this.items.ready.value=!0};if(t.ready.value)o(t.value);else{const e=e=>{e&&o(t.value)};this.addObserver(t.ready,e)}}return this.items};const{getArtifactHref:i,onFavoritesLoaded:n,onRepositoriesLoaded:c,supportsTfvc:p,projectName:h,projectId:u,repositories:g,defaultGroupHeader:m,favoriteGroupHeader:v,showFavoritesEarly:f=!0,loading:y,searching:S}=t;if(this.pageContext=e,this.projectId=u,this.projectName=h,this.repositories=g,this.supportsTfvc=p,this.loading=y||new s.ObservableValue(!1),this.searching=S||new s.ObservableValue(!1),this.onRepositoriesLoaded=c,this.isPagingEnabled=(0,a.isFeatureFlagEnabled)(this.pageContext,"Repos.RepositoryDropdown.EnablePaging",!1),t.allowPaging||(this.isPagingEnabled=!1),this.isPagingEnabled){const{project:e}=this.pageContext.getService("ITfsPageService").getData()||{};e&&(this.projectId=this.projectId||e.id,this.projectName=this.projectName||e.name),2===(null==e?void 0:e.visibility)&&(this.isPagingEnabled=!1)}let I;I=this.projectName&&this.projectId?{artifactType:o,artifactScope:{id:this.projectId,name:this.projectName,type:"Project"}}:{artifactType:o,artifactScope:{id:"",name:"",type:"Collection"}};const R=this.createGroups(),b=new s.ReadyableObservableArray;b.ready.value=!0;var w;this.searchFunction=(e=>(t,o)=>this.isFullyLoaded()?{items:b}:e(t,o))((w=(e=>this.reuseIfStrictlyStronger(e,l))(((e,t)=>this.searchRepository(e,t))),(e,t)=>w(e&&e.trim(),t))),this.isPagingEnabled?(this.artifactPickerOptions={pageContext:e,favoritesContext:I,onFavoritesLoaded:()=>{n&&n(),this.groupedProvider.setGroupLoading("all-repositories",!0,this.getLoadingItem("all-repositories"))},onFavoriteLoadError:()=>{this.groupedProvider.setGroupLoading("all-repositories",!0,this.getLoadingItem("all-repositories"))},defaultGroupHeader:m,favoriteGroupHeader:v,getArtifacts:this.getDropdownItems,getArtifactHref:i,groups:R,getArtifactId:e=>e.id,getArtifactName:e=>e.name,getArtifactIcon:e=>({iconName:e.isTfvc?"TFVCLogo":e.isFork?"GitFork":"GitLogo",className:e.isTfvc?"repos-tfvc-icon":"repos-git-icon"}),getArtifactFromFavorite:f?e=>({name:e.artifactName,id:e.artifactId,isTfvc:!1,isFork:!1}):void 0,getFavoriteFromArtifact:e=>e.repository?{artifactId:e.repository.id,artifactName:e.repository.name,artifactScope:{id:e.repository.project.id,name:e.repository.project.name,type:"Project"},artifactType:o}:void 0,getArtifactListGroupId:()=>"all-repositories"},this.groupedProvider.pushGroups(R[2])):this.artifactPickerOptions={pageContext:e,favoritesContext:I,onFavoritesLoaded:n,defaultGroupHeader:m,favoriteGroupHeader:v,getArtifacts:this.getDropdownItems,getArtifactHref:i,getArtifactId:e=>e.id,getArtifactName:e=>e.name,getArtifactIcon:e=>({iconName:e.isTfvc?"TFVCLogo":e.isFork?"GitFork":"GitLogo",className:e.isTfvc?"repos-tfvc-icon":"repos-git-icon"}),getArtifactFromFavorite:f?e=>({name:e.artifactName,id:e.artifactId,isTfvc:!1,isFork:!1}):void 0,getFavoriteFromArtifact:e=>e.repository?{artifactId:e.repository.id,artifactName:e.repository.name,artifactScope:{id:e.repository.project.id,name:e.repository.project.name,type:"Project"},artifactType:o}:void 0},this.initialize(this.artifactPickerOptions)}getGroupsLoadingState(){return this.artifactPickerOptions&&this.artifactPickerOptions.groups?this.artifactPickerOptions.groups.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.id]:t.loading||this.continuationToken})),{}):{}}isFullyLoaded(){return!this.getGroupsLoadingState()["all-repositories"]}getSearchLoadingItem(e,t){return{id:this.getSearchLoadingItemId(),groupId:"all-repositories",type:4,render:(o,i,r,s)=>c.createElement(p.LoadingCell,{key:s.id,columnIndex:i,tableColumn:r,tableItem:s,onMount:()=>{const o=this.searchFunction(e,t),i=()=>{const t=this.processResolvedArtifacts(o.items.value),i=this.groupedProvider;i.push(...t);const r=i.value.findIndex((e=>e.id===this.getSearchLoadingItemId()));r>-1&&i.splice(r,1),o.continuationToken?i.push(this.getSearchLoadingItem(e,o.continuationToken)):this.searching.value=!1};if(o.items.ready.value)i();else{const e=e=>{e&&i()};this.addObserver(o.items.ready,e)}}})}}getSearchLoadingItemId(){return"repos-search-loading-item"}getGroupLoadingItemId(e){return e+"-loading-item"}createGroups(){return[{id:"default",name:void 0},{id:"favorites",name:"Favorites"},{id:"all-repositories",name:"Repositories",loading:!1,loadingItem:this.getLoadingItem("all-repositories")}]}async loadFavorites(){const e=this.pageContext.getService("IVssPerformanceService");e.startScenario("repo-dropdown-load-favorites",!1);const t=await super.loadFavorites();return t&&e.endScenario("Repos","repo-dropdown-load-favorites",!1),t}getRepositories(){return this.continuationToken?this.getGitRefService().getMoreRepositories(this.projectId,this.continuationToken):this.getGitRefService().getPagedRepositories(this.projectId)}getGitRefService(){return this.pageContext.getService("IGitRepositoryService")}getLoadingItem(e){return{id:this.getGroupLoadingItemId(e),groupId:e,type:4,render:(t,o,i,r)=>c.createElement(p.LoadingCell,{key:r.id,columnIndex:o,tableColumn:i,tableItem:r,onMount:()=>{this.loading.value||(this.loading.value=!0);const t=t=>{this.groupedProvider.push(...t),this.continuationToken&&!this.lastFilterText?this.groupedProvider.setGroupLoading(e,!0,this.getLoadingItem(e)):this.loading.value&&(this.loading.value=!1)},o=this.onGroupLoadRequest(e);if(o.ready.value)t(o.value);else{const e=e=>{e&&t(o.value)};this.addObserver(o.ready,e)}}})}}searchRepository(e,t){const o=this.pageContext.getService("IVssPerformanceService");o.startScenario("repos-dropdown-search-repos",!1),t||(t=this.continuationToken);const i=()=>{n.push(...a.items.value.map((e=>r(e)))),o.endScenario("Repos","repos-dropdown-search-repos",!1,void 0,{count:n.length,hasMore:Boolean(a.continuationToken)}),c.continuationToken=a.continuationToken,n.ready.value=!0},a=this.getGitRefService().searchRepositories(this.projectId,e,t),n=new s.ReadyableObservableArray,c={items:n,continuationToken:a.continuationToken};return a.items.ready.value?i():this.addObserver(a.items.ready,(e=>{e&&i()})),c}reuseIfStrictlyStronger(e,t){let o,i;return(r,s)=>{const a=()=>(o=r,i=e(r,s),i);if(this.isStrictlyStronger(r,o)){const e=e=>{e&&t(e)||a()};return i.items.ready.value?e(i):this.addObserver(i.items.ready,(t=>{t&&e(i)})),i}return a()}}isStrictlyStronger(e,t){return Boolean(e&&t&&e.toLowerCase().indexOf(t.toLowerCase())>=0)}debounceFunction(e,t,...o){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((()=>{this.timeout=void 0,e.apply(null,o)}),t)}}function r(e){return{name:e.name,id:e.id,repository:e,isFork:e.isFork,isTfvc:!1}}function l(e){return!e.continuationToken}t[e].RepositoryDropdownProvider=i}("RepositoryDropdownProvider"),function(e){w=t[e]={};class o extends h.VssComponent{constructor(e,t){var o,i;super(e,t),this.dropdown=c.createRef(),this.hasMadeInitialSelection=!1,this.getCalloutWidth=e=>e||null==e?480:void 0,this.onItemsUpdated=()=>(this.hasMadeInitialSelection||(this.props.selectedRepositoryItem?this.makeInitialSelection():this.props.selectedRepositoryItems&&this.makeInitialSelections()),!1),this.makeInitialSelection=()=>{if(this.itemProvider.value.length>0&&this.props.selectedRepositoryItem)for(let e=0;e<this.itemProvider.value.length;e++)if(this.itemProvider.value[e].data&&this.itemProvider.value[e].data.id===this.props.selectedRepositoryItem.id)return this.dropdownSelection.select(e),void(this.hasMadeInitialSelection=!0)},this.makeInitialSelections=()=>{if(this.itemProvider.value.length>0&&this.props.selectedRepositoryItems){for(let e=0;e<this.itemProvider.value.length;e++)this.itemProvider.value[e].data&&this.props.selectedRepositoryItems.some((t=>t.id===this.itemProvider.value[e].data.id))&&this.dropdownSelection.select(e,void 0,!0,!0);this.hasMadeInitialSelection=!0}},this.onFilterTextChanged=(e,t)=>{this.itemProvider.setSearchLoading(t,null!==e)},this.itemProvider=new b.RepositoryDropdownProvider(t.pageContext,Object.assign(Object.assign({},e.providerOptions),{onRepositoriesLoaded:e.onRepositoriesLoaded})),this.dropdownSelection=null!==(o=e.dropdownSelection)&&void 0!==o?o:new m.DropdownSelection,this.isPagingEnabled=(0,a.isFeatureFlagEnabled)(this.context.pageContext,"Repos.RepositoryDropdown.EnablePaging",!1),(null===(i=e.providerOptions)||void 0===i?void 0:i.projectId)||(this.isPagingEnabled=!1)}render(){const{actions:e,className:t,onSelect:o,useDefaultCalloutWidth:i,onCollapse:r,placeholder:s}=this.props,{getArtifactHref:a}=this.props.providerOptions,n="repository-selector-callout-sm";return c.createElement(g.Observer,{itemProvider:{observableValue:this.itemProvider,filter:this.onItemsUpdated},selection:this.dropdownSelection},(()=>{var p,m;let v=I.SelectRepositoryShortcut;(null===(p=this.dropdownSelection.value)||void 0===p?void 0:p.length)?v=(0,d.format)(I.RepositoryDropdownAriaLabel,null===(m=this.itemProvider.value[this.dropdownSelection.value[0].beginIndex])||void 0===m?void 0:m.text):this.props.selectedRepositoryItem?v=(0,d.format)(I.RepositoryDropdownAriaLabel,this.props.selectedRepositoryItem.name):s&&(v=s),this.props.getItemProvider&&this.props.getItemProvider(this.itemProvider.value);const f=this.props.selectedRepositoryItem?1:this.props.selectedRepositoryItems?this.props.selectedRepositoryItems.length:void 0;return this.isPagingEnabled?c.createElement(l.ArtifactDropdown,{ariaLabel:v,placeholder:s,ref:this.dropdown,onSelect:o,onCollapse:r,otherActions:e,items:this.itemProvider,getArtifactHref:a,selection:this.dropdownSelection,calloutContentClassName:(0,h.css)("repository-selector-callout",n),className:(0,h.css)(t,"repository-selector scroll-hidden"),width:this.getCalloutWidth(i),filterPlaceholderText:I.SearchRepositoriesWatermark,onFilterTextChanged:this.onFilterTextChanged,loading:this.props.providerOptions.loading,searching:this.props.providerOptions.searching,showItemsWhileSearching:!0,renderExpandable:e=>c.createElement(u.DropdownExpandableButton,Object.assign({},e,{subtle:!0,style:{width:"100%"}}),c.createElement(g.Observer,{selection:this.dropdownSelection},(()=>{var e;return 0===this.dropdownSelection.selectedCount&&(this.props.selectedRepositoryItem||this.props.selectedRepositoryItems)?(0,l.renderSelectedItem)(this.itemProvider.getListItem(null!==(e=this.props.selectedRepositoryItem)&&void 0!==e?e:this.props.selectedRepositoryItems[0]),f):null})))}):c.createElement(l.ArtifactDropdown,{ariaLabel:v,placeholder:s,ref:this.dropdown,onSelect:o,onCollapse:r,otherActions:e,items:this.itemProvider,getArtifactHref:a,selection:this.dropdownSelection,calloutContentClassName:(0,h.css)("repository-selector-callout",n),className:(0,h.css)(t,"repository-selector scroll-hidden"),width:this.getCalloutWidth(i),filterPlaceholderText:I.SearchRepositoriesWatermark,renderExpandable:e=>c.createElement(u.DropdownExpandableButton,Object.assign({},e,{subtle:!0,style:{width:"100%"}}),c.createElement(g.Observer,{selection:this.dropdownSelection},(()=>{var e;return 0===this.dropdownSelection.selectedCount&&(this.props.selectedRepositoryItem||this.props.selectedRepositoryItems)?(0,l.renderSelectedItem)(this.itemProvider.getListItem(null!==(e=this.props.selectedRepositoryItem)&&void 0!==e?e:this.props.selectedRepositoryItems[0]),f):null})))})}))}componentWillUnmount(){this.itemProvider.dispose()}expand(){this.dropdown.current&&this.dropdown.current.expand()}focus(){this.dropdown.current&&this.dropdown.current.focus()}}t[e].RepositoryDropdown=o}("ComponentsRepositoryDropdown"),function(){t.ComponentsRepositoryDropdownWithActions={};class e extends h.VssComponent{constructor(e,t){super(e,t),this.repositoryDropdown=c.createRef(),this.loading=new s.ObservableValue(!1),this.searching=new s.ObservableValue(!1),this.getDefaultActions=e=>{const t=[];if(this.canCreateRepositories&&(t.push({text:I.NewRepository,iconProps:{iconName:"Add"},onClick:this.onCreate,className:"repo-dropdown-action"}),t.push({text:I.ImportRepository,iconProps:{iconName:"Upload"},onClick:this.onImport,className:"repo-dropdown-action"})),this.canManageRepositories){const e=(0,y.routeUrl)(this.context.pageContext,"ms.vss-code-web.admin-version-control-route",{project:this.projectName});t.push({text:I.ManageRepositories,iconProps:{iconName:"Settings"},href:e,className:"repo-dropdown-action"})}return t},this.getContributedActions=e=>this.menuItemsToActions(e),this.getItemHref=e=>this.context.pageContext.getService("IReposRoutingService").getSwitchRepositoryURL(e.isTfvc?null:e.name,this.projectName),this.getSelectedRepositoryItem=()=>{if(this.vcData)return{id:this.vcData.defaultRepoId||"tfvc",name:this.vcData.defaultRepoIsGit?this.vcData.defaultGitRepoName:"$/"+this.projectName,isTfvc:!this.vcData.defaultRepoIsGit,isFork:this.vcData.defaultRepoIsFork}},this.menuItemToAction=e=>({text:e.text||"",iconProps:e.iconProps,onClick:t=>{e.onActivate&&e.onActivate(e,t)},href:e.href,className:"repo-dropdown-action"}),this.menuItemsToActions=e=>{const t=[];return e.forEach((e=>{t.push(this.menuItemToAction(e))})),t},this.onCreate=()=>{if(this.context.pageContext.getService("IStartRightExtensionService").navigateToCreateRepository(this.context.pageContext))return;this.context.pageContext.getService("IVssLayoutManager").renderCallout((e=>c.createElement(h.WrappedComponent,{dependencies:["ms.vss-code-web.import-dependencies"],wrappedProps:{onCreate:e=>{e.then((e=>{(0,f.FastPageSwitch)(this.context.pageContext,e.repository.webUrl,!0)}),S.noop)},onDismiss:e,projectId:this.projectId,projectName:this.projectName},wrappedType:"ms.vss-code-web.panel-create"})))},this.onImport=()=>{if(this.context.pageContext.getService("IStartRightExtensionService").navigateToImportRepository(this.context.pageContext))return;this.context.pageContext.getService("IVssLayoutManager").renderCallout((e=>c.createElement(h.WrappedComponent,{dependencies:["ms.vss-code-web.import-dependencies"],wrappedProps:{onDismiss:e,onImport:e=>{e.then((e=>{(0,f.FastPageSwitch)(this.context.pageContext,e.repository.webUrl,!0)}),S.noop)},projectId:this.projectId,projectName:this.projectName},wrappedType:"ms.vss-code-web.panel-import"})))};const o=t.pageContext.getService("IProjectRepositoryInformationService");this.vcData=o.getData();const i=t.pageContext.getService("ITfsPageService").getData();if(i&&i.project){this.projectName=i.project.name,this.projectId=i.project.id;const e=t.pageContext.getService("IReposPermissionsService");this.canCreateRepositories=e.hasPermission(256,void 0,void 0,this.projectId),this.canManageRepositories=e.hasPermission(1024,void 0,void 0,this.projectId)||e.hasPermission(512,void 0,void 0,this.projectId)||e.hasPermission(8192,void 0,void 0,this.projectId)}else this.projectName=void 0,this.projectId=void 0;this.repositoryContributedActions=(0,v.getMenuItems)(this.context.pageContext,"ms.vss-code-web.command-bar-repository-picker-actions")}render(){return this.vcData&&this.projectName&&this.projectId?c.createElement(g.Observer,{contributedActions:this.repositoryContributedActions},(e=>c.createElement(w.RepositoryDropdown,{ref:this.repositoryDropdown,actions:this.getActions(e.contributedActions),selectedRepositoryItem:this.getSelectedRepositoryItem(),providerOptions:{getArtifactHref:this.getItemHref,projectName:this.projectName,projectId:this.projectId,supportsTfvc:this.vcData&&this.vcData.supportsTfvc,loading:this.loading,searching:this.searching,allowPaging:!0}}))):null}componentDidMount(){if(super.componentDidMount(),this.props.registerKeyboardShortcuts){this.context.pageContext.getService("IVssKeyboardShortcutService").registerShortcut("Repos",{action:()=>{const e=this.repositoryDropdown.current;e&&(e.focus(),e.expand())},combos:["r"],description:I.SelectRepositoryShortcut})}}componentWillUnmount(){super.componentWillUnmount();this.context.pageContext.getService("IVssKeyboardShortcutService").unRegisterShortcut("Repos","r")}getActions(e){return[...this.getDefaultActions(e),...this.getContributedActions(e)]}}h.Components.add("ms.vss-code-web.repository-dropdown-actions",e),h.Components.add("ms.vss-code-web.repository-dropdown-menuitem",(function(){return c.createElement("tr",null,c.createElement("td",null),c.createElement("td",{colSpan:5},c.createElement("div",{className:"repository-dropdown-menuitem flex-row"},c.createElement(e,null))),c.createElement("td",null))}))}()}),["Resources","RestClient/Git","GitRepositoryService","RepositoryDropdownProvider","Components/RepositoryDropdown","Components/RepositoryDropdownWithActions"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-code-web.repo-dropdown"}}));