VTPortal.telecommutingSelector=function(n){function f(){var n=[];return n.push({ID:0,cssClass:"dx-icon-taTelecommuting_Office",cssClassText:"textActionPunch",Content:i18nextko.i18n.t("roOffice")}),n.push({ID:1,cssClass:"dx-icon-taTelecommuting_Home",cssClassText:"textActionPunch",Content:i18nextko.i18n.t("roHome")}),n.length>0?t(!0):t(!1),r(new DevExpress.data.DataSource({store:n})),n}function e(){u().viewShown();f();n.param=="0"?i(i18nextko.i18n.t("roTCWhere")):i(i18nextko.i18n.t("roTCWhereF"))}var t=ko.observable(!1),i=ko.observable(""),r=ko.observable(new DevExpress.data.DataSource({})),u=ko.observable(VTPortal.bigUserInfo());return{viewShown:e,title:i,subscribeBlock:u(),telecommutingSelectorDS:t,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),commScroll:{height:"70%",onPullDown:function(){f()}},listtelecommutingSelector:{dataSource:r,scrollingEnabled:!1,grouped:!1,itemTemplate:"actionItem",onItemClick:function(t){n.param=="0"?VTPortal.app.navigate("punches/"+t.itemData.ID):VTPortal.app.navigate("forgottenPunch/-1/"+moment(n.iDate).format("YYYY-MM-DD")+"/"+t.itemData.ID)}}}};VTPortal.punches=function(){function v(n){var t=[];switch(n){case 1:VTPortal.roApp.empPermissions().Punch.SchedulePunch&&VTPortal.roApp.userStatus().PunchesEnabled&&(t.push({ID:0,cssClass:"dx-icon-TA_in",cssClassText:"textActionPunch",Action:i18nextko.i18n.t("roPunches_TA_in")}),t.push({ID:1,cssClass:"dx-icon-TA_out",cssClassText:"textActionPunch",Action:i18nextko.i18n.t("roPunches_TA_out")}),t.push({ID:2,cssClass:"dx-icon-TA_in_cause",cssClassText:"textActionPunch",Action:i18nextko.i18n.t("roPunches_TA_in_cause")}),t.push({ID:3,cssClass:"dx-icon-TA_out_cause",cssClassText:"textActionPunch",Action:i18nextko.i18n.t("roPunches_TA_out_cause")}));break;case 2:VTPortal.roApp.empPermissions().Punch.ProductiVPunch&&VTPortal.roApp.userStatus().ProductiVEnabled&&(t.push({ID:4,cssClass:"dx-icon-Task_change",cssClassText:"textActionPunch",Action:i18nextko.i18n.t("roPunches_Task_change")}),VTPortal.roApp.userStatus().HasCompletePermission&&VTPortal.roApp.userStatus().TaskId>0&&t.push({ID:5,cssClass:"dx-icon-Task_complete",cssClassText:"textActionPunch",Action:i18nextko.i18n.t("roPunches_Task_complete")}),VTPortal.roApp.userStatus().TaskId>0&&t.push({ID:6,cssClass:"dx-icon-Task_alert",cssClassText:"textActionPunch",Action:i18nextko.i18n.t("roPunches_Task_alert")}));break;case 3:VTPortal.roApp.empPermissions().Punch.CostCenterPunch&&VTPortal.roApp.userStatus().PunchesEnabled&&VTPortal.roApp.userStatus().CostCenterEnabled&&t.push({ID:7,cssClass:"dx-icon-CostCenter",cssClassText:"textActionPunch",Action:i18nextko.i18n.t("roPunches_CostCenter")})}return t.length>0?(h(!0),w(t)):h(!1),t}function ut(t){var i,r;VTPortal.app.navigationManager._currentItem.uri=="punches"&&(typeof t.tag.ndefMessage[0]!="undefined"?VTPortal.roApp.nfcPunchInProgress()==!1&&(VTPortal.roApp.nfcPunchInProgress(!0),i=function(){cordova.platformId==="ios"&&nfc.invalidateSession();VTPortal.roApp.nfcEnabled(!1);VTPortal.roApp.nfcPunchInProgress(!1)},VTPortal.roApp.lastRequestFailed()||(r={idCause:-1,direction:"X",fast:!1,nfcTag:ndef.textHelper.decodePayload(t.tag.ndefMessage[0].payload),tcType:n.TcType()},n.CommitNFCPunch(r,i))):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roInvalidNFC"),"warning",2e3))}function d(){nfc.addNdefListener(ut,function(){VTPortal.roApp.nfcEnabled(!0)},function(){VTPortal.roApp.nfcEnabled(!1);VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorNFC"),"warning",2e3)})}function ft(){VTPortal.roApp.nfcEnabled(!1);VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorNFC"),"warning",2e3)}function et(){VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Communiques&&typeof nfc!="undefined"&&cordova.platformId==="ios"&&nfc.beginSession(d,ft)}function ot(){n.InitView(null);VTPortal.roApp.nfcPunchInProgress(!1);VTPortal.roApp.isModeApp()&&VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Communiques&&typeof nfc!="undefined"&&(cordova.platformId==="ios"||d());y().viewShown();n.ReloadMap();setTimeout(function(){$(".scrollview").each(function(){$(this).height($("#panelsContent").height()-75)})},200);f==-1&&(f=setInterval(function(){n.ReloadMap()},1e4))}var n=VTPortal.punchInfo(),u=ko.observable("presence"),g=ko.observable(0),h=ko.observable(!1),c=ko.observable([]),nt=ko.computed(function(){return VTPortal.roApp.currentLocationInfo().reliable}),tt=ko.computed(function(){return VTPortal.roApp.empPermissions().MustUseGPS}),f=-1,e=ko.observable(!1),l=VTPortal.taskFieldsInput(),p="",w=ko.observable([]),o=ko.observable(!1),a=ko.observable(""),b=ko.observable(""),t=ko.observable(!1),it=ko.observable(""),s=ko.observable(Math.floor(Math.random()*100001)),at=ko.observable(new DevExpress.data.DataSource({store:[],searchOperation:"contains",searchExpr:"Name"})),rt=ko.computed(function(){switch(u()){case"presence":return i18nextko.i18n.t("roATPuncheTitle");case"productiv":return i18nextko.i18n.t("roTPunchesTitle");case"costcenter":return i18nextko.i18n.t("roCCPunchesTitle")}},this),i,k,y;VTPortal.roApp.empPermissions().Punch.SchedulePunch&&VTPortal.roApp.userStatus().PunchesEnabled||VTPortal.roApp.empPermissions().Punch.ProductiVPunch&&VTPortal.roApp.userStatus().ProductiVEnabled||VTPortal.roApp.empPermissions().Punch.CostCenterPunch&&VTPortal.roApp.userStatus().PunchesEnabled&&VTPortal.roApp.userStatus().CostCenterEnabled?(i=[],VTPortal.roApp.empPermissions().Punch.SchedulePunch&&VTPortal.roApp.userStatus().PunchesEnabled&&i.push({ID:1,cssClass:"dx-icon-presence"}),VTPortal.roApp.empPermissions().Punch.ProductiVPunch&&VTPortal.roApp.userStatus().ProductiVEnabled&&i.push({ID:2,cssClass:"dx-icon-productiV"}),VTPortal.roApp.empPermissions().Punch.CostCenterPunch&&VTPortal.roApp.userStatus().PunchesEnabled&&VTPortal.roApp.userStatus().CostCenterEnabled&&i.push({ID:3,cssClass:"dx-icon-costCenter"}),c(i)):c([]);k=function(t){t.ID==1?u("presence"):t.ID==2?u("productiv"):t.ID==3&&u("costcenter");n.ReloadMap();setTimeout(function(){$(".scrollview").each(function(){$(this).height($("#panelsContent").height()-75)})},200)};y=ko.observable(VTPortal.bigUserInfo());var st=function(){clearInterval(f);f=-1},ht=function(n){var i=n.validationGroup.validate();i.isValid&&(t(!1),r("SelectListObject/tasks.availabletasks/TCO",VTPortalUtils.taskAction.complete))},r=function(n,t){p=n;VTPortal.roApp.taskPunchRequest({currentAction:-1,newAction:-1,currentTaskUserFieldsDefinition:null,currentTaskUserFieldsValue:["","","",-1,-1,-1],newTaskUserFieldsDefinition:null,newTaskUserFieldsValue:["","","",-1,-1,-1]});VTPortal.roApp.userStatus().TaskId>0?new WebServiceRobotics(function(i){var u,r,f;if(i.Status==window.VTPortalUtils.constants.OK.value){for(VTPortal.roApp.taskPunchRequest().currentAction=t,VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition=i.Fields,u=!1,r=0;r<i.Fields.length;r++)i.Fields[r].Used&&(u=!0);u?(l.initTaskProperties(!1),e(!0)):typeof VTPortal.roApp.userStatus().AvailableTasks!="undefined"&&VTPortal.roApp.userStatus().AvailableTasks>200?VTPortal.roApp.taskPunchRequest().currentAction==2?VTPortal.app.navigate("taskSelector/TCH"):VTPortal.app.navigate("taskSelector/TCO"):VTPortal.app.navigate(n)}else f=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingTaskInfo"),"error",0,f)}).getTaskUserFieldsAction(t,VTPortal.roApp.userStatus().TaskId):typeof VTPortal.roApp.userStatus().AvailableTasks!="undefined"&&VTPortal.roApp.userStatus().AvailableTasks>200?VTPortal.roApp.taskPunchRequest().currentAction==2?VTPortal.app.navigate("taskSelector/TCH"):VTPortal.app.navigate("taskSelector/TCO"):VTPortal.app.navigate(n)},ct=function(){e(!1);l.savePunchInfo();typeof VTPortal.roApp.userStatus().AvailableTasks!="undefined"&&VTPortal.roApp.userStatus().AvailableTasks>200?VTPortal.roApp.taskPunchRequest().currentAction==2?VTPortal.app.navigate("taskSelector/TCH"):VTPortal.app.navigate("taskSelector/TCO"):VTPortal.app.navigate(p)},lt=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtHome();else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}}).saveNewTaskAlert(VTPortal.roApp.userStatus().TaskId,b())};return{myPunchInfoBlock:n,title:rt,viewShown:ot,viewHidden:st,lblCaptcha:i18nextko.t("roCaptchaTitle"),lblCaptchaDescription:i18nextko.t("roCaptchaDescription"),lblCaptchaValue:s,subscribeBlock:y(),positionreliable:nt,mustUseGps:tt,tabPanelOptions:{height:"85%",dataSource:c,selectedIndex:g,animationEnabled:!1,swipeEnabled:!1,itemTitleTemplate:"title",onSelectionChanged:function(n){k(n.addedItems[0]);switch(n.addedItems[0].ID){case 1:v(1);break;case 2:v(2);break;case 3:v(3)}}},commScroll:{height:"70%"},listactions:{dataSource:w,scrollingEnabled:!1,grouped:!1,itemTemplate:"actionItem",onItemClick:function(i){if(i.itemData.ID==0||i.itemData.ID==1||i.itemData.ID==2||i.itemData.ID==3)n.CommitManualPunch(i.itemData.ID);else if(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.NewRequests)switch(i.itemData.ID){case 4:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):VTPortal.roApp.userStatus().PresenceStatus=="Inside"?VTPortal.roApp.userStatus().TaskId>0?r("SelectListObject/tasks.availabletasks/TCH",VTPortalUtils.taskAction.change):r("SelectListObject/tasks.availabletasks/TCH",VTPortalUtils.taskAction.begin):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoPresence"),"info",0);break;case 5:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"info",0):VTPortal.roApp.userStatus().PresenceStatus=="Inside"?VTPortal.roApp.userStatus().CanCompleteTask?(s(Math.floor(Math.random()*100001)),t(!0)):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoPresence"),"info",0):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoPresence"),"warning",0);break;case 6:a(i18nextko.i18n.t("roCurrentTaskAlert")+VTPortal.roApp.userStatus().TaskTitle);o(!0);break;case 7:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):VTPortal.roApp.userStatus().PresenceStatus=="Inside"?VTPortal.app.navigate("SelectListObject/costcenters/C"):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoPresence"),"info",0)}else switch(i.itemData.ID){case 4:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):VTPortal.roApp.userStatus().PresenceStatus=="Inside"?VTPortal.roApp.userStatus().TaskId>0?r("SelectListObject/tasks.availabletasks/TCH",VTPortalUtils.taskAction.change):r("SelectListObject/tasks.availabletasks/TCH",VTPortalUtils.taskAction.begin):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoPresence"),"info",0);break;case 5:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoPresence"),"info",0):VTPortal.roApp.userStatus().PresenceStatus=="Inside"?VTPortal.roApp.userStatus().CanCompleteTask?(s(Math.floor(Math.random()*100001)),t(!0)):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoPresence"),"info",0):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0);break;case 6:a(i18nextko.i18n.t("roCurrentTaskAlert")+VTPortal.roApp.userStatus().TaskTitle);o(!0);break;case 7:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):VTPortal.roApp.userStatus().PresenceStatus=="Inside"?VTPortal.app.navigate("SelectListObject/costcenters/C"):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoPresence"),"info",0)}}},progressPanel:{message:i18nextko.t("roNFCPunch"),showPane:!0,shading:!1,height:150,delay:200,shadingColor:"rgba(0,0,0,0)",indicatorSrc:"Images/loader_v4.gif",visible:VTPortal.roApp.showNfcPanel},captchaVisible:t,txtCaptcha:{placeholder:i18nextko.t("roCaptchaTitlePH"),value:it},actionDS:h,btnAcceptCptcha:{validationGroup:"validateCaptcha",text:i18nextko.t("roAcceptCaptcha"),onClick:ht},btnCancelCaptcha:{onClick:function(){t(!1)},text:i18nextko.t("roCancelCaptcha")},compareField:{validationGroup:"validateCaptcha",validationRules:[{type:"compare",comparisonType:"==",comparisonTarget:s,message:i18nextko.i18n.t("roCaptchaNotMatch")}]},taskFieldsVisible:e,taskFieldsBlock:l,btnCancelTaskFields:{onClick:function(){e(!1)},text:i18nextko.t("roCancelCaptcha")},btnAcceptUserFields:{onClick:function(){ct()},text:i18nextko.t("roContinue")},lblTaskAlert:i18nextko.t("roTaskAlert"),taskAlertVisible:o,lblSaveTaskAlertTitle:a,btnCancelTaskAlert:{onClick:function(){o(!1)},text:i18nextko.t("roCancel")},btnAcceptTaskAlert:{onClick:function(){lt()},text:i18nextko.t("roContinue")},txtTaskAlert:{value:b},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),btnNFCIos:{onClick:et,text:i18nextko.t("roPunchNFC"),visible:VTPortal.roApp.onIosDevice()&&VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Communiques}}};VTPortal.login=function(){function bi(n,t,i){return function(){VTPortal.roApp.isModeApp()&&VTPortal.roApp.serverURL.valid||!VTPortal.roApp.isModeApp()&&VTPortal.roApp.serverURL.valid&&VTPortal.roApp.serverURL.isMT?ct(n,t,i):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNotValidVisualTimeServer"),"error",0,function(){})}}function ct(n,t,i){if(VTPortal.roApp.serverURL.valid||ignoreValid)if(typeof VTPortal.roApp.db.settings.serverSSOConfig[VTPortal.roApp.serverURL.companyId]=="undefined"||VTPortal.roApp.db.settings.serverSSOConfig[VTPortal.roApp.serverURL.companyId]==null){if(VTPortal.roApp.serverURL.isMT)new WebServiceRobotics(function(r){r.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.db.settings.serverSSOConfig[VTPortal.roApp.serverURL.companyId]=r,lt(VTPortal.roApp.db.settings.serverSSOConfig[VTPortal.roApp.serverURL.companyId],n,t,i)):(VTPortal.roApp.db.settings.serverSSOConfig[VTPortal.roApp.serverURL.companyId]=null,VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNotValidVisualTimeServer"),"error",0,function(){}))},function(){},VTPortal.roApp.serverURL.url).getSsoConfiguration();else if(VTPortal.roApp.serverURL.valid){tt(t,i);return}}else lt(VTPortal.roApp.db.settings.serverSSOConfig[VTPortal.roApp.serverURL.companyId],n,t,i);else VTPortal.roApp.db.settings.serverSSOConfig[VTPortal.roApp.serverURL.companyId]=null,VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNotValidVisualTimeServer"),"error",0,function(){})}function lt(t,r,u,f){if(typeof t.ApiVersion!="undefined"?(localStorage.setItem("ApiVersion",t.ApiVersion),VTPortal.roApp.db.settings.ApiVersion=t.ApiVersion):VTPortal.roApp.db.settings.ApiVersion=0,typeof t.RefreshConfiguration!="undefined"&&t.RefreshConfiguration!=""&&(VTPortal.roApp.db.settings.refreshConfiguration=JSON.parse(t.RefreshConfiguration.decodeBase64()),VTPortal.roApp.db.settings.saveParameter("refreshConfig")),VTPortal.roApp.serverURL.isMT)VTPortal.roApp.db.settings.MT=!0,localStorage.setItem("IsMT",VTPortal.roApp.db.settings.MT);else if(VTPortal.roApp.serverURL.valid){tt(u,f);return}if(VTPortal.roApp.connectedToMT(!1),VTPortal.roApp.ssoVersion(t.SSOVersion),ft(!t.Result),t.Result&&(t.SSOmixedModeEnabled==undefined||!t.SSOmixedModeEnabled))if(t.SSOmixedModeEnabled!=undefined?e(!t.SSOmixedModeEnabled):e(!1),VTPortal.roApp.adfsLoginInprogress){if(VTPortal.roApp.db.settings.adfsCredential==""){localStorage.setItem("adfsLoginInprogress","false");VTPortal.roApp.adfsLoginInprogress=!1;VTPortal.roApp.db.settings.isUsingAdfs=!1;VTPortal.roApp.db.settings.adfsCredential="";VTPortal.roApp.db.settings.save();let n=Cookies.get("VTPortalAdfsUserName"),t="Usuario no reconocido";n!=null&&n!=""&&(t=n+" no existe en VisualTime",Cookies.remove("VTPortalAdfsUserName"));VTPortalUtils.utils.notifyMesage(t,"error",0,function(){})}}else VTPortal.roApp.automaticLogin?ht():(VTPortal.roApp.automaticLogin=!0,VTPortal.roApp.db.settings.isUsingAdfs=!1,VTPortal.roApp.db.settings.adfsCredential="",VTPortal.roApp.adfsEnabled(!1),c(!1),l(!1));else e(!1),typeof t.SSOServerEnabled!="undefined"&&t.SSOServerEnabled&&t.SSOUserLoggedIn?(VTPortal.roApp.ssoEnabled(!0),VTPortal.roApp.ssoUserName(t.SSOUserName),r||(i(VTPortal.roApp.ssoUserName()),n(VTPortal.roApp.ssoUserName().toLowerCase()))):(VTPortal.roApp.ssoEnabled(!1),VTPortal.roApp.ssoUserName("")),VTPortal.roApp.db.settings.isUsingAdfs=!1,VTPortal.roApp.db.settings.adfsCredential="",VTPortal.roApp.adfsEnabled(!1),c(!1),l(!1),VTPortal.roApp.automaticLogin&&r&&et(r)}function ki(n){setTimeout(function(){window.open(n,"_self")},5e3)}function it(n){if(typeof cordova!="undefined"&&typeof cordova.InAppBrowser!="undefined")y=0,t=cordova.InAppBrowser.open(n,"_blank","usewkwebview=yes,fullscreen=yes,hidespinner=yes,hidden=yes,location=no,hideurlbar=yes,hidenavigationbuttons=yes,toolbar=no,clearcache=no,clearsessioncache=no"),t.addEventListener("loadstop",function(){di(!0)});else ki(n)}var t=null,a=-1,i=VTPortal.roApp.userName,n=ko.observable(""),s=VTPortal.roApp.mtServer,r=ko.observable(""),rt=VTPortal.roApp.configSSL,u=ko.observable(window.VTPortal.roApp.getLanguageByID(VTPortal.roApp.db.settings.language)),yt=ko.observable(!1),pt=ko.observable(""),wt=ko.observable("error"),v=ko.observable("password"),bt=ko.observable(i18nextko.i18n.t("user")),kt=ko.observable(i18nextko.i18n.t("configuration")),b=ko.observable(i18nextko.i18n.t("clientLocation")),dt=ko.observable(i18nextko.i18n.t("username")),gt=ko.observable(i18nextko.i18n.t("pwd")),ni=ko.observable(i18nextko.i18n.t("password")),ti=ko.observable(i18nextko.i18n.t("lng")),ii=ko.observable(i18nextko.i18n.t("sendMsg")),ri=ko.observable(i18nextko.i18n.t("sendSSOLogin")),ui=ko.observable(i18nextko.i18n.t("recoverPwd")),fi=ko.observable(i18nextko.i18n.t("roRecoverTitle")),ei=ko.observable(i18nextko.i18n.t("roRecoverUserName")),oi=ko.observable(i18nextko.i18n.t("roRecoverEmail")),si=ko.observable(i18nextko.i18n.t("roRecoverFullInfo")),hi=ko.observable(i18nextko.i18n.t("roNextStep")),ut=ko.observable(!0),ft=ko.observable(!0),e=ko.observable(!0),y=0,h=ko.observable(""),k=ko.observable(""),c=ko.observable(!1),d=ko.observable(!1),l=ko.observable(!1),p=ko.observable(!1),g=ko.observable(""),w=ko.observable(""),ci=ko.computed(function(){return VTPortal.roApp.isModeApp()?"False":"True"}),o=ko.computed(function(){return VTPortal.roApp.isModeApp()?!0:!1}),nt=function(){VTPortal.roApp.automaticLogin=!0;f(!0)},li=function(){ht()},ai=function(){VTPortal.roApp.isTimeGate()||FirebasePlugin.grantPermission(function(n){n;console.log("Permission was "+(n?"granted":"denied"))})},et=function(){var f=DevExpress.validationEngine.getGroupConfig("validationCode").validate(),t,r;VTPortal.roApp.db.settings.isUsingAdfs&&VTPortal.roApp.db.settings.adfsCredential==""?(VTPortal.roApp.wsRequestCounter(0),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roLoginFromWeb"),"info",0)):(f.isValid||VTPortal.roApp.db.settings.isUsingAdfs&&VTPortal.roApp.db.settings.adfsCredential!="")&&(VTPortal.roApp.db.settings.wsURL=VTPortal.roApp.serverURL.defURL,VTPortal.roApp.db.settings.isSSL=VTPortal.roApp.serverURL.defSSL,VTPortal.roApp.db.settings.login=i().trim(),VTPortal.roApp.db.settings.language=u().ID,VTPortal.roApp.db.settings.companyID=VTPortal.roApp.serverURL.companyId,VTPortal.roApp.mtServer(VTPortal.roApp.serverURL.companyId),VTPortal.roApp.db.settings.MT=localStorage.getItem("IsMT")=="true"?!0:!1,VTPortal.roApp.db.settings.isUsingAdfs||VTPortal.roApp.db.settings.adfsCredential!=""?(VTPortal.roApp.automaticLogin=!1,VTPortal.roApp.db.settings.isUsingAdfs&&VTPortal.roApp.db.settings.adfsCredential!=""&&(t=VTPortal.roApp.db.settings.adfsCredential.decodeBase64().split("#"),VTPortal.roApp.guidToken=t[0],VTPortal.roApp.securityToken=t[1],t.length>2&&(VTPortal.roApp.companyID=t[2]),VTPortal.roApp.setLanguage(u().tag),r=function(){new WebServiceRobotics(function(t){var i=function(){VTPortal.roApp.automaticLogin=!0;VTPortal.roApp.db.settings.rememberLogin=!0;VTPortal.roApp.isModeApp()?VTPortal.roApp.db.settings.rememberLoginApp=n().trim():VTPortal.roApp.db.settings.password="";VTPortal.roApp.setLanguage(u().tag);VTPortal.roApp.redirectAtHome()};window.VTPortalUtils.utils.onCheckUserSession(t,i,u().ID)},function(n){window.VTPortalUtils.utils.onLoginErrorFunc(n)},VTPortal.roApp.serverURL.url).getLoggedInUserInfo()},VTPortal.roApp.db.settings.save(r))):new WebServiceRobotics(function(t){if(VTPortal.roApp.setLanguage(u().tag),VTPortal.roApp.isModeApp()?VTPortal.roApp.db.settings.rememberLoginApp=n().trim():VTPortal.roApp.db.settings.password="",n(""),VTPortal.roApp.isModeApp()&&!VTPortal.roApp.isTimeGate()&&t.ApiVersion>=VTPortalUtils.apiVersion.Firebase)try{FirebasePlugin.hasPermission(function(n){n||ai()})}catch(i){}VTPortalUtils.utils.onLoginCommitFunc(t,!0)},function(){},VTPortal.roApp.serverURL.url).login(i().trim(),n().trim(),u().ID,VTPortal.roApp.infoVersion,"",!0))},ot=function(){var n=DevExpress.validationEngine.getGroupConfig("requestRecover").validate();n.isValid&&VTPortal.roApp.serverURL.valid&&new WebServiceRobotics(function(n){n.Status==window.VTPortalUtils.constants.OK.value?(p(!1),d(!0),$("#txtRequestKey :input").focus()):VTPortalUtils.utils.processErrorMessage(n,function(){})},function(){},VTPortal.roApp.serverURL.url).recoverPassword(h().trim(),k().trim())},st=function(){var t=DevExpress.validationEngine.getGroupConfig("setRecoveredPwd").validate();t.isValid&&new WebServiceRobotics(function(t){t.Status==window.VTPortalUtils.constants.OK.value?(p(!1),d(!1),i(h()),n(w()),g(""),w(""),h(""),k(""),nt()):VTPortalUtils.utils.processErrorMessage(t,function(){})},function(){},VTPortal.roApp.serverURL.url).resetPasswordToNew(h().trim(),g().trim(),w().trim())},vi=function(){c(!0);$("#txtServerLocation :input").focus()},yi=function(){l(!0);$("#txtClientLocation :input").focus()},pi=function(){f(!1)},wi=function(){VTPortal.roApp.companyID=s();f(!1)},ht=function(){localStorage.setItem("adfsLoginInprogress","true");VTPortal.roApp.adfsLoginInprogress=!0;VTPortal.roApp.db.settings.isUsingAdfs=!0;VTPortal.roApp.adfsEnabled(!0);c(!1);l(!1);VTPortal.roApp.wsRequestCounter(VTPortal.roApp.wsRequestCounter()+1);VTPortal.roApp.db.settings.MT==!0?VTPortal.roApp.ssoVersion()==2?it(VTPortal.roApp.serverURL.ssoURL+"/Auth/"+VTPortal.roApp.serverURL.companyId.split("-")[0]+"?source=VTPORTAL&isApp="+(o()?"1":"0")+"&referer="+VTPortal.roApp.serverURL.companyId.split("-")[0]+"&_="+(new Date).getMilliseconds()):it(VTPortal.roApp.serverURL.ssoURL+"/VTLogin/VTPortalLogin.aspx?isApp="+(o()?"1":"0")+"&referer="+VTPortal.roApp.serverURL.companyId.split("-")[0]+"&_="+(new Date).getMilliseconds()):it(VTPortal.roApp.serverURL.ssoURL+"/VTLogin/VTPortalLogin.aspx?isApp="+(o()?"1":"0")+"&referer="+VTPortal.roApp.serverURL.companyId.split("-")[0]+"&_="+(new Date).getMilliseconds())},tt=function(n,t){VTPortal.roApp.db.settings.MT=!1;VTPortal.roApp.db.settings.wsURL=n;VTPortal.roApp.db.settings.isSSL=t;localStorage.setItem("IsMT",VTPortal.roApp.db.settings.MT);VTPortal.roApp.db.settings.saveParameter("wsURL",function(){VTPortal.roApp.db.settings.saveParameter("ssl",function(){var n=window.location.href.substr(0,window.location.href.indexOf("index.html"));n=n.replace("2/","index.html");document.location.href=n})})},f=async function(n){var t=r().trim(),f=rt(),u="",i="";if(o()?(t=r().trim(),t=t.replace(".visualtime.net","").toLowerCase(),u=t,i=t.split(":")[0].split(".")[0],VTPortal.roApp.companyID=t.split(":")[0].split(".")[0],VTPortal.roApp.companyID=VTPortal.roApp.companyID.split("-")[0],VTPortal.roApp.companyID=VTPortal.roApp.companyID.toLowerCase(),VTPortal.roApp.db.settings.companyID=VTPortal.roApp.companyID,i==u&&(u="")):(VTPortal.roApp.companyID=s(),VTPortal.roApp.companyID=VTPortal.roApp.companyID.toLowerCase(),VTPortal.roApp.db.settings.companyID=VTPortal.roApp.companyID,i=VTPortal.roApp.db.settings.companyID),VTPortal.roApp.serverURL.valid&&VTPortal.roApp.serverURL.companyId==i)ct(n,t,f);else{VTPortal.roApp.wsRequestCounter(1);let r=new Robotics.Client.ValidateURL;if(VTPortal.roApp.serverURL=await r.getURLforClient(i,u,o()),!VTPortal.roApp.serverURL.isMT&&VTPortal.roApp.serverURL.valid){tt(i,f);return}VTPortal.roApp.wsRequestCounter(0);VTPortal.roApp.db.settings.wsURL="";VTPortal.roApp.db.settings.login="";VTPortal.roApp.db.settings.password="";VTPortal.roApp.db.settings.MT="";VTPortal.roApp.db.settings.isSSL=!1;VTPortal.roApp.db.settings.saveLogin=!1;VTPortal.roApp.db.settings.rememberLogin=!1;VTPortal.roApp.db.settings.rememberLoginApp="";VTPortal.roApp.db.settings.save(bi(n,t,f))}},at=function(r){var o=r[0],e=!1,u,s;try{o!=null&&o.toUpperCase()!="NULL"?(u=JSON.parse(o),typeof u!="undefined"&&u!=null?(e=u.close,y>15?(i(""),n(""),VTPortal.roApp.db.settings.adfsCredential="",t.close(),t=null,VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roUnkownADFSUser"),"error",0,function(){})):e&&u.username!=""&&u.token!=""?(localStorage.setItem("adfsLoginInprogress","false"),s=u.token.decodeBase64().split("#"),s[1]=="unknown"?(i(""),n(""),VTPortal.roApp.db.settings.adfsCredential="",t.close(),t=null,f(!1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roUnkownADFSUser"),"error",0,function(){})):(i(u.username),n("\\"+u.username),VTPortal.roApp.db.settings.adfsCredential=u.token,a!=-1&&clearInterval(a),t.close(),t=null,et(!0))):(i(""),n(""),VTPortal.roApp.db.settings.adfsCredential="",y=y+1)):e=!1):e=!1}catch(h){e=!1}a=setTimeout(function(){t!=null&&t.executeScript({code:"getLoggedInUserInfo()"},at)},1500)},di=function(n){VTPortal.roApp.wsRequestCounter()>0&&VTPortal.roApp.wsRequestCounter(0);n&&t!=null&&t.show();a=setTimeout(function(){t!=null&&t.executeScript({code:"getLoggedInUserInfo()"},at)},3e3)},gi=ko.computed(function(){if(r().trim=="")i18nextko.i18n.t("roRequieredServer");else return r().trim().replace("-vtportal.visualtime.net",".visualtime.net")}),vt=function(n){n.jQueryEvent.keyCode==13&&f(!0)},nr=function(n){n.jQueryEvent.keyCode==13&&nt(n)},tr=function(n){n.jQueryEvent.keyCode==13&&$("#accessPwd :input").focus()},ir=function(n){n.jQueryEvent.keyCode==13&&$("#txtRecoverEmail :input").focus()},rr=function(n){n.jQueryEvent.keyCode==13&&ot(n)},ur=function(){p(!0);$("#txtRecoverUserName :input").focus()},fr=function(n){n.jQueryEvent.keyCode==13&&$("#txtNewPassword :input").focus()},er=function(n){n.jQueryEvent.keyCode==13&&st(n)},or=function(){VTPortal.roApp.dataCatalogs.destroyDS();VTPortal.roApp.currentLanguageId()==""&&(typeof VTPortal.roApp.db.settings.language!="undefined"&&VTPortal.roApp.db.settings.language!=""?VTPortal.roApp.currentLanguageId(VTPortal.roApp.db.settings.language):VTPortal.roApp.currentLanguageId("ESP"));u(window.VTPortal.roApp.getLanguageByID(VTPortal.roApp.currentLanguageId()));VTPortal.roApp.connectedToMT(!1);$(".toggle-password").off("click");$(".toggle-password").click(function(){v()=="password"?v("text"):v("password")});r(VTPortal.roApp.configWS()==""?VTPortal.roApp.mtServer():VTPortal.roApp.configWS());r(r().replace("-vtportal.visualtime.net",".visualtime.net"));r(r().replace(".visualtime.net",""));try{navigator.splashscreen.hide()}catch(t){}VTPortal.roApp.wsRequestCounter(0);VTPortal.roApp.isModeApp()?r().trim()!=""&&f(!1):s().trim()!=""&&f(!1);window.document.URL.indexOf("localhost:8036")>=0&&f(!1);VTPortal.roApp.ssoUnkownError()?(VTPortal.roApp.ssoUnkownError(!1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roUnkownADFSUser"),"error",0,function(){})):VTPortal.roApp.automaticLogin==!1&&(n(""),VTPortal.roApp.ssoEnabled()==!0&&VTPortal.roApp.ssoUserName()!=""&&(i(VTPortal.roApp.ssoUserName()),n(VTPortal.roApp.ssoUserName().toLowerCase())))},sr=function(){VTPortal.roApp.setLanguage(u().tag)};return{viewShown:or,beforeViewSetup:sr,lblConfiguration:kt,lblClient:b,lblLanguage:ti,lblServerLocation:b,lblClientLocation:b,lblSecureConnection:i18nextko.t("isSSL"),lblUsername:bt,lblPassword:gt,isModeApp:o,isWebEnvironment:ci,txtUsername:{placeholder:dt,value:i,onKeyUp:tr,disabled:e},txtClient:{readOnly:!0,onFocusIn:yi,value:s},txtPwd:{placeholder:ni,value:n,mode:v,onKeyUp:nr,disabled:e},txtServer:{readOnly:!0,onFocusIn:vi,placeholder:gi,value:r},currentLanguage:u,dataSourceLanguages:{dataSource:VTPortal.roApp.availableLanguages,displayExpr:"Name",valueExpr:"ID",placeholder:i18nextko.t("language"),value:VTPortal.roApp.currentLanguageId,itemTemplate:"langItemTemplate",onItemClick:function(n){VTPortal.roApp.setLanguage(n.itemData.tag);VTPortal.roApp.currentLanguageId(n.itemData.ID);setTimeout(function(){VTPortal.app.navigate("loading/fromLogin",{root:!0})},500)}},btnLogin:{onClick:nt,text:ii,disabled:e},btnRedirectToSSO:{onClick:li,text:ri,disabled:ft,visible:ko.computed(function(){return!VTPortal.roApp.connectedToMT()})},btnAcceptConf:{onClick:pi,text:i18nextko.t("closeConfig")},btnAcceptMTConf:{onClick:wi,text:i18nextko.t("closeConfig")},btnRecover:{onClick:ur,text:ui,disabled:e},popupVisible:c,popupMTVisible:l,txtServerLocation:{value:r,placeholder:i18nextko.t("serverLocation"),onKeyUp:vt},txtClientLocation:{value:s,placeholder:i18nextko.t("serverLocation"),onKeyUp:vt},ckServerSecurity:{text:i18nextko.t("isSSL"),value:rt},toast:{message:pt,type:wt,displayTime:3e3,visible:yt},requiredField:{validationGroup:"validationCode",validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),recoverPwdPopupVisible:p,lblRecoverTitle:fi,lblRecoverUserName:ei,txtRecoverUserName:{placeholder:i18nextko.t("roRecoverUserNamePH"),value:h,onKeyUp:ir},lblRecoverEmail:oi,txtRecoverEmail:{placeholder:i18nextko.t("roRecoverEmailPH"),value:k,onKeyUp:rr},requieredRecoverEmail:{validationGroup:"requestRecover",validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]},requieredRecoverUserName:{validationGroup:"requestRecover",validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]},btnSendRecoverRequest:{validationGroup:"requestRecover",onClick:ot,text:hi},setPwdPopupVisible:d,lblSetPassword:i18nextko.t("roSetRecoveredPassword"),lblRequestKey:i18nextko.t("roRequestKey"),txtRequestKey:{placeholder:i18nextko.t("roRequestKeyPH"),value:g,onKeyUp:fr},commScroll:{height:"80%",bounceEnabled:!1},lblNewPassword:i18nextko.t("roNewPassword"),txtNewPassword:{placeholder:i18nextko.t("roNewPasswordPH"),mode:"password",value:w,onKeyUp:er},requieredRequestKey:{validationGroup:"setRecoveredPwd",validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]},requieredNewPassword:{validationGroup:"setRecoveredPwd",validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]},btnSetNewPassword:{validationGroup:"setRecoveredPwd",onClick:st,text:i18nextko.t("sendMsg")},lblRecoverFullInfo:si,ssoEnabled:VTPortal.roApp.ssoEnabled,ckUseSSOLogin:{value:ut,text:i18nextko.t("sendUsingSSOIdentity"),onValueChanged:function(){VTPortal.roApp.ssoEnabled()&&ut()?(i(VTPortal.roApp.ssoUserName()),n(VTPortal.roApp.ssoUserName().toLowerCase())):(i(""),n(""))}}}};VTPortal.TimeGate=function(){function f(){const n=window.navigator.userAgent;return VTPortal.roApp.isModeApp()&&/iPad|iPhone|iPod/.test(n)&&!window.MSStream}function rt(){const n=window.navigator.userAgent;return VTPortal.roApp.isModeApp()&&/Android/.test(n)&&!window.MSStream}function et(n){try{if(VTPortalUtils.utils.isOnView("TimeGate"))if(typeof n.tag.ndefMessage[0]!="undefined"){if(!VTPortal.roApp.nfcTimegateInProgress()){VTPortal.roApp.nfcTimegateInProgress(!0);let t=function(){f()&&nfc.invalidateSession();setTimeout(function(){VTPortal.roApp.nfcTimegateInProgress(!1)},3e3)},i=ndef.textHelper.decodePayload(n.tag.ndefMessage[0].payload);e(i);u("");r("");k(t)}}else e(""),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roInvalidNFC"),"warning",2e3)}catch(t){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorReadingNFC")+": "+t.message,"error",2e3)}}function b(){nfc.addNdefListener(et,function(){s(!0)},function(){s(!1);VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorNFC"),"warning",2e3)})}function ot(){VTPortal.roApp.nfcEnabled(!1);VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorNFC"),"warning",2e3)}function st(){typeof nfc!="undefined"&&f()&&nfc.beginSession(b,ot)}function c(){l=!0;VTPortal.roApp.db.settings.isTimeGate=!1;VTPortal.roApp.isTimeGate(!1);VTPortal.roApp.timeGateMode(null);VTPortal.roApp.db.settings.save(function(){VTPortal.app.navigate("login",{root:!0})})}function k(i){clearTimeout(VTPortal.roApp.timeGateTimmerId);VTPortal.roApp.timeGateTimmerId=-1;clearTimeout(VTPortal.roApp.timeGateTimmerResponse);VTPortal.roApp.timeGateTimmerResponse=-1;new WebServiceRobotics(function(n){if(VTPortal.roApp.timeGateMode(n.TimeGateMode),n.Status==0&&n.TimeGateMode==VTPortal.roApp.timeGateModeEIP&&n.LoginInfo.Status==0){if(VTPortal.roApp.wsRequestCounter()==1&&(VTPortal.roApp.lastRequestFailed(!1),VTPortal.roApp.offlineCounter(0),VTPortal.roApp.isOnline(!0)),VTPortal.roApp.lastTimegateAction=moment(),VTPortal.roApp.timegateLoggedIn=!0,VTPortal.roApp.timegateLanguage()!=n.LoginInfo.DefaultLanguage)VTPortal.roApp.currentLanguageId(n.LoginInfo.DefaultLanguage),VTPortal.roApp.setLanguage(VTPortal.roApp.getLanguageByID(n.LoginInfo.DefaultLanguage).tag),setTimeout(function(){VTPortal.roApp.isTimeGate()&&VTPortal.roApp.checkAutomaticLogout();VTPortalUtils.utils.onLoginCommitFunc(n.LoginInfo,!0)},500);else{VTPortal.roApp.isTimeGate()&&VTPortal.roApp.checkAutomaticLogout();VTPortalUtils.utils.onLoginCommitFunc(n.LoginInfo,!0)}$(".top-section").hide()}else if(n.Status==0&&n.TimeGateMode==VTPortal.roApp.timeGateModeTA){let i=moment.tz(n.PunchInfo.Display.DateTimeValue,VTPortal.roApp.serverTimeZone).format("LTS")+"<\/br>"+n.PunchInfo.Display.UserInfo+"<\/br>"+n.PunchInfo.Display.StringValue;n.PunchInfo.Punch.ActualType===1?$("#response").addClass("inPunch").removeClass("outPunch error").html(i):n.PunchInfo.Punch.ActualType===2&&$("#response").addClass("outPunch").removeClass("inPunch error").html(i);$("#response").show();t()}else if(n.Status==0&&n.TimeGateMode==VTPortal.roApp.timeGateModeCO){let r=n.PunchInfo.Display.StringValue,i=n.PunchInfo.EmployeeStatus.CostsStatus.AvailableCostCenters,u=i&&i.length>0?i[0].Name:"",f=r+" <strong>"+u+"<\/strong>";$("#response").addClass("coPunch").removeClass("inPunch outPunch error").html(f);$("#response").show();t()}else{let i=i18nextko.i18n.t("notRecognized");n?.TimeGateMode==VTPortal.roApp.timeGateModeEIP&&n?.LoginInfo?.Status==-73&&(i=i18nextko.i18n.t("permissionDenied"));n?.TimeGateMode==VTPortal.roApp.timeGateModeCO&&n?.Status==-15&&(i=i18nextko.i18n.t("roshouldbeinforthisaction"));$("#response").addClass("error").removeClass("inPunch outPunch").html(i);$("#response").show();t()}$("#form-container").hide();$("#nfc-container").hide();const r=f()?6e3:3e3;VTPortal.roApp.timeGateTimmerResponse=setTimeout(nt,r);document.getElementById("timeGate").addEventListener("click",d);typeof i=="function"&&i()},function(){typeof i=="function"&&i();VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("serverLostConnexion"),"error",2e3);n(-4);VTPortal.roApp.isTimeGate()&&(VTPortal.roApp.timeGateTimmerId=setTimeout(t,1e4))}).identify(r(),u(),e())}function d(){nt()}function ht(){const n=String(r()).trim(),t=String(u()).trim();n!=""&&t!=""&&(o()||n!="0")?(r(n),u(t),k()):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("invalidCredentials"),"error",2500)}function g(n){var t=JSON.parse(n);y(ct(t.LeftColor,t.RightColor));p(lt(t.Image,t.Position,t.Opacity))}function ct(n,t){return(n==null||n=="")&&(n="#0046FE"),(t==null||t=="")&&(t="#286EFF"),"background: linear-gradient(to right, "+n+", "+t+");background-size: contain !important; height: 100%;"}function lt(n,t,i){var u=i/10,r;return n=="",r=n,"background: url("+r+") no-repeat top left; background-size: cover !important;height:100%;width:100%;opacity:"+u+""}function nt(){clearTimeout(VTPortal.roApp.timeGateTimmerResponse);e("");r("");u("");$("#response").hide();$("#form-container").show();f()&&$("#nfc-container").show();document.getElementById("form")!=null&&document.getElementById("form").reset();$("#form #accessPwd input").focus();$("#form #accessId input").focus();document.getElementById("timeGate").removeEventListener("click",d)}const n=ko.observable(null),tt=ko.computed(function(){return n()==0||n()==null});let l=!1,i=0,s=ko.observable(!1),h=ko.observable(!1);const r=ko.observable(""),u=ko.observable(""),e=ko.observable(""),a=ko.observable(moment().format("HH:mm")),v=ko.observable(moment().format("dddd D MMM").replace(".","")),o=ko.observable(!1);var y=ko.observable(""),p=ko.observable("");const it=ko.computed(function(){let n={placeholder:i18nextko.i18n.t("idPlaceHolder"),value:r,inputAttr:{autocomplete:"newID"}};return o()||(n.pattern="[0-9]*",n.inputAttr.inputmode="numeric"),n});let w=async function(){if(!VTPortal.roApp.serverURL.valid){let n=new Robotics.Client.ValidateURL;VTPortal.roApp.serverURL=await n.getURLforClient(VTPortal.roApp.db.settings.companyID,VTPortal.roApp.db.settings.wsURL,VTPortal.roApp.isModeApp())}if(VTPortal.roApp.serverURL.valid){let n=window.VTPortal.roApp.getServerUrl(VTPortal.roApp.serverURL.url).toLowerCase();setTimeout(function(){VTPortalUtils.utils.logoutTimegate();VTPortal.roApp.timeGateTimmerId==-1&&t();VTPortal.roApp.nfcTimegateInProgress(!1);VTPortal.roApp.isModeApp()&&typeof nfc!="undefined"&&(f()?$("#nfc-container").show():b())},200)}else n(-4),setTimeout(function(){w()},6e4)},t=function(){VTPortal.roApp.timeGateTimmerId=-1;new WebServiceRobotics(function(r){if(typeof r.Status!="undefined"&&(r.Status==0||r.Status==-3)){h(!1);i=0;n(r.Status);let u=!1;if(r.Status==0){VTPortal.roApp.timeGateConfig=r.Value;VTPortal.roApp.timeGateConfig.BackgroundMD5!=null&&VTPortal.roApp.timeGateConfig.BackgroundMD5!=""&&(VTPortal.roApp.timeGateConfig.BackgroundMD5!=VTPortal.roApp.db.settings.BackgroundMD5?(VTPortal.roApp.db.settings.BackgroundMD5=VTPortal.roApp.timeGateConfig.BackgroundMD5,VTPortal.roApp.db.settings.save(function(){}),ut()):g(VTPortal.roApp.db.settings.timeGateBackground));o(VTPortal.roApp.timeGateConfig.IDmode==0);let n=VTPortal.roApp.db.settings.screenTimeout!=VTPortal.roApp.timeGateConfig.ScreenTimeout||VTPortal.roApp.db.settings.language!=VTPortal.roApp.timeGateConfig.Language;VTPortal.roApp.db.settings.language=VTPortal.roApp.timeGateConfig.Language;VTPortal.roApp.db.settings.screenTimeout=VTPortal.roApp.timeGateConfig.ScreenTimeout;VTPortal.roApp.timegateLanguage(VTPortal.roApp.timeGateConfig.Language);VTPortal.roApp.screenTimeout(VTPortal.roApp.db.settings.screenTimeout);n&&VTPortal.roApp.db.settings.save(function(){});u=!0}else r.Status==-3&&c();u&&(VTPortal.roApp.timeGateTimmerId=setTimeout(t,48e4))}else n(-4),i+=1,VTPortal.roApp.isTimeGate()&&(VTPortal.roApp.timeGateTimmerId=setTimeout(t,1e4))},function(){n(-4);i+=1;VTPortal.roApp.isTimeGate()&&(VTPortal.roApp.timeGateTimmerId=setTimeout(t,1e4))}).initializeTimeGate()},ut=function(){new WebServiceRobotics(function(r){typeof r.Status!="undefined"&&(r.Status==0||r.Status==-3)?(n(r.Status),r.Status==0?(VTPortal.roApp.timeGateBackground=r.Value,VTPortal.roApp.db.settings.timeGateBackground=VTPortal.roApp.timeGateBackground,VTPortal.roApp.db.settings.save(function(){}),g(VTPortal.roApp.db.settings.timeGateBackground)):r.Status==-3&&c()):(n(-4),i+=1,VTPortal.roApp.isTimeGate()&&(VTPortal.roApp.timeGateTimmerId=setTimeout(t,1e4)))},function(){n(-4);i+=1;VTPortal.roApp.isTimeGate()&&(VTPortal.roApp.timeGateTimmerId=setTimeout(t,1e4))}).getTimeGateBackground()},ft=function(){(h(!1),i=0,VTPortal.roApp.clientTimeZone=moment.tz.guess(!0),l)||(setInterval(()=>{a(moment().format("HH:mm")),v(moment().format("dddd D MMM").replace(".",""))},1e3),w())};return{viewShown:ft,lblServerTime:a,lblServerDate:v,btnSend:{onClick:ht,text:i18nextko.i18n.t("sendMsg")},btnNFC:{onClick:st,text:i18nextko.i18n.t("activateNFC"),icon:"Images/Actions/nfc.png"},nfcAndroid:{onClick:()=>{},text:"",icon:"Images/Actions/nfc.png"},backButtonVT:{onClick:()=>{c()},text:"",icon:"Images/Actions/exit.png"},isAndroid:rt(),timegateNFCEnabled:s,showBackButton:h,status:n,conectado:tt,txtID:it,txtPIN:{placeholder:i18nextko.i18n.t("pinPlaceHolder"),value:u,inputAttr:{autocomplete:"newPIN",inputmode:"numeric"},pattern:"[0-9]*"},lblNotAvailable:i18nextko.i18n.t("notAvailable"),enableTextBox:o,customCssBackground:y,customPhotoBackground:p}};VTPortal.loading=function(n){function t(){typeof n.id!="undefined"&&n.id=="fromLogin"?setTimeout(function(){VTPortal.app.navigate("login",{root:!0})},500):setTimeout(function(){VTPortal.roApp.loadInitialData(!0,!0,!0,!0,!0,function(){VTPortal.roApp.db.settings.onlySupervisor?VTPortal.roApp.redirectAtHome(!1):VTPortal.roApp.redirectAtHome(!0)})},500)}return{viewShown:t,loadingPanel:{message:i18nextko.i18n.t("roApplyingLanguage"),showPane:!0,shading:!0,height:150,shadingColor:"rgba(0,0,0,0)",indicatorSrc:"Images/loader_v4.gif",visible:!0}}};VTPortal.home=function(n){var r=VTPortal.punchInfo(),ht=ko.observable(new Date),ct=VTPortal.summaryHome(),e=VTPortal.punchesHome(),b=VTPortal.emptyHome(),k=VTPortal.telecommutingHome(),d=VTPortal.webLinksHome(),g=ko.observable(VTPortal.bigUserInfo()),t=ko.observable(!1),nt=ko.observable(!1),lt=ko.observable(!1),y=ko.observable(!1),p=ko.observable(!1),o=ko.observable(!1),s=ko.observable(!1),h=ko.observable(!1),u=ko.observable(!1),c=ko.observable(!1),l=ko.observable(!1),w=ko.observable(""),f=ko.observable(""),tt=ko.observable(""),it=ko.observable(""),a=ko.observable(!1),at=ko.computed(function(){return VTPortal.roApp.db.settings.ApiVersion}),rt=ko.observable(""),vt=ko.computed(function(){return rt()}),yt=ko.computed(function(){if(VTPortal.roApp.userTelecommute()!=null&&typeof VTPortal.roApp.userTelecommute()!="undefined"){var n=VTPortal.roApp.userTelecommute().Telecommuting;return n!=null&&typeof n!="undefined"&&n?!0:!1}return!1}),ut=ko.computed(function(){return!VTPortal.roApp.licenseAccepted()&&VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.LicenseAgreement&&VTPortal.roApp.impersonatedIDEmployee==-1}),pt=ko.computed(function(){return VTPortal.roApp.AnywhereLicense==!0?"display:''":"display:'none'"}),wt=ko.computed(function(){return VTPortal.roApp.AnywhereLicense==!0?"display:''":"display:'none'"}),bt=ko.computed(function(){return VTPortal.roApp.licenseConsent()==null?i18nextko.i18n.t("roLicenseText"):VTPortal.roApp.licenseConsent().Message}),ft=ko.computed(function(){return VTPortal.roApp.lastRequestFailed()?i18nextko.i18n.t("roQuickPunchIn"):VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().PresenceStatus=="Inside"?i18nextko.i18n.t("roQuickPunchOut"):i18nextko.i18n.t("roQuickPunchIn"):i18nextko.i18n.t("roQuickPunchIn")}),kt=ko.computed(function(){return i18nextko.i18n.t("ropunchNotAllowed")}),dt=ko.computed(function(){return VTPortal.roApp.licenseConsent()==null?!1:!0}),gt=function(n){var t=n.validationGroup.validate();t.isValid&&new WebServiceRobotics(function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.loggedIn=!0,VTPortal.roApp.db.settings.rememberLogin=!0,VTPortal.roApp.isModeApp()?VTPortal.roApp.db.settings.rememberLoginApp=f().trim():VTPortal.roApp.db.settings.password="",VTPortal.roApp.db.settings.save(),w(""),f(""),tt(""),$("#scrollview").find(".pass").each(function(){$(this).dxValidator("instance").reset()}),y(!1),window.VTPortalUtils.utils.loginIfNecessary("",function(){VTPortal.roApp.db.settings.onlySupervisor?VTPortal.roApp.loadInitialData(!0,!0,!0,!0,!0,function(){VTPortal.roApp.redirectAtHome(!1)}):VTPortal.roApp.loadInitialData(!0,!0,!0,!0,!0,function(){VTPortal.roApp.redirectAtHome(!0)})})):(VTPortal.roApp.loggedIn=!1,VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t(window.VTPortalUtils.utils.languageTag(n.Status)),"error",0))}).changePassword(w(),f())},ni=function(){a()&&(VTPortal.roApp.licenseConsent()==null?new WebServiceRobotics(function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.db.settings.licenseAccepted=!0,VTPortal.roApp.db.settings.save(),VTPortal.roApp.licenseAccepted(!0)):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t(window.VTPortalUtils.utils.languageTag(n.Status)),"error",0)}).acceptMyLicense(a()):new WebServiceRobotics(function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.db.settings.licenseAccepted=!0,VTPortal.roApp.db.settings.save(),VTPortal.roApp.licenseAccepted(!0)):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t(window.VTPortalUtils.utils.languageTag(n.Status)),"error",0)}).acceptConsent(VTPortal.roApp.licenseConsent().Message))},i=function(){VTPortal.roApp.empPermissions()==null||VTPortal.roApp.userStatus()==null?(c(!1),l(!1)):(VTPortal.roApp.empPermissions().Punch.SchedulePunch&&VTPortal.roApp.userStatus().PunchesEnabled?c(!0):c(!1),VTPortal.roApp.empPermissions().Punch.SchedulePunch&&VTPortal.roApp.userStatus().PunchesEnabled||VTPortal.roApp.empPermissions().Punch.ProductiVPunch&&VTPortal.roApp.userStatus().ProductiVEnabled||VTPortal.roApp.empPermissions().Punch.CostCenterPunch&&VTPortal.roApp.userStatus().PunchesEnabled&&VTPortal.roApp.userStatus().CostCenterEnabled?l(!0):l(!1))},ti=function(n){var t=n.validationGroup.validate();t.isValid&&(p(!1),new WebServiceRobotics(function(n){n.Status==window.VTPortalUtils.constants.OK.value?VTPortal.roApp.db.settings.onlySupervisor?VTPortal.roApp.redirectAtHome(!1):VTPortal.roApp.redirectAtHome(!0):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t(window.VTPortalUtils.utils.languageTag(-65)),"error",0,function(){VTPortalUtils.utils.onLogoutErrorFunc(n)})}).validateSession(it()))},ii=ko.computed(function(){return i18nextko.i18n.t("roHomeTitle")}),ri=function(){l()==!0?VTPortal.app.navigate("punches"):h(!0)},ui=function(){VTPortal.app.navigate("requestsList/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15/"+moment(ht.Value).format("YYYY-MM-DD"))},fi=function(){VTPortal.app.navigate("myDailyRecord")},ei=function(){let n=function(){VTPortal.roApp.db.settings.onlySupervisor?VTPortal.roApp.redirectAtHome(!1):(window.VTPortalUtils.utils.setActiveTab("myTeam"),VTPortal.app.navigate("myteam",{root:!0}));setTimeout(function(){VTPortalUtils.utils.buildHamburgerMenu()},1e3)};VTPortal.roApp.impersonatedIDEmployee=-1;VTPortal.roApp.loadInitialData(!0,!0,!0,!1,!1,n)},v=function(){VTPortal.roApp.loggedIn&&(b.viewShown(),e.viewShown(),d.viewShown(),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Telecommuting&&VTPortal.roApp.userTelecommute()!=null&&VTPortal.roApp.userTelecommute().Telecommuting&&k.viewShown(),VTPortal.roApp.refreshEmployeeStatus(!0))},oi=function(){VTPortal.roApp.clientTimeZone=moment.tz.guess(!0);VTPortal.roApp.punchInProgress(!1);v();new WebServiceRobotics(function(){},function(){}).updateServerTimeZone(VTPortal.roApp.clientTimeZone)},et=function(){VTPortal.roApp.db.settings.resetFastPunchStatusObject();VTPortal.roApp.punchInProgress(!1);v();i()},si=function(){r.TcType(0);$.when(i()).then(r.CommitQuickPunch())},hi=function(n){VTPortal.roApp.isTimeGate()||new WebServiceRobotics(function(){}).registerFirebaseToken(n,VTPortal.roApp.db.settings.UUID)},ci=function(){VTPortal.roApp.isTimeGate()||FirebasePlugin.getToken(function(n){VTPortal.roApp.FirebaseToken=n;hi(n)})},ot=ko.computed(function(){return VTPortal.roApp.empPermissions()==null||VTPortal.roApp.userStatus()==null?!1:VTPortal.roApp.empPermissions().Punch.SchedulePunch&&VTPortal.roApp.userStatus().PunchesEnabled}),li=ko.computed(function(){return VTPortal.roApp.empPermissions()==null||VTPortal.roApp.userStatus()==null?!1:!ot()&&VTPortal.roApp.DailyRecordEnabled()}),ai=function(){var n=function(n){$("#btnActionMenuPopover2").removeClass("pressing");t(!1);c()==!0?(VTPortal.roApp.punchInProgress(!0),typeof n!="undefined"&&n()):h(!0)};if(r.InitView(n,nt),VTPortal.roApp.nfcEnabled(!1),VTPortal.roApp.nfcPunchInProgress(!1),setTimeout(function(){VTPortal.roApp.documentSent()==!0&&(VTPortal.roApp.documentSent(!1),VTPortal.roApp.refreshEmployeeStatus(!0));var n=0;$("#target").on("mousedown touchstart",function(){$("#btnActionMenuPopover2").addClass("pressing");t(!0);n=setTimeout(si,1500)}).on("mouseup mouseleave mouseout touchend",function(){$("#btnActionMenuPopover2").removeClass("pressing");t(!1);clearTimeout(n)});g().viewShown();v();i();ut&&a(!1);window.VTPortalUtils.utils.setActiveTab("home")},1e3),VTPortal.roApp.isModeApp()&&!VTPortal.roApp.isTimeGate()&&VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Firebase&&VTPortal.roApp.impersonatedIDEmployee==-1)try{ci()}catch(u){}VTPortal.roApp.showLegalText()=="1"&&localStorage.getItem("ShowLegalText.VTPortal")!="0"&&VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roENSShowLegalText"),"info",0,function(){localStorage.setItem("ShowLegalText.VTPortal","0")})};if(typeof n.id=="undefined")window.VTPortalUtils.utils.loginIfNecessary("",ai);else switch(parseInt(n.id,10)){case 1:y(!0);break;case 2:rt(i18nextko.i18n.t(window.VTPortalUtils.utils.languageTag(-63)));p(!0);break;case 3:VTPortal.roApp.impersonatedIDEmployee=-1;VTPortal.roApp.db.settings.onlySupervisor?VTPortal.roApp.redirectAtHome(!1):VTPortal.roApp.redirectAtHome(!0);VTPortal.roApp.loadInitialData(!0,!0,!0,!1,!1)}var vi=function(n,t){n=="S"?t&&(u(i18nextko.i18n.t("roQuickPunchOutDone")),o(!0),e.viewShown()):t&&(u(i18nextko.i18n.t("roQuickPunchInDone")),o(!0),e.viewShown())},yi=function(){o(!1)},pi=function(){$("#btnActionMenuPopover2").removeClass("pressing");t(!1);s(!1)},wi=function(){h(!1)},st={myPunchInfoBlock:r,commitPunchResponse:vi,title:ii,subscribeBlock:g(),summaryHome:ct,punchesHome:e,emptyHome:b,telecommutingHome:k,webLinksHome:d,popupChangePwdVisible:y,lblOldPwd:i18nextko.t("lblOldPwd"),lblNewPwd:i18nextko.t("lblNewPwd"),lblPunchDone:u,lblPunchNotAllowed:i18nextko.t("ropunchNotAllowed"),lblNewPwdRepeat:i18nextko.t("lblNewPwdRepeat"),doPunch:{onClick:function(){$.when(i()).then(ri())},visible:ko.computed(function(){return VTPortal.roApp.impersonatedIDEmployee==-1}),text:i18nextko.t("roPunchButton")},dxholdHandler:function(){$.when(i()).then(quickPunch())},quickPunchFailed:{onClick:function(){u(i18nextko.i18n.t("roHoldToPunch"));s(!1)},text:ft,visible:ko.computed(function(){return VTPortal.roApp.impersonatedIDEmployee==-1})},quickPunch:{onClick:function(){$("#btnActionMenuPopover2").removeClass("pressing");t(!1);r.OptionsVisible()==!1&&(u(i18nextko.i18n.t("roHoldToPunch")),s(!1))},text:ft,visible:ko.computed(function(){return ot()&&VTPortal.roApp.impersonatedIDEmployee==-1})},quickPunchCss:ko.computed(function(){return VTPortal.roApp.lastRequestFailed()?"quickPunchCssIn":VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().PresenceStatus=="Inside"?"quickPunchCssOut":"quickPunchCssIn":"quickPunchCssIn"}),dailyRecordPermission:li,dailyRecordBtn:{onClick:fi,text:i18nextko.t("lblDailyRecordButton")},goBack:{onClick:ei,text:i18nextko.t("lblGoBack"),visible:ko.computed(function(){return VTPortal.roApp.impersonatedIDEmployee!=-1})},punchNotAllowed:{text:kt},request:{onClick:ui,visible:ko.computed(function(){return VTPortal.roApp.impersonatedIDEmployee==-1}),text:i18nextko.t("roRequestButton")},txtOldPwd:{placeholder:i18nextko.t("roPH_oldPwd"),value:w,mode:"password"},txtNewPwd:{placeholder:i18nextko.t("roPH_newPwd"),value:f,mode:"password"},txtNewPwdRepeat:{placeholder:i18nextko.t("roPH_newPwdRepeat"),value:tt,mode:"password"},btnChangePwd:{validationGroup:"changePwd",onClick:gt,text:i18nextko.t("roChangePwd")},requieredOldField:{validationGroup:"changePwd",validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]},requieredNewField:{validationGroup:"changePwd",validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]},compareField:{validationGroup:"changePwd",validationRules:[{type:"compare",comparisonType:"==",comparisonTarget:f,message:i18nextko.i18n.t("roPasswordsNotMatch")}]},popupValidationCodeVisible:p,quickPunchDone:o,quickPunchFailed:s,punchNotAllowedVisible:h,lblValidationCode:vt,txtValidationCode:{placeholder:i18nextko.t("roPH_ValidationCode"),value:it,mode:"password"},requieredValidationField:{validationGroup:"validationCode",validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]},btnAcceptValidationCode:{validationGroup:"validationCode",onClick:ti,text:i18nextko.t("sendMsg")},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),progressPanel:{message:i18nextko.t("roKeepPushing"),showPane:!0,height:150,shading:!1,delay:200,shadingColor:"rgba(0,0,0,0)",indicatorSrc:"Images/Ripple1.gif",visible:t},progressPanelLoc:{message:i18nextko.t("roLocalizating"),showPane:!0,shading:!1,height:150,shadingColor:"rgba(0,0,0,0)",indicatorSrc:"Images/Ripple1.gif",visible:nt},licenceViewContent:{bounceEnabled:!0,showScrollbar:"always",height:200},homeContent:{bounceEnabled:!0,onPullDown:function(n){et();n.component.release()}},lblTermsAndContidions:i18nextko.t("roTermsAndConditions"),customConsent:dt,lbllicenseText:bt,lbllicenseAdv1:i18nextko.t("roAgreement1"),lbllicenseAdv2:i18nextko.t("roAgreement2"),lbllicenseAdv2Visibile:pt,lbllicenseAdv3:i18nextko.t("roAgreement3"),lbllicenseAdv3Visibile:wt,licenseVisible:ut,lblmandatoryCommuniques:i18nextko.t("roMandatoryCommuniques"),lblmandatorySurveys:i18nextko.t("roMandatorySurveys"),lblmandatoryAnswer:i18nextko.t("roMandatoryAnswer"),ApiVersion:at,TelecommutingEnabled:yt,ckLicenceAccepted:{text:i18nextko.t("roLicenseAccept"),value:a,disabled:lt},btnAcceptLicense:{onClick:ni,text:i18nextko.t("roSaveLicense")},btnAccept:{onClick:yi,text:i18nextko.t("closeConfig")},btnAcceptFailed:{onClick:pi,text:i18nextko.t("closeConfig")},btnAcceptPunch:{onClick:wi,text:i18nextko.t("closeConfig")},actionMenuPopover:{target:"#btnActionMenuPopover2",shading:!1,width:300,shadingColor:"rgba(0, 0, 0, 0.1)",visible:VTPortal.roApp.showPopover},quickPunchHelp:i18nextko.t("roquickPunchHelp"),refresh:et,punchAllowedCalc:i,resume:oi,startProgressImage:function(){$("#btnActionMenuPopover2").addClass("pressing");t(!0)},endProgressImage:function(){$("#btnActionMenuPopover2").removeClass("pressing");t(!1)},refreshModules:v};return VTPortal.roApp.homeView=st,st};VTPortal.status=function(){var et=ko.observable(new Date),k=VTPortal.summaryHome(),s=VTPortal.notificationsHome(),h=VTPortal.accrualsHome(),c=VTPortal.emptyHome(),l=VTPortal.surveysHome(),a=VTPortal.dailyRecordHome(),v=VTPortal.communiquesHome(),y=VTPortal.channelsHome(),p=ko.observable(VTPortal.bigUserInfo()),i=ko.observable(!1),r=ko.observable(!1),t=ko.observable(!1),u=ko.observable(!1),f=ko.observable(!1),e=ko.observable(!1),n=ko.observable(!1),d=ko.computed(function(){return VTPortal.roApp.db.settings.ApiVersion}),g=ko.computed(function(){if(VTPortal.roApp.userSurveys()!=null&&typeof VTPortal.roApp.userSurveys()!="undefined"){var n=VTPortal.roApp.userSurveys();return n!=null&&typeof n!="undefined"&&n.length>0?!0:!1}return!1}),nt=ko.computed(function(){return VTPortal.roApp.DailyRecordEnabled()?!0:!1}),tt=function(){var u;if(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Communiques&&VTPortal.roApp.userCommuniques()!=null){for(u=0;u<VTPortal.roApp.userCommuniques().length;++u)VTPortal.roApp.userCommuniques()[u].EmployeeCommuniqueStatus[0].AnswerRequired==!0&&VTPortal.roApp.userCommuniques()[u].EmployeeCommuniqueStatus[0].Answer==""&&VTPortal.roApp.userCommuniques()[u].Communique.MandatoryRead==!0&&VTPortal.roApp.userCommuniques()[u].Communique.Archived==!1&&n()==!1&&t(!0);for(u=0;u<VTPortal.roApp.userCommuniques().length;++u)VTPortal.roApp.userCommuniques()[u].EmployeeCommuniqueStatus[0].Read==!1&&VTPortal.roApp.userCommuniques()[u].Communique.MandatoryRead==!0&&VTPortal.roApp.userCommuniques()[u].Communique.Archived==!1&&VTPortal.roApp.userCommuniques()[u].EmployeeCommuniqueStatus[0].AnswerRequired==!1&&n()==!1&&i(!0)}if(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Surveys&&VTPortal.roApp.userSurveys()!=null&&typeof VTPortal.roApp.userSurveys()!="undefined"&&typeof VTPortal.roApp.userSurveys()!="undefined")for(u=0;u<VTPortal.roApp.userSurveys().length;++u)VTPortal.roApp.userSurveys()[u].IsMandatory==!0&&n()==!1&&VTPortal.roApp.stopShowingSurveysPopup()==!1&&(VTPortal.roApp.stopShowingSurveysPopup(!0),r(!0))},ot=ko.computed(function(){t()==!0&&i()==!0&&VTPortal.roApp.isCegidHub()==!1&&VTPortal.roApp.isCommuniquesEnabled()==!0?(u(!0),f(!1)):t()==!1&&i()==!0&&VTPortal.roApp.isCegidHub()==!1&&VTPortal.roApp.isCommuniquesEnabled()==!0?(u(!1),f(!0)):t()==!0&&i()==!1&&VTPortal.roApp.isCegidHub()==!1&&VTPortal.roApp.isCommuniquesEnabled()==!0?(u(!0),f(!1)):(u(!1),f(!1));r()==!0&&VTPortal.roApp.isCegidHub()==!1?e(!0):e(!1)}),it=ko.computed(function(){return i18nextko.i18n.t("roHomeTitle")}),o=function(){VTPortal.roApp.loggedIn&&(c.viewShown(),h.viewShown(),s.viewShown(),VTPortal.roApp.DailyRecordEnabled()&&a.viewShown(),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Communiques&&v.viewShown(),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Communiques&&y.viewShown(),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Surveys&&l.viewShown(),VTPortal.roApp.refreshEmployeeStatus(),VTPortal.roApp.refreshEmployeeAlerts())},w=function(){VTPortal.roApp.db.settings.resetAlertsStatusObject();n(!1);VTPortal.roApp.punchInProgress(!1);o()},rt=function(){window.VTPortalUtils.utils.setActiveTab("status");setTimeout(function(){n(!1);p().viewShown();o()},1e3)},ut=function(){i(!1);t(!1);window.VTPortalUtils.utils.setActiveTab("communiques");VTPortal.app.navigate("communiques",{root:!0})},ft=function(){r(!1);n(!0);VTPortal.app.navigate("surveys",{root:!0})},b={viewShown:rt,title:it,subscribeBlock:p(),summaryHome:k,notificationsHome:s,accrualsHome:h,emptyHome:c,communiquesHome:v,channelsHome:y,surveysHome:l,dailyRecordHome:a,dxholdHandler:function(){$.when(punchAllowedCalc()).then(quickPunch())},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),homeContent:{bounceEnabled:!0,onPullDown:function(n){w();n.component.release()}},lblmandatoryCommuniques:i18nextko.t("roMandatoryCommuniques"),lblmandatorySurveys:i18nextko.t("roMandatorySurveys"),lblmandatoryAnswer:i18nextko.t("roMandatoryAnswer"),ApiVersion:d,HasSurveys:g,DailyRecordHomeEnabled:nt,btnMandatorySurvey:{onClick:ft,text:i18nextko.t("roGoNow")},btnMandatoryCommunique:{onClick:ut,text:i18nextko.t("roGoNow")},btnAnswerLaterSurvey:{onClick:function(){n(!0);r(!1)},text:i18nextko.t("roGoLater")},btnAnswerLater:{onClick:function(){n(!0);t(!1)},text:i18nextko.t("roGoLater")},refresh:w,showPopupSurveys:e,showPopupCommuniques:f,showPopupAnswer:u,hasMandatoryCommuniques:i,hasMandatorySurveys:r,hasMandatoryAnswer:t,showMandatoryPopups:tt,refreshModules:o};return VTPortal.roApp.statusView=b,b};VTPortal.documents=function(){function p(){h().viewShown();e()}function e(){if(t(!1),c()){var n=VTPortal.roApp.documentsFilters(),i=function(n){var t,i,u,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(t=n.Documents,i=0;i<t.length;i++){VTPortal.roApp.isTimeGate()||(t[i].hasAction=!0);t[i].Name=t[i].Title;t[i].TypeName=t[i].DocumentTemplate.Name;t[i].Description=i18nextko.i18n.t("roDocumentDelivered")+" "+moment.tz(t[i].DeliveredDate,VTPortal.roApp.serverTimeZone).format("LL")+" "+moment.tz(t[i].DeliveredDate,VTPortal.roApp.serverTimeZone).format("LT");u=t[i].SignStatus;t[i].SignDesc="";r="";switch(t[i].DocumentTemplate.Scope){case 0:r="dx-icon-Document_EmployeeField";break;case 1:r="dx-icon-Document_EmployeeContract";break;case 2:r="dx-icon-Document_Punch";break;case 3:r="dx-icon-Document_Reason";break;case 4:r="dx-icon-Document_LeaveOrPermission";break;case 5:r="dx-icon-Document_Company";break;case 6:r="dx-icon-Document_Visit"}if(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.DocumentSign&&t[i].DocumentTemplate.RequiresSigning==!0){r="dx-icon-Document_Sign";switch(u){case 1:t[i].SignDesc=i18nextko.i18n.t("roDocumentsStatus")+": "+i18nextko.i18n.t("roDocPending");break;case 2:t[i].SignDesc=i18nextko.i18n.t("roDocumentsStatus")+": "+i18nextko.i18n.t("roDocInProgress");break;case 3:t[i].SignDesc=i18nextko.i18n.t("roDocumentsStatus")+": "+i18nextko.i18n.t("roDocSigned");break;case 4:t[i].SignDesc=i18nextko.i18n.t("roDocumentsStatus")+": "+i18nextko.i18n.t("roDocRejected")}}t[i].cssContainerClass="";t[i].cssClass=r}f(t)}};n==null?(t(!1),new WebServiceRobotics(function(n){i(n)}).getMyDocuments(null,null,"0*1*2*3*4*5*6","DeliveryDate DESC")):(t(!0),new WebServiceRobotics(function(n){i(n)}).getMyDocuments(n.filter.iDate,n.filter.eDate,n.filter.status.join("*"),n.order.by+" "+n.order.direction))}}function k(n,t){if(VTPortal.roApp.isModeApp()){var i=VTPortal.roApp.serverURL.url.replace("/api/Portalsvcx.svc",""),f=btoa(i+"/SigningPage.aspx?GUID="+n.GUID+"&MTClient="+VTPortal.roApp.companyID+"&App=1&IdDocument="+t),r=n.SignatureViDRemoteURL+"&url_return="+f;adfsLoginAttempts=0;u(!0);d(r,"_blank","usewkwebview=yes,fullscreen=yes,hidespinner=yes,hidden=yes,location=yes,hideurlbar=yes,hidenavigationbuttons=yes,toolbar=no,clearcache=no,clearsessioncache=no")}else{o(!0);var i=window.location.origin,e=btoa(i+"/SigningPage.aspx?GUID="+n.GUID+"&MTClient="+VTPortal.roApp.companyID+"&App=0&IdDocument="+t),r=n.SignatureViDRemoteURL+"&url_return="+e;g(r)}}function d(n,t,i){setTimeout(function(){inAppBrowserRef=cordova.InAppBrowser.open(n,t,i);inAppBrowserRef.addEventListener("loadstop",function(){tt()});inAppBrowserRef.addEventListener("exit",function(){nt()})},3e3)}function g(n){setTimeout(function(){window.open(n,"_self")},5e3)}function nt(){u(!1);e()}function tt(){VTPortal.roApp.wsRequestCounter()>0&&VTPortal.roApp.wsRequestCounter(0);inAppBrowserRef!=null&&inAppBrowserRef.show();timer=setTimeout(function(){inAppBrowserRef!=null&&inAppBrowserRef.executeScript({code:"returnToMobile()"},l)},3e3)}var f=ko.observable([]),i=ko.observable(!1),r=ko.observable("Images/Common/more.png"),n=ko.observable(),o=ko.observable(!1),a=VTPortal.noPermissions(),u=ko.observable(!1),s=ko.observable(!1),h=ko.observable(VTPortal.bigUserInfo()),v=[{text:i18nextko.i18n.t("roSignFile")},{text:i18nextko.i18n.t("roDownloadFile")}],y=ko.computed(function(){if(VTPortal.roApp.isTimeGate()||VTPortal.roApp.db.settings.ApiVersion<VTPortalUtils.apiVersion.DocumentSign)return!1;if(typeof n()!="undefined"){if(n().DocumentTemplate.RequiresSigning==!0)return!0}else return!1}),t=ko.observable(!1),w=ko.computed(function(){return VTPortal.roApp.documentsFilters()!=null?i18nextko.i18n.t("roFilteringData"):""}),b=ko.computed(function(){return t()?"95%":"100%"}),c=ko.computed(function(){return!0}),l=function(n){u(!1);n=="1"?(inAppBrowserRef.close(),inAppBrowserRef=null,e()):timer=setTimeout(function(){inAppBrowserRef!=null&&inAppBrowserRef.executeScript({code:"returnToMobile()"},l)},3e3)},it=function(){i(!1);VTPortal.app.navigate("sendDocument/-1")},rt=function(){i(!0);r("Images/Common/moreV.png")},ut=function(){r("Images/Common/more.png")},ft=function(){i(!1);r("Images/Common/more.png");VTPortal.app.navigate("DocumentFilters/1")};return{viewShown:p,title:i18nextko.t("roDocumentsTitle"),subscribeBlock:h(),hasPermission:c,noPermissions:a,documentsDS:f,requieresSign:y,dataFiltered:t,lblSignInfo:i18nextko.t("roSignInfo"),lblSignInfoApp:i18nextko.t("roSignInfoApp"),showPopupSign:o,showPopupSignApp:u,filterDescription:w,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),signOptions:{dataSource:v,visible:s,showTitle:!1,showCancelButton:ko.observable(!0),onItemClick:function(t){t.itemIndex==0?new WebServiceRobotics(function(t){switch(t.Status){case 0:k(t.Value,n().Id);break;case-95:VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoDocumentUploaded"),"info",2e3);break;case-96:VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roInvalidPhoneNumber"),"info",2e3);break;case-97:VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roEmptyFile"),"info",2e3);break;case-98:VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDocExceeded"),"info",2e3);break;case-114:VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDocumentVidSignerKo"),"info",2e3)}}).uploadDocumenttoSign(n().Id):new WebServiceRobotics(function(n){window.VTPortalUtils.utils.downloadBytes(n.Value)}).getDocumentBytes(n().Id)}},listRequests:{dataSource:f,scrollingEnabled:!0,grouped:!1,itemTemplate:"RequestItem",onItemClick:function(t){t.itemData.hasAction&&(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.DocumentSign?t.itemData.DocumentTemplate.RequiresSigning==!0&&t.itemData.SignStatus==1?(n(t.itemData),s(!0)):new WebServiceRobotics(function(n){window.VTPortalUtils.utils.downloadBytes(n.Value)}).getDocumentBytes(t.itemData.Id):new WebServiceRobotics(function(n){window.VTPortalUtils.utils.downloadBytes(n.Value)}).getDocumentBytes(t.itemData.Id))}},scrollContent:{height:b},showOptions:{onClick:rt,text:"",icon:r},actionMenuPopover:{target:"#btnActionMenuPopover",position:"top",shading:!0,shadingColor:"rgba(0, 0, 0, 0.5)",visible:i,onHidden:ut},btnFilterRequests:{onClick:ft,text:"",hint:i18nextko.i18n.t("roFilter"),icon:"Images/Common/filter.png"},btnNewDocument:{onClick:it,visible:!VTPortal.roApp.isTimeGate()&&VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.SendDocuments&&!VTPortal.roApp.ReadMode(),text:"",hint:i18nextko.i18n.t("roNew"),icon:"Images/Common/plus.png"}}};VTPortal.alerts=function(){var n=ko.observable([]),t=ko.observable(VTPortal.bigUserInfo()),r=function(n){switch(n.itemData.IdNotificationType){case 51:VTPortal.app.navigate("scheduler/1/"+n.itemData.NotificationDate.format("YYYY-MM-DD"),{target:"current"});break;case 52:case 75:VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRead"),"success",1e3);i()}},i=function(){var n=this;let i=function(){var i=VTPortal.roApp.userAlerts().ScheduleStatus,f=[],r,u,o,e,t;if(i!=null){if(r="",u=!0,typeof i.RequestAlerts!="undefined")for(t=0;t<i.RequestAlerts.length;t++){switch(i.RequestAlerts[t].IdRequestType){case 1:r="dx-icon-userFieldChange";break;case 2:r="dx-icon-forbiddenPunch";break;case 3:r="dx-icon-justifyPunch";break;case 4:r="dx-icon-externalWorkResume";break;case 5:r="dx-icon-changeShift";break;case 6:r="dx-icon-plannedHoliday";break;case 7:r="dx-icon-plannedAbsences";break;case 8:r="dx-icon-shiftExchange";break;case 9:r="dx-icon-plannedCauses";break;case 10:r="dx-icon-forbiddenPunch";break;case 11:r="dx-icon-holidaysCancel";break;case 12:r="dx-icon-forbiddenPunch";break;case 13:r="dx-icon-plannedHoliday";break;case 14:r="dx-icon-plannedOvertime";break;case 15:r="dx-icon-externalWorkWeekResume";break;case 16:r="dx-icon-telecommute"}switch(i.RequestAlerts[t].Status){case 0:name=i18nextko.i18n.t("roRequest_pending");break;case 1:name=i18nextko.i18n.t("roRequest_running");break;case 2:name=i18nextko.i18n.t("roRequest_approved");break;case 3:name=i18nextko.i18n.t("roRequest_denied");break;case 4:name=i18nextko.i18n.t("roRequest_canceled")}f.push({ID:i.RequestAlerts[t].IdRequest,IdRequestType:i.RequestAlerts[t].IdRequestType,IdRelatedObject:-1,IdNotificationType:-1,NotificationDate:null,cssClass:r,name:typeof i.RequestAlerts[t].AlertSubject!="undefined"?i.RequestAlerts[t].AlertSubject:name,hasAction:!0,type:"request",description:i.RequestAlerts[t].Description,iDate:null})}if(typeof i.IncompletePunches!="undefined")for(r="dx-icon-incompletePunch",t=0;t<i.IncompletePunches.length;t++)f.push({ID:-1,IdRequestType:-1,IdRelatedObject:-1,IdNotificationType:-1,NotificationDate:null,cssClass:r,name:typeof i.IncompletePunches[t].AlertSubject!="undefined"?i.IncompletePunches[t].AlertSubject:i18nextko.i18n.t("roIncompletePunch"),hasAction:!0,type:"incomplete",description:typeof i.IncompletePunches[t].AlertDescription!="undefined"?i.IncompletePunches[t].AlertDescription:i18nextko.i18n.t("roIncompletePunchAt")+" "+moment.tz(i.IncompletePunches[t].DateTime,VTPortal.roApp.serverTimeZone).format("DD/MM/YYYY"),iDate:moment.tz(i.IncompletePunches[t].DateTime,VTPortal.roApp.serverTimeZone)});if(typeof i.ForecastDocuments!="undefined")for(r="dx-icon-trackingDocuments",t=0;t<i.ForecastDocuments.length;t++){o="days";e=0;i.ForecastDocuments[t].IdHoursAbsence>0?(o="hours",e=i.ForecastDocuments[t].IdHoursAbsence):i.ForecastDocuments[t].IdOvertimeForecast>0?(o="overtime",e=i.ForecastDocuments[t].IdOvertimeForecast):i.ForecastDocuments[t].IdDaysAbsence>0?(o="days",e=i.ForecastDocuments[t].IdDaysAbsence):i.ForecastDocuments[t].IdRequest>0&&(o="request",e=i.ForecastDocuments[t].IdRequest);u=!1;!VTPortal.roApp.isTimeGate()&&i.ForecastDocuments[t].IDDocument<=0&&(u=!0);let n=i.ForecastDocuments[t].Description;VTPortal.roApp.isTimeGate()&&i.ForecastDocuments[t].IDDocument<=0&&(n+=". "+i18nextko.i18n.t("WRONG_DEVICE"));f.push({ID:-1,IdDocumentTemplate:i.ForecastDocuments[t].IDDocumentTemplate,IdRelatedObject:e,IdCause:i.ForecastDocuments[t].IdCause,ForecatstType:o,NotificationDate:moment.tz(i.ForecastDocuments[t].DateTime,VTPortal.roApp.serverTimeZone),cssClass:r,name:i18nextko.i18n.t("roTrackingDocument"),hasAction:u,type:"tracking",description:n,iDate:null})}if(typeof i.SignDocuments!="undefined")for(r="dx-icon-Document_Sign",t=0;t<i.SignDocuments.length;t++)u=!1,i.SignDocuments[t].IDDocument<=0&&(u=!0),f.push({ID:-1,IdDocumentTemplate:i.SignDocuments[t].IDDocumentTemplate,IdRelatedObject:e,NotificationDate:moment.tz(i.SignDocuments[t].DateTime,VTPortal.roApp.serverTimeZone),cssClass:r,name:i.SignDocuments[t].DocumentTemplateName,hasAction:u,type:"sign",description:i.SignDocuments[t].Description,iDate:null});if(typeof i.Notifications!="undefined")for(t=0;t<i.Notifications.length;t++){r="dx-icon-trackingDocuments";switch(i.Notifications[t].IdNotificationType){case 51:r="dx-icon-assignedShift";break;case 75:r="dx-icon-taTelecommuting_Home"}f.push({ID:-1,IdRequestType:-1,IdRelatedObject:i.Notifications[t].IdNotification,IdNotificationType:i.Notifications[t].IdNotificationType,NotificationDate:moment.tz(i.Notifications[t].DateTime,VTPortal.roApp.serverTimeZone),cssClass:r,name:i.Notifications[t].Name,hasAction:u,type:"notification",description:i.Notifications[t].Description,iDate:null})}typeof i.ExpiredDocAlert!="undefined"&&i.ExpiredDocAlert!=null&&(r="dx-icon-expiredDocAlert",f.push({ID:-1,IdRequestType:-1,IdRelatedObject:-1,IdNotificationType:-1,NotificationDate:null,cssClass:r,name:typeof i.ExpiredDocAlert[t].AlertSubject!="undefined"?i.ExpiredDocAlert[t].AlertSubject:i18nextko.i18n.t("roExpiredDocument"),hasAction:!1,type:"expired",description:typeof i.ExpiredDocAlert[t].AlertDescription!="undefined"?i.ExpiredDocAlert[t].AlertDescription:i18nextko.i18n.t("roExpiredDocuments")+" "+moment.tz(i.ExpiredDocAlert[t].DateTime,VTPortal.roApp.serverTimeZone).format("DD/MM/YYYY"),iDate:null}))}n.alertDS(f)};window.VTPortalUtils.utils.setActiveTab("alerts");t().viewShown();VTPortal.roApp.refreshEmployeeAlerts(i)};return{viewShown:i,title:i18nextko.t("roAlertsTitle"),subscribeBlock:t(),alertDS:n,listAlerts:{dataSource:n,scrollingEnabled:!1,grouped:!1,itemTemplate:"AlertItem",onItemClick:function(n){if(VTPortal.roApp.db.settings.markForRefresh(["notifications","status"]),n.itemData.hasAction)switch(n.itemData.type){case"tracking":VTPortal.app.navigate("sendLeaveDocument/"+n.itemData.IdDocumentTemplate+"/"+n.itemData.IdRelatedObject+"/"+n.itemData.IdCause+"/"+n.itemData.ForecatstType);break;case"sign":VTPortal.app.navigate("documents");break;case"notification":new WebServiceRobotics(function(t){t.Status==window.VTPortalUtils.constants.OK.value?t.Result?$.when(VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1)).then(r(n)):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNotificationNotExists"),"error",1e3):VTPortalUtils.utils.processErrorMessage(t)},function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNotificationLoadError"),"error",1e3)}).setNotificationReaded(n.itemData.IdRelatedObject);break;case"request":n.itemData.IdRequestType!=16?(VTPortalUtils.utils.markRequestAsRead(n.itemData.ID),VTPortalUtils.utils.navigateToRequest(n.itemData)):(VTPortalUtils.utils.markRequestAsRead(n.itemData.ID),VTPortal.app.navigate("scheduler/1/"+moment().format("YYYY-MM-DD")));break;case"incomplete":VTPortal.app.navigate("forgottenPunch/-1/"+n.itemData.iDate.format("YYYY-MM-DD"))}}}}};VTPortal.teleworking=function(n){function l(){u().viewShown()}function v(){var i=moment(n.param);f.modelIsReady(!1);e.modelIsReady(!1);o.modelIsReady(!1);switch(t()){case 1:f.initializeView(i);break;case 2:e.initializeView(i);break;case 3:o.initializeView(i)}}var t=ko.observable(1),i=ko.observable(0),u,h,c;typeof n.id!="undefined"&&(t(parseInt(n.id,10)),i(parseInt(n.id,10)-1));u=ko.observable(VTPortal.bigUserInfo());var f=VTPortal.myWork(),e=VTPortal.myWorkDaily(),o=VTPortal.myWorkRequests(),a=ko.computed(function(){switch(t()){case 1:return i18nextko.i18n.t("roMyWorkTitle");case 2:return i18nextko.i18n.t("roMyWorkDaily");case 3:return i18nextko.i18n.t("roMyWorkRequests")}},this),s=ko.observable([]),r=[];return r.push({ID:1,cssClass:"dx-icon-myWork"}),r.push({ID:2,cssClass:"dx-icon-myWorkDaily"}),r.push({ID:3,cssClass:"dx-icon-myWorkRequests"}),s(r),h=function(n){t(n.ID);v();i(n.ID-1)},c={viewShown:l,title:a,subscribeBlock:u(),myWorkBlock:f,myWorkDailyBlock:e,myWorkRequestsBlock:o,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),selectedView:t,selectedIndex:i,tabPanelOptions:{dataSource:s,selectedIndex:i,itemTemplate:"title",onSelectionChanged:function(n){h(n.addedItems[0])}}},c};VTPortal.myWorkRequests=function(){function o(){h();u(!0);n()?$("#scrollview").height($("#panelsContent").height()-94):$("#scrollview").height($("#panelsContent").height()-70)}function h(){n(!1);var i=VTPortal.roApp.teleWorkingFilters(),r=function(n){var i,r,u,f,e;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=n.Requests,r=0;r<i.length;r++){i[r].Name=i18nextko.i18n.t("roRequestType_"+i[r].RequestType);i[r].hasAction=n.CanCreateRequest?!0:!1;u="";switch(i[r].Status){case 0:u="ro_Status_pending";break;case 1:u="ro_Status_ongoing";break;case 2:u="ro_Status_accepted";break;case 3:u="ro_Status_denied"}f="";switch(i[r].IdRequestType){case 4:f="dx-icon-externalWorkResume";break;case 15:f="dx-icon-externalWorkWeekResume"}i[r].cssContainerClass=u;i[r].cssClass=f}t(i)}else t([]),e=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,e)};i==null?(n(!1),new WebServiceRobotics(function(n){r(n)}).getMyRequests(!1,moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").add(1,"day"),"0*1*2*3|4,15","RequestDate DESC",moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").add(1,"year"))):(n(!0),new WebServiceRobotics(function(n){r(n)}).getMyRequests(!1,i.filter.iDate,i.filter.eDate,i.filter.status.join("*")+"|"+i.filter.types.join(","),i.order.by+" "+i.order.direction,i.filter.iRequestedDate,i.filter.eRequestedDate))}var u=ko.observable(!1),t=ko.observable([]),i=ko.observable(!1),r=ko.observable("Images/Common/more.png"),f=VTPortal.noPermissions(),n=ko.observable(!1),e=ko.computed(function(){return VTPortal.roApp.teleWorkingFilters()!=null?i18nextko.i18n.t("roFilteringData"):""}),s=ko.computed(function(){return VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Requests!=null&&VTPortal.roApp.empPermissions().Requests.length>0&&(VTPortal.roApp.empPermissions().Requests[3].Permission==!0||VTPortal.roApp.empPermissions().Requests[14].Permission==!0)?!0:!1}),c=function(){i(!1);VTPortal.app.navigate("requestsList/4,15/null")},l=function(){i(!0);r("Images/Common/moreV.png")},a=function(){r("Images/Common/more.png")},v=function(){i(!1);r("Images/Common/more.png");VTPortal.app.navigate("RequestFilters/1")};return{modelIsReady:u,initializeView:o,hasPermission:s,noPermissions:f,requestsDS:t,dataFiltered:n,filterDescription:e,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),listRequests:{dataSource:t,scrollingEnabled:!1,grouped:!1,itemTemplate:"RequestItem",onItemClick:function(n){if(n.itemData.hasAction)switch(n.itemData.IdRequestType){case 4:VTPortal.app.navigate("externalWork/"+n.itemData.Id);break;case 15:VTPortal.app.navigate("externalWorkWeekResume/"+n.itemData.Id)}}},actionMenuPopover:{target:"#btnActionMenuPopover",position:"top",shading:!0,shadingColor:"rgba(0, 0, 0, 0.5)",visible:i,onHidden:a},showOptions:{onClick:l,text:"",icon:r},btnFilterRequests:{onClick:v,text:"",hint:i18nextko.i18n.t("roFilter"),icon:"Images/Common/filter.png"},btnNewRequests:{onClick:c,text:"",hint:i18nextko.i18n.t("roNew"),icon:"Images/Common/plus.png",visible:VTPortal.roApp.ReadMode()==!1},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.myWorkDaily=function(){function o(t){n(t);i(!0)}var f=function(n,t){var i=t.targetOffset;i<0?u():i>0&&r()},e=VTPortal.noPermissions(),n=ko.observable(new Date),i=ko.observable(!1),t=ko.observable([]),r=function(){n(moment(n()).subtract(1,"days"))},u=function(){n(moment(n()).add(1,"days"))},s=function(){VTPortal.app.navigate("requestsList/4,15/"+moment(n()).format("YYYY-MM-DD"))},h=ko.computed(function(){return VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Punch.ScheduleQuery?!0:!1}),c=function(n){if(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Punch.ScheduleQuery){var i=function(n){var i,r,u,f,e;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=n.Requests,r=0;r<i.length;r++){i[r].Name=i18nextko.i18n.t("roRequestType_"+i[r].RequestType);i[r].hasAction=n.CanCreateRequest?!0:!1;u="";switch(i[r].Status){case 0:u="ro_Status_pending";break;case 1:u="ro_Status_ongoing";break;case 2:u="ro_Status_accepted";break;case 3:u="ro_Status_denied"}f="";switch(i[r].IdRequestType){case 4:f="dx-icon-externalWorkResume";break;case 15:f="dx-icon-externalWorkWeekResume"}i[r].cssContainerClass=u;i[r].cssClass=f}t(i);$("#scrollview").height($("#panelsContent").height()-70)}else t([]),e=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,e)};new WebServiceRobotics(function(n){i(n)}).getMyDailyTeleWorking(moment(n.value).startOf("day"))}};return{modelIsReady:i,initializeView:o,requestsDS:t,hasPermission:h,noPermissions:e,headerDate:{value:n,pickerType:"rollers",displayFormat:"shortDate",onValueChanged:c},btnPrevious:{icon:"chevronprev",onClick:r},btnNext:{icon:"chevronnext",onClick:u},myEventHandler:f,listOptions:{dataSource:t,grouped:!1,scrollingEnabled:!1,onItemClick:function(n){if(n.itemData.hasAction)switch(n.itemData.IdRequestType){case 4:VTPortal.app.navigate("externalWork/"+n.itemData.Id);break;case 15:VTPortal.app.navigate("externalWorkWeekResume/"+n.itemData.Id)}}},newRequest:{onClick:s,text:"",icon:"Images/Common/plus.png",visible:VTPortal.roApp.ReadMode()==!1},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.myWork=function(){function c(n){t([]);o(n);f(!0)}function a(t){var i="",u="",f="#dcdcdc",e="#dcdcdc",c=90,l=95,p="",y,s,a,h,v;for(moment(t.date).format("YYYYMMDD")==moment().format("YYYYMMDD")&&(p="actualDate"),y=r(),s=null,a=0;a<y.length;a++){if(h=y[a],h.RequestDays!=null&&h.RequestDays.length>0){for(v=0;v<h.RequestDays.length;v++)if(s=moment.tz(h.RequestDays[v].RequestDate,VTPortal.roApp.serverTimeZone).startOf("day").isSame(moment(t.date))?!0:!1,s)break}else s=moment.tz(h.Date1,VTPortal.roApp.serverTimeZone).isSame(moment(t.date))?!0:!1;if(s)break}return s!=null?s&&(f="#0046FE"):n||(n=!0,o(t.date)),i="width:100%;height:100%;color: "+e+";",i+="background: "+e+";",i+="background: -webkit-radial-gradient(circle closest-side, "+e+" 90%,rgba(255,255,255,0) 95%);",i+="background: -moz-radial-gradient(circle closest-side, "+e+" 90%,rgba(255,255,255,0) 95%);",i+="background: -ms-radial-gradient(circle closest-side, "+e+" 90%,rgba(255,255,255,0) 95%);",i+="background: -o-radial-gradient(circle closest-side, "+e+" 90%,rgba(255,255,255,0) 95%);",i+="background: radial-gradient(circle closest-side at center, "+e+" 90%,rgba(255,255,255,0) 95%);",i+="background-repeat: no-repeat;",i+="background-position: center center;display:table;",u="width:100%;height:100%;min-height:50px;color: #000000;",u+="background: "+f+";",u+="background: -webkit-radial-gradient(circle closest-side, "+f+" "+c+"%,rgba(255,255,255,0) "+l+"%);",u+="background: -moz-radial-gradient(circle closest-side, "+f+" "+c+"%,rgba(255,255,255,0) "+l+"%);",u+="background: -ms-radial-gradient(circle closest-side, "+f+" "+c+"%,rgba(255,255,255,0) "+l+"%);",u+="background: -o-radial-gradient(circle closest-side, "+f+" "+c+"%,rgba(255,255,255,0) "+l+"%);",u+="background: radial-gradient(circle closest-side at center, "+f+" "+c+"%,rgba(255,255,255,0) "+l+"%);",u+="background-repeat: no-repeat;",u+="background-position: center center;display:table;","<div style='width:100%;height:100%;min-height:50px;'><div class='innerCalCellTemplate' style='"+i+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(t.date).format("YYYYMMDD")+"' style='"+u+"'> <span class='"+p+"' style='display:table-cell;vertical-align:middle;font-weight:bold'>"+t.text+"<\/span><\/div><\/div><\/div><\/div>"}var f=ko.observable(!1),r=ko.observable([]),i=ko.observable(!1),n=!0,e=ko.observable("#calendarContainer"),h=VTPortal.noPermissions(),t=ko.observable([]),o=function(i){var u=moment(i).year();t().indexOf(u)==-1&&s()?(t().push(u),new WebServiceRobotics(function(t){if(t.Status==window.VTPortalUtils.constants.OK.value)r(t.Requests),setTimeout(function(){$("#calendarContainer").dxCalendar("instance").repaint()},100);else{r([]);var i=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(t,i)}n=!1},function(){t(t().remove(u));n=!1}).getTeleworkingDetail(moment().startOf("day").startOf("year"),moment().startOf("day").endOf("year"))):n=!1},s=ko.computed(function(){return VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Punch.ScheduleQuery?!0:!1}),l=function(){VTPortal.app.navigate("requestsList/4,15")},v=function(n){selectedDay=n.value;e("#"+moment(n.value).format("YYYYMMDD"));i(!0)},u=[];return(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().CanCreateRequests)&&u.push({location:"center",widget:"dxButton",options:{hint:i18nextko.i18n.t("roNewRequest_Detail"),icon:"taNewRequest_Detail",onClick:function(){i(!1);VTPortal.app.navigate("requestsList/4,15/"+moment(selectedDay).format("YYYY-MM-DD"))}}}),u.push({location:"center",widget:"dxButton",options:{hint:i18nextko.i18n.t("roInformation"),icon:"taInformation",onClick:function(){i(!1);VTPortal.app.navigate("teleworking/2/"+moment(selectedDay).format("YYYY-MM-DD"),{target:"current"})}}}),{modelIsReady:f,initializeView:c,hasPermission:s,noPermissions:h,calendarOptions:{width:"100%",height:450,useCellTemplate:!0,cellTemplate:a,firstDayOfWeek:moment()._locale._week.dow,zoomLevel:"month",maxZoomLevel:"month",minZoomLevel:"month",onCellClick:v,showTodayButton:!1},calendarCellPopover:{target:e,position:"top",width:300,shading:!0,shadingColor:"rgba(0, 0, 0, 0.5)",visible:i},dayToolbarActions:{items:u},newRequest:{onClick:l,text:"",icon:"Images/Common/plus.png",visible:VTPortal.roApp.ReadMode()==!1},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.surveys=function(){function i(){var u=[],o="",i=VTPortal.roApp.userSurveys(),f,e,r;if(i!=null&&i.length>0)for(f="",e="",r=0;r<i.length;r++){var s=moment(),h=moment(i[r].ExpirationDate),c=h.diff(s,"days");i[r].IsMandatory==!0?(f="dx-icon-surveyImportant",e="textCommuniqueNotRead"):(f="dx-icon-surveyNotRead",e="textCommuniqueNotRead");o=i[r].Anonymous==!0?i18nextko.i18n.t("roIsAnonymous"):"";name=i[r].Title;u.push({ID:i[r].Id,cssClass:f,cssClassText:e,Content:i[r].Content,SentOn:moment(i[r].SentOn).format("DD/MM/YYYY"),Subject:i[r].Title,CreatedBy:i[r].CreatedByName,IsAnonymous:o,ExpiresOn:i18nextko.i18n.t("roExpiresOn")+c+i18nextko.i18n.t("roExpiresOnDays")})}return u.length>0?t(!0):t(!1),n(new DevExpress.data.DataSource({store:u,searchOperation:"contains",searchExpr:["Subject","Message","SentOn","CreatedBy"]})),u}function u(){VTPortal.roApp.db.settings.markForRefresh(["surveys","status"]);r().viewShown();i()}var t=ko.observable(!1),n=ko.observable(new DevExpress.data.DataSource({searchOperation:"contains",searchExpr:["Subject","Message","SentOn","CreatedBy"]})),r=ko.observable(VTPortal.bigUserInfo());return{viewShown:u,title:i18nextko.t("rosurveysTitle"),subscribeBlock:r(),surveyDS:t,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),commScroll:{height:"70%",onPullDown:function(){i()}},listsurveys:{dataSource:n,scrollingEnabled:!1,grouped:!1,itemTemplate:"surveyItem",onItemClick:function(n){VTPortal.app.navigate("surveyDetail/"+n.itemData.ID)}},searchOptions:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(t){n().searchValue(t.value);n().load()}},allComm:{onClick:i,text:i18nextko.t("roAllComm")}}};VTPortal.surveyDetail=function(n){function u(t){new WebServiceRobotics(function(n){n.oState.Result==window.VTPortalUtils.constants.OK.value?setTimeout(function(){VTPortal.roApp.db.settings.markForRefresh(["surveys","status"]);VTPortal.app.navigate("status",{root:!0})},2e3):setTimeout(function(){DevExpress.ui.notify(i18nextko.t("roSurveySaveError"),"warning",3e3);VTPortal.app.navigate("surveys",{root:!0})},2e3)}).sendSurveyResponse(n.id,VTPortal.roApp.employeeId,t.data)}function f(){t().viewShown();r()}var t=ko.observable(VTPortal.bigUserInfo()),i=ko.observable(),r=function(){new WebServiceRobotics(function(n){if(n.oState.Result==window.VTPortalUtils.constants.OK.value){let t=JSON.parse(n.Survey.Content);t.pages.forEach(n=>{n.elements.forEach(n=>{n.type==="dropdown"&&(n.renderAs="select")})});const f=t.locale;i(n);let r=new Survey.Model(t);Survey.StylesManager.applyTheme("orange");r.locale=f||"es";r.onComplete.add(u);$("#surveyContainer").Survey({model:r})}else DevExpress.ui.notify(i18nextko.t("roSurveyError"),"warning",3e3),VTPortal.app.navigate("surveys",{root:!0})}).getSurveyById(n.id)};return{viewShown:f,title:i18nextko.i18n.t("roHomeSurvey"),subscribeBlock:t(),surveyModel:i,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),commScroll:{height:"75%",onPullDown:function(){}}}};VTPortal.scheduler=function(n){function y(){var i=moment(n.param);u.modelIsReady(!1);f.modelIsReady(!1);e.modelIsReady(!1);o.modelIsReady(!1);switch(t()){case 1:u.initializeView(i);break;case 2:f.initializeView(i);break;case 3:e.initializeView(i);break;case 4:o.initializeView()}}var t=ko.observable(1),r=ko.observable(0),c,l;typeof n.id!="undefined"&&(t(parseInt(n.id,10)),r(parseInt(n.id,10)-1));var s=ko.observable(VTPortal.bigUserInfo()),a=function(){s().viewShown()},u=VTPortal.myCalendar(),f=VTPortal.myAccruals(),e=VTPortal.myAuthorizations(),o=VTPortal.myRequests(),v=ko.computed(function(){switch(t()){case 1:return i18nextko.i18n.t("roMyCalendarTitle");case 2:return i18nextko.i18n.t("roMyAccrualsTitle");case 3:return i18nextko.i18n.t("roMyAuthorizationsTitle");case 4:return i18nextko.i18n.t("roProfileRequests")}},this),h=ko.observable([]),i=[];return i.push({ID:1,cssClass:"dx-icon-myCalendar",hint:i18nextko.i18n.t("roMyCalendarHint")}),i.push({ID:2,cssClass:"dx-icon-myAccruals",hint:i18nextko.i18n.t("roMyAccrualsHint")}),i.push({ID:3,cssClass:"dx-icon-myAuthorizations",hint:i18nextko.i18n.t("roMyAuthorizationsHint")}),i.push({ID:4,cssClass:"dx-icon-profileRequests",hint:i18nextko.i18n.t("roMyRequestsHint")}),h(i),c=function(n){t(n.ID);y();r(n.ID-1)},l={viewShown:a,title:v,subscribeBlock:s(),myCalendarBlock:u,myAccrualsBlock:f,myAuthorizationsBlock:e,myRequestsBlock:o,selectedView:t,selectedIndex:r,tabPanelOptions:{dataSource:h,selectedIndex:r,itemTemplate:"title",onSelectionChanged:function(n){c(n.addedItems[0])}}},l};VTPortal.myRequests=function(){function o(){h();u(!0);n()?$("#scrollview").height($("#panelsContent").height()-94):$("#scrollview").height($("#panelsContent").height()-70)}function h(){n(!1);var i=VTPortal.roApp.requestFilters(),r=function(n){var i,r,f,u,e;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=n.Requests,r=0;r<i.length;r++){i[r].Name=i18nextko.i18n.t("roRequestType_"+i[r].RequestType);i[r].hasAction=n.CanCreateRequest?!0:!1;f="";switch(i[r].Status){case 0:f="ro_Status_pending";i[r].StatusDesc=i18nextko.i18n.t("roRequestStatus_pending");break;case 1:f="ro_Status_ongoing";i[r].StatusDesc=i18nextko.i18n.t("roRequestStatus_running");break;case 2:f="ro_Status_accepted";i[r].StatusDesc=i18nextko.i18n.t("roRequestStatus_approved");break;case 3:f="ro_Status_denied";i[r].StatusDesc=i18nextko.i18n.t("roRequestStatus_denied");break;case 4:f="ro_Status_canceled";i[r].StatusDesc=i18nextko.i18n.t("roRequestStatus_canceled");i[r].hasAction=!1}u="";switch(i[r].IdRequestType){case 1:u="dx-icon-userFieldChange";break;case 4:u="dx-icon-externalWorkResume";break;case 5:u="dx-icon-changeShift";break;case 6:u="dx-icon-plannedHoliday";break;case 8:u="dx-icon-shiftExchange";break;case 7:u="dx-icon-plannedAbsences";break;case 11:u="dx-icon-holidaysCancel";break;case 13:u="dx-icon-plannedHoliday";break;case 15:u="dx-icon-externalWorkWeekResume"}i[r].cssContainerClass=f;i[r].cssClass=u;$("#scrollview").height($("#panelsContent").height())}t(i)}else t([]),e=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,e)};i==null?(n(!1),new WebServiceRobotics(function(n){r(n)}).getMyRequests(!1,moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").add(1,"day"),"0*1*2*3*4|1*5*6*7*8*11*13","RequestDate DESC",moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").add(1,"year"))):(n(!0),new WebServiceRobotics(function(n){r(n)}).getMyRequests(!1,i.filter.iDate,i.filter.eDate,i.filter.status.join("*")+"|"+i.filter.types.join("*"),i.order.by+" "+i.order.direction,i.filter.iRequestedDate,i.filter.eRequestedDate))}var u=ko.observable(!1),t=ko.observable([]),i=ko.observable(!1),r=ko.observable("Images/Common/more.png"),f=VTPortal.noPermissions(),n=ko.observable(!1),e=ko.computed(function(){return VTPortal.roApp.requestFilters()!=null?i18nextko.i18n.t("roFilteringData"):""}),s=ko.computed(function(){var t,n;if(VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Requests!=null){for(t=!1,n=0;n<VTPortal.roApp.empPermissions().Requests.length;n++)if(VTPortal.roApp.empPermissions().Requests[n].Permission){t=!0;break}return t}return!1}),c=function(){i(!0);r("Images/Common/moreV.png")},l=function(){r("Images/Common/more.png")},a=function(){i(!1);r("Images/Common/more.png");VTPortal.app.navigate("RequestFilters/0")},v=function(){i(!1);VTPortal.app.navigate("requestsList/1,5,6,7,8,11,13/null")};return{modelIsReady:u,initializeView:o,hasPermission:s,noPermissions:f,requestsDS:t,dataFiltered:n,filterDescription:e,listRequests:{dataSource:t,scrollingEnabled:!1,grouped:!1,itemTemplate:"RequestItem",onItemClick:function(n){if(n.itemData.hasAction)switch(n.itemData.IdRequestType){case 1:VTPortal.app.navigate("userFields/"+n.itemData.Id);break;case 5:VTPortal.app.navigate("changeShift/"+n.itemData.Id);break;case 6:VTPortal.app.navigate("plannedHoliday/"+n.itemData.Id);break;case 7:VTPortal.app.navigate("plannedAbsence/"+n.itemData.Id);break;case 8:VTPortal.app.navigate("shiftExchange/"+n.itemData.Id);break;case 11:VTPortal.app.navigate("cancelHolidays/"+n.itemData.Id);break;case 13:VTPortal.app.navigate("plannedHoliday/"+n.itemData.Id);break;case 15:VTPortal.app.navigate("externalWorkWeekResume/"+n.itemData.Id)}}},actionMenuPopover:{target:"#btnActionMenuPopover",position:"top",shading:!0,shadingColor:"rgba(0, 0, 0, 0.5)",visible:i,onHidden:l},showOptions:{onClick:c,text:"",icon:r},btnFilterRequests:{onClick:a,text:"",hint:i18nextko.i18n.t("roFilter"),icon:"Images/Common/filter.png"},btnNewRequests:{onClick:v,text:"",hint:i18nextko.i18n.t("roNew"),icon:"Images/Common/plus.png",visible:VTPortal.roApp.ReadMode()==!1},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.myCalendar=function(){function e(n){var t=l();typeof n!="undefined"&&n!=null&&(t=n);(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Schedule.QuerySchedule)&&new WebServiceRobotics(function(n){var i,t,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=u(),t=0;t<n.oCalendar.DayData.length;t++)i[moment.tz(n.oCalendar.DayData[t].PlanDate,VTPortal.roApp.serverTimeZone).add(12,"hours").format("YYYYMMDD")]=n.oCalendar.DayData[t];u(i);setTimeout(function(){$("#calendarContainer").dxCalendar("instance").repaint();$("#calendarContainer").height($("#scrollview").height())},100)}else u([]),r=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r)},function(){}).getMyCalendar(t);v(!0)}function tt(n,t,i){var r=n.charAt(0)==="#"?n.substring(1,7):n,f=parseInt(r.substring(0,2),16),e=parseInt(r.substring(2,4),16),o=parseInt(r.substring(4,6),16),s=[f/255,e/255,o/255],u=s.map(function(n){return n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4)}),h=.2126*u[0]+.7152*u[1]+.0722*u[2];return h>.7?i:t}function it(n){var i="",o="#ffffff",e="",t=u()[moment(n.date).format("YYYYMMDD")],r="",s,h,f;return moment(n.date).format("YYYYMMDD")==moment().format("YYYYMMDD")&&(r="actualDate"),s=null,t!=null&&(t.MainShift!=null&&(o=t.MainShift.Color),t.IncidenceData!=null&&typeof t.IncidenceData.NormalWork!="undefined"&&t.IncidenceData.NormalWork!=0?(s=t.IncidenceData.NormalWork,t.IncidenceData.NormalWork>0?e="#05580c":t.IncidenceData.NormalWork<0&&(e="#e00032")):t.MainShift!=null&&(e=o,(t.Alerts.OnAbsenceHours||t.Alerts.OnAbsenceDays||t.Alerts.OnHolidays||t.Alerts.OnOvertimesHours||t.Alerts.OnHolidaysHours)&&(t.Alerts.OnAbsenceHours?e="#00f12b":t.Alerts.OnOvertimesHours?e="#0019cc":t.Alerts.OnHolidaysHours?e="#ffa500":t.Alerts.OnAbsenceDays?e="#a400cc":t.Alerts.OnHolidays&&(e="#dc7214")))),h=VTPortalUtils.utils.generateGradientFromColor(t),f=tt(o,"#FFFFFF","#000000"),i="height:100%;border-radius: 10%;"+h,e!=""&&(i=i+";border:2px solid "+e),t!=null&&typeof t!="undefined"?VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Telecommuting&&typeof t.CanTelecommute!="undefined"&&t.CanTelecommute?typeof t.TelecommuteForced!="undefined"&&t.TelecommuteForced?typeof t.MainShift!="undefined"&&t.MainShift!=null&&t.MainShift.PlannedHours>0&&!t.Alerts.OnAbsenceDays&&!t.Alerts.OnHolidays?t.TelecommutingExpected==!0?"<div style='width:100%'><div class='CalendarCellDailyLayout'><div style='height:100%' class='innerCalCellTemplate'><div style='"+i+"'> <div class='dx-icon-Cal_TC_Home'><\/div><span class='CalendarCellDailyLayoutText "+r+"' id='"+moment(n.date).format("YYYYMMDD")+"' style='color: "+f+"'>"+n.text+"<\/span><\/div><\/div><\/div>":t.TelecommutingOptional==!0?"<div style='width:100%'><div class='CalendarCellDailyLayout'><div style='height:100%' class='innerCalCellTemplate'><div style='"+i+"'> <div class='dx-icon-Cal_TC_Optional'><\/div><span class='CalendarCellDailyLayoutText "+r+"' id='"+moment(n.date).format("YYYYMMDD")+"' style='color: "+f+"'>"+n.text+"<\/span><\/div><\/div><\/div>":"<div style='width:100%'><div class='CalendarCellDailyLayout'><div style='height:100%' class='innerCalCellTemplate'><div style='"+i+"'> <div class='dx-icon-Cal_TC_Presence'><\/div><span class='CalendarCellDailyLayoutText "+r+"' id='"+moment(n.date).format("YYYYMMDD")+"' style='color: "+f+"'>"+n.text+"<\/span><\/div><\/div><\/div>":"<div style='width:100%'><div class='CalendarCellDailyLayout'><div style='height:100%' class='innerCalCellTemplate'><div style='"+i+"'> <span class='CalendarCellDailyLayoutText "+r+"' id='"+moment(n.date).format("YYYYMMDD")+"' style='color: "+f+"'>"+n.text+"<\/span><\/div><\/div><\/div>":typeof t.MainShift!="undefined"&&t.MainShift!=null&&t.MainShift.PlannedHours>0&&!t.Alerts.OnAbsenceDays&&!t.Alerts.OnHolidays?t.TelecommutingOptionalDays!=null&&t.TelecommutingOptionalDays.indexOf(moment(n.date).day().toString())>=0?"<div style='width:100%'><div class='CalendarCellDailyLayout'><div style='height:100%' class='innerCalCellTemplate'><div style='"+i+"'> <div class='dx-icon-Cal_TC_Optional'><\/div><span class='CalendarCellDailyLayoutText "+r+"' id='"+moment(n.date).format("YYYYMMDD")+"' style='color: "+f+"'>"+n.text+"<\/span><\/div><\/div><\/div>":t.PresenceMandatoryDays!=null&&t.PresenceMandatoryDays.indexOf(moment(n.date).day().toString())>=0?"<div style='width:100%'><div class='CalendarCellDailyLayout'><div style='height:100%' class='innerCalCellTemplate'><div style='"+i+"'> <div class='dx-icon-Cal_TC_Presence'><\/div><span class='CalendarCellDailyLayoutText "+r+"' id='"+moment(n.date).format("YYYYMMDD")+"' style='color: "+f+"'>"+n.text+"<\/span><\/div><\/div><\/div>":t.TelecommutingMandatoryDays!=null&&t.TelecommutingMandatoryDays.indexOf(moment(n.date).day().toString())>=0?"<div style='width:100%'><div class='CalendarCellDailyLayout'><div style='height:100%' class='innerCalCellTemplate'><div style='"+i+"'> <div class='dx-icon-Cal_TC_Home'><\/div><span class='CalendarCellDailyLayoutText "+r+"' id='"+moment(n.date).format("YYYYMMDD")+"' style='color: "+f+"'>"+n.text+"<\/span><\/div><\/div><\/div>":"<div style='width:100%'><div class='CalendarCellDailyLayout'><div style='height:100%' class='innerCalCellTemplate'><div style='"+i+"'><span class='CalendarCellDailyLayoutText "+r+"' id='"+moment(n.date).format("YYYYMMDD")+"' style='color: "+f+"'>"+n.text+"<\/span><\/div><\/div><\/div>":"<div style='width:100%'><div class='CalendarCellDailyLayout'><div style='height:100%' class='innerCalCellTemplate'><div style='"+i+"'> <span class='CalendarCellDailyLayoutText "+r+"' id='"+moment(n.date).format("YYYYMMDD")+"' style='color: "+f+"'>"+n.text+"<\/span><\/div><\/div><\/div>":"<div style='width:100%'><div class='CalendarCellDailyLayout'><div style='height:100%' class='innerCalCellTemplate'><div style='"+i+"'> <span class='CalendarCellDailyLayoutText "+r+"' id='"+moment(n.date).format("YYYYMMDD")+"' style='color: "+f+"'>"+n.text+"<\/span><\/div><\/div><\/div>":"<div style='width:100%'><div class='CalendarCellDailyLayout'><div style='height:100%' class='innerCalCellTemplate'><div style='"+i+"'> <span class='CalendarCellDailyLayoutText "+r+"' id='"+moment(n.date).format("YYYYMMDD")+"' style='color: "+f+"'>"+n.text+"<\/span><\/div><\/div><\/div>"}function p(n,t){var i=t;new WebServiceRobotics(function(t){t.Status==window.VTPortalUtils.constants.OK.value?t.NeedRequest==!1?(e(n),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roTCChanged"),"success",2e3)):rt(n,i):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t(window.VTPortalUtils.utils.languageTag(t.Status)),"error",0)}).checkTelecommutingChange(moment(n).format("YYYY/MM/DD"),t,VTPortal.roApp.impersonatedIDEmployee!=-1)}function rt(n,t){var i="";i=t=="office"?i18nextko.i18n.t("roDoRequestFromHome"):i18nextko.i18n.t("roDoRequestFromOffice");VTPortalUtils.utils.questionMessage(i,"info",0,function(){new WebServiceRobotics(function(t){t.Status==window.VTPortalUtils.constants.OK.value?(e(n),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3)):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t(window.VTPortalUtils.utils.languageTag(t.Status)),"error",0)}).changeTelecommutingByRequest(moment(n).format("YYYY-MM-DD"),t,VTPortal.roApp.impersonatedIDEmployee!=-1)},function(){},i18nextko.i18n.t("roContinue"),i18nextko.i18n.t("roCancel"))}function c(){var n=[];return VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Telecommuting&&VTPortal.roApp.userTelecommute()!=null&&VTPortal.roApp.userTelecommute().Telecommuting&&u()[moment(i).format("YYYYMMDD")].CanTelecommute==!0&&(moment(i)>=moment().startOf("day")&&(u()[moment(i).format("YYYYMMDD")].TelecommutingExpected==!0?a()>=o()&&o()>0?n.push({ID:0,cssClass:"dx-icon-taTelecommuting_OfficeFullCal",cssClassText:"textActionCalendar",Content:i18nextko.i18n.t("roRequestTelecommutingOffice"),Desc:h(),CurrentUsage:""}):n.push({ID:1,cssClass:"dx-icon-taTelecommuting_OfficeCal",cssClassText:"textActionCalendar",Content:i18nextko.i18n.t("roRequestTelecommutingOffice"),Desc:h(),CurrentUsage:""}):n.push({ID:2,cssClass:"dx-icon-taTelecommuting_HomeCal",cssClassText:"textActionCalendar",Content:i18nextko.i18n.t("roRequestTelecommutingHome"),Desc:h(),CurrentUsage:nt()})),s()==!0&&n.push({ID:6,cssClass:"dx-icon-taTelecommuting_Capacity",cssClassText:"textActionCalendar",Content:i18nextko.i18n.t("roRequestTelecommutingOfficeWho")})),(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&(VTPortal.roApp.empPermissions().Punch.ScheduleQuery||VTPortal.roApp.empPermissions().Punch.ProductiVQuery))&&n.push({ID:3,cssClass:"dx-icon-taPunches_DetailCal",cssClassText:"textActionCalendar",Content:i18nextko.i18n.t("roPunches_Detail")}),(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().CanCreateRequests)&&VTPortal.roApp.ReadMode()==!1&&n.push({ID:4,cssClass:"dx-icon-taNewRequest_DetailCal",cssClassText:"textActionCalendar",Content:i18nextko.i18n.t("roNewRequest_Detail")}),n.push({ID:5,cssClass:"dx-icon-taInformationCal",cssClassText:"textActionCalendar",Content:i18nextko.i18n.t("roInformationDay")}),w(new DevExpress.data.DataSource({store:n})),n}var d=VTPortal.noPermissions(),l=ko.observable(moment().startOf("month").toDate()),u=ko.observable({}),t=ko.observable(null),i=moment().toDate(),r=ko.observable(!1),v=ko.observable(!1),ft=ko.observable([]),f=ko.observable(""),a=ko.observable(0),o=ko.observable(0),s=ko.observable(!1),y=ko.observable(null),n=ko.observable(null),g=ko.computed(function(){return VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Schedule.QuerySchedule?!0:!1}),h=ko.computed(function(){return f()!=""&&s()==!0?i18nextko.i18n.t("roCurrentCapacity")+": "+f():""}),et=ko.observable(""),nt=ko.computed(function(){if(n()!=null)if(n().ByPercentage==!0)switch(n().Period){case 0:return i18nextko.i18n.t("tcPercentageUsedDayInfo")+" "+n().CurrentAgreementPercentageUsed+i18nextko.i18n.t("tcPercentageUsedDayInfo2")+" ("+i18nextko.i18n.t("tcPercentageUsed3")+n().MaxPercentage+"%/"+i18nextko.i18n.t("semana")+")";case 1:return i18nextko.i18n.t("tcPercentageUsedDayInfo")+" "+n().CurrentAgreementPercentageUsed+i18nextko.i18n.t("tcPercentageUsedDayInfo2")+" ("+i18nextko.i18n.t("tcPercentageUsed3")+n().MaxPercentage+"%/"+i18nextko.i18n.t("mes")+")";case 2:return i18nextko.i18n.t("tcPercentageUsedDayInfo")+" "+n().CurrentAgreementPercentageUsed+i18nextko.i18n.t("tcPercentageUsedDayInfo2")+" ("+i18nextko.i18n.t("tcPercentageUsed3")+n().MaxPercentage+"%/"+i18nextko.i18n.t("trimestre")+")"}else switch(n().Period){case 0:return i18nextko.i18n.t("tcDaysUsedDayInfo")+" "+n().CurrentAgreementDaysUsed+" "+i18nextko.i18n.t("tcDaysUsedDayInfo2")+" ("+i18nextko.i18n.t("tcPercentageUsed3")+n().MaxDays+"d/"+i18nextko.i18n.t("semana")+")";case 1:return i18nextko.i18n.t("tcDaysUsedDayInfo")+" "+n().CurrentAgreementDaysUsed+" "+i18nextko.i18n.t("tcDaysUsedDayInfo2")+" ("+i18nextko.i18n.t("tcPercentageUsed3")+n().MaxDays+"d/"+i18nextko.i18n.t("mes")+")";case 2:return i18nextko.i18n.t("tcDaysUsedDayInfo")+" "+n().CurrentAgreementDaysUsed+" "+i18nextko.i18n.t("tcDaysUsedDayInfo2")+" ("+i18nextko.i18n.t("tcPercentageUsed3")+n().MaxDays+"d/"+i18nextko.i18n.t("trimestre")+")"}else return""}),w=ko.observable(new DevExpress.data.DataSource({})),st=function(){new WebServiceRobotics(function(t){t.Status==window.VTPortalUtils.constants.OK.value?n(t):DevExpress.ui.notify(i18nextko.t("roTCError"),"warning",3e3)}).getTelecommutingInfo(moment(i))},ht=ko.computed(function(){return t()!=null&&t().MainShift!=null?t().MainShift.Name:""}),ct=ko.computed(function(){return t()!=null&&t().IncidenceData!=null&&typeof t().IncidenceData.NormalWork!="undefined"&&t().IncidenceData.NormalWork!=0?t().IncidenceData.NormalWork:0}),lt=ko.computed(function(){return t()!=null&&t().Alerts!=null?t().Alerts.OnAbsenceDays:!1}),at=ko.computed(function(){return t()!=null&&t().Alerts!=null?t().Alerts.OnAbsenceHours:!1}),vt=ko.computed(function(){return t()!=null&&t().Alerts!=null?t().Alerts.OnHolidays:!1}),b=ko.observable("#calendarContainer"),ut=function(n){if(n.fullName=="currentDate"&&moment(n.value).month()!=moment(n.previousValue).month()){l(moment(n.value).startOf("month").toDate());var t=u()[moment.tz(l(),VTPortal.roApp.serverTimeZone).add(12,"hours").format("YYYYMMDD")];(typeof t=="undefined"||t==null)&&e()}},k=function(t){i=t.value;b("#"+moment(t.value).format("YYYYMMDD"));VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Telecommuting&&VTPortal.roApp.userTelecommute()!=null&&VTPortal.roApp.userTelecommute().Telecommuting?new WebServiceRobotics(function(t){if(t.Status==window.VTPortalUtils.constants.OK.value)a(parseInt(t.capacities.CurrentSeating)),o(parseInt(t.capacities.MaxSeatingCapacity)),typeof t.capacities.ZoneCapacityVisible=="undefined"?s(!0):s(t.capacities.ZoneCapacityVisible),t.capacities.MaxSeatingCapacity>0?f(t.capacities.CurrentSeating+"/"+t.capacities.MaxSeatingCapacity):f(""),y(t.oCalendar),u()[moment(i).format("YYYYMMDD")].TelecommutingExpected==!0?$.when(c()).then(r(!0)):new WebServiceRobotics(function(t){t.Status==window.VTPortalUtils.constants.OK.value?(n(t),$.when(c()).then(r(!0))):$.when(c()).then(r(!0))}).getTelecommutingInfo(moment(i));else{a(0);o(0);y([]);var e=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(t,e)}},function(){}).getLoadSeatingCapacity(i):$.when(c()).then(r(!0))};return{onCellClicked:k,modelIsReady:v,initializeView:e,hasPermission:g,noPermissions:d,calendarOptions:{width:"100%",useCellTemplate:!0,height:450,cellTemplate:it,firstDayOfWeek:moment()._locale._week.dow,zoomLevel:"month",maxZoomLevel:"month",minZoomLevel:"month",onCellClick:k,onOptionChanged:ut,showTodayButton:!1},calendarCellPopover:{target:b,position:"top",width:300,shading:!0,shadingColor:"rgba(0, 0, 0, 0.5)",visible:r},dayToolbarActions:{dataSource:w,scrollingEnabled:!1,grouped:!1,itemTemplate:"actionItem",onItemClick:function(n){switch(n.itemData.ID){case 0:VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roTCFull"),"error",2e3);r(!1);break;case 1:r(!1);p(i,"home");break;case 2:r(!1);p(i,"office");break;case 3:r(!1);VTPortal.app.navigate("punchManagement/1/"+moment(i).format("YYYY-MM-DD"));break;case 4:r(!1);VTPortal.app.navigate("requestsList/5,6,7,8,9,11,13,14/"+moment(i).format("YYYY-MM-DD"));break;case 5:r(!1);VTPortal.app.navigate("dayInfo/"+moment(i).format("YYYY-MM-DD"));break;case 6:r(!1);VTPortal.app.navigate("capacityDetail/"+moment(i).format("YYYY-MM-DD"))}}},capacityInfo:f,lblCapacityInfo:h,loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.myAuthorizations=function(){function o(){h();u(!0);n()?$("#scrollview").height($("#panelsContent").height()-94):$("#scrollview").height($("#panelsContent").height()-70)}function h(){n(!1);var i=VTPortal.roApp.authorizationFilters(),r=function(n){var i,r,u,f,e;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=n.Requests,r=0;r<i.length;r++){i[r].Name=i18nextko.i18n.t("roRequestType_"+i[r].RequestType);i[r].hasAction=n.CanCreateRequest?!0:!1;u="";switch(i[r].Status){case 0:u="ro_Status_pending";i[r].StatusDesc=i18nextko.i18n.t("roRequestStatus_pending");break;case 1:u="ro_Status_ongoing";i[r].StatusDesc=i18nextko.i18n.t("roRequestStatus_running");break;case 2:u="ro_Status_accepted";i[r].StatusDesc=i18nextko.i18n.t("roRequestStatus_approved");break;case 3:u="ro_Status_denied";i[r].StatusDesc=i18nextko.i18n.t("roRequestStatus_denied");break;case 4:u="ro_Status_canceled";i[r].StatusDesc=i18nextko.i18n.t("roRequestStatus_canceled");i[r].hasAction=!1}f="";switch(i[r].IdRequestType){case 9:f="dx-icon-plannedCauses";break;case 14:f="dx-icon-plannedOvertime"}i[r].cssContainerClass=u;i[r].cssClass=f;$("#scrollview").height($("#panelsContent").height())}t(i)}else t([]),e=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,e)};i==null?(n(!1),new WebServiceRobotics(function(n){r(n)}).getMyRequests(!1,moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").add(1,"day"),"0*1*2*3*4|9*14","RequestDate DESC",moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").add(1,"year"))):(n(!0),new WebServiceRobotics(function(n){r(n)}).getMyRequests(!1,i.filter.iDate,i.filter.eDate,i.filter.status.join("*")+"|"+i.filter.types.join("*"),i.order.by+" "+i.order.direction,i.filter.iRequestedDate,i.filter.eRequestedDate))}var u=ko.observable(!1),t=ko.observable([]),i=ko.observable(!1),r=ko.observable("Images/Common/more.png"),f=VTPortal.noPermissions(),n=ko.observable(!1),e=ko.computed(function(){return VTPortal.roApp.authorizationFilters()!=null?i18nextko.i18n.t("roFilteringData"):""}),s=ko.computed(function(){var t,n;if(VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Requests!=null){for(t=!1,n=0;n<VTPortal.roApp.empPermissions().Requests.length;n++)if(VTPortal.roApp.empPermissions().Requests[n].Permission){t=!0;break}return t}return!1}),c=function(){i(!0);r("Images/Common/moreV.png")},l=function(){r("Images/Common/more.png")},a=function(){i(!1);r("Images/Common/more.png");VTPortal.app.navigate("RequestFilters/3")},v=function(){i(!1);VTPortal.app.navigate("requestsList/9,14/null")};return{modelIsReady:u,initializeView:o,hasPermission:s,noPermissions:f,requestsDS:t,dataFiltered:n,filterDescription:e,listRequests:{dataSource:t,scrollingEnabled:!1,grouped:!1,itemTemplate:"RequestItem",onItemClick:function(n){if(n.itemData.hasAction)switch(n.itemData.IdRequestType){case 9:VTPortal.app.navigate("plannedCause/"+n.itemData.Id);break;case 14:VTPortal.app.navigate("plannedOvertime/"+n.itemData.Id)}}},actionMenuPopover:{target:"#btnActionMenuPopover",position:"top",shading:!0,shadingColor:"rgba(0, 0, 0, 0.5)",visible:i,onHidden:l},showOptions:{onClick:c,text:"",icon:r},btnFilterRequests:{onClick:a,text:"",hint:i18nextko.i18n.t("roFilter"),icon:"Images/Common/filter.png"},btnNewRequests:{onClick:v,text:"",hint:i18nextko.i18n.t("roNew"),icon:"Images/Common/plus.png",visible:VTPortal.roApp.ReadMode()==!1},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.myAccruals=function(){function b(){r(moment().add(-1,"days").toDate());f();e(!0);d("shifts.permissiontype")}function v(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)n.Value.map(n=>n.DayType=i18nextko.i18n.t("conceptsSummary_"+n.DayType.toLowerCase())),o(n.Value);else{var t=function(){};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingSummaryHolidaysInfo"),"error",0,n)}).getConceptsDetailByShift(n)}function y(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)n.Value.map(n=>n.TransactionDate=moment(n.TransactionDate).toDate()),s(n.Value);else{var t=function(){};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingSummaryHolidaysInfo"),"error",0,n)}).getConceptsSummaryByShift(n)}var g=function(n,t){var i=t.targetOffset;i<0?l():i>0&&c()},p=VTPortal.noPermissions(),r=ko.observable(moment().add(-1,"days").toDate()),e=ko.observable(!1),t=ko.observable([]),n=ko.observable([]),i=ko.observable([]),o=ko.observable([]),s=ko.observable([]),u=ko.observable([]),h=ko.observable(null),w=ko.computed(function(){return VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&(VTPortal.roApp.empPermissions().Schedule.ScheduleAccruals||VTPortal.roApp.empPermissions().Schedule.ProductivAccruals)?!0:!1}),c=function(){r(moment(r()).subtract(1,"days"));f()},l=function(){r(moment(r()).add(1,"days"));f()},k=function(){VTPortal.app.navigate("requestsList/6,11,13,14/null")},f=function(){if(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Holidays)(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&(VTPortal.roApp.empPermissions().Schedule.ScheduleAccruals||VTPortal.roApp.empPermissions().Schedule.ProductivAccruals||VTPortal.roApp.empPermissions().Schedule.QuerySchedule))&&new WebServiceRobotics(function(r){var s,u,e,v,c,l,a,o,f,y;if(r.Status==window.VTPortalUtils.constants.OK.value){if(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Schedule.ScheduleAccruals){var e=[],h=[],u=r.ScheduleSummary;u.WeekAccruals.length>0&&(e=e.concat(VTPortalUtils.utils.generateAccrualsArray(u.WeekAccruals)));u.MonthAccruals.length>0&&(e=e.concat(VTPortalUtils.utils.generateAccrualsArray(u.MonthAccruals)));u.YearAccruals.length>0&&(e=e.concat(VTPortalUtils.utils.generateAccrualsArray(u.YearAccruals)));u.ContractAccruals.length>0&&(e=e.concat(VTPortalUtils.utils.generateAccrualsArray(u.ContractAccruals)));u.YearWorkAccruals.length>0&&(e=e.concat(VTPortalUtils.utils.generateAccrualsArray(u.YearWorkAccruals)));o=[];e.length==0&&h.length==0?n([]):(h.length>0&&o.push({key:"Daily",items:h.sortBy(function(n){return n.Name})}),e.length>0&&o.push({key:"Total",items:e.sortBy(function(n){return n.Name})}));n(o)}if(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Schedule.QuerySchedule){if(e=[],u=r.HolidaysSummary,u.HolidaysInfo.length>0)for(f=0;f<u.HolidaysInfo.length;f++)(u.HolidaysInfo[f].AccrualDefaultQuery==null||u.HolidaysInfo[f].AccrualDefaultQuery!="L")&&(u.HolidaysInfo[f].Type=u.HolidaysInfo[f].IDShift>0?"O":"H",s=[],u.HolidaysInfo[f].Type=="O"?s.push({valueField:"Done",name:i18nextko.i18n.t("roHolidayResume_Done")}):u.HolidaysInfo[f].Done>0&&s.push({valueField:"Done",name:i18nextko.i18n.t("roHolidayResume_Done")}),s.push({valueField:"Pending",name:i18nextko.i18n.t("roHolidayResume_Pending")}),s.push({valueField:"Lasting",name:i18nextko.i18n.t("roHolidayResume_Lasting")}),s.push({valueField:"Available",name:i18nextko.i18n.t("roHolidayResume_Available")}),s.push({valueField:"Prevision",name:i18nextko.i18n.t("roHolidayResume_Prevision")}),e.push({Name:u.HolidaysInfo[f].Name,Gauge:{dataSource:[{task:u.HolidaysInfo[f].Name,Done:u.HolidaysInfo[f].Done,Pending:u.HolidaysInfo[f].Pending,Lasting:u.HolidaysInfo[f].Lasting,Available:u.HolidaysInfo[f].Available,Prevision:u.HolidaysInfo[f].Prevision}],commonSeriesSettings:{argumentField:"task",type:"bar",label:{visible:!0,customizeText:VTPortalUtils.utils.convertHoursToTime(u.HolidaysInfo[f],!1)}},series:s,title:{text:u.HolidaysInfo[f].Name},legend:{verticalAlignment:"bottom",horizontalAlignment:"center"},argumentAxis:{label:{visible:!1}}}}));e.length>0?(o=[{key:"Vacaciones",items:e.sortBy(function(n){return n.Name})}],i(o)):i([])}if(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Schedule.ProductivAccruals)if(u=r.ProductiVSummary,e=[],u.YearAccruals.length>0){for(f=0;f<u.YearAccruals.length;f++)u.YearAccruals[f].MaxValue=u.YearAccruals[f].TaskValue,u.YearAccruals[f].Type="H",v=u.YearAccruals[f].TaskValue,c=0,$.grep(u.MonthAccruals,function(n){n.IdTask==u.YearAccruals[f].IdTask&&(c=n.TaskValue)}),l=0,$.grep(u.WeekAccruals,function(n){n.IdTask==u.YearAccruals[f].IdTask&&(l=n.TaskValue)}),a=0,$.grep(u.DailyAccruals,function(n){n.IdTask==u.YearAccruals[f].IdTask&&(a=n.TaskValue)}),e.push({Name:u.YearAccruals[f].TaskName,Gauge:{dataSource:[{task:u.YearAccruals[f].TaskName,year:v,month:c,week:l,day:a}],commonSeriesSettings:{argumentField:"task",type:"bar",label:{visible:!0,customizeText:VTPortalUtils.utils.convertHoursToTime(u.YearAccruals[f],!1)}},series:[{valueField:"year",name:i18nextko.i18n.t("roPeriod_year")},{valueField:"month",name:i18nextko.i18n.t("roPeriod_month")},{valueField:"week",name:i18nextko.i18n.t("roPeriod_week")},{valueField:"day",name:i18nextko.i18n.t("roPeriod_daily")}],title:{text:u.YearAccruals[f].TaskName,subtitle:{text:"tiempo en horas"}},legend:{verticalAlignment:"bottom",horizontalAlignment:"center"},argumentAxis:{label:{visible:!1}}}});o=[{key:"ProductiV",items:e.sortBy(function(n){return n.Name})}];t(o)}else t([]);if(n().length>0&&(t().length>0||i().length>0))for(f=0;f<n().length;f++)typeof $("#listSchedule").dxList("instance")!="undefined"&&$("#listSchedule").dxList("instance").collapseGroup(f);t().length>0&&(n().length>0||i().length>0)&&typeof $("#listProductiV").dxList("instance")!="undefined"&&$("#listProductiV").dxList("instance").collapseGroup(0);i().length>0&&(n().length>0||t().length>0)&&typeof $("#listHolidays").dxList("instance")!="undefined"&&$("#listHolidays").dxList("instance").collapseGroup(0);$("#scrollview").height($("#panelsContent").height())}else t([]),n([]),i([]),y=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(r,y)}).getAccrualsSummary(r());else{var u=function(){};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roIncorrectApiVersion"),"error",0,u)}},d=function(n){new WebServiceRobotics(function(n){var t,i;n.Status==window.VTPortalUtils.constants.OK.value?(t=[],t=t.add(n.SelectFields.clone()),t[0]?.FieldValue&&v(t[0].FieldValue),t[0]?.FieldValue&&y(t[0].FieldValue),u(t),t.length>0&&h(t[0].FieldValue)):(i=function(){},VTPortalUtils.utils.processErrorMessage(n,i))},function(){var n=function(){};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},a=function(n){var t=n.value;y(t);v(t)};return{modelIsReady:e,initializeView:b,hasPermission:w,noPermissions:p,headerDate:{value:r,pickerType:"rollers",displayFormat:"shortDate"},btnPrevious:{icon:"chevronprev",onClick:c},btnNext:{icon:"chevronnext",onClick:l},scheduleDS:n,productivDS:t,holidaysDS:i,listSchedule:{dataSource:n,scrollingEnabled:!1,grouped:!0,collapsibleGroups:!0,itemTemplate:"ScheduleItem",groupTemplate:function(){return $("<div>"+i18nextko.i18n.t("roResumeAccruals")+"<\/div>")}},listHolidays:{dataSource:i,scrollingEnabled:!1,grouped:!0,collapsibleGroups:!0,itemTemplate:"HolidaysItem",groupTemplate:function(){return $("<div>"+i18nextko.i18n.t("roResumeHolidays")+"<\/div>")}},listProductiV:{dataSource:t,scrollingEnabled:!1,grouped:!0,collapsibleGroups:!0,itemTemplate:"ProductiVItem",groupTemplate:function(){return $("<div>"+i18nextko.i18n.t("roResumeProductiV")+"<\/div>")}},newRequest:{onClick:k,text:"",icon:"Images/Common/plus.png",visible:VTPortal.roApp.ReadMode()==!1},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),summaryGrid:{dataSource:s,keyExpr:"ID",columns:[{caption:i18nextko.i18n.t("conceptsSummary_date"),dataField:"TransactionDate",sortOrder:"desc",minWidth:100},{caption:i18nextko.i18n.t("conceptsSummary_date"),dataField:"TransactionDateOrder",sortOrder:"desc",visible:!1},{caption:i18nextko.i18n.t("conceptsSummary_detail"),dataField:"Detail",minWidth:105},{caption:i18nextko.i18n.t("conceptsSummary_days"),dataField:"Days"},{caption:i18nextko.i18n.t("conceptsSummary_total"),dataField:"Total"}],showBorders:!0,sorting:{mode:"none"}},detailGrid:{dataSource:o,keyExpr:"ID",columns:[{caption:i18nextko.i18n.t("conceptsSummary_daytype"),dataField:"DayType"},{caption:i18nextko.i18n.t("conceptsSummary_numberofdays"),dataField:"NumberOfDays"}],showBorders:!0,sorting:{mode:"none"}},lblSummaryShift:i18nextko.t("roSelectSummaryShift"),cmbSummaryShiftDS:u,cmbSummaryShift:{dataSource:u,displayExpr:"FieldName",valueExpr:"FieldValue",value:h,onValueChanged:a,onload:a}}};VTPortal.dayInfo=function(n){function g(){v().viewShown();var t=moment(n.id,"YYYY-MM-DD");i(t.toDate())}function tt(n){var t=Math.floor(n/60),i=n%60;return t=t<10?"0"+t:t,i=i<10?"0"+i:i,t+":"+i}function ct(n,t){var i=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorDeleteProgrammedAbsence"),"error",0)},r=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDeleteProgrammedAbsenceSaved"),"success",2e3);else{var t=function(){};VTPortalUtils.utils.processRequestErrorMessage(n,t,function(){})}};c==null&&(c=new WebServiceRobotics(r,i));c.deleteProgrammedAbsence(n,t)}var p=i18nextko.i18n.t("roDayDetail"),i=ko.observable(new Date),t=ko.observable(null),e=ko.observable([{key:"forecasts",items:[]}]),r=ko.observable([{key:"forecasts",items:[]}]),u=ko.observable([{key:"forecasts",items:[]}]),o=ko.observable([]),f=null,s=ko.observable(!1),h=ko.observable(!1),l=function(){i(moment(i()).subtract(1,"days"))},a=function(){i(moment(i()).add(1,"days"))},w=function(n,t){var i=t.targetOffset;i<0?a():i>0&&l()},b=function(){var n,r;VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.CauseNote?(n=function(n){var i,r,u,f;if(n.Status==window.VTPortalUtils.constants.OK.value){for(n.DayInfo!=null&&n.DayInfo.DayData.length>0&&t(n.DayInfo.DayData[0]),i=n.Forecasts,r=0;r<i.length;r++){switch(i[r].ForecastType){case"days":i[r].cssClass="dx-icon-plannedAbsences";break;case"hours":i[r].cssClass="dx-icon-plannedCauses";break;case"holidayhours":i[r].cssClass="dx-icon-plannedHoliday";break;case"overtime":i[r].cssClass="dx-icon-plannedOvertime"}i[r].hasAction=i[r].HasDocuments;i[r].Description=typeof i[r].ForecastDetail!="undefined"&&i[r].ForecastDetail!=""&&i[r].ForecastDetail!=null?i18nextko.i18n.t("roLeavesFrom")+" "+moment(i[r].BeginDate).format("L")+" "+i18nextko.i18n.t("roLeavesCause")+" "+i[r].Cause+" ("+i[r].ForecastDetail+")":i18nextko.i18n.t("roLeavesFrom")+" "+moment(i[r].BeginDate).format("L")+" "+i18nextko.i18n.t("roLeavesCause")+" "+i[r].Cause;i[r].AlertDescription=i[r].DocAlerts!=null&&i[r].DocAlerts.length>0?i18nextko.i18n.t("roLeavesRequiereDocuments"):i18nextko.i18n.t("roLeavesNoAlerts")}u=[{key:"forecasts",items:i}];e(u);k(n);d()}else VTPortalUtils.utils.isOnView("dayInfo")&&(t(null),e([{key:"forecasts",items:[]}]),f=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.isOnView("dayInfo")&&VTPortalUtils.utils.processErrorMessage(n,f))},new WebServiceRobotics(function(t){n(t)}).getEmployeeDayInfo(i(),-1)):(r=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roIncorrectApiVersion"),"error",0,r))},k=function(n){var c=[],a=moment(),e=a.clone().startOf("day"),r,u,s,f,h,t;if(typeof n.DayInfo!="undefined"&&n.DayInfo!=null&&n.DayInfo.DayData.length>0&&n.DayInfo.DayData[0].MainShift!=null){if(r=n.DayInfo.DayData[0].MainShift,r.ShiftLayers==0)u=moment.tz(r.StartHour,VTPortal.roApp.serverTimeZone),s=moment.tz(r.EndHour,VTPortal.roApp.serverTimeZone),e=moment(u).endOf("day"),t=moment(u).diff(e,"minutes")-1,f=moment(s)>=moment(u)?moment(s).diff(moment(u),"minutes"):moment(s).add(1,"day").diff(moment(u),"minutes"),c.push({Name:"",Gauge:{scale:{startValue:t,endValue:t+f,tickInterval:60,label:{indentFromTick:-3,"true":!1,customizeText:VTPortalUtils.utils.convertShiftHourToTime(t+f)},tick:{color:"#536878"}},value:0,subvalues:[t,t+f],subvalueIndicator:{type:"textCloud",color:"#0046FE",text:{font:{size:12},customizeText:VTPortalUtils.utils.convertShiftHourToTime(t+f)}},rangeContainer:{offset:10,ranges:[{startValue:t,endValue:t+f,color:"#77DD77"}]}}});else for(h=0;h<r.ShiftLayers;h++){var i=r.ShiftLayersDefinition[h],v=moment.tz(moment(i.LayerStartTime),VTPortal.roApp.serverTimeZone),l=v.format("YYYYMMDDHHmmss");e=moment(l,"YYYYMMDDHHmmss").endOf("day");t=moment(l,"YYYYMMDDHHmmss").diff(e,"minutes")-1;c.push({Name:i18nextko.i18n.t("roLayer")+" "+i.LayerID,Gauge:{scale:{startValue:t,endValue:t+i.LayerDuration,tickInterval:60,label:{indentFromTick:-3,visible:!1,customizeText:VTPortalUtils.utils.convertShiftHourToTime(t+i.LayerDuration)},tick:{color:"#536878"}},value:0,subvalues:[t,t+i.LayerOrdinaryHours,t+i.LayerDuration],subvalueIndicator:{type:"textCloud",color:"#0046FE",text:{font:{size:12},customizeText:VTPortalUtils.utils.convertShiftHourToTime(t+r.PlannedHours)}},rangeContainer:{offset:10,ranges:[{startValue:t,endValue:t+i.LayerOrdinaryHours,color:"#77DD77"},{startValue:t+i.LayerOrdinaryHours,endValue:t+i.LayerDuration,color:"#ff0000"}]}}})}o([{key:"Franjas",items:c}])}else o([])},d=function(){if(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Holidays)(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&(VTPortal.roApp.empPermissions().Schedule.ScheduleAccruals||VTPortal.roApp.empPermissions().Schedule.ProductivAccruals))&&new WebServiceRobotics(function(n){var i,h,s,f,l;if(n.Status==window.VTPortalUtils.constants.OK.value){if(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Schedule.ScheduleAccruals){var t=[],e=[],o=[],c=n.ProductiVSummary;for(c.DailyAccruals.length>0&&(o=o.concat(VTPortalUtils.utils.generateAccrualsArrayProductiv(c.DailyAccruals))),i=n.ScheduleSummary,i.DailyAccruals.length>0&&(e=e.concat(VTPortalUtils.utils.generateAccrualsArray(i.DailyAccruals))),i.WeekAccruals.length>0&&(t=t.concat(VTPortalUtils.utils.generateAccrualsArray(i.WeekAccruals))),i.MonthAccruals.length>0&&(t=t.concat(VTPortalUtils.utils.generateAccrualsArray(i.MonthAccruals))),i.YearAccruals.length>0&&(t=t.concat(VTPortalUtils.utils.generateAccrualsArray(i.YearAccruals))),i.ContractAccruals.length>0&&(t=t.concat(VTPortalUtils.utils.generateAccrualsArray(i.ContractAccruals))),i.YearWorkAccruals&&i.YearWorkAccruals.length>0&&(t=t.concat(VTPortalUtils.utils.generateAccrualsArray(i.YearWorkAccruals))),f=0;f<t.length;f++)t[f].Name=t[f].Name+" "+(t[f].YearWorkPeriod||"");h=[];s=[];o.length==0?h.push({key:"forecasts",items:[]}):o.length>0&&h.push({key:"Daily",items:o.sortBy(function(n){return n.Name})});t.length==0&&e.length==0?s.push({key:"forecasts",items:[]}):(e.length>0&&s.push({key:"Daily",items:e.sortBy(function(n){return n.Name})}),t.length>0&&s.push({key:"Total",items:t.sortBy(function(n){return n.Name})}));u(h);r(s)}if(r()[0].items.length>0)for(f=0;f<r().length;f++)typeof $("#listSchedule").dxList("instance")!="undefined"&&$("#listSchedule").dxList("instance").collapseGroup(f);if(u()[0].items.length>0)for(f=0;f<u().length;f++)typeof $("#listProductiv").dxList("instance")!="undefined"&&$("#listProductiv").dxList("instance").collapseGroup(f);$("#scrollview").height($("#panelsContent").height()-70)}else VTPortalUtils.utils.isOnView("dayInfo")&&(r(ko.observable([{key:"forecasts",items:[]}])),u(ko.observable([{key:"forecasts",items:[]}])),l=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,l))}).getAccrualsSummary(i());else{var n=function(){};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roIncorrectApiVersion"),"error",0,n)}},v=ko.observable(VTPortal.bigUserInfo()),nt=ko.computed(function(){return t()!=null&&t().MainShift!=null?t().MainShift.Name:""}),it=ko.computed(function(){return t()!=null&&t().MainShift!=null?i18nextko.i18n.t("roPlannedLbl")+": "+tt(t().MainShift.PlannedHours):""}),y=ko.computed(function(){return t()!=null&&t().IncidenceData!=null&&typeof t().IncidenceData.NormalWork!="undefined"&&t().IncidenceData.NormalWork!=0?t().IncidenceData.NormalWork:0}),rt=ko.computed(function(){return t()!=null&&t().Alerts!=null?t().Alerts.OnAbsenceDays:!1}),ut=ko.computed(function(){return t()!=null&&t().Alerts!=null?t().Alerts.OnAbsenceHours:!1}),ft=ko.computed(function(){return t()!=null&&t().Alerts!=null?t().Alerts.OnHolidaysHours:!1}),et=ko.computed(function(){return t()!=null&&t().Alerts!=null?t().Alerts.OnOvertimesHours:!1}),ot=ko.computed(function(){return t()!=null&&t().Alerts!=null?t().Alerts.OnHolidays:!1}),st=function(){VTPortal.app.navigate("sendLeaveDocument/-1/"+f.itemData.ForecastID+"/"+f.itemData.IdCause+"/"+f.itemData.ForecastType)},ht=function(){ct(f.itemData.ForecastID,f.itemData.ForecastType)},c=null;return{viewShown:g,title:p,subscribeBlock:v(),forecastsDS:e,listForecasts:{dataSource:e,scrollingEnabled:!1,grouped:!0,collapsibleGroups:!1,itemTemplate:"ForecastItem",groupTemplate:function(){return $("<div>"+i18nextko.i18n.t("roDailyForecasts")+"<\/div>")},onItemClick:function(n){f=n;n.itemData.hasAction?s(!0):s(!1);VTPortal.roApp.empPermissions().Forecast==!0?h(!0):h(!1)}},headerDate:{value:i,pickerType:"rollers",displayFormat:"shortDate",onValueChanged:b},btnPrevious:{icon:"chevronprev",onClick:l},btnNext:{icon:"chevronnext",onClick:a},myEventHandler:w,lblShift:i18nextko.t("roShiftLbl"),lblAccrual:i18nextko.t("roAccrualLbl"),txtDayShift:{placeholder:i18nextko.t("roShiftLbl"),value:nt,readOnly:!0},txtPlannedHours:{placeholder:i18nextko.t("roPlannedLbl"),value:it,readOnly:!0},remarkValue:y,txtRemarkValue:{placeholder:i18nextko.t("roAccrualLbl"),value:y,readOnly:!0},onHolidays:ot,onPlannedAbsence:rt,onPlannedCause:ut,onPlannedHoliday:ft,onPlannedOvertime:et,scheduleDS:r,productivDS:u,listSchedule:{dataSource:r,scrollingEnabled:!1,grouped:!0,collapsibleGroups:!0,itemTemplate:"ScheduleItem",groupTemplate:function(n){return $("<div>"+i18nextko.i18n.t("roResumeAccruals_"+n.key)+"<\/div>")}},listProductiv:{dataSource:u,scrollingEnabled:!1,grouped:!0,collapsibleGroups:!0,itemTemplate:"ScheduleItem",groupTemplate:function(n){return $("<div>"+i18nextko.i18n.t("roPResumeAccruals_"+n.key)+"<\/div>")}},listShiftLayer:{dataSource:o,scrollingEnabled:!1,grouped:!0,collapsibleGroups:!0,itemTemplate:"ScheduleItem",groupTemplate:function(n){return $("<div>"+i18nextko.i18n.t("roResumeAccruals_"+n.key)+"<\/div>")}},btnDeleteRequest:{visible:h,onClick:ht,text:"",icon:"Images/Common/delete.png"},btnEditRequest:{visible:s,onClick:st,text:"",icon:"Images/Common/plus.png"}}};VTPortal.capacityDetail=function(n){function o(){r().viewShown();var t=moment(n.id,"YYYY-MM-DD");f(i18nextko.i18n.t("rocapacityDetail")+" "+n.id);u(t.toDate());i(!0);VTPortal.roApp.loggedIn?e():(i(!1),VTPortalUtils.utils.loginIfNecessary("",e))}var t=ko.observable(new DevExpress.data.DataSource({store:VTPortal.roApp.capacityEmployees,searchOperation:"contains",searchExpr:["Name","Group"]})),r=ko.observable(VTPortal.bigUserInfo()),i=ko.observable(!1),u=ko.observable(new Date),f=ko.observable(""),e=function(){new WebServiceRobotics(function(n){var r,u;if(i(!1),n.Status==window.VTPortalUtils.constants.OK.value){for(r=n.Employees,u=0;u<r.length;u++)r[u].Image==""&&(r[u].Image=n.DefaultImage);VTPortal.roApp.capacityEmployees=n.Employees;t(new DevExpress.data.DataSource({store:r,searchOperation:"contains",searchExpr:["Name","Group"]}))}else VTPortalUtils.utils.processErrorMessage(n)}).getCapacityDetail(u())};return{viewShown:o,title:f,subscribeBlock:r(),listOptions:{dataSource:t,grouped:!1,indicateLoading:!1,pageLoadMode:"nextButton",height:"90%",itemTemplate:"item"},searchOptions:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(n){t().searchValue(n.value);t().load()}},loadingPanel:{showPane:!1,height:110,shading:!0,shadingColor:"rgba(255,255,255,0.5)",indicatorSrc:"Images/DoubleRing.gif",visible:i}}};VTPortal.telecommuting=function(n){function et(){f(!0);ut()}function ot(){e().viewShown();et()}var e=ko.observable(VTPortal.bigUserInfo()),st=ko.observable(moment().add(-1,"days").toDate()),r=ko.observable(null),i=ko.observable(),ht=ko.observable([]),u=ko.observable(!1),l=ko.observable(0),a=ko.observable(0),v=ko.observable(0),o=ko.observable(!1),y=ko.observable(!1),s=ko.observable(!1),p=ko.observable(!1),ct=ko.observable(""),h=VTPortal.approvalHistory(),w=ko.observable(!1),c=ko.observable(!1),f=ko.observable(!1),t=ko.observable(null),b=ko.observable(new DevExpress.data.DataSource({store:[]})),lt=ko.computed(function(){return"76%"});typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&r(parseInt(n.id,10));var k=ko.computed(function(){return t()!=null?"(<b>"+t().TelecommutePlannedHours+" <\/b>"+i18nextko.i18n.t("tcTelecommutePlannedHours1")+" "+i18nextko.i18n.t("tcTelecommutePlannedHours2")+"<b> "+t().TotalWorkingPlannedHours+"<\/b>)":""}),d=ko.computed(function(){if(t()!=null)if(t().ByPercentage==!0)switch(t().Period){case 0:return i18nextko.i18n.t("tcPeriodStart")+"<b> "+moment(t().PeriodStart).format("DD/MM/YYYY")+" "+i18nextko.i18n.t("tcPeriodAnd")+" "+moment(t().PeriodEnd).format("DD/MM/YYYY")+"<\/b> "+i18nextko.i18n.t("tcMaxInPeriod")+" <b>"+t().MaxPercentage+"%/"+i18nextko.i18n.t("semana")+" <\/b> "+i18nextko.i18n.t("tcMaxInPeriod2");case 1:return i18nextko.i18n.t("tcPeriodStart")+"<b> "+moment(t().PeriodStart).format("DD/MM/YYYY")+" "+i18nextko.i18n.t("tcPeriodAnd")+" "+moment(t().PeriodEnd).format("DD/MM/YYYY")+"<\/b> "+i18nextko.i18n.t("tcMaxInPeriod")+" <b>"+t().MaxPercentage+"%/"+i18nextko.i18n.t("mes")+" <\/b> "+i18nextko.i18n.t("tcMaxInPeriod2");case 2:return i18nextko.i18n.t("tcPeriodStart")+"<b> "+moment(t().PeriodStart).format("DD/MM/YYYY")+" "+i18nextko.i18n.t("tcPeriodAnd")+" "+moment(t().PeriodEnd).format("DD/MM/YYYY")+"<\/b> "+i18nextko.i18n.t("tcMaxInPeriod")+" <b>"+t().MaxPercentage+"%/"+i18nextko.i18n.t("trimestre")+" <\/b> "+i18nextko.i18n.t("tcMaxInPeriod2")}else switch(t().Period){case 0:return i18nextko.i18n.t("tcPeriodStart")+"<b> "+moment(t().PeriodStart).format("DD/MM/YYYY")+" "+i18nextko.i18n.t("tcPeriodAnd")+" "+moment(t().PeriodEnd).format("DD/MM/YYYY")+"<\/b> "+i18nextko.i18n.t("tcMaxInPeriod")+" <b>"+t().MaxDays+"d/"+i18nextko.i18n.t("semana")+" <\/b> "+i18nextko.i18n.t("tcMaxInPeriod2");case 1:return i18nextko.i18n.t("tcPeriodStart")+"<b> "+moment(t().PeriodStart).format("DD/MM/YYYY")+" "+i18nextko.i18n.t("tcPeriodAnd")+" "+moment(t().PeriodEnd).format("DD/MM/YYYY")+"<\/b> "+i18nextko.i18n.t("tcMaxInPeriod")+" <b>"+t().MaxDays+"d/"+i18nextko.i18n.t("mes")+" <\/b> "+i18nextko.i18n.t("tcMaxInPeriod2");case 2:return i18nextko.i18n.t("tcPeriodStart")+"<b> "+moment(t().PeriodStart).format("DD/MM/YYYY")+" "+i18nextko.i18n.t("tcPeriodAnd")+" "+moment(t().PeriodEnd).format("DD/MM/YYYY")+"<\/b> "+i18nextko.i18n.t("tcMaxInPeriod")+" <b>"+t().MaxDays+"d/"+i18nextko.i18n.t("trimestre")+" <\/b> "+i18nextko.i18n.t("tcMaxInPeriod2")}else return""}),g=ko.computed(function(){return t()!=null?t().ByPercentage==!0?i18nextko.i18n.t("tcPercentageUsedRequest")+"<b> "+t().CurrentAgreementPercentageUsed+"<\/b>"+i18nextko.i18n.t("tcPercentageUsedRequest2")+" (<b>"+t().TelecommutePlannedHours+" <\/b>"+i18nextko.i18n.t("tcTelecommutePlannedHours1")+" "+i18nextko.i18n.t("tcTelecommutePlannedHours2")+"<b> "+t().TotalWorkingPlannedHours+"<\/b>)":i18nextko.i18n.t("tcDaysUsedRequest")+"<b> "+t().CurrentAgreementDaysUsed+"<\/b> "+i18nextko.i18n.t("tcDaysUsedRequest2")+" (<b>"+t().TelecommutePlannedHours+" <\/b>"+i18nextko.i18n.t("tcTelecommutePlannedHours1")+" "+i18nextko.i18n.t("tcTelecommutePlannedHours2")+"<b> "+t().TotalWorkingPlannedHours+"<\/b>)":""}),nt=ko.computed(function(){if(typeof i()!="undefined")return i().EmployeeName;""}),tt=ko.computed(function(){if(typeof i()!="undefined")return i().RequestInfo;""}),it=ko.computed(function(){if(typeof i()!="undefined")return i().EmployeeGroup;""}),rt=function(n,i){new WebServiceRobotics(function(n){n.Status==window.VTPortalUtils.constants.OK.value?t(n):DevExpress.ui.notify(i18nextko.t("roTCError"),"warning",3e3)}).getTelecommutingInfo(moment(n),i)},ut=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)rt(n.Date1,n.IdEmployee),f(!1),c(!0),i(n),o(!0),u(!1),(n.ReqStatus==0||n.ReqStatus==1)&&u(!0),h.refreshApprovals(n.RequestsHistoryEntries);else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequestForSupervisor(r())},ft=ko.computed(function(){return typeof i()!="undefined"?i().EmployeeImage!=""?"url(data:image/png;base64,"+i().EmployeeImage+")":"url(Images/logovtl.ico)":""});return{viewShown:ot,title:i18nextko.i18n.t("roRequestType_PlannedAbsences"),subscribeBlock:e(),empImage:ft,lblEmployee:nt,lblRequestDates:tt,tcCurrentPercentage:g,tcPeriodStart:d,tcTelecommutePlannedHours:k,lblAccruals:i18nextko.i18n.t("roMyAccrualsHint"),lblAvailable:l,lblPending:a,lblApproved:v,lblDetails:i18nextko.i18n.t("lblDetails"),lblApprovedText:i18nextko.i18n.t("lblApprovedText"),lblPendingText:i18nextko.i18n.t("lblPendingText"),lblAvailableText:i18nextko.i18n.t("lblAvailableText"),lblRequestedDays:i18nextko.i18n.t("lblRequestedDays"),lblLoading:i18nextko.i18n.t("lblLoading"),lblGroupName:it,myApprovalsBlock:h,popupVisible:s,popupRequestDaysVisible:p,accrualsDivVisible:y,infoDivVisible:o,requestMainDivVisible:c,loadingDivVisible:f,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),scrollContent:{},listRequestDays:{dataSource:b,scrollingEnabled:!0,grouped:!1,height:300,itemTemplate:"RequestItem"},btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequestNew(r(),i().RequestType,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:u},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequestNew(r(),i().RequestType,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:u},btnHistory:{onClick:function(){s(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:w}}};VTPortal.forgotten=function(n){function ft(){o(!0);it()}function et(){s().viewShown();ft()}var s=ko.observable(VTPortal.bigUserInfo()),i=ko.observable([]),ot=ko.observable(new Date),st=ko.computed(function(){return VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().TaskTitle.length<=50?i18nextko.i18n.t("inTask")+VTPortal.roApp.userStatus().TaskTitle:i18nextko.i18n.t("inTask")+VTPortal.roApp.userStatus().TaskTitle.substr(0,48)+"...":""}),h=ko.computed(function(){return i18nextko.i18n.t("noPunches")}),r=ko.observable(null),t=ko.observable(),ht=ko.observable([]),u=ko.observable(!1),y=ko.observable(0),p=ko.observable(0),w=ko.observable(0),b=ko.observable(!1),c=ko.observable(!1),l=ko.observable(""),f=ko.observable(!1),e=ko.observable(!1),a=VTPortal.approvalHistory(),k=ko.observable(!1),v=ko.observable(!1),o=ko.observable(!1),ct=ko.observable(new DevExpress.data.DataSource({store:[]})),lt=ko.computed(function(){return"76%"});typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&r(parseInt(n.id,10));var d=ko.computed(function(){if(typeof t()!="undefined")return t().RequestInfo;""}),g=ko.computed(function(){if(typeof t()!="undefined")return t().EmployeeName;""}),nt=ko.computed(function(){if(typeof t()!="undefined")return t().RequestInfo;""}),tt=ko.computed(function(){if(typeof t()!="undefined")return t().EmployeeGroup;""}),it=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)o(!1),v(!0),t(n),rt(),u(!1),(n.ReqStatus==0||n.ReqStatus==1)&&u(!0),n.Comments!=""?(f(!0),l(n.Comments)):f(!1),a.refreshApprovals(n.RequestsHistoryEntries);else{var i=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,i)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequestForSupervisor(r())},rt=function(){new WebServiceRobotics(function(n){var t,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(e(!0),t=n.Punches,r=0;r<t.length;r++){switch(t[r].Type){case 1:case 2:case 3:case 7:t[r].TypeData!=null&&t[r].TypeData>0?t[r].ActualType==1?typeof t[r].InTelecommute!="undefined"&&t[r].InTelecommute.toLowerCase()=="true"?(t[r].cssClass="dx-icon-TATC_in",t[r].Name=i18nextko.i18n.t("roEntry")+": "+moment.tz(t[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")):(t[r].cssClass="dx-icon-TA_in_cause",t[r].Name=i18nextko.i18n.t("roPunches_TA_in_causeHome")+": "+moment.tz(t[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")):(t[r].cssClass="dx-icon-TA_out_cause",t[r].Name=i18nextko.i18n.t("roPunches_TA_out_causeHome")+": "+moment.tz(t[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")):t[r].ActualType==1?typeof t[r].InTelecommute!="undefined"&&t[r].InTelecommute.toLowerCase()=="true"?(t[r].cssClass="dx-icon-TATC_in",t[r].Name=i18nextko.i18n.t("roEntry")+": "+moment.tz(t[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")):(t[r].cssClass="dx-icon-TA_in",t[r].Name=i18nextko.i18n.t("roEntry")+": "+moment.tz(t[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")):(t[r].cssClass="dx-icon-TA_out",t[r].Name=i18nextko.i18n.t("roExit")+": "+moment.tz(t[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm"));t[r].hasAction=!0;break;case 4:t[r].cssClass="dx-icon-Task_change";t[r].hasAction=!1;t[r].Name=i18nextko.i18n.t("roPunches_Task_changeHome")+": "+moment.tz(t[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm");break;case 13:t[r].cssClass="dx-icon-CostCenter";t[r].hasAction=!1;t[r].Name=i18nextko.i18n.t("roPunches_CostCenter")+": "+moment.tz(t[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")}t[r].Value=t[r].RequestedTypeData!=""?i18nextko.i18n.t("roRequestPendingApprove")+t[r].RequestedTypeData:t[r].RelatedInfo}i(t)}else e(!1),i([])}).getPunchesOnDate(t().IdEmployee,t().Date1)},ut=ko.computed(function(){return typeof t()!="undefined"?t().EmployeeImage!=""?"url(data:image/png;base64,"+t().EmployeeImage+")":"url(Images/logovtl.ico)":""});return{viewShown:et,title:i18nextko.i18n.t("roRequestType_ForbiddenPunch"),subscribeBlock:s(),empImage:ut,lblEmployee:g,detailsVisible:function(){popupRequestDaysVisible(!0)},lblRequestDates:nt,lblOverlays:i18nextko.i18n.t("lblOverlays"),lblAccruals:i18nextko.i18n.t("roMyAccrualsHint"),lblNoOverlays:i18nextko.i18n.t("lblNoOverlays"),lblAvailable:y,lblPending:p,lblApproved:w,noPunches:h,lblRemarks:i18nextko.i18n.t("lblRemarks"),lblApprovedText:i18nextko.i18n.t("lblApprovedText"),lblPendingText:i18nextko.i18n.t("lblPendingText"),lblAvailableText:i18nextko.i18n.t("lblAvailableText"),lblRequestedDays:i18nextko.i18n.t("lblRequestedDays"),lblCurrentPunches:i18nextko.i18n.t("lblCurrentPunches"),lblLoading:i18nextko.i18n.t("lblLoading"),lblGroupName:tt,remarks:l,lblPunchInfo:d,myApprovalsBlock:a,popupVisible:c,infoDivVisible:b,remarksDivVisible:f,currentPunchesDivVisible:e,requestMainDivVisible:v,loadingDivVisible:o,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),punchesDS:i,noPunches:h,listCurrentPunches:{dataSource:i,scrollingEnabled:!0,grouped:!1},scrollContent:{},btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequestNew(r(),t().RequestType,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:u},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequestNew(r(),t().RequestType,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:u},btnHistory:{onClick:function(){c(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:k}}};VTPortal.dailyRecordDetail=function(params){function convertMinsToHrsMins(n){var t=Math.floor(n/60),i=n%60;return t=t<10?"0"+t:t,i=i<10?"0"+i:i,t+":"+i}function deleteRequest(){requestId()!=null&&requestId()>0&&VTPortalUtils.utils.deleteRequest(requestId(),17)}function refreshData(){loadingDivVisible(!0);loadRequest()}function viewShown(){globalStatus().viewShown();var n=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value){var t=n.ListZones;VTPortal.roApp.zonesDS(t);VTPortal.roApp.zonesDataSource(new DevExpress.data.DataSource({store:VTPortal.roApp.zonesDS(),searchOperation:"contains",searchExpr:"Name"}))}};VTPortal.roApp.zonesDS()==null&&new WebServiceRobotics(function(t){n(t)}).getZones();tcTypesDS([{FieldName:i18nextko.i18n.t("roOffice"),FieldValue:"0"},{FieldName:i18nextko.i18n.t("roHome"),FieldValue:"1"}]);fromNavigation()=="FR"&&requestId()!=null&&requestId()>0&&VTPortalUtils.utils.markRequestAsRead(requestId());refreshData()}var globalStatus=ko.observable(VTPortal.bigUserInfo()),punchesDS=ko.observable([]),popupDayInfoVisible=ko.observable(!1),selectedDate=ko.observable(new Date),canDelete=ko.observable(!1),forecastsDS=ko.observable([{key:"forecasts",items:[]}]),requestId=ko.observable(null),dayInfo=ko.observable(null),request=ko.observable(),viewActions=ko.observable(!1),tcInfo1=ko.observable(!1),tcInfo2=ko.observable(!1),tcInfo3=ko.observable(!1),tcInfo4=ko.observable(!1),tcInfo5=ko.observable(!1),zInfo1=ko.observable(!1),zInfo2=ko.observable(!1),zInfo3=ko.observable(!1),zInfo4=ko.observable(!1),zInfo5=ko.observable(!1),iDate1=ko.observable(""),iDate2=ko.observable(""),iDate3=ko.observable(""),iDate4=ko.observable(""),iDate5=ko.observable(""),eDate1=ko.observable(""),eDate2=ko.observable(""),eDate3=ko.observable(""),eDate4=ko.observable(""),eDate5=ko.observable(""),tcTypeValue1=ko.observable(null),zoneValue1=ko.observable(null),tcTypeValue2=ko.observable(null),zoneValue2=ko.observable(null),tcTypeValue3=ko.observable(null),zoneValue3=ko.observable(null),tcTypeValue4=ko.observable(null),zoneValue4=ko.observable(null),tcTypeValue5=ko.observable(null),zoneValue5=ko.observable(null),block1Visible=ko.observable(!1),block2Visible=ko.observable(!1),block3Visible=ko.observable(!1),block4Visible=ko.observable(!1),block5Visible=ko.observable(!1),blocksVisible=ko.observable(!1),punchesVisible=ko.observable(!1),hasDesajustes=ko.observable(!1),notAdjustedVisible=ko.observable(!1),dailyRecordModified=ko.observable(!1),tcTypesDS=ko.observable([]),lblAvailable=ko.observable(0),shiftLayersDS=ko.observable([]),scheduleDS=ko.observable([{key:"forecasts",items:[]}]),lblPending=ko.observable(0),lblApproved=ko.observable(0),lblNotAdjusted=ko.observable(""),infoDivVisible=ko.observable(!1),popupVisible=ko.observable(!1),myApprovalsBlock=VTPortal.approvalHistory(),viewHistory=ko.observable(!1),requestMainDivVisible=ko.observable(!1),loadingDivVisible=ko.observable(!1),fromNavigation=ko.observable(""),shiftName,refreshShiftLayers;typeof params.id!="undefined"&&parseInt(params.id,10)!=-1&&requestId(parseInt(params.id,10));typeof params.objId!="undefined"&&fromNavigation(params.objId);var lblPunchInfo=ko.computed(function(){if(typeof request()!="undefined")return request().RequestInfo;""}),lblEmployee=ko.computed(function(){if(typeof request()!="undefined")return request().EmployeeName;""}),lblRequestDates=ko.computed(function(){if(typeof request()!="undefined")return request().RequestInfo;""}),lblGroupName=ko.computed(function(){if(typeof request()!="undefined")return request().EmployeeGroup;""}),plannedHours=ko.computed(function(){return dayInfo()!=null&&dayInfo().MainShift!=null?i18nextko.i18n.t("roPlannedLbl")+": "+convertMinsToHrsMins(dayInfo().MainShift.PlannedHours):""}),setClockValues=function(punchesQuantity){for(var inicio,final,pairs=punchesQuantity/2,i=0;i<pairs;i++)eval("block"+(i+1)+"Visible(true)"),inicio=moment.tz(moment(punchesDS()[i*2].DateTime),VTPortal.roApp.serverTimeZone),final=moment.tz(moment(punchesDS()[i*2+1].DateTime),VTPortal.roApp.serverTimeZone),$("#timeBeginDailyRecord"+(i+1)).dxTextBox({value:inicio.format("HH:mm"),displayFormat:"HH:mm"}).dxTextBox("instance").option("value",inicio.format("HH:mm")),$("#timeEndDailyRecord"+(i+1)).dxTextBox({value:final.format("HH:mm"),displayFormat:"hh:mm"}).dxTextBox("instance").option("value",final.format("HH:mm")),punchesDS()[i*2].InTelecommute&&(eval("tcInfo"+(i+1)+"(true)"),$("#tcType"+(i+1)).dxSelectBox("instance").option("value","1")),punchesDS()[i*2].IDZone!=0&&punchesDS()[i*2].IDZone!=255&&(eval("zInfo"+(i+1)+"(true)"),$("#tcZone"+(i+1)).dxSelectBox("instance").option("value",punchesDS()[i*2].IDZone))},loadRequest=function(){VTPortal.roApp.db.settings.supervisorPortalEnabled&&fromNavigation()=="FR"?new WebServiceRobotics(function(n){var t,i;n.Item2.Status==window.VTPortalUtils.constants.OK.value?(loadingDivVisible(!1),requestMainDivVisible(!0),request(n.Item2),viewActions(!1),(n.Item2.ReqStatus==0||n.Item2.ReqStatus==1)&&viewActions(!0),punchesDS(n.Item1.Punches),n.Item1.Modified||!n.Item1.Adjusted?hasDesajustes(!0):hasDesajustes(!1),n.Item1.Modified?(dailyRecordModified(!0),blocksVisible(!1),punchesVisible(!0),getPunches(n.Item1.Punches)):(blocksVisible(!0),punchesVisible(!1),setClockValues(punchesDS().length)),n.Item1.Adjusted?notAdjustedVisible(!1):(notAdjustedVisible(!0),t=n.Item1.TimeExpected-n.Item1.TimeAccrued,t<=0?Math.abs(t)<120?lblNotAdjusted(i18nextko.i18n.t("roAdjustedExceeded")+" "+convertMinsToHrsMins(Math.abs(t))+" "+i18nextko.i18n.t("roExceededHoursDROne")):lblNotAdjusted(i18nextko.i18n.t("roAdjustedExceeded")+" "+convertMinsToHrsMins(Math.abs(t))+" "+i18nextko.i18n.t("roExceededHoursDR")):Math.abs(t)<120?lblNotAdjusted(i18nextko.i18n.t("roAdjustedMissingOne")+" "+convertMinsToHrsMins(Math.abs(t))+" "+i18nextko.i18n.t("roExceededHoursDROne")):lblNotAdjusted(i18nextko.i18n.t("roAdjustedMissing")+" "+convertMinsToHrsMins(Math.abs(t))+" "+i18nextko.i18n.t("roExceededHoursDR"))),myApprovalsBlock.refreshApprovals(n.Item2.RequestsHistoryEntries)):(i=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,i))},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getDailyRecordRequestForSupervisor(requestId()):new WebServiceRobotics(function(n){if(n.Item2==window.VTPortalUtils.constants.OK.value)loadingDivVisible(!1),requestMainDivVisible(!0),request(n.Item1),punchesDS(n.Item1.Punches),n.Item3.ReqStatus==0?canDelete(!0):canDelete(!1),n.Item1.Modified?(hasDesajustes(!1),dailyRecordModified(!0),blocksVisible(!1),punchesVisible(!0),getPunches(n.Item1.Punches)):(hasDesajustes(!1),blocksVisible(!0),punchesVisible(!1),setClockValues(punchesDS().length)),viewActions(!1);else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getDailyRecord(requestId())},getPunches=function(n){for(var t=0;t<n.length;t++){n[t].CauseName!="NO JUSTIFICADO"&&n[t].CauseName!=""&&(n[t].Value=i18nextko.i18n.t("roCause")+": "+n[t].CauseName);n[t].ZoneName!=""&&n[t].IDZone!=255&&(n[t].Zone=i18nextko.i18n.t("roZone")+": "+n[t].ZoneName);n[t].InTelecommute==!0&&(n[t].TC=i18nextko.i18n.t("roRequestTypeLbl")+": "+i18nextko.i18n.t("roHome"));switch(n[t].Type){case 1:n[t].cssClass="dx-icon-TA_in";n[t].Name=i18nextko.i18n.t("roEntry")+": "+moment.tz(n[t].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm");break;case 2:n[t].cssClass="dx-icon-TA_out";n[t].Name=i18nextko.i18n.t("roExit")+": "+moment.tz(n[t].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm");n[t].TC=""}}punchesDS(n)},employeeImage=ko.computed(function(){return typeof request()!="undefined"?request().EmployeeImage!=""?"url(data:image/png;base64,"+request().EmployeeImage+")":"url(Images/logovtl.ico)":""}),refreshDayData=function(){var n,t;VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.CauseNote?(n=function(n){var t,i,r,u;if(n.Status==window.VTPortalUtils.constants.OK.value){for(n.DayInfo!=null&&n.DayInfo.DayData.length>0&&dayInfo(n.DayInfo.DayData[0]),t=n.Forecasts,i=0;i<t.length;i++){switch(t[i].ForecastType){case"days":t[i].cssClass="dx-icon-plannedAbsences";break;case"hours":t[i].cssClass="dx-icon-plannedCauses";break;case"holidayhours":t[i].cssClass="dx-icon-plannedHoliday";break;case"overtime":t[i].cssClass="dx-icon-plannedOvertime"}t[i].Description=typeof t[i].ForecastDetail!="undefined"&&t[i].ForecastDetail!=""&&t[i].ForecastDetail!=null?i18nextko.i18n.t("roLeavesFrom")+" "+moment(t[i].BeginDate).format("L")+" "+i18nextko.i18n.t("roLeavesCause")+" "+t[i].Cause+" ("+t[i].ForecastDetail+")":i18nextko.i18n.t("roLeavesFrom")+" "+moment(t[i].BeginDate).format("L")+" "+i18nextko.i18n.t("roLeavesCause")+" "+t[i].Cause}r=[{key:"forecasts",items:t}];forecastsDS(r);refreshShiftLayers(n)}else dayInfo(null),forecastsDS([{key:"forecasts",items:[]}]),u=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,u)},new WebServiceRobotics(function(t){n(t)}).getEmployeeDayInfo(selectedDate(),request().IdEmployee)):(t=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roIncorrectApiVersion"),"error",0,t))};return shiftName=ko.computed(function(){return dayInfo()!=null&&dayInfo().MainShift!=null?dayInfo().MainShift.Name:""}),refreshShiftLayers=function(n){var h=[],l=moment(),e=l.clone().startOf("day"),r,u,o,f,s,t;if(typeof n.DayInfo!="undefined"&&n.DayInfo!=null&&n.DayInfo.DayData.length>0&&n.DayInfo.DayData[0].MainShift!=null){if(r=n.DayInfo.DayData[0].MainShift,r.ShiftLayers==0)u=moment.tz(r.StartHour,VTPortal.roApp.serverTimeZone),o=moment.tz(r.EndHour,VTPortal.roApp.serverTimeZone),e=moment(u).endOf("day"),t=moment(u).diff(e,"minutes")-1,f=moment(o)>=moment(u)?moment(o).diff(moment(u),"minutes"):moment(o).add(1,"day").diff(moment(u),"minutes"),h.push({Name:"",Gauge:{scale:{startValue:t,endValue:t+f,tickInterval:60,label:{indentFromTick:-3,"true":!1,customizeText:VTPortalUtils.utils.convertShiftHourToTime(t+f)},tick:{color:"#536878"}},value:0,subvalues:[t,t+f],subvalueIndicator:{type:"textCloud",color:"#0046FE",text:{font:{size:12},customizeText:VTPortalUtils.utils.convertShiftHourToTime(t+f)}},rangeContainer:{offset:10,ranges:[{startValue:t,endValue:t+f,color:"#77DD77"}]}}});else for(s=0;s<r.ShiftLayers;s++){var i=r.ShiftLayersDefinition[s],a=moment.tz(moment(i.LayerStartTime),VTPortal.roApp.serverTimeZone),c=a.format("YYYYMMDDHHmmss");e=moment(c,"YYYYMMDDHHmmss").endOf("day");t=moment(c,"YYYYMMDDHHmmss").diff(e,"minutes")-1;h.push({Name:i18nextko.i18n.t("roLayer")+" "+i.LayerID,Gauge:{scale:{startValue:t,endValue:t+i.LayerDuration,tickInterval:60,label:{indentFromTick:-3,visible:!1,customizeText:VTPortalUtils.utils.convertShiftHourToTime(t+i.LayerDuration)},tick:{color:"#536878"}},value:0,subvalues:[t,t+i.LayerOrdinaryHours,t+i.LayerDuration],subvalueIndicator:{type:"textCloud",color:"#0046FE",text:{font:{size:12},customizeText:VTPortalUtils.utils.convertShiftHourToTime(t+r.PlannedHours)}},rangeContainer:{offset:10,ranges:[{startValue:t,endValue:t+i.LayerOrdinaryHours,color:"#77DD77"},{startValue:t+i.LayerOrdinaryHours,endValue:t+i.LayerDuration,color:"#ff0000"}]}}})}shiftLayersDS([{key:"Franjas",items:h}])}else shiftLayersDS([])},{viewShown:viewShown,title:i18nextko.i18n.t("lblCurrentDR"),subscribeBlock:globalStatus(),empImage:employeeImage,lblEmployee:lblEmployee,detailsVisible:function(){popupDayInfoVisible(!0);var n=moment(params.param,"YYYY-MM-DD");selectedDate(n.toDate());refreshDayData()},listCurrentPunches:{dataSource:punchesDS,scrollingEnabled:!0,grouped:!1},lblRequestDates:lblRequestDates,lblOverlays:i18nextko.i18n.t("lblOverlays"),lblAccruals:i18nextko.i18n.t("roMyAccrualsHint"),lblNoOverlays:i18nextko.i18n.t("lblNoOverlays"),lblAvailable:lblAvailable,lblPending:lblPending,lblApproved:lblApproved,notAdjustedVisible:notAdjustedVisible,lblRemarks:i18nextko.i18n.t("lblRemarks"),lblHasRequestedDR:i18nextko.i18n.t("lblMyRequestedDR")+" "+moment(params.param,"YYYY-MM-DD").format("LL"),lblApprovedText:i18nextko.i18n.t("lblApprovedText"),lblPendingText:i18nextko.i18n.t("lblPendingText"),lblAvailableText:i18nextko.i18n.t("lblAvailableText"),lblRequestedDays:i18nextko.i18n.t("lblRequestedDays"),lblCurrentPunches:i18nextko.i18n.t("lblCurrentDR"),lblCurrentPunches2:i18nextko.i18n.t("lblCurrentPunches"),lblHasBeenModified:i18nextko.i18n.t("lblHasBeenModified"),lblLoading:i18nextko.i18n.t("lblLoading"),lblGroupName:lblGroupName,lblNotAdjusted:lblNotAdjusted,lblDayInfo:i18nextko.i18n.t("roInformationDay"),lblPunchInfo:lblPunchInfo,lblShift:i18nextko.t("roShiftLbl"),txtDayShift:{placeholder:i18nextko.t("roShiftLbl"),value:shiftName,readOnly:!0},scrollPopup:{},txtPlannedHours:{placeholder:i18nextko.t("roPlannedLbl"),value:plannedHours,readOnly:!0},listShiftLayer:{dataSource:shiftLayersDS,scrollingEnabled:!1,grouped:!0,collapsibleGroups:!1,itemTemplate:"ScheduleItem",groupTemplate:function(n){return $("<div>"+i18nextko.i18n.t("roResumeAccruals_"+n.key)+"<\/div>")}},listForecasts:{dataSource:forecastsDS,scrollingEnabled:!1,grouped:!0,collapsibleGroups:!1,itemTemplate:"ForecastItem",groupTemplate:function(){return $("<div>"+i18nextko.i18n.t("roDailyForecasts")+"<\/div>")}},listSchedule:{dataSource:scheduleDS,scrollingEnabled:!1,grouped:!0,collapsibleGroups:!1,itemTemplate:"ScheduleItem",groupTemplate:function(n){return $("<div>"+i18nextko.i18n.t("roResumeAccruals_"+n.key)+"<\/div>")}},myApprovalsBlock:myApprovalsBlock,scheduleDS:scheduleDS,forecastsDS:forecastsDS,popupVisible:popupVisible,infoDivVisible:infoDivVisible,popupDayInfoVisible:popupDayInfoVisible,requestMainDivVisible:requestMainDivVisible,loadingDivVisible:loadingDivVisible,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),punchesDS:punchesDS,lblNotes:i18nextko.i18n.t("roNotes"),hasDesajustes:hasDesajustes,scrollContent:{},btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequestNew(requestId(),request().RequestType,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:viewActions},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequestNew(requestId(),request().RequestType,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:viewActions},btnHistory:{onClick:function(){popupVisible(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:viewHistory},btnDelete:{onClick:deleteRequest,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:canDelete},tcInfo1:tcInfo1,tcInfo2:tcInfo2,tcInfo3:tcInfo3,tcInfo4:tcInfo4,tcInfo5:tcInfo5,zInfo1:zInfo1,zInfo2:zInfo2,zInfo3:zInfo3,zInfo4:zInfo4,zInfo5:zInfo5,block1Visible:block1Visible,block2Visible:block2Visible,block3Visible:block3Visible,block4Visible:block4Visible,block5Visible:block5Visible,blocksVisible:blocksVisible,punchesVisible:punchesVisible,dateBegin:{width:67,value:iDate1,disabled:!0},dateEnd:{width:67,value:eDate1,disabled:!0},cmbTCType:{dataSource:tcTypesDS,displayExpr:"FieldName",valueExpr:"FieldValue",value:tcTypeValue1,disabled:!0},cmbZones:{dataSource:VTPortal.roApp.zonesDataSource,displayExpr:"Name",valueExpr:"Id",value:zoneValue1,disabled:!0},dateBegin2:{disabled:!0,width:67,value:iDate2},dateEnd2:{disabled:!0,width:67,value:eDate2},cmbTCType2:{dataSource:tcTypesDS,displayExpr:"FieldName",valueExpr:"FieldValue",value:tcTypeValue2,disabled:!0},cmbZones2:{dataSource:VTPortal.roApp.zonesDataSource,displayExpr:"Name",valueExpr:"Id",value:zoneValue2,disabled:!0},dateBegin3:{disabled:!0,width:67,value:iDate3},dateEnd3:{disabled:!0,width:67,value:eDate3},cmbTCType3:{dataSource:tcTypesDS,displayExpr:"FieldName",valueExpr:"FieldValue",value:tcTypeValue3,disabled:!0},cmbZones3:{dataSource:VTPortal.roApp.zonesDataSource,displayExpr:"Name",valueExpr:"Id",value:zoneValue3,disabled:!0},dateBegin4:{disabled:!0,width:67,value:iDate4},dateEnd4:{disabled:!0,width:67,value:eDate4},cmbTCType4:{dataSource:tcTypesDS,displayExpr:"FieldName",valueExpr:"FieldValue",value:tcTypeValue4,disabled:!0},cmbZones4:{dataSource:VTPortal.roApp.zonesDataSource,displayExpr:"Name",valueExpr:"Id",value:zoneValue4,disabled:!0},dateBegin5:{disabled:!0,width:67,value:iDate5},dateEnd5:{disabled:!0,width:67,value:eDate5},cmbTCType5:{dataSource:tcTypesDS,displayExpr:"FieldName",valueExpr:"FieldValue",value:tcTypeValue5,disabled:!0},cmbZones5:{dataSource:VTPortal.roApp.zonesDataSource,displayExpr:"Name",valueExpr:"Id",value:zoneValue5,disabled:!0}}};VTPortal.changeShiftNew=function(n){function wt(){$("#myTeamPlanDiv").dxMultiView("option","selectedIndex",$("#myTeamPlanDiv").dxMultiView("option","selectedIndex")-1)}function bt(){$("#myTeamPlanDiv").dxMultiView("option","selectedIndex",$("#myTeamPlanDiv").dxMultiView("option","selectedIndex")+1)}function kt(){v(!0);yt()}function dt(){w().viewShown();kt()}var w=ko.observable(VTPortal.bigUserInfo()),gt=ko.observable(moment().add(-1,"days").toDate()),u=ko.observable(null),t=ko.observable(),ni=ko.observable([]),ti=ko.observable([]),f=ko.observable(!1),c=ko.observable(!1),ft=ko.observable(0),b=ko.observable(0),et=ko.observable(0),k=ko.observable(""),l=ko.observable(""),ot=ko.observable(0),a=ko.observable(!1),st=ko.observable(!0),d=ko.observable(!1),g=ko.observable(""),nt=VTPortal.approvalHistory(),ht=ko.observable(!1),tt=ko.observable(!1),v=ko.observable(!1),it=ko.observable(moment()),rt=ko.observable(moment()),r=ko.observable(0),e=ko.observable(0),o=ko.observable(""),p=ko.observable(""),s=ko.observable(""),h=ko.observable(""),ut=ko.observable(new DevExpress.data.DataSource({store:[]})),ii=ko.computed(function(){return"76%"});typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&u(parseInt(n.id,10));var ct=ko.computed(function(){if(typeof t()!="undefined")return t().EmployeeName;""}),lt=ko.computed(function(){if(typeof t()!="undefined")return t().RequestInfo;""}),at=ko.computed(function(){if(typeof t()!="undefined")return t().EmployeeGroup;""}),vt=function(){new WebServiceRobotics(function(n){var t,r;if(n.Status==window.VTPortalUtils.constants.OK.value){if(t=n.Days,t.length>1&&c(!0),r=[],n.EmployeePlanning.length>0)for(i=0;i<n.EmployeePlanning.length;i++)for(r.push(n.EmployeePlanning[i].IdShift),y=0;y<t.length;y++)n.EmployeePlanning[i].DatePlanned==t[y].DatePlanned&&(t[y].OldEmployeeShift=n.EmployeePlanning[i].IdShift,t[y].OldEmployeeName=n.EmployeePlanning[i].ShiftName,t[y].OldEmployeeColor=n.EmployeePlanning[i].ShiftColor);for(i=0;i<t.length;i++)for(y=0;y<t[i].Employees.length;y++)t[i].Employees[y].EmployeeImage==""&&(t[i].Employees[y].EmployeeImage=n.DefaultImage.replace("no-repeat center center",""));ut(new DevExpress.data.DataSource({store:t}))}}).getMyTeamPlanEmployees(moment(it()).format("YYYY/MM/DD"),moment(rt()).format("YYYY/MM/DD"),b(),r(),e())},yt=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)it(n.Date1),rt(n.Date2),r(n.Field4),e(n.IdShift),o(n.OldShiftName),p(n.NewShiftName),s(n.OldShiftColor),h(n.NewShiftColor),b(n.IdEmployee),vt(),v(!1),tt(!0),t(n),n.Comments!=""?(a(!0),g(n.Comments)):a(!1),f(!1),(n.ReqStatus==0||n.ReqStatus==1)&&f(!0),nt.refreshApprovals(n.RequestsHistoryEntries);else{var i=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,i)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequestForSupervisor(u())},pt=ko.computed(function(){return typeof t()!="undefined"?t().EmployeeImage!=""?"url(data:image/png;base64,"+t().EmployeeImage+")":"url(Images/logovtl.ico)":""});return{viewShown:dt,title:i18nextko.i18n.t("roRequestType_ChangeShift"),subscribeBlock:w(),empImage:pt,lblEmployee:ct,lblRequestDates:lt,lblmyTeamPlan:i18nextko.i18n.t("lblMyTeamPlan"),lblAvailable:ft,lblPending:et,lblApproved:ot,lblRemarks:i18nextko.i18n.t("lblRemarks"),lblLoading:i18nextko.i18n.t("lblLoading"),lblSelectedDayMV:k,lblSelectedDayDetails:l,lblGroupName:at,remarks:g,myApprovalsBlock:nt,popupVisible:d,infoDivVisible:a,requestMainDivVisible:tt,loadingDivVisible:v,myTeamPlanDivVisible:st,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),scrollContent:{},btnNext:{onClick:bt,icon:"spinright",visible:c},btnPrevious:{onClick:wt,icon:"spinleft",visible:c},myTeamPlan:{dataSource:ut,selectedIndex:0,loop:!0,animationEnabled:!0,itemTemplate(n,t,i){var u=$("<div>");u.dxTileView({items:n.Employees,height:175,direction:"horizontal",baseItemHeight:75,baseItemWidth:75,itemMargin:10,itemTemplate(n,t,i){n.IdShift==r()?i.append(`<div class="imageTileviewRequest" id="div_${n.IdEmployee}_${n.IdCounter}"><div class="textTileview">${n.EmployeeName}</div><div class="imageTileviewRequest" style="border: 4px solid ${s()}; background: ${n.EmployeeImage}"></div></div>`):n.IdShift==e()?i.append(`<div class="imageTileviewRequest" id="div_${n.IdEmployee}_${n.IdCounter}"><div class="textTileview">${n.EmployeeName}</div><div class="imageTileviewRequest" style="border: 4px solid ${h()}; background: ${n.EmployeeImage}"></div></div>`):i.append(`<div style="width:0; height:0;overflow: hidden"></div>`)}}).appendTo(i)},onSelectionChanged(n){typeof n.addedItems[0].OldEmployeeShift!="undefined"&&(r(n.addedItems[0].OldEmployeeShift),s(n.addedItems[0].OldEmployeeColor),o(n.addedItems[0].OldEmployeeName));var i=n.addedItems[0].Employees.filter(n=>n.IdShift==r()).length,t=n.addedItems[0].Employees.filter(n=>n.IdShift==e()).length;k(moment(n.addedItems[0].DatePlanned).format("DD/MM/YYYY"));o()=="???"?l(`<span style="color: ${h()}">&#9679</span>`+" "+p()+": <b>"+t+"<\/b> "):l(`<span style="color: ${h()}">&#9679</span>`+" "+p()+": <b>"+t+"<\/b> "+`<span style="color: ${s()}">&#9679</span>`+" "+o()+": <b>"+i+"<\/b>");$("#myTeamPlanDiv").dxMultiView("instance").repaint()}},btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequestNew(u(),t().RequestType,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:f},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequestNew(u(),t().RequestType,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:f},btnHistory:{onClick:function(){d(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:ht}}};VTPortal.cancelHolidaysNew=function(n){function ot(){s(!0);ft()}function st(){f().viewShown();ot()}var f=ko.observable(VTPortal.bigUserInfo()),i=ko.observable(null),t=ko.observable(),r=ko.observable(!1),y=ko.observable(0),p=ko.observable(0),w=ko.observable(0),b=ko.observable(""),k=ko.observable(""),d=ko.observable(0),e=ko.observable(!1),h=ko.observable(!1),o=ko.observable(""),c=VTPortal.approvalHistory(),g=ko.observable(!1),l=ko.observable(!1),s=ko.observable(!1),u=ko.observable(!1),a=ko.observable(!1),v=ko.observable(new DevExpress.data.DataSource({store:[]})),nt=ko.computed(function(){return"76%"});typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&i(parseInt(n.id,10));var tt=ko.computed(function(){if(typeof t()!="undefined")return t().EmployeeName;""}),it=ko.computed(function(){if(typeof t()!="undefined")return t().RequestInfo;""}),rt=ko.computed(function(){if(typeof t()!="undefined")return t().EmployeeGroup;""});typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&i(parseInt(n.id,10));var ut=ko.observable(!1),ft=function(){new WebServiceRobotics(function(n){var i,f;n.Status==window.VTPortalUtils.constants.OK.value?(o(n.Comments),p(n.IdEmployee),s(!1),l(!0),t(n),n.RequestDays!=null?n.RequestDays.length>1?(i=[],n.RequestDays.forEach(function(n){i.push({RequestDate:moment(n.RequestDate).format("dddd DD MMMM")})}),v(new DevExpress.data.DataSource({store:i})),u(!0)):u(!1):u(!1),n.Comments!=""?(e(!0),o(n.Comments)):e(!1),r(!1),(n.ReqStatus==0||n.ReqStatus==1)&&r(!0),c.refreshApprovals(n.RequestsHistoryEntries)):(f=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,f))},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequestForSupervisor(i())},et=ko.computed(function(){return typeof t()!="undefined"?t().EmployeeImage!=""?"url(data:image/png;base64,"+t().EmployeeImage+")":"url(Images/logovtl.ico)":""});return f=ko.observable(VTPortal.bigUserInfo()),{requestId:i,myApprovalsBlock:c,viewShown:st,title:i18nextko.t("roRequestType_CancelHolidays"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:i18nextko.t("roSelectPlannedHoliday"),lblSelectDaysInfo:i18nextko.t("roSelectDayInfo"),lblRequestedDays:i18nextko.i18n.t("lblRequestedDays"),empImage:et,lblEmployee:tt,detailsVisible:function(){a(!0)},daysDetailDiv:u,lblRequestDates:it,lblAvailable:y,lblPending:w,lblApproved:d,lblLoading:i18nextko.i18n.t("lblLoading"),lblSelectedDayMV:b,lblSelectedDayDetails:k,lblGroupName:rt,subscribeBlock:f(),scrollContent:{height:nt},popupVisible:h,popupRequestDaysVisible:a,infoDivVisible:e,requestMainDivVisible:l,loadingDivVisible:s,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequestNew(i(),t().RequestType,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:r},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequestNew(i(),t().RequestType,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:r},btnHistory:{onClick:function(){h(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:g},remarks:{value:o,readOnly:ut},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),listRequestDays:{dataSource:v,scrollingEnabled:!0,grouped:!1,height:300,itemTemplate:"RequestItem"}}};VTPortal.absence=function(n){function vt(){c(!0);ct();at()}function yt(){l().viewShown();vt()}var l=ko.observable(VTPortal.bigUserInfo()),bt=ko.observable(moment().add(-1,"days").toDate()),r=ko.observable(null),t=ko.observable(),a=ko.observable([]),ft=ko.observable([]),u=ko.observable(!1),v=ko.observable(0),y=ko.observable(0),p=ko.observable(0),w=ko.observable(0),b=ko.observable(0),k=ko.observable(0),d=ko.observable(!1),e=ko.observable(!1),o=ko.observable(!1),s=ko.observable(!1),f=ko.observable(!1),h=ko.observable(!1),g=ko.observable(!1),nt=ko.observable(!1),tt=ko.observable(""),it=VTPortal.approvalHistory(),et=ko.observable(!1),rt=ko.observable(!1),c=ko.observable(!1),ut=ko.observable(new DevExpress.data.DataSource({store:[]})),kt=ko.computed(function(){return"76%"});typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&r(parseInt(n.id,10));var ot=ko.computed(function(){if(typeof t()!="undefined")return t().EmployeeName;""}),st=ko.computed(function(){if(typeof t()!="undefined")return t().RequestInfo;""}),ht=ko.computed(function(){if(typeof t()!="undefined")return t().EmployeeGroup;""}),ct=function(){new WebServiceRobotics(function(n){var i,r;if(n.Status==window.VTPortalUtils.constants.OK.value){if(c(!1),rt(!0),t(n),n.RequestDays!=null?n.RequestDays.length>1?(i=[],n.RequestDays.forEach(function(n){i.push({RequestDate:moment(n.RequestDate).format("dddd DD MMMM")})}),ut(new DevExpress.data.DataSource({store:i})),f(!0)):f(!1):f(!1),n.RequestType==6){if(o(!0),ft(n.EmployeeAccruals),p(n.EmployeeAccruals.Lasting),v(n.EmployeeAccruals.Available),y(n.EmployeeAccruals.Pending),d(n.IsAnnualWork),n.IsAnnualWork){w(n.EmployeeAccruals.WithoutEnjoyment);b(n.EmployeeAccruals.Expired);const t=n.EmployeeAccruals.Available-n.EmployeeAccruals.Pending-n.EmployeeAccruals.Lasting-n.EmployeeAccruals.Expired-n.EmployeeAccruals.WithoutEnjoyment;k(t)}}else o(!1);n.Comments!=""?(e(!0),tt(n.Comments)):e(!1);u(!1);(n.ReqStatus==0||n.ReqStatus==1)&&u(!0);it.refreshApprovals(n.RequestsHistoryEntries)}else r=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r)},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequestForSupervisor(r())},lt=ko.computed(function(){return typeof t()!="undefined"?t().EmployeeImage!=""?"url(data:image/png;base64,"+t().EmployeeImage+")":"url(Images/logovtl.ico)":""}),at=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)if(n.Overlays.length>0){for(s(!0),h(!1),i=0;i<n.Overlays.length;i++)n.Overlays[i].EmployeeImage=n.Overlays[i].EmployeeImage==""?n.DefaultImage.replace("no-repeat center center",""):n.Overlays[i].EmployeeImage.replace("no-repeat center center","");a(n.Overlays)}else s(!1),h(!0)}).getOverlappingEmployees(r())};var pt=ko.computed(function(){return typeof t()!="undefined"&&t().RequestType==6?i18nextko.i18n.t("lblApprovedHolidaysText"):i18nextko.i18n.t("lblApprovedText")}),wt=ko.computed(function(){return typeof t()!="undefined"&&t().RequestType==6?i18nextko.i18n.t("lblPendingHolidaysText"):i18nextko.i18n.t("lblPendingText")});return{viewShown:yt,title:i18nextko.i18n.t("roRequestType_PlannedAbsences"),subscribeBlock:l(),empImage:lt,lblEmployee:ot,detailsVisible:function(){nt(!0)},lblRequestDates:st,lblOverlays:i18nextko.i18n.t("lblOverlays"),lblAccruals:i18nextko.i18n.t("roMyAccrualsHint"),lblNoOverlays:i18nextko.i18n.t("lblNoOverlays"),lblAvailable:v,lblPending:y,lblApproved:p,lblNotAvailable:w,lblExpired:b,lblFinal:k,lblRemarks:i18nextko.i18n.t("lblRemarks"),lblApprovedText:pt,lblPendingText:wt,lblAvailableText:i18nextko.i18n.t("lblAvailableText"),lblNotAvailableText:i18nextko.i18n.t("lblNotAvailableText"),lblExpiredText:i18nextko.i18n.t("lblExpiredText"),lblFinalText:i18nextko.i18n.t("lblFinalText"),lblRequestedDays:i18nextko.i18n.t("lblRequestedDays"),lblLoading:i18nextko.i18n.t("lblLoading"),lblGroupName:ht,isAnnualWork:d,remarks:tt,myApprovalsBlock:it,popupVisible:g,popupRequestDaysVisible:nt,accrualsDivVisible:o,infoDivVisible:e,requestMainDivVisible:rt,daysDetailDiv:f,loadingDivVisible:c,overlaysDivVisible:s,noOverlaysDivVisible:h,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),scrollContent:{},listRequestDays:{dataSource:ut,scrollingEnabled:!0,grouped:!1,height:300,itemTemplate:"RequestItem"},overlays:{items:a,height:175,direction:"horizontal",baseItemHeight:75,baseItemWidth:75,itemMargin:10,itemTemplate(n,t,i){var r,u;n.IsRequest==!0?(i.append(`<div class="imageTileviewRequest" id="div_${n.IdEmployee}_${n.IdCounter}"><div class="textTileview">${n.EmployeeName}</div><div class="imageTileviewRequest" style="border: 3px solid #0046FE; background-image: ${n.EmployeeImage}"></div></div>`),r=$("<div>"),u=$("<div style='margin:10px; font-size: 10px;'>").html(n.AbsenceResume),r.append(u),r.dxPopover({target:`#div_${n.IdEmployee}_${n.IdCounter}`,showEvent:"dxclick",position:"top",width:300}).appendTo(i)):(i.append(`<div class="imageTileview" id="div_${n.IdEmployee}_${n.IdCounter}"><div class="textTileview">${n.EmployeeName}</div><div class="imageTileview" style="background-image: ${n.EmployeeImage}"></div></div>`),r=$("<div>"),u=$("<div style='margin:10px; font-size: 10px;'>").html(n.AbsenceResume),r.append(u),r.dxPopover({target:`#div_${n.IdEmployee}_${n.IdCounter}`,showEvent:"dxclick",position:"top",width:300}).appendTo(i))}},btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequestNew(r(),t().RequestType,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:u},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequestNew(r(),t().RequestType,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:u},btnHistory:{onClick:function(){g(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:et}}};VTPortal.telecommute=function(n){function v(){h().viewShown();t()!=null&&t()>0&&(o(!0),VTPortalUtils.utils.markRequestAsRead(t()),a());VTPortal.roApp.impersonatedIDEmployee==-1?t()!=null&&i(!0):t()!=null&&r(!1);t()==null&&c(!0);t()!=null&&f(!0)}function p(){t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}var t=ko.observable(null),u=ko.observable(""),c=ko.observable(!1),i=ko.observable(!1),f=ko.observable(!1),e=ko.observable(!1),r=ko.observable(!1),o=ko.observable(!1),s=VTPortal.approvalHistory(),w=ko.observable([]),y;typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));var l=ko.computed(function(){return"76%"}),a=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)n.Field1=="0"?u(i18nextko.i18n.t("roRequestTelecommuteOffice")+moment(n.Date1).format("DD/MM/YYYY")):u(i18nextko.i18n.t("roRequestTelecommuteHome")+moment(n.Date1).format("DD/MM/YYYY")),n.ReqStatus==0?i(!0):i(!1),r(!1),VTPortal.roApp.impersonatedIDEmployee!=-1&&(n.ReqStatus==0||n.ReqStatus==1)&&(r(!0),i(!1)),s.refreshApprovals(n.RequestsHistoryEntries);else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())},h=ko.observable(VTPortal.bigUserInfo());return y=null,{requestId:t,myApprovalsBlock:s,viewShown:v,title:i18nextko.t("roRequestType_telecommute"),lblPunchesInfo:i18nextko.t("rotelecommuteDays"),lblRemarks:i18nextko.t("rotelecommuteDaysDetail"),remarks:{value:u,readOnly:o},subscribeBlock:h(),scrollContent:{height:l},popupVisible:e,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),16,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:r},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),16,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:r},btnHistory:{onClick:function(){e(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:f},btnDelete:{onClick:p,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:i},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.userFields=function(n){function vt(){et().viewShown();s("");l([]);i(!0,!1,!1,!1);at("userfields");t()!=null&&t()>0&&(u(!0),VTPortalUtils.utils.markRequestAsRead(t()));VTPortal.roApp.impersonatedIDEmployee==-1?t()!=null&&o(!0):t()!=null&&e(!1);t()==null&&it(!0);t()!=null&&ut(!0)}function yt(){var i=s().split("__"),o=parseInt(i[1],10),t,n,u,e;if(o==9)u=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},e=function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDocumentUploaded"),"success",2e3)):VTPortalUtils.utils.processErrorMessage(n)},r==null&&(r=new WebServiceRobotics(e,u)),t=y.getDocument(),VTPortal.roApp.isModeApp()?r.uploadDocumentMobile(t,-1,f(),""):(t.append("idRelatedObject",1),t.append("remarks",f()),t.append("docRelatedInfo",""),r.uploadDocumentDesktop(t));else{n="";switch(o){case 2:n=moment(w()).format("YYYY/MM/DD");break;case 4:n=moment(b()).format("HH:mm");break;case 5:n=c();break;default:n=p()}u=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)};e=function(t){if(t.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var u=function(){r.saveUserFieldRequest(i[0],n,f(),i[2].toLowerCase()=="false"?!1:!0,moment().startOf("day"),!0)};VTPortalUtils.utils.processRequestErrorMessage(t,u,function(){})}};r==null&&(r=new WebServiceRobotics(e,u));r.saveUserFieldRequest(i[0],n,f(),i[2].toLowerCase()=="false"?!1:!0,moment().startOf("day"),!1)}}function pt(){t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}var t=ko.observable(null),f=ko.observable(""),a=ko.observable(""),e=ko.observable(!1),it=ko.observable(!1),o=ko.observable(!1),rt=ko.observable(!1),ut=ko.observable(!1),s=ko.observable(""),ot=ko.observable([]),v=ko.observable(!1),y=new VTPortal.documentInput,r;typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));typeof n.param!="undefined"&&a(n.param);var u=ko.observable(!1),h=ko.observable(null),c=ko.observable(null),wt=ko.observable(""),p=ko.observable(""),w=ko.observable(moment().startOf("day").toDate()),b=ko.observable(moment().startOf("day").toDate()),k=ko.observable([]),l=ko.observable([]),d=ko.observable(!1),g=ko.observable(!1),nt=ko.observable(!1),tt=ko.observable(!1),ft=VTPortal.approvalHistory(),st=ko.computed(function(){return"76%"}),i=function(n,t,i,r){n?d(!0):d(!1);t?g(!0):g(!1);i?nt(!0):nt(!1);r?tt(!0):tt(!1)},ht=function(n){var t=n.value.split("__");s(n.value);v(!1);switch(parseInt(t[1],10)){case 2:i(!1,!0,!1,!1);break;case 4:i(!1,!1,!0,!1);break;case 5:i(!0,!1,!1,!1);new WebServiceRobotics(function(n){var t,i,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(t=[],i=0;i<n.Values.length;i++)t.push({FieldName:n.Values[i],FieldValue:n.Values[i]});l(t);t.length>0&&c(t[0].FieldValue)}else r=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r)},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getUserFieldAvailableValues(t[0]);break;case 9:ct(t[3]);break;default:i(!1,!1,!1,!0)}},ct=function(n){new WebServiceRobotics(function(t){if(t.Status==window.VTPortalUtils.constants.OK.value)ot(t.SelectFields),y.initializeData(t.SelectFields,!1,parseInt(n,10)),v(!0);else{var i=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(t,i)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingCauseInfo"),"error",0,n)}).getGenericList("documents")},lt=function(){new WebServiceRobotics(function(n){var r,t,u,a,v;if(n.Status==window.VTPortalUtils.constants.OK.value){for(f(n.Comments),n.ReqStatus==0?o(!0):o(!1),e(!1),VTPortal.roApp.impersonatedIDEmployee!=-1&&(VTPortal.roApp.isImpersonateEnabled()==!1&&VTPortal.roApp.disableImpersonateActionsOnRequest(),(n.ReqStatus==0||n.ReqStatus==1)&&(e(!0),o(!1))),ft.refreshApprovals(n.RequestsHistoryEntries),r=k(),t=0;t<r.length;t++)(r[t].FieldValue==n.FieldName||r[t].FieldValue.startsWith(n.FieldName)&&n.FieldName.length>0)&&(s(r[t].FieldValue),h(r[t].FieldValue));u=s().split("__");switch(parseInt(u[1],10)){case 2:w(moment(n.FieldValue,"YYYY/MM/DD").toDate());i(!1,!0,!1,!1);break;case 4:b(moment(n.FieldValue,"HH:mm").toDate());i(!1,!1,!0,!1);break;case 5:i(!0,!1,!1,!1);a=n;new WebServiceRobotics(function(n){var i,t,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=[],t=0;t<n.Values.length;t++)i.push({FieldName:n.Values[t],FieldValue:n.Values[t]});l(i);setTimeout(function(){c(a.FieldValue)},50)}else r=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r)},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getUserFieldAvailableValues(u[0]);break;default:i(!1,!1,!1,!0);p(n.FieldValue)}}else v=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,v)},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())},at=function(n){new WebServiceRobotics(function(n){var i,r;if(n.Status==window.VTPortalUtils.constants.OK.value)if(k(n.SelectFields),t()!=null&&t()>0)lt(t());else if(a()=="")n.SelectFields.length>0&&h(n.SelectFields[0].FieldValue);else for(i=0;i<n.SelectFields.length;i++)n.SelectFields[i].FieldValue.startsWith(a()+"__")&&h(n.SelectFields[i].FieldValue);else r=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r)},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},et=ko.observable(VTPortal.bigUserInfo());return r=null,{requestId:t,myApprovalsBlock:ft,viewShown:vt,title:i18nextko.t("roRequestType_UserFieldsChange"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:i18nextko.t("roRequestUserFieldLbl"),lblRequestValue2:i18nextko.t("roRequestUserFieldValueLbl"),subscribeBlock:et(),scrollContent:{height:st},popupVisible:rt,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),1,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:e},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),1,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:e},btnHistory:{onClick:function(){rt(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:ut},btnSave:{onClick:yt,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:it},btnDelete:{onClick:pt,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:o},remarks:{value:f,readOnly:u},cmbRequestValue1:{dataSource:k,displayExpr:"FieldName",valueExpr:"FieldValue",value:h,onValueChanged:ht,readOnly:u},cmbRequestValue2:{dataSource:l,displayExpr:"FieldName",valueExpr:"FieldValue",value:c,visible:d,readOnly:u},dateRequestValue2:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:w,visible:g,readOnly:u,valueChangeEvent:"focusout"},timeRequestValue2:{type:"time",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:b,visible:nt,readOnly:u,valueChangeEvent:"focusout"},txtRequestValue2:{value:p,visible:tt,readOnly:u},hasDocuments:v,myDocumentsBlock:y,loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.shiftExchange=function(n){function dt(){ht().viewShown();a([]);c(null);v([]);f(null);t()!=null&&t()>0?(et("shifts.fulllist.withexcluded"),h(!0)):moment(i()).isSame(moment(e()))&&st(i());VTPortal.roApp.impersonatedIDEmployee==-1&&t()!=null&&l(!0);t()==null&&g(!0);t()!=null&&nt(!0)}function gt(){var e=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},s=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(8),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var t=function(){var n=r()==!1?"":o()==null?VTPortalUtils.nullDate:moment(o()).format("YYYY-MM-DD HH:mm");p.saveShiftExchange(i()==null?VTPortalUtils.nullDate:i(),n,f(),c(),u().MainShift.ID,w(),!0)};VTPortalUtils.utils.processRequestErrorMessage(n,t,function(){})}},n,t;p==null&&(p=new WebServiceRobotics(s,e));n=v().find(function(n){return n.FieldValue==f()});n!=null&&n.RelatedInfo==""?!r()||r()&&o()!=null?(t=r()==!1?"":o()==null?VTPortalUtils.nullDate:moment(o()).format("YYYY-MM-DD HH:mm"),p.saveShiftExchange(i()==null?VTPortalUtils.nullDate:i(),t,f(),c(),u().MainShift.ID,w(),!1)):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roCompensateDateNeeded"),"error",0):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNotAvailableEmployeeSelected"),"error",0)}function ni(){t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}var t=ko.observable(null),w=ko.observable(""),g=ko.observable(!1),l=ko.observable(!1),nt=ko.observable(!1),tt=ko.observable(!1),s=ko.observable(!1),b=ko.observable(null),h=ko.observable(!1),u=ko.observable(null),k=ko.observable(""),i=ko.observable(moment().startOf("day").toDate()),e=ko.observable(moment().startOf("day").toDate()),p,d,ct;typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));typeof n.param!="undefined"&&parseInt(n.param,10)!=-1&&(i(moment(n.param,"YYYY-MM-DD").toDate()),e(moment(n.param,"YYYY-MM-DD").toDate()));var it=ko.observable(moment("01/01/"+moment(i()).year(),"DD/MM/YYYY")),rt=ko.observable(moment("31/12/"+moment(i()).year(),"DD/MM/YYYY")),c=ko.observable(null),f=ko.observable(null),a=ko.observable([]),v=ko.observable([]),r=ko.observable(!1),ut=ko.observable(0),o=ko.observable(null),y=ko.observable(!0),ft=VTPortal.approvalHistory(),lt=ko.computed(function(){return t()!=null&&t()>0?k():u()!=null?u().MainShift.Name:""}),at=function(n){t()!=null&&t()>0||y()!=!1||new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)n.Days>0?(ut(n.Days),r(!0)):(ut(0),r(!1));else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getDaysToCompensate(i(),e(),n.value)},vt=function(n){var s,h,f;t()!=null&&t()>0||(s=n.value,parseInt(s,10)>0&&ot(i(),e(),u().MainShift.ID,s),h=a().find(function(t){return parseInt(t.FieldValue,10)==parseInt(n.value,10)}),h!=null?(f=parseFloat(h.RelatedInfo),f==-1?r(!1):f>0&&u().MainShift.PlannedHours==0||f==0&&u().MainShift.PlannedHours>0?r(!0):r(!1)):r(!1),r()&&o(null))},yt=ko.computed(function(){return"76%"}),pt=function(){new WebServiceRobotics(function(n){var u,e;n.Status==window.VTPortalUtils.constants.OK.value?(b(n.ReqStatus),VTPortal.roApp.impersonatedIDEmployee==-1&&VTPortal.roApp.employeeId==n.IdEmployee&&VTPortalUtils.utils.markRequestAsRead(t()),VTPortal.roApp.impersonatedIDEmployee!=-1&&VTPortal.roApp.isImpersonateEnabled()==!1&&VTPortal.roApp.disableImpersonateActionsOnRequest(),w(n.Comments),n.ReqStatus==0||n.ReqStatus==1?l(!0):l(!1),s(!1),VTPortal.roApp.impersonatedIDEmployee==n.IdEmployee&&n.ReqStatus==1||VTPortal.roApp.impersonatedIDEmployee==n.IdEmployeeExchange&&n.ReqStatus==0?(s(!0),l(!1)):(VTPortal.roApp.employeeId!=n.IdEmployee&&(n.ReqStatus==0&&s(!0),l(!1)),VTPortal.roApp.db.settings.supervisorPortalEnabled==!0&&VTPortal.roApp.employeeId!=n.IdEmployeeExchange&&(n.ReqStatus==0?s(!1):s(!0))),ft.refreshApprovals(n.RequestsHistoryEntries),i(moment(n.strDate1,"YYYY-MM-DD HH:mm:ss").startOf("day").toDate()),n.strDate2!=""&&(o(moment(n.strDate2,"YYYY-MM-DD HH:mm:ss").startOf("day").toDate()),r(!0)),VTPortal.roApp.employeeId==n.IdEmployee?(f(""+n.IdEmployeeExchange),c(""+n.IdShift),u=a().find(function(t){return parseInt(t.FieldValue,10)==parseInt(n.Field4,10)}),k(u.FieldName)):(f(""+n.IdEmployee),c(""+parseInt(n.Field4,10)),u=a().find(function(t){return parseInt(t.FieldValue,10)==parseInt(n.IdShift,10)}),k(u.FieldName),d(i18nextko.i18n.t("roEmployeeSource")))):(e=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,e))},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())},et=function(n){new WebServiceRobotics(function(n){var r,f;n.Status==window.VTPortalUtils.constants.OK.value?(r=Object.clone(n.SelectFields,!0),r=r.add({FieldName:"---",FieldValue:-1,RelatedInfo:-1},0),a(r),t()!=null&&t()>0?wt("employees.fullList"):r.length>0&&(c(r[0].FieldValue),y()&&r[0].FieldValue>0&&ot(i(),e(),u().MainShift.ID,n.SelectFields[0].FieldValue))):(f=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,f))},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},wt=function(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)v(n.SelectFields),t()!=null&&t()>0&&pt(t());else{var i=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,i)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},ot=function(n,i,r,u){new WebServiceRobotics(function(n){var i,r;n.Status==window.VTPortalUtils.constants.OK.value?(i=n.SelectFields.clone(),v(i),t()!=null&&t()>0||i.length>0&&f()==null&&f(i[0].FieldValue)):(r=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r))},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getAvailableEmployeesForDate(n,i,r,u)},st=function(n){var t=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)n.DayInfo.DayData[0].MainShift!=null?n.DayInfo.DayData[0].Locked==!1?n.DayInfo.DayData[0].EmployeeStatusOnDay!=1?(u(n.DayInfo.DayData[0]),et("shifts.exchangeshifts")):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorNoContract"),"error",0,t):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLockedDay"),"error",0,t):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorNoDailySchedule"),"error",0,t);else{var t=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}};new WebServiceRobotics(function(n){t(n)}).getEmployeeDayInfo(n,-1)},bt=function(){t()!=null&&t()>0||(it(moment("01/01/"+moment(i()).year(),"DD/MM/YYYY")),rt(moment("31/12/"+moment(i()).year(),"DD/MM/YYYY")),e(i()),st(i()))},kt=function(){t()!=null&&t()>0||(moment(i()).isSame(moment(e()))?y(!0):y(!1))},ht=ko.observable(VTPortal.bigUserInfo());return p=null,d=ko.observable(i18nextko.i18n.t("roEmployeesAvailable")),ct={requestId:t,myApprovalsBlock:ft,viewShown:dt,title:i18nextko.t("roRequestType_ShiftExchange"),lblInitialDate:i18nextko.t("roRequestExchangeDate"),lblEndDate:i18nextko.t("roRequestEndDateLbl"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:i18nextko.t("roChangeShiftTo"),lblRequestValue2:d,lblInitialShift:i18nextko.t("roInitialShift"),subscribeBlock:ht(),scrollContent:{height:yt},popupVisible:tt,btnApprove:{onClick:function(){b()==1?VTPortalUtils.utils.approveRefuseRequest(t(),8,!0):VTPortalUtils.utils.approveRefuseRequestByEmp(t(),8,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:s},btnRefuse:{onClick:function(){b()==1?VTPortalUtils.utils.approveRefuseRequest(t(),8,!1):VTPortalUtils.utils.approveRefuseRequestByEmp(t(),8,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:s},btnHistory:{onClick:function(){tt(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:nt},btnSave:{onClick:gt,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:g},btnDelete:{onClick:ni,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:l},beginDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:i,readOnly:h,valueChangeEvent:"focusout",onValueChanged:bt},endDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:e,readOnly:h,valueChangeEvent:"focusout",onValueChanged:kt},remarks:{value:w,readOnly:h},cmbRequestValue1:{dataSource:a,displayExpr:"FieldName",valueExpr:"FieldValue",value:c,readOnly:h,onValueChanged:vt},cmbRequestValue2:{dataSource:v,displayExpr:"FieldName",valueExpr:"FieldValue",value:f,readOnly:h,fieldTemplate:function(n,t){var i="";n!=null?(i=$("<div class='custom-item'><div style='margin-top:5px;' class='"+(n.RelatedInfo==""?"availableEmployee":"notAvailableEmployee")+"' /><div class='employee-name "+(n.RelatedInfo==""?"":"notAvailableDesc")+"'><\/div><\/div>"),i.find(".employee-name").dxTextBox({value:n.FieldName,readOnly:!0})):(i=$("<div class='custom-item'><div style='margin-top:5px;' class='emptyEmployee' /><div class='employee-name'><\/div><\/div>"),i.find(".employee-name").dxTextBox({value:i18nextko.i18n.t("roNoAvailableEmp"),readOnly:!0}));t.append(i)},itemTemplate:function(n){return"<div class='custom-item'><div class='"+(n.RelatedInfo==""?"":"notAvailableDesc")+"'>"+n.FieldName+" "+(n.RelatedInfo==""?"":" ("+i18nextko.i18n.t("roNoAvailable")+")")+"<\/div><\/div>"},onValueChanged:at},txtInitialShift:{value:lt,readOnly:!0},needToCompensate:r,needShift:y,lblCompensateDate:i18nextko.t("roCompensateWithDay"),compensateDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:o,readOnly:h,max:rt,min:it,valueChangeEvent:"focusout"},loadingPanel:VTPortalUtils.utils.loadingPanelConf()},ct};VTPortal.requestsList=function(n){function u(){var f,e,t,u;for(i().viewShown(),f=VTPortal.roApp.empPermissions().Requests,e=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],typeof n.id!="undefined"&&(e=n.id.split(",").map(Number)),t=[],u=0;u<f.length;u++)if(f[u].Permission&&e.includes(f[u].RequestType))switch(f[u].RequestType){case 1:t.push({ID:1,Name:i18nextko.i18n.t("roRequestType_UserFieldsChange"),cssClass:"dx-icon-userFieldChange",hasAction:!0});break;case 2:$.grep(t,function(n){return n.ID==2}).length==0&&t.push({ID:2,Name:i18nextko.i18n.t("roRequestType_ForbiddenPunch"),cssClass:"dx-icon-forbiddenPunch",hasAction:!0});break;case 4:t.push({ID:4,Name:i18nextko.i18n.t("roRequestType_ExternalWorkResumePart"),cssClass:"dx-icon-externalWorkResume",hasAction:!0});break;case 5:t.push({ID:5,Name:i18nextko.i18n.t("roRequestType_ChangeShift"),cssClass:"dx-icon-changeShift",hasAction:!0});break;case 6:$.grep(t,function(n){return n.ID==13}).length==0&&t.push({ID:13,Name:i18nextko.i18n.t("roRequestType_PlannedHoliday"),cssClass:"dx-icon-plannedHoliday",hasAction:!0});break;case 7:t.push({ID:7,Name:i18nextko.i18n.t("roRequestType_PlannedAbsences"),cssClass:"dx-icon-plannedAbsences",hasAction:!0});break;case 8:t.push({ID:8,Name:i18nextko.i18n.t("roRequestType_ShiftExchange"),cssClass:"dx-icon-shiftExchange",hasAction:!0});break;case 9:t.push({ID:9,Name:i18nextko.i18n.t("roRequestType_PlannedCauses"),cssClass:"dx-icon-plannedCauses",hasAction:!0});break;case 10:$.grep(t,function(n){return n.ID==2}).length==0&&t.push({ID:2,Name:i18nextko.i18n.t("roRequestType_ForbiddenPunch"),cssClass:"dx-icon-forbiddenPunch",hasAction:!0});break;case 11:t.push({ID:11,Name:i18nextko.i18n.t("roRequestType_CancelHolidays"),cssClass:"dx-icon-holidaysCancel",hasAction:!0});break;case 12:$.grep(t,function(n){return n.ID==2}).length==0&&t.push({ID:2,Name:i18nextko.i18n.t("roRequestType_ForbiddenPunch"),cssClass:"dx-icon-forbiddenPunch",hasAction:!0});break;case 13:$.grep(t,function(n){return n.ID==13}).length==0&&t.push({ID:13,Name:i18nextko.i18n.t("roRequestType_PlannedHoliday"),cssClass:"dx-icon-plannedHoliday",hasAction:!0});break;case 14:t.push({ID:14,Name:i18nextko.i18n.t("roRequestType_PlannedOvertime"),cssClass:"dx-icon-plannedOvertime",hasAction:!0});break;case 15:t.push({ID:15,Name:i18nextko.i18n.t("roRequestType_ExternalWorkWeekResume"),cssClass:"dx-icon-externalWorkWeekResume",hasAction:!0})}t=t.sortBy(function(n){return n.Name});r(t)}var r=ko.observable([]),t=null,i;return typeof n.param!="undefined"&&n.param!="null"&&(t=moment(n.param)),i=ko.observable(VTPortal.bigUserInfo()),{viewShown:u,title:i18nextko.t("roSelectRequestType"),subscribeBlock:i(),listOptions:{dataSource:r,height:"100%",itemTemplate:"RequestTypeItem",onItemClick:function(n){if(n.itemData.hasAction)switch(n.itemData.ID){case 1:VTPortal.app.navigate("userFields/-1",{target:"current"});break;case 2:VTPortal.app.navigate("forgottenPunch/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"});break;case 4:VTPortal.app.navigate("externalWork/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):"")),{target:"current"};break;case 5:VTPortal.app.navigate("changeShift/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"});break;case 6:VTPortal.app.navigate("plannedHoliday/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"});break;case 7:VTPortal.app.navigate("plannedAbsence/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"});break;case 8:VTPortal.app.navigate("shiftExchange/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"});break;case 9:VTPortal.app.navigate("plannedCause/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"});break;case 10:VTPortal.app.navigate("forgottenPunch/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"});break;case 11:VTPortal.app.navigate("cancelHolidays/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"});break;case 12:VTPortal.app.navigate("forgottenPunch/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"});break;case 13:VTPortal.app.navigate("plannedHoliday/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"});break;case 14:VTPortal.app.navigate("plannedOvertime/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"});break;case 15:VTPortal.app.navigate("externalWorkWeekResume/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"})}}}}};VTPortal.plannedOvertime=function(n){function bt(){st().viewShown();tt([]);pt("plannedovertime");t()!=null&&t()>0&&(o(!0),VTPortalUtils.utils.markRequestAsRead(t()));VTPortal.roApp.impersonatedIDEmployee==-1?t()!=null&&h(!0):t()!=null&&c(!1);t()==null&&rt(!0);t()!=null&&ut(!0)}function it(n){new WebServiceRobotics(function(n){var i,t,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=l(),t=0;t<n.oCalendar.DayData.length;t++)i[moment.tz(n.oCalendar.DayData[t].PlanDate,VTPortal.roApp.serverTimeZone).add(12,"hours").format("YYYYMMDD")]=n.oCalendar.DayData[t];l(i);p()==1&&setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},100)}else l([]),r=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r);y=!1},function(){y=!1}).getAvailablePermitsCalendar(n,-1)}function kt(){if(i()==null||r==null)p(1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roSelectDayInfo"),"info",2e3);else{var n=moment(k()).format("HH:mm"),t=moment(d()).format("HH:mm"),u=nt.getDocument(),e="1899-12-";e+=n>t?"31 ":"30 ";var o=moment("1899-12-30 "+n.format("HH:mm"),"YYYY-MM-DD HH:mm"),h=moment(e+t.format("HH:mm"),"YYYY-MM-DD HH:mm"),c=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},l=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(14),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var t=function(){f.saveOvertime(i()==null?VTPortalUtils.nullDate:i(),r()==null?VTPortalUtils.nullDate:r(),o,h,ct(),s()!=null?s():"-1",a(),!0,u)};VTPortalUtils.utils.processRequestErrorMessage(n,t,function(){})}};f==null&&(f=new WebServiceRobotics(l,c));f.saveOvertime(i()==null?VTPortalUtils.nullDate:i(),r()==null?VTPortalUtils.nullDate:r(),o,h,ct(),s()!=null?s():"-1",a(),!1,u)}}function dt(){typeof e()!="undefined"&&e()!=null&&e()>0?VTPortalUtils.utils.deleteProgrammedAbsence(e(),"overtime"):t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}function ct(){var n=moment(k()),t=moment(d()),i="1970-01-",r,u;return i+=n.isAfter(t)?"31":"30",r=moment("1970-01-30 "+n.format("HH:mm")+":00","YYYY-MM-DD HH:mm:ss"),u=moment(i+" "+t.format("HH:mm")+":00","YYYY-MM-DD HH:mm:ss"),moment(u.diff(r)).utc().format("HH:mm")}function gt(n){var t="",i="#dcdcdc",r="#dcdcdc",f=90,e=95,o=l()[moment(n.date).format("YYYYMMDD")],a=0,v=!1,h="";if(moment(n.date).format("YYYYMMDD")==moment().format("YYYYMMDD")&&(h="actualDate"),o!=null){if(o.MainShift!=null&&(a=o.MainShift.PlannedHours,v=o.IsHoliday),i=VTPortalUtils.calendar.getCellColor(u,n.date,n.view),absenceStyle="width:100%;height:100%;color: "+r+";",absenceStyle+="background: "+r+";",absenceStyle+="background: -webkit-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -moz-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -ms-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -o-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: radial-gradient(circle closest-side at center, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background-repeat: no-repeat;",absenceStyle+="background-position: center center;display:table;",t="width:100%;height:100%;color: #000000;",t+="background: "+i+";",t+="background: -webkit-radial-gradient(circle closest-side, "+i+" "+f+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -moz-radial-gradient(circle closest-side, "+i+" "+f+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -ms-radial-gradient(circle closest-side, "+i+" "+f+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -o-radial-gradient(circle closest-side, "+i+" "+f+"%,rgba(255,255,255,0) "+e+"%);",t+="background: radial-gradient(circle closest-side at center, "+i+" "+f+"%,rgba(255,255,255,0) "+e+"%);",t+="background-repeat: no-repeat;",t+="background-position: center center;display:table;",n.view=="month")return"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span class='"+h+"' style='display:table-cell;vertical-align:middle;font-weight:bold'>"+n.text+"<\/span><\/div><\/div><\/div><\/div>";if(n.view=="year"){if(moment(n.date).isAfter(moment(w()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(b()))){for(var s=moment(n.date).startOf("month"),p=moment(n.date).endOf("month"),c=0;s<p;)u[s.format("YYYYMMDD")]==!0&&(c+=1),s=s.add(1,"day");return c>0?"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+" ("+c+")<\/span><\/div><\/div><\/div><\/div>":"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+"<\/span><\/div><\/div><\/div><\/div>"}return""}}else return moment(n.date).isAfter(moment(w()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(b()))?(y||(y=!0,it(n.date)),"<span class='"+h+"' >"+n.text+"<\/span>"):""}var t=ko.observable(null),e=ko.observable(null),a=ko.observable(""),rt=ko.observable(!1),h=ko.observable(!1),ut=ko.observable(!1),ft=ko.observable(!1),v=ko.observable(!1),c=ko.observable(!1),l=ko.observable({}),y=!0,p=ko.observable(0),w=ko.observable(moment().startOf("day").startOf("year").add(-1,"year").toDate()),b=ko.observable(moment().startOf("day").endOf("year").add(1,"year").toDate()),u={},k=ko.observable(moment().startOf("day").toDate()),d=ko.observable(moment().endOf("day").toDate()),i=ko.observable(null),r=ko.observable(null),ii=ko.observable(i18nextko.i18n.t("roFindFile")),lt=ko.observable(i18nextko.i18n.t("roFileAdded")),et=ko.observable(!1),g=ko.observable([]),nt=new VTPortal.documentInput,at=ko.computed(function(){return!VTPortal.roApp.isTimeGate()&&g().length>0}),f,ht;typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));typeof n.param!="undefined"&&parseInt(n.param,10)!=-1&&(i(moment(n.param,"YYYY-MM-DD")),r(moment(n.param,"YYYY-MM-DD")),u[moment(n.param,"YYYY-MM-DD").format("YYYYMMDD")]=!0);var o=ko.observable(!1),s=ko.observable(null),tt=ko.observable([]),ot=VTPortal.approvalHistory(),vt=ko.computed(function(){return"76%"}),yt=function(){new WebServiceRobotics(function(n){var t,i,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(e(n.AbsenceId),a(n.Comments),n.ReqStatus==0?h(!0):h(!1),typeof e()!="undefined"&&e()!=null&&e()>0&&h(!0),c(!1),VTPortal.roApp.impersonatedIDEmployee!=-1&&(VTPortal.roApp.isImpersonateEnabled()==!1&&VTPortal.roApp.disableImpersonateActionsOnRequest(),(n.ReqStatus==0||n.ReqStatus==1)&&(c(!0),h(!1))),ot.refreshApprovals(n.RequestsHistoryEntries),t=moment(n.strDate1,"YYYY-MM-DD HH:mm:ss").startOf("day"),i=moment(n.strDate2,"YYYY-MM-DD HH:mm:ss").startOf("day");t<=i;)u[t.clone().add(12,"hours").format("YYYYMMDD")]=!0,t=t.add(1,"day");s(n.IdCause+"");k(moment(n.strFromTime,"YYYY-MM-DD HH:mm:ss").toDate());d(moment(n.strToTime,"YYYY-MM-DD HH:mm:ss").toDate());it(new Date)}else r=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r)},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())},pt=function(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)tt(n.SelectFields),t()!=null&&t()>0?yt(t()):(n.SelectFields.length>0&&s(n.SelectFields[0].FieldValue),it(new Date));else{var i=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,i)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},st=ko.observable(VTPortal.bigUserInfo()),wt=function(n){if(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.PortalNext)g([]),new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)g(n.SelectFields),nt.initializeData(n.SelectFields,!1,-1),i(null),r(null),o()||(u={});else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingCauseInfo"),"error",0,n)}).getRequieredCauseDocuments(parseInt(n.value,10));else{g([]);var t=tt().find(function(t){return parseInt(t.FieldValue,10)==parseInt(n.value,10)});t!=null?parseInt(t.RelatedInfo,10)>0?calendarSelectMode(parseInt(t.RelatedInfo,10)):calendarSelectMode(0):calendarSelectMode(0);i(null);r(null);o()||(u={})}};f=null;ht=function(){var i=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},r=function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDocumentUploaded"),"success",2e3)):VTPortalUtils.utils.processErrorMessage(n)},n;f==null&&(f=new WebServiceRobotics(r,i));n=nt.getDocument();VTPortal.roApp.isModeApp()==!1?(n.append("idRelatedObject",t()),n.append("forecastType","request"),f.uploadDocumentDesktop(n)):(n.append("idRelatedObject",t()),f.uploadDocumentMobile(n,"request","",""))};var ni=function(n){if(t()==null&&typeof l()[moment(n.value).format("YYYYMMDD")]!="undefined"){i()==null&&r()==null?(i(moment(n.value)),r(moment(n.value))):moment(n.value).isSame(i())?i(r()):moment(n.value).isSame(r())?r(i()):moment(n.value)>i()?r(moment(n.value)):moment(n.value)<i()&&i(moment(n.value));for(var f=moment(w()),e=moment(b());f<e;)f>=i()&&f<=r()?u[f.format("YYYYMMDD")]=!0:typeof u[f.format("YYYYMMDD")]!="undefined"&&(u[f.format("YYYYMMDD")]=!1),f=f.add(1,"day");$("#calendarSelectorContainer").dxCalendar("instance").repaint()}},ti=function(n){n.ID==2&&setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},200)};return{requestId:t,myApprovalsBlock:ot,myDocumentsBlock:nt,viewShown:bt,title:i18nextko.t("roRequestType_PlannedOvertime"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:i18nextko.t("roSelectOvertime"),lblInitialHour:i18nextko.t("roRequestInitialHourLbl"),lblEndHour:i18nextko.t("roRequestEndHourLbl"),lblSelectDaysInfo:i18nextko.t("roSelectDayInfo"),subscribeBlock:st(),selectedTab:p,scrollContent:{height:vt},tabPanelOptions:{dataSource:[{ID:1,cssClass:"dx-icon-configRequest"},{ID:2,cssClass:"dx-icon-selectDate"}],selectedIndex:p,itemTemplate:"title",onSelectionChanged:function(n){ti(n.addedItems[0])}},popupVisible:ft,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),14,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:c},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),14,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:c},btnCancelUpload:{onClick:function(){v(!1)},text:i18nextko.t("roCancel")},btnAcceptUpload:{onClick:function(){t()!=null&&t()>0?ht():(et(!0),v(!1))},text:i18nextko.t("roSaveRequest")},btnHistory:{onClick:function(){ft(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:ut},btnSave:{onClick:kt,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:rt},btnDocuments:{onClick:function(){v(!0)},text:"",hint:i18nextko.i18n.t("roLblDocument"),icon:"Images/Common/Document.png"},btnDelete:{onClick:dt,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:h},popupDocumentsVisible:v,fileAdded:lt,documentAttached:et,calendarOptions:{width:"100%",height:450,useCellTemplate:!0,cellTemplate:gt,firstDayOfWeek:moment()._locale._week.dow,maxZoomLevel:"month",zoomLevel:"year",minZoomLevel:"year",onCellClick:ni,showTodayButton:!1,min:w,max:b},remarks:{value:a,readOnly:o},beginHour:{type:"time",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:k,readOnly:o,valueChangeEvent:"focusout"},endHour:{type:"time",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:d,readOnly:o,valueChangeEvent:"focusout"},hasDocuments:at,cmbRequestValue1:{dataSource:tt,displayExpr:"FieldName",valueExpr:"FieldValue",value:s,readOnly:o,onValueChanged:wt},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.plannedHoliday=function(n){function ii(){if(pt().viewShown(),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Holidays)rt([]),ti("plannedholiday"),t()!=null&&t()>0&&(a(!0),VTPortalUtils.utils.markRequestAsRead(t())),VTPortal.roApp.impersonatedIDEmployee==-1?t()!=null&&k(!0):t()!=null&&d(!1),t()==null&&ht(!0),t()!=null&&ct(!0);else{var n=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roIncorrectApiVersion"),"error",0,n)}}function wt(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)w=n.Result,p()==1&&setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},100);else{var t=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}}).checkIsWorkingdayShift(n)}function st(n){new WebServiceRobotics(function(n){var i,t,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=f(),t=0;t<n.oCalendar.DayData.length;t++)i[moment.tz(n.oCalendar.DayData[t].PlanDate,VTPortal.roApp.serverTimeZone).add(12,"hours").format("YYYYMMDD")]=n.oCalendar.DayData[t];f(i);p()==1&&setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},100)}else f([]),r=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r);nt=!1},function(){nt=!1}).getAvailablePermitsCalendar(n,-1)}function ri(){e()=="S"?fi():ui()}function ui(){var r=moment(ut()).format("HH:mm"),f=moment(ft()).format("HH:mm"),e="1899-12-",c,l;e+=r>f?"31 ":"30 ";for(var s=moment("1899-12-30 "+r.format("HH:mm"),"YYYY-MM-DD HH:mm"),h=moment(e+f.format("HH:mm"),"YYYY-MM-DD HH:mm"),t="",n=moment().startOf("year").add(-1,"year"),a=moment().endOf("year").add(1,"year");n<a;)i[n.format("YYYYMMDD")],typeof i[n.format("YYYYMMDD")]!="undefined"&&i[n.format("YYYYMMDD")]==!0&&(t!=""&&(t+="/"),t+=n.format("YYYYMMDD")),n=n.add(1,"day");t==""?(p(1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roSelectDayInfo"),"info",2e3)):(c=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},l=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var i=function(){v.savePlannedHoliday(t,o(),s,h,u()==null?-1:u()/100,y(),!0)};VTPortalUtils.utils.processRequestErrorMessage(n,i,function(){})}},v=new WebServiceRobotics(l,c),v.savePlannedHoliday(t,o(),s,h,u()==null?-1:u()/100,y(),!1))}function fi(){for(var t="",n=moment().startOf("year").add(-1,"year"),e=moment().endOf("year").add(1,"year"),r,f;n<e;)i[n.format("YYYYMMDD")],typeof i[n.format("YYYYMMDD")]!="undefined"&&i[n.format("YYYYMMDD")]==!0&&(t!=""&&(t+="/"),t+=n.format("YYYYMMDD")),n=n.add(1,"day");r=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)};t==""?(p(1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roSelectDayInfo"),"info",2e3)):(f=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(13),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var i=function(){v.savePermissions(t,u()==null?-1:u(),y(),!0)};VTPortalUtils.utils.processRequestErrorMessage(n,i,function(){})}},v=new WebServiceRobotics(f,r),v.savePermissions(t,u()==null?-1:u(),y(),!1))}function ei(){t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}function oi(n){var u="",o="#dcdcdc",h="#dcdcdc",l=90,a=95,c=f()[moment(n.date).format("YYYYMMDD")],p=0,k=!1,v="";if(moment(n.date).format("YYYYMMDD")==moment().format("YYYYMMDD")&&(v="actualDate"),c!=null){if(c.MainShift!=null&&(p=c.MainShift.PlannedHours,k=e()=="C"?c.IsHoliday:c.IsHoliday||c.Alerts.OnHolidaysHours),o=VTPortalUtils.calendar.getCellColor(i,n.date,n.view),absenceStyle="width:100%;height:100%;color: "+h+";",absenceStyle+="background: "+h+";",absenceStyle+="background: -webkit-radial-gradient(circle closest-side, "+h+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -moz-radial-gradient(circle closest-side, "+h+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -ms-radial-gradient(circle closest-side, "+h+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -o-radial-gradient(circle closest-side, "+h+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: radial-gradient(circle closest-side at center, "+h+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background-repeat: no-repeat;",absenceStyle+="background-position: center center;display:table;",u="width:100%;height:100%;color: #000000;",u+="background: "+o+";",u+="background: -webkit-radial-gradient(circle closest-side, "+o+" "+l+"%,rgba(255,255,255,0) "+a+"%);",u+="background: -moz-radial-gradient(circle closest-side, "+o+" "+l+"%,rgba(255,255,255,0) "+a+"%);",u+="background: -ms-radial-gradient(circle closest-side, "+o+" "+l+"%,rgba(255,255,255,0) "+a+"%);",u+="background: -o-radial-gradient(circle closest-side, "+o+" "+l+"%,rgba(255,255,255,0) "+a+"%);",u+="background: radial-gradient(circle closest-side at center, "+o+" "+l+"%,rgba(255,255,255,0) "+a+"%);",u+="background-repeat: no-repeat;",u+="background-position: center center;display:table;",n.view=="month")return moment(n.date).isAfter(moment(s()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(b()))?moment(n.date).startOf("day")>=moment(s()).startOf("day")?(p>0&&w==!0||w==!1)&&k==!1||t()>0?"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+u+"'> <span class='"+v+"' style='display:table-cell;vertical-align:middle;font-weight:bold'>"+n.text+"<\/span><\/div><\/div><\/div><\/div>":"<div class='no-working-day'> <span class='"+v+"' >"+n.text+"<\/span><\/div>":"<span class='"+v+"' >"+n.text+"<\/span>":"";if(n.view=="year"){if(moment(n.date).isAfter(moment(s()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(b()))){for(var r=moment(n.date).startOf("month"),d=moment(n.date).endOf("month"),g=!1,y=0;r<d;){if(typeof f()[r.format("YYYYMMDD")]!="undefined"&&f()[r.format("YYYYMMDD")].MainShift!=null&&f()[r.format("YYYYMMDD")].MainShift.PlannedHours>0&&f()[r.format("YYYYMMDD")].IsHoliday==!1){g=!0;break}r=r.add(1,"day")}for(r=moment(n.date).startOf("month"),r<moment().startOf("day")&&(r=moment().startOf("day"));r<d;)i[r.format("YYYYMMDD")]==!0&&(y+=1),r=r.add(1,"day");return g||t()>0?y>0?"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+u+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+" ("+y+")<\/span><\/div><\/div><\/div><\/div>":"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+u+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+"<\/span><\/div><\/div><\/div><\/div>":"<span>"+n.text+"<\/span>"}return""}}else return moment(n.date).isAfter(moment(s()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(b()))?(nt||(nt=!0,st(n.date)),"<span class='"+v+"' >"+n.text+"<\/span>"):""}var t=ko.observable(null),y=ko.observable(""),ht=ko.observable(!1),k=ko.observable(!1),ct=ko.observable(!1),lt=ko.observable(!1),d=ko.observable(!1),o=ko.observable(!0),f=ko.observable({}),nt=!0,p=ko.observable(0),w=!1,e=ko.observable(""),s=ko.observable(moment().startOf("day").startOf("year").add(-1,"year").toDate()),b=ko.observable(moment().startOf("day").endOf("year").add(1,"year").toDate()),r=[{ID:1,cssClass:"dx-icon-configRequest"},{ID:2,cssClass:"dx-icon-selectDate"}],tt,v;$.grep(VTPortal.roApp.empPermissions().Requests,function(n){return n.RequestType==9&&n.Permission==!0&&typeof n.HasRankings!="undefined"&&n.HasRankings==!0}).length==1&&(tt=r.find(function(n){return n.ID=="3"}),tt==null&&r.push({ID:3,cssClass:"dx-icon-rankings",badge:""}));var i={},ut=ko.observable(moment().startOf("day").toDate()),ft=ko.observable(moment().endOf("day").toDate()),h=ko.observable(!0),c=ko.observable(!1),l=ko.observable(!1),it=ko.observable([]),at=ko.observable(0),vt=ko.observable(0),et=ko.observable(0),g=ko.observable(0),ot=ko.observable(0);typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));$.grep(VTPortal.roApp.empPermissions().Requests,function(n){return n.RequestType==6&&n.Permission==!0&&typeof n.HasRankings!="undefined"&&n.HasRankings==!0||n.RequestType==13&&n.Permission==!0&&typeof n.HasRankings!="undefined"&&n.HasRankings==!0}).length==1&&(tt=r.find(function(n){return n.ID=="3"}),tt==null&&r.push({ID:3,cssClass:"dx-icon-rankings",badge:""}));var bt=function(n){a()||(i={});var t=$.grep(rt(),function(t){return t.FieldValue==n.value});g(6);ot(parseInt(n.value,10));t.length>0&&(t[0].RelatedInfo=="S"?(g(6),wt(parseInt(n.value,10)),o(!0)):(g(13),w=!0),e(t[0].RelatedInfo))},kt=function(){var n=r.find(function(n){return n.ID==3}),f,e;if(n==null&&(n={ID:3,cssClass:"dx-icon-rankings",badge:""}),et()==0||et()==1)if(VTPortalUtils.utils.checkIfRequestHasRanquings(g(),ot())){var o=null,s=function(){h(!0);c(!1);l(!1);VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorRequestingRankings"),"error",0)},a=function(t){if(t.Status==window.VTPortalUtils.constants.OK.value){if(setTimeout(function(){$("#configRequestTab").dxTabs("instance").repaint()},150),t.Rankings!=null){for(var i=0;i<t.Rankings.RequestEmployeeRankingPositions.length;i++)t.Rankings.RequestEmployeeRankingPositions[i].cssClass=t.Rankings.RequestEmployeeRankingPositions[i].IDEmployee==VTPortal.roApp.employeeId?"rankingMyPosition":"listMenuItemPosition";it(t.Rankings.RequestEmployeeRankingPositions)}else it([]);n.badge=t.RankingEnabled?t.ActualPosition:"";t.CoverageEnabled&&(at(t.Coverages.MinCoverage),vt(t.Coverages.DifferentialQuantity),n.badge=n.badge+"/"+t.Coverages.DifferentialQuantity);r=r.remove(function(n){return n.ID==3});r.push(n);h(!1);c(t.RankingEnabled);l(t.CoverageEnabled)}else h(!0),c(!1),l(!1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorRequestingRankings"),"error",0)};o==null&&(o=new WebServiceRobotics(a,s));for(var u="",t=moment().startOf("year"),v=moment().endOf("year").add(1,"year");t<v;)i[t.format("YYYYMMDD")],typeof i[t.format("YYYYMMDD")]!="undefined"&&i[t.format("YYYYMMDD")]==!0&&(u!=""&&(u+="/"),u+=t.format("YYYYMMDD")),t=t.add(1,"day");f=u.split("/");e=null;f.length>0&&f[0]!=""&&(e=moment(f[0],"YYYYMMDD"));e!=null?o.getRankingForDay(e,g(),ot()):(h(!0),c(!1),l(!1))}else n.badge="",r=r.remove(function(n){return n.ID==3}),r.push(n),h(!0),c(!1),l(!1),setTimeout(function(){$("#configRequestTab").dxTabs("instance").repaint()},150);else n.badge="",r=r.remove(function(n){return n.ID==3}),r.push(n),h(!0),c(!1),l(!1),setTimeout(function(){$("#configRequestTab").dxTabs("instance").repaint()},150)},a=ko.observable(!1),dt=ko.computed(function(){return e()=="C"}),u=ko.observable(null),rt=ko.observable([]),yt=VTPortal.approvalHistory(),gt=ko.computed(function(){return"76%"}),ni=function(){new WebServiceRobotics(function(n){var t,r,f,h;if(n.Status==window.VTPortalUtils.constants.OK.value){if(y(n.Comments),et(n.ReqStatus),n.ReqStatus==0?k(!0):k(!1),d(!1),VTPortal.roApp.impersonatedIDEmployee!=-1&&(n.ReqStatus==0||n.ReqStatus==1)&&(d(!0),k(!1)),yt.refreshApprovals(n.RequestsHistoryEntries),moment(n.strDate1,"YYYY-MM-DD HH:mm:ss")<moment(s())&&s(moment(n.strDate1,"YYYY-MM-DD HH:mm:ss").startOf("month").toDate()),moment(n.strDate2,"YYYY-MM-DD HH:mm:ss")>moment(b())&&b(moment(n.strDate2,"YYYY-MM-DD HH:mm:ss").endOf("year")),n.RequestDays!=null&&n.RequestDays.length>0)for(t=0;t<n.RequestDays.length;t++)o(n.RequestDays[t].AllDay),i[moment.tz(n.RequestDays[t].RequestDate,VTPortal.roApp.serverTimeZone).add(12,"hours").format("YYYYMMDD")]=!0,ut(moment.tz(n.RequestDays[t].FromTime,VTPortal.roApp.serverTimeZone).toDate()),ft(moment.tz(n.RequestDays[t].ToTime,VTPortal.roApp.serverTimeZone).toDate());else for(o(!0),r=moment(n.strDate1,"YYYY-MM-DD HH:mm:ss").startOf("day"),f=moment(n.strDate2,"YYYY-MM-DD HH:mm:ss").startOf("day");r<=f;)i[r.clone().add(12,"hours").format("YYYYMMDD")]=!0,r=r.add(1,"day");n.RequestType==6?(e("S"),u(n.IdShift+"")):n.RequestType==13&&(e("C"),u(n.IdCause+""));st(new Date)}else h=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,h)},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())},ti=function(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)n.SelectFields.forEach(function(n){n.RelatedInfo=="C"&&(n.FieldValue=n.FieldValue*100)}),rt(n.SelectFields),t()!=null&&t()>0?ni(t()):n.SelectFields.length>0&&(u(n.SelectFields[0].FieldValue),e(n.SelectFields[0].RelatedInfo),n.SelectFields[0].RelatedInfo=="S"&&wt(n.SelectFields[0].FieldValue),st(new Date));else{var i=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,i)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},pt=ko.observable(VTPortal.bigUserInfo());v=null;var si=function(n){var c,u;if(t()==null&&typeof f()[moment(n.value).format("YYYYMMDD")]!="undefined"&&(c=!1,u=f()[moment(n.value).format("YYYYMMDD")],c=e()=="C"?u.IsHoliday:u.IsHoliday||u.Alerts.OnHolidaysHours,(u.MainShift!=null&&u.MainShift.PlannedHours>0>0&&w==!0||w==!1)&&c==!1))if(typeof i[moment(n.value).format("YYYYMMDD")]!="undefined"&&i[moment(n.value).format("YYYYMMDD")]==!0)i[moment(n.value).format("YYYYMMDD")]=!1,$("#"+moment(n.value).format("YYYYMMDD")).css("background","transparent");else{i[moment(n.value).format("YYYYMMDD")]=!0;var o="#0046FE",s=90,h=95,r="width:100%;height:100%;color: #000000;";r+="background: "+o+";";r+="background: -webkit-radial-gradient(circle closest-side, "+o+" "+s+"%,rgba(255,255,255,0) "+h+"%);";r+="background: -moz-radial-gradient(circle closest-side, "+o+" "+s+"%,rgba(255,255,255,0) "+h+"%);";r+="background: -ms-radial-gradient(circle closest-side, "+o+" "+s+"%,rgba(255,255,255,0) "+h+"%);";r+="background: -o-radial-gradient(circle closest-side, "+o+" "+s+"%,rgba(255,255,255,0) "+h+"%);";r+="background: radial-gradient(circle closest-side at center, "+o+" "+s+"%,rgba(255,255,255,0) "+h+"%);";r+="background-repeat: no-repeat;";r+="background-position: center center;display:table;";$("#"+moment(n.value).format("YYYYMMDD")).attr("style",r)}},hi=function(n){n.ID==2?setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},200):n.ID==3&&kt()};return{requestId:t,myApprovalsBlock:yt,viewShown:ii,title:i18nextko.t("roRequestType_PlannedHoliday"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:i18nextko.t("roSelectPlannedHoliday"),lblInitialHour:i18nextko.t("roRequestInitialHourLbl"),lblEndHour:i18nextko.t("roRequestEndHourLbl"),lblAllDay:i18nextko.t("roRequestAllDayLbl"),lblSelectDaysInfo:i18nextko.t("roSelectDayInfo"),subscribeBlock:pt(),selectedTab:p,scrollContent:{height:gt},tabPanelOptions:{dataSource:r,selectedIndex:p,itemTemplate:"title",onSelectionChanged:function(n){hi(n.addedItems[0])}},popupVisible:lt,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),13,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:d},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),13,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:d},btnHistory:{onClick:function(){lt(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:ct},btnSave:{onClick:ri,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:ht},btnDelete:{onClick:ei,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:k},calendarOptions:{width:"100%",height:450,useCellTemplate:!0,cellTemplate:oi,firstDayOfWeek:moment()._locale._week.dow,maxZoomLevel:"month",zoomLevel:"year",minZoomLevel:"year",onCellClick:si,showTodayButton:!1,min:s,max:b},remarks:{value:y,readOnly:a},ckAllDay:{text:i18nextko.t("roRequestAllDayLbl"),value:o,readOnly:a,visible:dt},beginHour:{type:"time",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:ut,readOnly:a,valueChangeEvent:"focusout"},endHour:{type:"time",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:ft,readOnly:a,valueChangeEvent:"focusout"},cmbRequestValue1:{dataSource:rt,displayExpr:"FieldName",valueExpr:"FieldValue",value:u,readOnly:a,onValueChanged:bt},allDayPermit:o,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),noRankingDateSelected:h,hasRankingData:c,hasCoverageData:l,rankingDS:it,listRanking:{dataSource:it,scrollingEnabled:!1,collapsibleGroups:!1,itemTemplate:"RankingItem"},lblRankingHeader:i18nextko.t("roRankingTitle"),lblCoverageHeader:i18nextko.t("roCoverageTitle"),lblNoDataDescription:i18nextko.t("roNoRankingDescription"),lblMinimumCoverageRequiered:i18nextko.t("rolblMinimumCoverageRequiered"),txtMinimumCoverageRequiered:{value:at,readOnly:!0},lblDiferentialCoverage:i18nextko.t("rolblDiferentialCoverage"),txtDifferentialCoverage:{value:vt,readOnly:!0}}};VTPortal.plannedCause=function(n){function ci(){if(ti().viewShown(),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Holidays)k([]),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.CausesPermissions?ni("causes.programmedCause"):ni("causes.visibilitypermissions"),t()!=null&&t()>0&&(h(!0),VTPortalUtils.utils.markRequestAsRead(t())),VTPortal.roApp.impersonatedIDEmployee==-1?t()!=null&&c(!0):t()!=null&&y(!1),t()==null&&vt(!0),t()!=null&&yt(!0);else{var n=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roIncorrectApiVersion"),"error",0,n)}}function at(n){new WebServiceRobotics(function(n){var i,t,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=p(),t=0;t<n.oCalendar.DayData.length;t++)i[moment.tz(n.oCalendar.DayData[t].PlanDate,VTPortal.roApp.serverTimeZone).add(12,"hours").format("YYYYMMDD")]=n.oCalendar.DayData[t];p(i);tt()==1&&setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},100)}else p([]),r=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r);nt=!1},function(){nt=!1}).getAvailablePermitsCalendar(n,-1)}function li(){if(i()==null||r==null)tt(1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roSelectDayInfo"),"info",2e3);else{var n=moment(ht()).format("HH:mm"),t=moment(ct()).format("HH:mm"),u="1899-12-";u+=n>t?"31 ":"30 ";var f=moment("1899-12-30 "+n.format("HH:mm"),"YYYY-MM-DD HH:mm"),o=moment(u+t.format("HH:mm"),"YYYY-MM-DD HH:mm"),h=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},s=st.getDocument(),c=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(9),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var t=function(){e.saveIncidence(i()==null?VTPortalUtils.nullDate:i(),r()==null?VTPortalUtils.nullDate:r(),f,o,moment(w()).format("HH:mm"),b(),d(),!0,s)};VTPortalUtils.utils.processRequestErrorMessage(n,t,function(){})}};e==null&&(e=new WebServiceRobotics(c,h));e.saveIncidence(i()==null?VTPortalUtils.nullDate:i(),r()==null?VTPortalUtils.nullDate:r(),f,o,moment(w()).format("HH:mm"),b(),d(),!1,s)}}function ai(){typeof o()!="undefined"&&o()!=null&&o()>0?VTPortalUtils.utils.deleteProgrammedAbsence(o(),"hours"):t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}function ii(){var n=moment(ht()),t=moment(ct()),i="1970-01-",r,u;i+=n.isAfter(t)?"31":"30";r=moment("1970-01-30 "+n.format("HH:mm")+":00","YYYY-MM-DD HH:mm:ss");u=moment(i+" "+t.format("HH:mm")+":00","YYYY-MM-DD HH:mm:ss");w(moment("1970-01-30 "+moment(u.diff(r)).utc().format("HH:mm")+":00").toDate())}function vi(n){var t="",i="#dcdcdc",r="#dcdcdc",u=90,e=95,o=p()[moment(n.date).format("YYYYMMDD")],l=0,a=!1,h="";if(moment(n.date).format("YYYYMMDD")==moment().format("YYYYMMDD")&&(h="actualDate"),o!=null){if(o.MainShift!=null&&(l=o.MainShift.PlannedHours,a=o.IsHoliday),i=VTPortalUtils.calendar.getCellColor(f,n.date,n.view),absenceStyle="width:100%;height:100%;color: "+r+";",absenceStyle+="background: "+r+";",absenceStyle+="background: -webkit-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -moz-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -ms-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -o-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: radial-gradient(circle closest-side at center, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background-repeat: no-repeat;",absenceStyle+="background-position: center center;display:table;",t="width:100%;height:100%;color: #000000;",t+="background: "+i+";",t+="background: -webkit-radial-gradient(circle closest-side, "+i+" "+u+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -moz-radial-gradient(circle closest-side, "+i+" "+u+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -ms-radial-gradient(circle closest-side, "+i+" "+u+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -o-radial-gradient(circle closest-side, "+i+" "+u+"%,rgba(255,255,255,0) "+e+"%);",t+="background: radial-gradient(circle closest-side at center, "+i+" "+u+"%,rgba(255,255,255,0) "+e+"%);",t+="background-repeat: no-repeat;",t+="background-position: center center;display:table;",n.view=="month")return"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span class='"+h+"' style='display:table-cell;vertical-align:middle;font-weight:bold'>"+n.text+"<\/span><\/div><\/div><\/div><\/div>";if(n.view=="year"){if(moment(n.date).isAfter(moment(it()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(rt()))){for(var s=moment(n.date).startOf("month"),v=moment(n.date).endOf("month"),c=0;s<v;)f[s.format("YYYYMMDD")]==!0&&(c+=1),s=s.add(1,"day");return c>0?"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+" ("+c+")<\/span><\/div><\/div><\/div><\/div>":"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+"<\/span><\/div><\/div><\/div><\/div>"}return""}}else return moment(n.date).isAfter(moment(it()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(rt()))?(nt||(nt=!0,at(n.date)),"<span class='"+h+"' >"+n.text+"<\/span>"):""}var t=ko.observable(null),o=ko.observable(null),d=ko.observable(""),vt=ko.observable(!1),c=ko.observable(!1),yt=ko.observable(!1),wi=ko.observable(!1),g=ko.observable(!1),pt=ko.observable(!1),y=ko.observable(!1),p=ko.observable({}),nt=!0,tt=ko.observable(0),it=ko.observable(moment().startOf("day").startOf("year").add(-1,"year").toDate()),rt=ko.observable(moment().startOf("day").endOf("year").add(1,"year").toDate()),u=[{ID:1,cssClass:"dx-icon-configRequest"},{ID:2,cssClass:"dx-icon-selectDate"}],wt,e;$.grep(VTPortal.roApp.empPermissions().Requests,function(n){return n.RequestType==9&&n.Permission==!0&&typeof n.HasRankings!="undefined"&&n.HasRankings==!0}).length==1&&(wt=u.find(function(n){return n.ID=="3"}),wt==null&&u.push({ID:3,cssClass:"dx-icon-rankings",badge:""}));var l=ko.observable(!0),a=ko.observable(!1),v=ko.observable(!1),ut=ko.observable([]),bt=ko.observable(0),kt=ko.observable(0),lt=ko.observable(0),ft=ko.observable(0),et=ko.observable(0),ri=ko.observable(i18nextko.i18n.t("roFileAdded")),dt=ko.observable(!1),s=ko.observable(0),ot=ko.observable([]),st=new VTPortal.documentInput,ui=ko.computed(function(){return!VTPortal.roApp.isTimeGate()&&ot().length>0}),fi=function(n){if(ot([]),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.PortalNext)new WebServiceRobotics(function(t){var i,r;t.Status==window.VTPortalUtils.constants.OK.value?(ot(t.SelectFields),st.initializeData(t.SelectFields,!1,-1),ft(9),et(parseInt(n.value,10)),i=k().find(function(t){return parseInt(t.FieldValue,10)==parseInt(n.value,10)}),i!=null?parseInt(i.RelatedInfo,10)>0?s(parseInt(i.RelatedInfo,10)):s(0):s(0),h()||(f={})):(r=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(t,r))},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingCauseInfo"),"error",0,n)}).getRequieredCauseDocuments(parseInt(n.value,10));else{ot([]);ft(9);et(parseInt(n.value,10));var t=k().find(function(t){return parseInt(t.FieldValue,10)==parseInt(n.value,10)});t!=null?parseInt(t.RelatedInfo,10)>0?s(parseInt(t.RelatedInfo,10)):s(0):s(0);h()||(f={})}},ei=function(){var n=u.find(function(n){return n.ID==3});if(n==null&&(n={ID:3,cssClass:"dx-icon-rankings",badge:""}),lt()==0||lt()==1)if(VTPortalUtils.utils.checkIfRequestHasRanquings(ft(),et())){var t=null,r=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorRequestingRankings"),"error",0)},f=function(t){if(t.Status==window.VTPortalUtils.constants.OK.value){if(setTimeout(function(){$("#configRequestTab").dxTabs("instance").repaint()},150),t.Rankings!=null){for(var i=0;i<t.Rankings.RequestEmployeeRankingPositions.length;i++)t.Rankings.RequestEmployeeRankingPositions[i].cssClass=t.Rankings.RequestEmployeeRankingPositions[i].IDEmployee==VTPortal.roApp.employeeId?"rankingMyPosition":"listMenuItemPosition";ut(t.Rankings.RequestEmployeeRankingPositions)}else ut([]);n.badge=t.RankingEnabled?t.ActualPosition:"";t.CoverageEnabled&&(bt(t.Coverages.MinCoverage),kt(t.Coverages.DifferentialQuantity),n.badge=n.badge+"/"+t.Coverages.DifferentialQuantity);u=u.remove(function(n){return n.ID==3});u.push(n);l(!1);a(t.RankingEnabled);v(t.CoverageEnabled)}else l(!0),a(!1),v(!1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorRequestingRankings"),"error",0)};t==null&&(t=new WebServiceRobotics(f,r));i()!=null?t.getRankingForDay(i(),ft(),et()):(l(!0),a(!1),v(!1))}else l(!0),a(!1),v(!1),n.badge="",u=u.remove(function(n){return n.ID==3}),u.push(n),setTimeout(function(){$("#configRequestTab").dxTabs("instance").repaint()},150);else l(!0),a(!1),v(!1),n.badge="",u=u.remove(function(n){return n.ID==3}),u.push(n),setTimeout(function(){$("#configRequestTab").dxTabs("instance").repaint()},150)},f={},ht=ko.observable(moment().startOf("day").toDate()),ct=ko.observable(moment().endOf("day").toDate()),i=ko.observable(null),r=ko.observable(null),ht=ko.observable(moment().startOf("day").toDate()),ct=ko.observable(moment().endOf("day").toDate()),w=ko.observable(moment().endOf("day").toDate());typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));typeof n.param!="undefined"&&parseInt(n.param,10)!=-1&&(f[moment(n.param,"YYYY-MM-DD").format("YYYYMMDD")]=!0);var h=ko.observable(!1),b=ko.observable(null),k=ko.observable([]),gt=VTPortal.approvalHistory(),oi=ko.computed(function(){return"76%"}),si=function(){new WebServiceRobotics(function(n){var t,i,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(d(n.Comments),o(n.AbsenceId),lt(n.ReqStatus),n.ReqStatus==0?c(!0):c(!1),typeof o()!="undefined"&&o()!=null&&o()>0&&VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Forecast!=null&&c(VTPortal.roApp.empPermissions().Forecast),y(!1),VTPortal.roApp.impersonatedIDEmployee!=-1&&(n.ReqStatus==0||n.ReqStatus==1)&&(y(!0),c(!1)),gt.refreshApprovals(n.RequestsHistoryEntries),t=moment(n.strDate1,"YYYY-MM-DD HH:mm:ss").startOf("day"),i=moment(n.strDate2,"YYYY-MM-DD HH:mm:ss").startOf("day");t<=i;)f[t.clone().add(12,"hours").format("YYYYMMDD")]=!0,t=t.add(1,"day");b(n.IdCause+"");ht(moment(n.strFromTime,"YYYY-MM-DD HH:mm:ss").toDate());ct(moment(n.strToTime,"YYYY-MM-DD HH:mm:ss").toDate());w(moment(n.strHours,"HH:mm").toDate());at(new Date)}else r=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r)},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())},hi=function(){var i=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},r=function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDocumentUploaded"),"success",2e3)):VTPortalUtils.utils.processErrorMessage(n)},n;e==null&&(e=new WebServiceRobotics(r,i));n=st.getDocument();VTPortal.roApp.isModeApp()==!1?(n.append("idRelatedObject",t()),n.append("forecastType","request"),e.uploadDocumentDesktop(n)):(n.append("idRelatedObject",t()),e.uploadDocumentMobile(n,"request","",""))},ni=function(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)k(n.SelectFields),t()!=null&&t()>0?si(t()):(n.SelectFields.length>0&&b(n.SelectFields[0].FieldValue),at(new Date));else{var i=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,i)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},ti=ko.observable(VTPortal.bigUserInfo());e=null;var yi=function(n){var u,e;if(t()==null&&typeof p()[moment(n.value).format("YYYYMMDD")]!="undefined"){if(s()==0)for(i()==null&&r()==null?(i(moment(n.value)),r(moment(n.value))):moment(n.value).isSame(i())?i(r()):moment(n.value).isSame(r())?r(i()):moment(n.value)>i()?r(moment(n.value)):moment(n.value)<i()&&i(moment(n.value)),u=moment(it()),e=moment(rt());u<e;)u>=i()&&u<=r()?f[u.format("YYYYMMDD")]=!0:typeof f[u.format("YYYYMMDD")]!="undefined"&&(f[u.format("YYYYMMDD")]=!1),u=u.add(1,"day");else{if(u=null,e=null,i()!=null&&(u=i().clone()),r()!=null&&(e=r().clone()),u!=null)while(u<=e)f[u.format("YYYYMMDD")]=!1,u=u.add(1,"day");for(i(moment(n.value)),r(i().clone().add(s()-1,"day")),u=i().clone(),e=r().clone();u<=e;)f[u.format("YYYYMMDD")]=!0,u=u.add(1,"day")}$("#calendarSelectorContainer").dxCalendar("instance").repaint()}},pi=function(n){n.ID==2?setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},200):n.ID==3&&ei()};return{requestId:t,myApprovalsBlock:gt,viewShown:ci,title:i18nextko.t("roRequestType_PlannedCauses"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:i18nextko.t("roSelectAbsence"),lblInitialHour:i18nextko.t("roRequestInitialHourLbl"),lblEndHour:i18nextko.t("roRequestEndHourLbl"),lblSelectDaysInfo:i18nextko.t("roSelectDayInfo"),lblDuration:i18nextko.t("roRequestDurationLbl"),subscribeBlock:ti(),selectedTab:tt,scrollContent:{height:oi},tabPanelOptions:{dataSource:u,selectedIndex:tt,itemTemplate:"title",onSelectionChanged:function(n){pi(n.addedItems[0])}},lblDocument:i18nextko.t("roLblDocument"),popupDocumentsVisible:g,btnCancelUpload:{onClick:function(){g(!1)},text:i18nextko.t("roCancel")},btnDocuments:{onClick:function(){g(!0)},text:"",hint:i18nextko.i18n.t("roLblDocument"),icon:"Images/Common/Document.png"},btnAcceptUpload:{onClick:function(){t()!=null&&t()>0?hi():(g(!1),dt(!0))},text:i18nextko.t("roSaveRequest")},popupVisible:pt,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),9,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:y},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),9,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:y},btnHistory:{onClick:function(){pt(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:yt},btnSave:{onClick:li,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:vt},btnDelete:{onClick:ai,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:c},calendarOptions:{width:"100%",useCellTemplate:!0,cellTemplate:vi,firstDayOfWeek:moment()._locale._week.dow,maxZoomLevel:"month",zoomLevel:"year",minZoomLevel:"year",onCellClick:yi,showTodayButton:!1,min:it,max:rt},remarks:{value:d,readOnly:h},beginHour:{type:"time",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:ht,readOnly:h,onValueChanged:ii,valueChangeEvent:"focusout"},endHour:{type:"time",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:ct,readOnly:h,onValueChanged:ii,valueChangeEvent:"focusout"},duration:{type:"time",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:w,readOnly:h,valueChangeEvent:"focusout"},cmbRequestValue1:{dataSource:k,displayExpr:"FieldName",valueExpr:"FieldValue",value:b,readOnly:h,onValueChanged:fi},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),noRankingDateSelected:l,hasRankingData:a,hasCoverageData:v,rankingDS:ut,listRanking:{dataSource:ut,scrollingEnabled:!1,collapsibleGroups:!1,itemTemplate:"RankingItem"},lblRankingHeader:i18nextko.t("roRankingTitle"),lblCoverageHeader:i18nextko.t("roCoverageTitle"),lblNoDataDescription:i18nextko.t("roNoRankingDescription"),lblMinimumCoverageRequiered:i18nextko.t("rolblMinimumCoverageRequiered"),txtMinimumCoverageRequiered:{value:bt,readOnly:!0},lblDiferentialCoverage:i18nextko.t("rolblDiferentialCoverage"),txtDifferentialCoverage:{value:kt,readOnly:!0},myDocumentsBlock:st,hasDocuments:ui,fileAdded:ri,documentAttached:dt}};VTPortal.plannedAbsence=function(n){function si(){if(dt().viewShown(),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Holidays)b([]),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.CausesPermissions?kt("causes.programmedAbsence"):kt("causes.visibilitypermissions"),i()!=null&&i()>0&&(p(!0),VTPortalUtils.utils.markRequestAsRead(i())),VTPortal.roApp.impersonatedIDEmployee==-1?i()!=null&&h(!0):i()!=null&&v(!1),i()==null&&ct(!0),i()!=null&&lt(!0);else{var n=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roIncorrectApiVersion"),"error",0,n)}}function ht(n){new WebServiceRobotics(function(n){var i,t,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=y(),t=0;t<n.oCalendar.DayData.length;t++)i[moment.tz(n.oCalendar.DayData[t].PlanDate,VTPortal.roApp.serverTimeZone).add(12,"hours").format("YYYYMMDD")]=n.oCalendar.DayData[t];y(i);nt()==1&&setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},100)}else y([]),r=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r);g=!1},function(){g=!1}).getAvailablePermitsCalendar(n,-1)}function hi(){t()==null||r==null?(nt(1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roSelectDayInfo"),"info",2e3)):ci()}function ci(){var i=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},n=ot.getDocument(),u=function(i){if(i.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(7),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var u=function(){e.saveAbsences(t()==null?VTPortalUtils.nullDate:t(),r()==null?VTPortalUtils.nullDate:r(),w(),k(),!0,n)};VTPortalUtils.utils.processRequestErrorMessage(i,u,function(){})}};e==null&&(e=new WebServiceRobotics(u,i));e.saveAbsences(t()==null?VTPortalUtils.nullDate:t(),r()==null?VTPortalUtils.nullDate:r(),w(),k(),!1,n)}function li(){typeof o()!="undefined"&&o()!=null&&o()>0?VTPortalUtils.utils.deleteProgrammedAbsence(o(),"days"):i()!=null&&i()>0&&VTPortalUtils.utils.deleteRequest(i())}function ai(n){var t="",i="#dcdcdc",r="#dcdcdc",u=90,e=95,o=y()[moment(n.date).format("YYYYMMDD")],l=0,a=!1,h="";if(moment(n.date).format("YYYYMMDD")==moment().format("YYYYMMDD")&&(h="actualDate"),o!=null){if(o.MainShift!=null&&(l=o.MainShift.PlannedHours,a=o.IsHoliday),i=VTPortalUtils.calendar.getCellColor(f,n.date,n.view),absenceStyle="width:100%;height:100%;color: "+r+";",absenceStyle+="background: "+r+";",absenceStyle+="background: -webkit-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -moz-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -ms-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -o-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: radial-gradient(circle closest-side at center, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background-repeat: no-repeat;",absenceStyle+="background-position: center center;display:table;",t="width:100%;height:100%;color: #000000;",t+="background: "+i+";",t+="background: -webkit-radial-gradient(circle closest-side, "+i+" "+u+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -moz-radial-gradient(circle closest-side, "+i+" "+u+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -ms-radial-gradient(circle closest-side, "+i+" "+u+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -o-radial-gradient(circle closest-side, "+i+" "+u+"%,rgba(255,255,255,0) "+e+"%);",t+="background: radial-gradient(circle closest-side at center, "+i+" "+u+"%,rgba(255,255,255,0) "+e+"%);",t+="background-repeat: no-repeat;",t+="background-position: center center;display:table;",n.view=="month")return"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span class='"+h+"' style='display:table-cell;vertical-align:middle;font-weight:bold'>"+n.text+"<\/span><\/div><\/div><\/div><\/div>";if(n.view=="year"){if(moment(n.date).isAfter(moment(tt()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(it()))){for(var s=moment(n.date).startOf("month"),v=moment(n.date).endOf("month"),c=0;s<v;)f[s.format("YYYYMMDD")]==!0&&(c+=1),s=s.add(1,"day");return c>0?"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+" ("+c+")<\/span><\/div><\/div><\/div><\/div>":"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+"<\/span><\/div><\/div><\/div><\/div>"}return""}}else return moment(n.date).isAfter(moment(tt()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(it()))?(g||(g=!0,ht(n.date)),"<span class='"+h+"' >"+n.text+"<\/span>"):""}var i=ko.observable(null),o=ko.observable(null),k=ko.observable(""),ct=ko.observable(!1),h=ko.observable(!1),lt=ko.observable(!1),pi=ko.observable(!1),d=ko.observable(!1),at=ko.observable(!1),v=ko.observable(!1),y=ko.observable({}),g=!0,nt=ko.observable(0),tt=ko.observable(moment().startOf("day").startOf("year").add(-1,"year").toDate()),it=ko.observable(moment().startOf("day").endOf("year").add(1,"year").toDate()),u=[{ID:1,cssClass:"dx-icon-configRequest",badge:0},{ID:2,cssClass:"dx-icon-selectDate",badge:0}],vt,e;$.grep(VTPortal.roApp.empPermissions().Requests,function(n){return n.RequestType==7&&n.Permission==!0&&typeof n.HasRankings!="undefined"&&n.HasRankings==!0}).length==1&&(vt=u.find(function(n){return n.ID=="3"}),vt==null&&u.push({ID:3,cssClass:"dx-icon-rankings",badge:""}));var c=ko.observable(!0),l=ko.observable(!1),a=ko.observable(!1),rt=ko.observable([]),yt=ko.observable(0),pt=ko.observable(0),st=ko.observable(0),ut=ko.observable(0),ft=ko.observable(0),wi=ko.observable(i18nextko.i18n.t("roFindFile")),gt=ko.observable(i18nextko.i18n.t("roFileAdded")),wt=ko.observable(!1),s=ko.observable(0),et=ko.observable([]),ot=new VTPortal.documentInput,ni=ko.computed(function(){return!VTPortal.roApp.isTimeGate()&&et().length>0}),ti=function(n){if(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.PortalNext)et([]),new WebServiceRobotics(function(i){var u,e;i.Status==window.VTPortalUtils.constants.OK.value?(et(i.SelectFields),ot.initializeData(i.SelectFields,!1,-1),ut(7),ft(parseInt(n.value,10)),u=b().find(function(t){return parseInt(t.FieldValue,10)==parseInt(n.value,10)}),u!=null?parseInt(u.RelatedInfo,10)>0?s(parseInt(u.RelatedInfo,10)):s(0):s(0),t(null),r(null),p()||(f={})):(e=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(i,e))},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingCauseInfo"),"error",0,n)}).getRequieredCauseDocuments(parseInt(n.value,10));else{et([]);ut(7);ft(parseInt(n.value,10));var i=b().find(function(t){return parseInt(t.FieldValue,10)==parseInt(n.value,10)});i!=null?parseInt(i.RelatedInfo,10)>0?s(parseInt(i.RelatedInfo,10)):s(0):s(0);t(null);r(null);p()||(f={})}},ii=function(){var n=u.find(function(n){return n.ID==3});if(n==null&&(n={ID:3,cssClass:"dx-icon-rankings",badge:""}),st()==0||st()==1)if(VTPortalUtils.utils.checkIfRequestHasRanquings(ut(),ft())){var i=null,r=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorRequestingRankings"),"error",0)},f=function(t){if(t.Status==window.VTPortalUtils.constants.OK.value){if(setTimeout(function(){$("#configRequestTab").dxTabs("instance").repaint()},150),t.Rankings!=null){for(var i=0;i<t.Rankings.RequestEmployeeRankingPositions.length;i++)t.Rankings.RequestEmployeeRankingPositions[i].cssClass=t.Rankings.RequestEmployeeRankingPositions[i].IDEmployee==VTPortal.roApp.employeeId?"rankingMyPosition":"listMenuItemPosition";rt(t.Rankings.RequestEmployeeRankingPositions)}else rt([]);n.badge=t.RankingEnabled?t.ActualPosition:"";t.CoverageEnabled&&(yt(t.Coverages.MinCoverage),pt(t.Coverages.DifferentialQuantity),n.badge=n.badge+"/"+t.Coverages.DifferentialQuantity);u=u.remove(function(n){return n.ID==3});u.push(n);c(!1);l(t.RankingEnabled);a(t.CoverageEnabled)}else c(!0),l(!1),a(!1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorRequestingRankings"),"error",0)};i==null&&(i=new WebServiceRobotics(f,r));t()!=null?i.getRankingForDay(t(),ut(),ft()):(c(!0),l(!1),a(!1))}else c(!0),l(!1),a(!1),n.badge="",u=u.remove(function(n){return n.ID==3}),u.push(n),setTimeout(function(){$("#configRequestTab").dxTabs("instance").repaint()},150);else c(!0),l(!1),a(!1),n.badge="",u=u.remove(function(n){return n.ID==3}),u.push(n),setTimeout(function(){$("#configRequestTab").dxTabs("instance").repaint()},150)},f={},bi=ko.observable(moment().startOf("day").toDate()),ki=ko.observable(moment().endOf("day").toDate()),t=ko.observable(null),r=ko.observable(null);typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&i(parseInt(n.id,10));typeof n.iDate!="undefined"&&parseInt(n.iDate,10)!=-1&&(t(moment(n.iDate,"YYYY-MM-DD")),r(moment(n.iDate,"YYYY-MM-DD")),f[moment(n.iDate,"YYYY-MM-DD").format("YYYYMMDD")]=!0);var ri=ko.computed(function(){return i18nextko.i18n.t("roRequestType_PlannedAbsences")}),ui=ko.computed(function(){return i18nextko.i18n.t("roSelectAbsence")}),p=ko.observable(!1),w=ko.observable(null),b=ko.observable([]),bt=VTPortal.approvalHistory(),fi=ko.computed(function(){return"76%"}),ei=function(){new WebServiceRobotics(function(n){var i,u,e;if(n.Status==window.VTPortalUtils.constants.OK.value){for(k(n.Comments),o(n.AbsenceId),st(n.ReqStatus),n.ReqStatus==0?h(!0):h(!1),typeof o()!="undefined"&&o()!=null&&o()>0&&(moment(n.strDate1,"YYYY-MM-DD HH:mm:ss")>moment()?VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Forecast!=null&&h(VTPortal.roApp.empPermissions().Forecast):h(!1)),v(!1),VTPortal.roApp.impersonatedIDEmployee!=-1&&(n.ReqStatus==0||n.ReqStatus==1)&&(v(!0),h(!1)),i=moment(n.strDate1,"YYYY-MM-DD HH:mm:ss").startOf("day"),t(i.clone()),u=moment(n.strDate2,"YYYY-MM-DD HH:mm:ss").startOf("day"),r(u);i<=u;)f[i.clone().add(12,"hours").format("YYYYMMDD")]=!0,i=i.add(1,"day");bt.refreshApprovals(n.RequestsHistoryEntries);w(n.IdCause+"");ht(new Date)}else e=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,e)},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(i())},kt=function(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)b(n.SelectFields),i()!=null&&i()>0?ei(i()):(n.SelectFields.length>0&&w(n.SelectFields[0].FieldValue),ht(new Date));else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},dt=ko.observable(VTPortal.bigUserInfo()),e=null,oi=function(){var t=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},r=function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDocumentUploaded"),"success",2e3)):VTPortalUtils.utils.processErrorMessage(n)},n;e==null&&(e=new WebServiceRobotics(r,t));n=ot.getDocument();VTPortal.roApp.isModeApp()==!1?(n.append("idRelatedObject",i()),n.append("forecastType","request"),e.uploadDocumentDesktop(n)):(n.append("idRelatedObject",i()),e.uploadDocumentMobile(n,"request","",""))};e=null;var vi=function(n){var u,e;if(i()==null&&typeof y()[moment(n.value).format("YYYYMMDD")]!="undefined"){if(s()==0)for(t()==null&&r()==null?(t(moment(n.value)),r(moment(n.value))):moment(n.value).isSame(t())?t(r()):moment(n.value).isSame(r())?r(t()):moment(n.value)>t()?r(moment(n.value)):moment(n.value)<t()&&t(moment(n.value)),u=moment(tt()),e=moment(it());u<e;)u>=t()&&u<=r()?f[u.format("YYYYMMDD")]=!0:typeof f[u.format("YYYYMMDD")]!="undefined"&&(f[u.format("YYYYMMDD")]=!1),u=u.add(1,"day");else{if(u=null,e=null,t()!=null&&(u=t().clone()),r()!=null&&(e=r().clone()),u!=null)while(u<=e)f[u.format("YYYYMMDD")]=!1,u=u.add(1,"day");for(t(moment(n.value)),r(t().clone().add(s()-1,"day")),u=t().clone(),e=r().clone();u<=e;)f[u.format("YYYYMMDD")]=!0,u=u.add(1,"day")}$("#calendarSelectorContainer").dxCalendar("instance").repaint()}},yi=function(n){n.ID==2?setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},200):n.ID==3&&ii()};return{requestId:i,myApprovalsBlock:bt,viewShown:si,title:ri,lblDocument:i18nextko.t("roLblDocument"),btnCancelUpload:{onClick:function(){d(!1)},text:i18nextko.t("roCancel")},btnAcceptUpload:{onClick:function(){i()!=null&&i()>0?oi():(wt(!0),d(!1))},text:i18nextko.t("roSaveRequest")},lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:ui,lblSelectDaysInfo:i18nextko.t("roSelectDayInfo"),subscribeBlock:dt(),selectedTab:nt,scrollContent:{height:fi},tabPanelOptions:{dataSource:u,selectedIndex:nt,itemTemplate:"title",onSelectionChanged:function(n){yi(n.addedItems[0])}},popupVisible:at,popupDocumentsVisible:d,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(i(),7,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:v},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(i(),7,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:v},btnHistory:{onClick:function(){at(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:lt},btnDocuments:{onClick:function(){d(!0)},text:"",hint:i18nextko.i18n.t("roLblDocument"),icon:"Images/Common/Document.png"},btnSave:{onClick:hi,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:ct},btnDelete:{onClick:li,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:h},calendarOptions:{width:"100%",useCellTemplate:!0,cellTemplate:ai,firstDayOfWeek:moment()._locale._week.dow,maxZoomLevel:"month",zoomLevel:"year",minZoomLevel:"year",onCellClick:vi,showTodayButton:!1,min:tt,max:it},remarks:{value:k,readOnly:p},cmbRequestValue1:{dataSource:b,displayExpr:"FieldName",valueExpr:"FieldValue",value:w,readOnly:p,onValueChanged:ti},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),noRankingDateSelected:c,hasRankingData:l,hasCoverageData:a,rankingDS:rt,listRanking:{dataSource:rt,scrollingEnabled:!1,collapsibleGroups:!1,itemTemplate:"RankingItem"},lblRankingHeader:i18nextko.t("roRankingTitle"),lblCoverageHeader:i18nextko.t("roCoverageTitle"),lblNoDataDescription:i18nextko.t("roNoRankingDescription"),lblMinimumCoverageRequiered:i18nextko.t("rolblMinimumCoverageRequiered"),txtMinimumCoverageRequiered:{value:yt,readOnly:!0},lblDiferentialCoverage:i18nextko.t("rolblDiferentialCoverage"),txtDifferentialCoverage:{value:pt,readOnly:!0},myDocumentsBlock:ot,hasDocuments:ni,fileAdded:gt,documentAttached:wt}};VTPortal.justifyPunch=function(n){function k(){y().viewShown();b("causes.readerinputcode");t()!=null&&t()>0&&(o(!0),VTPortalUtils.utils.markRequestAsRead(t()));VTPortal.roApp.impersonatedIDEmployee==-1?t()!=null&&i(!0):t()!=null&&r(!1);t()==null&&h(!0);t()!=null&&c(!0)}function d(){var n=moment(s(),"YYYYMMDDHHmmss"),t=u()!=null?u():"-1",i=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},r=function(i){if(i.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(3),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var r=function(){f.savePunchCause(t,n,e(),!0)};VTPortalUtils.utils.processRequestErrorMessage(i,r,function(){})}};f==null&&(f=new WebServiceRobotics(r,i));f.savePunchCause(t,n,e(),!1)}function g(){t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}var t=ko.observable(null),e=ko.observable(""),s=ko.observable(""),h=ko.observable(!1),i=ko.observable(!1),c=ko.observable(!1),l=ko.observable(!1),r=ko.observable(!1),f;typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));typeof n.param!="undefined"&&s(n.param);var o=ko.observable(!1),u=ko.observable(null),a=ko.observable([]),v=VTPortal.approvalHistory(),p=ko.computed(function(){return"76%"}),w=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)e(n.Comments),n.ReqStatus==0?i(!0):i(!1),r(!1),VTPortal.roApp.impersonatedIDEmployee!=-1&&(VTPortal.roApp.isImpersonateEnabled()==!1&&VTPortal.roApp.disableImpersonateActionsOnRequest(),(n.ReqStatus==0||n.ReqStatus==1)&&(r(!0),i(!1))),v.refreshApprovals(n.RequestsHistoryEntries),u(n.IdCause+"");else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())},b=function(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)a(n.SelectFields),t()!=null&&t()>0?w(t()):n.SelectFields.length>0&&u(n.SelectFields[0].FieldValue);else{var i=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,i)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},y=ko.observable(VTPortal.bigUserInfo());return f=null,{requestId:t,myApprovalsBlock:v,viewShown:k,title:i18nextko.t("roRequestType_JustifyPunch"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:i18nextko.t("roRequestCauseLbl"),subscribeBlock:y(),scrollContent:{height:p},popupVisible:l,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),3,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:r},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),3,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:r},btnHistory:{onClick:function(){l(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:c},btnSave:{onClick:d,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:h},btnDelete:{onClick:g,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:i},remarks:{value:e,readOnly:o},cmbRequestValue1:{dataSource:a,displayExpr:"FieldName",valueExpr:"FieldValue",value:u,readOnly:o},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.forgottenPunch=function(n){function si(){gt().viewShown();u(ft()[0].ID);nt(new DevExpress.data.DataSource({store:[]}));VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Telecommuting&&VTPortal.roApp.userTelecommute()!=null&&VTPortal.roApp.userTelecommute().Telecommuting?ut(1):ut(0);pt([{FieldName:i18nextko.i18n.t("roOffice"),FieldValue:"0"},{FieldName:i18nextko.i18n.t("roHome"),FieldValue:"1"}]);wt([{FieldName:i18nextko.i18n.t("roEntry"),FieldValue:"E"},{FieldName:i18nextko.i18n.t("roExit"),FieldValue:"S"}]);l("E");s("0");t()!=null&&t()>0?(r(!0),ei(t()),VTPortalUtils.utils.markRequestAsRead(t())):b(u());VTPortal.roApp.impersonatedIDEmployee==-1?t()!=null&&a(!0):t()!=null&&v(!1);t()==null&&ht(!0);t()!=null&&ct(!0)}function b(n){switch(n){case 1:ot("causes.readerinputcode");break;case 2:typeof VTPortal.roApp.userStatus().AvailableTasks!="undefined"&&VTPortal.roApp.userStatus().AvailableTasks<200?(p(!0),it(!1),rt(!1),ot("tasks.availabletasks")):(p(!1),it(!0),rt(!0),nt([]));break;case 3:ot("costcenters")}}function hi(){var n=moment(moment(o()).format("YYYY-MM-DD HH:mm:ss"));if(n<=moment()){switch(u()){case 1:ci();break;case 2:li();break;case 3:ai()}VTPortal.roApp.db.settings.markForRefresh(["notifications","punches","status"])}else VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingFuturePunch"),"error",0)}function ci(){l()=="S"&&s("0");var n=moment(moment(o()).format("YYYY-MM-DD HH:mm:ss")),t=f()!=null?f():"-1",i=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},r=function(i){if(i.Status==window.VTPortalUtils.constants.OK.value)i.PunchWithoutRequest==!0?(VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("lblPunchDone"),"success",2e3)):(VTPortal.roApp.redirectAtRequestList(2),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3));else{var r=function(){e.saveForbbidenPunch(n,t,h(),l(),!0,s())};VTPortalUtils.utils.processRequestErrorMessage(i,r,function(){})}};e==null&&(e=new WebServiceRobotics(r,i));e.saveForbbidenPunch(n,t,h(),l(),!1,s())}function li(){var t=moment(o()).format("YYYY-MM-DD HH:mm"),i=f()==null?-1:f(),r=w()==null?-1:w(),u=moment(o()).format("YYYY-MM-DD")+" "+moment(g()).format("HH:mm"),a=y(),n,c,l;tt.savePunchInfo();n=VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue;k()&&(momentEndHour=moment(o()).format("YYYY-MM-DD")+" "+moment(g()).format("HH:mm"));c=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)};l=function(f){if(f.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(10),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var o=function(){e.SaveRequest_ForbiddenTaskPunch(t,i,u,r,y(),h(),n[0],n[1],n[2],n[3],n[4],n[5],!0,s())};VTPortalUtils.utils.processRequestErrorMessage(f,o,function(){})}};e==null&&(e=new WebServiceRobotics(l,c));e.SaveRequest_ForbiddenTaskPunch(t,i,u,r,y(),h(),n[0],n[1],n[2],n[3],n[4],n[5],!1,s())}function ai(){var n=moment(moment(o()).format("YYYY-MM-DD HH:mm:ss")),t=f()==null?-1:f(),i=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},r=function(i){if(i.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(12),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var r=function(){e.saveCostCenterPunch(n,t,h(),!0,s())};VTPortalUtils.utils.processRequestErrorMessage(i,r,function(){})}};e==null&&(e=new WebServiceRobotics(r,i));e.saveCostCenterPunch(n,t,h(),!1,s())}function vi(){t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}function st(){VTPortal.roApp.taskPunchRequest({currentAction:-2,newAction:-1,currentTaskUserFieldsDefinition:null,currentTaskUserFieldsValue:["","","",-1,-1,-1],newTaskUserFieldsDefinition:null,newTaskUserFieldsValue:["","","",-1,-1,-1]});r()&&i!=null&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[0]=i.Field1,VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[1]=i.Field2,VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[2]=i.Field3,VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[3]=i.Field4,VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[4]=i.Field5,VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[5]=i.Field6);new WebServiceRobotics(function(n){var i,t,u;if(n.Status==window.VTPortalUtils.constants.OK.value){for(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition=n.Fields,i=!1,t=0;t<n.Fields.length;t++)n.Fields[t].Used&&(i=!0);i&&tt.initTaskProperties(r())}else u=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingTaskInfo"),"error",0,u)}).getTaskUserFieldsAction(VTPortalUtils.taskAction.change,f())}var t=ko.observable(null),h=ko.observable(""),ht=ko.observable(!1),a=ko.observable(!1),ct=ko.observable(!1),lt=ko.observable(!1),v=ko.observable(!1),k=ko.observable(!1),y=ko.observable(!1),tt=VTPortal.taskFieldsInput(),p=ko.observable(!0),d=ko.observable(!1),it=ko.observable(!1),rt=ko.observable(!1),at=ko.observable(""),ut=ko.observable(null),u=ko.observable(null),ft=ko.observable([]),ti=ko.computed(function(){if(u()!=null)switch(u()){case 1:return i18nextko.i18n.t("roRequestCauseLbl");case 2:return i18nextko.i18n.t("roRequestTaskLbl");case 3:return i18nextko.i18n.t("roRequestCostCenersLbl")}}),c=[],e,ni;VTPortal.roApp.impersonateOnlyRequest?(c.push({ID:1,Name:i18nextko.i18n.t("roForgottenType_Presence")}),c.push({ID:2,Name:i18nextko.i18n.t("roForgottenType_Task")}),c.push({ID:3,Name:i18nextko.i18n.t("roForgottenType_CostCenter")})):($.grep(VTPortal.roApp.empPermissions().Requests,function(n){return n.RequestType==2&&n.Permission==!0}).length==1&&c.push({ID:1,Name:i18nextko.i18n.t("roForgottenType_Presence")}),$.grep(VTPortal.roApp.empPermissions().Requests,function(n){return n.RequestType==10&&n.Permission==!0}).length==1&&c.push({ID:2,Name:i18nextko.i18n.t("roForgottenType_Task")}),$.grep(VTPortal.roApp.empPermissions().Requests,function(n){return n.RequestType==12&&n.Permission==!0}).length==1&&c.push({ID:3,Name:i18nextko.i18n.t("roForgottenType_CostCenter")}));ft(c);var ii=ko.observable(""),o=ko.observable(moment().startOf("day").toDate()),g=ko.observable(moment().startOf("day").toDate());typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));typeof n.param!="undefined"&&parseInt(n.param,10)!=-1&&o(moment(n.param,"YYYY-MM-DD"));typeof n.iDate!="undefined"&&parseInt(n.iDate,10)!=-1&&ii(n.iDate);var r=ko.observable(!1),l=ko.observable(null),f=ko.observable(null),s=ko.observable(null),w=ko.observable(null),ri=ko.observable(null),ui=ko.observable(null),vt=ko.observable(i18nextko.i18n.t("roSelectTask")),yt=ko.observable(i18nextko.i18n.t("roSelectTask")),et=ko.observable(0),pt=ko.observable([]),wt=ko.observable([]),nt=ko.observable([]),bt=ko.observable([]),kt=VTPortal.approvalHistory(),fi=ko.computed(function(){return"76%"}),i=null,dt=ko.observable(new DevExpress.data.DataSource({store:[],searchOperation:"contains",searchExpr:["FieldName","RelatedInfo"]})),ei=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value){i=n;h(n.Comments);n.ReqStatus==0?a(!0):a(!1);v(!1);VTPortal.roApp.impersonatedIDEmployee!=-1&&(n.ReqStatus==0||n.ReqStatus==1)&&(v(!0),a(!1));kt.refreshApprovals(n.RequestsHistoryEntries);o(moment(n.strDate1,"YYYY-MM-DD HH:mm:ss").toDate());u();switch(n.RequestType){case 2:u(1);b(1);break;case 10:u(2);b(2);break;case 12:u(3);b(3)}}else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())},oi=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)dt(new DevExpress.data.DataSource({store:n.SelectFields,searchOperation:"contains",searchExpr:["FieldName","RelatedInfo"]}));else switch(n.Status){case-10:VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("lblTaskNotFound"),"warning",5e3);break;case-20:VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("lblTaskTooMany"),"warning",5e3)}}).getTasksByName(at())},ot=function(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)if(nt(new DevExpress.data.DataSource({store:n.SelectFields,paginate:!0,pageSize:50,pageLoadMode:"scrollBottom"})),bt(new DevExpress.data.DataSource({store:n.SelectFields.clone(),paginate:!0,pageSize:50,pageLoadMode:"scrollBottom"})),t()!=null&&t()>0&&i!=null)switch(u()){case 1:l(i.Field1+"");f(i.IdCause+"");break;case 2:f(i.IdTask+"");y(i.CompletedTask);k(i.IdTask2>=0);g(moment(i.strDate2,"YYYY-MM-DD HH:mm:ss").toDate());w(i.IdTask2+"");i.IdTask2>=0&&st();break;case 3:f(i.IdCenter+"")}else n.SelectFields.length>0&&r()==!1&&f(n.SelectFields[0].FieldValue);else{var e=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,e)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},gt=ko.observable(VTPortal.bigUserInfo());return e=null,ni=function(n){u()!=2||r()||(et()==0?(f(n.itemData.FieldValue.toNumber()),ri(n.itemData),st(),vt(n.itemData.FieldName)):(w(n.itemData.FieldValue.toNumber()),ui(n.itemData),yt(n.itemData.FieldName)),d(!1))},{requestId:t,myApprovalsBlock:kt,viewShown:si,title:i18nextko.t("roRequestType_ForbiddenPunch"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblForgottenPunchType:i18nextko.t("roForgottenPunchType"),lblRequestValue1:i18nextko.t("roRequestDirectionLbl"),lblRequestValue2:ti,lblInitialDate:i18nextko.t("roRequestDateHourLbl"),subscribeBlock:gt(),scrollContent:{height:fi},popupVisible:lt,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),2,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:v},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),2,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:v},btnHistory:{onClick:function(){lt(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:ct},btnSave:{onClick:hi,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:ht},btnDelete:{onClick:vi,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:a},remarks:{value:h,readOnly:r},beginDate:{type:"datetime",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:o,readOnly:r},tcEnabled:ut,forgottenPunchType:u,taskComboVisible:p,cmbforgottenPunchType:{dataSource:ft,displayExpr:"Name",valueExpr:"ID",value:u,readOnly:r,onValueChanged:function(n){r()||b(n.value)}},reqValue1:l,cmbRequestValue1:{dataSource:wt,displayExpr:"FieldName",valueExpr:"FieldValue",value:l,readOnly:r},cmbTCType:{dataSource:pt,displayExpr:"FieldName",valueExpr:"FieldValue",value:s,readOnly:r},lblTaskInput:i18nextko.t("roSearchTask"),cmbRequestValue2:{dataSource:nt,displayExpr:"FieldName",valueExpr:"FieldValue",value:f,readOnly:r,visible:p,onValueChanged:function(){u()!=2||r()||st()}},listOptions:{dataSource:dt,itemTemplate:"item",noDataText:"",scrollingEnabled:!0,height:300,onItemClick:function(n){ni(n)}},searchOptions:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(n){at(n.value)}},btnAcceptText:{ID:"btnAcceptTextId",visible:it,onClick:function(){et(0);d(!0)},text:vt},btnAcceptText2:{iD:"btnAcceptTextId2",visible:rt,onClick:function(){et(1);d(!0)},text:yt},btnAcceptText3:{onClick:function(){oi()},text:i18nextko.t("roSearchTask")},lblTC:i18nextko.t("roTCWhereF"),lblContinueWith:i18nextko.t("rolblContinueWith"),finishVisible:k,cmbContinueWith:{dataSource:bt,visible:p,displayExpr:"FieldName",valueExpr:"FieldValue",value:w,readOnly:r},lblEndTaskHour:i18nextko.t("rolblEndTaskHour"),endTaskHour:{type:"time",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:g,readOnly:r,valueChangeEvent:"focusout"},taskFieldsBlock:tt,ckCompleteTask:{text:i18nextko.t("roCompleteTaks"),value:y,readOnly:r},ListTasksVisible:d,ckCustomizeFinish:{text:i18nextko.t("roCustomizeFinishLbl"),value:k,readOnly:r},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.externalWorkWeekResume=function(n){function b(){v().viewShown();t()!=null&&t()>0&&(i(!0),VTPortalUtils.utils.markRequestAsRead(t()),w());VTPortal.roApp.impersonatedIDEmployee==-1?t()!=null&&r(!0):t()!=null&&u(!1);t()==null&&h(!0);t()!=null&&c(!0)}function k(){var n=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},t=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.db.settings.markForRefresh(["status","notifications","punches"]),VTPortal.roApp.redirectAtRequestList(15),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var t=function(){f.saveExternalWorkWeekResume(e(),o(),!0)};VTPortalUtils.utils.processRequestErrorMessage(n,t,function(){})}};f==null&&(f=new WebServiceRobotics(t,n));f.saveExternalWorkWeekResume(e(),o().sortBy(function(n){return n.DateTime}),!1)}function d(){t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}var t=ko.observable(null),e=ko.observable(""),h=ko.observable(!1),r=ko.observable(!1),c=ko.observable(!1),l=ko.observable(!1),u=ko.observable(!1),i=ko.observable(!1),a=VTPortal.approvalHistory(),o=ko.observable([]),s=ko.computed(function(){return!i()}),y=[{Name:i18nextko.i18n.t("roEntry"),Direction:"E"},{Name:i18nextko.i18n.t("roExit"),Direction:"S"}],f;typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));var p=ko.computed(function(){return"76%"}),w=function(){new WebServiceRobotics(function(n){var f,i,t,s;if(n.Status==window.VTPortalUtils.constants.OK.value){if(e(n.Comments),n.ReqStatus==0?r(!0):r(!1),u(!1),VTPortal.roApp.impersonatedIDEmployee!=-1&&(VTPortal.roApp.isImpersonateEnabled()==!1&&VTPortal.roApp.disableImpersonateActionsOnRequest(),(n.ReqStatus==0||n.ReqStatus==1)&&(u(!0),r(!1))),f=[],n.RequestDays!=null&&n.RequestDays.length>0)for(i=0;i<n.RequestDays.length;i++)t=n.RequestDays[i],f.push({Description:"",DateTime:moment.tz(t.RequestDate,VTPortal.roApp.serverTimeZone).toDate(),Direction:t.ActualType==1?"E":"S",IdCause:t.IdCause,Remark:t.Remark});o(f);a.refreshApprovals(n.RequestsHistoryEntries)}else s=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,s)},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())},v=ko.observable(VTPortal.bigUserInfo());return f=null,{requestId:t,myApprovalsBlock:a,viewShown:b,title:i18nextko.t("roRequestType_ExternalWorkWeekResume"),lblPunchesInfo:i18nextko.t("roExternalWorkWeekResumeDays"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),remarks:{value:e,readOnly:i},daysInfo:{dataSource:o,editing:{mode:"form",allowUpdating:s,allowDeleting:s,allowAdding:s,texts:{deleteRow:"Delete",editRow:"Edit"}},onInitNewRow:function(n){n.data={Description:"",DateTime:moment().startOf("day").toDate(),Direction:"E",IdCause:-1,Remark:""}},onCellPrepared:function(n){n.column&&n.column.command=="edit"&&(n.cellElement.find(".dx-link:contains('Edit')").html($("<span class='dx-icon-edit icon' />").height(16).width(16)),n.cellElement.find(".dx-link:contains('Delete')").html($("<span class='dx-icon-remove icon' />").height(16).width(16)))},columns:[{allowEditing:!1,visible:!0,dataField:"Description",caption:i18nextko.i18n.t("roGrid_Description"),dataType:"string",allowSorting:!1,formItem:{visible:!1},calculateCellValue:function(n){var r="",i,t;if(typeof n.IdCause!="undefined")for(i=VTPortalUtils.causes,t=0;t<i.length;t++)i[t].ID==n.IdCause&&(r=i[t].Name);return n.Direction+": "+moment.tz(n.DateTime,VTPortal.roApp.serverTimeZone).format("DD/MM/YYYY HH:mm")+(r!=""?" - "+r:"")+(n.Remark!=""?"("+n.Remark+")":"")}},{sortIndex:1,sortOrder:"asc",allowEditing:i,visible:!1,dataField:"DateTime",caption:i18nextko.i18n.t("roGrid_DateTime"),dataType:"date",format:"dd/MM/yyyy HH:mm",editorOptions:{max:new Date,type:"datetime",pickerType:VTPortalUtils.utils.datetimeTypeSelect()}},{allowEditing:i,visible:!1,dataField:"Direction",caption:i18nextko.i18n.t("roGrid_Direction"),lookup:{dataSource:y,displayExpr:"Name",valueExpr:"Direction"}},{allowEditing:i,visible:!1,dataField:"IdCause",caption:i18nextko.i18n.t("roGrid_Cause"),lookup:{dataSource:VTPortalUtils.causes,displayExpr:"Name",valueExpr:"ID"}},{allowEditing:i,visible:!1,dataField:"Remark",caption:i18nextko.i18n.t("roGrid_Remark")}],readOnly:i},subscribeBlock:v(),scrollContent:{height:p},popupVisible:l,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),15,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:u},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),15,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:u},btnHistory:{onClick:function(){l(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:c},btnSave:{onClick:k,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:h},btnDelete:{onClick:d,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:r},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.externalWork=function(n){function d(){p().viewShown();k("causes.externalwork");t()!=null&&t()>0&&(e(!0),VTPortalUtils.utils.markRequestAsRead(t()));VTPortal.roApp.impersonatedIDEmployee==-1?t()!=null&&r(!0):t()!=null&&u(!1);t()==null&&c(!0);t()!=null&&l(!0)}function g(){var n=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},t=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(4),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var t=function(){o.saveExternalWork(moment(f()),moment(h()).format("HH:mm"),s(),i()!=null?i():"-1",!0)};VTPortalUtils.utils.processRequestErrorMessage(n,t,function(){})}};o==null&&(o=new WebServiceRobotics(t,n));o.saveExternalWork(moment(f()),moment(h()).format("HH:mm"),s(),i()!=null?i():"-1",!1)}function nt(){t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}var t=ko.observable(null),s=ko.observable(""),c=ko.observable(!1),r=ko.observable(!1),l=ko.observable(!1),a=ko.observable(!1),u=ko.observable(!1),f=ko.observable(moment().startOf("day").toDate()),h=ko.observable(moment().startOf("day").toDate()),o;typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));typeof n.param!="undefined"&&parseInt(n.param,10)!=-1&&f(moment(n.param,"YYYY-MM-DD"));var e=ko.observable(!1),i=ko.observable(null),v=ko.observable([]),y=VTPortal.approvalHistory(),w=ko.computed(function(){return"76%"}),b=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)s(n.Comments),n.ReqStatus==0?r(!0):r(!1),u(!1),VTPortal.roApp.impersonatedIDEmployee!=-1&&(VTPortal.roApp.isImpersonateEnabled()==!1&&VTPortal.roApp.disableImpersonateActionsOnRequest(),(n.ReqStatus==0||n.ReqStatus==1)&&(u(!0),r(!1))),y.refreshApprovals(n.RequestsHistoryEntries),f(moment(n.strDate1,"YYYY-MM-DD HH:mm:ss").startOf("day").toDate()),h(moment(n.strHours,"HH:mm").toDate()),i(n.IdCause+"");else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())},k=function(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)v(n.SelectFields),t()!=null&&t()>0?b(t()):n.SelectFields.length>0&&i(n.SelectFields[0].FieldValue);else{var r=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,r)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},p=ko.observable(VTPortal.bigUserInfo());return o=null,{requestId:t,myApprovalsBlock:y,viewShown:d,title:i18nextko.t("roRequestType_ExternalWorkResumePart"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:i18nextko.t("roRequestCauseLbl"),lblInitialDate:i18nextko.t("roRequestDateLbl"),lblInitialHour:i18nextko.t("roRequestDurationLbl"),subscribeBlock:p(),scrollContent:{height:w},popupVisible:a,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),4,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:u},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),4,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:u},btnHistory:{onClick:function(){a(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:l},btnSave:{onClick:g,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:c},btnDelete:{onClick:nt,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:r},remarks:{value:s,readOnly:e},beginDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:f,readOnly:e,valueChangeEvent:"focusout"},beginHour:{type:"time",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:h,readOnly:e,valueChangeEvent:"focusout"},cmbRequestValue1:{dataSource:v,displayExpr:"FieldName",valueExpr:"FieldValue",value:i,readOnly:e},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.changeShift=function(n){function at(){if(ot().viewShown(),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Holidays)g([]),nt([]),ft([{FieldName:i18nextko.i18n.t("roShift_DayBefore"),FieldValue:"0"},{FieldName:i18nextko.i18n.t("roShift_ActualDay"),FieldValue:"1"},{FieldName:i18nextko.i18n.t("roShift_DayAfter"),FieldValue:"2"}]),s("1"),lt("shifts.workingtype"),t()!=null&&t()>0&&(e(!0),VTPortalUtils.utils.markRequestAsRead(t())),VTPortal.roApp.impersonatedIDEmployee==-1?t()!=null&&h(!0):t()!=null&&c(!1),t()==null&&it(!0),t()!=null&&rt(!0);else{var n=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roIncorrectApiVersion"),"error",0,n)}}function tt(n){new WebServiceRobotics(function(n){var i,t,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=l(),t=0;t<n.oCalendar.DayData.length;t++)i[moment.tz(n.oCalendar.DayData[t].PlanDate,VTPortal.roApp.serverTimeZone).add(12,"hours").format("YYYYMMDD")]=n.oCalendar.DayData[t];l(i);b()==1&&setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},100)}else l([]),r=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r);w=!1},function(){w=!1}).getAvailablePermitsCalendar(n,-1)}function vt(){var n,h,c;if(i()==null||r==null)b(1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roSelectDayInfo"),"info",2e3);else{var t="",u=o()!=null?o():"-1",e=v()!=null?v():"-1";if(f()){n=moment("1899-12-30 "+moment(a()).format("HH:mm")+":00","YYYY-MM-DD HH:mm:ss");switch(s()){case"0":n.add(-1,"days");break;case"2":n.add(1,"days")}t=n.format("YYYY-MM-DD HH:mm")}h=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)};c=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(5),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var f=function(){y.saveChangeShift(i()==null?VTPortalUtils.nullDate:i(),r()==null?VTPortalUtils.nullDate:r(),e,u,t,p(),!0)};VTPortalUtils.utils.processRequestErrorMessage(n,f,function(){})}};y==null&&(y=new WebServiceRobotics(c,h));y.saveChangeShift(i()==null?VTPortalUtils.nullDate:i(),r()==null?VTPortalUtils.nullDate:r(),e,u,t,p(),!1)}}function yt(){t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}function pt(n){var t="",i="#dcdcdc",r="#dcdcdc",f=90,e=95,o=l()[moment(n.date).format("YYYYMMDD")],a=0,v=!1,h="";if(moment(n.date).format("YYYYMMDD")==moment().format("YYYYMMDD")&&(h="actualDate"),o!=null){if(o.MainShift!=null&&(a=o.MainShift.PlannedHours,v=o.IsHoliday),i=VTPortalUtils.calendar.getCellColor(u,n.date,n.view),absenceStyle="width:100%;height:100%;color: "+r+";",absenceStyle+="background: "+r+";",absenceStyle+="background: -webkit-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -moz-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -ms-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -o-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: radial-gradient(circle closest-side at center, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background-repeat: no-repeat;",absenceStyle+="background-position: center center;display:table;",t="width:100%;height:100%;color: #000000;",t+="background: "+i+";",t+="background: -webkit-radial-gradient(circle closest-side, "+i+" "+f+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -moz-radial-gradient(circle closest-side, "+i+" "+f+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -ms-radial-gradient(circle closest-side, "+i+" "+f+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -o-radial-gradient(circle closest-side, "+i+" "+f+"%,rgba(255,255,255,0) "+e+"%);",t+="background: radial-gradient(circle closest-side at center, "+i+" "+f+"%,rgba(255,255,255,0) "+e+"%);",t+="background-repeat: no-repeat;",t+="background-position: center center;display:table;",n.view=="month")return"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span class='"+h+"' style='display:table-cell;vertical-align:middle;font-weight:bold'>"+n.text+"<\/span><\/div><\/div><\/div><\/div>";if(n.view=="year"){if(moment(n.date).isAfter(moment(k()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(d()))){for(var s=moment(n.date).startOf("month"),y=moment(n.date).endOf("month"),c=0;s<y;)u[s.format("YYYYMMDD")]==!0&&(c+=1),s=s.add(1,"day");return c>0?"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+" ("+c+")<\/span><\/div><\/div><\/div><\/div>":"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+"<\/span><\/div><\/div><\/div><\/div>"}return""}}else return moment(n.date).isAfter(moment(k()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(d()))?(w||(w=!0,tt(n.date)),"<span class='"+h+"' >"+n.text+"<\/span>"):""}var t=ko.observable(null),p=ko.observable(""),it=ko.observable(!1),h=ko.observable(!1),rt=ko.observable(!1),ut=ko.observable(!1),c=ko.observable(!1),l=ko.observable({}),w=!0,b=ko.observable(0),k=ko.observable(moment().startOf("day").startOf("year").add(-1,"year").toDate()),d=ko.observable(moment().startOf("day").endOf("year").add(1,"year").toDate()),u={},a=ko.observable(moment().startOf("day").toDate()),kt=ko.observable(moment().endOf("day").toDate()),i=ko.observable(null),r=ko.observable(null),f=ko.observable(!1),a=ko.observable(moment().startOf("day").toDate()),y;typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));typeof n.param!="undefined"&&parseInt(n.param,10)!=-1&&(i(null),r(null));var e=ko.observable(!1),o=ko.observable(null),v=ko.observable(null),s=ko.observable(null),g=ko.observable([]),nt=ko.observable([]),ft=ko.observable([]),et=VTPortal.approvalHistory(),st=function(n){if(!(t()!=null&&t()>0)){var i=n.value;new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)n.IsFloating?(a(moment.tz(n.StartFloating,VTPortal.roApp.serverTimeZone).toDate()),f(!0)):(a(moment().startOf("day").toDate()),f(!1));else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingShiftInfo"),"error",0,n)}).checkIsFloatingShift(i)}},ht=ko.computed(function(){return"76%"}),ct=function(){new WebServiceRobotics(function(n){var t,i,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(p(n.Comments),n.ReqStatus==0?h(!0):h(!1),c(!1),VTPortal.roApp.impersonatedIDEmployee!=-1&&(n.ReqStatus==0||n.ReqStatus==1)&&(c(!0),h(!1)),et.refreshApprovals(n.RequestsHistoryEntries),t=moment(n.strDate1,"YYYY-MM-DD HH:mm:ss").startOf("day"),i=moment(n.strDate2,"YYYY-MM-DD HH:mm:ss").startOf("day");t<=i;)u[t.clone().add(12,"hours").format("YYYYMMDD")]=!0,t=t.add(1,"day");if(n.strStartShift!=""){a(moment(n.strStartShift,"YYYY-MM-DD HH:mm:ss"));switch(moment(n.strStartShift,"YYYY-MM-DD HH:mm:ss").date()){case 29:s("0");break;case 30:s("1");break;case 31:s("2")}f(!0)}else f(!1);v(n.IdShift+"");n.Field4==0?o("-1"):o(n.Field4+"");tt(new Date)}else r=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r)},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())},lt=function(n){new WebServiceRobotics(function(n){var i,r;n.Status==window.VTPortalUtils.constants.OK.value?(i=[{FieldName:i18nextko.i18n.t("roAllShifts"),FieldValue:"-1"}],i=i.add(n.SelectFields.clone()),g(i),nt(n.SelectFields.clone()),t()!=null&&t()>0?ct(t()):(i.length>0&&o(i[0].FieldValue),n.SelectFields.length>0&&v(n.SelectFields[0].FieldValue),tt(new Date))):(r=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r))},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},ot=ko.observable(VTPortal.bigUserInfo());y=null;var wt=function(n){if(t()==null&&typeof l()[moment(n.value).format("YYYYMMDD")]!="undefined"){i()==null&&r()==null?(i(moment(n.value)),r(moment(n.value))):moment(n.value).isSame(i())?i(r()):moment(n.value).isSame(r())?r(i()):moment(n.value)>i()?r(moment(n.value)):moment(n.value)<i()&&i(moment(n.value));for(var f=moment(k()),e=moment(d());f<e;)f>=i()&&f<=r()?u[f.format("YYYYMMDD")]=!0:typeof u[f.format("YYYYMMDD")]!="undefined"&&(u[f.format("YYYYMMDD")]=!1),f=f.add(1,"day");$("#calendarSelectorContainer").dxCalendar("instance").repaint()}},bt=function(n){n.ID==2&&setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},200)};return{requestId:t,myApprovalsBlock:et,viewShown:at,title:i18nextko.t("roRequestType_ChangeShift"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:i18nextko.t("roSelectShift"),lblRequestValue2:i18nextko.t("roReeplaceShift"),lblInitialHour:i18nextko.t("roRequestShiftInitialHourLbl"),lblSelectDay:i18nextko.t("roRequestShiftSelectDayLbl"),lblSelectDaysInfo:i18nextko.t("roSelectDayInfo"),subscribeBlock:ot(),selectedTab:b,scrollContent:{height:ht},tabPanelOptions:{dataSource:[{ID:1,cssClass:"dx-icon-configRequest"},{ID:2,cssClass:"dx-icon-selectDate"}],selectedIndex:b,itemTemplate:"title",onSelectionChanged:function(n){bt(n.addedItems[0])}},popupVisible:ut,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),5,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:c},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),5,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:c},btnHistory:{onClick:function(){ut(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:rt},btnSave:{onClick:vt,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:it},btnDelete:{onClick:yt,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:h},calendarOptions:{width:"100%",useCellTemplate:!0,cellTemplate:pt,firstDayOfWeek:moment()._locale._week.dow,maxZoomLevel:"month",zoomLevel:"year",minZoomLevel:"year",onCellClick:wt,showTodayButton:!1,min:k,max:d},remarks:{value:p,readOnly:e},beginHour:{type:"time",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:a,readOnly:e,valueChangeEvent:"focusout"},cmbRequestValue1:{dataSource:g,displayExpr:"FieldName",valueExpr:"FieldValue",value:o,readOnly:e},cmbRequestValue2:{dataSource:nt,displayExpr:"FieldName",valueExpr:"FieldValue",value:v,readOnly:e,onValueChanged:st},cmbRequestValue3:{dataSource:ft,displayExpr:"FieldName",valueExpr:"FieldValue",value:s,readOnly:e},isFloating:f,loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.cancelHolidays=function(n){function p(n){if(i()=="C")var t=f()/100;new WebServiceRobotics(function(n){var i,t,u;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=r(),t=0;t<n.oCalendar.DayData.length;t++)i[moment.tz(n.oCalendar.DayData[t].PlanDate,VTPortal.roApp.serverTimeZone).add(12,"hours").format("YYYYMMDD")]=n.oCalendar.DayData[t];r(i);v()==1&&setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},100)}else r([]),u=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,u);a=!1},function(){a=!1}).getAvailablePermitsCalendar(n,i()=="C"?t:-1)}function ft(){if(k().viewShown(),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Holidays)it("plannedholiday"),t()!=null&&t()>0&&(y(!0),VTPortalUtils.utils.markRequestAsRead(t())),VTPortal.roApp.impersonatedIDEmployee==-1?t()!=null&&s(!0):t()!=null&&h(!1),t()==null&&d(!0),t()!=null&&g(!0);else{var n=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roIncorrectApiVersion"),"error",0,n)}}function et(){var r="",n=moment().startOf("month"),s=moment().endOf("year").add(1,"year"),t=f()!=null?f():"-1",e,o;for(t!="-1"&&i()=="C"&&(t=t/100);n<s;)u[n.format("YYYYMMDD")],typeof u[n.format("YYYYMMDD")]!="undefined"&&u[n.format("YYYYMMDD")]==!0&&(r!=""&&(r+="/"),r+=n.format("YYYYMMDD")),n=n.add(1,"day");r==""?(v(1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roSelectDayInfo"),"info",2e3)):(e=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},o=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(11),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var u=function(){c.saveCancelHolidays(r,i()=="C"?t:-1,i()=="S"?t:-1,l(),!0)};VTPortalUtils.utils.processRequestErrorMessage(n,u,function(){})}},c==null&&(c=new WebServiceRobotics(o,e)),c.saveCancelHolidays(r,i()=="C"?t:-1,i()=="S"?t:-1,l(),!1))}function ot(){t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}function st(n){var h="",c="#dcdcdc",l="#dcdcdc",v=90,y=95,w=r()[moment(n.date).format("YYYYMMDD")],b=!1,k="",s,nt,tt,d,g;if(moment(n.date).format("YYYYMMDD")==moment().format("YYYYMMDD")&&(k="actualDate"),w!=null){if(w.MainShift!=null&&(b=!1,i()=="S"&&w.IsHoliday==!0&&w.MainShift.ID==parseInt(f(),10)?b=!0:i()=="C"&&w.Alerts.OnHolidaysHours&&(b=!0)),c=VTPortalUtils.calendar.getCellColor(u,n.date,n.view),absenceStyle="width:100%;height:100%;color: "+l+";",absenceStyle+="background: "+l+";",absenceStyle+="background: -webkit-radial-gradient(circle closest-side, "+l+" 95%,rgba(255,255,255,0) 100%);",absenceStyle+="background: -moz-radial-gradient(circle closest-side, "+l+" 95%,rgba(255,255,255,0) 100%);",absenceStyle+="background: -ms-radial-gradient(circle closest-side, "+l+" 95%,rgba(255,255,255,0) 100%);",absenceStyle+="background: -o-radial-gradient(circle closest-side, "+l+" 95%,rgba(255,255,255,0) 100%);",absenceStyle+="background: radial-gradient(circle closest-side at center, "+l+" 95%,rgba(255,255,255,0) 100%);",absenceStyle+="background-repeat: no-repeat;",absenceStyle+="background-position: center center;display:table;",h="width:100%;height:100%;color: #000000;",h+="background: "+c+";",h+="background: -webkit-radial-gradient(circle closest-side, "+c+" "+v+"%,rgba(255,255,255,0) "+y+"%);",h+="background: -moz-radial-gradient(circle closest-side, "+c+" "+v+"%,rgba(255,255,255,0) "+y+"%);",h+="background: -ms-radial-gradient(circle closest-side, "+c+" "+v+"%,rgba(255,255,255,0) "+y+"%);",h+="background: -o-radial-gradient(circle closest-side, "+c+" "+v+"%,rgba(255,255,255,0) "+y+"%);",h+="background: radial-gradient(circle closest-side at center, "+c+" "+v+"%,rgba(255,255,255,0) "+y+"%);",h+="background-repeat: no-repeat;",h+="background-position: center center;display:table;",n.view=="month")return moment(n.date).isAfter(moment(e()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(o()))?moment(n.date).startOf("day")>=moment(e()).startOf("day")?b||t()>0?"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+h+"'> <span class='"+k+"' style='display:table-cell;vertical-align:middle;font-weight:bold'>"+n.text+"<\/span><\/div><\/div><\/div><\/div>":"<div class='no-working-day'> <span class='"+k+"' >"+n.text+"<\/span><\/div>":"<span>"+n.text+"<\/span>":"";if(n.view=="year"){if(moment(n.date).isAfter(moment(e()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(o()))){for(s=moment(n.date).startOf("month"),nt=moment(n.date).endOf("month"),s<moment().startOf("day")&&(s=moment().startOf("day")),tt=!1,d=0;s<nt;){if(g=!1,i()=="S"&&typeof r()[s]!="undefined"&&r()[s.format("YYYYMMDD")].IsHoliday==!0&&r()[s.format("YYYYMMDD")].MainShift.ID==parseInt(f(),10)?g=!0:i()=="C"&&typeof r()[s]!="undefined"&&r()[s.format("YYYYMMDD")].Alerts.OnHolidaysHours&&(g=!0),g){tt=!0;break}s=s.add(1,"day")}for(s=moment(n.date).startOf("month"),s<moment().startOf("day")&&(s=moment().startOf("day"));s<nt;)u[s.format("YYYYMMDD")]==!0&&(d+=1),s=s.add(1,"day");return tt||t()>0?d>0?"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+h+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+" ("+d+")<\/span><\/div><\/div><\/div><\/div>":"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+h+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+"<\/span><\/div><\/div><\/div><\/div>":"<span>"+n.text+"<\/span>"}return""}}else return moment(n.date).isAfter(moment(e()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(o()))?(a||(a=!0,p(n.date)),"<span class='"+k+"' >"+n.text+"<\/span>"):""}var t=ko.observable(null),l=ko.observable(""),d=ko.observable(!1),s=ko.observable(!1),g=ko.observable(!1),nt=ko.observable(!1),h=ko.observable(!1),e=ko.observable(moment().startOf("day").toDate()),o=ko.observable(moment().startOf("day").endOf("year").add(1,"year").toDate()),r=ko.observable({}),a=!0,v=ko.observable(0),i=ko.observable(""),f=ko.observable(null),w=ko.observable([]),b=[],u,it,k,c;b.push({ID:1,cssClass:"dx-icon-configRequest"});b.push({ID:2,cssClass:"dx-icon-selectDate"});u={};typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));var y=ko.observable(!1),tt=VTPortal.approvalHistory(),rt=ko.computed(function(){return"76%"}),ut=function(){new WebServiceRobotics(function(n){var r,t,c,a;if(n.Status==window.VTPortalUtils.constants.OK.value){if(l(n.Comments),n.ReqStatus==0?s(!0):s(!1),h(!1),VTPortal.roApp.impersonatedIDEmployee!=-1&&(n.ReqStatus==0||n.ReqStatus==1)&&(h(!0),s(!1)),tt.refreshApprovals(n.RequestsHistoryEntries),moment(n.strDate1,"YYYY-MM-DD HH:mm:ss")<moment(e())&&e(moment(n.strDate1,"YYYY-MM-DD HH:mm:ss").startOf("month").toDate()),moment(n.strDate2,"YYYY-MM-DD HH:mm:ss")>moment(o())&&o(moment(n.strDate2,"YYYY-MM-DD HH:mm:ss").endOf("year")),n.RequestDays!=null&&n.RequestDays.length>0)for(r=0;r<n.RequestDays.length;r++)u[moment.tz(n.RequestDays[r].RequestDate,VTPortal.roApp.serverTimeZone).add(12,"hours").format("YYYYMMDD")]=!0;else for(t=moment(n.strDate1,"YYYY-MM-DD HH:mm:ss").startOf("day"),c=moment(n.strDate2,"YYYY-MM-DD HH:mm:ss").startOf("day");t<=c;)u[t.clone().add(12,"hours").format("YYYYMMDD")]=!0,t=t.add(1,"day");parseInt(n.IdShift,10)>0?(f(n.IdShift+""),i("S")):parseInt(n.IdCause,10)>0&&(f(n.IdCause*100+""),i("C"));p(new Date)}else a=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,a)},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())};it=function(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)n.SelectFields.forEach(function(n){n.RelatedInfo=="C"&&(n.FieldValue=n.FieldValue*100)}),w(n.SelectFields),t()!=null&&t()>0?ut(t()):n.SelectFields.length>0&&(f(n.SelectFields[0].FieldValue),i(n.SelectFields[0].RelatedInfo),p(new Date));else{var r=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,r)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)};k=ko.observable(VTPortal.bigUserInfo());c=null;var ht=function(n){var i;if(t()==null&&typeof r()[moment(n.value).format("YYYYMMDD")]!="undefined"&&(r()[moment(n.value).format("YYYYMMDD")].IsHoliday||r()[moment(n.value).format("YYYYMMDD")].Alerts.OnHolidaysHours)){var f="#0046FE",s="#000000",e=90,o=95;typeof u[moment(n.value).format("YYYYMMDD")]!="undefined"&&u[moment(n.value).format("YYYYMMDD")]==!0?(u[moment(n.value).format("YYYYMMDD")]=!1,f="#dcdcdc",i="width:100%;height:100%;color: "+s+";",i+="background: "+f+";",i+="background: -webkit-radial-gradient(circle closest-side, "+f+" "+e+"%,rgba(255,255,255,0) "+o+"%);",i+="background: -moz-radial-gradient(circle closest-side, "+f+" "+e+"%,rgba(255,255,255,0) "+o+"%);",i+="background: -ms-radial-gradient(circle closest-side, "+f+" "+e+"%,rgba(255,255,255,0) "+o+"%);",i+="background: -o-radial-gradient(circle closest-side, "+f+" "+e+"%,rgba(255,255,255,0) "+o+"%);",i+="background: radial-gradient(circle closest-side at center, "+f+" "+e+"%,rgba(255,255,255,0) "+o+"%);",i+="background-repeat: no-repeat;",i+="background-position: center center;display:table;",$("#"+moment(n.value).format("YYYYMMDD")).attr("style",i)):(f="#0046FE",u[moment(n.value).format("YYYYMMDD")]=!0,i="width:100%;height:100%;color: "+s+";",i+="background: "+f+";",i+="background: -webkit-radial-gradient(circle closest-side, "+f+" "+e+"%,rgba(255,255,255,0) "+o+"%);",i+="background: -moz-radial-gradient(circle closest-side, "+f+" "+e+"%,rgba(255,255,255,0) "+o+"%);",i+="background: -ms-radial-gradient(circle closest-side, "+f+" "+e+"%,rgba(255,255,255,0) "+o+"%);",i+="background: -o-radial-gradient(circle closest-side, "+f+" "+e+"%,rgba(255,255,255,0) "+o+"%);",i+="background: radial-gradient(circle closest-side at center, "+f+" "+e+"%,rgba(255,255,255,0) "+o+"%);",i+="background-repeat: no-repeat;",i+="background-position: center center;display:table;",$("#"+moment(n.value).format("YYYYMMDD")).attr("style",i))}},ct=function(n){n.ID==2&&setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},200)};return{requestId:t,myApprovalsBlock:tt,viewShown:ft,title:i18nextko.t("roRequestType_CancelHolidays"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:i18nextko.t("roSelectPlannedHoliday"),lblSelectDaysInfo:i18nextko.t("roSelectDayInfo"),subscribeBlock:k(),selectedTab:v,scrollContent:{height:rt},tabPanelOptions:{dataSource:b,selectedIndex:v,itemTemplate:"title",onSelectionChanged:function(n){ct(n.addedItems[0])}},popupVisible:nt,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),11,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:h},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),11,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:h},btnHistory:{onClick:function(){nt(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:g},btnSave:{onClick:et,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:d},btnDelete:{onClick:ot,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:s},remarks:{value:l,readOnly:y},calendarOptions:{width:"100%",useCellTemplate:!0,cellTemplate:st,firstDayOfWeek:moment()._locale._week.dow,maxZoomLevel:"month",zoomLevel:"year",minZoomLevel:"year",onCellClick:ht,showTodayButton:!1,min:e,max:o},cmbRequestValue1:{dataSource:w,displayExpr:"FieldName",valueExpr:"FieldValue",value:f,readOnly:y,onValueChanged:function(n){y()||(u={});var t=$.grep(w(),function(t){return t.FieldValue==n.value});t.length>0&&(i(t[0].RelatedInfo),r({}),p(new Date))}},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.approvalHistory=function(){var n=ko.observable([]),t=function(t){for(var r,u=[],i=0;i<t.length;i++){r="";switch(t[i].Action){case 0:r="dx-icon-requestPending";break;case 1:r="dx-icon-requestOnGoing";break;case 2:r="dx-icon-requestApprove";break;case 3:r="dx-icon-requestDenied"}u.push({cssClass:r,Name:moment.tz(t[i].ActionDate,VTPortal.roApp.serverTimeZone).format("LLL"),Description:t[i].User+":"+t[i].Comment})}n(u)};return{refreshApprovals:t,lblRequestApprovals:i18nextko.t("roLblRequestApprovals"),listApprovals:{dataSource:n,scrollingEnabled:!1,grouped:!1,itemTemplate:"ApprovalItem",onItemClick:function(n){n.itemData.hasAction&&VTPortal.app.navigate("userFields/"+n.itemData.Id)}}}};VTPortal.punchManagement=function(n){function s(){r.modelIsReady(!1);u.modelIsReady(!1);switch(t()){case 1:r.initializeView(o());break;case 2:u.initializeView()}}function c(){e().viewShown();s()}var i=ko.observable(0),t=ko.observable(1),o=ko.observable(new Date),e;typeof n.id!="undefined"&&(i(parseInt(n.id,10)-1),t(parseInt(n.id,10)));typeof n.param!="undefined"&&o(moment(n.param,"YYYY-MM-DD").toDate());var r=VTPortal.myPunches(),u=VTPortal.myPunchRequests(),h=ko.computed(function(){switch(t()){case 1:return i18nextko.i18n.t("roPunchesTitle");case 2:return i18nextko.i18n.t("roMyPunchRequests")}},this),f=[];f.push({ID:1,cssClass:"dx-icon-myPunches"});f.push({ID:2,cssClass:"dx-icon-myPuncheRequests"});e=ko.observable(VTPortal.bigUserInfo());var l=function(n){t(n.ID);s()},a=function(){VTPortal.roApp.db.settings.password="";VTPortal.roApp.db.settings.save();VTPortal.roApp.impersonatedIDEmployee=-1;VTPortal.roApp.supervisedEmployees=[];VTPortal.roApp.loggedIn=!1;VTPortal.app.navigate("login",{root:!0})};return{viewShown:c,title:h,subscribeBlock:e(),myPunchesBlock:r,myPunchRequestsBlock:u,selectedTab:i,selectedView:t,tabPanelOptions:{dataSource:f,selectedIndex:i,itemTemplate:"title",onSelectionChanged:function(n){l(n.addedItems[0])}}}};VTPortal.myPunchRequests=function(){function o(){h();u(!0);n()?$("#scrollview").height($("#panelsContent").height()-94):$("#scrollview").height($("#panelsContent").height()-70)}function h(){n(!1);var i=VTPortal.roApp.punchesFilters(),r=function(n){var i,r,u,f,e;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=n.Requests,r=0;r<i.length;r++){i[r].Name=i18nextko.i18n.t("roRequestType_"+i[r].RequestType);i[r].hasAction=n.CanCreateRequest?!0:!1;u="";switch(i[r].Status){case 0:u="ro_Status_pending";break;case 1:u="ro_Status_ongoing";break;case 2:u="ro_Status_accepted";break;case 3:u="ro_Status_denied"}f="";switch(i[r].IdRequestType){case 2:f="dx-icon-forbiddenPunch";break;case 3:f="dx-icon-justifyPunch";break;case 10:f="dx-icon-forbiddenPunch";break;case 12:f="dx-icon-forbiddenPunch"}i[r].cssContainerClass=u;i[r].cssClass=f;$("#scrollview").height($("#panelsContent").height())}t(i)}else t([]),e=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,e)};i==null?(n(!1),new WebServiceRobotics(function(n){r(n)}).getMyRequests(!1,moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").add(1,"day"),"0*1*2*3|2*3*10*12","RequestDate DESC",moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").add(1,"year"))):(n(!0),new WebServiceRobotics(function(n){r(n)}).getMyRequests(!1,i.filter.iDate,i.filter.eDate,i.filter.status.join("*")+"|"+i.filter.types.join("*"),i.order.by+" "+i.order.direction,i.filter.iRequestedDate,i.filter.eRequestedDate))}var u=ko.observable(!1),t=ko.observable([]),i=ko.observable(!1),r=ko.observable("Images/Common/more.png"),f=VTPortal.noPermissions(),n=ko.observable(!1),e=ko.computed(function(){return VTPortal.roApp.punchesFilters()!=null?i18nextko.i18n.t("roFilteringData"):""}),s=ko.computed(function(){var t,n;if(VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Requests!=null){for(t=!1,n=0;n<VTPortal.roApp.empPermissions().Requests.length;n++)if(VTPortal.roApp.empPermissions().Requests[n].Permission){t=!0;break}return t}return!1}),c=function(){i(!0);r("Images/Common/moreV.png")},l=function(){r("Images/Common/more.png")},a=function(){i(!1);r("Images/Common/more.png");VTPortal.app.navigate("RequestFilters/2")},v=function(){i(!1);VTPortal.app.navigate("requestsList/2,3,10,12/null")};return{modelIsReady:u,initializeView:o,hasPermission:s,noPermissions:f,requestsDS:t,dataFiltered:n,filterDescription:e,listRequests:{dataSource:t,scrollingEnabled:!1,grouped:!1,itemTemplate:"RequestItem",onItemClick:function(n){if(n.itemData.hasAction)switch(n.itemData.IdRequestType){case 2:VTPortal.app.navigate("forgottenPunch/"+n.itemData.Id);break;case 3:VTPortal.app.navigate("justifyPunch/"+n.itemData.Id);break;case 10:VTPortal.app.navigate("forgottenPunch/"+n.itemData.Id);break;case 12:VTPortal.app.navigate("forgottenPunch/"+n.itemData.Id)}}},actionMenuPopover:{target:"#btnActionMenuPopover",position:"top",shading:!0,shadingColor:"rgba(0, 0, 0, 0.5)",visible:i,onHidden:l},showOptions:{onClick:c,text:"",icon:r},btnFilterRequests:{onClick:a,text:"",hint:i18nextko.i18n.t("roFilter"),icon:"Images/Common/filter.png"},btnNewRequests:{onClick:v,text:"",hint:i18nextko.i18n.t("roNew"),icon:"Images/Common/plus.png",visible:VTPortal.roApp.ReadMode()==!1},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.myPunches=function(){function o(t){n(t);i(!0)}var f=function(n,t){var i=t.targetOffset;i<0?u():i>0&&r()},e=VTPortal.noPermissions(),n=ko.observable(new Date),i=ko.observable(!1),t=ko.observable([]),r=function(){n(moment(n()).subtract(1,"days"))},u=function(){n(moment(n()).add(1,"days"))},s=function(){VTPortal.app.navigate("forgottenPunch/-1/"+moment(n()).format("YYYY-MM-DD"))},h=ko.computed(function(){return VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&(VTPortal.roApp.empPermissions().Punch.ScheduleQuery||VTPortal.roApp.empPermissions().Punch.ProductiVQuery)?!0:!1}),l=function(){(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&(VTPortal.roApp.empPermissions().Schedule.ScheduleAccruals||VTPortal.roApp.empPermissions().Schedule.ProductivAccruals))&&new WebServiceRobotics(function(n){var o,u,f,i,e,r,s;if(n.Status==window.VTPortalUtils.constants.OK.value){if(o=t(),VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Schedule.ScheduleAccruals){for(u=n.ScheduleAccruals,i=0;i<u.length;i++){e="";switch(u[i].key){case"daily":u[i].key="presenceDaily";e="dx-icon-scheduleDaily"}for(r=0;r<u[i].items.length;r++)u[i].items[r].cssClass=e,u[i].items[r].hasAction=!1}u.length>0&&o.push(u[0])}if(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Schedule.ProductivAccruals){for(f=n.TaskAccruals,i=0;i<f.length;i++){e="";switch(f[i].key){case"daily":f[i].key="productiVDaily";e="dx-icon-productivDaily"}for(r=0;r<f[i].items.length;r++)f[i].items[r].cssClass=e,f[i].items[r].hasAction=!1}f.length>0&&o.push(f[0])}t(o);$("#scrollview").height($("#panelsContent").height()-70)}else productivDS([]),scheduleDS([]),s=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,s)}).getMyDailyAccruals(n())},c=function(n){(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&(VTPortal.roApp.empPermissions().Punch.ScheduleQuery||VTPortal.roApp.empPermissions().Punch.ProductiVQuery))&&new WebServiceRobotics(function(n){var i,r,u;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=n.Punches,r=0;r<i.length;r++){switch(i[r].Type){case 1:case 2:case 3:case 7:i[r].cssClass=i[r].TypeData!=null&&i[r].TypeData>0?i[r].ActualType==1?typeof i[r].InTelecommute!="undefined"&&i[r].InTelecommute.toLowerCase()=="true"?"dx-icon-TATC_in":"dx-icon-TA_in_cause":"dx-icon-TA_out_cause":i[r].ActualType==1?typeof i[r].InTelecommute!="undefined"&&i[r].InTelecommute.toLowerCase()=="true"?"dx-icon-TATC_in":"dx-icon-TA_in":"dx-icon-TA_out";i[r].hasAction=!0;break;case 4:i[r].cssClass="dx-icon-Task_change";i[r].hasAction=!1;break;case 13:i[r].cssClass="dx-icon-CostCenter";i[r].hasAction=!1}i[r].Name=moment.tz(i[r].DateTime,VTPortal.roApp.serverTimeZone).format("LLL");i[r].Value=i[r].RequestedTypeData!=""?i18nextko.i18n.t("roRequestPendingApprove")+i[r].RequestedTypeData:i[r].RelatedInfo}t(i);$("#scrollview").height($("#panelsContent").height()-70)}else t([]),u=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,u)}).getMyPunches(n.value)};return{title:i18nextko.i18n.t("roMyPunchesTitle"),modelIsReady:i,initializeView:o,punchesDS:t,hasPermission:h,noPermissions:e,headerDate:{value:n,pickerType:"rollers",displayFormat:"shortDate",onValueChanged:c},btnPrevious:{icon:"chevronprev",onClick:r},btnNext:{icon:"chevronnext",onClick:u},myEventHandler:f,listOptions:{dataSource:t,scrollingEnabled:!1,grouped:!1,onItemClick:function(n){n.itemData.hasAction&&VTPortal.app.navigate("justifyPunch/-1/"+moment(n.itemData.DateTime).format("YYYYMMDDHHmmss"))}},newRequest:{onClick:s,text:"",icon:"Images/Common/plus.png",visible:VTPortal.roApp.ReadMode()==!1},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.profileUserFields=function(){function r(){u();t(!0);$("#scrollview").height($("#panelsContent").height()-70)}function u(){(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().UserFieldQuery)&&new WebServiceRobotics(function(t){var r,u,i,f;if(t.Status==window.VTPortalUtils.constants.OK.value){for(r=t.Categories,i=0;i<r.length;i++)for(u=0;u<r[i].items.length;u++)r[i].items[u].hasAction=t.CanCreateRequest?typeof r[i].items[u].CanDeliverDocument!="undefined"&&r[i].items[u].CanDeliverDocument?!0:!1:!1,r[i].items[u].cssClass="";for(n(r),i=0;i<r.length;i++)i>0&&$("#profileUserFields").dxList("instance").collapseGroup(i)}else n([]),f=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(t,f)}).getUserFields()}var t=ko.observable(!1),n=ko.observable([]),i=VTPortal.noPermissions(),f=ko.computed(function(){return VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().UserFieldQuery?!0:!1});return{modelIsReady:t,viewShown:r,hasPermission:f,noPermissions:i,userFieldsDS:n,profileUserFields:{dataSource:n,scrollingEnabled:!1,grouped:!0,collapsibleGroups:!0,groupTemplate:function(n){return $("<div>"+n.key+"<\/div>")},itemTemplate:"userField",onItemClick:function(n){n.itemData.hasAction&&VTPortal.app.navigate("userFields/-1/"+n.itemData.Name)}},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.profileConfig=function(){function w(){var t=[];let n=!0;VTPortal.roApp.db.settings.login.indexOf("\\")!=-1&&(n=!1);VTPortal.roApp.db.settings.adfsCredential!=""&&(n=!1);VTPortal.roApp.db.settings.isAD&&(n=!1);VTPortal.roApp.db.settings.login.indexOf(".\\")!=-1&&(n=!0);VTPortal.roApp.isTimeGate()&&(n=!1);t.push({ID:0,Name:i18nextko.t("roChangePhotoBt"),CssClass:"ro-icon-ChangePhoto"});n==!0&&t.push({ID:1,Name:i18nextko.t("roChangePwdBt"),CssClass:"ro-icon-ChangePwd"});t.push({ID:2,Name:i18nextko.t("lng"),CssClass:"ro-icon-language"});h(t);c(!0);$("#scrollview").height($("#panelsContent").height()-70)}function it(){if(VTPortalUtils.utils.isShowingPopup(!1),Object.has(navigator,"camera")){var t=function(){navigator.camera.getPicture(function(t){s(t);typeof device!="undefined"?cordova.platformId==="ios"?n(window.WkWebView.convertFilePath(t)):n(t):n(t)},function(n){n.includes("cancelled")||VTPortalUtils.utils.notifyMesage(n,"error",2e3)},{quality:50,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,targetWidth:200,targetHeight:200,saveToPhotoAlbum:!1,correctOrientation:!0})},i=function(){navigator.camera.getPicture(function(t){s(t);typeof device!="undefined"?cordova.platformId==="ios"?n(window.WkWebView.convertFilePath(t)):n(t):n(t)},function(n){n.includes("cancelled")||VTPortalUtils.utils.notifyMesage(n,"error",2e3)},{quality:50,sourceType:Camera.PictureSourceType.CAMERA,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,targetWidth:200,targetHeight:200,saveToPhotoAlbum:!1,correctOrientation:!0})};VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roSelectOrigin"),"info",0,t,i,i18nextko.i18n.t("roTakeFromLibrary"),i18nextko.i18n.t("roTakeFromCamera"))}else VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoCameraAvailable"),"error",0)}var h=ko.observable([]),c=ko.observable(!1),r=ko.observable(!1),e=ko.observable(!1),p=ko.observable(i18nextko.i18n.t("lngProfile")),o=ko.observable(""),i=ko.observable(""),l=ko.observable(""),u=ko.observable(window.VTPortal.roApp.getLanguageByID(VTPortal.roApp.db.settings.language)),t=ko.observable(!1),a=ko.observableArray(),v=ko.observable(i18nextko.i18n.t("roFindFile")),s=ko.observable(""),n=ko.observable(""),rt=function(){VTPortal.roApp.loggedIn&&new WebServiceRobotics(function(n){window.VTPortalUtils.utils.onLogoutSuccessFunc(n)},function(n){window.VTPortalUtils.utils.onLogoutErrorFunc(n)}).logout(VTPortal.roApp.db.settings.UUID)},y=function(){r(!0)},b=function(){r(!1)},k=function(){e(!0)},d=function(){e(!1)},g=function(){var n;VTPortal.roApp.setLanguage(u().tag);VTPortal.roApp.isTimeGate()||(VTPortal.roApp.db.settings.language=u().ID,VTPortal.roApp.db.settings.save());VTPortal.roApp.db.settings.adfsCredential!=""?(n=window.VTPortal.roApp.db.settings,new WebServiceRobotics(function(){VTPortalUtils.utils.buildHamburgerMenu();setTimeout(function(){VTPortal.app.navigate("loading",{root:!0})},200)},function(){setTimeout(function(){VTPortal.app.navigate("loading",{root:!0})},200)}).updateServerLanguage(window.VTPortal.roApp.getLanguageByID(n.language).ID)):(n=window.VTPortal.roApp.db.settings,new WebServiceRobotics(function(){VTPortalUtils.utils.buildHamburgerMenu();VTPortal.roApp.redirectAtHome()},function(){},this.wsURL,this.isSSL).updateServerLanguage(window.VTPortal.roApp.getLanguageByID(n.language).ID))},nt=function(n){var t=n.validationGroup.validate();t.isValid&&(r(!1),new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.isModeApp()?VTPortal.roApp.db.settings.rememberLoginApp=i():VTPortal.roApp.db.settings.password="",VTPortal.roApp.db.settings.save(),o(""),i(""),l(""),$("#scrollview").find(".pass").each(function(){$(this).dxValidator("instance").reset()}),VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roOkChangingPwd"),"success",2500);else{var t=function(){y(!0)};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t(window.VTPortalUtils.utils.languageTag(n.Status)),"error",0,t)}}).changePassword(o(),i()))},f=null,tt=function(){var i=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingPhoto"),"error",0);t(!1)},r=function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.loadInitialData(!0,!1,!1,!1,!1),VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roProfilePhotoSaved"),"success",2e3)):VTPortalUtils.utils.processErrorMessage(n);t(!1)},n;f==null&&(f=new WebServiceRobotics(r,i));n=new FormData;VTPortal.roApp.isModeApp()==!1?n.append("userfile",a()[0]):n.append("userfile",s());VTPortal.roApp.isModeApp()?f.saveProfileImageMobile(n):f.saveProfileImageDesktop(n)};return{modelIsReady:c,viewShown:w,lblLanguage:p,lblOldPwd:i18nextko.t("lblOldPwd"),lblNewPwd:i18nextko.t("lblNewPwd"),lblNewPwdRepeat:i18nextko.t("lblNewPwdRepeat"),popupChangePwdVisible:r,popupChangeLngVisible:e,listOptions:{dataSource:h,scrollingEnabled:!1,grouped:!1,itemTemplate:"configAction",onItemClick:function(n){switch(n.itemData.ID){case 0:t(!0);break;case 1:y();break;case 2:k()}}},txtOldPwd:{placeholder:i18nextko.t("roPH_oldPwd"),value:o,mode:"password"},txtNewPwd:{placeholder:i18nextko.t("roPH_newPwd"),value:i,mode:"password"},txtNewPwdRepeat:{placeholder:i18nextko.t("roPH_newPwdRepeat"),value:l,mode:"password"},btnCancel:{onClick:b,text:i18nextko.t("roCancel")},btnCancelLng:{onClick:d,text:i18nextko.t("roCancel")},currentLanguage:u,dataSourceLanguages:{dataSource:VTPortal.roApp.availableLanguages,displayExpr:"Name",placeholder:i18nextko.t("language"),value:u,itemTemplate:"langItemTemplate",onItemClick:function(n){switch(n.itemData.ID){}}},btnChangePwd:{onClick:nt,text:i18nextko.t("roChangePwd")},btnChangeLng:{onClick:g,text:i18nextko.t("roChangePwd")},requieredOldField:{validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]},requieredNewField:{validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]},compareField:{validationRules:[{type:"compare",comparisonType:"==",comparisonTarget:i,message:i18nextko.i18n.t("roPasswordsNotMatch")}]},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),changeUserPhotoVisible:t,btnCancelUpload:{onClick:function(){t(!1)},text:i18nextko.t("roCancel")},btnAcceptUpload:{onClick:function(){tt()},text:i18nextko.t("roSaveRequest")},selectPhotoEvent:it,imageSrc:n,uploadOptions:{multiple:!1,accept:"*",value:a,uploadMode:"useForm",showFileList:!1,selectButtonText:v,onValueChanged:function(n){v(n.value[0].name)},onHiding:function(){VTPortalUtils.utils.isShowingPopup(!1)}},changeUserPhoto:function(){t(!0)},appMode:VTPortal.roApp.isModeApp(),lblProfileImage:i18nextko.t("roProfileImage"),photoPopover:{target:"#employeePhotoDiv",shading:!0,width:200,shadingColor:"rgba(0, 0, 0, 0.5)",visible:VTPortal.roApp.showPopover},photoHelp:i18nextko.t("roPhotoHelp")}};VTPortal.profile=function(n){function c(){e().viewShown();var n=[];VTPortal.roApp.db.settings.onlySupervisor||n.push({ID:1,cssClass:"dx-icon-profileUserFields"});VTPortal.roApp.isTimeGate()||n.push({ID:2,cssClass:"dx-icon-profileConfig"});VTPortal.roApp.db.settings.onlySupervisor||r.modelIsReady(!1);VTPortal.roApp.isTimeGate()||u.modelIsReady(!1);f(n)}function l(){switch(t()){case 1:r.viewShown();break;case 2:u.viewShown()}}var i=ko.observable(0),t=ko.observable(1),o,s;typeof n.id!="undefined"&&(i(parseInt(n.id,10)-1),t(parseInt(n.id,10)));var r=VTPortal.profileUserFields(),u=VTPortal.profileConfig(),h=ko.computed(function(){switch(t()){case 1:return i18nextko.i18n.t("roProfileUserFields");case 2:return i18nextko.i18n.t("roProfileConfig")}},this),f=ko.observable([]),e=ko.observable(VTPortal.bigUserInfo());return o=function(n){typeof n!="undefined"&&t(n.ID);l()},s={viewShown:c,title:h,subscribeBlock:e(),profileUserFieldsBlock:r,profileConfigBlock:u,selectedTab:i,selectedView:t,tabPanelOptions:{dataSource:f,selectedIndex:i,itemTemplate:"title",onSelectionChanged:function(n){o(n.addedItems[0])}}},s};VTPortal.taskFieldsInput=function(){var lblTaskTitle=ko.observable(""),divTitile=ko.observable(!1),divTaskField1=ko.observable(!1),divTaskField2=ko.observable(!1),divTaskField3=ko.observable(!1),divTaskField4=ko.observable(!1),divTaskField5=ko.observable(!1),divTaskField6=ko.observable(!1),lblTaskField1=ko.observable(""),lblTaskField2=ko.observable(""),lblTaskField3=ko.observable(""),lblTaskField4=ko.observable(""),lblTaskField5=ko.observable(""),lblTaskField6=ko.observable(""),valueTaskField1=ko.observable(""),valueTaskField2=ko.observable(""),valueTaskField3=ko.observable(""),valueTaskField4=ko.observable(""),valueTaskField5=ko.observable(""),valueTaskField6=ko.observable(""),cmbTaskField1=ko.observable([]),cmbTaskField2=ko.observable([]),cmbTaskField3=ko.observable([]),cmbTaskField4=ko.observable([]),cmbTaskField5=ko.observable([]),cmbTaskField6=ko.observable([]),textFieldType1=ko.observable(!0),textFieldType2=ko.observable(!0),textFieldType3=ko.observable(!0),textFieldType4=ko.observable(!0),textFieldType5=ko.observable(!0),textFieldType6=ko.observable(!0),cmbFieldType1=ko.observable(!0),cmbFieldType2=ko.observable(!0),cmbFieldType3=ko.observable(!0),cmbFieldType4=ko.observable(!0),cmbFieldType5=ko.observable(!0),cmbFieldType6=ko.observable(!0),formReadOnly=ko.observable(!1),initTaskProperties=function(readOnly){var i,tmpList;formReadOnly(readOnly);valueTaskField1("");valueTaskField2("");valueTaskField3("");valueTaskField4("");valueTaskField5("");valueTaskField6("");var punchStep=VTPortal.roApp.taskPunchRequest(),fConf=null,fValues=null;if(punchStep.currentAction==-2?(divTitile(!0),fConf=VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition,fValues=VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue,lblTaskTitle(i18nextko.i18n.t("roTaskFieldsInfo"))):(punchStep.currentAction!=-1||punchStep.newAction!=-1)&&(divTitile(!0),punchStep.currentAction!=-1&&punchStep.newAction==-1?(fConf=VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition,fValues=VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue,lblTaskTitle(i18nextko.i18n.t("roCurrentTaskUserFields")+VTPortal.roApp.userStatus().TaskTitle)):(fConf=VTPortal.roApp.taskPunchRequest().newTaskUserFieldsDefinition,fValues=VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue,lblTaskTitle(i18nextko.i18n.t("roNewTaskUserFields")))),fConf!=null&&fConf.length==6)for(i=0;i<fConf.length;i++){var divField=eval("divTaskField"+(i+1)),lblName=eval("lblTaskField"+(i+1)),textTaskField=eval("lblTaskField"+(i+1)),cmbTaskField=eval("cmbTaskField"+(i+1)),textFieldType=eval("textFieldType"+(i+1)),cmbFieldType=eval("cmbFieldType"+(i+1)),valField=eval("valueTaskField"+(i+1));if(fConf[i].Used){if(divField(!0),i<3&&fValues[i]!=""?valField(fValues[i]):i>=3&&parseFloat(fValues[i])!=-1&&valField(fValues[i]),lblName(fConf[i].Name),textFieldType(fConf[i].ValueType==0),cmbFieldType(fConf[i].ValueType==1),fConf[i].ValueType==1)if(i<3)cmbTaskField(fConf[i].ValuesList);else if(i>=3){for(tmpList=[],x=0;x<fConf[i].ValuesList.length;x++)tmpList.push(parseFloat(fConf[i].ValuesList[x]));cmbTaskField(tmpList)}}else divField(!1)}},savePunchInfo=function(){var n=VTPortal.roApp.taskPunchRequest();n.currentAction==-2?(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[0].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[0]=valueTaskField1()),VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[1].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[1]=valueTaskField2()),VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[2].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[2]=valueTaskField3()),VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[3].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[3]=valueTaskField4()),VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[4].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[4]=valueTaskField5()),VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[5].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[5]=valueTaskField6())):(n.currentAction!=-1||n.newAction!=-1)&&(n.currentAction!=-1&&n.newAction==-1?(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[0].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[0]=valueTaskField1()),VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[1].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[1]=valueTaskField2()),VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[2].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[2]=valueTaskField3()),VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[3].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[3]=valueTaskField4()),VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[4].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[4]=valueTaskField5()),VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[5].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[5]=valueTaskField6())):(VTPortal.roApp.taskPunchRequest().newTaskUserFieldsDefinition[0].Used&&(VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue[0]=valueTaskField1()),VTPortal.roApp.taskPunchRequest().newTaskUserFieldsDefinition[1].Used&&(VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue[1]=valueTaskField2()),VTPortal.roApp.taskPunchRequest().newTaskUserFieldsDefinition[2].Used&&(VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue[2]=valueTaskField3()),VTPortal.roApp.taskPunchRequest().newTaskUserFieldsDefinition[3].Used&&(VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue[3]=valueTaskField4()),VTPortal.roApp.taskPunchRequest().newTaskUserFieldsDefinition[4].Used&&(VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue[4]=valueTaskField5()),VTPortal.roApp.taskPunchRequest().newTaskUserFieldsDefinition[5].Used&&(VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue[5]=valueTaskField6())))};return{initTaskProperties:initTaskProperties,savePunchInfo:savePunchInfo,lblTaskTitle:lblTaskTitle,lblTaskField1:lblTaskField1,lblTaskField2:lblTaskField2,lblTaskField3:lblTaskField3,lblTaskField4:lblTaskField4,lblTaskField5:lblTaskField5,lblTaskField6:lblTaskField6,divTitile:divTitile,divTaskField1:divTaskField1,divTaskField2:divTaskField2,divTaskField3:divTaskField3,divTaskField4:divTaskField4,divTaskField5:divTaskField5,divTaskField6:divTaskField6,txtTaskField1:{value:valueTaskField1,visible:textFieldType1,readOnly:formReadOnly},txtTaskField2:{value:valueTaskField2,visible:textFieldType2,readOnly:formReadOnly},txtTaskField3:{value:valueTaskField3,visible:textFieldType3,readOnly:formReadOnly},txtTaskField4:{value:valueTaskField4,visible:textFieldType4,showSpinButtons:!0,readOnly:formReadOnly},txtTaskField5:{value:valueTaskField5,visible:textFieldType5,showSpinButtons:!0,readOnly:formReadOnly},txtTaskField6:{value:valueTaskField6,visible:textFieldType6,showSpinButtons:!0,readOnly:formReadOnly},cmbTaskField1:{dataSource:cmbTaskField1,value:valueTaskField1,visible:cmbFieldType1,readOnly:formReadOnly},cmbTaskField2:{dataSource:cmbTaskField2,value:valueTaskField2,visible:cmbFieldType2,readOnly:formReadOnly},cmbTaskField3:{dataSource:cmbTaskField3,value:valueTaskField3,visible:cmbFieldType3,readOnly:formReadOnly},cmbTaskField4:{dataSource:cmbTaskField4,value:valueTaskField4,visible:cmbFieldType4,readOnly:formReadOnly},cmbTaskField5:{dataSource:cmbTaskField5,value:valueTaskField5,visible:cmbFieldType5,readOnly:formReadOnly},cmbTaskField6:{dataSource:cmbTaskField6,value:valueTaskField6,visible:cmbFieldType6,readOnly:formReadOnly}}};VTPortal.statusHeader=function(){function w(){VTPortal.roApp.loggedIn&&new WebServiceRobotics(function(n){window.VTPortalUtils.utils.onLogoutSuccessFunc(n)},function(n){window.VTPortalUtils.utils.onLogoutErrorFunc(n)}).logout(VTPortal.roApp.db.settings.UUID)}function b(){if(VTPortalUtils.utils.isShowingPopup(!1),Object.has(navigator,"camera")){var t=function(){navigator.camera.getPicture(function(t){r(t);typeof device!="undefined"?cordova.platformId==="ios"?n(window.WkWebView.convertFilePath(t)):n(t):n(t)},function(n){n.includes("cancelled")||VTPortalUtils.utils.notifyMesage(n,"error",2e3)},{quality:100,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,targetWidth:200,targetHeight:200,saveToPhotoAlbum:!1,correctOrientation:!0})},i=function(){navigator.camera.getPicture(function(t){r(t);typeof device!="undefined"?cordova.platformId==="ios"?n(window.WkWebView.convertFilePath(t)):n(t):n(t)},function(n){n.includes("cancelled")||VTPortalUtils.utils.notifyMesage(n,"error",2e3)},{quality:100,sourceType:Camera.PictureSourceType.CAMERA,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,targetWidth:200,targetHeight:200,saveToPhotoAlbum:!1,correctOrientation:!0})};VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roSelectOrigin"),"info",0,t,i,i18nextko.i18n.t("roTakeFromLibrary"),i18nextko.i18n.t("roTakeFromCamera"))}else VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoCameraAvailable"),"error",0)}var t=ko.observable(!1),u=ko.observableArray(),n=ko.observable(""),f=ko.observable(i18nextko.i18n.t("roFindFile")),r=ko.observable(""),e=ko.computed(function(){return"url(data:image/png;base64,"+VTPortal.roApp.userPhoto()+") no-repeat center center"}),o=ko.computed(function(){return VTPortal.roApp.impersonatedIDEmployee==-1?VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"?VTPortal.roApp.userStatus().PresenceStatus=="Inside"?"3px solid green":"3px solid red":"":"3px solid #6b96eb"}),s=ko.computed(function(){if(VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"){var n=moment(VTPortal.roApp.userStatus().ServerDate);return n.format("LL")+" "+n.format("LT")}return""}),h=ko.computed(function(){return VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"?VTPortal.roApp.userStatus().EmployeeName:""}),c=ko.computed(function(){return VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"?VTPortal.roApp.userStatus().TaskTitle.length<=35?VTPortal.roApp.userStatus().TaskTitle:VTPortal.roApp.userStatus().TaskTitle.substr(0,35)+"...":""}),l=ko.computed(function(){return VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"?VTPortal.roApp.userStatus().CostCenterName:""}),a=ko.computed(function(){return VTPortalUtils.utils.badgeCount()}),k=ko.computed(function(){return VTPortal.roApp.showLogoutHome()!=null&&VTPortal.roApp.db.settings.ApiVersion>VTPortalUtils.apiVersion.CauseNote&&VTPortal.roApp.impersonatedIDEmployee==-1?VTPortal.roApp.showLogoutHome():!1}),v=ko.computed(function(){return VTPortal.roApp.userAlerts()!=null&&typeof VTPortal.roApp.userAlerts()!="undefined"?VTPortal.roApp.userAlerts().ScheduleStatus.RequestAlerts.length:""}),y=ko.computed(function(){return VTPortal.roApp.userAlerts()!=null&&typeof VTPortal.roApp.userAlerts()!="undefined"?VTPortal.roApp.userAlerts().ScheduleStatus.IncompletePunches.length:""}),i=null,p=function(){var f=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingPhoto"),"error",0);t(!1)},e=function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.loadInitialData(!0,!1,!1,!1,!1),VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roProfilePhotoSaved"),"success",2e3)):VTPortalUtils.utils.processErrorMessage(n);t(!1)},n;i==null&&(i=new WebServiceRobotics(e,f));n=new FormData;VTPortal.roApp.isModeApp()==!1?n.append("userfile",u()[0]):n.append("userfile",r());VTPortal.roApp.isModeApp()?i.saveProfileImageMobile(n):i.saveProfileImageDesktop(n)};return{bgImage:backgroundImage,empImage:e,borderBottom:o,lblUsername:h,lblAlerts:a,lblRequests:v,lblForgottenPunches:y,lblServerDate:s,lblProductivTask:c,lblCostCenter:l,lblProfileImage:i18nextko.t("roProfileImage"),changeUserPhotoVisible:t,btnLogout:{onClick:w,text:"",icon:"Images/Actions/exit.png",visible:!1},changeUserPhoto:function(){t(!0)},goToProfile:function(){VTPortal.app.navigate("profile")},btnCancelUpload:{onClick:function(){t(!1)},text:i18nextko.t("roCancel")},btnAcceptUpload:{onClick:function(){p()},text:i18nextko.t("roSaveRequest")},selectPhotoEvent:b,imageSrc:n,appMode:VTPortal.roApp.isModeApp(),uploadOptions:{multiple:!1,accept:"*",value:u,uploadMode:"useForm",showFileList:!1,selectButtonText:f,onValueChanged:function(n){f(n.value[0].name)},onHiding:function(){VTPortalUtils.utils.isShowingPopup(!1)}},hintView:i18nextko.i18n.t("roOptions")}};VTPortal.noPermissions=function(){return{showPermissionsIcon:VTPortal.roApp.ShowPermissionsIcon(),noDataToShow:i18nextko.i18n.t("noDataToShow")}};VTPortal.documentInput=function(){function h(u,s,h){r([""]);f(i18nextko.i18n.t("roFindFile"));i(!0);n("");t(-1);e(s);o(u);u.length>0&&(h==-1?(t(u[0].FieldValue),u.length==1&&i(!1)):(i(!1),t(h+"")))}function c(){var n=new FormData;return n.append("idTemplateDocument",t()),VTPortal.roApp.isModeApp()==!1?n.append("userfile",r()[0]):n.append("userfile",u()),n}function l(){if(VTPortalUtils.utils.isShowingPopup(!1),Object.has(navigator,"camera")){var t=function(){navigator.camera.getPicture(function(t){u(t);typeof device!="undefined"?cordova.platformId==="ios"?n(window.WkWebView.convertFilePath(t)):n(t):n(t)},function(n){n.includes("cancelled")||VTPortalUtils.utils.notifyMesage(n,"error",2e3)},{quality:75,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,targetWidth:960,targetHeight:1280,saveToPhotoAlbum:!1,correctOrientation:!0})},i=function(){navigator.camera.getPicture(function(t){u(t);typeof device!="undefined"?cordova.platformId==="ios"?n(window.WkWebView.convertFilePath(t)):n(t):n(t)},function(n){n.includes("cancelled")||VTPortalUtils.utils.notifyMesage(n,"error",2e3)},{quality:75,sourceType:Camera.PictureSourceType.CAMERA,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,targetWidth:960,targetHeight:1280,saveToPhotoAlbum:!1,correctOrientation:!0})};VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roSelectOrigin"),"info",0,t,i,i18nextko.i18n.t("roTakeFromLibrary"),i18nextko.i18n.t("roTakeFromCamera"))}else VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoCameraAvailable"),"error",0)}var r=ko.observableArray([""]),n=ko.observable(""),e=ko.observable(!1),u=ko.observable(""),i=ko.observable(!0),t=ko.observable(-1),o=ko.observable([]),s=ko.observable(""),f=ko.observable(i18nextko.i18n.t("roFindFile"));return{lblDocumentSelect:i18nextko.t("roRequestDocumentType"),lblImageCapture:i18nextko.t("roSelectFile"),lblSelectFile:i18nextko.t("roSelectFile"),selectPhotoEvent:l,imageSrc:n,appMode:VTPortal.roApp.isModeApp(),cmbDocumentSelect:{dataSource:o,displayExpr:"FieldName",valueExpr:"FieldValue",value:t,readOnly:e},uploadOptions:{multiple:!1,accept:"*",value:r,uploadMode:"useForm",showFileList:!1,selectButtonText:f,onValueChanged:function(n){f(n.value[0].name);s(t())}},initializeData:h,getDocument:c,documentIdTemplate:s,canSelectTemplate:i}};VTPortal.bigUserInfo=function(){function r(n,t,i){var u=i/10,r;if(n=="",r=n,t==null)return"background: url("+r+") no-repeat center; background-size: contain !important;height:100%;opacity:"+u+"";switch(t){case 4:return"background: url("+r+") no-repeat center; background-size: cover !important;height:100%;opacity:"+u+"";case 3:return"background: url("+r+") no-repeat right; background-size: contain !important;height:100%;opacity:"+u+"";case 2:return"background: url("+r+") no-repeat center; background-size: contain !important;height:100%;opacity:"+u+"";case 1:return"background: url("+r+") no-repeat left; background-size: contain !important;height:100%;opacity:"+u+"";default:return"background: url("+r+") no-repeat center; background-size: contain !important;height:100%;opacity:"+u+""}return""}function u(n,t){return VTPortal.roApp.impersonatedIDEmployee==-1?((n==null||n=="")&&(n="#0046FE"),(t==null||t=="")&&(t="#286EFF")):(n="#FF4B4F",t="#FF4B4F"),"background: linear-gradient(to right, "+n+", "+t+");background-size: contain !important; height: 100%;"}function tt(){VTPortal.roApp.loggedIn&&new WebServiceRobotics(function(n){window.VTPortalUtils.utils.onLogoutSuccessFunc(n)},function(n){window.VTPortalUtils.utils.onLogoutErrorFunc(n)}).logout(VTPortal.roApp.db.settings.UUID)}var it=ko.observable(0),rt=ko.observable(0),n=ko.observable(""),t=ko.observable(""),i=ko.computed(function(){return VTPortal.roApp.impersonatedIDEmployee!=-1}),f=function(){VTPortal.roApp.impersonatedIDEmployee==-1?(VTPortal.roApp.userStatus()!=null&&n(VTPortal.roApp.userStatus().EmployeeName),VTPortal.roApp.LastLogin()!=null&&t(i18nextko.i18n.t("roLastLogin")+": "+moment(VTPortal.roApp.LastLogin()).format("DD MMMM YYYY, HH:mm:ss"))):n(VTPortal.roApp.impersonatedNameEmployee)},e=ko.computed(function(){return"url(data:image/png;base64,"+VTPortal.roApp.userPhoto()+") no-repeat center center"}),o=ko.computed(function(){return VTPortal.roApp.lastRequestFailed()?"noConnection":"sandClock"}),s=ko.computed(function(){return VTPortal.roApp.db.settings.onlySupervisor&&VTPortal.roApp.impersonatedIDEmployee==-1?!1:!0}),h=ko.computed(function(){return VTPortal.roApp.impersonatedIDEmployee==-1?VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"?VTPortal.roApp.userStatus().PresenceStatus=="Inside"?"":"":"":""}),c=ko.computed(function(){return VTPortal.roApp.lastRequestFailed()?"red":VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().PresenceStatus=="Inside"?"green":"red":"red"}),l=ko.computed(function(){if(VTPortal.roApp.lastRequestFailed())return i18nextko.i18n.t("roWithoutConnection");if(VTPortal.roApp.userStatus()!=null){var n=moment(VTPortal.roApp.userStatus().ServerDate),t=moment(VTPortal.roApp.userStatus().LastPunchDate),i=n.diff(t);return moment.duration(i).humanize()}return""}),a=ko.computed(function(){if(moment(n).format("D MM YYYY, h:mm:ss a"),VTPortal.roApp.lastRequestFailed())return i18nextko.i18n.t("roWithoutConnection");if(VTPortal.roApp.userStatus()!=null){var i=moment(VTPortal.roApp.userStatus().ServerDate),n=moment(VTPortal.roApp.userStatus().LastPunchDate),r=i.diff(n),t=moment.utc(r).format("HH:mm [horas]");return VTPortal.roApp.userStatus().PresenceStatus=="Inside"?i18nextko.i18n.t("roInFrom")+moment(n).format("HH:mm")+" ("+t+"h)":i18nextko.i18n.t("roOutFrom")+moment(n).format("HH:mm")+" ("+t+"h)"}return""}),v=ko.computed(function(){if(VTPortal.roApp.userStatus()!=null){var n=moment(VTPortal.roApp.userStatus().ServerDate);return n.format("LT")}return""}),ut=ko.computed(function(){return VTPortal.roApp.showLogoutHome()!=null&&VTPortal.roApp.db.settings.ApiVersion>VTPortalUtils.apiVersion.CauseNote&&VTPortal.roApp.impersonatedIDEmployee==-1?VTPortal.roApp.showLogoutHome():!1}),y=ko.computed(function(){if(VTPortal.roApp.userStatus()!=null){var n=moment(VTPortal.roApp.userStatus().ServerDate);return n.format("dddd DD MMM")}return""}),p=ko.computed(function(){return moment().hour()<13&&moment().hour()>5?i18nextko.i18n.t("roWelcomeMorning"):moment().hour()>12&&moment().hour()<21?i18nextko.i18n.t("roWelcomeAfter"):i18nextko.i18n.t("roWelcomeNight")}),w=ko.computed(function(){return VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().TaskTitle.length<=50?VTPortal.roApp.userStatus().TaskTitle:VTPortal.roApp.userStatus().TaskTitle.substr(0,48)+"...":""}),b=ko.computed(function(){return VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().CostCenterName:""}),k=ko.computed(function(){return VTPortal.roApp.customBackground()!=null?(VTPortal.roApp.HasCustomHeader(!0),u(VTPortal.roApp.customBackground().LeftColor,VTPortal.roApp.customBackground().RightColor)):(VTPortal.roApp.HasCustomHeader(!1),"")}),d=ko.computed(function(){return VTPortal.roApp.customBackground()!=null?(VTPortal.roApp.HasCustomHeader(!0),r(VTPortal.roApp.customBackground().Image,VTPortal.roApp.customBackground().Position,VTPortal.roApp.customBackground().Opacity)):(VTPortal.roApp.HasCustomHeader(!1),"")}),g=ko.computed(function(){return VTPortal.roApp.customBackground()!=null?"url("+VTPortal.roApp.customBackground().Image+") no-repeat center center":(VTPortal.roApp.HasCustomHeader(!1),"")}),nt=ko.computed(function(){return VTPortal.roApp.customBackground()!=null&&VTPortal.roApp.customBackground().Image?!0:!1});return{viewShown:f,empImage:e,customCompanyLogo:g,companyLogoVisible:nt,borderBottom:h,myTime:l,lblEmployeeStatusTime:a,textColor:c,lblWelcome:p,photoVisible:s,lblUsername:n,lblLastLogin:t,lblServerTime:v,lblServerDate:y,lblProfile:i18nextko.t("roProfileOf"),isSupervisor:i,lblProductivTask:w,lblProfileImage:i18nextko.t("roProfileImage"),appMode:VTPortal.roApp.isModeApp(),lblCostCenter:b,statusIcon:o,cssBackground:ko.computed(function(){return VTPortal.roApp.impersonatedIDEmployee!=-1?"backgroundOpacityImp":"backgroundOpacity"}),customCssBackground:k,customPhotoBackground:d,btnLogout:{onClick:tt,text:"",icon:"Images/Actions/exit.png",visible:!1}}};VTPortal.onboardings=function(){function r(){var i=[];return new WebServiceRobotics(function(t){var i,r;if(t.Status==window.VTPortalUtils.constants.OK.value){for(i=t.OnBoardings,r=0;r<i.length;r++)i[r].StartDate=moment(i[r].StartDate).format("DD-MM-YYYY");n(new DevExpress.data.DataSource({store:i,sort:"EmployeeName",searchOperation:"contains",searchExpr:["EmployeeName","Comments","Status"]}))}else VTPortalUtils.utils.processErrorMessage(t)}).getMyOnBoardings(),i.length>0?t(!0):t(!0),i}function u(){i().viewShown();r()}function f(n,t,i){if(n.Status!=null){var u=n.Status.split("/"),f=$("<div style='background:"+n.Image+"' class='listMenuItemIcon EmployeeImagePhoto' />"),r=$("<div>").attr("class","listMenuItemContent");r.append($("<div>").attr("class",n.cssClassText).text(n.EmployeeName));r.append($("<span>").attr("style","float:right;margin-top: 6px;font-size: 11px;").text(n.StartDate));r.append($("<div />").dxProgressBar({min:0,max:parseInt(u[1],10),value:parseInt(u[0],10),width:150,statusFormat:function(t){return"Estado: "+n.Status+" ("+Math.round(t*100)+"%)"}}));r.append($("<div>").attr("class","smallTextDescriptionOnb").text(n.Comments));i.append(f,r)}}var t=ko.observable(!1),n=ko.observable(new DevExpress.data.DataSource({searchOperation:"contains",searchExpr:["EmployeeName","Comments","Status"]})),i=ko.observable(VTPortal.bigUserInfo());return{viewShown:u,title:"OnBoarding",subscribeBlock:i(),onboardingDS:t,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),commScroll:{height:"70%",onPullDown:function(){r()}},listProgress:{min:0,max:100,value:63},listonboardings:{dataSource:n,scrollingEnabled:!1,grouped:!1,itemTemplate:f,onItemClick:function(n){VTPortal.app.navigate("onboardingDetail/"+n.itemData.IdList)}},searchOptions:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(t){n().searchValue(t.value);n().load()}}}};VTPortal.onboardingDetail=function(n){function f(n,r,u){var f=!1;f=n==!1?!0:!1;new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value){var r=n.Tasks;i(!0);t(new DevExpress.data.DataSource({store:r,sort:"Done",searchOperation:"contains",searchExpr:["TaskName"]}))}else VTPortalUtils.utils.processErrorMessage(n)}).updateTaskStatus(f,r,u)}function e(n,t,i){var r=$("<div>").attr("class","listMenuItemContentOnb");n.Done==!0?(r.append($("<div />").attr("style","float:left;margin-top: 10px;").dxCheckBox({value:n.Done})),r.append($("<div>").attr("style","margin-left: 50px; margin-top: -5px;font-size: 13px;").text(n.TaskName)),r.append($("<div>").attr("class","smallTextDescriptionOnb").attr("style","float:right;").text(n.SupervisorName)),r.append($("<div>").attr("class","smallTextDescriptionOnb").attr("style","margin-left:50px;").text(n.LastChangeDate))):(r.append($("<div />").attr("style","float:left;").dxCheckBox({value:n.Done})),r.append($("<div>").attr("style","margin-left: 50px; margin-top: -5px;font-size: 13px;").text(n.TaskName)));i.append(r)}function o(){r().viewShown();u()}var i=ko.observable(),t=ko.observable(new DevExpress.data.DataSource({searchOperation:"contains",searchExpr:["TaskName"]})),r=ko.observable(VTPortal.bigUserInfo()),u=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value){var r=n.Tasks;i(!0);t(new DevExpress.data.DataSource({store:r,sort:"Done",searchOperation:"contains",searchExpr:["TaskName"]}))}else i(!1),VTPortalUtils.utils.processErrorMessage(n)}).getOnBoardingtasksById(n.id)};return{viewShown:o,title:"OnBoarding",subscribeBlock:r(),taskDS:i,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),commScroll:{height:"70%",onPullDown:function(){u()}},listtasks:{dataSource:t,scrollingEnabled:!1,grouped:!1,itemTemplate:e,noDataText:"Todava no se han creado tareas",onItemClick:function(n){f(n.itemData.Done,n.itemData.Id,n.itemData.IdList)}},searchOptions:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(n){t().searchValue(n.value);t().load()}}}};VTPortal.myTeamRequests=function(){function o(){u().viewShown();s()}function s(){var u,f,e;t(!1);r(!0);u=VTPortal.roApp.supervisorFilters();f=function(u){var e,o,s,f,h;if(r(!1),u.Status==window.VTPortalUtils.constants.OK.value){for(e=u.Requests,o=0;o<e.length;o++){e[o].Name=e[o].Name;e[o].hasAction=!0;s="";switch(e[o].Status){case 0:s="ro_Status_pending";break;case 1:s="ro_Status_ongoing";break;case 2:s="ro_Status_accepted";break;case 3:s="ro_Status_denied"}f="";switch(e[o].IdRequestType){case 1:f="dx-icon-userFieldChange";break;case 2:f="dx-icon-forbiddenPunch";break;case 3:f="dx-icon-justifyPunch";break;case 4:f="dx-icon-externalWorkResume";break;case 5:f="dx-icon-changeShift";break;case 6:f="dx-icon-plannedHoliday";break;case 7:f="dx-icon-plannedAbsences";break;case 8:f="dx-icon-shiftExchange";break;case 9:f="dx-icon-plannedCauses";break;case 10:f="dx-icon-forbiddenPunch";break;case 11:f="dx-icon-holidaysCancel";break;case 12:f="dx-icon-forbiddenPunch";break;case 13:f="dx-icon-plannedHoliday";break;case 14:f="dx-icon-plannedOvertime";break;case 15:f="dx-icon-externalWorkWeekResume";break;case 16:f="dx-icon-telecommute"}e[o].cssContainerClass=s;e[o].cssClass=f}i(e.length);n(new DevExpress.data.DataSource({store:e,searchOperation:"contains",searchExpr:"Name"}));setTimeout(function(){t()?$("#panelsContent").height($("#panelsContent").height()-80):$("#scrollview").height($("#panelsContent").height()-45)},100)}else i(0),n(new DevExpress.data.DataSource({store:[],searchOperation:"contains",searchExpr:"Name"})),h=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(u,h)};u==null?(t(!1),e=VTPortal.roApp.requestsDS(),e!=null&&typeof e.Requests!="undefined"?(VTPortal.roApp.requestsDS(null),f(e)):new WebServiceRobotics(function(n){f(n)}).getSupervisedRequests(!1,moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").startOf("year").add(1,"year"),"0*1|1*2*3*4*5*6*7*8*9*10*11*12*13*14*15*16","RequestDate DESC",moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").add(1,"year"))):(t(!0),new WebServiceRobotics(function(n){f(n)}).getSupervisedRequests(!1,u.filter.iDate,u.filter.eDate,u.filter.status.join("*")+"|"+u.filter.types.join("*"),u.order.by+" "+u.order.direction,u.filter.iRequestedDate,u.filter.eRequestedDate))}var i=ko.observable(0),n=ko.observable(new DevExpress.data.DataSource({store:[],searchOperation:"contains",searchExpr:"Name"})),f=ko.observable(!1),t=ko.observable(!1),r=ko.observable(!1),e=ko.computed(function(){return VTPortal.roApp.supervisorFilters()!=null?i18nextko.i18n.t("roFilteringData"):""}),u=ko.observable(VTPortal.bigUserInfo()),h=function(){f(!1);VTPortal.app.navigate("RequestFilters/4")};return{viewShown:o,title:i18nextko.i18n.t("roMyTeamRequests"),subscribeBlock:u(),requestsDS:i,dataFiltered:t,filterDescription:e,listRequests:{dataSource:n,scrollingEnabled:!1,grouped:!1,itemTemplate:"RequestItem",onItemClick:function(n){if(n.itemData.hasAction)if(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.NewRequests){[2,5,6,7,9,10,11,12,13,16].includes(n.itemData.IdRequestType)||(VTPortal.roApp.impersonateOnlyRequest=!0,VTPortal.roApp.impersonatedIDEmployee=n.itemData.IdEmployee,VTPortal.roApp.impersonatedNameEmployee=i18nextko.i18n.t("roProfileOf")+n.itemData.Name,VTPortal.roApp.loadInitialData(!0,!1,!1,!1,!1));switch(n.itemData.IdRequestType){case 1:VTPortal.app.navigate("userFields/"+n.itemData.Id);break;case 2:case 10:case 12:VTPortal.app.navigate("forgotten/"+n.itemData.Id);break;case 3:VTPortal.app.navigate("justifyPunch/"+n.itemData.Id);break;case 4:VTPortal.app.navigate("externalWork/"+n.itemData.Id);break;case 5:VTPortal.app.navigate("changeShiftNew/"+n.itemData.Id);break;case 6:case 7:case 9:case 13:VTPortal.app.navigate("absence/"+n.itemData.Id);break;case 8:VTPortal.app.navigate("shiftExchange/"+n.itemData.Id);break;case 11:VTPortal.app.navigate("cancelHolidaysNew/"+n.itemData.Id);break;case 14:VTPortal.app.navigate("plannedOvertime/"+n.itemData.Id);break;case 15:VTPortal.app.navigate("externalWorkWeekResume/"+n.itemData.Id);break;case 16:VTPortal.app.navigate("telecommuting/"+n.itemData.Id)}}else{VTPortal.roApp.impersonateOnlyRequest=!0;VTPortal.roApp.impersonatedIDEmployee=n.itemData.IdEmployee;VTPortal.roApp.impersonatedNameEmployee=i18nextko.i18n.t("roProfileOf")+n.itemData.Name;VTPortal.roApp.loadInitialData(!0,!1,!1,!1,!1);switch(n.itemData.IdRequestType){case 1:VTPortal.app.navigate("userFields/"+n.itemData.Id);break;case 2:VTPortal.app.navigate("forgottenPunch/"+n.itemData.Id);break;case 3:VTPortal.app.navigate("justifyPunch/"+n.itemData.Id);break;case 4:VTPortal.app.navigate("externalWork/"+n.itemData.Id);break;case 5:VTPortal.app.navigate("changeShift/"+n.itemData.Id);break;case 6:VTPortal.app.navigate("plannedHoliday/"+n.itemData.Id);break;case 7:VTPortal.app.navigate("plannedAbsence/"+n.itemData.Id);break;case 8:VTPortal.app.navigate("shiftExchange/"+n.itemData.Id);break;case 9:VTPortal.app.navigate("plannedCause/"+n.itemData.Id);break;case 10:VTPortal.app.navigate("forgottenPunch/"+n.itemData.Id);break;case 11:VTPortal.app.navigate("cancelHolidays/"+n.itemData.Id);break;case 12:VTPortal.app.navigate("forgottenPunch/"+n.itemData.Id);break;case 13:VTPortal.app.navigate("plannedHoliday/"+n.itemData.Id);break;case 14:VTPortal.app.navigate("plannedOvertime/"+n.itemData.Id);break;case 15:VTPortal.app.navigate("externalWorkWeekResume/"+n.itemData.Id)}}}},btnFilterRequests:{onClick:h,text:"",icon:"Images/Common/filter.png"},searchOptions:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(t){n().searchValue(t.value);n().load()}},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.myTeamEmployees=function(){function f(){r().viewShown();n(!0);u&&i(!1);var f=function(){if(VTPortal.roApp.supervisedEmployees.length==0){var i=setTimeout(function(){n(!1)},6e4);new WebServiceRobotics(function(r){var u,f,e;if(n(!1),clearTimeout(i),r.Status==window.VTPortalUtils.constants.OK.value){for(u=r.Employees,f=0;f<u.length;f++){u[f].Image==""&&(u[f].Image=r.DefaultImage);e="";switch(u[f].PresenceStatus){case"Inside":e="employeeListPhoto";break;case"Outside":e="employeeListPhotoOut"}u[f].cssContainerClass=e;u[f].InTelecommute=="True"?(u[f].ImageTC="dx-icon-taTelecommuting_HomeList",u[f].InTelecommuteDesc="Teletrabajo casa teletrabajando tele teletreball teleworking telecommute telecommuting teleworking"):u[f].InTelecommuteDesc="oficina office centro centre workcenter presencial on-site";u[f].TaskTitle!=""&&u[f].TaskTitle!=null&&(u[f].TaskTitle=i18nextko.i18n.t("inTask")+u[f].TaskTitle);u[f].CostCenterName!=""&&u[f].CostCenterName!=null&&(u[f].CostCenterName=i18nextko.i18n.t("inCostCenter")+u[f].CostCenterName)}VTPortal.roApp.supervisedEmployees=r.Employees;t(new DevExpress.data.DataSource({store:u,searchOperation:"contains",searchExpr:["Name","Group","TaskTitle","CostCenterName","InTelecommuteDesc"]}))}else VTPortalUtils.utils.processErrorMessage(r)}).getMyEmployees()}else n(!1)};VTPortal.roApp.loggedIn?(f(),VTPortal.roApp.showLegalText()=="1"&&localStorage.getItem("ShowLegalText.VTPortal")!="0"&&VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roENSShowLegalText"),"info",0,function(){localStorage.setItem("ShowLegalText.VTPortal","0")})):(n(!1),VTPortalUtils.utils.loginIfNecessary("",f))}var t=ko.observable(new DevExpress.data.DataSource({store:VTPortal.roApp.supervisedEmployees,searchOperation:"contains",searchExpr:["Name","Group","TaskTitle","CostCenterName","InTelecommuteDesc"]})),r=ko.observable(VTPortal.bigUserInfo()),n=ko.observable(!1),e=function(n){if(typeof n!="undefined"&&n!=null)if(VTPortal.roApp.isImpersonateEnabled()){var t=parseInt(n.itemData.EmployeeId,10);VTPortal.roApp.impersonatedIDEmployee=t;VTPortal.roApp.impersonatedNameEmployee=i18nextko.i18n.t("roProfileOf")+n.itemData.Name;VTPortal.roApp.loadInitialData(!0,!0,!0,!1,!1,function(){VTPortal.roApp.redirectAtHome()})}else VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roImpersonateDenied"),"info",0)},o=ko.observable(!1),i=ko.observable(!1),u=ko.computed(function(){return!VTPortal.roApp.licenseAccepted()&&VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.LicenseAgreement&&VTPortal.roApp.impersonatedIDEmployee==-1}),s=ko.computed(function(){return VTPortal.roApp.licenseConsent()==null?i18nextko.i18n.t("roLicenseText"):VTPortal.roApp.licenseConsent().Message}),h=ko.computed(function(){return VTPortal.roApp.licenseConsent()==null?!1:!0}),c=function(){i()&&(VTPortal.roApp.licenseConsent()==null?new WebServiceRobotics(function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.db.settings.licenseAccepted=!0,VTPortal.roApp.db.settings.save(),VTPortal.roApp.licenseAccepted(!0)):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t(window.VTPortalUtils.utils.languageTag(n.Status)),"error",0)}).acceptMyLicense(i()):new WebServiceRobotics(function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.db.settings.licenseAccepted=!0,VTPortal.roApp.db.settings.save(),VTPortal.roApp.licenseAccepted(!0)):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t(window.VTPortalUtils.utils.languageTag(n.Status)),"error",0)}).acceptConsent(VTPortal.roApp.licenseConsent().Message))},l=function(){n(!0);new WebServiceRobotics(function(i){var r,u,f;if(n(!1),i.Status==window.VTPortalUtils.constants.OK.value){for(r=i.Employees,u=0;u<r.length;u++){r[u].Image==""&&(r[u].Image=i.DefaultImage);f="";switch(r[u].PresenceStatus){case"Inside":f="employeeListPhoto";break;case"Outside":f="employeeListPhotoOut"}r[u].cssContainerClass=f;r[u].InTelecommute=="True"&&(r[u].ImageTC="dx-icon-taTelecommuting_HomeList");r[u].TaskTitle!=""&&r[u].TaskTitle!=null&&(r[u].TaskTitle=i18nextko.i18n.t("inTask")+r[u].TaskTitle);r[u].CostCenterName!=""&&r[u].CostCenterName!=null&&(r[u].CostCenterName=i18nextko.i18n.t("inCostCenter")+r[u].CostCenterName)}VTPortal.roApp.supervisedEmployees=i.Employees;t(new DevExpress.data.DataSource({store:r,searchOperation:"contains",searchExpr:["Name","Group","TaskTitle","CostCenterName"]}))}else VTPortalUtils.utils.processErrorMessage(i)}).getMyEmployees()};return{viewShown:f,title:i18nextko.i18n.t("roMyTeamEmployees"),subscribeBlock:r(),listOptions:{dataSource:t,grouped:!1,indicateLoading:!1,pageLoadMode:"nextButton",height:"90%",itemTemplate:"item",onItemClick:e},btnRefresh:{onClick:l,text:"",icon:"Images/Common/refresh.png"},searchOptions:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(n){t().searchValue(n.value);t().load()}},licenceViewContent:{bounceEnabled:!0,showScrollbar:"always",height:200},lblTermsAndContidions:i18nextko.t("roTermsAndConditions"),customConsent:h,lbllicenseText:s,lbllicenseAdv1:i18nextko.t("roAgreement1"),lbllicenseAdv2:i18nextko.t("roAgreement2"),lbllicenseAdv3:i18nextko.t("roAgreement3"),licenseVisible:u,ckLicenceAccepted:{text:i18nextko.t("roLicenseAccept"),value:i,disabled:o},btnAcceptLicense:{onClick:c,text:i18nextko.t("roSaveLicense")},loadingPanel:{showPane:!1,height:110,shading:!0,shadingColor:"rgba(255,255,255,0.5)",indicatorSrc:"Images/DoubleRing.gif",visible:n}}};VTPortal.myTeamDailyRecords=function(){function r(n){var t=Math.floor(n/60),i=n%60;return t=t<10?"0"+t:t,i=i<10?"0"+i:i,t+":"+i}function a(){o().viewShown();s()}function s(){var i,e,o;t(!1);f(!0);i=VTPortal.roApp.supervisorFiltersDR();e=function(i){var e,o,c,h,s,l,a;if(f(!1),i.Status==window.VTPortalUtils.constants.OK.value){for(e=i.Requests,o=0;o<e.length;o++){e[o].Name=e[o].Name;e[o].GroupName=e[o].DailyRecord.EmployeeGroup;e[o].hasAction=!0;e[o].DailyRecord.EmployeeImage==""&&(e[o].DailyRecord.EmployeeImage=i.DefaultImage);e[o].EmployeeImage=e[o].DailyRecord.EmployeeImage;c=moment(e[o].DailyRecord.RecordDate).format("DD-MM-YYYY");e[o].Description=i18nextko.i18n.t("roRequestDRInfo")+"<b>"+c+"<\/b>"+i18nextko.i18n.t("roRequestDRInfo2")+e[o].DailyRecord.Punches.length+i18nextko.i18n.t("roRequestDRInfo3");e[o].DailyRecord.Adjusted?(s=i18nextko.i18n.t("roAdjusted"),e[o].Adjusted=s,e[o].cssClassAdjusted="roAdjusted"):e[o].DailyRecord.TimeAccrued==0?(s=i18nextko.i18n.t("roNoAccrued"),e[o].Adjusted=s,e[o].cssClassAdjusted="roNoAccrued"):(s=i18nextko.i18n.t("roNoAdjusted"),e[o].Adjusted=s,e[o].cssClassAdjusted="roNoAdjusted",h=e[o].DailyRecord.TimeExpected-e[o].DailyRecord.TimeAccrued,e[o].AdjustedDetails=h<=0?Math.abs(h)<120?i18nextko.i18n.t("roAdjustedExceeded")+" "+r(Math.abs(h))+" "+i18nextko.i18n.t("roExceededHoursDROne"):i18nextko.i18n.t("roAdjustedExceeded")+" "+r(Math.abs(h))+" "+i18nextko.i18n.t("roExceededHoursDR"):Math.abs(h)<120?i18nextko.i18n.t("roAdjustedMissingOne")+" "+r(Math.abs(h))+" "+i18nextko.i18n.t("roExceededHoursDROne"):i18nextko.i18n.t("roAdjustedMissing")+" "+r(Math.abs(h))+" "+i18nextko.i18n.t("roExceededHoursDR"));e[o].IdStatus=e[o].Status;switch(e[o].Status){case 0:s=i18nextko.i18n.t("roRequestStatus_pending");e[o].Status=s;break;case 1:s=i18nextko.i18n.t("roRequestStatus_running");e[o].Status=s;break;case 2:s=i18nextko.i18n.t("roRequestStatus_approved");e[o].Status=s;break;case 3:s=i18nextko.i18n.t("roRequestStatus_denied");e[o].Status=s;break;case 4:s=i18nextko.i18n.t("roRequestStatus_canceled");e[o].Status=s}l="";e[o].cssClass=l}u(e.length);n(new DevExpress.data.DataSource({store:e,searchOperation:"contains",searchExpr:["Name","GroupName","Adjusted","Description","Status","AdjustedDetails"]}));setTimeout(function(){t()?$("#panelsContent").height($("#panelsContent").height()-80):$("#scrollview").height($("#panelsContent").height()-45)},100)}else u(0),n(new DevExpress.data.DataSource({store:[],searchOperation:"contains",searchExpr:["Name","GroupName","Adjusted","Description","AdjustedDetails"]})),a=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(i,a)};i==null?(t(!1),o=VTPortal.roApp.dailyRecordsDS(),o!=null&&typeof o.Requests!="undefined"?(VTPortal.roApp.dailyRecordsDS(null),e(o)):new WebServiceRobotics(function(n){e(n)}).getSupervisedRequests(!1,moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").startOf("year").add(1,"year"),"0*1|17","RequestDate DESC",moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").add(1,"year"))):(t(!0),new WebServiceRobotics(function(n){e(n)}).getSupervisedRequests(!1,i.filter.iDate,i.filter.eDate,i.filter.status.join("*")+"|"+i.filter.types.join("*"),i.order.by+" "+i.order.direction,i.filter.iRequestedDate,i.filter.eRequestedDate))}var u=ko.observable(0),n=ko.observable(new DevExpress.data.DataSource({store:[],searchOperation:"contains",searchExpr:["Name","GroupName","Adjusted","Description","Status","AdjustedDetails"]})),c=ko.observable(!1),t=ko.observable(!1),i=ko.observable([]),f=ko.observable(!1),y=ko.observable(!1),l=ko.computed(function(){return VTPortal.roApp.supervisorFiltersDR()!=null?i18nextko.i18n.t("roFilteringData"):""}),e=ko.computed(function(){return i().length>0?!0:!1}),o=ko.observable(VTPortal.bigUserInfo()),h=function(n){idRequests=JSON.stringify(i());var t=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("GENERAL_ERROR"),"error",0)},r=function(n){return function(t){i([]);s();t.Status==window.VTPortalUtils.constants.OK.value?n=="approve"?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestsApproved"),"success",5e3):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestsDenied"),"success",5e3):n=="approve"?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestsNoApproved"),"error",5e3):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestsNoDenied"),"error",5e3)}};wsRobotics=new WebServiceRobotics(r(n),t);wsRobotics.approveRefuseMultipleDR(idRequests,n,!1)},v=function(){c(!1);VTPortal.app.navigate("RequestFilters/5")};return{viewShown:a,title:i18nextko.i18n.t("roMyTeamRequests"),subscribeBlock:o(),dailyRecordsDS:u,dataFiltered:t,filterDescription:l,listRequests:{dataSource:n,scrollingEnabled:!1,grouped:!1,itemTemplate:"RequestItem",showSelectionControls:!0,onSelectionChanged:function(n){var t=[];n.component.option("selectedItemKeys").forEach(n=>{(n.IdStatus==0||n.IdStatus==1)&&t.push(n.Id)});i(t)},selectionMode:"all",onItemClick:function(n){n.itemData.hasAction&&VTPortal.app.navigate("dailyRecordDetail/"+n.itemData.Id+"/"+moment(n.itemData.DailyRecord.RecordDate).format("YYYY-MM-DD")+"/false/FR")},selectionByClick:!1},btnFilterRequests:{onClick:v,text:"",icon:"Images/Common/filter.png"},searchOptions:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(t){n().searchValue(t.value);n().load()}},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),btnApprove:{onClick:function(){h("approve")},text:i18nextko.i18n.t("roApprove"),hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:e},btnRefuse:{onClick:function(){h("refuse")},text:i18nextko.i18n.t("roRefuse"),hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:e}}};VTPortal.myTeamAlertsDetail=function(n){var t=ko.observable(new DevExpress.data.DataSource({store:[],searchOperation:"contains",searchExpr:"name"})),i=ko.observable(VTPortal.bigUserInfo()),r=function(){var u,f,o,e,r;if(i().viewShown(),VTPortal.roApp.userAlerts()!=null&&typeof VTPortal.roApp.userAlerts()!="undefined"&&VTPortal.roApp.loggedIn==!0&&(u=VTPortal.roApp.userAlerts().SupervisorStatus,f=[],u!=null)){o="";e=!1;switch(parseInt(n.id,10)){case-1:for(r=0;r<u.DocumentAlerts.AbsenteeismDocuments.length;r++)f.push({ID:-1,IdDocumentTemplate:u.DocumentAlerts.AbsenteeismDocuments[r].IDDocumentTemplate,IdCause:u.DocumentAlerts.AbsenteeismDocuments[r].IdCause,NotificationDate:moment.tz(u.DocumentAlerts.AbsenteeismDocuments[r].DateTime,VTPortal.roApp.serverTimeZone),cssClass:"dx-icon-AbsenteeismDocuments",name:i18nextko.i18n.t("roAbsenteeismDocument"),hasAction:e,type:"tracking",description:u.DocumentAlerts.AbsenteeismDocuments[r].Description});break;case-2:for(r=0;r<u.DocumentAlerts.DocumentsValidation.length;r++)f.push({ID:-1,IdDocumentTemplate:u.DocumentAlerts.DocumentsValidation[r].IDDocumentTemplate,IdCause:u.DocumentAlerts.DocumentsValidation[r].IdCause,NotificationDate:moment.tz(u.DocumentAlerts.DocumentsValidation[r].DateTime,VTPortal.roApp.serverTimeZone),cssClass:"dx-icon-DocumentsValidation",name:i18nextko.i18n.t("roDocumentValidation"),hasAction:e,type:"tracking",description:u.DocumentAlerts.DocumentsValidation[r].Description});break;case-3:for(r=0;r<u.DocumentAlerts.GpaAlerts.length;r++)f.push({ID:-1,IdDocumentTemplate:u.DocumentAlerts.GpaAlerts[r].IDDocumentTemplate,IdCause:u.DocumentAlerts.GpaAlerts[r].IdCause,NotificationDate:moment.tz(u.DocumentAlerts.GpaAlerts[r].DateTime,VTPortal.roApp.serverTimeZone),cssClass:"dx-icon-GpaAlerts",name:i18nextko.i18n.t("roGpaDocument"),hasAction:e,type:"tracking",description:u.DocumentAlerts.GpaAlerts[r].Description});break;case-4:for(r=0;r<u.DocumentAlerts.MandatoryDocuments.length;r++)f.push({ID:-1,IdDocumentTemplate:u.DocumentAlerts.MandatoryDocuments[r].IDDocumentTemplate,IdCause:u.DocumentAlerts.MandatoryDocuments[r].IdCause,NotificationDate:moment.tz(u.DocumentAlerts.MandatoryDocuments[r].DateTime,VTPortal.roApp.serverTimeZone),cssClass:"dx-icon-MandatoryDocuments",name:i18nextko.i18n.t("roMandatoryDocument"),hasAction:e,type:"tracking",description:u.DocumentAlerts.MandatoryDocuments[r].Description});break;case-5:for(r=0;r<u.DocumentAlerts.WorkForecastDocuments.length;r++)f.push({ID:-1,IdDocumentTemplate:u.DocumentAlerts.WorkForecastDocuments[r].IDDocumentTemplate,IdCause:u.DocumentAlerts.WorkForecastDocuments[r].IdCause,NotificationDate:moment.tz(u.DocumentAlerts.WorkForecastDocuments[r].DateTime,VTPortal.roApp.serverTimeZone),cssClass:"dx-icon-WorkForecastDocuments",name:i18nextko.i18n.t("roAccessForecastDocuments"),hasAction:e,type:"tracking",description:u.DocumentAlerts.WorkForecastDocuments[r].Description});break;case-6:for(r=0;r<u.DocumentAlerts.AccessAuthorizationDocuments.length;r++)f.push({ID:-1,IdDocumentTemplate:u.DocumentAlerts.AccessAuthorizationDocuments[r].IDDocumentTemplate,IdCause:u.DocumentAlerts.AccessAuthorizationDocuments[r].IdCause,NotificationDate:moment.tz(u.DocumentAlerts.AccessAuthorizationDocuments[r].DateTime,VTPortal.roApp.serverTimeZone),cssClass:"dx-icon-AccessAuthorizationDocuments",name:i18nextko.i18n.t("roAccessAuthorizationDocument"),hasAction:e,type:"tracking",description:u.DocumentAlerts.AccessAuthorizationDocuments[r].Description});break;default:new WebServiceRobotics(function(i){var u,r;if(i.Status==window.VTPortalUtils.constants.OK.value){for(u=0;u<i.Alerts.length;u++){r="";switch(parseInt(n.id,10)){case 40:r="dx-icon-request_pending";break;case 41:r="dx-icon-employee_present_with_expired_documents";break;case 19:r="dx-icon-Day_with_Unreliable_Time_Record";break;case 21:r="dx-icon-Non_Justified_Incident";break;case 20:r="dx-icon-Day_with_Unreliable_Time_Record";break;case 15:r="dx-icon-Employee_Not_Arrived_or_Late";break;case 43:r="dx-icon-LabAgree_Max_Exceeded";break;case 44:r="dx-icon-LabAgree_Min_Reached";break;case 24:r="dx-icon-Task_Close_to_Start";break;case 23:r="dx-icon-Task_Close_to_Finish";break;case 25:r="dx-icon-Task_Exceeding_Planned_Time";break;case 29:r="dx-icon-Task_exceeding_Started_Date";break;case 26:r="dx-icon-Task_Exceeding_Finished_Date";break;case 30:r="dx-icon-Task_With_ALerts";break;case 45:r="dx-icon-Tasks_Request_complete";break;case 54:r="dx-icon-Productive_Unit_Under_Coverage";break;case 57:r="dx-icon-Productive_Unit_Under_Coverage";break;case 58:r="dx-icon-Productive_Unit_Under_Coverage";break;case 59:r="dx-icon-Productive_Unit_Under_Coverage";break;case 60:r="dx-icon-Productive_Unit_Under_Coverage"}f.push({ID:i.Alerts[u].Id,name:i.Alerts[u].Name,cssClass:r,description:i.Alerts[u].Description})}t(new DevExpress.data.DataSource({store:f,searchOperation:"contains",searchExpr:"name"}))}else VTPortalUtils.utils.processErrorMessage(i)}).getSupervisorAlertsDetail(parseInt(n.id,10))}t(new DevExpress.data.DataSource({store:f,searchOperation:"contains",searchExpr:"name"}));setTimeout(function(){$("#scrollview").height($("#panelsContent").height()-50)},100)}};return{viewShown:r,title:i18nextko.t("roMyTeamAlerts"),subscribeBlock:i(),loadingPanel:VTPortalUtils.utils.loadingPanelConf(),listAlerts:{dataSource:t,scrollingEnabled:!1,grouped:!1,itemTemplate:"AlertItem"},searchAlerts:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(n){t().searchValue(n.value);t().load()}}}};VTPortal.myTeamAlerts=function(){var n=ko.observable([]),t=ko.observable(VTPortal.bigUserInfo()),i=function(){t().viewShown();var i=n;let r=function(){var n=VTPortal.roApp.userAlerts().SupervisorStatus,r=[],u,t;if(n!=null&&(u="",typeof n.Alerts!="undefined"))for(t=0;t<n.Alerts.length;t++)switch(n.Alerts[t].AlertType){case 40:r.push({AlertType:n.Alerts[t].AlertType,cssClass:"dx-icon-request_pending",name:i18nextko.i18n.t("roRequest_pending"),hasAction:!0,type:"request",description:n.Alerts[t].Description});break;case 41:r.push({AlertType:n.Alerts[t].AlertType,cssClass:"dx-icon-employee_present_with_expired_documents",name:i18nextko.i18n.t("roemployee_present_with_expired_documents"),hasAction:!0,type:"request",description:n.Alerts[t].Description});break;case 19:r.push({AlertType:n.Alerts[t].AlertType,cssClass:"dx-icon-Day_With_Unmatched_Time_Record",name:i18nextko.i18n.t("Day_With_Unmatched_Time_Record"),hasAction:!0,type:"request",description:n.Alerts[t].Description});break;case 21:r.push({AlertType:n.Alerts[t].AlertType,cssClass:"dx-icon-Non_Justified_Incident",name:i18nextko.i18n.t("roNon_Justified_Incident"),hasAction:!0,type:"request",description:n.Alerts[t].Description});break;case 20:r.push({AlertType:n.Alerts[t].AlertType,cssClass:"dx-icon-Day_with_Unreliable_Time_Record",name:i18nextko.i18n.t("roDay_with_Unreliable_Time_Record"),hasAction:!0,type:"request",description:n.Alerts[t].Description});break;case 15:r.push({AlertType:n.Alerts[t].AlertType,cssClass:"dx-icon-Employee_Not_Arrived_or_Late",name:i18nextko.i18n.t("roEmployee_Not_Arrived_or_Late"),hasAction:!0,type:"request",description:n.Alerts[t].Description});break;case 43:r.push({AlertType:n.Alerts[t].AlertType,cssClass:"dx-icon-LabAgree_Max_Exceeded",name:i18nextko.i18n.t("roLabAgree_Max_Exceeded"),hasAction:!0,type:"request",description:n.Alerts[t].Description});break;case 44:r.push({AlertType:n.Alerts[t].AlertType,cssClass:"dx-icon-LabAgree_Min_Reached",name:i18nextko.i18n.t("roLabAgree_Min_Reached"),hasAction:!0,type:"request",description:n.Alerts[t].Description});break;case 24:r.push({AlertType:n.Alerts[t].AlertType,cssClass:"dx-icon-Task_Close_to_Start",name:i18nextko.i18n.t("roTask_Close_to_Start"),hasAction:!0,type:"request",description:n.Alerts[t].Description});break;case 23:r.push({AlertType:n.Alerts[t].AlertType,cssClass:"dx-icon-Task_Close_to_Finish",name:i18nextko.i18n.t("roTask_Close_to_Finish"),hasAction:!0,type:"request",description:n.Alerts[t].Description});break;case 25:r.push({AlertType:n.Alerts[t].AlertType,cssClass:"dx-icon-Task_Exceeding_Planned_Time",name:i18nextko.i18n.t("roTask_Exceeding_Planned_Time"),hasAction:!0,type:"request",description:n.Alerts[t].Description});break;case 29:r.push({AlertType:n.Alerts[t].AlertType,cssClass:"dx-icon-Task_exceeding_Started_Date",name:i18nextko.i18n.t("roTask_exceeding_Started_Date"),hasAction:!0,type:"request",description:n.Alerts[t].Description});break;case 26:r.push({AlertType:n.Alerts[t].AlertType,cssClass:"dx-icon-Task_Exceeding_Finished_Date",name:i18nextko.i18n.t("roTask_Exceeding_Finished_Date"),hasAction:!0,type:"request",description:n.Alerts[t].Description});break;case 30:r.push({AlertType:n.Alerts[t].AlertType,cssClass:"dx-icon-Task_With_ALerts",name:i18nextko.i18n.t("roTask_With_ALerts"),hasAction:!0,type:"request",description:n.Alerts[t].Description});break;case 45:r.push({AlertType:n.Alerts[t].AlertType,cssClass:"dx-icon-Tasks_Request_complete",name:i18nextko.i18n.t("roTasks_Request_complete"),hasAction:!0,type:"request",description:n.Alerts[t].Description});break;case 54:r.push({AlertType:n.Alerts[t].AlertType,cssClass:"dx-icon-Productive_Unit_Under_Coverage",name:i18nextko.i18n.t("roProductive_Unit_Under_Coverage"),hasAction:!0,type:"request",description:n.Alerts[t].Description});break;case 57:r.push({AlertType:n.Alerts[t].AlertType,cssClass:"dx-icon-Productive_Unit_Under_Coverage",name:i18nextko.i18n.t("roConsent_PortalAlert"),hasAction:!0,type:"request",description:n.Alerts[t].Description});break;case 58:r.push({AlertType:n.Alerts[t].AlertType,cssClass:"dx-icon-Productive_Unit_Under_Coverage",name:i18nextko.i18n.t("roConsent_DesktopAlert"),hasAction:!0,type:"request",description:n.Alerts[t].Description});break;case 59:r.push({AlertType:n.Alerts[t].AlertType,cssClass:"dx-icon-Productive_Unit_Under_Coverage",name:i18nextko.i18n.t("roConsent_TerminalAlert"),hasAction:!0,type:"request",description:n.Alerts[t].Description});break;case 60:r.push({AlertType:n.Alerts[t].AlertType,cssClass:"dx-icon-Productive_Unit_Under_Coverage",name:i18nextko.i18n.t("roConsent_VisitsAlert"),hasAction:!0,type:"request",description:n.Alerts[t].Description})}typeof n.DocumentAlerts!="undefined"&&(u="dx-icon-trackingDocuments",n.DocumentAlerts.AbsenteeismDocuments.length>0&&r.push({AlertType:-1,cssClass:"dx-icon-AbsenteeismDocuments",name:i18nextko.i18n.t("roAbsenteeismDocument"),hasAction:!0,type:"request",description:i18nextko.i18n.t("roAlertExists")+" "+n.DocumentAlerts.AbsenteeismDocuments.length+" "+i18nextko.i18n.t("roAlertAbsenteeism")}),n.DocumentAlerts.DocumentsValidation.length>0&&r.push({AlertType:-2,cssClass:"dx-icon-DocumentsValidation",name:i18nextko.i18n.t("roDocumentValidation"),hasAction:!0,type:"request",description:i18nextko.i18n.t("roAlertExists")+" "+n.DocumentAlerts.DocumentsValidation.length+" "+i18nextko.i18n.t("roAlertDocumentsValidation")}),n.DocumentAlerts.GpaAlerts.length>0&&r.push({AlertType:-3,cssClass:"dx-icon-GpaAlerts",name:i18nextko.i18n.t("roGpaDocument"),hasAction:!0,type:"request",description:i18nextko.i18n.t("roAlertExists")+" "+n.DocumentAlerts.GpaAlerts.length+" "+i18nextko.i18n.t("roAlertGpaAlerts")}),n.DocumentAlerts.MandatoryDocuments.length>0&&r.push({AlertType:-4,cssClass:"dx-icon-MandatoryDocuments",name:i18nextko.i18n.t("roMandatoryDocument"),hasAction:!0,type:"request",description:i18nextko.i18n.t("roAlertExists")+" "+n.DocumentAlerts.MandatoryDocuments.length+" "+i18nextko.i18n.t("roAlertMandatoryDocuments")}),n.DocumentAlerts.WorkForecastDocuments.length>0&&r.push({AlertType:-5,cssClass:"dx-icon-WorkForecastDocuments",name:i18nextko.i18n.t("roAccessForecastDocuments"),hasAction:!0,type:"request",description:i18nextko.i18n.t("roAlertExists")+" "+n.DocumentAlerts.WorkForecastDocuments.length+" "+i18nextko.i18n.t("roAlertForecastDocuments")}),n.DocumentAlerts.AccessAuthorizationDocuments.length>0&&r.push({AlertType:-6,cssClass:"dx-icon-AccessAuthorizationDocuments",name:i18nextko.i18n.t("roAccessAuthorizationDocument"),hasAction:!0,type:"request",description:i18nextko.i18n.t("roAlertExists")+" "+n.DocumentAlerts.AccessAuthorizationDocuments.length+" "+i18nextko.i18n.t("roAlertAccessAuthorization")}));i(r)};VTPortal.roApp.refreshEmployeeAlerts(r)},r=function(){VTPortal.roApp.db.settings.markForRefresh(["status","notifications"]);VTPortal.roApp.refreshEmployeeStatus(!1);i()};return{viewShown:i,title:i18nextko.t("roMyTeamAlerts"),subscribeBlock:t(),mtalertDS:n,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),btnRefresh:{onClick:r,text:"",icon:"Images/Common/refresh.png"},listAlerts:{dataSource:n,scrollingEnabled:!1,grouped:!1,itemTemplate:"AlertItem",onItemClick:function(n){if(n.itemData.hasAction)switch(n.itemData.AlertType){case 40:VTPortal.app.navigate("myTeamRequests/",{root:!0});break;default:VTPortal.app.navigate("myTeamAlertsDetail/"+n.itemData.AlertType)}}}}};VTPortal.myteam=function(n){function y(){let n=function(n){return function(){var t,i;VTPortal.roApp.userAlerts()!=null&&typeof VTPortal.roApp.userAlerts()!="undefined"&&VTPortal.roApp.loggedIn==!0&&(t=VTPortal.roApp.userAlerts().SupervisorStatus,typeof t.Alerts!="undefined"&&typeof n.alertsCount()!="undefined"&&n.alertsCount(t.Alerts.length),typeof t.DocumentAlerts!="undefined"&&typeof n.alertsCount()!="undefined"&&n.alertsCount(n.alertsCount()+t.DocumentAlerts.AbsenteeismDocuments.length+t.DocumentAlerts.DocumentsValidation.length+t.DocumentAlerts.GpaAlerts.length+t.DocumentAlerts.MandatoryDocuments.length+t.DocumentAlerts.WorkForecastDocuments.length+t.DocumentAlerts.AccessAuthorizationDocuments.length),i=function(t){var i,r;if(t.Status==window.VTPortalUtils.constants.OK.value){const u=Object.assign({},t);i=t.Requests.filter(n=>n.IdRequestType!==17);n&&n.requestsCount(i.length);t.Requests!=null&&typeof t.Requests!="undefined"&&(u.Requests=i);VTPortal.roApp.requestsDS(u);r=t.Requests.filter(n=>n.IdRequestType===17);const f=Object.assign({},t);n&&n.dailyRecordsCount(r.length);t.Requests!=null&&typeof t.Requests!="undefined"&&(f.Requests=r);VTPortal.roApp.dailyRecordsDS(f);n&&n.refreshAvailableOptions()}else n&&n.requestsCount(0),n&&n.dailyRecordsCount(0),n&&n.refreshAvailableOptions()},new WebServiceRobotics(function(n){i(n)}).getSupervisedRequests(!1,moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").startOf("year").add(1,"year"),"0*1|1*2*3*4*5*6*7*8*9*10*11*12*13*14*15*16*17","RequestDate DESC"))}};VTPortal.roApp.refreshEmployeeAlerts(n(f))}function p(){VTPortal.roApp.loggedIn||VTPortalUtils.utils.loginIfNecessary();var n=[];n.push({ID:1,Name:i18nextko.t("roMyTeamEmployees")});n.push({ID:2,Name:i18nextko.t("roMyTeamRequests"),Count:l});VTPortal.roApp.DailyRecordEnabled()&&n.push({ID:4,Name:i18nextko.t("roMyTeamDailyRecords"),Count:a});(VTPortal.roApp.userStatus().HasAlertPermission||typeof VTPortal.roApp.userStatus().HasAlertPermission=="undefined")&&n.push({ID:3,Name:i18nextko.t("roMyTeamAlerts"),Count:v});e(n);setTimeout(function(){$("#scrollview").height($("#panelsContent").height())},100)}function w(){f=this;u().viewShown();y();o()}var t=ko.observable(0),i=ko.observable(0),r=ko.observable(0),s=ko.observable(1),h=ko.observable(0),b=ko.observable(!1),u=ko.observable(VTPortal.bigUserInfo()),f=null,o;typeof n.id!="undefined"&&(s(parseInt(n.id,10)),h(parseInt(n.id,10)-1));var c=ko.computed(function(){return VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.SupervisorPortal?!0:!1}),e=ko.observable(new DevExpress.data.DataSource({store:[]})),l=ko.computed(function(){return t()==0?i18nextko.i18n.t("noRequests"):i18nextko.i18n.t("newRequests")+t()+i18nextko.i18n.t("newRequests2")}),a=ko.computed(function(){return i()==0?i18nextko.i18n.t("noWorkingStatements"):i18nextko.i18n.t("newWorkingStatements")+i()+i18nextko.i18n.t("newWorkingStatements2")}),v=ko.computed(function(){return r()==0?i18nextko.i18n.t("noAlerts"):i18nextko.i18n.t("newAlerts")+r()+i18nextko.i18n.t("newAlerts2")});return o=function(){VTPortal.notificationsHome().viewShown();VTPortal.roApp.refreshEmployeeStatus();VTPortal.roApp.refreshEmployeeAlerts()},{viewShown:w,title:i18nextko.i18n.t("roMySupervisorTitle"),subscribeBlock:u(),futureVersions:i18nextko.t("roMyTeamFutureVersions"),isSupervisorPortalActive:c,listOptions:{height:"100%",scrollingEnabled:!1,grouped:!1,dataSource:e,indicateLoading:!1,onItemClick:function(n){switch(n.itemData.ID){case 1:VTPortal.app.navigate("myTeamEmployees");break;case 2:VTPortal.app.navigate("myTeamRequests");break;case 3:VTPortal.app.navigate("myTeamAlerts");break;case 4:VTPortal.app.navigate("myTeamDailyRecords");break;default:VTPortalUtils.utils.notifyMesage("not implemented","error",2e3)}}},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),alertsCount:r,dailyRecordsCount:i,refreshAvailableOptions:p,requestsCount:t}};VTPortal.sendLeaveDocument=function(n){function tt(){w().viewShown();VTPortal.roApp.isTimeGate()?l(!1):l(!0);r(null);c()!=-1&&nt()}function it(){var c,n,w;if(VTPortal.roApp.documentSent(!0),i()&&r()==null)VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDateNeeded"),"error",0);else{if(VTPortal.roApp.isModeApp()==!1)if(c=p(),c==null||c.length==0){var u=null,l=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},a=function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roLaveSaved"),"success",2e3),VTPortal.roApp.loadInitialData(!1,!1,!1,!1,!1)):VTPortalUtils.utils.processErrorMessage(n)};u==null&&(u=new WebServiceRobotics(a,l));var v=i()?moment(r()).format("YYYY-MM-DD"):null,y=new VTPortal.documentInput,b=y.getDocument();u.setLeaveEndDate(f(),v,t()!=-1?t():o())}else n=new FormData,n.append("idTemplateDocument",t()!=-1?t():o()),n.append("idRelatedObject",f()),n.append("remarks",s()),n.append("docRelatedInfo",i()?moment(r()).format("YYYYMMDD"):""),n.append("forecastType",h()),n.append("userfile",c[0]),new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDocumentSaved"),"success",2e3),VTPortal.roApp.loadInitialData(!1,!1,!1,!1,!1);else{var t=function(){};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorUploadingFile"),"error",0,n)}).uploadDocumentDesktop(n);else if(e()==null||e()==""){var u=null,l=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},a=function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roLaveSaved"),"success",2e3),VTPortal.roApp.loadInitialData(!1,!1,!1,!1,!1)):VTPortalUtils.utils.processErrorMessage(n)};u==null&&(u=new WebServiceRobotics(a,l));var v=i()?moment(r()).format("YYYY-MM-DD"):null,y=new VTPortal.documentInput,b=y.getDocument();u.setLeaveEndDate(f(),v,t()!=-1?t():o())}else n=new FormData,n.append("idTemplateDocument",t()!=-1?t():o()),n.append("userfile",e()),n.append("idRelatedObject",f()),w=i()?moment(r()).format("YYYYMMDD"):"",new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDocumentSaved"),"success",2e3),VTPortal.roApp.redirectAtHome(),VTPortal.roApp.loadInitialData(!1,!1,!1,!1,!1);else{var t=function(){};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorUploadingFile"),"error",0,n)}).uploadDocumentMobile(n,h(),s(),w);VTPortal.roApp.db.settings.markForRefresh(["status","notifications"])}}function rt(){if(VTPortalUtils.utils.isShowingPopup(!1),Object.has(navigator,"camera")){var n=function(){navigator.camera.getPicture(function(n){e(n);typeof device!="undefined"?cordova.platformId==="ios"?u(window.WkWebView.convertFilePath(n)):u(n):u(n)},function(n){n.includes("cancelled")||VTPortalUtils.utils.notifyMesage(n,"error",2e3)},{quality:100,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,targetWidth:960,targetHeight:1280,saveToPhotoAlbum:!1,correctOrientation:!0})},t=function(){navigator.camera.getPicture(function(n){e(n);typeof device!="undefined"?cordova.platformId==="ios"?u(window.WkWebView.convertFilePath(n)):u(n):u(n)},function(n){n.includes("cancelled")||VTPortalUtils.utils.notifyMesage(n,"error",2e3)},{quality:100,sourceType:Camera.PictureSourceType.CAMERA,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,targetWidth:960,targetHeight:1280,saveToPhotoAlbum:!1,correctOrientation:!0})};VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roSelectOrigin"),"info",0,n,t,i18nextko.i18n.t("roTakeFromLibrary"),i18nextko.i18n.t("roTakeFromCamera"))}else VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoCameraAvailable"),"error",0)}var t=ko.observable(-1),f=ko.observable(-1),s=ko.observable(""),i=ko.observable(!1),r=ko.observable(null),e=ko.observable(""),h=ko.observable(""),c=ko.observable(-1),k=ko.computed(function(){return t()==-1}),d=ko.computed(function(){return t()==-1?i18nextko.i18n.t("roRequestDocumentType"):i18nextko.i18n.t("roRequestSelectFile")}),l=ko.observable(!1),y=ko.observable(i18nextko.i18n.t("roFindFile")),p=ko.observableArray(),u=ko.observable(""),v,b;typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));typeof n.param!="undefined"&&parseInt(n.param,10)!=-1&&f(parseInt(n.param,10));typeof n.iDate!="undefined"&&parseInt(n.iDate,10)!=-1&&c(parseInt(n.iDate,10));typeof n.objId!="undefined"&&n.objId!=""&&h(n.objId);var o=ko.observable(t()),a=ko.observable([]),g=ko.computed(function(){return"76%"}),nt=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)a(n.SelectFields),t()!=-1&&v({value:t()+""});else{var i=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,i)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingCauseInfo"),"error",0,n)}).getRequieredLeaveDocuments(c(),!1)},w=ko.observable(VTPortal.bigUserInfo());return v=function(n){var r=n.value,t=null;$.grep(a(),function(n){n.FieldValue==r&&(t=n)});t!=null&&t.RelatedInfo=="1"?i(!0):i(!1)},b={viewShown:tt,title:i18nextko.t("roRequestType_SendDocument"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:d,lblImageCapture:i18nextko.t("roTakePhoto"),lblSelectFile:i18nextko.t("roSelectFile"),lblDocDate:i18nextko.t("roRequestDocRelatedDate"),subscribeBlock:w(),dateVisible:i,scrollContent:{height:g},btnSave:{onClick:it,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:l},remarks:{value:s},cmbRequestValue1:{dataSource:a,displayExpr:"FieldName",valueExpr:"FieldValue",value:o,visible:k,onValueChanged:v},docDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:r,valueChangeEvent:"focusout"},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),selectPhotoEvent:rt,imageSrc:u,appMode:VTPortal.roApp.isModeApp(),uploadOptions:{multiple:!1,accept:"*",value:p,uploadMode:"useForm",showFileList:!1,selectButtonText:y,onValueChanged:function(n){y(n.value[0].name)}},isTimeGate:VTPortal.roApp.isTimeGate(),lblTimegateRestricted:i18nextko.t("roRestrictedTGfunctionallity")},b};VTPortal.newLeave=function(n){function b(){h().viewShown();e([]);w("causes.availableleave");o(!0)}function k(){var o=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},s=function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roLaveSaved"),"success",2e3),VTPortal.roApp.db.settings.markForRefresh(["status","notifications"]),VTPortal.roApp.loadInitialData(!1,!1,!1,!1,!1)):VTPortalUtils.utils.processErrorMessage(n)},e,n;t==null&&(t=new WebServiceRobotics(s,o));e=f.getDocument();n=i()==null?VTPortalUtils.nullDate:moment(i());VTPortal.roApp.isModeApp()?t.saveLeaveMobile(n,n,r(),u(),e):t.saveLeaveDesktop(n,n,r(),u(),e)}var u=ko.observable(""),o=ko.observable(!1),s=ko.observable([]),f=new VTPortal.documentInput,a=ko.computed(function(){return!VTPortal.roApp.isTimeGate()&&s().length>0}),i=ko.observable(moment().toDate()),t,c,l;typeof n.iDate!="undefined"&&parseInt(n.iDate,10)!=-1&&i(moment(n.iDate,"YYYY-MM-DD"));var v=ko.computed(function(){return i18nextko.i18n.t("roRequestType_Leave")}),y=ko.computed(function(){return i18nextko.i18n.t("roSelectLeave")}),r=ko.observable(null),e=ko.observable([]),p=ko.computed(function(){return"80%"}),w=function(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)e(n.SelectFields),n.SelectFields.length>0&&r(n.SelectFields[0].FieldValue);else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},h=ko.observable(VTPortal.bigUserInfo());return t=null,c=function(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)s(n.SelectFields),f.initializeData(n.SelectFields,!1,-1);else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingCauseInfo"),"error",0,n)}).getRequieredLeaveDocuments(parseInt(n.value,10),!0)},l={viewShown:b,title:v,lblDocDate:i18nextko.t("roRequestDocRelatedDate"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:y,subscribeBlock:h(),scrollContent:{height:p},btnSave:{onClick:k,text:"",icon:"Images/Common/save.png",visible:o},remarks:{value:u},cmbRequestValue1:{dataSource:e,displayExpr:"FieldName",valueExpr:"FieldValue",value:r,onValueChanged:c},docDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:i,valueChangeEvent:"focusout"},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),myDocumentsBlock:f,hasDocuments:a},l};VTPortal.myLeavesAlerts=function(){function r(){f();t(!0)}function f(){var t=VTPortal.roApp.userAlerts()?VTPortal.roApp.userAlerts().ScheduleStatus:null,e=[],f,i,r,u;if(t!=null&&(f="",typeof t.TrackingDocuments!="undefined"))for(f="dx-icon-trackingDocuments",i=0;i<t.TrackingDocuments.length;i++){r="days";u=0;t.TrackingDocuments[i].IdHoursAbsence>0?(r="hours",u=t.TrackingDocuments[i].IdHoursAbsence):t.TrackingDocuments[i].IdOvertimeForecast>0?(r="overtime",u=t.TrackingDocuments[i].IdOvertimeForecast):t.TrackingDocuments[i].IdDaysAbsence>0&&(r="days",u=t.TrackingDocuments[i].IdDaysAbsence);let n=!0;VTPortal.roApp.isTimeGate()&&(n=!1);t.TrackingDocuments[i].Scope==3&&r=="days"&&e.push({ID:-1,IdDocumentTemplate:t.TrackingDocuments[i].IDDocumentTemplate,IdRelatedObject:u,IdCause:t.TrackingDocuments[i].IdCause,ForecatstType:r,NotificationDate:moment.tz(t.TrackingDocuments[i].DateTime,VTPortal.roApp.serverTimeZone),cssClass:f,name:i18nextko.i18n.t("roTrackingDocument"),hasAction:n,type:"tracking",description:t.TrackingDocuments[i].Description,iDate:null})}n(e);$("#scrollview").height($("#panelsContent").height()-70)}var t=ko.observable(!1),n=ko.observable([]),i=VTPortal.noPermissions(),u=ko.computed(function(){return VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().LeavesEnabled?!0:!1}),e=function(){VTPortal.app.navigate("newLeave/-1")};return{modelIsReady:t,viewShown:r,hasPermission:u,noPermissions:i,newRequest:{onClick:e,text:"",icon:"Images/Common/plus.png",visible:VTPortal.roApp.ReadMode()==!1},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),alertDS:n,listAlerts:{dataSource:n,scrollingEnabled:!1,grouped:!1,itemTemplate:"AlertItem",onItemClick:function(n){if(n.itemData.hasAction)switch(n.itemData.type){case"tracking":VTPortal.app.navigate("sendLeaveDocument/"+n.itemData.IdDocumentTemplate+"/"+n.itemData.IdRelatedObject+"/"+n.itemData.IdCause+"/"+n.itemData.ForecatstType)}}}}};VTPortal.myLeaves=function(){function r(){f();t(!0)}function f(){(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().LeavesEnabled)&&new WebServiceRobotics(function(t){var i,r,u;if(t.Status==window.VTPortalUtils.constants.OK.value){for(i=t.Leaves,r=0;r<i.length;r++)i[r].cssClass="dx-icon-Leave",i[r].Description=i18nextko.i18n.t("roLeavesFrom")+" "+moment.tz(i[r].BeginDate,VTPortal.roApp.serverTimeZone).format("L")+" "+i18nextko.i18n.t("roLeavesCause")+" "+i[r].Cause,i[r].hasAction=VTPortal.roApp.isTimeGate()?!1:!0,i[r].AlertDescription=i[r].DocAlerts!=null&&i[r].DocAlerts.length>0?i[r].DocAlerts[0].Description:i18nextko.i18n.t("roLeavesNoAlerts");n(i);$("#scrollview").height($("#panelsContent").height()-70)}else n([]),u=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(t,u)}).getMyLeaves(!0,null,null)}var t=ko.observable(!1),n=ko.observable([]),i=VTPortal.noPermissions(),u=ko.computed(function(){return VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().LeavesEnabled?!0:!1}),e=function(){VTPortal.app.navigate("newLeave/-1")};return{modelIsReady:t,viewShown:r,hasPermission:u,noPermissions:i,leavesDS:n,listLeaves:{dataSource:n,grouped:!1,scrollingEnabled:!1,onItemClick:function(n){n.itemData.hasAction&&VTPortal.app.navigate("sendLeaveDocument/-1/"+n.itemData.AbsenceID+"/"+n.itemData.IdCause+"/leave")}},newRequest:{onClick:e,text:"",icon:"Images/Common/plus.png",visible:VTPortal.roApp.ReadMode()==!1},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.leaves=function(n){function s(){var i=moment(n.param);r.modelIsReady(!1);u.modelIsReady(!1);switch(t()){case 1:r.viewShown(i);break;case 2:u.viewShown(i)}}function v(){e().viewShown();s();VTPortal.roApp.refreshEmployeeAlerts()}var t=ko.observable(1),i=ko.observable(0),e,h,c;typeof n.id!="undefined"&&(t(parseInt(n.id,10)),i(parseInt(n.id,10)-1));var r=VTPortal.myLeaves(),u=VTPortal.myLeavesAlerts(),l=ko.computed(function(){switch(t()){case 1:return i18nextko.i18n.t("roMyLeavesTitle");case 2:return i18nextko.i18n.t("roMyLeavesAletsTitle")}},this),o=ko.observable([]),a=ko.computed(function(){var t,i,n;if(VTPortal.roApp.userAlerts()&&typeof VTPortal.roApp.userAlerts().ScheduleStatus.TrackingDocuments!="undefined"){for(t=VTPortal.roApp.userAlerts().ScheduleStatus,i=0,n=0;n<t.TrackingDocuments.length;n++)t.TrackingDocuments[n].IdDaysAbsence>0&&t.TrackingDocuments[n].Scope==3&&i++;return i}return 0}),f=[];return f.push({ID:1,cssClass:"dx-icon-myLeaves"}),f.push({ID:2,cssClass:"dx-icon-myLeavesAlerts",badge:a()}),o(f),e=ko.observable(VTPortal.bigUserInfo()),h=function(n){t(n.ID);s();i(n.ID-1)},c={viewShown:v,title:l,subscribeBlock:e(),myLeavesBlock:r,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),myLeavesAlertsBlock:u,selectedView:t,selectedIndex:i,tabPanelOptions:{dataSource:o,selectedIndex:i,itemTemplate:"title",onSelectionChanged:function(n){h(n.addedItems[0])}}},c};VTPortal.telecommutingHome=function(){var n=ko.observable(null),t=ko.computed(function(){if(n()!=null)if(n().ByPercentage==!0)switch(n().Period){case 0:return i18nextko.i18n.t("tcPercentageUsed")+" "+n().CurrentAgreementPercentageUsed+i18nextko.i18n.t("tcPercentageUsed2")+" ("+i18nextko.i18n.t("tcPercentageUsed3")+n().MaxPercentage+"%/"+i18nextko.i18n.t("semana")+")";case 1:return i18nextko.i18n.t("tcPercentageUsed")+" "+n().CurrentAgreementPercentageUsed+i18nextko.i18n.t("tcPercentageUsed2")+" ("+i18nextko.i18n.t("tcPercentageUsed3")+n().MaxPercentage+"%/"+i18nextko.i18n.t("mes")+")";case 2:return i18nextko.i18n.t("tcPercentageUsed")+" "+n().CurrentAgreementPercentageUsed+i18nextko.i18n.t("tcPercentageUsed2")+" ("+i18nextko.i18n.t("tcPercentageUsed3")+n().MaxPercentage+"%/"+i18nextko.i18n.t("trimestre")+")"}else switch(n().Period){case 0:return i18nextko.i18n.t("tcDaysUsed")+" "+n().CurrentAgreementDaysUsed+" "+i18nextko.i18n.t("tcDaysUsed2")+" ("+i18nextko.i18n.t("tcPercentageUsed3")+n().MaxDays+"d/"+i18nextko.i18n.t("semana")+")";case 1:return i18nextko.i18n.t("tcDaysUsed")+" "+n().CurrentAgreementDaysUsed+" "+i18nextko.i18n.t("tcDaysUsed2")+" ("+i18nextko.i18n.t("tcPercentageUsed3")+n().MaxDays+"d/"+i18nextko.i18n.t("mes")+")";case 2:return i18nextko.i18n.t("tcDaysUsed")+" "+n().CurrentAgreementDaysUsed+" "+i18nextko.i18n.t("tcDaysUsed2")+" ("+i18nextko.i18n.t("tcPercentageUsed3")+n().MaxDays+"d/"+i18nextko.i18n.t("trimestre")+")"}else return""}),i=ko.computed(function(){return n()!=null?n().TCToday.toLowerCase()=="true"?i18nextko.i18n.t("tcTodayHome"):n().NoWorkToday.toLowerCase()=="true"?i18nextko.i18n.t("tcNoWorkToday"):n().WorkcenterNameToday==""?i18nextko.i18n.t("tcTodayOfficeNWC"):i18nextko.i18n.t("tcTodayOffice")+n().WorkcenterNameToday:i18nextko.i18n.t("tcLoading")}),r=ko.computed(function(){return n()!=null?n().TCTomorrow.toLowerCase()=="true"?i18nextko.i18n.t("tcTomorrowHome"):n().NoWorkTomorrow.toLowerCase()=="true"?i18nextko.i18n.t("tcNoWorkTomorrow"):n().WorkcenterNameTomorrow==""?i18nextko.i18n.t("tcTomorrowOfficeNWC"):i18nextko.i18n.t("tcTomorrowOffice")+n().WorkcenterNameTomorrow:""}),u=ko.computed(function(){return i18nextko.i18n.t("roTeleworkingTitle")}),f=function(){new WebServiceRobotics(function(t){t.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.db.settings.updateCacheDS("tcinfo",t),n(t)):DevExpress.ui.notify(i18nextko.t("roTCError"),"warning",3e3)}).getTelecommutingInfo(moment())},e=function(){n(VTPortal.roApp.db.settings.getCacheDS("tcinfo"));(n()==null||window.VTPortalUtils.needToRefresh("tcinfo"))&&f()};return{viewShown:e,telecommutingTitle:u,lblTCToday:i,lblTCTomorrow:r,lblCurrentPercentage:t,iconTC:{icon:"map"}}};VTPortal.webLinksHome=function(){function i(){new WebServiceRobotics(function(i){i.Status===window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.db.settings.updateCacheDS("weblinks",i.Value),t(i.Value)):(n([]),DevExpress.ui.notify(i18nextko.t("RES_webLinkError"),"warning",3e3))}).GetAllPortalWebLinks()}function r(){i(function(t){n(t)})}function u(n){n&&VTPortal.roApp.openURLonExternalBrowser(n)}function t(t){const i=[];if(t!=null&&(t.length==0||t.length>0&&typeof t[0].ShowOnPortalDashboard!="undefined")){let n=t.filter(function(n){return n.ShowOnPortalDashboard===!0});for(let t=0;t<n.length;t++)i.push({title:n[t].Title,text:n[t].Description,url:n[t].URL})}else VTPortal.roApp.db.settings.markForRefresh(["weblinks"]);n(i)}var n=ko.observable([]),f=function(){let n=VTPortal.roApp.db.settings.getCacheDS("weblinks");n==null||window.VTPortalUtils.needToRefresh("weblinks")?r():t(n)};return{linksDS:n,openLink:u,viewShown:f}};VTPortal.surveysHome=function(){function t(){window.VTPortalUtils.utils.setActiveTab("surveys");VTPortal.app.navigate("surveys",{root:!0})}var n=ko.observable(0),i=ko.computed(function(){return n()}),r=ko.computed(function(){return n(0),VTPortal.roApp.userSurveys()!=null&&typeof VTPortal.roApp.userSurveys()!="undefined"&&VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Surveys?(typeof VTPortal.roApp.userSurveys!="undefined"&&n(VTPortal.roApp.userSurveys().length),n()==0?(VTPortal.roApp.hasSurveys(!1),i18nextko.i18n.t("nosurveys")):(VTPortal.roApp.hasSurveys(!0),i18nextko.i18n.t("newsurveys")+n()+" "+i18nextko.i18n.t("newsurveys2"))):""}),u=ko.computed(function(){return i18nextko.i18n.t("rosurveysTitle")}),f=function(){let t=this,n=function(){t.lblSurveysDesc();VTPortal.roApp.userSurveys()!=null&&VTPortal.roApp.userSurveys().length>0&&VTPortal.roApp.statusView!=null&&VTPortal.roApp.statusView.showMandatoryPopups()},i=function(n){return function(t){t.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.db.settings.updateCacheDS("surveys",t.Surveys),VTPortal.roApp.userSurveys(t.Surveys)):VTPortalUtils.utils.processErrorMessage(t);typeof(n=="function")&&n()}};VTPortal.roApp.userSurveys(VTPortal.roApp.db.settings.getCacheDS("surveys"));VTPortal.roApp.userSurveys()==null||window.VTPortalUtils.needToRefresh("surveys")?new WebServiceRobotics(i(n),function(){}).getEmployeeSurveys():n()};return{viewShown:f,goToSurveys:t,surveysTitle:u,lblSurveysDesc:r,btnGo:{onClick:t,text:i,visible:i},iconSurveys:{onClick:t,icon:"tips"},hasSurveys:ko.computed(function(){return VTPortal.roApp.hasSurveys()==!0?"hasSurveys":"hasSurveysNot"}),hasSurveysTitle:ko.computed(function(){return VTPortal.roApp.hasSurveys()==!0?"mainTitle":"mainTitle"})}};VTPortal.summaryHome=function(){"use strict";var n=ko.computed(function(){return VTPortal.roApp.lastRequestFailed()?"noConnection":"sandClock"}),t=ko.computed(function(){return VTPortal.roApp.db.settings.onlySupervisor}),i=ko.computed(function(){return VTPortal.roApp.lastRequestFailed()?"red":VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().PresenceStatus=="Inside"?"green":"red":"red"}),r=ko.computed(function(){if(VTPortal.roApp.lastRequestFailed())return i18nextko.i18n.t("roWithoutConnection");if(VTPortal.roApp.userStatus()!=null){var n=moment(VTPortal.roApp.userStatus().ServerDate),t=moment(VTPortal.roApp.userStatus().LastPunchDate),i=n.diff(t);return moment.duration(i).humanize()}return""}),u=ko.computed(function(){if(moment(n).format("D MM YYYY, h:mm:ss a"),VTPortal.roApp.lastRequestFailed())return VTPortal.roApp.isOnline(!1),i18nextko.i18n.t("roWithoutConnection");if(VTPortal.roApp.isOnline(!0),VTPortal.roApp.userStatus()!=null){var t=moment(),n=moment(VTPortal.roApp.userStatus().LastPunchDate),u=t.diff(n),i=t.diff(n,"days"),f=VTPortal.roApp.userStatus().LastPunchDirection,r=moment.utc(u).format("HH:mm");return VTPortal.roApp.userStatus().PresenceStatus=="Inside"?i>0?i18nextko.i18n.t("roFromDays")+" ("+moment(n).format("HH:mm")+"h)":r+" "+i18nextko.i18n.t("roInFrom2")+" ("+moment(n).format("HH:mm")+"h)":i>0?i18nextko.i18n.t("roFromDays")+" ("+moment(n).format("HH:mm")+"h)":f!="In"?r+i18nextko.i18n.t("roOutFrom2")+" ("+moment(n).format("HH:mm")+"h)":i18nextko.i18n.t("roOutForgotFrom")+" ("+moment(n).format("HH:mm")+"h)"}return""}),f=ko.computed(function(){if(VTPortal.roApp.userStatus()!=null){var n=moment(VTPortal.roApp.userStatus().ServerDate);return n.format("LT")}return""}),e=ko.computed(function(){if(VTPortal.roApp.userStatus()!=null){var n=moment(VTPortal.roApp.userStatus().ServerDate);return n.format("LL")}return""}),o=ko.computed(function(){return VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().EmployeeName:""}),s=ko.computed(function(){return VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().TaskTitle.length!=0?VTPortal.roApp.userStatus().TaskTitle.length<=50?i18nextko.i18n.t("inTask")+VTPortal.roApp.userStatus().TaskTitle:i18nextko.i18n.t("inTask")+VTPortal.roApp.userStatus().TaskTitle.substr(0,48)+"...":"":""}),h=ko.computed(function(){return VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().TaskDescription!=null&&VTPortal.roApp.userStatus().TaskDescription!=undefined&&VTPortal.roApp.userStatus().TaskDescription.length!=0?VTPortal.roApp.userStatus().TaskDescription.length<=50?VTPortal.roApp.userStatus().TaskDescription:VTPortal.roApp.userStatus().TaskDescription.substr(0,48)+"...":"":""}),c=ko.computed(function(){return i18nextko.i18n.t("statusTitle")}),l=ko.computed(function(){return VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().CostCenterName.length!=0?i18nextko.i18n.t("inCostCenter")+VTPortal.roApp.userStatus().CostCenterName:"":""});return{myTime:r,statusTitle:c,lblEmployeeStatusTime:u,textColor:i,lblUsername:o,lblServerTime:f,lblServerDate:e,lblProductivTask:s,lblProductivTaskDesc:h,lblCostCenter:l,statusIcon:n,isSupervisor:t}};VTPortal.punchesHome=function(){function t(){window.VTPortalUtils.utils.setActiveTab("punches");VTPortal.app.navigate("punchManagement/1/"+moment().format("YYYY-MM-DD"),{root:!0})}var n=ko.observable(null),i=ko.observable(new Date),r=ko.computed(function(){return VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().TaskTitle.length<=50?i18nextko.i18n.t("inTask")+VTPortal.roApp.userStatus().TaskTitle:i18nextko.i18n.t("inTask")+VTPortal.roApp.userStatus().TaskTitle.substr(0,48)+"...":""}),u=ko.computed(function(){return i18nextko.i18n.t("punchesTitle")}),f=ko.computed(function(){return i18nextko.i18n.t("noPunches")}),e=function(){n(VTPortal.roApp.db.settings.getCacheDS("punches"));VTPortal.roApp.punchesDS(VTPortal.roApp.db.settings.getCacheDS("punches"));(n()==null||window.VTPortalUtils.needToRefresh("punches"))&&o()},o=function(){new WebServiceRobotics(function(t){var i,r;if(t.Status==window.VTPortalUtils.constants.OK.value){for(VTPortal.roApp.punchInProgress(!1),i=t.Punches,r=0;r<i.length;r++){switch(i[r].Type){case 1:case 2:case 3:case 7:i[r].TypeData!=null&&i[r].TypeData>0?i[r].ActualType==1?typeof i[r].InTelecommute!="undefined"&&i[r].InTelecommute.toLowerCase()=="true"?(i[r].cssClass="dx-icon-TATC_in",i[r].Name=i18nextko.i18n.t("roEntry")+": "+moment.tz(i[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")):(i[r].cssClass="dx-icon-TA_in_cause",i[r].Name=i18nextko.i18n.t("roPunches_TA_in_causeHome")+": "+moment.tz(i[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")):(i[r].cssClass="dx-icon-TA_out_cause",i[r].Name=i18nextko.i18n.t("roPunches_TA_out_causeHome")+": "+moment.tz(i[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")):i[r].ActualType==1?typeof i[r].InTelecommute!="undefined"&&i[r].InTelecommute.toLowerCase()=="true"?(i[r].cssClass="dx-icon-TATC_in",i[r].Name=i18nextko.i18n.t("roEntry")+": "+moment.tz(i[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")):(i[r].cssClass="dx-icon-TA_in",i[r].Name=i18nextko.i18n.t("roEntry")+": "+moment.tz(i[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")):(i[r].cssClass="dx-icon-TA_out",i[r].Name=i18nextko.i18n.t("roExit")+": "+moment.tz(i[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm"));i[r].hasAction=!0;break;case 4:i[r].cssClass="dx-icon-Task_change";i[r].hasAction=!1;i[r].Name=i18nextko.i18n.t("roPunches_Task_changeHome")+": "+moment.tz(i[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm");break;case 13:i[r].cssClass="dx-icon-CostCenter";i[r].hasAction=!1;i[r].Name=i18nextko.i18n.t("roPunches_CostCenter")+": "+moment.tz(i[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")}i[r].Value=i[r].RequestedTypeData!=""?i18nextko.i18n.t("roRequestPendingApprove")+i[r].RequestedTypeData:i[r].RelatedInfo}n(i);VTPortal.roApp.punchesDS(i);VTPortal.roApp.db.settings.updateCacheDS("punches",t.Punches)}else n([]),VTPortal.roApp.punchesDS([])}).getMyPunches(i.Value)};return{goToPunches:t,viewShown:e,punchesTitle:u,lblpunchesDesc:r,punchesDS:n,noPunches:f,listOptions:{dataSource:n,scrollingEnabled:!1,grouped:!1,onItemClick:function(){t()}},btnGoPunches:{onClick:t,icon:"spinright"},removeButton:{icon:"clock",onClick:t}}};VTPortal.emptyHome=function(){function n(){}return{viewShown:n}};VTPortal.notificationsHome=function(){function t(){window.VTPortalUtils.utils.setActiveTab("alerts");VTPortal.app.navigate("alerts")}function u(){}var n=ko.observable(0),i=ko.computed(function(){return n(0),VTPortal.roApp.impersonatedIDEmployee==-1?VTPortal.roApp.db.settings.onlySupervisor?n(VTPortalUtils.utils.badgeCount(!0,!1,!1)):(n(VTPortalUtils.utils.badgeCount(!1)),VTPortal.roApp.db.settings.supervisorPortalEnabled&&VTPortal.roApp.impersonatedIDEmployee==-1&&n(VTPortalUtils.utils.badgeCount(!1))):n(VTPortalUtils.utils.badgeCount(!1)),VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"?n()==0?(VTPortal.roApp.hasNotifications(!1),i18nextko.i18n.t("noNotifications")):(VTPortal.roApp.hasNotifications(!0),i18nextko.i18n.t("newNotifications")+n()+i18nextko.i18n.t("newNotifications2")):""}),r=ko.computed(function(){return i18nextko.i18n.t("notificationsTitle")});return{goTo:t,notificationsTitle:r,viewShown:u,lblnotificationsDesc:i,btnGo:{onClick:t,text:n,visible:VTPortal.roApp.hasNotifications},iconNotifications:{onClick:t,icon:"message"},hasNotifications:ko.computed(function(){return"hasNotificationsNot"}),hasNotificationsTitle:ko.computed(function(){return"mainTitle"})}};VTPortal.dailyRecordHome=function(){"use strict";function t(){window.VTPortalUtils.utils.setActiveTab("dailyRecord");VTPortal.app.navigate("myDailyRecord",{root:!0})}function s(){n(VTPortal.roApp.db.settings.getCacheDS("dailyrecord"));(n()==null||window.VTPortalUtils.needToRefresh("dailyrecord"))&&o()}var i=ko.observable(moment().startOf("month").toDate()),n=ko.observable(null),r=ko.computed(function(){return VTPortal.roApp.lastRequestFailed()?"noConnection":"sandClock"}),u=ko.computed(function(){var r=0,i=0,t;return n()!=null&&(r=n().filter(n=>n.DateStatus==3||n.DateStatus==2).length,i=n().filter(n=>n.DateStatus==1).length),t=i18nextko.i18n.t("roDailyRecordRecorded"),t=t.replace("{{registered}}",i+r+""),t.replace("{{ongoing}}",i)}),f=ko.computed(function(){var t=0,i;return n()!=null&&(t=n().filter(n=>n.DateStatus==0).length),i=i18nextko.i18n.t("roDailyRecordMissing"),i.replace("{{pending}}",t)}),e=ko.computed(function(){return i18nextko.i18n.t("roDailyRecord")}),o=function(){new WebServiceRobotics(function(t){if(t.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.db.settings.updateCacheDS("dailyrecord",t.Value.DayData),n(t.Value.DayData);else{n([]);var i=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(t,i)}},function(){}).getMyDailyRecordCalendar(i())};return{viewShown:s,statusTitle:e,lblDailyRecordMissing:f,lblDailyRecordPending:u,statusIcon:r,goToDR:t,btnGoDR:{onClick:t,icon:"spinright"},iconDR:{onClick:t,icon:"event"}}};VTPortal.communiquesHome=function(){function i(){window.VTPortalUtils.utils.setActiveTab("communiques");VTPortal.app.navigate("communiques",{root:!0})}var n=ko.observable(0),t=ko.observable(0),r=ko.computed(function(){return n()+t()}),u=ko.computed(function(){n(0);let t=!1;if(VTPortal.roApp.userCommuniques()!=null&&VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Communiques){for(const i of VTPortal.roApp.userCommuniques())i.EmployeeCommuniqueStatus[0].Read||i.Communique.Archived||i.Communique.AllowedResponses.length!=0?!i.EmployeeCommuniqueStatus[0].Answered&&i.Communique.AllowedResponses.length>0&&!i.Communique.Archived&&(t=!0):n(n()+1);return n()==0?(VTPortal.roApp.hasCommuniques(!1),t?"":i18nextko.i18n.t("nocommuniques")):(VTPortal.roApp.hasCommuniques(!0),i18nextko.i18n.t("newcommuniques")+n()+" "+i18nextko.i18n.t("newcommuniques2"))}return""}),f=ko.computed(function(){if(t(0),VTPortal.roApp.userCommuniques()!=null&&VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Communiques){for(const n of VTPortal.roApp.userCommuniques())!n.EmployeeCommuniqueStatus[0].Answered&&n.Communique.AllowedResponses.length>0&&!n.Communique.Archived&&t(t()+1);return t()==0?(VTPortal.roApp.hasInquiries(!1),""):(VTPortal.roApp.hasInquiries(!0),i18nextko.i18n.t("newcommuniques")+t()+" "+i18nextko.i18n.t("newInquiries2"))}return""}),e=ko.computed(function(){return i18nextko.i18n.t("rocommuniquesTitle")}),o=function(){let n=this,t=function(){n.lblCommuniquesDesc();n.lblCommuniquesDescInquiries();VTPortal.roApp.userCommuniques()!=null&&VTPortal.roApp.userCommuniques().length>0&&VTPortal.roApp.statusView!=null&&VTPortal.roApp.statusView.showMandatoryPopups()},i=function(n){return function(t){t.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.db.settings.updateCacheDS("communiques",t.Communiques),VTPortal.roApp.userCommuniques(t.Communiques)):VTPortalUtils.utils.processErrorMessage(t);typeof(n=="function")&&n()}};VTPortal.roApp.userCommuniques(VTPortal.roApp.db.settings.getCacheDS("communiques"));VTPortal.roApp.userCommuniques()==null||window.VTPortalUtils.needToRefresh("communiques")?new WebServiceRobotics(i(t),function(){}).getEmployeeCommuniques():t()};return{viewShown:o,goToCommuniques:i,communiquesTitle:e,lblCommuniquesDesc:u,lblCommuniquesDescInquiries:f,btnGo:{onClick:i,text:r,visible:r},iconCommuniques:{onClick:i,icon:"comment"},hasCommuniques:ko.computed(function(){return VTPortal.roApp.hasCommuniques()==!0?"hasCommuniques":"hasCommuniquesNot"}),hasCommuniquesTitle:ko.computed(function(){return VTPortal.roApp.hasCommuniques()==!0?"mainTitle":"mainTitle"})}};VTPortal.channelsHome=function(){function i(){window.VTPortalUtils.utils.setActiveTab("channels");VTPortal.app.navigate("myChannels",{root:!0})}function r(){VTPortal.roApp.loggedIn&&new WebServiceRobotics(function(t){var i,r;if(t.Status==window.VTPortalUtils.constants.OK.value){for(i=t.Value,r=0;r<i.length;r++)i[r].hasAction=!0,i[r].MessagesInfo=i[r].NewMessages==0?i18nextko.i18n.t("nomessages"):i18nextko.i18n.t("newmessages")+i[r].NewMessages+" "+i18nextko.i18n.t("newmessages2"),i[r].cssClass=i[r].IsComplaintChannel?"dx-channelComplaint":"dx-channelCommunications";VTPortal.roApp.db.settings.updateCacheDS("channels",i);n(i)}else n([]),VTPortalUtils.utils.processErrorMessage(t,function(){})},function(){n([]);VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingChannels"),"error",0,function(){})}).getMyChannels()}var t=ko.observable(0),n=ko.observable([]),u=ko.computed(function(){if(t(0),n()!=null&&n().length>0)for(var i=0;i<n().length;++i)t(t()+n()[i].NewMessages);return t()==0?(VTPortal.roApp.hasMessages(!1),i18nextko.i18n.t("nomessages")):(VTPortal.roApp.hasMessages(!0),i18nextko.i18n.t("newmessages")+t()+" "+i18nextko.i18n.t("newmessages2"))}),f=ko.computed(function(){return i18nextko.i18n.t("rochannelsTitle")}),e=function(){n(VTPortal.roApp.db.settings.getCacheDS("channels"));(n()==null||window.VTPortalUtils.needToRefresh("channels"))&&r()};return{viewShown:e,refreshChannels:r,goToChannels:i,channelsTitle:f,lblChannelsDesc:u,btnGo:{onClick:i,text:t,visible:t},iconChannels:{onClick:i,icon:"channels"},hasMessages:ko.computed(function(){return VTPortal.roApp.hasMessages()==!0?"hasMessages":"hasMessagesNot"}),hasMessagesTitle:ko.computed(function(){return VTPortal.roApp.hasMessages()==!0?"mainTitle":"mainTitle"})}};VTPortal.accrualsHome=function(){function i(){window.VTPortalUtils.utils.setActiveTab("accruals")}var r=ko.observable(moment().add(-1,"days").toDate()),h=ko.observable(!1),t=ko.observable(null),n=ko.observable(null),f=ko.computed(function(){return VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&(VTPortal.roApp.empPermissions().Schedule.ScheduleAccruals||VTPortal.roApp.empPermissions().Schedule.ProductivAccruals)?!0:!1}),e=function(){if(r(moment().add(-1,"days").toDate()),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Holidays)(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&(VTPortal.roApp.empPermissions().Schedule.ScheduleAccruals||VTPortal.roApp.empPermissions().Schedule.ProductivAccruals||VTPortal.roApp.empPermissions().Schedule.QuerySchedule))&&new WebServiceRobotics(function(i){var r,f,u,e;if(i.Status==window.VTPortalUtils.constants.OK.value){if(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Schedule.ScheduleAccruals){for(r=[],f=i.ScheduleSummary,f.WeekAccruals.length>0&&(r=r.concat(f.WeekAccruals)),f.MonthAccruals.length>0&&(r=r.concat(f.MonthAccruals)),f.YearAccruals.length>0&&(r=r.concat(f.YearAccruals)),f.ContractAccruals.length>0&&(r=r.concat(f.ContractAccruals)),f.YearWorkAccruals&&f.YearWorkAccruals.length>0&&(r=r.concat(f.YearWorkAccruals)),u=0;u<r.length;u++)r[u].Name=r[u].Name+": "+r[u].TotalFormat+" "+(r[u].YearWorkPeriod||"");r=r.sortBy(function(n){return n.Name});t(r);VTPortal.roApp.scheduleDS(r)}if(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Schedule.QuerySchedule){if(r=[],f=i.HolidaysSummary,f.HolidaysInfo.length>0)for(r=r.concat(f.HolidaysInfo),u=0;u<r.length;u++)r[u].IDShift==-1?(r[u].Pending=i18nextko.i18n.t("roHolidayResume_Pending")+": "+(r[u].ValueFormat==="H"?VTPortalUtils.utils.hoursToDuration(r[u].Pending):r[u].Pending),r[u].Lasting=i18nextko.i18n.t("roHolidayResume_Lasting")+": "+(r[u].ValueFormat==="H"?VTPortalUtils.utils.hoursToDuration(r[u].Lasting):r[u].Lasting),r[u].Available=i18nextko.i18n.t("roHolidayResume_Available")+": "+(r[u].ValueFormat==="H"?VTPortalUtils.utils.hoursToDuration(r[u].Available):r[u].Available),r[u].Prevision=i18nextko.i18n.t("roHolidayResume_Prevision")+": "+(r[u].ValueFormat==="H"?VTPortalUtils.utils.hoursToDuration(r[u].Prevision):r[u].Prevision),r[u].Done=r[u].Done>0?i18nextko.i18n.t("roHolidayResume_Done")+": "+(r[u].ValueFormat==="H"?VTPortalUtils.utils.hoursToDuration(r[u].Done):r[u].Done):""):(r[u].Pending=i18nextko.i18n.t("roHolidayResume_Pending")+": "+r[u].Pending,r[u].Lasting=i18nextko.i18n.t("roHolidayResume_Lasting")+": "+r[u].Lasting,r[u].Available=i18nextko.i18n.t("roHolidayResume_Available")+": "+r[u].Available,r[u].Prevision=i18nextko.i18n.t("roHolidayResume_Prevision")+": "+r[u].Prevision,r[u].Done=i18nextko.i18n.t("roHolidayResume_Done")+": "+r[u].Done);r.length>0?(n(f.HolidaysInfo),VTPortal.roApp.holidaysDS(f.HolidaysInfo)):(n([]),VTPortal.roApp.holidaysDS([]))}VTPortal.roApp.impersonatedIDEmployee==-1&&VTPortal.roApp.db.settings.updateCacheDS("accruals",{idemployee:VTPortal.roApp.userId,schedule:t(),holidays:n()})}else t([]),n([]),e=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(i,e)}).getAccrualsSummary(r());else{var i=function(){};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roIncorrectApiVersion"),"error",0,i)}},o=function(){let i=VTPortal.roApp.db.settings.getCacheDS("accruals");i!=null&&i.idemployee==VTPortal.roApp.userId?(t(i.schedule),n(i.holidays)):(t(null),n(null));(window.VTPortalUtils.needToRefresh("accruals")||t()==null||n()==null||VTPortal.roApp.impersonatedIDEmployee!=-1)&&e()},u=ko.computed(function(){return i18nextko.i18n.t("accrualsTitle")}),s=ko.computed(function(){return i18nextko.i18n.t("noAccrualsDesc")});return{goToAccruals:i,viewShown:o,scheduleDS:t,hasPermission:f,holidaysDS:n,accrualsTitle:u,lblaccrualsDesc:u,accrualsTitleList:i18nextko.i18n.t("accrualsTitleList"),holidaysTitleList:i18nextko.i18n.t("holidaysTitleList"),listSchedule:{dataSource:t,activeStateEnabled:!1,scrollingEnabled:!1},listHolidays:{dataSource:n,activeStateEnabled:!1,scrollingEnabled:!1},lblnoAccrualsDesc:s,btnGoAccruals:{onClick:i,icon:"spinright"},iconAccruals:{onClick:i,icon:"columnchooser"}}};VTPortal.myDailyRecord=function(n){function s(n){var i="",r="#FFFFFF;text-shadow: 2px 2px 2px black;",u=t().find(t=>moment.tz(t.Date,VTPortal.roApp.serverTimeZone).add(12,"hours").format("YYYYMMDD")==moment(n.date).format("YYYYMMDD"));if(moment(n.date).format("YYYYMMDD")==moment().format("YYYYMMDD")&&(i="actualDate"),style="height:100%;border-radius: 10%;",u!=null)switch(u.DateStatus){case 0:style+="background: #D9534F";break;case 1:style+="background: #F0AD4E;";break;case 3:style+="background:#62BA62;";break;case 5:style+="background: transparent;";r="#000000;font-weight: bold;";break;default:style+="background:#e3e3e3;"}return"<div style='width:100%'><div class='CalendarCellDailyLayout'><div style='height:100%' class='innerCalCellTemplate'><div style='"+style+"'> <span class='CalendarCellDailyLayoutText "+i+"' id='"+moment(n.date).format("YYYYMMDD")+"' style='color: "+r+"'>"+n.text+"<\/span><\/div><\/div><\/div>"}function h(n){n.fullName=="currentDate"&&moment(n.value).month()!=moment(n.previousValue).month()&&(r(moment(n.value).startOf("month").toDate()),u())}function c(n){var r=moment(n.value),i=t().find(n=>moment.tz(n.Date,VTPortal.roApp.serverTimeZone).add(12,"hours").format("YYYYMMDD")==moment(r).format("YYYYMMDD")),u;typeof(i!="undefined")&&i!=null&&i.DateStatus!=5?moment().startOf("day").isBefore(r)?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDailyRecordFuture"),"error",3e3):(u=i.IdRecord,u<0||i.DateStatus==0?VTPortal.app.navigate("addDailyRecord/"+u+"/"+r.format("YYYY-MM-DD")+"/"+i.CanTelecommute+"/"+i.HasPunchesPattern):VTPortal.app.navigate("dailyRecordDetail/"+u+"/"+r.format("YYYY-MM-DD")+"/"+i.CanTelecommute+"/FC")):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDailyRecordNotAllowed"),"error",3e3)}function u(){VTPortal.roApp.db.settings.markForRefresh(["dailyrecord"]);i().viewShown();new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)t(n.Value.DayData),setTimeout(function(){$("#calendarContainer").dxCalendar("instance").repaint();$("#calendarContainer").height($("#scrollview").height())},100);else{t([]);var i=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,i)}},function(){}).getMyDailyRecordCalendar(r())}var i=ko.observable(VTPortal.bigUserInfo()),t=ko.observable([]),r=ko.observable(moment().startOf("month").toDate());typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&requestId(parseInt(n.id,10));var f=ko.computed(function(){var r=t().filter(n=>n.DateStatus==3||n.DateStatus==2).length,i=t().filter(n=>n.DateStatus==1).length,n=i18nextko.i18n.t("roDailyRecordRecorded");return n=n.replace("{{registered}}",i+r+""),n.replace("{{ongoing}}",i)}),e=ko.computed(function(){var n=t().filter(n=>n.DateStatus==0).length,i=i18nextko.i18n.t("roDailyRecordMissing");return i.replace("{{pending}}",n)}),o=ko.computed(function(){return i18nextko.i18n.t("roDailyRecordResume")});return{viewShown:u,title:i18nextko.i18n.t("roMyDailyRecord"),subscribeBlock:i(),lblDailyRecordMissing:e,lblDailyRecordPending:f,lblDailyRecordResume:o,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),scrollContent:{},calendarOptions:{width:"104%",height:465,useCellTemplate:!0,cellTemplate:s,firstDayOfWeek:moment()._locale._week.dow,zoomLevel:"month",maxZoomLevel:"month",minZoomLevel:"month",showTodayButton:!1,onCellClick:c,onOptionChanged:h}}};VTPortal.addDailyRecord=function(params){function diffInBlock(i){var eDateBegin=eval("eDate"+i),iDateEnd=eval("iDate"+i),difInBlock=0;return eDateBegin()!=null&&iDateEnd()!=null&&(difInBlock=eDateBegin()>=iDateEnd()?moment.duration(moment(eDateBegin(),"HH:mm").diff(moment(iDateEnd(),"HH:mm"))).asMinutes():moment.duration(moment(eDateBegin(),"HH:mm").add(1,"days").diff(moment(iDateEnd(),"HH:mm"))).asMinutes()),Math.floor(difInBlock)}function convertMinsToHrsMins(n){var t=Math.floor(n/60),i=n%60;return t=t<10?"0"+t:t,i=i<10?"0"+i:i,t+":"+i}function saveRequest(){var wsRobotics=null,continuar=!0,blockSwitch,newPunches,newPunchBegin,newPunchEnd;if(validateBlocks(),continuar=blocksAreValid()?!0:!1,continuar){blockSwitch=0;blockSwitch=block1HasNightTime()?1:block2HasNightTime()?2:block3HasNightTime()?3:block4HasNightTime()?4:block5HasNightTime()?5:0;newPunches=Punches();for(let i=1;i<=blocksShown();i++)newPunchBegin={},newPunchEnd={},newPunchBegin.isNew=!0,newPunchBegin.IDEmployee=VTPortal.roApp.employeeId,newPunchBegin.Direction="E",newPunchBegin.Type=1,eval("zoneSelected"+i+"()")!=null&&(newPunchBegin.IDZone=eval("zoneSelected"+i+"()").Id),eval("tcTypeSelected"+i+"()")!=null&&(newPunchBegin.InTelecommute=eval("tcTypeSelected"+i+"()").FieldValue=="1"?!0:!1),newPunchEnd.isNew=!0,newPunchEnd.IDEmployee=VTPortal.roApp.employeeId,newPunchEnd.Direction="S",newPunchEnd.Type=2,eval("zoneSelected"+i+"()")!=null&&(newPunchBegin.IDZone=eval("zoneSelected"+i+"()").Id),blockSwitch==0?(newPunchBegin.DateTime=moment(params.param+" "+moment(eval("iDate"+i+"()")).format("HH:mm")).format("YYYY-MM-DD HH:mm:ss"),newPunchBegin.ShiftDate=moment(params.param,"YYYY-MM-DD").format(VTPortal.roApp.localFormat),newPunchEnd.DateTime=moment(params.param+" "+moment(eval("eDate"+i+"()")).format("HH:mm")).format("YYYY-MM-DD HH:mm:ss"),newPunchEnd.ShiftDate=moment(params.param,"YYYY-MM-DD").format(VTPortal.roApp.localFormat)):blockSwitch==i?moment(eval("iDate"+i+"()")).format("HH:mm")<=moment(eval("eDate"+i+"()")).format("HH:mm")?(newPunchBegin.DateTime=moment(params.param+" "+moment(eval("iDate"+i+"()")).format("HH:mm")).add(1,"days").format("YYYY-MM-DD HH:mm:ss"),newPunchBegin.ShiftDate=moment(params.param,"YYYY-MM-DD").format(VTPortal.roApp.localFormat),newPunchEnd.DateTime=moment(params.param+" "+moment(eval("eDate"+i+"()")).format("HH:mm")).add(1,"days").format("YYYY-MM-DD HH:mm:ss"),newPunchEnd.ShiftDate=moment(params.param,"YYYY-MM-DD").add(1,"days").format(VTPortal.roApp.localFormat)):(newPunchBegin.DateTime=moment(params.param+" "+moment(eval("iDate"+i+"()")).format("HH:mm")).format("YYYY-MM-DD HH:mm:ss"),newPunchBegin.ShiftDate=moment(params.param,"YYYY-MM-DD").format(VTPortal.roApp.localFormat),newPunchEnd.DateTime=moment(params.param+" "+moment(eval("eDate"+i+"()")).format("HH:mm")).add(1,"days").format("YYYY-MM-DD HH:mm:ss"),newPunchEnd.ShiftDate=moment(params.param,"YYYY-MM-DD").add(1,"days").format(VTPortal.roApp.localFormat)):blockSwitch<i?(newPunchBegin.DateTime=moment(params.param+" "+moment(eval("iDate"+i+"()")).format("HH:mm")).add(1,"days").format("YYYY-MM-DD HH:mm:ss"),newPunchBegin.ShiftDate=moment(params.param,"YYYY-MM-DD").add(1,"days").format(VTPortal.roApp.localFormat),newPunchEnd.DateTime=moment(params.param+" "+moment(eval("eDate"+i+"()")).format("HH:mm")).add(1,"days").format("YYYY-MM-DD HH:mm:ss"),newPunchEnd.ShiftDate=moment(params.param,"YYYY-MM-DD").add(1,"days").format(VTPortal.roApp.localFormat)):(newPunchBegin.DateTime=moment(params.param+" "+moment(eval("iDate"+i+"()")).format("HH:mm")).format("YYYY-MM-DD HH:mm:ss"),newPunchBegin.ShiftDate=moment(params.param,"YYYY-MM-DD").format(VTPortal.roApp.localFormat),newPunchEnd.DateTime=moment(params.param+" "+moment(eval("eDate"+i+"()")).format("HH:mm")).format("YYYY-MM-DD HH:mm:ss"),newPunchEnd.ShiftDate=moment(params.param,"YYYY-MM-DD").format(VTPortal.roApp.localFormat)),moment(newPunchBegin.DateTime).isValid()&&moment(newPunchEnd.DateTime).isValid()&&(newPunches.push(newPunchBegin),newPunches.push(newPunchEnd));punchesDS(newPunches);var DailyRecord={IdEmployee:VTPortal.roApp.employeeId,DailyRecordStatus:0,Punches:punchesDS(),RecordDate:moment(params.param,"YYYY-MM-DD").format(VTPortal.roApp.localFormat)},dailyRecordJSON=JSON.stringify(DailyRecord),onWSError=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},onWSResult=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.db.settings.markForRefresh(["status","dailyrecord","notifications"]),punchesDS([]),Punches([]),VTPortal.app.navigate("myDailyRecord",{root:!0}),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{punchesDS([]);Punches([]);var t=function(){VTPortal.app.navigate("myDailyRecord",{root:!0})};VTPortalUtils.utils.processRequestErrorMessage(n,t,function(){})}};wsRobotics==null&&(wsRobotics=new WebServiceRobotics(onWSResult,onWSError));wsRobotics.SaveRequestDailyRecord(dailyRecordJSON)}else VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("invalidPeriods"),"warning",2e3)}function viewShown(){globalStatus().viewShown();loadLists();tcTypesDS([{FieldName:i18nextko.i18n.t("roOffice"),FieldValue:"0"},{FieldName:i18nextko.i18n.t("roHome"),FieldValue:"1"}]);tcInfo(params.iDate=="true"?!0:!1);requestValue2DS(new DevExpress.data.DataSource({store:[]}))}var globalStatus=ko.observable(VTPortal.bigUserInfo()),selectedDate=ko.observable(new Date),punchesDS=ko.observable([]),punchesPatternDS=ko.observable([]),Punches=ko.observable([]),blocksShown=ko.observable(1),forecastsDS=ko.observable([{key:"forecasts",items:[]}]),scheduleDS=ko.observable([{key:"forecasts",items:[]}]),dayInfo=ko.observable(null),tcInfo=ko.observable(null),requestValue2DS=ko.observable([]),reqValue1=ko.observable("E"),tcTypeValue1=ko.observable(null),reqValue2=ko.observable(null),zoneValue1=ko.observable(null),tcTypeValue2=ko.observable(null),zoneValue2=ko.observable(null),tcTypeValue3=ko.observable(null),zoneValue3=ko.observable(null),tcTypeValue4=ko.observable(null),zoneValue4=ko.observable(null),tcTypeValue5=ko.observable(null),zoneValue5=ko.observable(null),tcTypesDS=ko.observable([]),shiftLayersDS=ko.observable([]),zoneSelected1=ko.observable(null),tcTypeSelected1=ko.observable(null),zoneSelected2=ko.observable(null),tcTypeSelected2=ko.observable(null),zoneSelected3=ko.observable(null),tcTypeSelected3=ko.observable(null),zoneSelected4=ko.observable(null),tcTypeSelected4=ko.observable(null),zoneSelected5=ko.observable(null),tcTypeSelected5=ko.observable(null),block1Shown=ko.observable(!1),block2Shown=ko.observable(!1),block3Shown=ko.observable(!1),block4Shown=ko.observable(!1),block5Shown=ko.observable(!1),hasPunchesPattern=ko.observable(!1),delete2Shown=ko.computed(function(){return!block3Shown()}),delete3Shown=ko.computed(function(){return!block4Shown()}),delete4Shown=ko.computed(function(){return!block5Shown()}),blocksAreValid=ko.observable(!1),iDate1=ko.observable(null),iDate2=ko.observable(null),iDate3=ko.observable(null),iDate4=ko.observable(null),iDate5=ko.observable(null),eDate1=ko.observable(null),eDate2=ko.observable(null),eDate3=ko.observable(null),eDate4=ko.observable(null),eDate5=ko.observable(null),blocksShown=ko.computed(function(){var n=1;return block2Shown()&&(n+=1),block3Shown()&&(n+=1),block4Shown()&&(n+=1),block5Shown()&&(n+=1),n}),validateBlocks=function(){block1Invalid()||block2Invalid()||block3Invalid()||block4Invalid()||block5Invalid()?blocksAreValid(!1):blocksAreValid(!0)},lblRemaining=ko.computed(function(){var n=diffInBlock(1)+diffInBlock(2)+diffInBlock(3)+diffInBlock(4)+diffInBlock(5);return i18nextko.i18n.t("roDeclaringDR")+" "+convertMinsToHrsMins(n)+" "+i18nextko.i18n.t("roDeclaringDR2")}),block1HasNightTime=ko.computed(function(){return moment(eDate1(),"HH:mm").format("HH:mm")<moment(iDate1(),"HH:mm").format("HH:mm")?!0:!1}),block2HasNightTime=ko.computed(function(){return block2Shown()?moment(eDate2(),"HH:mm").format("HH:mm")<moment(iDate2(),"HH:mm").format("HH:mm")||moment(iDate2(),"HH:mm").format("HH:mm")<moment(eDate1(),"HH:mm").format("HH:mm")?!0:!1:!1}),block3HasNightTime=ko.computed(function(){return block3Shown()?moment(eDate3(),"HH:mm").format("HH:mm")<moment(iDate3(),"HH:mm").format("HH:mm")||moment(iDate3(),"HH:mm").format("HH:mm")<moment(eDate2(),"HH:mm").format("HH:mm")?!0:!1:!1}),block4HasNightTime=ko.computed(function(){return block4Shown()?moment(eDate4(),"HH:mm").format("HH:mm")<moment(iDate4(),"HH:mm").format("HH:mm")||moment(iDate4(),"HH:mm").format("HH:mm")<moment(eDate3(),"HH:mm").format("HH:mm")?!0:!1:!1}),block5HasNightTime=ko.computed(function(){return block5Shown()?moment(eDate5(),"HH:mm").format("HH:mm")<moment(iDate5(),"HH:mm").format("HH:mm")||moment(iDate5(),"HH:mm").format("HH:mm")<moment(eDate4(),"HH:mm").format("HH:mm")?!0:!1:!1}),block1Invalid=ko.computed(function(){return moment(iDate1(),"HH:mm").isValid()&&moment(eDate1(),"HH:mm").isValid()?moment(eDate1(),"HH:mm").format("HH:mm")!=moment(iDate1(),"HH:mm").format("HH:mm")?!1:!1:!1}),block2Invalid=ko.computed(function(){return block2Shown()&&moment(iDate2(),"HH:mm").isValid()&&moment(eDate2(),"HH:mm").isValid()?moment(eDate2(),"HH:mm").format("HH:mm")!=moment(iDate2(),"HH:mm").format("HH:mm")?block2HasNightTime()?!1:moment(eDate1(),"HH:mm").format("HH:mm")<moment(iDate2(),"HH:mm").format("HH:mm")?!1:!0:!1:!1}),block3Invalid=ko.computed(function(){return block3Shown()&&moment(iDate3(),"HH:mm").isValid()&&moment(eDate3(),"HH:mm").isValid()?moment(eDate3(),"HH:mm").format("HH:mm")!=moment(iDate3(),"HH:mm").format("HH:mm")?block3HasNightTime()?!1:moment(eDate2(),"HH:mm").format("HH:mm")<moment(iDate3(),"HH:mm").format("HH:mm")?!1:!0:!1:!1}),block4Invalid=ko.computed(function(){return block4Shown()&&moment(iDate4(),"HH:mm").isValid()&&moment(eDate4(),"HH:mm").isValid()?moment(eDate4(),"HH:mm").format("HH:mm")!=moment(iDate4(),"HH:mm").format("HH:mm")?block4HasNightTime()?!1:moment(eDate3(),"HH:mm").format("HH:mm")<moment(iDate4(),"HH:mm").format("HH:mm")?!1:!0:!1:!1}),block5Invalid=ko.computed(function(){return block5Shown()&&moment(iDate5(),"HH:mm").isValid()&&moment(eDate5(),"HH:mm").isValid()?moment(eDate5(),"HH:mm").format("HH:mm")!=moment(iDate5(),"HH:mm").format("HH:mm")?block5HasNightTime()?!1:moment(eDate4(),"HH:mm").format("HH:mm")<moment(iDate5(),"HH:mm").format("HH:mm")?!1:!0:!1:!1}),thereIsNighttime=ko.computed(function(){return block1HasNightTime()||block2HasNightTime()||block3HasNightTime()||block4HasNightTime()||block5HasNightTime()?!0:!1}),noPunches=ko.computed(function(){return i18nextko.i18n.t("noPunches")}),requestId=ko.observable(null),popupDayInfoVisible=ko.observable(!1),popupNewPunchVisible=ko.observable(!1),saveVisible=ko.computed(function(){return moment(iDate1(),"HH:mm").isValid()&&moment(eDate1(),"HH:mm").isValid()?!0:!1}),refreshData=function(){var n,t;VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.CauseNote?(n=function(n){var t,i,r,u;if(n.Status==window.VTPortalUtils.constants.OK.value){for(n.DayInfo!=null&&n.DayInfo.DayData.length>0&&dayInfo(n.DayInfo.DayData[0]),t=n.Forecasts,i=0;i<t.length;i++){switch(t[i].ForecastType){case"days":t[i].cssClass="dx-icon-plannedAbsences";break;case"hours":t[i].cssClass="dx-icon-plannedCauses";break;case"holidayhours":t[i].cssClass="dx-icon-plannedHoliday";break;case"overtime":t[i].cssClass="dx-icon-plannedOvertime"}t[i].Description=typeof t[i].ForecastDetail!="undefined"&&t[i].ForecastDetail!=""&&t[i].ForecastDetail!=null?i18nextko.i18n.t("roLeavesFrom")+" "+moment(t[i].BeginDate).format("L")+" "+i18nextko.i18n.t("roLeavesCause")+" "+t[i].Cause+" ("+t[i].ForecastDetail+")":i18nextko.i18n.t("roLeavesFrom")+" "+moment(t[i].BeginDate).format("L")+" "+i18nextko.i18n.t("roLeavesCause")+" "+t[i].Cause}r=[{key:"forecasts",items:t}];forecastsDS(r);refreshShiftLayers(n)}else dayInfo(null),forecastsDS([{key:"forecasts",items:[]}]),u=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,u)},new WebServiceRobotics(function(t){n(t)}).getEmployeeDayInfo(selectedDate(),-1)):(t=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roIncorrectApiVersion"),"error",0,t))},refreshShiftLayers=function(n){var h=[],l=moment(),e=l.clone().startOf("day"),r,u,o,f,s,t;if(typeof n.DayInfo!="undefined"&&n.DayInfo!=null&&n.DayInfo.DayData.length>0&&n.DayInfo.DayData[0].MainShift!=null){if(r=n.DayInfo.DayData[0].MainShift,r.ShiftLayers==0)u=moment.tz(r.StartHour,VTPortal.roApp.serverTimeZone),o=moment.tz(r.EndHour,VTPortal.roApp.serverTimeZone),e=moment(u).endOf("day"),t=moment(u).diff(e,"minutes")-1,f=moment(o)>=moment(u)?moment(o).diff(moment(u),"minutes"):moment(o).add(1,"day").diff(moment(u),"minutes"),h.push({Name:"",Gauge:{scale:{startValue:t,endValue:t+f,tickInterval:60,label:{indentFromTick:-3,"true":!1,customizeText:VTPortalUtils.utils.convertShiftHourToTime(t+f)},tick:{color:"#536878"}},value:0,subvalues:[t,t+f],subvalueIndicator:{type:"textCloud",color:"#0046FE",text:{font:{size:12},customizeText:VTPortalUtils.utils.convertShiftHourToTime(t+f)}},rangeContainer:{offset:10,ranges:[{startValue:t,endValue:t+f,color:"#77DD77"}]}}});else for(s=0;s<r.ShiftLayers;s++){var i=r.ShiftLayersDefinition[s],a=moment.tz(moment(i.LayerStartTime),VTPortal.roApp.serverTimeZone),c=a.format("YYYYMMDDHHmmss");e=moment(c,"YYYYMMDDHHmmss").endOf("day");t=moment(c,"YYYYMMDDHHmmss").diff(e,"minutes")-1;h.push({Name:i18nextko.i18n.t("roLayer")+" "+i.LayerID,Gauge:{scale:{startValue:t,endValue:t+i.LayerDuration,tickInterval:60,label:{indentFromTick:-3,visible:!1,customizeText:VTPortalUtils.utils.convertShiftHourToTime(t+i.LayerDuration)},tick:{color:"#536878"}},value:0,subvalues:[t,t+i.LayerOrdinaryHours,t+i.LayerDuration],subvalueIndicator:{type:"textCloud",color:"#0046FE",text:{font:{size:12},customizeText:VTPortalUtils.utils.convertShiftHourToTime(t+r.PlannedHours)}},rangeContainer:{offset:10,ranges:[{startValue:t,endValue:t+i.LayerOrdinaryHours,color:"#77DD77"},{startValue:t+i.LayerOrdinaryHours,endValue:t+i.LayerDuration,color:"#ff0000"}]}}})}shiftLayersDS([{key:"Franjas",items:h}])}else shiftLayersDS([])},lblDailyRecordDay;typeof params.id!="undefined"&&parseInt(params.id,10)!=-1&&requestId(parseInt(params.id,10));typeof params.objId!="undefined"&&hasPunchesPattern(params.objId);lblDailyRecordDay=ko.computed(function(){return moment(params.param,"YYYY-MM-DD").format("LL")});var plannedHours=ko.computed(function(){return dayInfo()!=null&&dayInfo().MainShift!=null?i18nextko.i18n.t("roPlannedLbl")+": "+convertMinsToHrsMins(dayInfo().MainShift.PlannedHours):""}),setClockValues=function(punchesQuantity){for(var e,iDateTemp,eDateTemp,inicio,final,pairs=punchesQuantity/2,i=0;i<pairs;i++)e=document.getElementById("block"+(i+1)),e.style.display="block",eval("block"+(i+1)+"Shown(true)"),inicio=moment(moment.tz(moment(punchesPatternDS()[i*2].DateTime),VTPortal.roApp.serverTimeZone).format("YYYY-MM-DD HH:mm"),"YYYY-MM-DD HH:mm").toDate(),final=moment(moment.tz(moment(punchesPatternDS()[i*2+1].DateTime),VTPortal.roApp.serverTimeZone).format("YYYY-MM-DD HH:mm"),"YYYY-MM-DD HH:mm").toDate(),eval("iDateTemp=iDate"+(i+1)),eval("eDateTemp=eDate"+(i+1)),iDateTemp(inicio),eDateTemp(final)},shiftName=ko.computed(function(){return dayInfo()!=null&&dayInfo().MainShift!=null?dayInfo().MainShift.Name:""}),loadLists=function(){var t=function(n){n.Status==window.VTPortalUtils.constants.OK.value&&(punchesPatternDS(n.Value.Punches),setClockValues(punchesPatternDS().length))},n;VTPortal.roApp.DailyRecordPatternEnabled()==!0&&hasPunchesPattern()=="true"&&new WebServiceRobotics(function(n){t(n)}).getDailyRecordPattern(params.param);n=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value){var t=n.ListZones;VTPortal.roApp.zonesDS(t);VTPortal.roApp.zonesDataSource(new DevExpress.data.DataSource({store:VTPortal.roApp.zonesDS(),searchOperation:"contains",searchExpr:"Name"}))}};VTPortal.roApp.zonesDS()==null&&new WebServiceRobotics(function(t){n(t)}).getZones()},telecommutingImage=ko.computed(function(){return backgroundImage="url(Images/logovtl.ico) no-repeat center center"}),zoneImage=ko.computed(function(){return backgroundImage="url(Images/logovtl.ico) no-repeat center center"});return{viewShown:viewShown,title:i18nextko.i18n.t("roAddDailyRecord"),subscribeBlock:globalStatus(),lblDailyRecordForDay:i18nextko.i18n.t("roDailyRecord"),lblDailyRecordDay:lblDailyRecordDay,noPunches:noPunches,forecastsDS:forecastsDS,scheduleDS:scheduleDS,lblLoading:i18nextko.i18n.t("lblLoading"),loadingPanel:VTPortalUtils.utils.loadingPanelConf(),punchesDS:punchesDS,lblShift:i18nextko.t("roShiftLbl"),dateBeginText:i18nextko.t("roEntry"),dateEndText:i18nextko.t("roExit"),txtDayShift:{placeholder:i18nextko.t("roShiftLbl"),value:shiftName,readOnly:!0},tcText:i18nextko.t("roTCF"),zText:i18nextko.t("roZoneDR"),tcInfo:tcInfo,reqValue1:reqValue1,txtPlannedHours:{placeholder:i18nextko.t("roPlannedLbl"),value:plannedHours,readOnly:!0},dateBegin:{type:"time",pickerType:VTPortalUtils.utils.dailyRecordDatetimeTypeSelect(),value:iDate1,width:VTPortal.roApp.isModeApp()?75:95,valueChangeEvent:"focusout",displayFormat:"HH:mm",onFocusIn:function(n){VTPortal.roApp.isModeApp()||n.element.find("input").val()!=""||iDate1(moment("1970-01-01 "+moment().format("HH:mm"),"YYYY-MM-DD HH:mm").toDate())}},dateEnd:{type:"time",pickerType:VTPortalUtils.utils.dailyRecordDatetimeTypeSelect(),value:eDate1,width:VTPortal.roApp.isModeApp()?75:95,valueChangeEvent:"focusout",displayFormat:"HH:mm",onFocusIn:function(n){VTPortal.roApp.isModeApp()||n.element.find("input").val()!=""||eDate1(moment(iDate1()).clone().toDate())}},cmbTCType:{dataSource:tcTypesDS,displayExpr:"FieldName",valueExpr:"FieldValue",value:tcTypeValue1,onValueChanged:function(n){tcTypeSelected1(n.component.option("selectedItem"))}},cmbZones:{dataSource:VTPortal.roApp.zonesDataSource,displayExpr:"Name",valueExpr:"Id",value:zoneValue1,onValueChanged:function(n){zoneSelected1(n.component.option("selectedItem"))}},tcImage:telecommutingImage,zImage:zoneImage,listShiftLayer:{dataSource:shiftLayersDS,scrollingEnabled:!1,grouped:!0,collapsibleGroups:!1,itemTemplate:"ScheduleItem",groupTemplate:function(n){return $("<div>"+i18nextko.i18n.t("roResumeAccruals_"+n.key)+"<\/div>")}},listForecasts:{dataSource:forecastsDS,scrollingEnabled:!1,grouped:!0,collapsibleGroups:!1,itemTemplate:"ForecastItem",groupTemplate:function(){return $("<div>"+i18nextko.i18n.t("roDailyForecasts")+"<\/div>")}},listSchedule:{dataSource:scheduleDS,scrollingEnabled:!1,grouped:!0,collapsibleGroups:!1,itemTemplate:"ScheduleItem",groupTemplate:function(n){return $("<div>"+i18nextko.i18n.t("roResumeAccruals_"+n.key)+"<\/div>")}},popupDayInfoVisible:popupDayInfoVisible,lblInitialDate:i18nextko.t("roRequestDateHourLbl"),lblTC:i18nextko.t("roTCF"),detailsVisible:function(){var n=moment(params.param,"YYYY-MM-DD");selectedDate(n.toDate());refreshData();popupDayInfoVisible(!0)},hasSchedulePermission:function(){return VTPortal.roApp.empPermissions().Schedule.QuerySchedule},lblDayInfo:i18nextko.i18n.t("roInformationDay"),noPunches:noPunches,scrollContent:{},tcSwitch:{width:50},scrollPopup:{},addPunch:{icon:"plus",visible:!0,onClick:function(n){var n;block2Shown()?block3Shown()?block4Shown()?block5Shown()||(n=document.getElementById("block5"),n.style.display="block",block5Shown(!0)):(n=document.getElementById("block4"),n.style.display="block",block4Shown(!0)):(n=document.getElementById("block3"),n.style.display="block",block3Shown(!0)):(n=document.getElementById("block2"),n.style.display="block",block2Shown(!0))}},btnSave:{onClick:saveRequest,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:saveVisible},closeBlock2:{onClick:function(n){var n=document.getElementById("block2");n.style.display="none";block2Shown(!1);eDate2(null);iDate2(null)},text:"",icon:"remove",visible:delete2Shown},closeBlock3:{onClick:function(n){var n=document.getElementById("block3");n.style.display="none";block3Shown(!1);eDate3(null);iDate3(null)},text:"",icon:"remove",visible:delete3Shown},closeBlock4:{onClick:function(n){var n=document.getElementById("block4");n.style.display="none";block4Shown(!1);eDate4(null);iDate4(null)},text:"",icon:"remove",visible:delete4Shown},closeBlock5:{onClick:function(n){var n=document.getElementById("block5");n.style.display="none";block5Shown(!1);eDate5(null);iDate5(null)},text:"",icon:"remove",visible:!0},savePunch:{text:i18nextko.i18n.t("roSaveLicense"),onClick:function(){var u=$("#beginDate").dxDateBox("instance"),t=u.option("value"),n={},r,i;n.isNew=!0;n.IDEmployee=VTPortal.roApp.employeeId;n.DateTime=moment(t).format(VTPortal.roApp.localFormat);n.ShiftDate=moment(params.param,"YYYY-MM-DD").format(VTPortal.roApp.localFormat);reqValue1()=="E"?(n.cssClass="dx-icon-NewDailyRecordPunch",n.Date=moment.tz(t,VTPortal.roApp.serverTimeZone),n.Name=i18nextko.i18n.t("roEntry")+": "+moment.tz(t,VTPortal.roApp.serverTimeZone).format("HH:mm"),n.Direction="E",n.Type=1):(n.cssClass="dx-icon-NewDailyRecordPunch",n.Date=moment.tz(t,VTPortal.roApp.serverTimeZone),n.Name=i18nextko.i18n.t("roExit")+": "+moment.tz(t,VTPortal.roApp.serverTimeZone).format("HH:mm"),n.Direction="S",n.Type=2);zoneSelected1()!=null&&(n.IDZone=zoneSelected1().Id);n.InTelecommute=!1;tcTypeSelected1()!=null&&tcTypeSelected1().FieldValue=="1"&&(n.InTelecommute=!0);r=Punches();r.push(n);i=punchesDS();i.push(n);i.sortBy(function(n){return new Date(n.Date)});punchesDS(i);saveVisible(!0);popupNewPunchVisible(!1)}},dateBegin2:{type:"time",pickerType:VTPortalUtils.utils.dailyRecordDatetimeTypeSelect(),value:iDate2,width:VTPortal.roApp.isModeApp()?75:95,valueChangeEvent:"focusout",displayFormat:"HH:mm",onFocusIn:function(n){VTPortal.roApp.isModeApp()||n.element.find("input").val()!=""||iDate2(moment(eDate1()).clone().toDate())}},dateEnd2:{type:"time",pickerType:VTPortalUtils.utils.dailyRecordDatetimeTypeSelect(),value:eDate2,width:VTPortal.roApp.isModeApp()?75:95,valueChangeEvent:"focusout",displayFormat:"HH:mm",onFocusIn:function(n){VTPortal.roApp.isModeApp()||n.element.find("input").val()!=""||eDate2(moment(iDate2()).clone().toDate())}},cmbTCType2:{dataSource:tcTypesDS,displayExpr:"FieldName",valueExpr:"FieldValue",value:tcTypeValue2,onValueChanged:function(n){tcTypeSelected2(n.component.option("selectedItem"))}},cmbZones2:{dataSource:VTPortal.roApp.zonesDataSource,displayExpr:"Name",valueExpr:"Id",value:zoneValue2,onValueChanged:function(n){zoneSelected2(n.component.option("selectedItem"))}},dateBegin3:{type:"time",pickerType:VTPortalUtils.utils.dailyRecordDatetimeTypeSelect(),value:iDate3,width:VTPortal.roApp.isModeApp()?75:95,valueChangeEvent:"focusout",displayFormat:"HH:mm",onFocusIn:function(n){VTPortal.roApp.isModeApp()||n.element.find("input").val()!=""||iDate3(moment(eDate2()).clone().toDate())}},dateEnd3:{type:"time",pickerType:VTPortalUtils.utils.dailyRecordDatetimeTypeSelect(),value:eDate3,width:VTPortal.roApp.isModeApp()?75:95,valueChangeEvent:"focusout",displayFormat:"HH:mm",onFocusIn:function(n){VTPortal.roApp.isModeApp()||n.element.find("input").val()!=""||eDate3(moment(iDate3()).clone().toDate())}},cmbTCType3:{dataSource:tcTypesDS,displayExpr:"FieldName",valueExpr:"FieldValue",value:tcTypeValue3,onValueChanged:function(n){tcTypeSelected3(n.component.option("selectedItem"))}},cmbZones3:{dataSource:VTPortal.roApp.zonesDataSource,displayExpr:"Name",valueExpr:"Id",value:zoneValue3,onValueChanged:function(n){zoneSelected3(n.component.option("selectedItem"))}},dateBegin4:{type:"time",pickerType:VTPortalUtils.utils.dailyRecordDatetimeTypeSelect(),value:iDate4,width:VTPortal.roApp.isModeApp()?75:95,valueChangeEvent:"focusout",displayFormat:"HH:mm",onFocusIn:function(n){VTPortal.roApp.isModeApp()||n.element.find("input").val()!=""||iDate4(moment(eDate3()).clone().toDate())}},dateEnd4:{type:"time",pickerType:VTPortalUtils.utils.dailyRecordDatetimeTypeSelect(),value:eDate4,width:VTPortal.roApp.isModeApp()?75:95,valueChangeEvent:"focusout",displayFormat:"HH:mm",onFocusIn:function(n){VTPortal.roApp.isModeApp()||n.element.find("input").val()!=""||eDate4(moment(iDate4()).clone().toDate())}},cmbTCType4:{dataSource:tcTypesDS,displayExpr:"FieldName",valueExpr:"FieldValue",value:tcTypeValue4,onValueChanged:function(n){tcTypeSelected4(n.component.option("selectedItem"))}},cmbZones4:{dataSource:VTPortal.roApp.zonesDataSource,displayExpr:"Name",valueExpr:"Id",value:zoneValue4,onValueChanged:function(n){zoneSelected4(n.component.option("selectedItem"))}},dateBegin5:{type:"time",pickerType:VTPortalUtils.utils.dailyRecordDatetimeTypeSelect(),value:iDate5,width:VTPortal.roApp.isModeApp()?75:95,valueChangeEvent:"focusout",displayFormat:"HH:mm",onFocusIn:function(n){VTPortal.roApp.isModeApp()||n.element.find("input").val()!=""||iDate5(moment(eDate4()).clone().toDate())}},dateEnd5:{type:"time",pickerType:VTPortalUtils.utils.dailyRecordDatetimeTypeSelect(),value:eDate5,width:VTPortal.roApp.isModeApp()?75:95,valueChangeEvent:"focusout",displayFormat:"HH:mm",onFocusIn:function(n){VTPortal.roApp.isModeApp()||n.element.find("input").val()!=""||eDate5(moment(iDate5()).clone().toDate())}},cmbTCType5:{dataSource:tcTypesDS,displayExpr:"FieldName",valueExpr:"FieldValue",value:tcTypeValue5,onValueChanged:function(n){tcTypeSelected5(n.component.option("selectedItem"))}},cmbZones5:{dataSource:VTPortal.roApp.zonesDataSource,displayExpr:"Name",valueExpr:"Id",value:zoneValue5,onValueChanged:function(n){zoneSelected5(n.component.option("selectedItem"))}},block1Invalid:block1Invalid,block2Invalid:block2Invalid,block3Invalid:block3Invalid,block4Invalid:block4Invalid,block5Invalid:block5Invalid,thereIsNighttime:thereIsNighttime,blockInvalidText:i18nextko.i18n.t("invalidPeriod"),blockNTText:i18nextko.i18n.t("blockNTText"),lblRemaining:lblRemaining}};VTPortal.communiques=function(){function r(){var s,r,e,o,f;if(i(1),$("#btnNotRead").removeClass("pressing"),$("#btnAllCom").addClass("pressing"),$("#btnArchived").removeClass("pressing"),s=[],r=VTPortal.roApp.userCommuniques(),r!=null&&r.length>0)for(e="",o="",f=0;f<r.length;f++)if(r[f].Communique.Archived==!1){if(r[f].Communique.MandatoryRead==!0)switch(r[f].EmployeeCommuniqueStatus[0].Read){case!1:e="dx-icon-communiqueImportant";o="textCommuniqueNotRead";break;case!0:e="dx-icon-communiqueImportantRead";o=""}else switch(r[f].EmployeeCommuniqueStatus[0].Read){case!1:e="dx-icon-communiqueNotRead";o="textCommuniqueNotRead";break;case!0:e="dx-icon-communiqueRead";o=""}name=r[f].Subject;s.push({ID:r[f].Communique.Id,cssClass:e,cssClassText:o,Message:u(r[f].Communique.Message.replaceAll("<br>","")),SentOn:moment(r[f].Communique.SentOn).format("DD/MM/YYYY"),CreatedBy:r[f].Communique.CreatedBy.PassportName,Subject:r[f].Communique.Subject})}return s.length>0?n(!0):n(!1),t(new DevExpress.data.DataSource({store:s,searchOperation:"contains",searchExpr:["Subject","Message","SentOn","CreatedBy"]})),s}function e(){var s,r,e,o,f;if(i(2),$("#btnNotRead").removeClass("pressing"),$("#btnAllCom").removeClass("pressing"),$("#btnArchived").addClass("pressing"),s=[],r=VTPortal.roApp.userCommuniques(),r!=null&&r.length>0)for(e="",o="",f=0;f<r.length;f++)if(r[f].Communique.Archived==!0&&r[f].EmployeeCommuniqueStatus[0].Read==!0){if(r[f].Communique.MandatoryRead==!0)switch(r[f].EmployeeCommuniqueStatus[0].Read){case!1:e="dx-icon-communiqueImportant";o="textCommuniqueNotRead";break;case!0:e="dx-icon-communiqueImportantRead";o=""}else switch(r[f].EmployeeCommuniqueStatus[0].Read){case!1:e="dx-icon-communiqueNotRead";o="textCommuniqueNotRead";break;case!0:e="dx-icon-communiqueRead";o=""}name=r[f].Subject;s.push({ID:r[f].Communique.Id,cssClass:e,cssClassText:o,Message:u(r[f].Communique.Message),SentOn:moment(r[f].Communique.SentOn).format("DD/MM/YYYY"),CreatedBy:r[f].Communique.CreatedBy.PassportName,Subject:r[f].Communique.Subject})}return s.length>0?n(!0):n(!1),t(new DevExpress.data.DataSource({store:s,searchOperation:"contains",searchExpr:["Subject","Message","SentOn","CreatedBy"]})),s}function o(){var s,r,e,o,f;if(i(0),$("#btnNotRead").addClass("pressing"),$("#btnAllCom").removeClass("pressing"),$("#btnArchived").removeClass("pressing"),s=[],r=VTPortal.roApp.userCommuniques(),r!=null&&r.length>0)for(e="",o="",f=0;f<r.length;f++)if(r[f].EmployeeCommuniqueStatus[0].Read==!1){if(r[f].Communique.MandatoryRead==!0)switch(r[f].EmployeeCommuniqueStatus[0].Read){case!1:e="dx-icon-communiqueImportant";o="textCommuniqueNotRead";break;case!0:e="dx-icon-communiqueImportantRead";o=""}else switch(r[f].EmployeeCommuniqueStatus[0].Read){case!1:e="dx-icon-communiqueNotRead";o="textCommuniqueNotRead";break;case!0:e="dx-icon-communiqueRead";o=""}name=r[f].Subject;s.push({ID:r[f].Communique.Id,cssClass:e,cssClassText:o,Message:u(r[f].Communique.Message),SentOn:moment(r[f].Communique.SentOn).format("DD/MM/YYYY"),CreatedBy:r[f].Communique.CreatedBy.PassportName,Subject:r[f].Communique.Subject})}return s.length>0?n(!0):n(!1),t(new DevExpress.data.DataSource({store:s,searchOperation:"contains",searchExpr:["Subject","Message","SentOn","CreatedBy"]})),s}function u(n){return n.replace(/<img[^>]*>/g,"")}function s(){for(var n=0,t=$("div.smallTextDescriptionComm img"),n=0;n<t.length;n++)t[n].width>50&&t[n].classList.add("communiqueeImageList")}function h(){VTPortal.roApp.db.settings.markForRefresh(["communiques","status"]);f().viewShown();i(1);let n=function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.db.settings.updateCacheDS("communiques",n.Communiques),VTPortal.roApp.userCommuniques(n.Communiques),r(),s()):VTPortalUtils.utils.processErrorMessage(n)};VTPortal.roApp.userCommuniques(VTPortal.roApp.db.settings.getCacheDS("communiques"));VTPortal.roApp.userCommuniques()==null||window.VTPortalUtils.needToRefresh("communiques")?new WebServiceRobotics(n,function(){}).getEmployeeCommuniques():n()}var n=ko.observable(!1),i=ko.observable(1),t=ko.observable(new DevExpress.data.DataSource({searchOperation:"contains",searchExpr:["Subject","Message","SentOn","CreatedBy"]})),f=ko.observable(VTPortal.bigUserInfo());return{viewShown:h,title:i18nextko.t("rocommuniquesTitle"),subscribeBlock:f(),communiqueDS:n,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),commScroll:{height:"70%",onPullDown:function(n){VTPortal.roApp.db.settings.markForRefresh(["communiques","status"]);$.when(VTPortal.roApp.refreshEmployeeStatus(!1)).then(n.component.release());switch(i()){case 0:o();break;case 1:r();break;case 2:e()}}},listcommuniques:{dataSource:t,scrollingEnabled:!1,grouped:!1,itemTemplate:"communiqueItem",onItemClick:function(n){VTPortal.app.navigate("communiqueDetail/"+n.itemData.ID)},onItemRendered:function(){setTimeout(s,100)}},searchOptions:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(n){t().searchValue(n.value);t().load()}},notRead:{onClick:o,text:i18nextko.t("roNotRead")},allComm:{onClick:r,text:i18nextko.t("roAllComm")},archived:{onClick:e,text:i18nextko.t("roArchived")}}};VTPortal.communiqueDetail=function(n){function b(){VTPortal.roApp.db.settings.markForRefresh(["communiques","status"]);s().viewShown();w()}var t=ko.observable(),f=ko.observable(!1),e=ko.observable(!1),o=ko.observable(i18nextko.i18n.t("roVote")),u=ko.observable(""),h=ko.computed(function(){return u(""),typeof t()!="undefined"?t().Status.EmployeeCommuniqueStatus[0].Answered==!0?t().Status.Communique.AllowChangeResponse==!0?(o(t().Status.EmployeeCommuniqueStatus[0].Answer+" ("+i18nextko.i18n.t("roChange")+")"),!0):(u(t().Status.EmployeeCommuniqueStatus[0].Answer),!1):!0:!1}),i=ko.observable(!1),c=ko.computed(function(){if(typeof t()=="undefined"||VTPortal.roApp.isTimeGate())i(!1);else{if(t().Status.Communique.Documents.length>0){i(!0);var n=[];return t().Status.Communique.Documents.forEach(function(t){n.push({text:t.Title,id:t.Id,type:"success"})}),n}i(!1)}}),r=ko.observable(!1),l=ko.computed(function(){if(typeof t()!="undefined"){if(t().Status.Communique.AllowedResponses.length>0){r(!0);var n=[];return t().Status.Communique.AllowedResponses.forEach(function(t){n.push({text:t,type:"success"})}),n}r(!1)}else r(!1)}),a=ko.computed(function(){if(typeof t()!="undefined")return t().Status.Communique.Subject;""}),v=ko.computed(function(){if(typeof t()!="undefined")return moment(t().Status.Communique.SentOn).format("dddd DD MMMM YYYY");""}),y=ko.computed(function(){if(typeof t()!="undefined")return t().Status.Communique.Message;""}),s=ko.observable(VTPortal.bigUserInfo()),p=ko.computed(function(){return typeof t()!="undefined"?t().Status.Communique.CreatedBy.EmployeePhoto!=""?"url(data:image/png;base64,"+t().Status.Communique.CreatedBy.EmployeePhoto+") no-repeat center center":'url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfQAAAH0CAYAAADL1t+KAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AkbDRUQckJm7gAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAgAElEQVR42u3d93Mc933/8dder8ABh0YSBJuKRUoiGfWRrGIpluVYZTJJZjKTSX7If5Yfk8wkcuLQoljEoi9FkRIAsReAJOqhHHAVV7Z9f5APJmVKYkG523s+ZjySrRkP9cZin/fZ++yu4bquKwAA0NJ8jAAAAIIOAAAIOgAAIOgAAICgAwBA0AEAAEEHAAAEHQAAEHQAAAg6AAAg6AAAgKADAACCDgAAQQcAAAQdAAAQdAAAQNABACDoAACgiQUYAbC5bNuW67qq1+tyHEemad7zzy3Lkm3bMgzj3l/eQEA+372fycPhsAzDUDAYlGEY8vv9DBgg6ADWkmVZqtVqqlarqtfrqtVqcl139T+O46z+tRHvu//5D/l8vnsi77ruasAbf20EPxaLKRgMKhKJKBqN8sMAPMhw73emAPDYyuWyKpWKSqWS6vX6PWHe6F+7Rvgbf/X5fIrFYopGo0omkwoGg/zAAIIOtLdGqE3TVKlUUrFY1MrKyl/EtJn/7MFgUIlEQolEQvF4fHVl38x/dgAEHXhstm3Ltm3VajXl83mVy2XV6/XVy+CtGMK7ryBEo9HVuIdCIfn9/r/4vh4AQQdaNuLValW1Wk0rKytaWVlZ3cDWqhF/kLhHIhHFYjHF43GFw2GFw2EOBoCgA62nXq+rWCyufhd+9y70drgk3Yi7z+dTKBRaXb0nk0kuyQMEHWh+5XJZuVxO5XJZjuPcs/u83fl8Pvn9fnV2dqqrq0uBADfMAAQdaDK5XE7ZbFb1ep1hPMhJxDCUSCTU29vL5XiAoAOby7ZtraysaH5+XrVajZX4Q2qcRuLxuPr6+hQOh9lEBxB0YOPU63WVy2UtLS2pWq16bnPbZoTdcZzVS/HRaJSn1QEEHVg/lmUpl8upUChoZWXlL566hsfjOI58Pp8SiYQ6OjrU2dnJUACCDqytpaUl5XK51UevEvL1XbH7/X5Fo1Gl02nF43GGAhB04PFUq1VNT0/LNE1x2G+8xoq9v7+fXfEAQQcenm3bmp2dVaFQYDXeJCv2vr4+pVIpfh4AQQd+nuM4KpVKmp2dve/rR7F5LMtSKpXSwMAAL4YBCDrw46rV6up35RIvGWnWD1yBQEC9vb3q6OjgMjxA0IE/c113NeTVapV7oVvkZxaPx5VOp5VIJBgIQNDR7izL0vT0tCqVCo9pbcGo+/1+9fT0KJ1OMxCAoKNdraysaHZ2lse1ekAikdDg4CAfyACCjnZb2eXzeWUyGVblHvqZBoNBDQ0N8Wx4gKCjHViWpcXFRWWzWb4r92DUfT6fBgYG1NnZyQc1gKDDq2q1mmZnZ1Uul4m5x6OeSqXU19fHzxkg6PCacrmsTCbDW9HaKOydnZ0aGBjgRS8AQYdXFAoFzc7OynEchtFmQqGQdu7cSdQBgo5Wl8/nNTMzwyDaWCAQ0LZt2xSLxRgGQNDRihYXF5XJZFidQX6/X4ODg0Qd+AF2maCpua6rhYUFzc3NEXNI+v7uhpmZGa2srDAMgBU6Winm2WyWYeAejuMoHA5r69atrNQBgg5ijlY/RgKBAJffgT/hkjua0uLiohYXFxkEfnw1YhiybVuTk5NcfgcIOprR8vKy5ubmuMccD8RxHKIOEHQ0m2KxqNnZWTbA4aHYts3LeUDQGQGaRalU0tTUFCtzPDTDMFYfB2zbNgMBQQc2S+NxrsDjRL1UKimTyYi9viDowCYwTVPz8/NcLsXjn9B8Pp4oCIIObAbbtjU/P69KpcKldqzZSj2fz2tpaYlhgKADG6VQKGh5eZmYY82jPjc3p3K5zDBA0IH1Vi6XNT09zY52rJtMJiPTNBkECDqwXur1uqampog51v04m5ub43W7IOjAenAcR9PT09xehA1RLBaVy+XY+Q6CDqy1+fl5VatVvjfHhh5zXHoHQQfWULlcVqFQYBDYUI7jaGZmhlU6CDqwFmzbVjablWVZDAMbqvHQmeXlZYYBgg48rnw+r1KpxKV2bAq/369MJqNqtcowQNCBR1WtVrWwsMAgsOkr9dnZWXa9g6ADj6rx0gxW59hstVpN2WyWQYCgAw8rl8vxaFc0Ddd1VSgUuPQOgg487Mlzbm6OmKOpVKtVLS8vs+sdBB14UJlMhu8r0XwnPp9PhUJBlUqFYYCgAz+nUqlwzzmalmVZWlpaYpUOgg78FNd1tby8zOocTb9K541sIOjAT1hZWVGpVGIQaHpzc3MMAQQduB/HcVQoFHgiHJqeYRiq1Wp8NQSCDtxPrVbT8vIyO9vRMlFnlQ6CDvyA67q8qhItx7IsnvMOgg7czTRN5fN5+XwcWmgtBB0EHfjBSdG2bQaBlvwwynfpIOiAvt8Mt7S0xOocLcm2bRWLRQYBgg7Mzc3x3TlalmEYWllZ4b50EHSgWCyysx0trV6va2VlhUGAoKN95XI5ngoHT6zSS6USz1AAQUd7r8653A4vBL1SqahWqzEMEHS0n2q1ygkQntF4XzofUEHQ0XbK5bJM02QQ8MZJ0edTLpdjECDoaC+O46hSqbCageeO63w+zyBA0NE+arWaKpUKu9vhKYZhEHQQdLQX0zS53A5PBr1cLvPUQxB0tAcut8PreBQsCDraJug8TAZeXqVz2R0EHW3BNE1Vq1WCDs+q1Wo8MAkEHd7H6hxe57quSqUSgwBBh7eVy2WCDoIOEHS0Mtu2uV0NbaFerzMEEHR4V7VaZXc72ubDK1EHQYdnlUolVudoC5ZlqVqtMggQdHgT74xGu3Ach4cngaDDu/j+HO3CdV3VajW+YgJBBzEHWp1pmjwGFgQd3sPldrRj0C3LYhAg6PCWWq3GENA2DMOQbdus0EHQwQod8MIKnUfAgqDDc9gchHZcpbMxDgQdnlupcFIDxz5A0NHiLMvipIa2XKETdBB0eC7oACt0gKCjxfE9ItoVm+JA0OEp3LqDdsQldxB0eE69Xmelgrb9MEvQQdABwCOrdICgwzMnNaBdEXQQdHiC4ziybZuogw+0AEFHK3Ndl+8QAYCgA0Drf6gFCDoAtDDDMFSv1xkECDoAtDqewwCCDs+czLgHHQAIOlr9YPH55PNxyAAAQUdL45YdACDoAMCHWoCgA8DmC4fDDAEEHQBameu67CEBQYc3+P1+TmgAQNDhBYZh8LQstPUqHSDoANDiIpEIQwBBh3dW6Oz0Rbuuzv1+P4MAQYc3hEIhgo72PFmyfwQEHV7CCgXtKhAI8GEWBB3eEQwGOamh7XC5HQQdnlylAO2Ir5tA0MFJDfDICp1jHwQd3jlgfD5OamhL4XCYYx8EHQQdYIUOEHQ0mVAoxBDQdh9kg8EggwBBB0EHWhmrcxB0eFI0GmUIaBuu6yoUCrFCB0EHQQe8sELnSXEg6PAcbl1DuwkEAjxYBgQd3hQOh3mVJNqCYRh8iAVBh3dx2R1tc5JkhzsIOrwskUiwQkfbBJ07O0DQ4Vlccke78Pv9BB0EHd4VDAZ5UQvaAhviQNDhefF4nFU6PM0wDEUiEQYBgg5vSyQSchyHQcDTQY/H4wwCBB3eFovFGAI4zgGCjlbn9/sViUS47A7P4pWpIOhoj4PH51MsFiPo8CTXdZVIJBgECDraI+is0OFlBB0EHW0jHA5zSw88/YEVIOhoC4FAgIfMwHNc11UymWQQIOhoH6FQSOFwmEHAUxzHUSqVYhAg6GgfhmGwExjeOzH6fLyACAQd7ScajfIYWHhG43I7H1JB0NF2YrEYQYdnOI5D0EHQ0Z543jW8JBAIcDyDoKN9dXR0sKJBy3NdV7FYTMFgkGGAoKM9xeNx+XwcTmj9oMfjcZ6tAIKO9tbZ2cn96GhpwWCQy+0g6EBnZydDQEuvzsPhMEEHQQcikYhCoRCrdLQkwzAUjUa53A6CDkhSOp0m6GhJfr+fl7GAoAMN7HZHqwoEAorFYgwCBB2Qvn9kZmdnpxzHYRhoKbyMBQQduIthGGyOQ0set93d3QwCBB24W2OnMN+loxW4rqtEIsFmOBB04IcCgYCSySRBR8sEvbe3l0GAoAM/ZBiG4vE4L2xBS8Q8Go0qHA4zDBB04H5isZii0SirdDQ1x3FYnYOgAw+ySuf57mjm1XkwGORWNRB04Od0dnZy2R1NHfTu7m4+dIKgAz8nEAgoHo8zCDTt8ZlMJnkQEgg68CB6enoYApqO4zhKJpMKhUIMAwQdeBDBYFCpVIrNcWi61Tl7PEDQgUdYpfMoWDSTSCSijo4OBgGCDjzsKr2rq4tVOppC4w4MvjsHQQceAff6olkEAgGe2w6CDjzuKp1L79hMruuqq6uL785B0IFH1XgLG/elY7M/WLI6B0EHHlM4HFYsFuO7dGwK27bV19fHd+cg6MDj8vv9SiaTvKYSG67xEhZ2toOgA2uks7NTkUiEQWDDg97b28vqHAQdWCuGYainp4cTKzY05rFYjMcQg6ADay0ejysajTIIbMxJzudTd3c3X/WAoAProb+/n81x2LDVeTKZZBgg6MB6iEQi6u7u5r50rCu/369UKsV95yDowHrq7e3lvnSs+wdHdraDoAMbsHrq6+vj0jvW5+Tm86mvr49BgKADG6Gjo4OHzWDNua6rjo4ONl+CoAMbuUrv7u7mO06s+XHV39/PIEDQgY2UTCaVTCZZpWNNWJalbdu28SERBB3YaIZhqKuriw1yeGyO46irq0uxWIxhgKADmyEWi7EbGY/N7/ert7eX1TkIOrCZ+vv7FQwGGQQeWU9Pj0KhEIMAQQc2k2EY2rJlC9+l46G5rqtIJKJUKsV7AkDQgWYQj8fV09Mj27YZBh6Y3+9XT08P+zBA0IFmkk6nFY/HWanjgSUSCZ7XDoLOCNCMq62+vj4uneLBTmI+n7Zt28YgwO8CI0AzisViSqfTrNLxk1zX1fbt2xkEQNDRrAzDUHd3N/cT40c5jqN0Os0xAhB0NLtAIKDe3l4uveO+Me/o6FBvby/DAAg6WkE8HufSO+7huq5CoZB6enp4gAxA0NFKent72fWOP5+0fD6l02nepAYQdLSi7du3KxAIEHUokUiou7ubQQAEHa26Ktu+fbsMwyDqbSwUCmlgYIBBAAQdrSwajaq/v5/vTduQ67ry+XzaunUrT4MDCDq8IJVK8Va2NmQYhrZu3cr35gBBh2cOWJ9P/f39CofDDKNN2Lat/v5+Hu0KEHR4jd/v1+DgIJfe20Dj4TGpVIphAAQdXhQKhTQ4OMhDZzwukUiot7eXD28AQYeXxeNx9ff3E3WPCgaD6uvrYxMcQNDRDrq6utTT08OtbF47Mfl82rJlC5vgAIKOdtLd3a10Os0gPMK2bQ0ODioejzMMgKCj3VZzfX19SiaTrNQ9EPOhoSFiDhB0tCvDMLhE2+Jc19Xg4CDPGQAIOtqd3+/Xjh07FIlEWKm34AeygYEBbk8DCDrwpwPa59OOHTsUj8flOA4DaRGpVIoXrgAEHfjLqDcu3RL15ua6rrq6utTX18cwgMfEDZ7wJL/fry1btkiSCoUCDyZpQrZta/v27Uomk/x8gDVguHzZCI9HY2pqSisrKwyjiTiOo8HBQXV2djIMYI3wsRieX6lv375dkUiEYTSRrVu3EnOAFTrwaKanp1UoFBjEZq4gfD719vayAQ4g6MDjyWQyyufzsm2bZ8BvINd1FQgEtGXLFl6DChB0YG3CksvlND8/T9Q3iOM4ikajPPgHIOjA2iuXy5qamuK2tnVm27ZSqZQGBgZ4axpA0IH1YVmWxsfHZds2w1gHruuqu7tbfX193JYGEHRg/U1OTqpcLvO42DXk8/nU09PDW/AAgg5srMXFRS0tLcmyLL5Xf8xVeSwWUzqdZvMbQNCBzbGysqK5uTlVKhWi/ggh9/l8SqVS6unp4ftygKADm8u2bWWzWS0uLn7/C0LYf5bjOAqFQhoYGFAikWBmAEEHmme1WavVNDU1pVqtxoaun5lVMpnUli1bWJUDBB1o3lhlMhnlcjmGcR8+n09btmxRR0cHwwAIOtD8yuWyFhYWVK1W5ThOW19Sdl1Xfr9fyWRS/f398vv9HCAAQQdah+M4yuVyKhQKKpfLMgyjrcLe2PSWSCSUSqWUSCQ4KACCDrQu0zSVz+eVy+VUrVY9v0J1XXf1e/JUKqVkMsmmN4CgA94Ke6FQ0OLioizL8tzGOdd15TiO4vG4+vr6FIlEuLwOEHTAuxzHUTab1dLSkqde9hKJRNTX16dYLMaKHCDoQHtZWlpafdpcq/1aNfYEhEIh9ff3KxaL8QMFCDrQ3orFogqFgqrVqizLWn2cbDOtdBu/9oFAQKFQSNFoVN3d3QoGg/wAAYIOPDzHcTQ/P690Ou25mNRqNVUqFVUqFVWr1b+47W0jA9/Y3CZJwWBQ4XBY0WhUsVhMsVjMc3sAarWaMpmMduzYwS8ZCDqw3m7cuKHR0VFls1nt379fr776qif/PV3XlWmaMk1TlUpFKysrqlQqMk3znrivZeAbAW/8ejfiHY1GFQ6HFQwGPftkt0KhoD/+8Y/KZrMaHBzUCy+8oK1bt/ILB4IOrLWJiQmdOnVKS0tLqlarq//7O++8oxdffNHT/+6N3eOu68q2bZXL5dXV++Os4Bu/xq7rKhgMKhKJKBqNrv6n8YHB64+xLRaL+v3vf6+ZmZnV+YVCIQ0NDentt99WKpXiFxAEHXhcCwsLOnbsmCYnJ+/7z03T1G9+8xsdPHiwbWdkWZbq9brq9bpM05Ske/5+9RfXMBSPx1dX4bFYTIFAQJFIpG1nVywW9X//93+6c+fOfT+42LatZ599Vm+//bbi8Ti/kCDowMOwbVtLS0v66quvdPHiRfn9/h9dJRqGoVqtpvfff1/79+/nZR94YIVCQUeOHNG1a9d+ci9G4wrIO++8o1/84hc88Q4EHXjQFfmVK1f01VdfyXGcBw60ZVl6/vnn9e677yocDjNI/KS5uTkdOXJEd+7cUTgcfqBbBuv1uvr6+vTyyy9r9+7dhB0EHbifSqWib7/9VhcuXFAul3uklbZhGNq1a5feffdddXZ2MlTc1/Xr13XixAlls9mHPs4cx5Ek7dixQ3v37tWzzz7LQ3RA0IGGS5cu6fz588pms4/95DTHcbRt2zZ99NFHSiaTDBf3GB0d1alTp1SpVB77OAuHwxoYGNArr7yinTt3MlwQdLSvpaUlHTp0SPPz87Jte03/v8PhsP7pn/5JXV1dDBqSpK+//lr/7//9P1mWtab/v4FAQM8884zeffdd9nCAoKO9mKapr7/+WmfPnl3XZ5k7jqOPP/5YTz/9NENvY/V6XSdOnNDw8PC63YLnOI5isZg+/PBDDQ0NcRkeBB3eZtu2MpmMjhw5oqmpqQ3ZvOa6rl5++WW9/vrrrJ7aUKFQ0NGjR3X58uV1P95c11W9XteBAwf02muvqauri7CDoMN7stmsLl68qG+++UamaW7oazVd19XevXv15ptv8r16G7l9+7aOHTumubk5hUKhDXv5jW3b6uzs1Isvvqh9+/YpGo3ywwBBhzeMjIxoZGREmUxm01bJjuOov79fb775pnbt2sUPxcNs29a5c+f07bffqlwub8oq2XVdGYahbdu26a233uIxsiDoaG2lUknHjh3T2NjY6tvDNpPjOIpGozp48KDeeOMNfkAetLKyosOHD2t8fHz1FrPN5LquotHo6tPmAIKOljM+Pq4//OEPqtVqTfdn8/l82rFjhz788EOFQiF+WB4xNzenTz/9VPl8vum+uzYMQ93d3fr444/V3d3NDwsEHc2vUqno1KlTOn/+fFPH0nEcpVIpffDBB9q2bZvnX0DiZbZt69tvv9XJkyfveVFNs3FdV+FwWO+8846eeeYZNmmCoKN5TUxMrG5C2shNb48TdcMw9Oqrr+rAgQNsmGtBs7OzOnXqlMbHx1sikI035z3//PN65ZVXWK2DoKO5WJal4eFhnTt3TqVSqaVWu41Xku7cuVMvvviinnjiCX6gLaBer+ubb77R8PBwyx1zjT//tm3b9Oqrr/KcBBB0NIdSqaSjR49qfHy8KTa+Pc5qPRaL6emnn9Zrr73Gizea2J07d3TmzBlNT0839SX2BznmGhvm3nrrLb72AUHH5pmYmNAf//hHFQoF7xzcf3pn+C9/+Uvt27ePH3ITqVarq3dNNONmy8cxNDSk3/72t3yQBEHHxjt79qy+/PLLprg1aD3Ytq2hoSF98MEHSqVS/MA3keu6Ghsb0+eff65SqeTJp6+5rqtEIqG//du/VX9/Pz90EHSsv0KhoNOnT+vSpUuef6yl4zjy+/16+eWX2TS3CUzTVD6f1+nTp3XlyhUFAgFPH3Ou68o0TX3yySd66qmn2AUPgo71MzMzo+PHj2tycrKtTjaWZamnp0cHDhzQ008/Tdg3wPz8vEZHRzU6OirLstrqeKvVanrttdf0yiuvKB6PczCAoGNtXbt2TadOndLCwoKCwWDb/fs7jiPXdTU4OKinn35azz77rCKRCAfGGpudndWlS5c0NjamXC7XErc/rtfxtmfPHr3zzjvc2gaCjrVz6tQpjY6OqlKptP3boxzHUTAYVFdXl/bu3asXXnihbaOzlpaWlnTmzBlNTEyoXC6vPgu93fX09OhXv/qVhoaGOEhA0PF4Tp48qW+++Ua2bTOMH/D5fIpGo9q/f79effVVbjt6BKVSSSdOnNCNGzdk27Y4tdz/OPv444+1Z88ehgGCjodXr9dXY84K9OdX7aFQSC+//LL279+vSCTCzH6CaZpaWlrSV199pWvXrskwDFbjD/D7+MEHH+jgwYMMAwQdD65QKOjYsWO6evUqO20fMlShUEj79u3Tc889p1QqxaamP7EsS8ViUQsLCxoeHtbY2Jj8fj8ffB70pGsYqtfreuutt/TSSy+15T4WEHQ8pJmZGZ06dUpjY2O8iewRuK4ry7IUDAa1fft2DQ4OamhoSL29vW25ia5YLGpmZkaTk5O6ffu25ufnFQgE+HriETmOo+eee07vvfceUQdBx4+7evWqTp06peXlZU64a3TytW1bXV1d6urq0uDgoHbu3Klt27Z5/krF7du3defOHWUyGWWzWVWrVfl8Pi6tr9FqfefOnfrNb37DFSAQdPylCxcu6MSJE6pWqwxjHVbtkuT3+xUKhRSPx7Vnzx7t2rVL27dv98S/o23bGhsb05UrVzQ/P69qtap6vd7Sz1pv9mOqv79f//iP/8hKHQQdf3b9+nUdOnRIpmkyjA1eaYVCIT3xxBPas2eP9uzZ01LfKS8vL2tsbExjY2OamJiQz+djl/oGRz2dTutf/uVf2IsAgg7p1q1b+q//+i/Zts1KapM4jiPHcWRZlrZv364dO3ZoYGBg9Xv3QCCwuoFsI39GjdvITNOUbduqVqvKZDK6ffu2xsfHVSqV5Pf7uZTeBFH/3e9+p76+PgYCgt6uxsbG9OmnnxLzJov73fdjd3R0aOvWrUqn04rFYkqn0woGgwoGg4pEIjIMQ5FIRD6f76EvvVqWtbqJr1aryXEc1et1VatVWZalTCajSqWiTCajubk51Wo1GYZBxJsw6slkUh999JG2bt3KQEDQ283Fixd15MgRmabJibnJT9aNFXzjv8diMUUiESUSCRmGoWQyKcMwFI1GFQ6HH/iDQ7lcXo34ysqKbNvWysqKisXi6rvtDcOQz+djk2QLfBDs7u7Wb3/7W6IOgt5ORkdHdfLkSVWrVWLewqH/ub//2V/ku372P/b3aK2op1IpffLJJ1x+B0FvB999952++OIL1et1hgF48INeOBzWv/7rv3JLGwi6V1mWpX/7t39TNptlBQZ4POrpdFr//M//zJMeQdC9plwu6z//8z81Pz9PzIE2iXpfX5/+7u/+jpU6fhK7Y1pIPp/Xp59+SsyBdlp1GYbm5+f16aefKp/PMxAQ9Fa3srKiQ4cOaXp6mpgDbRj16elpHTp0SCsrKwwEBL2VHTt2TBMTE8QcaOOoT0xM6NixYwwDBL1Vff7557p8+TL3DwPtfsL2+XT58mV9/vnnDAMEvdUMDw/r/PnzxBzAatTPnz+v4eFhhgGC3iquX7+uw4cP8y5zAPcIhUI6fPiwrl+/zjBA0Jvd7du39dlnn8nv9/PWKwD3cF1Xfr9fn332mW7fvs1AQNCbVSaT0dGjR3mfOYCfVK1WdfToUWUyGYYBgt6Mv6AnTpzgKXAAfpZhGMpmszpx4gQLABD0ZuI4jk6fPq3x8XE2wQF4sJO4z6fx8XGdPn169U1+IOjYZBcvXtSZM2fYBAfgoYRCIZ05c0YXL15kGAQdm21sbEyHDh1SNBplExyAh+K6rqLRqA4dOqSxsTEGQtCxWWZnZ3X48GH5/X6GAeCR+f1+HT58WLOzswyDoGOjFYtFHT9+XOVymWEAeGzlclnHjx9XsVhkGAQdG8VxHJ0/f14zMzMMA8CamZmZ0fnz59kkR9CxUW7evKmRkREGAWDNjYyM6ObNmwyCoGO95XI5ffHFFzJNk2EAWHOmaeqLL75QLpdjGAQd68VxnNWHx3C/OYB1Obn7fKsPneHSO0HHOjlx4oSuXr2qYDDIMACsm2AwqKtXr+rEiRMMg6BjrY2NjWlkZIRb1ABsCL/fr5GREe5PJ+hYS7VaTUePHpVt2wwDwIaxbVtHjx5VrVZjGAQda+HkyZMqlUoMAsCGK5VKOnnyJIMg6HhcN2/e1LVr11idA9i0Vfq1a9e4lY2g43FUKhWdPXtW5XKZV6IC2BSGYahcLuvs2bOqVCoMhKDjUQwPD2t6epqNcAA2ld/v1/T0tIaHhxkGQcfDymQyOn36NPebA2iOk77Pp9OnTyuTyTAMgo6HcfjwYYYAgHMTCHorO3funGZmZlidA2i6VfrMzIzOnTvHMAg6fs7y8rJOnz6tQCDAMAA0nUAgoNOnT2t5eZlhEHT8GNd1dfz4cW5RA9DUbNvW8ePH5bouwyDouJ/Lly9rcnKSQeZ6xpgAABItSURBVABoepOTk7p8+TKDIOj4oUKhoNHRUdXrdYYBoOnV63WNjo6qUCgwDIKOu42Pj2tycpIHyABoCYZhaHJyUuPj4wyDoKOhWCxqZGSEmANouaiPjIyoWCwyDIIO6fvvzqemprhNDUBrhcDn09TUFN+lE3RI39+mdubMGYXDYYYBoOWEw2GdOXOG29gIOk6ePKl6vc7ldgAtyTAM1et1XrFK0Nvb1NSUrl+/zqV2AK0dBJ9P169f19TUFMMg6O3pyJEjrMwBeGalfuTIEQZB0NvP5cuXlcvlGAQAz8jlcmyQI+jtxbIsXbhwQZZlMQwAnNtA0FvVzZs3eacwAE/KZDK6efMmgyDo3letVnXt2jXVajWGAcBzarWarl27pmq1yjAIurfNz8/rxo0b7GwH4M04+Hy6ceOG5ufnGQZB9y7TNDU8PMz3SwA8zbIsDQ8PyzRNhkHQvSmfz+vKlSsKBAIMA4BnBQIBXblyRfl8nmEQdG86d+4cQwDAOQ8EvZXVajVduHCB1TmAtlmlX7hwgQ3ABN17Tp06xRAAcO4DQW9ltm1rZGSEne0A2isUPp9GRkZk2zbDIOjecObMGZ7ZDqAtGYahM2fOMAiC3vpM09TVq1flui7DANB2XNfV1atXuYWNoLe+a9euaWVlhUEAaFsrKyu6du0agyDore3WrVvs8gTQ1mq1mm7dusUgCHrrmp2d5SUsAKDvX9oyOzvLIAh6a5qZmdHS0hIb4gC0NcMwtLS0pJmZGYZB0FtPuVzWjRs3iDkA/CnqN27cULlcZhgEvbXk83lNTk5y7zkA6Pt70icnJ3m+O0FvLY7j6Pr167xVDQDuYlmWrl+/LsdxGAZBb52g89x2ALhX4/nuBJ2gt4yZmRkVi0W+PweAuxiGoWKxyOY4gt46vv32W1bnAPAjq/Rvv/2WQRD05uc4jsbHx9kMBwD3i4fPp/HxcS67E/Tmd+HCBTbDAcBPsCxLFy5cYBAEvbkNDw+zOgeAn1mlDw8PMwiC3rwWFha4xxIAHkA+n9fCwgKDIOjNaWJigu+FAOABOI6jiYkJBkHQm9OtW7dk2zaDAICfYds2b2Aj6M2pUChwuR0AHkI+n1ehUGAQBL25TE5O8tIBAHgI5XJZk5OTDIKgN5e5uTlVq1UGAQAPqFqtam5ujkEQ9OZRLBa1sLDAo14B4CEYhqGFhQUVi0WGQdCbJ+hLS0sMAgAe0tLSEkEn6M11QOZyOVboAPCQK/RcLseCiKA3B8uyNDc3R8wB4BGjPjc3xyOzCfrmq9frmp2d5XGvAPAoMfH5NDs7q3q9zjAI+uYyTVMzMzMEHQAeMegzMzMyTZNhEPTNlclkuFQEAI/BsixlMhkGQdA31507d1idA8BjrtLv3LnDIAj65hofH5ff72cQAPCI/H6/xsfHGQRB3zyFQkHLy8vscAeAx2AYhpaXl3muO0HfPNPT0wwBADinEvRWl8lkuNwOAGvA7/ezMY6gb56pqSkutwPAGjAMQ1NTUwyCoG+O2dlZgg4AaxT02dlZBkHQNyfm3K4GAGsYlj89NQ4EfUPxDl8A4NxK0D2yQgcAcG4l6C1uYmKCowAAOLcS9FZmmqZc1+UoAIA15rouL2oh6BtnaWmJF7IAwDqwLEtLS0sMgqBvjFwuJ8dxOAoAYI05jqNcLscgCPrGBd22bY4CAFhjtm0TdIK+cRYXFwk6AKxT0BcXFxkEQd8YtVqNTXEAsA5c11WtVmMQBH39lctlVSoVjgAAWCeVSkXlcplBEPT1X51zSwUArB/TNFmlE/T1V6/XuWUNANaRZVmq1+sMgqCvr0KhoEqlwlvWAGAdGIahSqWiQqHAMAj6+nIchw1xALCOXNflWR8Eff0Vi0VVq1WOAABYJ9VqVcVikUEQ9PVlmiafHAFgHTmOw+Zjgr6+bNtWuVzm+3MAWEeGYahcLvMAL4K+fvheBwA2bpXOfiWCvm4qlYqWl5dZoQPAOq/Ql5eXeYgXQV//T40AAM61BL2FcfkHADjnEnQPsCyLh8oAwDprPFyGp3IS9HUNOvegA8D6q1arBJ2gr/O/uM/HTx8AONcS9FZfoXPJHQDWF5fcCfq6M02T2ygAYANUKhWeFkfQ1/dTIwCAcy5BBwAABB0AABB0AABA0AEAIOgAAICgNwdenwoAG4PXpxL0ddXV1aVdu3bxsAMAWEeWZWnXrl3q6upiGBvAcNv0o1OhUNDhw4d169Yt7pEEgDXmuq527dqlX//61+ro6GAgBH19OY6jf//3f9fk5CRRB4A1jPn27dv1D//wDzzLnaBvrCNHjmh4eJioA8AaxPzgwYN67733GAZB3xwnTpzQ6OioqtUqnygB4CE5jqNIJKL9+/frrbfeYiAEfXNdvnxZX3zxhUqlElEHgIeIeSKR0Ntvv629e/cyEILeHCYmJvTZZ59peXmZqAPAA8S8q6tL77//voaGhhgIQW8u5XJZ//3f/62pqSn5/X4GAgD3Ydu2BgcH9cknnygejzMQgt68fv/73+vKlStEHQDuE/NnnnlGH330EcMg6K3h3LlzOnnypBzHYRc8gLbnuq58Pp/efPNNvfTSSwyEoLeWy5cv6+TJkyoWi0QdQFvHPJlM6s0332TzG0FvXbOzs/riiy90584dBQIBBgKgrViWpR07dujtt9/Wli1bGAhBb22lUknnzp3T2bNniTqAtor5K6+8opdeekmJRIKBEHRvsG1bN27c0P/8z/98P0AuwQPwqEYePvzwQz355JNsECbo3jQ7O6s//OEPWl5eJuoAPBnzrq4u/c3f/A2X2Am69+VyOR05ckQTExOybZuwA/BEyP1+v4aGhvTee+8plUoxFILePs6cOaNvv/1WpVKJS1IAWpZt20okEvqrv/orvfbaawyEoLenO3fu6Msvv9SdO3cUDAYZCICWYpqmduzYoddff107duxgIAS9vRWLRZ07d07ffPPN98PlEjyAJtdIwAsvvKCXXnpJyWSSoRB0NH45rly5oqNHj6pWqzEQAE0tHA7r3Xff1TPPPMMihKDjfkqlkv7jP/5Dy8vLchyHgQBoKj6fT11dXfr7v/977i0n6HgQJ0+e1OXLl1UoFHgdK4BN5ziOOjo6tHfvXr355psMhKDjYczMzOjLL7/UrVu3ZBgGl7UAbDjXdeW6rnbt2qXXX39dW7duZSgEHY+iWq1qeHhYX331lUzTZLUOYENX5cFgUK+++qoOHjyoSCTCUAg6HvcTcjab1f/+7/9qdnaW29sArDvTNLVlyxb97ne/Uzqd5gohQcdaGx0d1eeff84gAKyrv/7rv9b+/fsZBEHHelpcXNRnn32m+fl5WZbFJ2cAj811XQUCAfX19en9999XT08PQyHo2Chff/21Lly4oIWFBfn9fsIO4JFCbtu2ent79dxzz+nll19mKAQdm2F+fl6jo6O6dOmSqtUq71sH8MAsy1IkEtG+ffu0f/9+9fX1MRSCjs3+pZydndXp06d169YtBYNBVusAfnJVbpqmdu3apTfeeENbtmxhMUDQ0Wxhv3Tpko4fPy7TNIk6gPvGPBgM6p133tG+ffsIOQh6M1tZWdHhw4c1Pj7O42MBrPL5fNq9e7d+/etfKxaLMRAQ9FZx8+ZNnT59WsvLyzyUBmhTjYfDdHV16Y033tATTzzBUEDQW5FlWRoZGdHly5eVyWR4hCzQJhqPbB0YGNDevXt14MABLq+DoHtBPp/XlStXNDIyouXlZZ42B3iYaZrq6urSgQMH9Mwzz6izs5OhgKB7ieM4KhaLOnv2rEZGRiSJy/CAx37HJenAgQN65ZVXlEwm+R0HQfe6QqGgzz77TLdv3+YSPOABrutq586dev/999XR0cFAQNDbzdjYmE6dOqVcLifLshgI0GICgYBSqZR++ctfas+ePQwEBL3dXb58WcPDw5qfn2dHPNDkGjvX+/r6dPDgQe3du5ehgKDjz6rVqq5evapr165pcnJStm3L7/czGKBJNH4nt2/frqefflq/+MUveEc5CDp+XKlU0uLior777jtdunRJfr+fFTuwySty27a1b98+Pf/88+rp6VEikWAwIOh4MKZpKpvN6tSpUxobG+ONbsAGa7wJbc+ePfrlL3+pdDrNLacg6Hg8k5OTOnbsmLLZLI+TBTaAz+dTOp3Wr371K23fvp2BgKBjbU1PT+v06dNaWFhQrVaT4zis2oE1Wo37fD6Fw2H19vbqjTfe0LZt2xgMCDrW18TEhG7cuKHbt28rm82urigAPJzGFa90Oq2dO3fqySef1NDQEIMBQcfGWlhY0MTEhC5duqSZmRlJ4nnRwANoPPdh69at2rdvn4aGhtTb28tgQNCxuYrForLZrC5cuKBLly6tvnMZwL1M05RhGNq3b5+ee+45pdNpJZNJBgOCjubiOI4KhYK+++47nT9/XpZlcSke+NPvRiAQ0Isvvqjnn39eHR0d/G6AoKN1ViIjIyMaHR1VsViU4zjisEFbnSgNQz6fT8lkUvv379eBAwe4cgWCjtY2NjamixcvamFhQYVCQZZl8W52eE7jHeSBQEAdHR3q7e3Vs88+yzPWQdDhPcvLy7p586ZmZ2c1NTWlfD7Pk+jQ8hpPcuvs7NTg4KC2bNmiJ554Ql1dXQwHBB3eZlmWMpmMZmZmND4+rtu3b6+ubFi1o1VW440rTTt37tTu3bu1detWDQwMcKcHCDra86RYrVa1srKiGzdu6Pz588rn8woGg6za0bSrcdM01dnZqRdffFFPPvmkYrGYIpEIH0ZB0IG7T5Zzc3MaHh7W9evXV2/xAZrhw2cwGNRTTz2lgwcPqr+/nw+dIOjAg55Ax8fHNTIyorm5OVmWJdM0edwsNuTY8/l8CgaDCgQC6u/v14EDB7R7926OPRB04HHUajXdvn1bd+7c0fz8vPL5vMrl8vcHI7vlsQYBb5zS4vG4Ojs71dfXpx07dmjnzp0Kh8MMCQQdWGvlclmZTEbZbFZTU1Oan5/X8vKyJLFjHg+ssTNdkrq6utTX16fBwUGl02kNDAwoHo8zJBB0YKNUKhWVy2Xl8/nVHfMzMzOrO+aJO34Y8cbO9K1bt67uTO/s7FQ8Hlc0GmVIIOjAZrNtW5ZlqV6va3x8XNevX9ft27dl27Z8Ph+X5ttQ41K64zjy+/3auXOnnnrqKe3evVuhUEiBQEB+v59BgaAzBrSCiYkJTU9Pa3x8XHNzczIMY/UkD+9pfHhzXVf9/f3avXu3tm3bxitJAYIOr7l165bu3LmjiYkJ1Wo1maaper0u0zT/fICzkm/6lXdDMBhUKBRSMBhUOBzW0NCQduzYoV27djEogKCjXRSLRS0tLWlhYUFLS0sqlUoqFAoqlUoqlUpyXXf1kiyX7Dcn3I1TjW3bMgxDiURCiURCHR0dSiQS6u7uVm9vr7q7u3kNKUDQge+Zpql8Pq9SqaRcLqdSqaTFxUUVCgUtLy+rUCis7qTne/n1ibfjOKs70Ds6OtTV1aWOjg719PQokUgolUopkUios7OTN5cBBB14MI7jrF6ON01T1WpVmUxGy8vLmp6evifyjVdlNiJP6H863I14u657T7y3bdumrq4uDQwMKBKJKBgMrl5W564FgKADaxqkRuwbUZqbm9PS0pKy2awWFhaUzWZVKBRWA3R33Nsl9HefIu6eWUdHh9LptHp7e5VOp9Xd3b36GNXGh6J2mhNA0IEWkM1mlcvlVCgUlM/nVy/j53K5e1arjR33d39nfPeHhs0O3N1/pvvtKfjh1w+Ny+KpVEqdnZ3q6OhQKpVSOp3moAAIOuAt1WpVtVpNpVJJxWJRtm0rl8vJsixJWv3vjRfU1Gq11fDX6/Wfve3ONM3Vh6j8MM6BQOBHv3/2+/33/DPDMBQMBuX3++W6rtLp9OozzlOplPx+v5LJpBKJhMLhsCKRCD9cgKAD+DH1el2WZcl1XZVKpdXw/5hyuaxarXbfoEciEcVisfuuxEOhkOLxuHw+n1zXlWEYPEENIOgAAKCZsdUUAACCDgAACDoAACDoAACAoAMAQNABAABBBwAABB0AABB0AAAIOgAAIOgAAICgAwAAgg4AAEEHAAAEHQAAEHQAAEDQAQAg6AAAgKADAACCDgAACDoAAAQdAAAQdAAAQNABAABBBwCAoAMAAIIOAAAIOgAAIOgAABB0AABA0AEAAEEHAAAEHQAAgg4AAAg6AADYFP8f0ltvGsujrnsAAAAASUVORK5CYII=") center center no-repeat':""}),w=function(){new WebServiceRobotics(function(n){if(n.oState.Result==window.VTPortalUtils.constants.OK.value){var i=VTPortal.roApp.userCommuniques();if(i!=null&&i.length>0){const t=i.find(t=>t.Communique.Id===n.Status.Communique.Id);t&&(t.EmployeeCommuniqueStatus[0].Read=!0)}t(n)}else DevExpress.ui.notify(i18nextko.t("roCommError"),"warning",3e3),window.VTPortalUtils.utils.setActiveTab("communiques"),VTPortal.app.navigate("communiques",{root:!0})}).getCommuniqueById(n.id)};return{viewShown:b,lblSubject:a,empImage:p,lblCommuniqueDate:v,allowExtraResponse:h,hasDocuments:i,lblMessage:y,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),title:i18nextko.t("rocommuniquesTitle"),subscribeBlock:s(),communique:t,voteOptions:{dataSource:l,visible:f,showTitle:!1,showCancelButton:ko.observable(!0),onItemClick:function(n){moment(t().Status.Communique.ExpirationDate).isAfter(moment())?new WebServiceRobotics(function(n){n.oState.Result==window.VTPortalUtils.constants.OK.value?DevExpress.ui.notify(i18nextko.t("roAnswerCorrect"),"success",3e3):DevExpress.ui.notify(i18nextko.t("roAnswerIncorrect"),"warning",3e3);window.VTPortalUtils.utils.setActiveTab("communiques");VTPortal.app.navigate("communiques",{root:!0})}).answerCommunique(t().Status.Communique.Id,n.itemData.text):DevExpress.ui.notify(i18nextko.t("roExpired"),"warning",3e3)}},checkDocuments:{dataSource:c,visible:e,showTitle:!1,showCancelButton:ko.observable(!0),onItemClick:function(n){new WebServiceRobotics(function(n){window.VTPortalUtils.utils.downloadBytes(n.Value)}).getDocumentBytes(n.itemData.id)}},buttonOptions:{text:o,visible:r,onClick:function(){f(!0)}},buttonMyResponse:{text:u,visible:r},buttonDocuments:{text:i18nextko.t("roCheckDocuments"),visible:i,onClick:function(){e(!0)}},cssBackground:ko.computed(function(){return"backgroundOpacityImp"})}};VTPortal.myChannels=function(){function u(){VTPortal.roApp.db.settings.markForRefresh(["channels","status"]);r().viewShown();f()}function f(){VTPortal.roApp.loggedIn&&(new WebServiceRobotics(function(n){var i,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=n.Value,r=0;r<i.length;r++)i[r].hasAction=!0,i[r].IsComplaintChannel?(i[r].cssClass="dx-channelComplaint",i[r].MessagesInfo=i18nextko.i18n.t("compliantChannelDesc")):(i[r].MessagesInfo=i[r].NewMessages==0?i18nextko.i18n.t("nomessages"):i18nextko.i18n.t("newmessages")+i[r].NewMessages+" "+i18nextko.i18n.t("newmessages2"),i[r].cssClass="dx-channelCommunications");t(i)}else t([]),VTPortalUtils.utils.processErrorMessage(n,function(){})},function(){t([]);VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingChannels"),"error",0,function(){})}).getMyChannels(),new WebServiceRobotics(function(t){t.Status==window.VTPortalUtils.constants.OK.value?t.Value!=null&&t.Value.length>0&&n(i+t.Value):(n(i),VTPortalUtils.utils.processErrorMessage(t,function(){}))},function(){n(i);VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingComplaintChannelUrl"),"error",0,function(){})}).getComplaintChannelUrl())}var r=ko.observable(VTPortal.bigUserInfo()),t=ko.observable([]),n;const i=VTPortal.roApp.serverURL.ssoURL;return n=ko.observable(i),{viewShown:u,title:i18nextko.i18n.t("roMyDailyRecord"),subscribeBlock:r(),loadingPanel:VTPortalUtils.utils.loadingPanelConf(),channelsDS:t,listChannels:{dataSource:t,scrollingEnabled:!1,grouped:!1,itemTemplate:"AlertItem",onItemClick:function(t){t.itemData.IsComplaintChannel?n()!=i&&n().length>0?VTPortal.roApp.openURLonExternalBrowser(n()):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingComplaintChannelUrl"),"error",0,function(){}):VTPortal.app.navigate("channelConversations/"+t.itemData.Id)}}}};VTPortal.conversationMessages=function(n){function c(){u().viewShown();s()}function s(){VTPortal.roApp.loggedIn&&new WebServiceRobotics(function(n){var i,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=n.Value,r=0;r<i.length;r++)i[r].hasAction=!0,i[r].MessagesInfo=i[r].NewMessages==0?i18nextko.i18n.t("nomessages"):i18nextko.i18n.t("newmessages")+i[r].NewMessages+" "+i18nextko.i18n.t("newmessages2"),i[r].cssClass=i[r].IsResponse?"":"employee";t(i);setTimeout(function(){var n=$("#scrollview.conversationMessages").dxScrollView("instance"),t=n.scrollHeight();n.scrollTo(t)},100)}else t([]),VTPortalUtils.utils.processErrorMessage(n,function(){})},function(){t([]);VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingConversations"),"error",0,function(){})}).getMyMessagesByIDConversation(i())}var u=ko.observable(VTPortal.bigUserInfo()),i=ko.observable(-1),f=ko.observable(""),r=ko.observable(!1),e=ko.observable(0),t,o;const h=ko.computed(function(){return e()==0||e()==1});typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&i(parseInt(n.id,10));typeof n.param!="undefined"&&parseInt(n.param,10)!=-1?e(parseInt(n.param,10)):i(-1);t=ko.observable([]);o=function(n){var t=n.validationGroup.validate();t.isValid&&(r(!1),new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.db.settings.markForRefresh(["channels","status"]),f(""),$("#scrollview").find(".pass").each(function(){$(this).dxValidator("instance").reset()}),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNCOKNewMessage"),"success",2500),VTPortal.roApp.redirectAtHome();else{var t=function(){};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t(window.VTPortalUtils.utils.languageTag(n.Status)),"error",0,t)}}).addNewMessage(i(),encodeURIComponent(f())))};var l=function(){r(!0)},a=function(){r(!1)};return{viewShown:c,title:i18nextko.i18n.t("roMyMessages"),subscribeBlock:u(),btnAdd:{onClick:l,text:"",hint:"",icon:"Images/Common/plus.png",visible:h},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),messagesDS:t,messagesContent:{height:"76%",bounceEnabled:!0,onPullDown:function(n){var t=function(n){return function(){n()}};n.component.release()}},listMessages:{dataSource:t,scrollingEnabled:!1,grouped:!1,selectionMode:"none",focusStateEnabled:!1},newMessage:{value:f,placeholder:i18nextko.t("roNCtxtMessage")},lblMessage:i18nextko.t("roNClblMessage"),popupAddNewMessageVisible:r,btnAddNewMessage:{onClick:o,text:i18nextko.t("roNCAddNewMessage")},btnCancel:{onClick:a,text:i18nextko.t("roCancel")},requieredMessage:{validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]}}};VTPortal.channelConversations=function(n){function v(){VTPortal.roApp.db.settings.markForRefresh(["channels","status"]);o().viewShown();y();c()}function y(){VTPortal.roApp.loggedIn&&new WebServiceRobotics(function(n){var i,e;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=n.Value,e=0;e<i.length;e++)i[e].hasAction=!0,i[e].MessagesInfo=i[e].NewMessages==0?i18nextko.i18n.t("nomessages"):i18nextko.i18n.t("newmessages")+i[e].NewMessages+" "+i18nextko.i18n.t("newmessages2"),i[e].cssClass=i[e].IsComplaintChannel?"dx-channelComplaint":"dx-channelCommunications";t(i.find(n=>n.Id==r()));u(f()?1:0)}else t(null),VTPortalUtils.utils.processErrorMessage(n,function(){})},function(){t(null);VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingChannels"),"error",0,function(){})}).getMyChannels()}function c(){VTPortal.roApp.loggedIn&&new WebServiceRobotics(function(n){var t,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(t=n.Value,r=0;r<t.length;r++){t[r].hasAction=!0;t[r].MessagesInfo=t[r].NewMessages==0?i18nextko.i18n.t("nomessages"):i18nextko.i18n.t("newmessages")+t[r].NewMessages+" "+i18nextko.i18n.t("newmessages2");t[r].cssClass="dx-channelMessage";t[r].ConversationDetails=i18nextko.i18n.t("chStatusConversation");switch(t[r].Status){case 0:t[r].cssClass+=" ro_Status_pending";t[r].ConversationDetails+=i18nextko.i18n.t("chStatusPending");break;case 1:t[r].cssClass+=" ro_Status_ongoing";t[r].ConversationDetails+=i18nextko.i18n.t("chStatusOnGoing");break;case 2:t[r].cssClass+=" ro_Status_denied";t[r].ConversationDetails+=i18nextko.i18n.t("chStatusDenied");break;case 3:t[r].cssClass+=" ro_Status_accepted";t[r].ConversationDetails+=i18nextko.i18n.t("chStatusClosed")}t[r].ConversationDetails+=" | Ref.: "+t[r].ReferenceNumber}t.sort(function(n,t){return n.Status<t.Status?-1:n.Status>t.Status?1:n.LastMessageTimestamp>t.LastMessageTimestamp?-1:n.LastMessageTimestamp<t.LastMessageTimestamp?1:0});i(t)}else i([]),VTPortalUtils.utils.processErrorMessage(n,function(){})},function(){i([]);VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingConversations"),"error",0,function(){})}).getMyConversationsByIDChannel(r());u(f()?1:0)}function a(n,t){VTPortal.app.navigate("conversationMessages/"+n+"/"+t)}var o=ko.observable(VTPortal.bigUserInfo()),r=ko.observable(-1),e=ko.observable(!1),s=ko.observable(""),h=ko.observable(""),u=ko.observable(0),i,t,f;typeof n.id!="undefined"&&parseInt(n.id,10)!=-1?r(parseInt(n.id,10)):r(-1);i=ko.observable([]);t=ko.observable(null);f=ko.computed(function(){return t()!=null&&!(typeof t().AllowAnonymous=="undefined")?t().AllowAnonymous:!1});var l=function(){e(!0)},p=function(){e(!1)},w=function(n){var t=n.validationGroup.validate();t.isValid&&(e(!1),new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)s(""),h(""),u(f()?1:0),$("#scrollview").find(".pass").each(function(){$(this).dxValidator("instance").reset()}),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNCOKNewConversation"),"success",2500),a(n.Value.Id,n.Value.Status);else{var t=function(){l(!0)};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t(window.VTPortalUtils.utils.languageTag(n.Status)),"error",0,t)}}).addNewConversation(r(),s(),encodeURIComponent(h()),u()?1:0))};const k=[{title:i18nextko.t("roNCsbAnonymous"),name:"anonymous",value:1},{title:i18nextko.t("roNCsbNotAnonymous"),name:"open",value:0}];return{viewShown:v,title:i18nextko.i18n.t("roMyConversations"),subscribeBlock:o(),btnAdd:{onClick:l,text:"",hint:"",icon:"Images/Common/plus.png"},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),conversationsDS:i,conversationsContent:{height:"76%",bounceEnabled:!1,onPullDown:function(n){var t=function(n){return function(){n()}};n.component.release()}},listConversations:{dataSource:i,scrollingEnabled:!1,grouped:!1,itemTemplate:"AlertItem",onItemClick:function(n){a(n.itemData.Id,n.itemData.Status)}},txtTitle:{placeholder:i18nextko.t("roNCtxtTitle"),value:s},txtMessage:{placeholder:i18nextko.t("roNCtxtMessage"),value:h},sbAnonymous:{text:i18nextko.t("roNCsbAnonymous"),value:u},showAnonymous:f,btnCancel:{onClick:p,text:i18nextko.t("roCancel")},lblTitle:i18nextko.t("roNClblTitle"),lblMessage:i18nextko.t("roNClblMessage"),lblAnonymous:i18nextko.t("roNClblAnonymous"),popupAddNewConversationVisible:e,requieredTitle:{validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]},requieredMessage:{validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]},requieredAnonymous:{validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]},btnAddNewConversation:{onClick:w,text:i18nextko.t("roNCAddNewConversation")}}};VTPortal.addMessage=function(){function t(){}function i(){VTPortal.roApp.db.settings.markForRefresh(["channels","status"]);n().viewShown()}var n=ko.observable(VTPortal.bigUserInfo());return{viewShown:i,title:i18nextko.i18n.t("roMyDailyRecord"),subscribeBlock:n(),btnSave:{onClick:t,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png"},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.taskSelector=function(n){var t=ko.observable(!1),f=ko.observable(""),r=VTPortal.taskFieldsInput(),e=ko.observable(VTPortal.bigUserInfo()),o=function(){e().viewShown()},s=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)u(new DevExpress.data.DataSource({store:n.SelectFields,searchOperation:"contains",searchExpr:["FieldName","RelatedInfo"]}));else switch(n.Status){case-10:u(new DevExpress.data.DataSource({store:n.SelectFields,searchOperation:"contains",searchExpr:["FieldName","RelatedInfo"]}));VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("lblTaskNotFound"),"warning",5e3);break;case-20:VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("lblTaskTooMany"),"warning",5e3)}}).getTasksByName(f())},i=ko.observable(""),u=ko.observable(new DevExpress.data.DataSource({store:[],searchOperation:"contains",searchExpr:["FieldName","RelatedInfo"]})),h=function(t){c(n.id,t)},c=function(n,u){curTaskInfo={action:n,info:u};new WebServiceRobotics(function(f){var c,h,e,s,o,l;if(f.Status==window.VTPortalUtils.constants.OK.value){for(VTPortal.roApp.taskPunchRequest().newAction=n,VTPortal.roApp.taskPunchRequest().newTaskUserFieldsDefinition=f.Fields,c=!1,h=0;h<f.Fields.length;h++)f.Fields[h].Used&&(c=!0);c?(r.initTaskProperties(!1),t(!0)):(e=u.itemData.FieldName,u.itemData.FieldValue.toNumber()==0&&(e=e.replaceAll("(","").replaceAll(")","")),e.indexOf(":")==0&&(e=e.substring(1)),s=VTPortal.roApp.userStatus().TaskTitle,s.indexOf(":")==0&&(s=s.substring(1)),o=i18nextko.i18n.t("roTask_ChangeConfirm"),o=o.replace("{{initialTask}}",s),o=o.replace("{{taskName}}",e),VTPortalUtils.utils.questionMessage(o,"info",0,function(){switch(n){case"TCH":window.VTPortalUtils.utils.doPunch("task",{idTask:VTPortal.roApp.userStatus().TaskId,idNewTask:u.itemData.FieldValue.toNumber(),oldValues:VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue,newValues:VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue,complete:!1,tcType:i()});break;case"TCO":window.VTPortalUtils.utils.doPunch("task",{idTask:VTPortal.roApp.userStatus().TaskId,idNewTask:u.itemData.FieldValue.toNumber(),oldValues:VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue,newValues:VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue,complete:!0,tcType:i()})}},function(){}))}else l=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingTaskInfo"),"error",0,l)}).getTaskUserFieldsAction(VTPortalUtils.taskAction.begin,u.itemData.FieldValue.toNumber())},l=function(){var n,f,u;t(!1);r.savePunchInfo();n=curTaskInfo.info.itemData.FieldName;curTaskInfo.info.itemData.FieldValue.toNumber()==0&&(n=n.replaceAll("(","").replaceAll(")",""));n.indexOf(":")==0&&(n=n.substring(1));f=VTPortal.roApp.userStatus().TaskTitle;f.indexOf(":")==0&&(f=f.substring(1));u=i18nextko.i18n.t("roTask_ChangeConfirm");u=u.replace("{{initialTask}}",f);u=u.replace("{{taskName}}",n);VTPortalUtils.utils.questionMessage(u,"info",0,function(){switch(curTaskInfo.action){case"TCH":window.VTPortalUtils.utils.doPunch("task",{idTask:VTPortal.roApp.userStatus().TaskId,idNewTask:curTaskInfo.info.itemData.FieldValue.toNumber(),oldValues:VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue,newValues:VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue,complete:!1,tcType:i()});break;case"TCO":window.VTPortalUtils.utils.doPunch("task",{idTask:VTPortal.roApp.userStatus().TaskId,idNewTask:curTaskInfo.info.itemData.FieldValue.toNumber(),oldValues:VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue,newValues:VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue,complete:!0,tcType:i()})}},function(){})};return{viewShown:o,title:i18nextko.t("roSearchTask"),subscribeBlock:e(),listOptions:{dataSource:u,height:"70%",itemTemplate:"item",noDataText:"",onItemClick:h},searchOptions:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(n){f(n.value)}},btnAcceptText:{onClick:function(){s()},text:i18nextko.t("roSearchTask")},taskFieldsVisible:t,taskFieldsBlock:r,btnCancelTaskFields:{onClick:function(){t(!1)},text:i18nextko.t("roCancelCaptcha")},btnAcceptUserFields:{onClick:function(){l()},text:i18nextko.t("roContinue")}}};VTPortal.sendDocument=function(n){function g(){v().viewShown();VTPortal.roApp.isTimeGate()?o(!1):o(!0);p(null);d()}function nt(){var i,n,o;VTPortal.roApp.isModeApp()==!1?(i=a(),n=new FormData,n.append("idTemplateDocument",t()!=-1?t():s()),n.append("idRelatedObject",r()),n.append("remarks",u()),n.append("docRelatedInfo",""),n.append("forecastType",e()),n.append("userfile",i[0]),new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDocumentSaved"),"success",2e3),VTPortal.roApp.loadInitialData(!1,!1,!1,!1,!1);else{var t=function(){};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorUploadingFile"),"error",0,n)}).uploadDocumentDesktop(n)):(n=new FormData,n.append("idTemplateDocument",t()!=-1?t():s()),n.append("userfile",f()),n.append("idRelatedObject",r()),o="",new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDocumentSaved"),"success",2e3),VTPortal.roApp.redirectAtHome(),VTPortal.roApp.loadInitialData(!1,!1,!1,!1,!1);else{var t=function(){};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorUploadingFile"),"error",0,n)}).uploadDocumentMobile(n,e(),u(),o));VTPortal.roApp.db.settings.markForRefresh(["notifications"])}function tt(){if(VTPortalUtils.utils.isShowingPopup(!1),Object.has(navigator,"camera")){var n=function(){navigator.camera.getPicture(function(n){f(n);typeof device!="undefined"?cordova.platformId==="ios"?i(window.WkWebView.convertFilePath(n)):i(n):i(n)},function(n){n.includes("cancelled")||VTPortalUtils.utils.notifyMesage(n,"error",2e3)},{quality:75,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,targetWidth:960,targetHeight:1280,saveToPhotoAlbum:!1,correctOrientation:!0})},t=function(){navigator.camera.getPicture(function(n){f(n);typeof device!="undefined"?cordova.platformId==="ios"?i(window.WkWebView.convertFilePath(n)):i(n):i(n)},function(n){n.includes("cancelled")||VTPortalUtils.utils.notifyMesage(n,"error",2e3)},{quality:75,sourceType:Camera.PictureSourceType.CAMERA,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,targetWidth:960,targetHeight:1280,saveToPhotoAlbum:!1,correctOrientation:!0})};VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roSelectOrigin"),"info",0,n,t,i18nextko.i18n.t("roTakeFromLibrary"),i18nextko.i18n.t("roTakeFromCamera"))}else VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoCameraAvailable"),"error",0)}var t=ko.observable(-1),r=ko.observable(-1),u=ko.observable(""),p=ko.observable(null),f=ko.observable(""),e=ko.observable(""),w=ko.computed(function(){return!0}),b=ko.computed(function(){return t()==-1?i18nextko.i18n.t("roRequestDocumentType"):i18nextko.i18n.t("roRequestSelectFile")}),o=ko.observable(!1),l=ko.observable(i18nextko.i18n.t("roFindFile")),a=ko.observableArray(),i=ko.observable(""),c,y;typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));typeof n.param!="undefined"&&parseInt(n.param,10)!=-1&&r(parseInt(n.param,10));typeof n.iDate!="undefined"&&parseInt(n.iDate,10)!=-1&&relatedCause(parseInt(n.iDate,10));typeof n.objId!="undefined"&&n.objId!=""&&e(n.objId);var s=ko.observable(t()),h=ko.observable([]),k=ko.computed(function(){return"76%"}),d=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)h(n.SelectFields),t()!=-1&&c({value:t()+""});else{var i=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,i)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingCauseInfo"),"error",0,n)}).getAvailableDocumentTemplateType(VTPortal.roApp.employeeId,!1)},v=ko.observable(VTPortal.bigUserInfo());return c=function(n){var t=n.value,i=null;$.grep(h(),function(n){n.FieldValue==t&&(i=n)})},y={viewShown:g,title:i18nextko.t("roRequestType_SendDocument"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:b,lblImageCapture:i18nextko.t("roTakePhoto"),lblSelectFile:i18nextko.t("roSelectFile"),lblDocDate:i18nextko.t("roRequestDocRelatedDate"),subscribeBlock:v(),scrollContent:{height:k},btnSave:{onClick:nt,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:o},remarks:{value:u},cmbDocumentType:{dataSource:h,displayExpr:"FieldName",valueExpr:"FieldValue",value:s,visible:w,onValueChanged:c},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),selectPhotoEvent:tt,imageSrc:i,appMode:VTPortal.roApp.isModeApp(),uploadOptions:{multiple:!1,accept:"*",value:a,uploadMode:"useForm",showFileList:!1,selectButtonText:l,onValueChanged:function(n){l(n.value[0].name)}},isTimeGate:VTPortal.roApp.isTimeGate(),lblTimegateRestricted:i18nextko.t("roRestrictedTGfunctionallity")},y};VTPortal.SelectListObject=function(n){var i=ko.observable(!1),u=VTPortal.taskFieldsInput(),f=ko.observable(VTPortal.bigUserInfo()),e=ko.observable(n.id),o=function(){f().viewShown();new WebServiceRobotics(function(n){n.Status==window.VTPortalUtils.constants.OK.value&&r(new DevExpress.data.DataSource({store:n.SelectFields,searchOperation:"contains",searchExpr:["FieldName","RelatedInfo"]}))}).getGenericList(n.id)},s=n.id.replaceAll(".",""),t=ko.observable("");typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(n.iDate);var r=ko.observable(new DevExpress.data.DataSource({store:[],searchOperation:"contains",searchExpr:["FieldName","RelatedInfo"]})),h=function(i){VTPortal.roApp.SelectedCause(i.itemData.FieldValue.toNumber());switch(n.param){case"TCH":case"TCO":c(n.param,i);break;case"C":window.VTPortalUtils.utils.doPunch("cc",{idCenter:i.itemData.FieldValue.toNumber(),tcType:t()})}},c=function(n,r){curTaskInfo={action:n,info:r};new WebServiceRobotics(function(f){var c,h,e,s,o,l;if(f.Status==window.VTPortalUtils.constants.OK.value){for(VTPortal.roApp.taskPunchRequest().newAction=n,VTPortal.roApp.taskPunchRequest().newTaskUserFieldsDefinition=f.Fields,c=!1,h=0;h<f.Fields.length;h++)f.Fields[h].Used&&(c=!0);c?(u.initTaskProperties(!1),i(!0)):(e=r.itemData.FieldName,r.itemData.FieldValue.toNumber()==0&&(e=e.replaceAll("(","").replaceAll(")","")),e.indexOf(":")==0&&(e=e.substring(1)),s=VTPortal.roApp.userStatus().TaskTitle,s.indexOf(":")==0&&(s=s.substring(1)),o=i18nextko.i18n.t("roTask_ChangeConfirm"),o=o.replace("{{initialTask}}",s),o=o.replace("{{taskName}}",e),VTPortalUtils.utils.questionMessage(o,"info",0,function(){switch(n){case"TCH":window.VTPortalUtils.utils.doPunch("task",{idTask:VTPortal.roApp.userStatus().TaskId,idNewTask:r.itemData.FieldValue.toNumber(),oldValues:VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue,newValues:VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue,complete:!1,tcType:t()});break;case"TCO":window.VTPortalUtils.utils.doPunch("task",{idTask:VTPortal.roApp.userStatus().TaskId,idNewTask:r.itemData.FieldValue.toNumber(),oldValues:VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue,newValues:VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue,complete:!0,tcType:t()})}},function(){}))}else l=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingTaskInfo"),"error",0,l)}).getTaskUserFieldsAction(VTPortalUtils.taskAction.begin,r.itemData.FieldValue.toNumber())},l=function(){var n,f,r;i(!1);u.savePunchInfo();n=curTaskInfo.info.itemName;curTaskInfo.info.itemData.toNumber()==0&&(n=n.replaceAll("(","").replaceAll(")",""));n.indexOf(":")==0&&(n=n.substring(1));f=VTPortal.roApp.userStatus().TaskTitle;f.indexOf(":")==0&&(f=f.substring(1));r=i18nextko.i18n.t("roTask_ChangeConfirm");r=r.replace("{{initialTask}}",f);r=r.replace("{{taskName}}",n);VTPortalUtils.utils.questionMessage(r,"info",0,function(){switch(curTaskInfo.action){case"TCH":window.VTPortalUtils.utils.doPunch("task",{idTask:VTPortal.roApp.userStatus().TaskId,idNewTask:curTaskInfo.info.itemData.FieldValue.toNumber(),oldValues:VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue,newValues:VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue,complete:!1,tcType:t()});break;case"TCO":window.VTPortalUtils.utils.doPunch("task",{idTask:VTPortal.roApp.userStatus().TaskId,idNewTask:curTaskInfo.info.itemData.FieldValue.toNumber(),oldValues:VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue,newValues:VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue,complete:!0,tcType:t()})}},function(){})};return{viewShown:o,title:i18nextko.t(s),subscribeBlock:f(),isTaskL:e,listOptions:{dataSource:r,height:"70%",itemTemplate:"item",onItemClick:h},searchOptions:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(n){r().searchValue(n.value);r().load()}},taskFieldsVisible:i,taskFieldsBlock:u,btnCancelTaskFields:{onClick:function(){i(!1)},text:i18nextko.t("roCancelCaptcha")},btnAcceptUserFields:{onClick:function(){l()},text:i18nextko.t("roContinue")}}};VTPortal.RequestFilters=function(n){function d(){var n;y().viewShown();t==0?VTPortal.roApp.requestFilters()!=null?(n=VTPortal.roApp.requestFilters(),h(n.order.direction),c(n.order.by),u(n.filter.iDate),f(n.filter.eDate),e(n.filter.iRequestedDate),o(n.filter.eRequestedDate),r(n.filter.types),s(n.filter.status)):(r([1,5,6,7,11,13]),s([0,1,2,3,4]),h("DESC"),c("RequestDate"),u(moment().startOf("year").toDate()),f(moment().endOf("year").toDate()),e(moment().startOf("year").toDate()),o(moment().endOf("year").toDate())):t==1?VTPortal.roApp.teleWorkingFilters()!=null?(n=VTPortal.roApp.teleWorkingFilters(),h(n.order.direction),c(n.order.by),u(n.filter.iDate),f(n.filter.eDate),e(n.filter.iRequestedDate),o(n.filter.eRequestedDate),r(n.filter.types),s(n.filter.status)):(r([4,16]),s([0,1,2,3,4]),h("DESC"),c("RequestDate"),u(moment().startOf("year").toDate()),f(moment().endOf("year").toDate()),e(moment().startOf("year").toDate()),o(moment().endOf("year").toDate())):t==2?VTPortal.roApp.punchesFilters()!=null?(n=VTPortal.roApp.punchesFilters(),h(n.order.direction),c(n.order.by),u(n.filter.iDate),f(n.filter.eDate),e(n.filter.iRequestedDate),o(n.filter.eRequestedDate),r(n.filter.types),s(n.filter.status)):(r([2,3,10,12]),s([0,1,2,3,4]),h("DESC"),c("RequestDate"),u(moment().startOf("year").toDate()),f(moment().endOf("year").toDate()),e(moment().startOf("year").toDate()),o(moment().endOf("year").toDate())):t==3?VTPortal.roApp.authorizationFilters()!=null?(n=VTPortal.roApp.authorizationFilters(),h(n.order.direction),c(n.order.by),u(n.filter.iDate),f(n.filter.eDate),e(n.filter.iRequestedDate),o(n.filter.eRequestedDate),r(n.filter.types),s(n.filter.status)):(r([9,14]),s([0,1,2,3,4]),h("DESC"),c("RequestDate"),u(moment().startOf("year").toDate()),f(moment().endOf("year").toDate()),e(moment().startOf("year").toDate()),o(moment().endOf("year").toDate())):t==4?VTPortal.roApp.supervisorFilters()!=null?(n=VTPortal.roApp.supervisorFilters(),h(n.order.direction),c(n.order.by),u(n.filter.iDate),f(n.filter.eDate),e(n.filter.iRequestedDate),o(n.filter.eRequestedDate),r(n.filter.types),s(n.filter.status)):(r([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),s([0,1]),h("DESC"),c("RequestDate"),u(moment().startOf("year").toDate()),f(moment().endOf("year").toDate()),e(moment().startOf("year").toDate()),o(moment().endOf("year").toDate())):t==5&&(VTPortal.roApp.supervisorFiltersDR()!=null?(n=VTPortal.roApp.supervisorFiltersDR(),h(n.order.direction),c(n.order.by),u(n.filter.iDate),f(n.filter.eDate),e(n.filter.iRequestedDate),o(n.filter.eRequestedDate),r(n.filter.types),s(n.filter.status)):(r([17]),s([0,1]),h("DESC"),c("RequestDate"),u(moment().startOf("year").toDate()),f(moment().endOf("year").toDate()),e(moment().startOf("year").toDate()),o(moment().endOf("year").toDate())))}function g(){var n={order:{direction:h(),by:c()},filter:{iDate:u(),eDate:f(),iRequestedDate:e(),eRequestedDate:o(),types:r(),status:s()}};t==0?(VTPortal.roApp.requestFilters(n),VTPortal.roApp.db.settings.requestFilters=JSON.stringify(n).encodeBase64(),VTPortal.roApp.db.settings.saveParameter("requestFilters")):t==1?(VTPortal.roApp.teleWorkingFilters(n),VTPortal.roApp.db.settings.teleWorkingFilters=JSON.stringify(n).encodeBase64(),VTPortal.roApp.db.settings.saveParameter("teleWorkingFilters")):t==2?(VTPortal.roApp.punchesFilters(n),VTPortal.roApp.db.settings.punchesFilters=JSON.stringify(n).encodeBase64(),VTPortal.roApp.db.settings.saveParameter("punchesFilters")):t==3?(VTPortal.roApp.authorizationFilters(n),VTPortal.roApp.db.settings.authorizationFilters=JSON.stringify(n).encodeBase64(),VTPortal.roApp.db.settings.saveParameter("authorizationFilters")):t==4?(VTPortal.roApp.supervisorFilters(n),VTPortal.roApp.db.settings.supervisorFilters=JSON.stringify(n).encodeBase64(),VTPortal.roApp.db.settings.saveParameter("supervisorFilters")):t==5&&(VTPortal.roApp.supervisorFiltersDR(n),VTPortal.roApp.db.settings.supervisorFiltersDR=JSON.stringify(n).encodeBase64(),VTPortal.roApp.db.settings.saveParameter("supervisorFiltersDR"));t==0?VTPortal.app.navigate("scheduler/4/"+moment().format("YYYY-MM-DD"),{target:"back"}):t==1?VTPortal.app.navigate("teleworking/3/"+moment().format("YYYY-MM-DD"),{target:"back"}):t==2?VTPortal.app.navigate("punchManagement/2/"+moment().format("YYYY-MM-DD"),{target:"back"}):t==3?VTPortal.app.navigate("scheduler/3/"+moment().format("YYYY-MM-DD"),{target:"back"}):t==4?VTPortal.app.navigate("myTeamRequests",{target:"back"}):t==5&&VTPortal.app.navigate("myTeamDailyRecords",{target:"back"})}function nt(){t==0?(VTPortal.roApp.requestFilters(null),VTPortal.roApp.db.settings.requestFilters="",VTPortal.roApp.db.settings.saveParameter("requestFilters")):t==1?(VTPortal.roApp.teleWorkingFilters(null),VTPortal.roApp.db.settings.teleWorkingFilters="",VTPortal.roApp.db.settings.saveParameter("teleWorkingFilters")):t==2?(VTPortal.roApp.punchesFilters(null),VTPortal.roApp.db.settings.punchesFilters="",VTPortal.roApp.db.settings.saveParameter("punchesFilters")):t==3?(VTPortal.roApp.authorizationFilters(null),VTPortal.roApp.db.settings.authorizationFilters="",VTPortal.roApp.db.settings.saveParameter("authorizationFilters")):t==4?(VTPortal.roApp.supervisorFilters(null),VTPortal.roApp.db.settings.supervisorFilters="",VTPortal.roApp.db.settings.saveParameter("supervisorFilters")):t==5&&(VTPortal.roApp.supervisorFiltersDR(null),VTPortal.roApp.db.settings.supervisorFiltersDR="",VTPortal.roApp.db.settings.saveParameter("supervisorFiltersDR"));t==0?VTPortal.app.navigate("scheduler/4/"+moment().format("YYYY-MM-DD"),{target:"back"}):t==1?VTPortal.app.navigate("teleworking/3/"+moment().format("YYYY-MM-DD"),{target:"back"}):t==2?VTPortal.app.navigate("punchManagement/2/"+moment().format("YYYY-MM-DD"),{target:"back"}):t==3?VTPortal.app.navigate("scheduler/3/"+moment().format("YYYY-MM-DD"),{target:"back"}):t==4?VTPortal.app.navigate("myTeamRequests",{target:"back"}):t==5&&VTPortal.app.navigate("myTeamDailyRecords",{target:"back"})}var u=ko.observable(moment().startOf("year").toDate()),f=ko.observable(moment().endOf("year").toDate()),e=ko.observable(moment().startOf("year").toDate()),o=ko.observable(moment().endOf("year").toDate()),w=ko.observable(0),r=ko.observable([1,2,3,4,5,6,7,9,10,11,12,13,14,15,16,17]),s=ko.observable([0,1,2,3,4]),h=ko.observable("DESC"),c=ko.observable("RequestDate"),y=ko.observable(VTPortal.bigUserInfo()),t=parseInt(n.id,10),a,p,i,v,l;if(t==0?r([1,5,6,7,11,12,13]):t==1?r([4,15]):t==2?r([2,3,10,12]):t==3?r([9,14]):t==4?r([1,2,3,4,5,6,7,9,10,11,12,13,14,15,16]):t==5&&r([17]),a=[],a.push({ID:1,cssClass:"dx-icon-filterParams"}),a.push({ID:2,cssClass:"dx-icon-orderParams"}),p=[{ID:0,Name:i18nextko.t("roRequestPendingStatus"),ImageSrc:"Images/Common/request_pending.png"},{ID:1,Name:i18nextko.t("roRequestOnGoingStatus"),ImageSrc:"Images/Common/request_ongoing.png"},{ID:2,Name:i18nextko.t("roRequestApprovedStatus"),ImageSrc:"Images/Common/request_approve.png"},{ID:3,Name:i18nextko.t("roRequestDeniedStatus"),ImageSrc:"Images/Common/request_denied.png"},{ID:4,Name:i18nextko.t("roRequestCanceledStatus"),ImageSrc:"Images/Common/request_denied.png"}],t==4&&(p=[{ID:0,Name:i18nextko.t("roRequestPendingStatus"),ImageSrc:"Images/Common/request_pending.png"},{ID:1,Name:i18nextko.t("roRequestOnGoingStatus"),ImageSrc:"Images/Common/request_ongoing.png"}]),i=[],v=VTPortal.roApp.empPermissions().Requests,t!=4){for(l=0;l<v.length;l++)if(v[l].Permission)switch(v[l].RequestType){case 1:t==0&&i.push({ID:1,Name:i18nextko.i18n.t("roRequestType_UserFieldsChange"),ImageSrc:"Images/Requests/ico_UserFieldChange.png"});break;case 2:t==2&&i.push({ID:2,Name:i18nextko.i18n.t("roRequestType_ForbiddenPunch"),ImageSrc:"Images/Requests/ico_ForbiddenPunch.png"});break;case 3:t==2&&i.push({ID:3,Name:i18nextko.i18n.t("roRequestType_JustifyPunch"),ImageSrc:"Images/Requests/ico_JustifyPunch.png"});break;case 4:t==1&&i.push({ID:4,Name:i18nextko.i18n.t("roRequestType_ExternalWorkResumePart"),ImageSrc:"Images/Requests/ico_ExternalWorkResume.png"});break;case 5:t==0&&i.push({ID:5,Name:i18nextko.i18n.t("roRequestType_ChangeShift"),ImageSrc:"Images/Requests/ico_ChangeShift.png"});break;case 6:t==0&&i.push({ID:6,Name:i18nextko.i18n.t("roRequestType_VacationsOrPermissions"),ImageSrc:"Images/Requests/ico_Holidays.png"});break;case 7:t==0&&i.push({ID:7,Name:i18nextko.i18n.t("roRequestType_PlannedAbsences"),ImageSrc:"Images/Requests/ico_PlannedAbsences.png"});break;case 8:t==0&&i.push({ID:8,Name:i18nextko.i18n.t("roRequestType_ShiftExchange"),ImageSrc:"Images/Requests/ico_ShiftExchange.png"});break;case 9:t==3&&i.push({ID:9,Name:i18nextko.i18n.t("roRequestType_PlannedCauses"),ImageSrc:"Images/Requests/ico_PlannedCauses.png"});break;case 10:t==2&&i.push({ID:10,Name:i18nextko.i18n.t("roRequestType_ForbiddenTaskPunch"),ImageSrc:"Images/Requests/ico_ForbiddenTaskPunch.png"});break;case 11:t==0&&i.push({ID:11,Name:i18nextko.i18n.t("roRequestType_CancelHolidays"),ImageSrc:"Images/Requests/ico_HolidaysCancel.png"});break;case 12:t==2&&i.push({ID:12,Name:i18nextko.i18n.t("roRequestType_ForgottenCostCenterPunch"),ImageSrc:"Images/Requests/ico_ForbiddenCostPunch.png"});break;case 13:t==0&&i.push({ID:13,Name:i18nextko.i18n.t("roRequestType_PlannedHoliday"),ImageSrc:"Images/Requests/ico_PlannedHoliday.png"});break;case 14:t==3&&i.push({ID:14,Name:i18nextko.i18n.t("roRequestType_PlannedOvertime"),ImageSrc:"Images/Requests/ico_PlannedOvertime.png"});break;case 15:t==1&&i.push({ID:15,Name:i18nextko.i18n.t("roRequestType_ExternalWorkWeekResume"),ImageSrc:"Images/Requests/ico_ExternalWorkWeekResume.png"});break;case 16:t==1&&i.push({ID:16,Name:i18nextko.i18n.t("roRequestType_Telecommute"),ImageSrc:"Images/Requests/ico_telecommute.png"});break;case 17:t==5&&i.push({ID:17,Name:i18nextko.i18n.t("roRequestType_DailyRecord"),ImageSrc:"Images/Requests/ico_ExternalWorkWeekResume.png"})}}else i.push({ID:1,Name:i18nextko.i18n.t("roRequestType_UserFieldsChange"),ImageSrc:"Images/Requests/ico_UserFieldChange.png"}),i.push({ID:2,Name:i18nextko.i18n.t("roRequestType_ForbiddenPunch"),ImageSrc:"Images/Requests/ico_ForbiddenPunch.png"}),i.push({ID:3,Name:i18nextko.i18n.t("roRequestType_JustifyPunch"),ImageSrc:"Images/Requests/ico_JustifyPunch.png"}),i.push({ID:4,Name:i18nextko.i18n.t("roRequestType_ExternalWorkResumePart"),ImageSrc:"Images/Requests/ico_ExternalWorkResume.png"}),i.push({ID:5,Name:i18nextko.i18n.t("roRequestType_ChangeShift"),ImageSrc:"Images/Requests/ico_ChangeShift.png"}),i.push({ID:6,Name:i18nextko.i18n.t("roRequestType_VacationsOrPermissions"),ImageSrc:"Images/Requests/ico_Holidays.png"}),i.push({ID:7,Name:i18nextko.i18n.t("roRequestType_PlannedAbsences"),ImageSrc:"Images/Requests/ico_PlannedAbsences.png"}),i.push({ID:8,Name:i18nextko.i18n.t("roRequestType_ShiftExchange"),ImageSrc:"Images/Requests/ico_ShiftExchange.png"}),i.push({ID:9,Name:i18nextko.i18n.t("roRequestType_PlannedCauses"),ImageSrc:"Images/Requests/ico_PlannedCauses.png"}),i.push({ID:10,Name:i18nextko.i18n.t("roRequestType_ForbiddenTaskPunch"),ImageSrc:"Images/Requests/ico_ForbiddenTaskPunch.png"}),i.push({ID:11,Name:i18nextko.i18n.t("roRequestType_CancelHolidays"),ImageSrc:"Images/Requests/ico_HolidaysCancel.png"}),i.push({ID:12,Name:i18nextko.i18n.t("roRequestType_ForgottenCostCenterPunch"),ImageSrc:"Images/Requests/ico_ForbiddenCostPunch.png"}),i.push({ID:13,Name:i18nextko.i18n.t("roRequestType_PlannedHoliday"),ImageSrc:"Images/Requests/ico_PlannedHoliday.png"}),i.push({ID:14,Name:i18nextko.i18n.t("roRequestType_PlannedOvertime"),ImageSrc:"Images/Requests/ico_PlannedOvertime.png"}),i.push({ID:15,Name:i18nextko.i18n.t("roRequestType_ExternalWorkWeekResume"),ImageSrc:"Images/Requests/ico_ExternalWorkWeekResume.png"}),i.push({ID:16,Name:i18nextko.i18n.t("roRequestType_Telecommute"),ImageSrc:"Images/Requests/ico_telecommute.png"});i=i.sortBy(function(n){return n.Name});var b=[{id:"ASC",name:i18nextko.t("roOrderDirectionASC")},{id:"DESC",name:i18nextko.t("roOrderDirectionDESC")}],k=[{id:"RequestType",name:i18nextko.t("roOrderBy_field1")},{id:"RequestDate",name:i18nextko.t("roOrderBy_field2")},{id:"Status",name:i18nextko.t("roOrderBy_field3")},{id:"Date1",name:i18nextko.t("roOrderBy_field4")}],y=ko.observable(VTPortal.bigUserInfo());return{viewShown:d,title:i18nextko.t("roRequestFilterTitle"),subscribeBlock:y(),lblInitialDate:i18nextko.t("roRequestInitialDateLbl"),lblEndDate:i18nextko.t("roRequestEndDateLbl"),lblInitialRequestedDate:i18nextko.t("roRequestInitialRequestedDateLbl"),lblEndRequestedDate:i18nextko.t("roRequestEndRequestedDateLbl"),lblStatus:i18nextko.t("roRequestStatusLbl"),lblType:i18nextko.t("roRequestTypeLbl"),lblOrderBy:i18nextko.t("roRequestOrderBy"),lblOrderDirection:i18nextko.t("roRequestOrderDirection"),subscribeBlock:y(),workingMode:t,beginDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:u,showClearButton:!0,valueChangeEvent:"focusout"},endDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:f,showClearButton:!0,valueChangeEvent:"focusout"},statusTagBox:{items:p,showSelectionControls:!0,applyValueMode:"instantly",displayExpr:"Name",valueExpr:"ID",itemTemplate:"statusItem",value:s},typeTagBox:{items:i,showSelectionControls:!0,applyValueMode:"instantly",displayExpr:"Name",valueExpr:"ID",itemTemplate:"typeItem",value:r},beginRequestedDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:e,showClearButton:!0,valueChangeEvent:"focusout"},endRequestedDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:o,showClearButton:!0,valueChangeEvent:"focusout"},btnAccept:{onClick:g,text:i18nextko.t("closeConfig")},btnRemoveFilter:{onClick:nt,text:i18nextko.t("roRemoveFilter")},selectedTab:w,tabPanelOptions:{dataSource:a,selectedIndex:w,itemTemplate:"title"},orderDirection:{items:b,displayExpr:"name",valueExpr:"id",value:h},orderFields:{items:k,displayExpr:"name",valueExpr:"id",value:c}}};VTPortal.punchInfo=function(){var h=ko.observable(!1),i=ko.observable(""),f=ko.observable(-1),c=null,l=null,u=ko.observable("NoCause"),n=ko.observable("E"),y=ko.computed(function(){var n=[];return n.push({text:i18nextko.i18n.t("roOffice"),type:"success",cssClassText:"textPunchOption",ImageSrc:"Images/icons8-office-48.png"}),n.push({text:i18nextko.i18n.t("roHome"),type:"success",cssClassText:"textPunchOption",ImageSrc:"Images/icons8-home-48.png"}),n}),r=ko.observable(!1),p=function(t,i){l=t;c=i;f(-1);u("NoCause");n("E");r(!1);VTPortal.roApp.SelectedZone(-1);VTPortal.roApp.ReliableZone(!0)},w=function(n){VTPortal.roApp.popupZoneVisible(!1);VTPortal.roApp.ZoneSelected(!0);VTPortal.roApp.SelectedZone(n.itemData.Id);VTPortal.roApp.ReliableZone(!1);t()},b=function(n){r(!1);VTPortal.roApp.popupCauseVisible(!1);f(n.itemData.ID);t()},v=function(n){if(VTPortal.roApp.ZoneSelected())typeof n!="undefined"&&n();else if(VTPortal.roApp.empPermissions().MustUseGPS){a(!0);var t=function(n,t){return function(){n(!1);typeof t!="undefined"&&t!=null&&t()}};VTPortalUtils.utils.reloadLocation(t(a,n))}else a(!1),typeof n!="undefined"&&n()},k=function(n,t){window.VTPortalUtils.utils.doPunch("ta",n,t)},d=function(i){if(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.NewRequests)switch(i){case 0:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):(n("E"),u("NoCause"),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Telecommuting&&VTPortal.roApp.userTelecommute()!=null&&VTPortal.roApp.userTelecommute().Telecommuting?o():s());break;case 1:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):(n("S"),e());break;case 2:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):(n("E"),u("Cause"),r(!0),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Telecommuting&&VTPortal.roApp.userTelecommute()!=null&&VTPortal.roApp.userTelecommute().Telecommuting?o():s());break;case 3:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):(r(!0),n("S"),t())}else switch(i){case 0:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):(n("E"),u("NoCause"),r(!1),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Telecommuting&&VTPortal.roApp.userTelecommute()!=null&&VTPortal.roApp.userTelecommute().Telecommuting?o():t());break;case 1:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):(n("S"),u("NoCause"),r(!1),t());break;case 2:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):(n("E"),u("Cause"),r(!0),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Telecommuting&&VTPortal.roApp.userTelecommute()!=null&&VTPortal.roApp.userTelecommute().Telecommuting?o():t());break;case 3:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):(n("S"),u("Cause"),r(!0),t())}},g=function(){f(-1);u("NoCause");r(!1);VTPortal.roApp.SelectedZone(-1);VTPortal.roApp.ReliableZone(!0);VTPortal.roApp.userStatus().PresenceStatus=="Inside"?n("S"):n("E");var t=function(){VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Telecommuting?VTPortal.roApp.userTelecommute()!=null&&VTPortal.roApp.userTelecommute().Telecommuting?VTPortal.roApp.userStatus().PresenceStatus=="Inside"?e():o():VTPortal.roApp.db.settings.ApiVersion<VTPortalUtils.apiVersion.NewRequests?e():VTPortal.roApp.userStatus().PresenceStatus=="Inside"?e():s():e()};typeof l!="undefined"?l(v(t)):t()},o=function(){let r=VTPortal.roApp.currentLocationInfo().zone,t=null;r!=null&&(t=VTPortal.roApp.ServerZones().filter(n=>n.Id==r)[0].TelecommutingZoneType);VTPortal.roApp.isTimeGate()&&VTPortal.roApp.timeGateConfig&&VTPortal.roApp.timeGateConfig.InZone>0&&(t=VTPortal.roApp.ServerZones().filter(n=>n.Id==VTPortal.roApp.timeGateConfig.InZone)[0].TelecommutingZoneType,r=-1);n()=="E"&&(r==null||t==2)?h(!0):(t!=null&&i(t),s())},nt=function(n,r){VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.NewRequests?r.itemIndex==0?(i(0),s()):(i(1),t()):(r.itemIndex==0?i(0):i(1),t())},s=function(){var n=Object.clone(VTPortal.roApp.currentLocationInfo(),!0);n.zone==null?!n.reliable&&VTPortal.roApp.empPermissions().MustSelectZone&&VTPortal.roApp.empPermissions().MustUseGPS||VTPortal.roApp.empPermissions().MustSelectZone&&!VTPortal.roApp.empPermissions().MustUseGPS?VTPortal.roApp.empPermissions().MustUseGPS?VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("errorGettingGPSNew"),"info",0,function(){VTPortal.roApp.loadZones();VTPortal.roApp.popupZoneVisible(!0)},function(){VTPortal.roApp.redirectAtHome()},i18nextko.i18n.t("roSelectZone"),i18nextko.i18n.t("roCancel")):(VTPortal.roApp.loadZones(),VTPortal.roApp.popupZoneVisible(!0)):t():(VTPortal.roApp.SelectedZone(n.zone),VTPortal.roApp.ReliableZone(!0),t())},t=function(){r()?VTPortal.roApp.popupCauseVisible(!0):e()},e=function(){n()=="E"?VTPortal.roApp.userStatus().PresenceStatus=="Inside"?(VTPortalUtils.utils.isShowingPopup(!1),VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roAlreadyIn"),"warning",0,function(){window.VTPortalUtils.utils.doPunch("ta",{idCause:f(),direction:n(),tcType:i()})},function(){},i18nextko.i18n.t("roContinue"),i18nextko.i18n.t("roCancel"))):window.VTPortalUtils.utils.doPunch("ta",{idCause:f(),direction:n(),tcType:i()}):n()=="S"&&(VTPortal.roApp.userStatus().PresenceStatus=="Outside"?(VTPortalUtils.utils.isShowingPopup(!1),VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roAlreadyOut"),"warning",0,function(){window.VTPortalUtils.utils.doPunch("ta",{idCause:f(),direction:n(),tcType:i()})},function(){},i18nextko.i18n.t("roContinue"),i18nextko.i18n.t("roCancel"))):window.VTPortalUtils.utils.doPunch("ta",{idCause:f(),direction:n(),tcType:i()}))},a=function(n){c!=null&&c(n)};return{OptionsVisible:h,TcType:i,CommitQuickPunch:g,CommitManualPunch:d,CommitNFCPunch:k,ReloadMap:v,InitView:p,ListZonesVisible:VTPortal.roApp.popupZoneVisible,ListCausesVisible:VTPortal.roApp.popupCauseVisible,lblWhereAreYou:i18nextko.t("lblWhereAreYou"),lblCauseInput:i18nextko.t("lblCauseInput"),searchOptions:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(n){VTPortal.roApp.zonesDataSource().searchValue(n.value);VTPortal.roApp.zonesDataSource().load()}},causeSearchOptions:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(n){VTPortal.roApp.causesDataSource().searchValue(n.value);VTPortal.roApp.causesDataSource().load()}},listCauses:{dataSource:VTPortal.roApp.causesDataSource,scrollingEnabled:!0,height:300,grouped:!1,itemTemplate:"RequestItem",onItemClick:b},listZones:{dataSource:VTPortal.roApp.zonesDataSource,scrollingEnabled:!0,height:300,grouped:!1,itemTemplate:"RequestItem",onItemClick:w},punchOptions:{dataSource:y,visible:h,showTitle:!1,title:"Desde dnde trabajars hoy?",showCancelButton:ko.observable(!1),itemTemplate:function(n,t,i){var r;t==0?(r=$("<div>").attr("class","listMenuItemContentPunchOptions"),r.append($("<img>").attr("src",n.ImageSrc).attr("class","listMenuItemIcon EmployeeImagePhoto")),r.append($("<div>").attr("class",n.cssClassText).text(n.text)),i.append(r)):(r=$("<div>").attr("class","listMenuItemContentPunchOptions"),r.append($("<img>").attr("src",n.ImageSrc).attr("class","listMenuItemIcon EmployeeImagePhoto")),r.append($("<div>").attr("class",n.cssClassText).text(n.text)),i.append(r))},onItemClick:function(n){nt(null,n)}},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.DocumentFilters=function(){function l(){if(o().viewShown(),VTPortal.roApp.documentsFilters()!=null){var f=VTPortal.roApp.documentsFilters();r(f.order.direction);u(f.order.by);n(f.filter.iDate);t(f.filter.eDate);i(f.filter.status)}else n(moment().startOf("year").toDate()),t(moment().endOf("year").toDate()),i([0,1,2,3,4,5,6,7]),r("DESC"),u("DeliveryDate")}function a(){var f={order:{direction:r(),by:u()},filter:{iDate:n(),eDate:t(),status:i()}};VTPortal.roApp.documentsFilters(f);VTPortal.roApp.db.settings.documentsFilters=JSON.stringify(f).encodeBase64();VTPortal.roApp.db.settings.saveParameter("documentsFilters");VTPortal.app.back()}function v(){VTPortal.roApp.documentsFilters(null);VTPortal.roApp.db.settings.documentsFilters="";VTPortal.roApp.db.settings.saveParameter("documentsFilters");VTPortal.app.back()}var n=ko.observable(moment().startOf("year").toDate()),t=ko.observable(moment().endOf("year").toDate()),e=ko.observable(0),i=ko.observable([0,1,2]),r=ko.observable("DESC"),u=ko.observable("DeliveryDate"),f=[];f.push({ID:1,cssClass:"dx-icon-filterParams"});f.push({ID:2,cssClass:"dx-icon-orderParams"});var s=[{ID:0,Name:i18nextko.t("roDocTypeUserField"),ImageSrc:"Images/Documents/doc-EmployeeField.png"},{ID:1,Name:i18nextko.t("roDocTypeContract"),ImageSrc:"Images/Documents/doc-EmployeeContract.png"},{ID:2,Name:i18nextko.t("roDocTypeCompany"),ImageSrc:"Images/Documents/doc-Company.png"},{ID:3,Name:i18nextko.t("roDocTypeReason"),ImageSrc:"Images/Documents/doc-Reason.png"},{ID:4,Name:i18nextko.t("roDocTypeLeaveOrPermission"),ImageSrc:"Images/Documents/doc-LeaveOrPermission.png"},{ID:5,Name:i18nextko.t("roDocumentValidation"),ImageSrc:"Images/Documents/doc-LeaveOrPermission.png"},{ID:6,Name:i18nextko.t("roDocTypeVisit"),ImageSrc:"Images/Documents/doc-Visit.png"},{ID:7,Name:i18nextko.t("rocommuniquesTitle"),ImageSrc:"Images/Documents/doc-Visit.png"}],h=[{id:"ASC",name:i18nextko.t("roOrderDirectionASC")},{id:"DESC",name:i18nextko.t("roOrderDirectionDESC")}],c=[{id:"DeliveryDate",name:i18nextko.t("roDocOrderBy_field1")}],o=ko.observable(VTPortal.bigUserInfo());return{viewShown:l,title:i18nextko.t("roDocumentFilterTitle"),subscribeBlock:o(),lblInitialDate:i18nextko.t("roRequestInitialDateLbl"),lblEndDate:i18nextko.t("roRequestEndDateLbl"),lblStatus:i18nextko.t("roDocumentTypeLbl"),lblOrderBy:i18nextko.t("roRequestOrderBy"),lblOrderDirection:i18nextko.t("roRequestOrderDirection"),beginDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:n,valueChangeEvent:"focusout"},endDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:t,valueChangeEvent:"focusout"},statusTagBox:{items:s,showSelectionControls:!0,applyValueMode:"instantly",displayExpr:"Name",valueExpr:"ID",itemTemplate:"statusItem",value:i},btnAccept:{onClick:a,text:i18nextko.t("closeConfig")},btnRemoveFilter:{onClick:v,text:i18nextko.t("roRemoveFilter")},selectedTab:e,tabPanelOptions:{dataSource:f,selectedIndex:e,itemTemplate:"title"},orderDirection:{items:h,displayExpr:"name",valueExpr:"id",value:r},orderFields:{items:c,displayExpr:"name",valueExpr:"id",value:u}}};VTPortal.configuration=function(n){function c(){e().viewShown();var n=[];n.push({ID:2,cssClass:"dx-icon-profileConfig"});VTPortal.roApp.db.settings.onlySupervisor||r.modelIsReady(!1);u.modelIsReady(!1);f(n)}function l(){switch(t()){case 1:r.viewShown();break;case 2:u.viewShown()}}var i=ko.observable(0),t=ko.observable(1),o,s;typeof n.id!="undefined"&&(i(parseInt(n.id,10)-1),t(parseInt(n.id,10)));var r=VTPortal.profileUserFields(),u=VTPortal.sharedPortalConfig(),h=ko.computed(function(){switch(t()){case 1:return i18nextko.i18n.t("roProfileUserFields");case 2:return i18nextko.i18n.t("roSharedPortalConfig")}},this),f=ko.observable([]),e=ko.observable(VTPortal.bigUserInfo());return o=function(n){typeof n!="undefined"&&t(n.ID);l()},s={viewShown:c,title:h,subscribeBlock:e(),profileUserFieldsBlock:r,sharedPortalConfigBlock:u,selectedTab:i,selectedView:t,tabPanelOptions:{dataSource:f,selectedIndex:i,itemTemplate:"title",onSelectionChanged:function(n){o(n.addedItems[0])}}},s};VTPortal.sharedPortalConfig=function(){function o(){e()}let r=ko.observable(!1),t=ko.observable(""),n=ko.observable(!0);const i=function(t){let i=VTPortal.roApp.db.settings.isTimeGate;VTPortal.roApp.db.settings.isTimeGate=t!=null;n(VTPortal.roApp.db.settings.isTimeGate);n()?(VTPortal.roApp.db.settings.screenTimeout=t.ScreenTimeout,VTPortal.roApp.db.settings.language=t.Language,VTPortal.roApp.isTimeGate(!0),VTPortal.roApp.screenTimeout(t.ScreenTimeout),VTPortal.roApp.timegateLanguage(t.Language)):(VTPortal.roApp.isTimeGate(!1),VTPortal.roApp.screenTimeout(10),VTPortal.roApp.timegateLanguage(VTPortal.roApp.currentLanguageId()));VTPortal.roApp.db.settings.save(function(){i!=VTPortal.roApp.isTimeGate()&&VTPortal.roApp.isTimeGate()&&VTPortal.app.navigate("TimeGate",{root:!0})})};let u=function(){let i=VTPortal.roApp.db.settings.UUID;i!=-1&&new WebServiceRobotics(function(t){t.Status==window.VTPortalUtils.constants.OK.value?(VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roOkEnablingSharedPortal"),"success",3500),VTPortalUtils.utils.onLogoutResetParameters(),VTPortal.roApp.userId=-999,VTPortal.roApp.db.settings.deleteRefreshTimestamps(),VTPortal.roApp.db.settings.isTimeGate=!0,n(VTPortal.roApp.db.settings.isTimeGate),VTPortal.roApp.isTimeGate(!0),VTPortal.roApp.screenTimeout(t.Value.ScreenTimeout),VTPortal.roApp.timegateLanguage(t.Value.Language),VTPortal.roApp.db.settings.save(function(){VTPortal.app.navigate("TimeGate",{root:!0})})):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t(window.VTPortalUtils.utils.languageTag(t.Status)),"error",0,function(){})}).enableTimegate(i,t(),VTPortal.roApp.infoVersion)},f=function(){let i=VTPortal.roApp.db.settings.UUID;i!=-1&&new WebServiceRobotics(function(i){i.Status==window.VTPortalUtils.constants.OK.value?(VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roOkDisablingSharedPortal"),"success",2500),t(""),VTPortalUtils.utils.onLogoutResetParameters(),VTPortal.roApp.userId=-999,VTPortal.roApp.db.settings.deleteRefreshTimestamps(),VTPortal.roApp.db.settings.isTimeGate=!1,n(VTPortal.roApp.db.settings.isTimeGate),VTPortal.roApp.isTimeGate(!1),VTPortal.roApp.screenTimeout(10),VTPortal.roApp.db.settings.save(function(){VTPortal.app.navigate("login",{root:!0})})):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t(window.VTPortalUtils.utils.languageTag(i.Status)),"error",0,function(){})}).disableTimegate(i)},e=function(){let n=VTPortal.roApp.db.settings.UUID;new WebServiceRobotics(function(n){n.Status==window.VTPortalUtils.constants.OK.value||n.Status==window.VTPortalUtils.constants.NOT_FOUND.value?n.Value!=null?(t(n.Value.Name),i(n.Value)):i(null):(i(null),VTPortalUtils.utils.processErrorMessage(n,function(){}))},function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingSummaryHolidaysInfo"),"error",0,function(){})}).getTimegateConfiguration(n)};return{modelIsReady:r,viewShown:o,lblTerminalName:i18nextko.t("lblTerminalName"),lblTimegateTitle:i18nextko.t("lblTimegateTitle"),isTimegateEnabled:n,btnEnabled:{text:i18nextko.t("roDisableSharedPortalBt"),onClick:f},btnEnableSharedPortal:{onClick:u,text:i18nextko.t("roEnableSharedPortalBt")},txtTerminalName:{placeholder:i18nextko.t("roPH_terminalName"),value:t,disabled:n},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),lblTimegateActionWarning:i18nextko.t("lblTimegateActionWarning")}};VTPortal.myWebLinks=function(){function t(){i()}function i(){VTPortal.roApp.loggedIn&&new WebServiceRobotics(function(t){if(t.Status==window.VTPortalUtils.constants.OK.value){VTPortal.roApp.db.settings.updateCacheDS("weblinks",t.Value);let r=t.Value;r=r.filter(function(n){return n.ShowOnPortal===!0});r.sort(function(n,t){return n.Position-t.Position});for(var i=0;i<r.length;i++)r[i].hasAction=!0,r[i].cssClass="dx-weblink",r[i].Name=r[i].Title,r[i].Value=r[i].Description,r[i].URL=r[i].URL;n(r)}else n([]),VTPortalUtils.utils.processErrorMessage(t,function(){})},function(){n([]);VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingWebLinks"),"error",0,function(){})}).GetAllPortalWebLinks()}var n=ko.observable([]);return{viewShown:t,title:i18nextko.i18n.t("roWebLinks"),loadingPanel:VTPortalUtils.utils.loadingPanelConf(),webLinksDS:n,listOptions:{dataSource:n,scrollingEnabled:!1,grouped:!1,itemTemplate:"item",onItemClick:function(n){n.itemData.URL&&VTPortal.roApp.openURLonExternalBrowser(n.itemData.URL)}}}};