VTPortal.DocumentFilters=function(){function l(){if(o().viewShown(),VTPortal.roApp.documentsFilters()!=null){var f=VTPortal.roApp.documentsFilters();r(f.order.direction);u(f.order.by);n(f.filter.iDate);t(f.filter.eDate);i(f.filter.status)}else n(moment().startOf("year").toDate()),t(moment().endOf("year").toDate()),i([0,1,2,3,4,5,6,7]),r("DESC"),u("DeliveryDate")}function a(){var f={order:{direction:r(),by:u()},filter:{iDate:n(),eDate:t(),status:i()}};VTPortal.roApp.documentsFilters(f);VTPortal.roApp.db.settings.documentsFilters=JSON.stringify(f).encodeBase64();VTPortal.roApp.db.settings.saveParameter("documentsFilters");VTPortal.app.back()}function v(){VTPortal.roApp.documentsFilters(null);VTPortal.roApp.db.settings.documentsFilters="";VTPortal.roApp.db.settings.saveParameter("documentsFilters");VTPortal.app.back()}var n=ko.observable(moment().startOf("year").toDate()),t=ko.observable(moment().endOf("year").toDate()),e=ko.observable(0),i=ko.observable([0,1,2]),r=ko.observable("DESC"),u=ko.observable("DeliveryDate"),f=[];f.push({ID:1,cssClass:"dx-icon-filterParams"});f.push({ID:2,cssClass:"dx-icon-orderParams"});var s=[{ID:0,Name:i18nextko.t("roDocTypeUserField"),ImageSrc:"Images/Documents/doc-EmployeeField.png"},{ID:1,Name:i18nextko.t("roDocTypeContract"),ImageSrc:"Images/Documents/doc-EmployeeContract.png"},{ID:2,Name:i18nextko.t("roDocTypeCompany"),ImageSrc:"Images/Documents/doc-Company.png"},{ID:3,Name:i18nextko.t("roDocTypeReason"),ImageSrc:"Images/Documents/doc-Reason.png"},{ID:4,Name:i18nextko.t("roDocTypeLeaveOrPermission"),ImageSrc:"Images/Documents/doc-LeaveOrPermission.png"},{ID:5,Name:i18nextko.t("roDocumentValidation"),ImageSrc:"Images/Documents/doc-LeaveOrPermission.png"},{ID:6,Name:i18nextko.t("roDocTypeVisit"),ImageSrc:"Images/Documents/doc-Visit.png"},{ID:7,Name:i18nextko.t("rocommuniquesTitle"),ImageSrc:"Images/Documents/doc-Visit.png"}],h=[{id:"ASC",name:i18nextko.t("roOrderDirectionASC")},{id:"DESC",name:i18nextko.t("roOrderDirectionDESC")}],c=[{id:"DeliveryDate",name:i18nextko.t("roDocOrderBy_field1")}],o=ko.observable(VTPortal.bigUserInfo());return{viewShown:l,title:i18nextko.t("roDocumentFilterTitle"),subscribeBlock:o(),lblInitialDate:i18nextko.t("roRequestInitialDateLbl"),lblEndDate:i18nextko.t("roRequestEndDateLbl"),lblStatus:i18nextko.t("roDocumentTypeLbl"),lblOrderBy:i18nextko.t("roRequestOrderBy"),lblOrderDirection:i18nextko.t("roRequestOrderDirection"),beginDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:n,valueChangeEvent:"focusout"},endDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:t,valueChangeEvent:"focusout"},statusTagBox:{items:s,showSelectionControls:!0,applyValueMode:"useButtons",displayExpr:"Name",valueExpr:"ID",itemTemplate:"statusItem",value:i},btnAccept:{onClick:a,text:i18nextko.t("closeConfig")},btnRemoveFilter:{onClick:v,text:i18nextko.t("roRemoveFilter")},selectedTab:e,tabPanelOptions:{dataSource:f,selectedIndex:e,itemTemplate:"title"},orderDirection:{items:h,displayExpr:"name",valueExpr:"id",value:r},orderFields:{items:c,displayExpr:"name",valueExpr:"id",value:u}}};VTPortal.RequestFilters=function(n){function d(){var n;y().viewShown();t==0?VTPortal.roApp.requestFilters()!=null?(n=VTPortal.roApp.requestFilters(),h(n.order.direction),c(n.order.by),u(n.filter.iDate),f(n.filter.eDate),e(n.filter.iRequestedDate),o(n.filter.eRequestedDate),r(n.filter.types),s(n.filter.status)):(r([1,5,6,7,11,13]),s([0,1,2,3,4]),h("DESC"),c("RequestDate"),u(moment().startOf("year").toDate()),f(moment().endOf("year").toDate()),e(moment().startOf("year").toDate()),o(moment().endOf("year").toDate())):t==1?VTPortal.roApp.teleWorkingFilters()!=null?(n=VTPortal.roApp.teleWorkingFilters(),h(n.order.direction),c(n.order.by),u(n.filter.iDate),f(n.filter.eDate),e(n.filter.iRequestedDate),o(n.filter.eRequestedDate),r(n.filter.types),s(n.filter.status)):(r([4,16]),s([0,1,2,3,4]),h("DESC"),c("RequestDate"),u(moment().startOf("year").toDate()),f(moment().endOf("year").toDate()),e(moment().startOf("year").toDate()),o(moment().endOf("year").toDate())):t==2?VTPortal.roApp.punchesFilters()!=null?(n=VTPortal.roApp.punchesFilters(),h(n.order.direction),c(n.order.by),u(n.filter.iDate),f(n.filter.eDate),e(n.filter.iRequestedDate),o(n.filter.eRequestedDate),r(n.filter.types),s(n.filter.status)):(r([2,3,10,12]),s([0,1,2,3,4]),h("DESC"),c("RequestDate"),u(moment().startOf("year").toDate()),f(moment().endOf("year").toDate()),e(moment().startOf("year").toDate()),o(moment().endOf("year").toDate())):t==3?VTPortal.roApp.authorizationFilters()!=null?(n=VTPortal.roApp.authorizationFilters(),h(n.order.direction),c(n.order.by),u(n.filter.iDate),f(n.filter.eDate),e(n.filter.iRequestedDate),o(n.filter.eRequestedDate),r(n.filter.types),s(n.filter.status)):(r([9,14]),s([0,1,2,3,4]),h("DESC"),c("RequestDate"),u(moment().startOf("year").toDate()),f(moment().endOf("year").toDate()),e(moment().startOf("year").toDate()),o(moment().endOf("year").toDate())):t==4&&(VTPortal.roApp.supervisorFilters()!=null?(n=VTPortal.roApp.supervisorFilters(),h(n.order.direction),c(n.order.by),u(n.filter.iDate),f(n.filter.eDate),e(n.filter.iRequestedDate),o(n.filter.eRequestedDate),r(n.filter.types),s(n.filter.status)):(r([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),s([0,1]),h("DESC"),c("RequestDate"),u(moment().startOf("year").toDate()),f(moment().endOf("year").toDate()),e(moment().startOf("year").toDate()),o(moment().endOf("year").toDate())))}function g(){var n={order:{direction:h(),by:c()},filter:{iDate:u(),eDate:f(),iRequestedDate:e(),eRequestedDate:o(),types:r(),status:s()}};t==0?(VTPortal.roApp.requestFilters(n),VTPortal.roApp.db.settings.requestFilters=JSON.stringify(n).encodeBase64(),VTPortal.roApp.db.settings.saveParameter("requestFilters")):t==1?(VTPortal.roApp.teleWorkingFilters(n),VTPortal.roApp.db.settings.teleWorkingFilters=JSON.stringify(n).encodeBase64(),VTPortal.roApp.db.settings.saveParameter("teleWorkingFilters")):t==2?(VTPortal.roApp.punchesFilters(n),VTPortal.roApp.db.settings.punchesFilters=JSON.stringify(n).encodeBase64(),VTPortal.roApp.db.settings.saveParameter("punchesFilters")):t==3?(VTPortal.roApp.authorizationFilters(n),VTPortal.roApp.db.settings.authorizationFilters=JSON.stringify(n).encodeBase64(),VTPortal.roApp.db.settings.saveParameter("authorizationFilters")):t==4&&(VTPortal.roApp.supervisorFilters(n),VTPortal.roApp.db.settings.supervisorFilters=JSON.stringify(n).encodeBase64(),VTPortal.roApp.db.settings.saveParameter("supervisorFilters"));t==0?VTPortal.app.navigate("scheduler/4/"+moment().format("YYYY-MM-DD"),{target:"back"}):t==1?VTPortal.app.navigate("teleworking/3/"+moment().format("YYYY-MM-DD"),{target:"back"}):t==2?VTPortal.app.navigate("punchManagement/2/"+moment().format("YYYY-MM-DD"),{target:"back"}):t==3?VTPortal.app.navigate("scheduler/3/"+moment().format("YYYY-MM-DD"),{target:"back"}):t==4&&VTPortal.app.navigate("myTeamRequests",{target:"back"})}function nt(){t==0?(VTPortal.roApp.requestFilters(null),VTPortal.roApp.db.settings.requestFilters="",VTPortal.roApp.db.settings.saveParameter("requestFilters")):t==1?(VTPortal.roApp.teleWorkingFilters(null),VTPortal.roApp.db.settings.teleWorkingFilters="",VTPortal.roApp.db.settings.saveParameter("teleWorkingFilters")):t==2?(VTPortal.roApp.punchesFilters(null),VTPortal.roApp.db.settings.punchesFilters="",VTPortal.roApp.db.settings.saveParameter("punchesFilters")):t==3?(VTPortal.roApp.authorizationFilters(null),VTPortal.roApp.db.settings.authorizationFilters="",VTPortal.roApp.db.settings.saveParameter("authorizationFilters")):t==4&&(VTPortal.roApp.supervisorFilters(null),VTPortal.roApp.db.settings.supervisorFilters="",VTPortal.roApp.db.settings.saveParameter("supervisorFilters"));t==0?VTPortal.app.navigate("scheduler/4/"+moment().format("YYYY-MM-DD"),{target:"back"}):t==1?VTPortal.app.navigate("teleworking/3/"+moment().format("YYYY-MM-DD"),{target:"back"}):t==2?VTPortal.app.navigate("punchManagement/2/"+moment().format("YYYY-MM-DD"),{target:"back"}):t==3?VTPortal.app.navigate("scheduler/3/"+moment().format("YYYY-MM-DD"),{target:"back"}):t==4&&VTPortal.app.navigate("myTeamRequests",{target:"back"})}var u=ko.observable(moment().startOf("year").toDate()),f=ko.observable(moment().endOf("year").toDate()),e=ko.observable(moment().startOf("year").toDate()),o=ko.observable(moment().endOf("year").toDate()),w=ko.observable(0),r=ko.observable([1,2,3,4,5,6,7,9,10,11,12,13,14,15,16]),s=ko.observable([0,1,2,3,4]),h=ko.observable("DESC"),c=ko.observable("RequestDate"),y=ko.observable(VTPortal.bigUserInfo()),t=parseInt(n.id,10),a,p,i,v,l;if(t==0?r([1,5,6,7,11,12,13]):t==1?r([4,15]):t==2?r([2,3,10,12]):t==3?r([9,14]):t==4&&r([1,2,3,4,5,6,7,9,10,11,12,13,14,15,16]),a=[],a.push({ID:1,cssClass:"dx-icon-filterParams"}),a.push({ID:2,cssClass:"dx-icon-orderParams"}),p=[{ID:0,Name:i18nextko.t("roRequestPendingStatus"),ImageSrc:"Images/Common/request_pending.png"},{ID:1,Name:i18nextko.t("roRequestOnGoingStatus"),ImageSrc:"Images/Common/request_ongoing.png"},{ID:2,Name:i18nextko.t("roRequestApprovedStatus"),ImageSrc:"Images/Common/request_approve.png"},{ID:3,Name:i18nextko.t("roRequestDeniedStatus"),ImageSrc:"Images/Common/request_denied.png"},{ID:4,Name:i18nextko.t("roRequestCanceledStatus"),ImageSrc:"Images/Common/request_denied.png"}],t==4&&(p=[{ID:0,Name:i18nextko.t("roRequestPendingStatus"),ImageSrc:"Images/Common/request_pending.png"},{ID:1,Name:i18nextko.t("roRequestOnGoingStatus"),ImageSrc:"Images/Common/request_ongoing.png"}]),i=[],v=VTPortal.roApp.empPermissions().Requests,t!=4){for(l=0;l<v.length;l++)if(v[l].Permission)switch(v[l].RequestType){case 1:t==0&&i.push({ID:1,Name:i18nextko.i18n.t("roRequestType_UserFieldsChange"),ImageSrc:"Images/Requests/ico_UserFieldChange.png"});break;case 2:t==2&&i.push({ID:2,Name:i18nextko.i18n.t("roRequestType_ForbiddenPunch"),ImageSrc:"Images/Requests/ico_ForbiddenPunch.png"});break;case 3:t==2&&i.push({ID:3,Name:i18nextko.i18n.t("roRequestType_JustifyPunch"),ImageSrc:"Images/Requests/ico_JustifyPunch.png"});break;case 4:t==1&&i.push({ID:4,Name:i18nextko.i18n.t("roRequestType_ExternalWorkResumePart"),ImageSrc:"Images/Requests/ico_ExternalWorkResume.png"});break;case 5:t==0&&i.push({ID:5,Name:i18nextko.i18n.t("roRequestType_ChangeShift"),ImageSrc:"Images/Requests/ico_ChangeShift.png"});break;case 6:t==0&&i.push({ID:6,Name:i18nextko.i18n.t("roRequestType_VacationsOrPermissions"),ImageSrc:"Images/Requests/ico_Holidays.png"});break;case 7:t==0&&i.push({ID:7,Name:i18nextko.i18n.t("roRequestType_PlannedAbsences"),ImageSrc:"Images/Requests/ico_PlannedAbsences.png"});break;case 8:t==0&&i.push({ID:8,Name:i18nextko.i18n.t("roRequestType_ShiftExchange"),ImageSrc:"Images/Requests/ico_ShiftExchange.png"});break;case 9:t==3&&i.push({ID:9,Name:i18nextko.i18n.t("roRequestType_PlannedCauses"),ImageSrc:"Images/Requests/ico_PlannedCauses.png"});break;case 10:t==2&&i.push({ID:10,Name:i18nextko.i18n.t("roRequestType_ForbiddenTaskPunch"),ImageSrc:"Images/Requests/ico_ForbiddenTaskPunch.png"});break;case 11:t==0&&i.push({ID:11,Name:i18nextko.i18n.t("roRequestType_CancelHolidays"),ImageSrc:"Images/Requests/ico_HolidaysCancel.png"});break;case 12:t==2&&i.push({ID:12,Name:i18nextko.i18n.t("roRequestType_ForgottenCostCenterPunch"),ImageSrc:"Images/Requests/ico_ForbiddenCostPunch.png"});break;case 13:t==0&&i.push({ID:13,Name:i18nextko.i18n.t("roRequestType_PlannedHoliday"),ImageSrc:"Images/Requests/ico_PlannedHoliday.png"});break;case 14:t==3&&i.push({ID:14,Name:i18nextko.i18n.t("roRequestType_PlannedOvertime"),ImageSrc:"Images/Requests/ico_PlannedOvertime.png"});break;case 15:t==1&&i.push({ID:15,Name:i18nextko.i18n.t("roRequestType_ExternalWorkWeekResume"),ImageSrc:"Images/Requests/ico_ExternalWorkWeekResume.png"});break;case 16:t==1&&i.push({ID:16,Name:i18nextko.i18n.t("roRequestType_Telecommute"),ImageSrc:"Images/Requests/ico_telecommute.png"})}}else i.push({ID:1,Name:i18nextko.i18n.t("roRequestType_UserFieldsChange"),ImageSrc:"Images/Requests/ico_UserFieldChange.png"}),i.push({ID:2,Name:i18nextko.i18n.t("roRequestType_ForbiddenPunch"),ImageSrc:"Images/Requests/ico_ForbiddenPunch.png"}),i.push({ID:3,Name:i18nextko.i18n.t("roRequestType_JustifyPunch"),ImageSrc:"Images/Requests/ico_JustifyPunch.png"}),i.push({ID:4,Name:i18nextko.i18n.t("roRequestType_ExternalWorkResumePart"),ImageSrc:"Images/Requests/ico_ExternalWorkResume.png"}),i.push({ID:5,Name:i18nextko.i18n.t("roRequestType_ChangeShift"),ImageSrc:"Images/Requests/ico_ChangeShift.png"}),i.push({ID:6,Name:i18nextko.i18n.t("roRequestType_VacationsOrPermissions"),ImageSrc:"Images/Requests/ico_Holidays.png"}),i.push({ID:7,Name:i18nextko.i18n.t("roRequestType_PlannedAbsences"),ImageSrc:"Images/Requests/ico_PlannedAbsences.png"}),i.push({ID:8,Name:i18nextko.i18n.t("roRequestType_ShiftExchange"),ImageSrc:"Images/Requests/ico_ShiftExchange.png"}),i.push({ID:9,Name:i18nextko.i18n.t("roRequestType_PlannedCauses"),ImageSrc:"Images/Requests/ico_PlannedCauses.png"}),i.push({ID:10,Name:i18nextko.i18n.t("roRequestType_ForbiddenTaskPunch"),ImageSrc:"Images/Requests/ico_ForbiddenTaskPunch.png"}),i.push({ID:11,Name:i18nextko.i18n.t("roRequestType_CancelHolidays"),ImageSrc:"Images/Requests/ico_HolidaysCancel.png"}),i.push({ID:12,Name:i18nextko.i18n.t("roRequestType_ForgottenCostCenterPunch"),ImageSrc:"Images/Requests/ico_ForbiddenCostPunch.png"}),i.push({ID:13,Name:i18nextko.i18n.t("roRequestType_PlannedHoliday"),ImageSrc:"Images/Requests/ico_PlannedHoliday.png"}),i.push({ID:14,Name:i18nextko.i18n.t("roRequestType_PlannedOvertime"),ImageSrc:"Images/Requests/ico_PlannedOvertime.png"}),i.push({ID:15,Name:i18nextko.i18n.t("roRequestType_ExternalWorkWeekResume"),ImageSrc:"Images/Requests/ico_ExternalWorkWeekResume.png"}),i.push({ID:16,Name:i18nextko.i18n.t("roRequestType_Telecommute"),ImageSrc:"Images/Requests/ico_telecommute.png"});i=i.sortBy(function(n){return n.Name});var b=[{id:"ASC",name:i18nextko.t("roOrderDirectionASC")},{id:"DESC",name:i18nextko.t("roOrderDirectionDESC")}],k=[{id:"RequestType",name:i18nextko.t("roOrderBy_field1")},{id:"RequestDate",name:i18nextko.t("roOrderBy_field2")},{id:"Status",name:i18nextko.t("roOrderBy_field3")},{id:"Date1",name:i18nextko.t("roOrderBy_field4")}],y=ko.observable(VTPortal.bigUserInfo());return{viewShown:d,title:i18nextko.t("roRequestFilterTitle"),subscribeBlock:y(),lblInitialDate:i18nextko.t("roRequestInitialDateLbl"),lblEndDate:i18nextko.t("roRequestEndDateLbl"),lblInitialRequestedDate:i18nextko.t("roRequestInitialRequestedDateLbl"),lblEndRequestedDate:i18nextko.t("roRequestEndRequestedDateLbl"),lblStatus:i18nextko.t("roRequestStatusLbl"),lblType:i18nextko.t("roRequestTypeLbl"),lblOrderBy:i18nextko.t("roRequestOrderBy"),lblOrderDirection:i18nextko.t("roRequestOrderDirection"),subscribeBlock:y(),workingMode:t,beginDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:u,showClearButton:!0,valueChangeEvent:"focusout"},endDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:f,showClearButton:!0,valueChangeEvent:"focusout"},statusTagBox:{items:p,showSelectionControls:!0,applyValueMode:"instantly",displayExpr:"Name",valueExpr:"ID",itemTemplate:"statusItem",value:s},typeTagBox:{items:i,showSelectionControls:!0,applyValueMode:"instantly",displayExpr:"Name",valueExpr:"ID",itemTemplate:"typeItem",value:r},beginRequestedDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:e,showClearButton:!0,valueChangeEvent:"focusout"},endRequestedDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:o,showClearButton:!0,valueChangeEvent:"focusout"},btnAccept:{onClick:g,text:i18nextko.t("closeConfig")},btnRemoveFilter:{onClick:nt,text:i18nextko.t("roRemoveFilter")},selectedTab:w,tabPanelOptions:{dataSource:a,selectedIndex:w,itemTemplate:"title"},orderDirection:{items:b,displayExpr:"name",valueExpr:"id",value:h},orderFields:{items:k,displayExpr:"name",valueExpr:"id",value:c}}};VTPortal.SelectListObject=function(n){var i=ko.observable(!1),u=VTPortal.taskFieldsInput(),f=ko.observable(VTPortal.bigUserInfo()),e=ko.observable(n.id),o=function(){f().viewShown();new WebServiceRobotics(function(n){n.Status==window.VTPortalUtils.constants.OK.value&&r(new DevExpress.data.DataSource({store:n.SelectFields,searchOperation:"contains",searchExpr:["FieldName","RelatedInfo"]}))}).getGenericList(n.id)},s=n.id.replaceAll(".",""),t=ko.observable("");typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(n.iDate);var r=ko.observable(new DevExpress.data.DataSource({store:[],searchOperation:"contains",searchExpr:["FieldName","RelatedInfo"]})),h=function(i){VTPortal.roApp.SelectedCause(i.itemData.FieldValue.toNumber());switch(n.param){case"E":window.VTPortalUtils.utils.doPunch("ta",{idCause:i.itemData.FieldValue.toNumber(),direction:"E",tcType:t(),selectedZone:VTPortal.roApp.SelectedZone()});break;case"S":window.VTPortalUtils.utils.doPunch("ta",{idCause:i.itemData.FieldValue.toNumber(),direction:"S",tcType:t()});break;case"TCH":case"TCO":c(n.param,i);break;case"C":window.VTPortalUtils.utils.doPunch("cc",{idCenter:i.itemData.FieldValue.toNumber(),tcType:t()})}},c=function(n,r){curTaskInfo={action:n,info:r};new WebServiceRobotics(function(f){var o,e,s;if(f.Status==window.VTPortalUtils.constants.OK.value){for(VTPortal.roApp.taskPunchRequest().newAction=n,VTPortal.roApp.taskPunchRequest().newTaskUserFieldsDefinition=f.Fields,o=!1,e=0;e<f.Fields.length;e++)f.Fields[e].Used&&(o=!0);if(o)u.initTaskProperties(!1),i(!0);else switch(n){case"TCH":window.VTPortalUtils.utils.doPunch("task",{idTask:VTPortal.roApp.userStatus().TaskId,idNewTask:r.itemData.FieldValue.toNumber(),oldValues:VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue,newValues:VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue,complete:!1,tcType:t()});break;case"TCO":window.VTPortalUtils.utils.doPunch("task",{idTask:VTPortal.roApp.userStatus().TaskId,idNewTask:r.itemData.FieldValue.toNumber(),oldValues:VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue,newValues:VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue,complete:!0,tcType:t()})}}else s=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingTaskInfo"),"error",0,s)}).getTaskUserFieldsAction(VTPortalUtils.taskAction.begin,r.itemData.FieldValue.toNumber())},l=function(){i(!1);u.savePunchInfo();switch(curTaskInfo.action){case"TCH":window.VTPortalUtils.utils.doPunch("task",{idTask:VTPortal.roApp.userStatus().TaskId,idNewTask:curTaskInfo.info.itemData.FieldValue.toNumber(),oldValues:VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue,newValues:VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue,complete:!1,tcType:t()});break;case"TCO":window.VTPortalUtils.utils.doPunch("task",{idTask:VTPortal.roApp.userStatus().TaskId,idNewTask:curTaskInfo.info.itemData.FieldValue.toNumber(),oldValues:VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue,newValues:VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue,complete:!0,tcType:t()})}},a=function(n){VTPortal.roApp.popupZoneVisible(!1);VTPortal.roApp.ZoneSelected(!0);VTPortal.roApp.SelectedZone(n.itemData.Id);v(n.itemData.Id)},v=function(n){VTPortal.roApp.userStatus().PresenceStatus=="Inside"?(VTPortalUtils.utils.isShowingPopup(!1),VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roAlreadyIn"),"warning",0,function(){window.VTPortalUtils.utils.doPunch("ta",{idCause:VTPortal.roApp.SelectedCause(),direction:"S",tcType:t()})},function(){},i18nextko.i18n.t("roContinue"),i18nextko.i18n.t("roCancel"))):window.VTPortalUtils.utils.doPunch("ta",{idCause:VTPortal.roApp.SelectedCause(),direction:"E",tcType:t(),selectedZone:n})};return{viewShown:o,title:i18nextko.t(s),subscribeBlock:f(),isTaskL:e,ListZonesVisible:VTPortal.roApp.popupZoneVisible,listZones:{dataSource:VTPortal.roApp.zonesDataSource,scrollingEnabled:!0,height:300,grouped:!1,itemTemplate:"RequestItem",onItemClick:a},listOptions:{dataSource:r,height:"70%",itemTemplate:"item",onItemClick:h},lblWhereAreYou:i18nextko.t("lblWhereAreYou"),searchOptions2:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(n){VTPortal.roApp.zonesDataSource().searchValue(n.value);VTPortal.roApp.zonesDataSource().load()}},searchOptions:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(n){r().searchValue(n.value);r().load()}},taskFieldsVisible:i,taskFieldsBlock:u,btnCancelTaskFields:{onClick:function(){i(!1)},text:i18nextko.t("roCancelCaptcha")},btnAcceptUserFields:{onClick:function(){l()},text:i18nextko.t("roContinue")}}};VTPortal.sendDocument=function(n){function g(){v().viewShown();c(!0);p(null);d()}function nt(){var i,n,s;VTPortal.roApp.isModeApp()==!1?(i=a(),n=new FormData,n.append("idTemplateDocument",t()!=-1?t():o()),n.append("idRelatedObject",r()),n.append("remarks",u()),n.append("docRelatedInfo",""),n.append("forecastType",e()),n.append("userfile",i[0]),new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDocumentSaved"),"success",2e3),VTPortal.roApp.loadInitialData(!1,!1,!1,!1,!1);else{var t=function(){};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorUploadingFile"),"error",0,n)}).uploadDocumentDesktop(n)):(n=new FormData,n.append("idTemplateDocument",t()!=-1?t():o()),n.append("userfile",f()),n.append("idRelatedObject",r()),s="",new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDocumentSaved"),"success",2e3),VTPortal.roApp.redirectAtHome(),VTPortal.roApp.loadInitialData(!1,!1,!1,!1,!1);else{var t=function(){};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorUploadingFile"),"error",0,n)}).uploadDocumentMobile(n,e(),u(),s))}function tt(){if(VTPortalUtils.utils.isShowingPopup(!1),Object.has(navigator,"camera")){var n=function(){navigator.camera.getPicture(function(n){f(n);typeof device!="undefined"?cordova.platformId==="ios"?i(window.WkWebView.convertFilePath(n)):i(n):i(n)},function(n){n.includes("cancelled")||VTPortalUtils.utils.notifyMesage(n,"error",2e3)},{quality:75,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,targetWidth:960,targetHeight:1280,saveToPhotoAlbum:!1,correctOrientation:!0})},t=function(){navigator.camera.getPicture(function(n){f(n);typeof device!="undefined"?cordova.platformId==="ios"?i(window.WkWebView.convertFilePath(n)):i(n):i(n)},function(n){n.includes("cancelled")||VTPortalUtils.utils.notifyMesage(n,"error",2e3)},{quality:75,sourceType:Camera.PictureSourceType.CAMERA,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,targetWidth:960,targetHeight:1280,saveToPhotoAlbum:!1,correctOrientation:!0})};VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roSelectOrigin"),"info",0,n,t,i18nextko.i18n.t("roTakeFromLibrary"),i18nextko.i18n.t("roTakeFromCamera"))}else VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoCameraAvailable"),"error",0)}var t=ko.observable(-1),r=ko.observable(-1),u=ko.observable(""),p=ko.observable(null),f=ko.observable(""),e=ko.observable(""),w=ko.computed(function(){return!0}),b=ko.computed(function(){return t()==-1?i18nextko.i18n.t("roRequestDocumentType"):i18nextko.i18n.t("roRequestSelectFile")}),c=ko.observable(!1),l=ko.observable(i18nextko.i18n.t("roFindFile")),a=ko.observableArray(),i=ko.observable(""),h,y;typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));typeof n.param!="undefined"&&parseInt(n.param,10)!=-1&&r(parseInt(n.param,10));typeof n.iDate!="undefined"&&parseInt(n.iDate,10)!=-1&&relatedCause(parseInt(n.iDate,10));typeof n.objId!="undefined"&&n.objId!=""&&e(n.objId);var o=ko.observable(t()),s=ko.observable([]),k=ko.computed(function(){return"76%"}),d=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)s(n.SelectFields),t()!=-1&&h({value:t()+""});else{var i=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,i)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingCauseInfo"),"error",0,n)}).getAvailableDocumentTemplateType(VTPortal.roApp.employeeId,!1)},v=ko.observable(VTPortal.bigUserInfo());return h=function(n){var t=n.value,i=null;$.grep(s(),function(n){n.FieldValue==t&&(i=n)})},y={viewShown:g,title:i18nextko.t("roRequestType_SendDocument"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:b,lblImageCapture:i18nextko.t("roTakePhoto"),lblSelectFile:i18nextko.t("roSelectFile"),lblDocDate:i18nextko.t("roRequestDocRelatedDate"),subscribeBlock:v(),scrollContent:{height:k},btnSave:{onClick:nt,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:c},remarks:{value:u},cmbDocumentType:{dataSource:s,displayExpr:"FieldName",valueExpr:"FieldValue",value:o,visible:w,onValueChanged:h},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),selectPhotoEvent:tt,imageSrc:i,appMode:VTPortal.roApp.isModeApp(),uploadOptions:{multiple:!1,accept:"*",value:a,uploadMode:"useForm",showFileList:!1,selectButtonText:l,onValueChanged:function(n){l(n.value[0].name)}}},y};VTPortal.communiqueDetail=function(n){function b(){s().viewShown();w()}var t=ko.observable(),f=ko.observable(!1),e=ko.observable(!1),o=ko.observable(i18nextko.i18n.t("roVote")),u=ko.observable(""),h=ko.computed(function(){return u(""),typeof t()!="undefined"?t().Status.EmployeeCommuniqueStatus[0].Answered==!0?t().Status.Communique.AllowChangeResponse==!0?(o(t().Status.EmployeeCommuniqueStatus[0].Answer+" ("+i18nextko.i18n.t("roChange")+")"),!0):(u(t().Status.EmployeeCommuniqueStatus[0].Answer),!1):!0:!1}),i=ko.observable(!1),c=ko.computed(function(){if(typeof t()!="undefined"){if(t().Status.Communique.Documents.length>0){i(!0);var n=[];return t().Status.Communique.Documents.forEach(function(t){n.push({text:t.Title,id:t.Id,type:"success"})}),n}i(!1)}else i(!1)}),r=ko.observable(!1),l=ko.computed(function(){if(typeof t()!="undefined"){if(t().Status.Communique.AllowedResponses.length>0){r(!0);var n=[];return t().Status.Communique.AllowedResponses.forEach(function(t){n.push({text:t,type:"success"})}),n}r(!1)}else r(!1)}),a=ko.computed(function(){if(typeof t()!="undefined")return t().Status.Communique.Subject;""}),v=ko.computed(function(){if(typeof t()!="undefined")return moment(t().Status.Communique.SentOn).format("dddd DD MMMM YYYY");""}),y=ko.computed(function(){if(typeof t()!="undefined")return t().Status.Communique.Message;""}),s=ko.observable(VTPortal.bigUserInfo()),p=ko.computed(function(){return typeof t()!="undefined"?t().Status.Communique.CreatedBy.EmployeePhoto!=""?"url(data:image/png;base64,"+t().Status.Communique.CreatedBy.EmployeePhoto+") no-repeat center center":"url(Images/logovtl.png) no-repeat center center":""}),w=function(){new WebServiceRobotics(function(n){n.oState.Result==window.VTPortalUtils.constants.OK.value?t(n):(DevExpress.ui.notify(i18nextko.t("roCommError"),"warning",3e3),VTPortal.roApp.db.settings.supervisorPortalEnabled?(VTPortal.roApp.selectedTab(5),VTPortal.app.navigate("communiques",{root:!0})):(VTPortal.roApp.selectedTab(4),VTPortal.app.navigate("communiques",{root:!0})))}).getCommuniqueById(n.id)};return{viewShown:b,lblSubject:a,empImage:p,lblCommuniqueDate:v,allowExtraResponse:h,hasDocuments:i,lblMessage:y,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),title:i18nextko.t("rocommuniquesTitle"),subscribeBlock:s(),communique:t,voteOptions:{dataSource:l,visible:f,showTitle:!1,showCancelButton:ko.observable(!0),onItemClick:function(n){moment(t().Status.Communique.ExpirationDate).isAfter(moment())?new WebServiceRobotics(function(n){n.oState.Result==window.VTPortalUtils.constants.OK.value?(DevExpress.ui.notify(i18nextko.t("roAnswerCorrect"),"success",3e3),VTPortal.roApp.db.settings.supervisorPortalEnabled?(VTPortal.roApp.selectedTab(5),VTPortal.app.navigate("communiques",{root:!0})):(VTPortal.roApp.selectedTab(4),VTPortal.app.navigate("communiques",{root:!0}))):(DevExpress.ui.notify(i18nextko.t("roAnswerIncorrect"),"warning",3e3),VTPortal.roApp.db.settings.supervisorPortalEnabled?(VTPortal.roApp.selectedTab(5),VTPortal.app.navigate("communiques",{root:!0})):(VTPortal.roApp.selectedTab(4),VTPortal.app.navigate("communiques",{root:!0})))}).answerCommunique(t().Status.Communique.Id,n.itemData.text):DevExpress.ui.notify(i18nextko.t("roExpired"),"warning",3e3)}},checkDocuments:{dataSource:c,visible:e,showTitle:!1,showCancelButton:ko.observable(!0),onItemClick:function(n){new WebServiceRobotics(function(n){window.VTPortalUtils.utils.downloadBytes(n.Value)}).getDocumentBytes(n.itemData.id)}},buttonOptions:{text:o,visible:r,onClick:function(){f(!0)}},buttonMyResponse:{text:u,visible:r},buttonDocuments:{text:i18nextko.t("roCheckDocuments"),visible:i,onClick:function(){e(!0)}},cssBackground:ko.computed(function(){return"backgroundOpacityImp"})}};VTPortal.communiques=function(){function r(){var o,r,f,e,u;if(i(1),$("#btnNotRead").removeClass("pressing"),$("#btnAllCom").addClass("pressing"),$("#btnArchived").removeClass("pressing"),o=[],r=VTPortal.roApp.userStatus().Communiques,r!=null&&r.length>0)for(f="",e="",u=0;u<r.length;u++)if(r[u].Communique.Archived==!1){if(r[u].Communique.MandatoryRead==!0)switch(r[u].EmployeeCommuniqueStatus[0].Read){case!1:f="dx-icon-communiqueImportant";e="textCommuniqueNotRead";break;case!0:f="dx-icon-communiqueImportantRead";e=""}else switch(r[u].EmployeeCommuniqueStatus[0].Read){case!1:f="dx-icon-communiqueNotRead";e="textCommuniqueNotRead";break;case!0:f="dx-icon-communiqueRead";e=""}name=r[u].Subject;o.push({ID:r[u].Communique.Id,cssClass:f,cssClassText:e,Message:r[u].Communique.Message.replaceAll("<br>",""),SentOn:moment(r[u].Communique.SentOn).format("DD/MM/YYYY"),CreatedBy:r[u].Communique.CreatedBy.PassportName,Subject:r[u].Communique.Subject})}return o.length>0?n(!0):n(!1),t(new DevExpress.data.DataSource({store:o,searchOperation:"contains",searchExpr:["Subject","Message","SentOn","CreatedBy"]})),o}function f(){var o,r,f,e,u;if(i(2),$("#btnNotRead").removeClass("pressing"),$("#btnAllCom").removeClass("pressing"),$("#btnArchived").addClass("pressing"),o=[],r=VTPortal.roApp.userStatus().Communiques,r!=null&&r.length>0)for(f="",e="",u=0;u<r.length;u++)if(r[u].Communique.Archived==!0&&r[u].EmployeeCommuniqueStatus[0].Read==!0){if(r[u].Communique.MandatoryRead==!0)switch(r[u].EmployeeCommuniqueStatus[0].Read){case!1:f="dx-icon-communiqueImportant";e="textCommuniqueNotRead";break;case!0:f="dx-icon-communiqueImportantRead";e=""}else switch(r[u].EmployeeCommuniqueStatus[0].Read){case!1:f="dx-icon-communiqueNotRead";e="textCommuniqueNotRead";break;case!0:f="dx-icon-communiqueRead";e=""}name=r[u].Subject;o.push({ID:r[u].Communique.Id,cssClass:f,cssClassText:e,Message:r[u].Communique.Message,SentOn:moment(r[u].Communique.SentOn).format("DD/MM/YYYY"),CreatedBy:r[u].Communique.CreatedBy.PassportName,Subject:r[u].Communique.Subject})}return o.length>0?n(!0):n(!1),t(new DevExpress.data.DataSource({store:o,searchOperation:"contains",searchExpr:["Subject","Message","SentOn","CreatedBy"]})),o}function e(){var o,r,f,e,u;if(i(0),$("#btnNotRead").addClass("pressing"),$("#btnAllCom").removeClass("pressing"),$("#btnArchived").removeClass("pressing"),o=[],r=VTPortal.roApp.userStatus().Communiques,r!=null&&r.length>0)for(f="",e="",u=0;u<r.length;u++)if(r[u].EmployeeCommuniqueStatus[0].Read==!1){if(r[u].Communique.MandatoryRead==!0)switch(r[u].EmployeeCommuniqueStatus[0].Read){case!1:f="dx-icon-communiqueImportant";e="textCommuniqueNotRead";break;case!0:f="dx-icon-communiqueImportantRead";e=""}else switch(r[u].EmployeeCommuniqueStatus[0].Read){case!1:f="dx-icon-communiqueNotRead";e="textCommuniqueNotRead";break;case!0:f="dx-icon-communiqueRead";e=""}name=r[u].Subject;o.push({ID:r[u].Communique.Id,cssClass:f,cssClassText:e,Message:r[u].Communique.Message,SentOn:moment(r[u].Communique.SentOn).format("DD/MM/YYYY"),CreatedBy:r[u].Communique.CreatedBy.PassportName,Subject:r[u].Communique.Subject})}return o.length>0?n(!0):n(!1),t(new DevExpress.data.DataSource({store:o,searchOperation:"contains",searchExpr:["Subject","Message","SentOn","CreatedBy"]})),o}function o(){for(var n=0,t=$("div.smallTextDescriptionComm img"),n=0;n<t.length;n++)t[n].width>50&&t[n].classList.add("communiqueeImageList")}function s(){u().viewShown();VTPortal.roApp.refreshEmployeeStatus(!1,!1);i(1);r();o()}var n=ko.observable(!1),i=ko.observable(1),t=ko.observable(new DevExpress.data.DataSource({searchOperation:"contains",searchExpr:["Subject","Message","SentOn","CreatedBy"]})),u=ko.observable(VTPortal.bigUserInfo());return{viewShown:s,title:i18nextko.t("rocommuniquesTitle"),subscribeBlock:u(),communiqueDS:n,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),commScroll:{height:"70%",onPullDown:function(n){$.when(VTPortal.roApp.refreshEmployeeStatus(!1)).then(n.component.release());switch(i()){case 0:e();break;case 1:r();break;case 2:f()}}},listcommuniques:{dataSource:t,scrollingEnabled:!1,grouped:!1,itemTemplate:"communiqueItem",onItemClick:function(n){VTPortal.app.navigate("communiqueDetail/"+n.itemData.ID)},onItemRendered:function(){setTimeout(o,100)}},searchOptions:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(n){t().searchValue(n.value);t().load()}},notRead:{onClick:e,text:i18nextko.t("roNotRead")},allComm:{onClick:r,text:i18nextko.t("roAllComm")},archived:{onClick:f,text:i18nextko.t("roArchived")}}};VTPortal.accrualsHome=function(){function u(){VTPortal.roApp.db.settings.supervisorPortalEnabled?(VTPortal.roApp.selectedTab(3),VTPortal.app.navigate("scheduler/2",{root:!0})):(VTPortal.roApp.selectedTab(2),VTPortal.app.navigate("scheduler/2",{root:!0}))}var f=ko.observable(moment().add(-1,"days").toDate()),c=ko.observable(!1),i=ko.observable([]),t=ko.observable([]),n=ko.observable([]),o=ko.computed(function(){return VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&(VTPortal.roApp.empPermissions().Schedule.ScheduleAccruals||VTPortal.roApp.empPermissions().Schedule.ProductivAccruals)?!0:!1}),r=function(){if(f(moment().add(-1,"days").toDate()),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Holidays)(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&(VTPortal.roApp.empPermissions().Schedule.ScheduleAccruals||VTPortal.roApp.empPermissions().Schedule.ProductivAccruals||VTPortal.roApp.empPermissions().Schedule.QuerySchedule))&&new WebServiceRobotics(function(r){var u,e,f,o;if(r.Status==window.VTPortalUtils.constants.OK.value){if(VTPortal.roApp.lastOkAccruals(new Date),VTPortal.roApp.impersonatedIDEmployee!=-1?VTPortal.roApp.lastOkAccrualsEmployeeId(VTPortal.roApp.impersonatedIDEmployee):VTPortal.roApp.lastOkAccrualsEmployeeId(VTPortal.roApp.employeeId),VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Schedule.ScheduleAccruals){for(u=[],e=r.ScheduleSummary,e.WeekAccruals.length>0&&(u=u.concat(e.WeekAccruals)),e.MonthAccruals.length>0&&(u=u.concat(e.MonthAccruals)),e.YearAccruals.length>0&&(u=u.concat(e.YearAccruals)),e.ContractAccruals.length>0&&(u=u.concat(e.ContractAccruals)),f=0;f<u.length;f++)u[f].Name=u[f].Name+": "+u[f].TotalFormat;u=u.sortBy(function(n){return n.Name});t(u);VTPortal.roApp.scheduleDS(u)}if(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Schedule.QuerySchedule){if(u=[],e=r.HolidaysSummary,e.HolidaysInfo.length>0)for(u=u.concat(e.HolidaysInfo),f=0;f<u.length;f++)u[f].IDShift==-1?(u[f].Pending=i18nextko.i18n.t("roHolidayResume_Pending")+": "+u[f].Pending,u[f].Lasting=i18nextko.i18n.t("roHolidayResume_Lasting")+": "+u[f].Lasting,u[f].Available=i18nextko.i18n.t("roHolidayResume_Available")+": "+u[f].Available,u[f].Prevision=i18nextko.i18n.t("roHolidayResume_Prevision")+": "+u[f].Prevision,u[f].Done=u[f].Done>0?i18nextko.i18n.t("roHolidayResume_Done")+": "+u[f].Done:""):(u[f].Pending=i18nextko.i18n.t("roHolidayResume_Pending")+": "+u[f].Pending,u[f].Lasting=i18nextko.i18n.t("roHolidayResume_Lasting")+": "+u[f].Lasting,u[f].Available=i18nextko.i18n.t("roHolidayResume_Available")+": "+u[f].Available,u[f].Prevision=i18nextko.i18n.t("roHolidayResume_Prevision")+": "+u[f].Prevision,u[f].Done=i18nextko.i18n.t("roHolidayResume_Done")+": "+u[f].Done);u.length>0?(n(e.HolidaysInfo),VTPortal.roApp.holidaysDS(e.HolidaysInfo)):n([])}}else i([]),t([]),n([]),o=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(r,o)}).getAccrualsSummary(f());else{var r=function(){};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roIncorrectApiVersion"),"error",0,r)}},s=function(){if(VTPortal.roApp.lastOkAccruals()==null||VTPortal.roApp.lastOkAccrualsEmployeeId()!=VTPortal.roApp.employeeId||VTPortal.roApp.impersonatedIDEmployee!=-1)r();else{var i=new Date,u=VTPortal.roApp.lastOkAccruals().getDate();i.getDate()!=u?r():(VTPortal.roApp.scheduleDS()!=null?t(VTPortal.roApp.scheduleDS()):t([]),VTPortal.roApp.holidaysDS()!=null?n(VTPortal.roApp.holidaysDS()):n([]))}},e=ko.computed(function(){return i18nextko.i18n.t("accrualsTitle")}),h=ko.computed(function(){return i18nextko.i18n.t("noAccrualsDesc")});return{goToAccruals:u,viewShown:s,refreshAcc:r,scheduleDS:t,productivDS:i,hasPermission:o,holidaysDS:n,accrualsTitle:e,lblaccrualsDesc:e,accrualsTitleList:i18nextko.i18n.t("accrualsTitleList"),holidaysTitleList:i18nextko.i18n.t("holidaysTitleList"),listSchedule:{dataSource:t,activeStateEnabled:!1,scrollingEnabled:!1},listHolidays:{dataSource:n,activeStateEnabled:!1,scrollingEnabled:!1},listProductiV:{dataSource:i,scrollingEnabled:!1,grouped:!0,collapsibleGroups:!0,itemTemplate:"ProductiVItem",groupTemplate:function(){return $("<div>"+i18nextko.i18n.t("roResumeProductiV")+"<\/div>")}},lblnoAccrualsDesc:h,btnGoAccruals:{onClick:u,icon:"spinright"},iconAccruals:{onClick:u,icon:"columnchooser"}}};VTPortal.communiquesHome=function(){function i(){VTPortal.roApp.db.settings.supervisorPortalEnabled?(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.OnBoardings&&VTPortal.roApp.isSaas()==!0?VTPortal.roApp.selectedTab(6):VTPortal.roApp.selectedTab(5),VTPortal.app.navigate("communiques",{root:!0})):(VTPortal.roApp.selectedTab(4),VTPortal.app.navigate("communiques",{root:!0}))}var n=ko.observable(0),t=ko.observable(0),r=ko.computed(function(){return n()+t()}),u=ko.computed(function(){if(n(0),VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"&&VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Communiques){for(var t=0;t<VTPortal.roApp.userStatus().Communiques.length;++t)VTPortal.roApp.userStatus().Communiques[t].EmployeeCommuniqueStatus[0].Read==!1&&VTPortal.roApp.userStatus().Communiques[t].Communique.Archived==!1&&n(n()+1);return n()==0?(VTPortal.roApp.hasCommuniques(!1),i18nextko.i18n.t("nocommuniques")):(VTPortal.roApp.hasCommuniques(!0),i18nextko.i18n.t("newcommuniques")+n()+" "+i18nextko.i18n.t("newcommuniques2"))}return""}),f=ko.computed(function(){if(t(0),VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"&&VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Communiques){for(var n=0;n<VTPortal.roApp.userStatus().Communiques.length;++n)VTPortal.roApp.userStatus().Communiques[n].EmployeeCommuniqueStatus[0].Answered==!1&&VTPortal.roApp.userStatus().Communiques[n].Communique.AllowedResponses.length>0&&VTPortal.roApp.userStatus().Communiques[n].Communique.Archived==!1&&t(t()+1);return t()==0?(VTPortal.roApp.hasInquiries(!1),""):(VTPortal.roApp.hasInquiries(!0),i18nextko.i18n.t("newcommuniques")+t()+" "+i18nextko.i18n.t("newInquiries2"))}return""}),e=ko.computed(function(){return i18nextko.i18n.t("rocommuniquesTitle")}),o=function(){u();f()};return{viewShown:o,goToCommuniques:i,communiquesTitle:e,lblCommuniquesDesc:u,lblCommuniquesDescInquiries:f,btnGo:{onClick:i,text:r,visible:r},iconCommuniques:{onClick:i,icon:"comment"},hasCommuniques:ko.computed(function(){return VTPortal.roApp.hasCommuniques()==!0?"hasCommuniques":"hasCommuniquesNot"}),hasCommuniquesTitle:ko.computed(function(){return VTPortal.roApp.hasCommuniques()==!0?"mainTitle":"mainTitle"})}};VTPortal.emptyHome=function(){function n(){}return{viewShown:n}};VTPortal.notificationsHome=function(){function t(){VTPortal.roApp.selectedTab(1);VTPortal.app.navigate("alerts")}function u(){}var n=ko.observable(0),i=ko.computed(function(){return n(0),VTPortal.roApp.impersonatedIDEmployee==-1?VTPortal.roApp.db.settings.onlySupervisor?n(VTPortalUtils.utils.badgeCount(!0,!1,!1)):(n(VTPortalUtils.utils.badgeCount(!1)),VTPortal.roApp.db.settings.supervisorPortalEnabled&&VTPortal.roApp.impersonatedIDEmployee==-1&&n(VTPortalUtils.utils.badgeCount(!1))):n(VTPortalUtils.utils.badgeCount(!1)),VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"?n()==0?(VTPortal.roApp.hasNotifications(!1),i18nextko.i18n.t("noNotifications")):(VTPortal.roApp.hasNotifications(!0),i18nextko.i18n.t("newNotifications")+n()+i18nextko.i18n.t("newNotifications2")):""}),r=ko.computed(function(){return i18nextko.i18n.t("notificationsTitle")});return{goTo:t,notificationsTitle:r,viewShown:u,lblnotificationsDesc:i,btnGo:{onClick:t,text:n,visible:VTPortal.roApp.hasNotifications},iconNotifications:{onClick:t,icon:"message"},hasNotifications:ko.computed(function(){return"hasNotificationsNot"}),hasNotificationsTitle:ko.computed(function(){return"mainTitle"})}};VTPortal.punchesHome=function(){function n(){VTPortal.roApp.db.settings.supervisorPortalEnabled?(VTPortal.roApp.selectedTab(4),VTPortal.app.navigate("punchManagement/1/"+moment().format("YYYY-MM-DD"),{root:!0})):(VTPortal.roApp.selectedTab(3),VTPortal.app.navigate("punchManagement/1/"+moment().format("YYYY-MM-DD"),{root:!0}))}var t=ko.observable([]),r=ko.observable(new Date),u=ko.computed(function(){return VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().TaskTitle.length<=50?i18nextko.i18n.t("inTask")+VTPortal.roApp.userStatus().TaskTitle:i18nextko.i18n.t("inTask")+VTPortal.roApp.userStatus().TaskTitle.substr(0,48)+"...":""}),f=ko.computed(function(){return i18nextko.i18n.t("punchesTitle")}),e=ko.computed(function(){return i18nextko.i18n.t("noPunches")}),o=ko.computed(function(){VTPortal.roApp.newPunchDone()==!0&&i()}),i=function(){VTPortal.roApp.newPunchDone(!1);new WebServiceRobotics(function(n){var i,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(VTPortal.roApp.punchInProgress(!1),i=n.Punches,r=0;r<i.length;r++){switch(i[r].Type){case 1:case 2:case 3:case 7:i[r].TypeData!=null&&i[r].TypeData>0?i[r].ActualType==1?typeof i[r].InTelecommute!="undefined"&&i[r].InTelecommute.toLowerCase()=="true"?(i[r].cssClass="dx-icon-TATC_in",i[r].Name=i18nextko.i18n.t("roEntry")+": "+moment.tz(i[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")):(i[r].cssClass="dx-icon-TA_in_cause",i[r].Name=i18nextko.i18n.t("roPunches_TA_in_causeHome")+": "+moment.tz(i[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")):(i[r].cssClass="dx-icon-TA_out_cause",i[r].Name=i18nextko.i18n.t("roPunches_TA_out_causeHome")+": "+moment.tz(i[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")):i[r].ActualType==1?typeof i[r].InTelecommute!="undefined"&&i[r].InTelecommute.toLowerCase()=="true"?(i[r].cssClass="dx-icon-TATC_in",i[r].Name=i18nextko.i18n.t("roEntry")+": "+moment.tz(i[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")):(i[r].cssClass="dx-icon-TA_in",i[r].Name=i18nextko.i18n.t("roEntry")+": "+moment.tz(i[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")):(i[r].cssClass="dx-icon-TA_out",i[r].Name=i18nextko.i18n.t("roExit")+": "+moment.tz(i[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm"));i[r].hasAction=!0;break;case 4:i[r].cssClass="dx-icon-Task_change";i[r].hasAction=!1;i[r].Name=i18nextko.i18n.t("roPunches_Task_changeHome")+": "+moment.tz(i[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm");break;case 13:i[r].cssClass="dx-icon-CostCenter";i[r].hasAction=!1;i[r].Name=i18nextko.i18n.t("roPunches_CostCenter")+": "+moment.tz(i[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")}i[r].Value=i[r].RequestedTypeData!=""?i18nextko.i18n.t("roRequestPendingApprove")+i[r].RequestedTypeData:i[r].RelatedInfo}t(i);VTPortal.roApp.punchesDS(i)}else t([]),VTPortal.roApp.punchesDS([])}).getMyPunches(r.Value)};return{goToPunches:n,viewShown:i,punchesTitle:f,lblpunchesDesc:u,punchesDS:t,newPunchDone:o,noPunches:e,listOptions:{dataSource:VTPortal.roApp.punchesDS,scrollingEnabled:!1,grouped:!1,onItemClick:function(){n()}},btnGoPunches:{onClick:n,icon:"spinright"},removeButton:{icon:"clock",onClick:n}}};VTPortal.summaryHome=function(){"use strict";var n=ko.computed(function(){return VTPortal.roApp.lastRequestFailed()?"noConnection":"sandClock"}),t=ko.computed(function(){return VTPortal.roApp.db.settings.onlySupervisor}),i=ko.computed(function(){return VTPortal.roApp.lastRequestFailed()?"red":VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().PresenceStatus=="Inside"?"green":"red":"red"}),r=ko.computed(function(){if(VTPortal.roApp.lastRequestFailed())return i18nextko.i18n.t("roWithoutConnection");if(VTPortal.roApp.userStatus()!=null){var n=moment(VTPortal.roApp.userStatus().ServerDate),t=moment(VTPortal.roApp.userStatus().LastPunchDate),i=n.diff(t);return moment.duration(i).humanize()}return""}),u=ko.computed(function(){if(moment(n).format("D MM YYYY, h:mm:ss a"),VTPortal.roApp.lastRequestFailed())return VTPortal.roApp.isOnline(!1),i18nextko.i18n.t("roWithoutConnection");if(VTPortal.roApp.isOnline(!0),VTPortal.roApp.userStatus()!=null){var t=moment(),n=moment(VTPortal.roApp.userStatus().LastPunchDate),u=t.diff(n),i=t.diff(n,"days"),r=moment.utc(u).format("HH:mm");return VTPortal.roApp.userStatus().PresenceStatus=="Inside"?i>0?i18nextko.i18n.t("roFromDays")+i18nextko.i18n.t("roInFrom2")+" ("+moment(n).format("HH:mm")+"h)":r+" "+i18nextko.i18n.t("roInFrom2")+" ("+moment(n).format("HH:mm")+"h)":i>0?i18nextko.i18n.t("roFromDays")+i18nextko.i18n.t("roOutFrom2")+" ("+moment(n).format("HH:mm")+"h)":r+i18nextko.i18n.t("roOutFrom2")+" ("+moment(n).format("HH:mm")+"h)"}return""}),f=ko.computed(function(){if(VTPortal.roApp.userStatus()!=null){var n=moment(VTPortal.roApp.userStatus().ServerDate);return n.format("LT")}return""}),e=ko.computed(function(){if(VTPortal.roApp.userStatus()!=null){var n=moment(VTPortal.roApp.userStatus().ServerDate);return n.format("LL")}return""}),o=ko.computed(function(){return VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().EmployeeName:""}),s=ko.computed(function(){return VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().TaskTitle.length!=0?VTPortal.roApp.userStatus().TaskTitle.length<=50?i18nextko.i18n.t("inTask")+VTPortal.roApp.userStatus().TaskTitle:i18nextko.i18n.t("inTask")+VTPortal.roApp.userStatus().TaskTitle.substr(0,48)+"...":"":""}),h=ko.computed(function(){return VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().TaskDescription!=null&&VTPortal.roApp.userStatus().TaskDescription!=undefined&&VTPortal.roApp.userStatus().TaskDescription.length!=0?VTPortal.roApp.userStatus().TaskDescription.length<=50?VTPortal.roApp.userStatus().TaskDescription:VTPortal.roApp.userStatus().TaskDescription.substr(0,48)+"...":"":""}),c=ko.computed(function(){return i18nextko.i18n.t("statusTitle")}),l=ko.computed(function(){return VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().CostCenterName.length!=0?i18nextko.i18n.t("inCostCenter")+VTPortal.roApp.userStatus().CostCenterName:"":""});return{myTime:r,statusTitle:c,lblEmployeeStatusTime:u,textColor:i,lblUsername:o,lblServerTime:f,lblServerDate:e,lblProductivTask:s,lblProductivTaskDesc:h,lblCostCenter:l,statusIcon:n,isSupervisor:t}};VTPortal.surveysHome=function(){function t(){VTPortal.app.navigate("surveys",{root:!0})}var n=ko.observable(0),i=ko.computed(function(){return n()}),r=ko.computed(function(){if(n(0),VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"&&VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Surveys){if(typeof VTPortal.roApp.userStatus().Surveys!="undefined")for(var t=0;t<VTPortal.roApp.userStatus().Surveys.length;++t)n(n()+1);return n()==0?(VTPortal.roApp.hasSurveys(!1),i18nextko.i18n.t("nosurveys")):(VTPortal.roApp.hasSurveys(!0),i18nextko.i18n.t("newsurveys")+n()+" "+i18nextko.i18n.t("newsurveys2"))}return""}),u=ko.computed(function(){return i18nextko.i18n.t("rosurveysTitle")}),f=function(){r()};return{viewShown:f,goToSurveys:t,surveysTitle:u,lblSurveysDesc:r,btnGo:{onClick:t,text:i,visible:i},iconSurveys:{onClick:t,icon:"tips"},hasSurveys:ko.computed(function(){return VTPortal.roApp.hasSurveys()==!0?"hasSurveys":"hasSurveysNot"}),hasSurveysTitle:ko.computed(function(){return VTPortal.roApp.hasSurveys()==!0?"mainTitle":"mainTitle"})}};VTPortal.telecommutingHome=function(){"use strict";var n=ko.observable(null),t=ko.computed(function(){return n()!=null?n().TCToday.toLowerCase()=="true"?i18nextko.i18n.t("tcTodayHome"):n().NoWorkToday.toLowerCase()=="true"?i18nextko.i18n.t("tcNoWorkToday"):n().WorkcenterNameToday==""?i18nextko.i18n.t("tcTodayOfficeNWC"):i18nextko.i18n.t("tcTodayOffice")+n().WorkcenterNameToday:i18nextko.i18n.t("tcLoading")}),i=ko.computed(function(){return n()!=null?n().TCTomorrow.toLowerCase()=="true"?i18nextko.i18n.t("tcTomorrowHome"):n().NoWorkTomorrow.toLowerCase()=="true"?i18nextko.i18n.t("tcNoWorkTomorrow"):n().WorkcenterNameTomorrow==""?i18nextko.i18n.t("tcTomorrowOfficeNWC"):i18nextko.i18n.t("tcTomorrowOffice")+n().WorkcenterNameTomorrow:""}),r=ko.computed(function(){return i18nextko.i18n.t("roTeleworkingTitle")}),u=function(){new WebServiceRobotics(function(t){t.Status==window.VTPortalUtils.constants.OK.value?n(t):DevExpress.ui.notify(i18nextko.t("roTCError"),"warning",3e3)}).getTelecommutingInfo()},f=function(){u()};return{viewShown:f,telecommutingTitle:r,lblTCToday:t,lblTCTomorrow:i,iconTC:{icon:"map"}}};VTPortal.leaves=function(n){function s(){var i=moment(n.param);r.modelIsReady(!1);u.modelIsReady(!1);switch(t()){case 1:r.viewShown(i);break;case 2:u.viewShown(i)}}function v(){e().viewShown();s()}var t=ko.observable(1),i=ko.observable(0),e,h,c;typeof n.id!="undefined"&&(t(parseInt(n.id,10)),i(parseInt(n.id,10)-1));var r=VTPortal.myLeaves(),u=VTPortal.myLeavesAlerts(),l=ko.computed(function(){switch(t()){case 1:return i18nextko.i18n.t("roMyLeavesTitle");case 2:return i18nextko.i18n.t("roMyLeavesAletsTitle")}},this),o=ko.observable([]),a=ko.computed(function(){var t,i,n;if(typeof VTPortal.roApp.userStatus().ScheduleStatus.TrackingDocuments!="undefined"){for(t=VTPortal.roApp.userStatus().ScheduleStatus,i=0,n=0;n<t.TrackingDocuments.length;n++)t.TrackingDocuments[n].IdDaysAbsence>0&&t.TrackingDocuments[n].Scope==3&&i++;return i}return 0}),f=[];return f.push({ID:1,cssClass:"dx-icon-myLeaves"}),f.push({ID:2,cssClass:"dx-icon-myLeavesAlerts",badge:a()}),o(f),e=ko.observable(VTPortal.bigUserInfo()),h=function(n){t(n.ID);s();i(n.ID-1)},c={viewShown:v,title:l,subscribeBlock:e(),myLeavesBlock:r,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),myLeavesAlertsBlock:u,selectedView:t,selectedIndex:i,tabPanelOptions:{dataSource:o,selectedIndex:i,itemTemplate:"title",onSelectionChanged:function(n){h(n.addedItems[0])}}},c};VTPortal.myLeaves=function(){function i(){u();t(!0)}function u(){(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().LeavesEnabled)&&new WebServiceRobotics(function(t){var i,r,u;if(t.Status==window.VTPortalUtils.constants.OK.value){for(i=t.Leaves,r=0;r<i.length;r++)i[r].cssClass="dx-icon-Leave",i[r].Description=i18nextko.i18n.t("roLeavesFrom")+" "+moment.tz(i[r].BeginDate,VTPortal.roApp.serverTimeZone).format("L")+" "+i18nextko.i18n.t("roLeavesCause")+" "+i[r].Cause,i[r].hasAction=!0,i[r].AlertDescription=i[r].DocAlerts!=null&&i[r].DocAlerts.length>0?i[r].DocAlerts[0].Description:i18nextko.i18n.t("roLeavesNoAlerts");n(i);$("#scrollview").height($("#panelsContent").height()-70)}else n([]),u=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(t,u)}).getMyLeaves(!0,null,null)}var t=ko.observable(!1),n=ko.observable([]),r=ko.computed(function(){return VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().LeavesEnabled?!0:!1}),f=function(){VTPortal.app.navigate("newLeave/-1")};return{modelIsReady:t,viewShown:i,hasPermission:r,leavesDS:n,listLeaves:{dataSource:n,grouped:!1,scrollingEnabled:!1,onItemClick:function(n){n.itemData.hasAction&&VTPortal.app.navigate("sendLeaveDocument/-1/"+n.itemData.AbsenceID+"/"+n.itemData.IdCause+"/leave")}},newRequest:{onClick:f,text:"",icon:"Images/Common/plus.png",visible:VTPortal.roApp.ReadMode()==!1},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.myLeavesAlerts=function(){function i(){u();t(!0)}function u(){var t=VTPortal.roApp.userStatus().ScheduleStatus,e=[],f,i,r,u;if(t!=null&&(f="",typeof t.TrackingDocuments!="undefined"))for(f="dx-icon-trackingDocuments",i=0;i<t.TrackingDocuments.length;i++)r="days",u=0,t.TrackingDocuments[i].IdHoursAbsence>0?(r="hours",u=t.TrackingDocuments[i].IdHoursAbsence):t.TrackingDocuments[i].IdOvertimeForecast>0?(r="overtime",u=t.TrackingDocuments[i].IdOvertimeForecast):t.TrackingDocuments[i].IdDaysAbsence>0&&(r="days",u=t.TrackingDocuments[i].IdDaysAbsence),t.TrackingDocuments[i].Scope==3&&r=="days"&&e.push({ID:-1,IdDocumentTemplate:t.TrackingDocuments[i].IDDocumentTemplate,IdRelatedObject:u,IdCause:t.TrackingDocuments[i].IdCause,ForecatstType:r,NotificationDate:moment.tz(t.TrackingDocuments[i].DateTime,VTPortal.roApp.serverTimeZone),cssClass:f,name:i18nextko.i18n.t("roTrackingDocument"),hasAction:!0,type:"tracking",description:t.TrackingDocuments[i].Description,iDate:null});n(e)}var t=ko.observable(!1),n=ko.observable([]),r=ko.computed(function(){return VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().LeavesEnabled?!0:!1}),f=function(){VTPortal.app.navigate("newLeave/-1")};return{modelIsReady:t,viewShown:i,hasPermission:r,newRequest:{onClick:f,text:"",icon:"Images/Common/plus.png",visible:VTPortal.roApp.ReadMode()==!1},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),alertDS:n,listAlerts:{dataSource:n,scrollingEnabled:!1,grouped:!1,itemTemplate:"AlertItem",onItemClick:function(n){if(n.itemData.hasAction)switch(n.itemData.type){case"tracking":VTPortal.app.navigate("sendLeaveDocument/"+n.itemData.IdDocumentTemplate+"/"+n.itemData.IdRelatedObject+"/"+n.itemData.IdCause+"/"+n.itemData.ForecatstType)}}}}};VTPortal.newLeave=function(n){function b(){h().viewShown();e([]);w("causes.availableleave");o(!0)}function k(){var o=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},s=function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roLaveSaved"),"success",2e3),VTPortal.roApp.loadInitialData(!1,!1,!1,!1,!1)):VTPortalUtils.utils.processErrorMessage(n)},e,n;t==null&&(t=new WebServiceRobotics(s,o));e=f.getDocument();n=i()==null?VTPortalUtils.nullDate:moment(i());VTPortal.roApp.isModeApp()?t.saveLeaveMobile(n,n,r(),u(),e):t.saveLeaveDesktop(n,n,r(),u(),e)}var u=ko.observable(""),o=ko.observable(!1),s=ko.observable([]),f=new VTPortal.documentInput,a=ko.computed(function(){return s().length>0}),i=ko.observable(moment().toDate()),t,c,l;typeof n.iDate!="undefined"&&parseInt(n.iDate,10)!=-1&&i(moment(n.iDate,"YYYY-MM-DD"));var v=ko.computed(function(){return i18nextko.i18n.t("roRequestType_Leave")}),y=ko.computed(function(){return i18nextko.i18n.t("roSelectLeave")}),r=ko.observable(null),e=ko.observable([]),p=ko.computed(function(){return"80%"}),w=function(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)e(n.SelectFields),n.SelectFields.length>0&&r(n.SelectFields[0].FieldValue);else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},h=ko.observable(VTPortal.bigUserInfo());return t=null,c=function(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)s(n.SelectFields),f.initializeData(n.SelectFields,!1,-1);else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingCauseInfo"),"error",0,n)}).getRequieredLeaveDocuments(parseInt(n.value,10),!0)},l={viewShown:b,title:v,lblDocDate:i18nextko.t("roRequestDocRelatedDate"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:y,subscribeBlock:h(),scrollContent:{height:p},btnSave:{onClick:k,text:"",icon:"Images/Common/save.png",visible:o},remarks:{value:u},cmbRequestValue1:{dataSource:e,displayExpr:"FieldName",valueExpr:"FieldValue",value:r,onValueChanged:c},docDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:i,valueChangeEvent:"focusout"},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),myDocumentsBlock:f,hasDocuments:a},l};VTPortal.sendLeaveDocument=function(n){function tt(){w().viewShown();v(!0);u(null);h()!=-1&&nt()}function it(){var i,n,h;VTPortal.roApp.documentSent(!0);r()&&u()==null?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDateNeeded"),"error",0):VTPortal.roApp.isModeApp()==!1?(i=p(),n=new FormData,n.append("idTemplateDocument",t()!=-1?t():c()),n.append("idRelatedObject",f()),n.append("remarks",e()),n.append("docRelatedInfo",r()?moment(u()).format("YYYYMMDD"):""),n.append("forecastType",s()),n.append("userfile",i[0]),new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDocumentSaved"),"success",2e3),VTPortal.roApp.loadInitialData(!1,!1,!1,!1,!1);else{var t=function(){};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorUploadingFile"),"error",0,n)}).uploadDocumentDesktop(n)):(n=new FormData,n.append("idTemplateDocument",t()!=-1?t():c()),n.append("userfile",o()),n.append("idRelatedObject",f()),h=r()?moment(u()).format("YYYYMMDD"):"",new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDocumentSaved"),"success",2e3),VTPortal.roApp.redirectAtHome(),VTPortal.roApp.loadInitialData(!1,!1,!1,!1,!1);else{var t=function(){};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorUploadingFile"),"error",0,n)}).uploadDocumentMobile(n,s(),e(),h))}function rt(){if(VTPortalUtils.utils.isShowingPopup(!1),Object.has(navigator,"camera")){var n=function(){navigator.camera.getPicture(function(n){o(n);typeof device!="undefined"?cordova.platformId==="ios"?i(window.WkWebView.convertFilePath(n)):i(n):i(n)},function(n){n.includes("cancelled")||VTPortalUtils.utils.notifyMesage(n,"error",2e3)},{quality:75,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,targetWidth:768,targetHeight:1024,saveToPhotoAlbum:!1,correctOrientation:!0})},t=function(){navigator.camera.getPicture(function(n){o(n);typeof device!="undefined"?cordova.platformId==="ios"?i(window.WkWebView.convertFilePath(n)):i(n):i(n)},function(n){n.includes("cancelled")||VTPortalUtils.utils.notifyMesage(n,"error",2e3)},{quality:75,sourceType:Camera.PictureSourceType.CAMERA,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,targetWidth:768,targetHeight:1024,saveToPhotoAlbum:!1,correctOrientation:!0})};VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roSelectOrigin"),"info",0,n,t,i18nextko.i18n.t("roTakeFromLibrary"),i18nextko.i18n.t("roTakeFromCamera"))}else VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoCameraAvailable"),"error",0)}var t=ko.observable(-1),f=ko.observable(-1),e=ko.observable(""),r=ko.observable(!1),u=ko.observable(null),o=ko.observable(""),s=ko.observable(""),h=ko.observable(-1),k=ko.computed(function(){return t()==-1}),d=ko.computed(function(){return t()==-1?i18nextko.i18n.t("roRequestDocumentType"):i18nextko.i18n.t("roRequestSelectFile")}),v=ko.observable(!1),y=ko.observable(i18nextko.i18n.t("roFindFile")),p=ko.observableArray(),i=ko.observable(""),a,b;typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));typeof n.param!="undefined"&&parseInt(n.param,10)!=-1&&f(parseInt(n.param,10));typeof n.iDate!="undefined"&&parseInt(n.iDate,10)!=-1&&h(parseInt(n.iDate,10));typeof n.objId!="undefined"&&n.objId!=""&&s(n.objId);var c=ko.observable(t()),l=ko.observable([]),g=ko.computed(function(){return"76%"}),nt=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)l(n.SelectFields),t()!=-1&&a({value:t()+""});else{var i=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,i)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingCauseInfo"),"error",0,n)}).getRequieredLeaveDocuments(h(),!1)},w=ko.observable(VTPortal.bigUserInfo());return a=function(n){var i=n.value,t=null;$.grep(l(),function(n){n.FieldValue==i&&(t=n)});t!=null&&t.RelatedInfo=="1"?r(!0):r(!1)},b={viewShown:tt,title:i18nextko.t("roRequestType_SendDocument"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:d,lblImageCapture:i18nextko.t("roTakePhoto"),lblSelectFile:i18nextko.t("roSelectFile"),lblDocDate:i18nextko.t("roRequestDocRelatedDate"),subscribeBlock:w(),dateVisible:r,scrollContent:{height:g},btnSave:{onClick:it,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:v},remarks:{value:e},cmbRequestValue1:{dataSource:l,displayExpr:"FieldName",valueExpr:"FieldValue",value:c,visible:k,onValueChanged:a},docDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:u,valueChangeEvent:"focusout"},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),selectPhotoEvent:rt,imageSrc:i,appMode:VTPortal.roApp.isModeApp(),uploadOptions:{multiple:!1,accept:"*",value:p,uploadMode:"useForm",showFileList:!1,selectButtonText:y,onValueChanged:function(n){y(n.value[0].name)}}},b};VTPortal.myteam=function(n){function l(){var n,r;VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"&&VTPortal.roApp.loggedIn==!0&&(n=VTPortal.roApp.userStatus().SupervisorStatus,typeof n.Alerts!="undefined"&&t(n.Alerts.length),typeof n.DocumentAlerts!="undefined"&&t(t()+n.DocumentAlerts.AbsenteeismDocuments.length+n.DocumentAlerts.DocumentsValidation.length+n.DocumentAlerts.GpaAlerts.length+n.DocumentAlerts.MandatoryDocuments.length+n.DocumentAlerts.WorkForecastDocuments.length+n.DocumentAlerts.AccessAuthorizationDocuments.length),r=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value){VTPortal.roApp.lastOkRequests(new Date);VTPortal.roApp.requestsDS(n);var t=n.Requests;i(t.length);f()}else i(0),f()},new WebServiceRobotics(function(n){r(n)}).getSupervisedRequests(!1,moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").startOf("year").add(1,"year"),"0*1|1*2*3*4*5*6*7*8*9*10*11*12*13*14*15*16","RequestDate DESC"))}function f(){VTPortal.roApp.loggedIn||VTPortalUtils.utils.loginIfNecessary();var n=[];n.push({ID:1,Name:i18nextko.t("roMyTeamEmployees")});n.push({ID:2,Name:i18nextko.t("roMyTeamRequests"),Count:h});(VTPortal.roApp.userStatus().HasAlertPermission==!0||typeof VTPortal.roApp.userStatus().HasAlertPermission=="undefined")&&n.push({ID:3,Name:i18nextko.t("roMyTeamAlerts"),Count:c});r(n);setTimeout(function(){$("#scrollview").height($("#panelsContent").height())},100)}function a(){u().viewShown();l()}var i=ko.observable(0),t=ko.observable(0),e=ko.observable(1),o=ko.observable(0),v=ko.observable(!1);typeof n.id!="undefined"&&(e(parseInt(n.id,10)),o(parseInt(n.id,10)-1));var s=ko.computed(function(){return VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.SupervisorPortal?!0:!1}),r=ko.observable(new DevExpress.data.DataSource({store:[]})),u=ko.observable(VTPortal.bigUserInfo()),h=ko.computed(function(){return i()==0?i18nextko.i18n.t("noRequests"):i18nextko.i18n.t("newRequests")+i()+i18nextko.i18n.t("newRequests2")}),c=ko.computed(function(){return t()==0?i18nextko.i18n.t("noAlerts"):i18nextko.i18n.t("newAlerts")+t()+i18nextko.i18n.t("newAlerts2")});return{viewShown:a,title:i18nextko.i18n.t("roMySupervisorTitle"),subscribeBlock:u(),futureVersions:i18nextko.t("roMyTeamFutureVersions"),isSupervisorPortalActive:s,listOptions:{height:"100%",scrollingEnabled:!1,grouped:!1,dataSource:r,indicateLoading:!1,onItemClick:function(n){switch(n.itemData.ID){case 1:VTPortal.app.navigate("myTeamEmployees");break;case 2:VTPortal.app.navigate("myTeamRequests");break;case 3:VTPortal.app.navigate("myTeamAlerts");break;default:VTPortalUtils.utils.notifyMesage("not implemented","error",2e3)}}},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.myTeamAlerts=function(){var n=ko.observable([]),t=ko.observable(VTPortal.bigUserInfo()),i=function(){var i,u,f,r;if(t().viewShown(),i=VTPortal.roApp.userStatus().SupervisorStatus,u=[],i!=null&&(f="",typeof i.Alerts!="undefined"))for(r=0;r<i.Alerts.length;r++)switch(i.Alerts[r].AlertType){case 40:u.push({AlertType:i.Alerts[r].AlertType,cssClass:"dx-icon-request_pending",name:i18nextko.i18n.t("rorequest_pending"),hasAction:!0,type:"request",description:i.Alerts[r].Description});break;case 41:u.push({AlertType:i.Alerts[r].AlertType,cssClass:"dx-icon-employee_present_with_expired_documents",name:i18nextko.i18n.t("roemployee_present_with_expired_documents"),hasAction:!0,type:"request",description:i.Alerts[r].Description});break;case 19:u.push({AlertType:i.Alerts[r].AlertType,cssClass:"dx-icon-Day_With_Unmatched_Time_Record",name:i18nextko.i18n.t("Day_With_Unmatched_Time_Record"),hasAction:!0,type:"request",description:i.Alerts[r].Description});break;case 21:u.push({AlertType:i.Alerts[r].AlertType,cssClass:"dx-icon-Non_Justified_Incident",name:i18nextko.i18n.t("roNon_Justified_Incident"),hasAction:!0,type:"request",description:i.Alerts[r].Description});break;case 20:u.push({AlertType:i.Alerts[r].AlertType,cssClass:"dx-icon-Day_with_Unreliable_Time_Record",name:i18nextko.i18n.t("roDay_with_Unreliable_Time_Record"),hasAction:!0,type:"request",description:i.Alerts[r].Description});break;case 15:u.push({AlertType:i.Alerts[r].AlertType,cssClass:"dx-icon-Employee_Not_Arrived_or_Late",name:i18nextko.i18n.t("roEmployee_Not_Arrived_or_Late"),hasAction:!0,type:"request",description:i.Alerts[r].Description});break;case 43:u.push({AlertType:i.Alerts[r].AlertType,cssClass:"dx-icon-LabAgree_Max_Exceeded",name:i18nextko.i18n.t("roLabAgree_Max_Exceeded"),hasAction:!0,type:"request",description:i.Alerts[r].Description});break;case 44:u.push({AlertType:i.Alerts[r].AlertType,cssClass:"dx-icon-LabAgree_Min_Reached",name:i18nextko.i18n.t("roLabAgree_Min_Reached"),hasAction:!0,type:"request",description:i.Alerts[r].Description});break;case 24:u.push({AlertType:i.Alerts[r].AlertType,cssClass:"dx-icon-Task_Close_to_Start",name:i18nextko.i18n.t("roTask_Close_to_Start"),hasAction:!0,type:"request",description:i.Alerts[r].Description});break;case 23:u.push({AlertType:i.Alerts[r].AlertType,cssClass:"dx-icon-Task_Close_to_Finish",name:i18nextko.i18n.t("roTask_Close_to_Finish"),hasAction:!0,type:"request",description:i.Alerts[r].Description});break;case 25:u.push({AlertType:i.Alerts[r].AlertType,cssClass:"dx-icon-Task_Exceeding_Planned_Time",name:i18nextko.i18n.t("roTask_Exceeding_Planned_Time"),hasAction:!0,type:"request",description:i.Alerts[r].Description});break;case 29:u.push({AlertType:i.Alerts[r].AlertType,cssClass:"dx-icon-Task_exceeding_Started_Date",name:i18nextko.i18n.t("roTask_exceeding_Started_Date"),hasAction:!0,type:"request",description:i.Alerts[r].Description});break;case 26:u.push({AlertType:i.Alerts[r].AlertType,cssClass:"dx-icon-Task_Exceeding_Finished_Date",name:i18nextko.i18n.t("roTask_Exceeding_Finished_Date"),hasAction:!0,type:"request",description:i.Alerts[r].Description});break;case 30:u.push({AlertType:i.Alerts[r].AlertType,cssClass:"dx-icon-Task_With_ALerts",name:i18nextko.i18n.t("roTask_With_ALerts"),hasAction:!0,type:"request",description:i.Alerts[r].Description});break;case 45:u.push({AlertType:i.Alerts[r].AlertType,cssClass:"dx-icon-Tasks_Request_complete",name:i18nextko.i18n.t("roTasks_Request_complete"),hasAction:!0,type:"request",description:i.Alerts[r].Description});break;case 54:u.push({AlertType:i.Alerts[r].AlertType,cssClass:"dx-icon-Productive_Unit_Under_Coverage",name:i18nextko.i18n.t("roProductive_Unit_Under_Coverage"),hasAction:!0,type:"request",description:i.Alerts[r].Description});break;case 57:u.push({AlertType:i.Alerts[r].AlertType,cssClass:"dx-icon-Productive_Unit_Under_Coverage",name:i18nextko.i18n.t("roConsent_PortalAlert"),hasAction:!0,type:"request",description:i.Alerts[r].Description});break;case 58:u.push({AlertType:i.Alerts[r].AlertType,cssClass:"dx-icon-Productive_Unit_Under_Coverage",name:i18nextko.i18n.t("roConsent_DesktopAlert"),hasAction:!0,type:"request",description:i.Alerts[r].Description});break;case 59:u.push({AlertType:i.Alerts[r].AlertType,cssClass:"dx-icon-Productive_Unit_Under_Coverage",name:i18nextko.i18n.t("roConsent_TerminalAlert"),hasAction:!0,type:"request",description:i.Alerts[r].Description});break;case 60:u.push({AlertType:i.Alerts[r].AlertType,cssClass:"dx-icon-Productive_Unit_Under_Coverage",name:i18nextko.i18n.t("roConsent_VisitsAlert"),hasAction:!0,type:"request",description:i.Alerts[r].Description})}typeof i.DocumentAlerts!="undefined"&&(f="dx-icon-trackingDocuments",i.DocumentAlerts.AbsenteeismDocuments.length>0&&u.push({AlertType:-1,cssClass:"dx-icon-AbsenteeismDocuments",name:i18nextko.i18n.t("roAbsenteeismDocument"),hasAction:!0,type:"request",description:i18nextko.i18n.t("roAlertExists")+i.DocumentAlerts.AbsenteeismDocuments.length+i18nextko.i18n.t("roAlertAbsenteeism")}),i.DocumentAlerts.DocumentsValidation.length>0&&u.push({AlertType:-2,cssClass:"dx-icon-DocumentsValidation",name:i18nextko.i18n.t("roDocumentValidation"),hasAction:!0,type:"request",description:i18nextko.i18n.t("roAlertExists")+i.DocumentAlerts.DocumentsValidation.length+i18nextko.i18n.t("roAlertDocumentsValidation")}),i.DocumentAlerts.GpaAlerts.length>0&&u.push({AlertType:-3,cssClass:"dx-icon-GpaAlerts",name:i18nextko.i18n.t("roGpaDocument"),hasAction:!0,type:"request",description:i18nextko.i18n.t("roAlertExists")+i.DocumentAlerts.GpaAlerts.length+i18nextko.i18n.t("roAlertGpaAlerts")}),i.DocumentAlerts.MandatoryDocuments.length>0&&u.push({AlertType:-4,cssClass:"dx-icon-MandatoryDocuments",name:i18nextko.i18n.t("roMandatoryDocument"),hasAction:!0,type:"request",description:i18nextko.i18n.t("roAlertExists")+i.DocumentAlerts.MandatoryDocuments.length+i18nextko.i18n.t("roAlertMandatoryDocuments")}),i.DocumentAlerts.WorkForecastDocuments.length>0&&u.push({AlertType:-5,cssClass:"dx-icon-WorkForecastDocuments",name:i18nextko.i18n.t("roAccessForecastDocuments"),hasAction:!0,type:"request",description:i18nextko.i18n.t("roAlertExists")+i.DocumentAlerts.WorkForecastDocuments.length+i18nextko.i18n.t("roAlertForecastDocuments")}),i.DocumentAlerts.AccessAuthorizationDocuments.length>0&&u.push({AlertType:-6,cssClass:"dx-icon-AccessAuthorizationDocuments",name:i18nextko.i18n.t("roAccessAuthorizationDocument"),hasAction:!0,type:"request",description:i18nextko.i18n.t("roAlertExists")+i.DocumentAlerts.AccessAuthorizationDocuments.length+i18nextko.i18n.t("roAlertAccessAuthorization")}));n(u)},r=function(){VTPortal.roApp.refreshEmployeeStatus(!1,!0)};return{viewShown:i,title:i18nextko.t("roMyTeamAlerts"),subscribeBlock:t(),mtalertDS:n,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),btnRefresh:{onClick:r,text:"",icon:"Images/Common/refresh.png"},listAlerts:{dataSource:n,scrollingEnabled:!1,grouped:!1,itemTemplate:"AlertItem",onItemClick:function(n){if(n.itemData.hasAction)switch(n.itemData.AlertType){case 40:VTPortal.app.navigate("myTeamRequests/",{root:!0});break;default:VTPortal.app.navigate("myTeamAlertsDetail/"+n.itemData.AlertType)}}}}};VTPortal.myTeamAlertsDetail=function(n){var t=ko.observable(new DevExpress.data.DataSource({store:[],searchOperation:"contains",searchExpr:"description"})),i=ko.observable(VTPortal.bigUserInfo()),r=function(){var u,f,o,e,r;if(i().viewShown(),VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"&&VTPortal.roApp.loggedIn==!0&&(u=VTPortal.roApp.userStatus().SupervisorStatus,f=[],u!=null)){o="";e=!1;switch(parseInt(n.id,10)){case-1:for(r=0;r<u.DocumentAlerts.AbsenteeismDocuments.length;r++)f.push({ID:-1,IdDocumentTemplate:u.DocumentAlerts.AbsenteeismDocuments[r].IDDocumentTemplate,IdCause:u.DocumentAlerts.AbsenteeismDocuments[r].IdCause,NotificationDate:moment.tz(u.DocumentAlerts.AbsenteeismDocuments[r].DateTime,VTPortal.roApp.serverTimeZone),cssClass:"dx-icon-AbsenteeismDocuments",name:i18nextko.i18n.t("roAbsenteeismDocument"),hasAction:e,type:"tracking",description:u.DocumentAlerts.AbsenteeismDocuments[r].Description});break;case-2:for(r=0;r<u.DocumentAlerts.DocumentsValidation.length;r++)f.push({ID:-1,IdDocumentTemplate:u.DocumentAlerts.DocumentsValidation[r].IDDocumentTemplate,IdCause:u.DocumentAlerts.DocumentsValidation[r].IdCause,NotificationDate:moment.tz(u.DocumentAlerts.DocumentsValidation[r].DateTime,VTPortal.roApp.serverTimeZone),cssClass:"dx-icon-DocumentsValidation",name:i18nextko.i18n.t("roDocumentValidation"),hasAction:e,type:"tracking",description:u.DocumentAlerts.DocumentsValidation[r].Description});break;case-3:for(r=0;r<u.DocumentAlerts.GpaAlerts.length;r++)f.push({ID:-1,IdDocumentTemplate:u.DocumentAlerts.GpaAlerts[r].IDDocumentTemplate,IdCause:u.DocumentAlerts.GpaAlerts[r].IdCause,NotificationDate:moment.tz(u.DocumentAlerts.GpaAlerts[r].DateTime,VTPortal.roApp.serverTimeZone),cssClass:"dx-icon-GpaAlerts",name:i18nextko.i18n.t("roGpaDocument"),hasAction:e,type:"tracking",description:u.DocumentAlerts.GpaAlerts[r].Description});break;case-4:for(r=0;r<u.DocumentAlerts.MandatoryDocuments.length;r++)f.push({ID:-1,IdDocumentTemplate:u.DocumentAlerts.MandatoryDocuments[r].IDDocumentTemplate,IdCause:u.DocumentAlerts.MandatoryDocuments[r].IdCause,NotificationDate:moment.tz(u.DocumentAlerts.MandatoryDocuments[r].DateTime,VTPortal.roApp.serverTimeZone),cssClass:"dx-icon-MandatoryDocuments",name:i18nextko.i18n.t("roMandatoryDocument"),hasAction:e,type:"tracking",description:u.DocumentAlerts.MandatoryDocuments[r].Description});break;case-5:for(r=0;r<u.DocumentAlerts.WorkForecastDocuments.length;r++)f.push({ID:-1,IdDocumentTemplate:u.DocumentAlerts.WorkForecastDocuments[r].IDDocumentTemplate,IdCause:u.DocumentAlerts.WorkForecastDocuments[r].IdCause,NotificationDate:moment.tz(u.DocumentAlerts.WorkForecastDocuments[r].DateTime,VTPortal.roApp.serverTimeZone),cssClass:"dx-icon-WorkForecastDocuments",name:i18nextko.i18n.t("roAccessForecastDocuments"),hasAction:e,type:"tracking",description:u.DocumentAlerts.WorkForecastDocuments[r].Description});break;case-6:for(r=0;r<u.DocumentAlerts.AccessAuthorizationDocuments.length;r++)f.push({ID:-1,IdDocumentTemplate:u.DocumentAlerts.AccessAuthorizationDocuments[r].IDDocumentTemplate,IdCause:u.DocumentAlerts.AccessAuthorizationDocuments[r].IdCause,NotificationDate:moment.tz(u.DocumentAlerts.AccessAuthorizationDocuments[r].DateTime,VTPortal.roApp.serverTimeZone),cssClass:"dx-icon-AccessAuthorizationDocuments",name:i18nextko.i18n.t("roAccessAuthorizationDocument"),hasAction:e,type:"tracking",description:u.DocumentAlerts.AccessAuthorizationDocuments[r].Description});break;default:new WebServiceRobotics(function(i){var u,r;if(i.Status==window.VTPortalUtils.constants.OK.value){for(u=0;u<i.Alerts.length;u++){r="";switch(parseInt(n.id,10)){case 40:r="dx-icon-request_pending";break;case 41:r="dx-icon-employee_present_with_expired_documents";break;case 19:r="dx-icon-Day_with_Unreliable_Time_Record";break;case 21:r="dx-icon-Non_Justified_Incident";break;case 20:r="dx-icon-Day_with_Unreliable_Time_Record";break;case 15:r="dx-icon-Employee_Not_Arrived_or_Late";break;case 43:r="dx-icon-LabAgree_Max_Exceeded";break;case 44:r="dx-icon-LabAgree_Min_Reached";break;case 24:r="dx-icon-Task_Close_to_Start";break;case 23:r="dx-icon-Task_Close_to_Finish";break;case 25:r="dx-icon-Task_Exceeding_Planned_Time";break;case 29:r="dx-icon-Task_exceeding_Started_Date";break;case 26:r="dx-icon-Task_Exceeding_Finished_Date";break;case 30:r="dx-icon-Task_With_ALerts";break;case 45:r="dx-icon-Tasks_Request_complete";break;case 54:r="dx-icon-Productive_Unit_Under_Coverage";break;case 57:r="dx-icon-Productive_Unit_Under_Coverage";break;case 58:r="dx-icon-Productive_Unit_Under_Coverage";break;case 59:r="dx-icon-Productive_Unit_Under_Coverage";break;case 60:r="dx-icon-Productive_Unit_Under_Coverage"}f.push({ID:i.Alerts[u].Id,name:i.Alerts[u].Name,cssClass:r,description:i.Alerts[u].Description})}t(new DevExpress.data.DataSource({store:f,searchOperation:"contains",searchExpr:"description"}))}else VTPortalUtils.utils.processErrorMessage(i)}).getSupervisorAlertsDetail(parseInt(n.id,10))}t(new DevExpress.data.DataSource({store:f,searchOperation:"contains",searchExpr:"description"}));setTimeout(function(){$("#scrollview").height($("#panelsContent").height()-50)},100)}};return{viewShown:r,title:i18nextko.t("roMyTeamAlerts"),subscribeBlock:i(),loadingPanel:VTPortalUtils.utils.loadingPanelConf(),listAlerts:{dataSource:t,scrollingEnabled:!1,grouped:!1,itemTemplate:"AlertItem"},searchAlerts:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(n){t().searchValue(n.value);t().load()}}}};VTPortal.myTeamEmployees=function(){function f(){r().viewShown();n(!0);u&&i(!1);var f=function(){if(VTPortal.roApp.supervisedEmployees.length==0){var i=setTimeout(function(){n(!1)},6e4);new WebServiceRobotics(function(r){var u,f,e;if(n(!1),clearTimeout(i),r.Status==window.VTPortalUtils.constants.OK.value){for(u=r.Employees,f=0;f<u.length;f++){u[f].Image==""&&(u[f].Image=r.DefaultImage);e="";switch(u[f].PresenceStatus){case"Inside":e="employeeListPhoto";break;case"Outside":e="employeeListPhotoOut"}u[f].cssContainerClass=e;u[f].InTelecommute=="True"?(u[f].ImageTC="dx-icon-taTelecommuting_HomeList",u[f].InTelecommuteDesc="Teletrabajo casa teletrabajando tele teletreball teleworking telecommute telecommuting teleworking"):u[f].InTelecommuteDesc="oficina office centro centre workcenter";u[f].TaskTitle!=""&&u[f].TaskTitle!=null&&(u[f].TaskTitle=i18nextko.i18n.t("inTask")+u[f].TaskTitle);u[f].CostCenterName!=""&&u[f].CostCenterName!=null&&(u[f].CostCenterName=i18nextko.i18n.t("inCostCenter")+u[f].CostCenterName)}VTPortal.roApp.supervisedEmployees=r.Employees;t(new DevExpress.data.DataSource({store:u,searchOperation:"contains",searchExpr:["Name","Group","TaskTitle","CostCenterName","InTelecommuteDesc"]}))}else VTPortalUtils.utils.processErrorMessage(r)}).getMyEmployees()}else n(!1)};VTPortal.roApp.loggedIn?f():(n(!1),VTPortalUtils.utils.loginIfNecessary("",f))}var t=ko.observable(new DevExpress.data.DataSource({store:VTPortal.roApp.supervisedEmployees,searchOperation:"contains",searchExpr:["Name","Group","TaskTitle","CostCenterName","InTelecommuteDesc"]})),r=ko.observable(VTPortal.bigUserInfo()),n=ko.observable(!1),e=function(n){if(typeof n!="undefined"&&n!=null){var t=parseInt(n.itemData.EmployeeId,10);VTPortal.roApp.impersonatedIDEmployee=t;VTPortal.roApp.impersonatedNameEmployee=i18nextko.i18n.t("roProfileOf")+n.itemData.Name;VTPortal.roApp.loadInitialData(!0,!0,!0,!1,!1,function(){VTPortal.roApp.redirectAtHome()})}},o=ko.observable(!1),i=ko.observable(!1),u=ko.computed(function(){return!VTPortal.roApp.licenseAccepted()&&VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.LicenseAgreement&&VTPortal.roApp.impersonatedIDEmployee==-1}),s=ko.computed(function(){return VTPortal.roApp.licenseConsent()==null?i18nextko.i18n.t("roLicenseText"):VTPortal.roApp.licenseConsent().Message}),h=ko.computed(function(){return VTPortal.roApp.licenseConsent()==null?!1:!0}),c=function(){i()&&(VTPortal.roApp.licenseConsent()==null?new WebServiceRobotics(function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.db.settings.licenseAccepted=!0,VTPortal.roApp.db.settings.save(),VTPortal.roApp.licenseAccepted(!0)):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t(window.VTPortalUtils.utils.languageTag(n.Status)),"error",0)}).acceptMyLicense(i()):new WebServiceRobotics(function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.db.settings.licenseAccepted=!0,VTPortal.roApp.db.settings.save(),VTPortal.roApp.licenseAccepted(!0)):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t(window.VTPortalUtils.utils.languageTag(n.Status)),"error",0)}).acceptConsent(VTPortal.roApp.licenseConsent().Message))},l=function(){n(!0);new WebServiceRobotics(function(i){var r,u,f;if(n(!1),i.Status==window.VTPortalUtils.constants.OK.value){for(r=i.Employees,u=0;u<r.length;u++){r[u].Image==""&&(r[u].Image=i.DefaultImage);f="";switch(r[u].PresenceStatus){case"Inside":f="employeeListPhoto";break;case"Outside":f="employeeListPhotoOut"}r[u].cssContainerClass=f;r[u].InTelecommute=="True"&&(r[u].ImageTC="dx-icon-taTelecommuting_HomeList");r[u].TaskTitle!=""&&r[u].TaskTitle!=null&&(r[u].TaskTitle=i18nextko.i18n.t("inTask")+r[u].TaskTitle);r[u].CostCenterName!=""&&r[u].CostCenterName!=null&&(r[u].CostCenterName=i18nextko.i18n.t("inCostCenter")+r[u].CostCenterName)}VTPortal.roApp.supervisedEmployees=i.Employees;t(new DevExpress.data.DataSource({store:r,searchOperation:"contains",searchExpr:["Name","Group","TaskTitle","CostCenterName"]}))}else VTPortalUtils.utils.processErrorMessage(i)}).getMyEmployees()};return{viewShown:f,title:i18nextko.i18n.t("roMyTeamEmployees"),subscribeBlock:r(),listOptions:{dataSource:t,grouped:!1,indicateLoading:!1,pageLoadMode:"nextButton",height:"90%",itemTemplate:"item",onItemClick:e},btnRefresh:{onClick:l,text:"",icon:"Images/Common/refresh.png"},searchOptions:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(n){t().searchValue(n.value);t().load()}},licenceViewContent:{bounceEnabled:!0,showScrollbar:"always",height:200},lblTermsAndContidions:i18nextko.t("roTermsAndConditions"),customConsent:h,lbllicenseText:s,lbllicenseAdv1:i18nextko.t("roAgreement1"),lbllicenseAdv2:i18nextko.t("roAgreement2"),lbllicenseAdv3:i18nextko.t("roAgreement3"),licenseVisible:u,ckLicenceAccepted:{text:i18nextko.t("roLicenseAccept"),value:i,disabled:o},btnAcceptLicense:{onClick:c,text:i18nextko.t("roSaveLicense")},loadingPanel:{showPane:!1,height:110,shading:!0,shadingColor:"rgba(255,255,255,0.5)",indicatorSrc:"Images/DoubleRing.gif",visible:n}}};VTPortal.myTeamRequests=function(){function o(){u().viewShown();s()}function s(){var u,f,e;t(!1);r(!0);u=VTPortal.roApp.supervisorFilters();f=function(u){var e,o,s,f,h;if(r(!1),u.Status==window.VTPortalUtils.constants.OK.value){for(VTPortal.roApp.lastOkRequests(new Date),e=u.Requests,o=0;o<e.length;o++){e[o].Name=e[o].Name;e[o].hasAction=!0;s="";switch(e[o].Status){case 0:s="ro_Status_pending";break;case 1:s="ro_Status_ongoing";break;case 2:s="ro_Status_accepted";break;case 3:s="ro_Status_denied"}f="";switch(e[o].IdRequestType){case 1:f="dx-icon-userFieldChange";break;case 2:f="dx-icon-forbiddenPunch";break;case 3:f="dx-icon-justifyPunch";break;case 4:f="dx-icon-externalWorkResume";break;case 5:f="dx-icon-changeShift";break;case 6:f="dx-icon-plannedHoliday";break;case 7:f="dx-icon-plannedAbsences";break;case 8:f="dx-icon-shiftExchange";break;case 9:f="dx-icon-plannedCauses";break;case 10:f="dx-icon-forbiddenPunch";break;case 11:f="dx-icon-holidaysCancel";break;case 12:f="dx-icon-forbiddenPunch";break;case 13:f="dx-icon-plannedHoliday";break;case 14:f="dx-icon-plannedOvertime";break;case 15:f="dx-icon-externalWorkWeekResume";break;case 16:f="dx-icon-telecommute"}e[o].cssContainerClass=s;e[o].cssClass=f}i(e.length);n(new DevExpress.data.DataSource({store:e,searchOperation:"contains",searchExpr:"Name"}));setTimeout(function(){t()?$("#panelsContent").height($("#panelsContent").height()-80):$("#scrollview").height($("#panelsContent").height()-45)},100)}else i(0),n(new DevExpress.data.DataSource({store:[],searchOperation:"contains",searchExpr:"Name"})),h=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(u,h)};u==null?(t(!1),e=VTPortal.roApp.requestsDS(),e!=null&&typeof e.Requests!="undefined"?(VTPortal.roApp.requestsDS(null),f(e)):new WebServiceRobotics(function(n){f(n)}).getSupervisedRequests(!1,moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").startOf("year").add(1,"year"),"0*1|1*2*3*4*5*6*7*8*9*10*11*12*13*14*15*16","RequestDate DESC",moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").add(1,"year"))):(t(!0),new WebServiceRobotics(function(n){f(n)}).getSupervisedRequests(!1,u.filter.iDate,u.filter.eDate,u.filter.status.join("*")+"|"+u.filter.types.join("*"),u.order.by+" "+u.order.direction,u.filter.iRequestedDate,u.filter.eRequestedDate))}var i=ko.observable(0),n=ko.observable(new DevExpress.data.DataSource({store:[],searchOperation:"contains",searchExpr:"Name"})),f=ko.observable(!1),t=ko.observable(!1),r=ko.observable(!1),e=ko.computed(function(){return VTPortal.roApp.supervisorFilters()!=null?i18nextko.i18n.t("roFilteringData"):""}),u=ko.observable(VTPortal.bigUserInfo()),h=function(){f(!1);VTPortal.app.navigate("RequestFilters/4")};return{viewShown:o,title:i18nextko.i18n.t("roMyTeamRequests"),subscribeBlock:u(),requestsDS:i,dataFiltered:t,filterDescription:e,listRequests:{dataSource:n,scrollingEnabled:!1,grouped:!1,itemTemplate:"RequestItem",onItemClick:function(n){if(n.itemData.hasAction)if(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.NewRequests){n.itemData.IdRequestType!=7&&n.itemData.IdRequestType!=6&&n.itemData.IdRequestType!=9&&n.itemData.IdRequestType!=13&&n.itemData.IdRequestType!=2&&n.itemData.IdRequestType!=10&&n.itemData.IdRequestType!=12&&(VTPortal.roApp.impersonateOnlyRequest=!0,VTPortal.roApp.impersonatedIDEmployee=n.itemData.IdEmployee,VTPortal.roApp.impersonatedNameEmployee=i18nextko.i18n.t("roProfileOf")+n.itemData.Name,VTPortal.roApp.loadInitialData(!0,!1,!1,!1,!1));switch(n.itemData.IdRequestType){case 1:VTPortal.app.navigate("userFields/"+n.itemData.Id);break;case 2:case 10:case 12:VTPortal.app.navigate("forgotten/"+n.itemData.Id);break;case 3:VTPortal.app.navigate("justifyPunch/"+n.itemData.Id);break;case 4:VTPortal.app.navigate("externalWork/"+n.itemData.Id);break;case 5:VTPortal.app.navigate("changeShift/"+n.itemData.Id);break;case 6:case 7:case 9:case 13:VTPortal.app.navigate("absence/"+n.itemData.Id);break;case 8:VTPortal.app.navigate("shiftExchange/"+n.itemData.Id);break;case 11:VTPortal.app.navigate("cancelHolidays/"+n.itemData.Id);break;case 14:VTPortal.app.navigate("plannedOvertime/"+n.itemData.Id);break;case 15:VTPortal.app.navigate("externalWorkWeekResume/"+n.itemData.Id);break;case 16:VTPortal.app.navigate("telecommute/"+n.itemData.Id)}}else{VTPortal.roApp.impersonateOnlyRequest=!0;VTPortal.roApp.impersonatedIDEmployee=n.itemData.IdEmployee;VTPortal.roApp.impersonatedNameEmployee=i18nextko.i18n.t("roProfileOf")+n.itemData.Name;VTPortal.roApp.loadInitialData(!0,!1,!1,!1,!1);switch(n.itemData.IdRequestType){case 1:VTPortal.app.navigate("userFields/"+n.itemData.Id);break;case 2:VTPortal.app.navigate("forgottenPunch/"+n.itemData.Id);break;case 3:VTPortal.app.navigate("justifyPunch/"+n.itemData.Id);break;case 4:VTPortal.app.navigate("externalWork/"+n.itemData.Id);break;case 5:VTPortal.app.navigate("changeShift/"+n.itemData.Id);break;case 6:VTPortal.app.navigate("plannedHoliday/"+n.itemData.Id);break;case 7:VTPortal.app.navigate("plannedAbsence/"+n.itemData.Id);break;case 8:VTPortal.app.navigate("shiftExchange/"+n.itemData.Id);break;case 9:VTPortal.app.navigate("plannedCause/"+n.itemData.Id);break;case 10:VTPortal.app.navigate("forgottenPunch/"+n.itemData.Id);break;case 11:VTPortal.app.navigate("cancelHolidays/"+n.itemData.Id);break;case 12:VTPortal.app.navigate("forgottenPunch/"+n.itemData.Id);break;case 13:VTPortal.app.navigate("plannedHoliday/"+n.itemData.Id);break;case 14:VTPortal.app.navigate("plannedOvertime/"+n.itemData.Id);break;case 15:VTPortal.app.navigate("externalWorkWeekResume/"+n.itemData.Id)}}}},btnFilterRequests:{onClick:h,text:"",icon:"Images/Common/filter.png"},searchOptions:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(t){n().searchValue(t.value);n().load()}},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.onboardingDetail=function(n){function f(n,r,u){var f=!1;f=n==!1?!0:!1;new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value){var r=n.Tasks;i(!0);t(new DevExpress.data.DataSource({store:r,sort:"Done",searchOperation:"contains",searchExpr:["TaskName"]}))}else VTPortalUtils.utils.processErrorMessage(n)}).updateTaskStatus(f,r,u)}function e(n,t,i){var r=$("<div>").attr("class","listMenuItemContentOnb");n.Done==!0?(r.append($("<div />").attr("style","float:left;margin-top: 10px;").dxCheckBox({value:n.Done})),r.append($("<div>").attr("style","margin-left: 50px; margin-top: -5px;font-size: 13px;").text(n.TaskName)),r.append($("<div>").attr("class","smallTextDescriptionOnb").attr("style","float:right;").text(n.SupervisorName)),r.append($("<div>").attr("class","smallTextDescriptionOnb").attr("style","margin-left:50px;").text(n.LastChangeDate))):(r.append($("<div />").attr("style","float:left;").dxCheckBox({value:n.Done})),r.append($("<div>").attr("style","margin-left: 50px; margin-top: -5px;font-size: 13px;").text(n.TaskName)));i.append(r)}function o(){r().viewShown();u()}var i=ko.observable(),t=ko.observable(new DevExpress.data.DataSource({searchOperation:"contains",searchExpr:["TaskName"]})),r=ko.observable(VTPortal.bigUserInfo()),u=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value){var r=n.Tasks;i(!0);t(new DevExpress.data.DataSource({store:r,sort:"Done",searchOperation:"contains",searchExpr:["TaskName"]}))}else i(!1),VTPortalUtils.utils.processErrorMessage(n)}).getOnBoardingtasksById(n.id)};return{viewShown:o,title:"OnBoarding",subscribeBlock:r(),taskDS:i,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),commScroll:{height:"70%",onPullDown:function(){u()}},listtasks:{dataSource:t,scrollingEnabled:!1,grouped:!1,itemTemplate:e,noDataText:"Todava no se han creado tareas",onItemClick:function(n){f(n.itemData.Done,n.itemData.Id,n.itemData.IdList)}},searchOptions:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(n){t().searchValue(n.value);t().load()}}}};VTPortal.onboardings=function(){function r(){var i=[];return new WebServiceRobotics(function(t){var i,r;if(t.Status==window.VTPortalUtils.constants.OK.value){for(i=t.OnBoardings,r=0;r<i.length;r++)i[r].StartDate=moment(i[r].StartDate).format("DD-MM-YYYY");n(new DevExpress.data.DataSource({store:i,sort:"EmployeeName",searchOperation:"contains",searchExpr:["EmployeeName","Comments","Status"]}))}else VTPortalUtils.utils.processErrorMessage(t)}).getMyOnBoardings(),i.length>0?t(!0):t(!0),i}function u(){i().viewShown();r()}function f(n,t,i){if(n.Status!=null){var u=n.Status.split("/"),f=$("<div style='background:"+n.Image+"' class='listMenuItemIcon EmployeeImagePhoto' />"),r=$("<div>").attr("class","listMenuItemContent");r.append($("<div>").attr("class",n.cssClassText).text(n.EmployeeName));r.append($("<span>").attr("style","float:right;margin-top: 6px;font-size: 11px;").text(n.StartDate));r.append($("<div />").dxProgressBar({min:0,max:parseInt(u[1],10),value:parseInt(u[0],10),width:150,statusFormat:function(t){return"Estado: "+n.Status+" ("+Math.round(t*100)+"%)"}}));r.append($("<div>").attr("class","smallTextDescriptionOnb").text(n.Comments));i.append(f,r)}}var t=ko.observable(!1),n=ko.observable(new DevExpress.data.DataSource({searchOperation:"contains",searchExpr:["EmployeeName","Comments","Status"]})),i=ko.observable(VTPortal.bigUserInfo());return{viewShown:u,title:"OnBoarding",subscribeBlock:i(),onboardingDS:t,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),commScroll:{height:"70%",onPullDown:function(){r()}},listProgress:{min:0,max:100,value:63},listonboardings:{dataSource:n,scrollingEnabled:!1,grouped:!1,itemTemplate:f,onItemClick:function(n){VTPortal.app.navigate("onboardingDetail/"+n.itemData.IdList)}},searchOptions:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(t){n().searchValue(t.value);n().load()}}}};VTPortal.bigUserInfo=function(){function a(n,t,i){var u=i/10,r;if(n==""&&(n="../2/Images/path2994-7-7-6.png"),r=n,t==null)return"background: url("+r+") no-repeat center; background-size: contain !important;height:100%;opacity:"+u+"";switch(t){case 4:return"background: url("+r+") no-repeat center; background-size: cover !important;height:100%;opacity:"+u+"";case 3:return"background: url("+r+") no-repeat right; background-size: contain !important;height:100%;opacity:"+u+"";case 2:return"background: url("+r+") no-repeat center; background-size: contain !important;height:100%;opacity:"+u+"";case 1:return"background: url("+r+") no-repeat left; background-size: contain !important;height:100%;opacity:"+u+"";default:return"background: url("+r+") no-repeat center; background-size: contain !important;height:100%;opacity:"+u+""}return""}function v(n,t){return VTPortal.roApp.impersonatedIDEmployee==-1?((n==null||n=="")&&(n="#FF5C35"),(t==null||t=="")&&(t="#f8aa32")):(n="#5b757d",t="#9ac5d2"),"background: linear-gradient(to right, "+n+", "+t+");background-size: contain !important;"}function et(){if(VTPortalUtils.utils.isShowingPopup(!1),Object.has(navigator,"camera")){var n=function(){navigator.camera.getPicture(function(n){u(n);typeof device!="undefined"?cordova.platformId==="ios"?t(window.WkWebView.convertFilePath(n)):t(n):t(n)},function(n){n.includes("cancelled")||VTPortalUtils.utils.notifyMesage(n,"error",2e3)},{quality:50,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,targetWidth:200,targetHeight:200,saveToPhotoAlbum:!1,correctOrientation:!0})},i=function(){navigator.camera.getPicture(function(n){u(n);typeof device!="undefined"?cordova.platformId==="ios"?t(window.WkWebView.convertFilePath(n)):t(n):t(n)},function(n){n.includes("cancelled")||VTPortalUtils.utils.notifyMesage(n,"error",2e3)},{quality:50,sourceType:Camera.PictureSourceType.CAMERA,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,targetWidth:200,targetHeight:200,saveToPhotoAlbum:!1,correctOrientation:!0})};VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roSelectOrigin"),"info",0,n,i,i18nextko.i18n.t("roTakeFromLibrary"),i18nextko.i18n.t("roTakeFromCamera"))}else VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoCameraAvailable"),"error",0)}function ct(){VTPortal.roApp.loggedIn&&new WebServiceRobotics(function(n){window.VTPortalUtils.utils.onLogoutSuccessFunc(n)},function(n){window.VTPortalUtils.utils.onLogoutErrorFunc(n)}).logout()}var e=ko.observable([]),i=ko.observable(!1),o=ko.observableArray(),lt=ko.observable(0),at=ko.observable(0),t=ko.observable(""),u=ko.observable(""),s=ko.observable(i18nextko.i18n.t("roFindFile")),n=ko.observable([]),f=ko.observable(""),h=ko.observable(""),c=ko.computed(function(){return VTPortal.roApp.impersonatedIDEmployee!=-1}),l=ko.computed(function(){return VTPortalUtils.utils.badgeCount(!0)>0?"!":""}),y=function(){var t=1;if(n([]),VTPortal.roApp.db.settings.onlySupervisor)if(VTPortal.roApp.impersonatedIDEmployee==-1)n().push({ID:t,ActionIndex:15,Name:i18nextko.t("roHomeMyTeamEmployees")}),t=t+1,VTPortal.roApp.userStatus()==null?(n().push({ID:t,ActionIndex:16,Name:i18nextko.t("roHomeMyTeamAlerts")}),t=t+1):(typeof VTPortal.roApp.userStatus().HasAlertPermission=="undefined"||VTPortal.roApp.userStatus().HasAlertPermission==!0)&&(n().push({ID:t,ActionIndex:16,Name:i18nextko.t("roHomeMyTeamAlerts")}),t=t+1),n().push({ID:t,ActionIndex:17,Name:i18nextko.t("roHomeMyTeamRequests")}),t=t+1,VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.OnBoardings&&VTPortal.roApp.isSaas()==!0&&(n().push({ID:t,ActionIndex:20,Name:"onboarding"}),t=t+1);else{n().push({ID:t,ActionIndex:1,Name:i18nextko.t("roHomeTitle")});t=t+1;n().push({ID:t,ActionIndex:2,Name:i18nextko.t("roGHMenuTitle")});t=t+1;n().push({ID:t,ActionIndex:3,Name:i18nextko.t("roPunchesTitle")});t=t+1;try{VTPortal.roApp.empPermissions()!=null&&(VTPortal.roApp.empPermissions().Requests[3].Permission==!0||VTPortal.roApp.empPermissions().Requests[14].Permission==!0)&&(n().push({ID:t,ActionIndex:4,Name:i18nextko.t("roHomeWorkingTitle")}),t=t+1)}catch(i){}n().push({ID:t,ActionIndex:6,Name:i18nextko.t("roHomeLeavesTitle")});t=t+1;n().push({ID:t,ActionIndex:7,Name:i18nextko.t("roHomeProfile")});t=t+1}else if(VTPortal.roApp.db.settings.supervisorPortalEnabled)if(VTPortal.roApp.impersonatedIDEmployee==-1){n().push({ID:t,ActionIndex:1,Name:i18nextko.t("roHomeTitle")});t=t+1;n().push({ID:t,ActionIndex:18,Name:i18nextko.t("roHomeTeam"),badge:l});t=t+1;n().push({ID:t,ActionIndex:2,Name:i18nextko.t("roGHMenuTitle")});t=t+1;n().push({ID:t,ActionIndex:3,Name:i18nextko.t("roPunchesTitle")});t=t+1;VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.OnBoardings&&VTPortal.roApp.isSaas()==!0&&(n().push({ID:t,ActionIndex:20,Name:"onboarding"}),t=t+1);VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Communiques&&(n().push({ID:t,ActionIndex:19,Name:i18nextko.t("roHomeCommunique")}),t=t+1);try{VTPortal.roApp.empPermissions()!=null&&(VTPortal.roApp.empPermissions().Requests[3].Permission==!0||VTPortal.roApp.empPermissions().Requests[14].Permission==!0)&&(n().push({ID:t,ActionIndex:4,Name:i18nextko.t("roHomeWorkingTitle")}),t=t+1)}catch(i){}n().push({ID:t,ActionIndex:5,Name:i18nextko.t("roHomeDocumentsTitle")});t=t+1;n().push({ID:t,ActionIndex:6,Name:i18nextko.t("roHomeLeavesTitle")});t=t+1;n().push({ID:t,ActionIndex:7,Name:i18nextko.t("roHomeProfile")});t=t+1}else{n().push({ID:t,ActionIndex:1,Name:i18nextko.t("roHomeTitle")});t=t+1;n().push({ID:t,ActionIndex:2,Name:i18nextko.t("roGHMenuTitle")});t=t+1;n().push({ID:t,ActionIndex:3,Name:i18nextko.t("roPunchesTitle")});t=t+1;try{VTPortal.roApp.empPermissions()!=null&&(VTPortal.roApp.empPermissions().Requests[3].Permission==!0||VTPortal.roApp.empPermissions().Requests[14].Permission==!0)&&(n().push({ID:t,ActionIndex:4,Name:i18nextko.t("roHomeWorkingTitle")}),t=t+1)}catch(i){}n().push({ID:t,ActionIndex:6,Name:i18nextko.t("roHomeLeavesTitle")});t=t+1;n().push({ID:t,ActionIndex:7,Name:i18nextko.t("roHomeProfile")});t=t+1}else{n().push({ID:t,ActionIndex:1,Name:i18nextko.t("roHomeTitle")});t=t+1;n().push({ID:t,ActionIndex:2,Name:i18nextko.t("roGHMenuTitle")});t=t+1;n().push({ID:t,ActionIndex:3,Name:i18nextko.t("roPunchesTitle")});t=t+1;VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Communiques&&(n().push({ID:t,ActionIndex:19,Name:i18nextko.t("roHomeCommunique")}),t=t+1);try{VTPortal.roApp.empPermissions()!=null&&(VTPortal.roApp.empPermissions().Requests[3].Permission==!0||VTPortal.roApp.empPermissions().Requests[14].Permission==!0)&&(n().push({ID:t,ActionIndex:4,Name:i18nextko.t("roHomeWorkingTitle")}),t=t+1)}catch(i){}n().push({ID:t,ActionIndex:5,Name:i18nextko.t("roHomeDocumentsTitle")});t=t+1;n().push({ID:t,ActionIndex:6,Name:i18nextko.t("roHomeLeavesTitle")});t=t+1;n().push({ID:t,ActionIndex:7,Name:i18nextko.t("roHomeProfile")});t=t+1}e(n());VTPortal.roApp.impersonatedIDEmployee==-1?(VTPortal.roApp.userStatus()!=null&&f(VTPortal.roApp.userStatus().EmployeeName),VTPortal.roApp.LastLogin()!=null&&h(i18nextko.i18n.t("roLastLogin")+": "+moment(VTPortal.roApp.LastLogin()).format("DD MMMM YYYY, HH:mm:ss"))):f(VTPortal.roApp.impersonatedNameEmployee)},p=ko.computed(function(){return"url(data:image/png;base64,"+VTPortal.roApp.userPhoto()+") no-repeat center center"}),w=ko.computed(function(){return VTPortal.roApp.lastRequestFailed()?"noConnection":"sandClock"}),b=ko.computed(function(){return VTPortal.roApp.db.settings.onlySupervisor&&VTPortal.roApp.impersonatedIDEmployee==-1?!1:!0}),k=ko.computed(function(){return VTPortal.roApp.impersonatedIDEmployee==-1?VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"?VTPortal.roApp.userStatus().PresenceStatus=="Inside"?"":"":"":""}),d=ko.computed(function(){return VTPortal.roApp.lastRequestFailed()?"red":VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().PresenceStatus=="Inside"?"green":"red":"red"}),g=ko.computed(function(){if(VTPortal.roApp.lastRequestFailed())return i18nextko.i18n.t("roWithoutConnection");if(VTPortal.roApp.userStatus()!=null){var n=moment(VTPortal.roApp.userStatus().ServerDate),t=moment(VTPortal.roApp.userStatus().LastPunchDate),i=n.diff(t);return moment.duration(i).humanize()}return""}),nt=ko.computed(function(){if(moment(n).format("D MM YYYY, h:mm:ss a"),VTPortal.roApp.lastRequestFailed())return i18nextko.i18n.t("roWithoutConnection");if(VTPortal.roApp.userStatus()!=null){var i=moment(VTPortal.roApp.userStatus().ServerDate),n=moment(VTPortal.roApp.userStatus().LastPunchDate),r=i.diff(n),t=moment.utc(r).format("HH:mm [horas]");return VTPortal.roApp.userStatus().PresenceStatus=="Inside"?i18nextko.i18n.t("roInFrom")+moment(n).format("HH:mm")+" ("+t+"h)":i18nextko.i18n.t("roOutFrom")+moment(n).format("HH:mm")+" ("+t+"h)"}return""}),tt=ko.computed(function(){if(VTPortal.roApp.userStatus()!=null){var n=moment(VTPortal.roApp.userStatus().ServerDate);return n.format("LT")}return""}),vt=ko.computed(function(){return VTPortal.roApp.showLogoutHome()!=null&&VTPortal.roApp.db.settings.ApiVersion>VTPortalUtils.apiVersion.CauseNote&&VTPortal.roApp.impersonatedIDEmployee==-1?VTPortal.roApp.showLogoutHome():!1}),it=ko.computed(function(){if(VTPortal.roApp.userStatus()!=null){var n=moment(VTPortal.roApp.userStatus().ServerDate);return n.format("dddd DD MMM")}return""}),rt=ko.computed(function(){return moment().hour()<13&&moment().hour()>5?i18nextko.i18n.t("roWelcomeMorning"):moment().hour()>12&&moment().hour()<21?i18nextko.i18n.t("roWelcomeAfter"):i18nextko.i18n.t("roWelcomeNight")}),ut=ko.computed(function(){return VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().TaskTitle.length<=50?VTPortal.roApp.userStatus().TaskTitle:VTPortal.roApp.userStatus().TaskTitle.substr(0,48)+"...":""}),r=null,ft=function(){var t=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingPhoto"),"error",0);i(!1)},f=function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.loadInitialData(!0,!1,!1,!1,!1),VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roProfilePhotoSaved"),"success",2e3)):VTPortalUtils.utils.processErrorMessage(n);i(!1)},n;r==null&&(r=new WebServiceRobotics(f,t));n=new FormData;VTPortal.roApp.isModeApp()==!1?n.append("userfile",o()[0]):n.append("userfile",u());VTPortal.roApp.isModeApp()?r.saveProfileImageMobile(n):r.saveProfileImageDesktop(n)},ot=ko.computed(function(){return VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().CostCenterName:""}),st=ko.computed(function(){return VTPortal.roApp.customBackground()!=null?(VTPortal.roApp.HasCustomHeader(!0),v(VTPortal.roApp.customBackground().LeftColor,VTPortal.roApp.customBackground().RightColor)):(VTPortal.roApp.HasCustomHeader(!1),"")}),ht=ko.computed(function(){return VTPortal.roApp.customBackground()!=null?(VTPortal.roApp.HasCustomHeader(!0),a(VTPortal.roApp.customBackground().Image,VTPortal.roApp.customBackground().Position,VTPortal.roApp.customBackground().Opacity)):(VTPortal.roApp.HasCustomHeader(!1),"")});return{viewShown:y,changeUserPhotoVisible:i,empImage:p,borderBottom:k,myTime:g,lblEmployeeStatusTime:nt,textColor:d,lblWelcome:rt,photoVisible:b,lblUsername:f,lblLastLogin:h,lblServerTime:tt,lblServerDate:it,lblProfile:i18nextko.t("roProfileOf"),isSupervisor:c,lblProductivTask:ut,lblProfileImage:i18nextko.t("roProfileImage"),selectPhotoEvent:et,imageSrc:t,appMode:VTPortal.roApp.isModeApp(),lblCostCenter:ot,statusIcon:w,cssBackground:ko.computed(function(){return VTPortal.roApp.impersonatedIDEmployee!=-1?"backgroundOpacityImp":"backgroundOpacity"}),customCssBackground:st,customPhotoBackground:ht,btnCancelUpload:{onClick:function(){i(!1)},text:i18nextko.t("roCancel")},btnAcceptUpload:{onClick:function(){ft()},text:i18nextko.t("roSaveRequest")},btnLogout:{onClick:ct,text:"",icon:"Images/Actions/exit.png",visible:!1},uploadOptions:{multiple:!1,accept:"*",value:o,uploadMode:"useForm",showFileList:!1,selectButtonText:s,onValueChanged:function(n){s(n.value[0].name)},onHiding:function(){VTPortalUtils.utils.isShowingPopup(!1)}},changeUserPhoto:function(){i(!0)},photoPopover:{target:"#employeePhotoDiv",shading:!0,width:200,shadingColor:"rgba(0, 0, 0, 0.5)",visible:VTPortal.roApp.showPopover},photoHelp:i18nextko.t("roPhotoHelp"),tabPanelOptionsMain:{dataSource:e,selectedIndex:VTPortal.roApp.selectedTab()-1,itemTemplate:"title",selectOnFocus:!1,onItemClick:function(n){VTPortal.roApp.selectedTab(n.itemData.ID);switch(n.itemData.ActionIndex){case 1:VTPortal.app.navigate("home",{root:!0});break;case 2:VTPortal.app.navigate("scheduler/1/"+moment().format("YYYY-MM-DD"),{root:!0});break;case 3:VTPortal.app.navigate("punchManagement/1/"+moment().format("YYYY-MM-DD"),{root:!0});break;case 4:VTPortal.app.navigate("teleworking/1/"+moment().format("YYYY-MM-DD"),{root:!0});break;case 5:VTPortal.app.navigate("documents",{root:!0});break;case 6:VTPortal.app.navigate("leaves",{root:!0});break;case 7:VTPortal.app.navigate("profile",{root:!0});break;case 15:VTPortal.app.navigate("myTeamEmployees",{root:!0});break;case 16:VTPortal.app.navigate("myTeamAlerts",{root:!0});break;case 17:VTPortal.app.navigate("myTeamRequests",{root:!0});break;case 18:VTPortal.app.navigate("myteam",{root:!0});break;case 19:VTPortal.app.navigate("communiques",{root:!0});break;case 20:VTPortal.app.navigate("onboardings",{root:!0});break;case 21:VTPortal.app.navigate("surveyDetail",{root:!0})}}}}};VTPortal.documentInput=function(){function h(u,s,h){r([""]);f(i18nextko.i18n.t("roFindFile"));i(!0);n("");t(-1);e(s);o(u);u.length>0&&(h==-1?(t(u[0].FieldValue),u.length==1&&i(!1)):(i(!1),t(h+"")))}function c(){var n=new FormData;return n.append("idTemplateDocument",t()),VTPortal.roApp.isModeApp()==!1?n.append("userfile",r()[0]):n.append("userfile",u()),n}function l(){if(VTPortalUtils.utils.isShowingPopup(!1),Object.has(navigator,"camera")){var t=function(){navigator.camera.getPicture(function(t){u(t);typeof device!="undefined"?cordova.platformId==="ios"?n(window.WkWebView.convertFilePath(t)):n(t):n(t)},function(n){n.includes("cancelled")||VTPortalUtils.utils.notifyMesage(n,"error",2e3)},{quality:75,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,targetWidth:768,targetHeight:1024,saveToPhotoAlbum:!1,correctOrientation:!0})},i=function(){navigator.camera.getPicture(function(t){u(t);typeof device!="undefined"?cordova.platformId==="ios"?n(window.WkWebView.convertFilePath(t)):n(t):n(t)},function(n){n.includes("cancelled")||VTPortalUtils.utils.notifyMesage(n,"error",2e3)},{quality:75,sourceType:Camera.PictureSourceType.CAMERA,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,targetWidth:768,targetHeight:1024,saveToPhotoAlbum:!1,correctOrientation:!0})};VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roSelectOrigin"),"info",0,t,i,i18nextko.i18n.t("roTakeFromLibrary"),i18nextko.i18n.t("roTakeFromCamera"))}else VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoCameraAvailable"),"error",0)}var r=ko.observableArray([""]),n=ko.observable(""),e=ko.observable(!1),u=ko.observable(""),i=ko.observable(!0),t=ko.observable(-1),o=ko.observable([]),s=ko.observable(""),f=ko.observable(i18nextko.i18n.t("roFindFile"));return{lblDocumentSelect:i18nextko.t("roRequestDocumentType"),lblImageCapture:i18nextko.t("roSelectFile"),lblSelectFile:i18nextko.t("roSelectFile"),selectPhotoEvent:l,imageSrc:n,appMode:VTPortal.roApp.isModeApp(),cmbDocumentSelect:{dataSource:o,displayExpr:"FieldName",valueExpr:"FieldValue",value:t,readOnly:e},uploadOptions:{multiple:!1,accept:"*",value:r,uploadMode:"useForm",showFileList:!1,selectButtonText:f,onValueChanged:function(n){f(n.value[0].name);s(t())}},initializeData:h,getDocument:c,documentIdTemplate:s,canSelectTemplate:i}};VTPortal.statusHeader=function(){function w(){VTPortal.roApp.loggedIn&&new WebServiceRobotics(function(n){window.VTPortalUtils.utils.onLogoutSuccessFunc(n)},function(n){window.VTPortalUtils.utils.onLogoutErrorFunc(n)}).logout()}function b(){if(VTPortalUtils.utils.isShowingPopup(!1),Object.has(navigator,"camera")){var t=function(){navigator.camera.getPicture(function(t){r(t);typeof device!="undefined"?cordova.platformId==="ios"?n(window.WkWebView.convertFilePath(t)):n(t):n(t)},function(n){n.includes("cancelled")||VTPortalUtils.utils.notifyMesage(n,"error",2e3)},{quality:100,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,targetWidth:200,targetHeight:200,saveToPhotoAlbum:!1,correctOrientation:!0})},i=function(){navigator.camera.getPicture(function(t){r(t);typeof device!="undefined"?cordova.platformId==="ios"?n(window.WkWebView.convertFilePath(t)):n(t):n(t)},function(n){n.includes("cancelled")||VTPortalUtils.utils.notifyMesage(n,"error",2e3)},{quality:100,sourceType:Camera.PictureSourceType.CAMERA,destinationType:Camera.DestinationType.FILE_URI,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,targetWidth:200,targetHeight:200,saveToPhotoAlbum:!1,correctOrientation:!0})};VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roSelectOrigin"),"info",0,t,i,i18nextko.i18n.t("roTakeFromLibrary"),i18nextko.i18n.t("roTakeFromCamera"))}else VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoCameraAvailable"),"error",0)}var t=ko.observable(!1),u=ko.observableArray(),n=ko.observable(""),f=ko.observable(i18nextko.i18n.t("roFindFile")),r=ko.observable(""),e=ko.computed(function(){return"url(data:image/png;base64,"+VTPortal.roApp.userPhoto()+") no-repeat center center"}),o=ko.computed(function(){return VTPortal.roApp.impersonatedIDEmployee==-1?VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"?VTPortal.roApp.userStatus().PresenceStatus=="Inside"?"3px solid green":"3px solid red":"":"3px solid #6b96eb"}),s=ko.computed(function(){if(VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"){var n=moment(VTPortal.roApp.userStatus().ServerDate);return n.format("LL")+" "+n.format("LT")}return""}),h=ko.computed(function(){return VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"?VTPortal.roApp.userStatus().EmployeeName:""}),c=ko.computed(function(){return VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"?VTPortal.roApp.userStatus().TaskTitle.length<=35?VTPortal.roApp.userStatus().TaskTitle:VTPortal.roApp.userStatus().TaskTitle.substr(0,35)+"...":""}),l=ko.computed(function(){return VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"?VTPortal.roApp.userStatus().CostCenterName:""}),a=ko.computed(function(){return VTPortalUtils.utils.badgeCount()}),k=ko.computed(function(){return VTPortal.roApp.showLogoutHome()!=null&&VTPortal.roApp.db.settings.ApiVersion>VTPortalUtils.apiVersion.CauseNote&&VTPortal.roApp.impersonatedIDEmployee==-1?VTPortal.roApp.showLogoutHome():!1}),v=ko.computed(function(){return VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"?VTPortal.roApp.userStatus().ScheduleStatus.RequestAlerts.length:""}),y=ko.computed(function(){return VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"?VTPortal.roApp.userStatus().ScheduleStatus.IncompletePunches.length:""}),i=null,p=function(){var f=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingPhoto"),"error",0);t(!1)},e=function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.loadInitialData(!0,!1,!1,!1,!1),VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roProfilePhotoSaved"),"success",2e3)):VTPortalUtils.utils.processErrorMessage(n);t(!1)},n;i==null&&(i=new WebServiceRobotics(e,f));n=new FormData;VTPortal.roApp.isModeApp()==!1?n.append("userfile",u()[0]):n.append("userfile",r());VTPortal.roApp.isModeApp()?i.saveProfileImageMobile(n):i.saveProfileImageDesktop(n)};return{bgImage:backgroundImage,empImage:e,borderBottom:o,lblUsername:h,lblAlerts:a,lblRequests:v,lblForgottenPunches:y,lblServerDate:s,lblProductivTask:c,lblCostCenter:l,lblProfileImage:i18nextko.t("roProfileImage"),changeUserPhotoVisible:t,btnLogout:{onClick:w,text:"",icon:"Images/Actions/exit.png",visible:!1},changeUserPhoto:function(){t(!0)},goToProfile:function(){VTPortal.app.navigate("profile")},btnCancelUpload:{onClick:function(){t(!1)},text:i18nextko.t("roCancel")},btnAcceptUpload:{onClick:function(){p()},text:i18nextko.t("roSaveRequest")},selectPhotoEvent:b,imageSrc:n,appMode:VTPortal.roApp.isModeApp(),uploadOptions:{multiple:!1,accept:"*",value:u,uploadMode:"useForm",showFileList:!1,selectButtonText:f,onValueChanged:function(n){f(n.value[0].name)},onHiding:function(){VTPortalUtils.utils.isShowingPopup(!1)}},hintView:i18nextko.i18n.t("roOptions")}};VTPortal.taskFieldsInput=function(){var lblTaskTitle=ko.observable(""),divTitile=ko.observable(!1),divTaskField1=ko.observable(!1),divTaskField2=ko.observable(!1),divTaskField3=ko.observable(!1),divTaskField4=ko.observable(!1),divTaskField5=ko.observable(!1),divTaskField6=ko.observable(!1),lblTaskField1=ko.observable(""),lblTaskField2=ko.observable(""),lblTaskField3=ko.observable(""),lblTaskField4=ko.observable(""),lblTaskField5=ko.observable(""),lblTaskField6=ko.observable(""),valueTaskField1=ko.observable(""),valueTaskField2=ko.observable(""),valueTaskField3=ko.observable(""),valueTaskField4=ko.observable(""),valueTaskField5=ko.observable(""),valueTaskField6=ko.observable(""),cmbTaskField1=ko.observable([]),cmbTaskField2=ko.observable([]),cmbTaskField3=ko.observable([]),cmbTaskField4=ko.observable([]),cmbTaskField5=ko.observable([]),cmbTaskField6=ko.observable([]),textFieldType1=ko.observable(!0),textFieldType2=ko.observable(!0),textFieldType3=ko.observable(!0),textFieldType4=ko.observable(!0),textFieldType5=ko.observable(!0),textFieldType6=ko.observable(!0),cmbFieldType1=ko.observable(!0),cmbFieldType2=ko.observable(!0),cmbFieldType3=ko.observable(!0),cmbFieldType4=ko.observable(!0),cmbFieldType5=ko.observable(!0),cmbFieldType6=ko.observable(!0),formReadOnly=ko.observable(!1),initTaskProperties=function(readOnly){var i,tmpList;formReadOnly(readOnly);valueTaskField1("");valueTaskField2("");valueTaskField3("");valueTaskField4("");valueTaskField5("");valueTaskField6("");var punchStep=VTPortal.roApp.taskPunchRequest(),fConf=null,fValues=null;if(punchStep.currentAction==-2?(divTitile(!0),fConf=VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition,fValues=VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue,lblTaskTitle(i18nextko.i18n.t("roTaskFieldsInfo"))):(punchStep.currentAction!=-1||punchStep.newAction!=-1)&&(divTitile(!0),punchStep.currentAction!=-1&&punchStep.newAction==-1?(fConf=VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition,fValues=VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue,lblTaskTitle(i18nextko.i18n.t("roCurrentTaskUserFields")+VTPortal.roApp.userStatus().TaskTitle)):(fConf=VTPortal.roApp.taskPunchRequest().newTaskUserFieldsDefinition,fValues=VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue,lblTaskTitle(i18nextko.i18n.t("roNewTaskUserFields")))),fConf!=null&&fConf.length==6)for(i=0;i<fConf.length;i++){var divField=eval("divTaskField"+(i+1)),lblName=eval("lblTaskField"+(i+1)),textTaskField=eval("lblTaskField"+(i+1)),cmbTaskField=eval("cmbTaskField"+(i+1)),textFieldType=eval("textFieldType"+(i+1)),cmbFieldType=eval("cmbFieldType"+(i+1)),valField=eval("valueTaskField"+(i+1));if(fConf[i].Used){if(divField(!0),i<3&&fValues[i]!=""?valField(fValues[i]):i>=3&&parseFloat(fValues[i])!=-1&&valField(fValues[i]),lblName(fConf[i].Name),textFieldType(fConf[i].ValueType==0),cmbFieldType(fConf[i].ValueType==1),fConf[i].ValueType==1)if(i<3)cmbTaskField(fConf[i].ValuesList);else if(i>=3){for(tmpList=[],x=0;x<fConf[i].ValuesList.length;x++)tmpList.push(parseFloat(fConf[i].ValuesList[x]));cmbTaskField(tmpList)}}else divField(!1)}},savePunchInfo=function(){var n=VTPortal.roApp.taskPunchRequest();n.currentAction==-2?(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[0].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[0]=valueTaskField1()),VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[1].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[1]=valueTaskField2()),VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[2].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[2]=valueTaskField3()),VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[3].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[3]=valueTaskField4()),VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[4].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[4]=valueTaskField5()),VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[5].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[5]=valueTaskField6())):(n.currentAction!=-1||n.newAction!=-1)&&(n.currentAction!=-1&&n.newAction==-1?(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[0].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[0]=valueTaskField1()),VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[1].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[1]=valueTaskField2()),VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[2].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[2]=valueTaskField3()),VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[3].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[3]=valueTaskField4()),VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[4].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[4]=valueTaskField5()),VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition[5].Used&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[5]=valueTaskField6())):(VTPortal.roApp.taskPunchRequest().newTaskUserFieldsDefinition[0].Used&&(VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue[0]=valueTaskField1()),VTPortal.roApp.taskPunchRequest().newTaskUserFieldsDefinition[1].Used&&(VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue[1]=valueTaskField2()),VTPortal.roApp.taskPunchRequest().newTaskUserFieldsDefinition[2].Used&&(VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue[2]=valueTaskField3()),VTPortal.roApp.taskPunchRequest().newTaskUserFieldsDefinition[3].Used&&(VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue[3]=valueTaskField4()),VTPortal.roApp.taskPunchRequest().newTaskUserFieldsDefinition[4].Used&&(VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue[4]=valueTaskField5()),VTPortal.roApp.taskPunchRequest().newTaskUserFieldsDefinition[5].Used&&(VTPortal.roApp.taskPunchRequest().newTaskUserFieldsValue[5]=valueTaskField6())))};return{initTaskProperties:initTaskProperties,savePunchInfo:savePunchInfo,lblTaskTitle:lblTaskTitle,lblTaskField1:lblTaskField1,lblTaskField2:lblTaskField2,lblTaskField3:lblTaskField3,lblTaskField4:lblTaskField4,lblTaskField5:lblTaskField5,lblTaskField6:lblTaskField6,divTitile:divTitile,divTaskField1:divTaskField1,divTaskField2:divTaskField2,divTaskField3:divTaskField3,divTaskField4:divTaskField4,divTaskField5:divTaskField5,divTaskField6:divTaskField6,txtTaskField1:{value:valueTaskField1,visible:textFieldType1,readOnly:formReadOnly},txtTaskField2:{value:valueTaskField2,visible:textFieldType2,readOnly:formReadOnly},txtTaskField3:{value:valueTaskField3,visible:textFieldType3,readOnly:formReadOnly},txtTaskField4:{value:valueTaskField4,visible:textFieldType4,showSpinButtons:!0,readOnly:formReadOnly},txtTaskField5:{value:valueTaskField5,visible:textFieldType5,showSpinButtons:!0,readOnly:formReadOnly},txtTaskField6:{value:valueTaskField6,visible:textFieldType6,showSpinButtons:!0,readOnly:formReadOnly},cmbTaskField1:{dataSource:cmbTaskField1,value:valueTaskField1,visible:cmbFieldType1,readOnly:formReadOnly},cmbTaskField2:{dataSource:cmbTaskField2,value:valueTaskField2,visible:cmbFieldType2,readOnly:formReadOnly},cmbTaskField3:{dataSource:cmbTaskField3,value:valueTaskField3,visible:cmbFieldType3,readOnly:formReadOnly},cmbTaskField4:{dataSource:cmbTaskField4,value:valueTaskField4,visible:cmbFieldType4,readOnly:formReadOnly},cmbTaskField5:{dataSource:cmbTaskField5,value:valueTaskField5,visible:cmbFieldType5,readOnly:formReadOnly},cmbTaskField6:{dataSource:cmbTaskField6,value:valueTaskField6,visible:cmbFieldType6,readOnly:formReadOnly}}};VTPortal.profile=function(n){function c(){e().viewShown();var n=[];VTPortal.roApp.db.settings.onlySupervisor||n.push({ID:1,cssClass:"dx-icon-profileUserFields"});n.push({ID:2,cssClass:"dx-icon-profileConfig"});VTPortal.roApp.db.settings.onlySupervisor||r.modelIsReady(!1);u.modelIsReady(!1);f(n)}function l(){switch(t()){case 1:r.viewShown();break;case 2:u.viewShown()}}var i=ko.observable(0),t=ko.observable(1),o,s;typeof n.id!="undefined"&&(i(parseInt(n.id,10)-1),t(parseInt(n.id,10)));var r=VTPortal.profileUserFields(),u=VTPortal.profileConfig(),h=ko.computed(function(){switch(t()){case 1:return i18nextko.i18n.t("roProfileUserFields");case 2:return i18nextko.i18n.t("roProfileConfig")}},this),f=ko.observable([]),e=ko.observable(VTPortal.bigUserInfo());return o=function(n){typeof n!="undefined"&&t(n.ID);l()},s={viewShown:c,title:h,subscribeBlock:e(),profileUserFieldsBlock:r,profileConfigBlock:u,selectedTab:i,selectedView:t,tabPanelOptions:{dataSource:f,selectedIndex:i,itemTemplate:"title",onSelectionChanged:function(n){o(n.addedItems[0])}}},s};VTPortal.profileConfig=function(){function c(){var t=[],n=!0;VTPortal.roApp.db.settings.login.indexOf("\\")!=-1&&(n=!1);VTPortal.roApp.db.settings.adfsCredential!=""&&(n=!1);VTPortal.roApp.db.settings.isAD==!0&&(n=!1);VTPortal.roApp.db.settings.login.indexOf(".\\")!=-1&&(n=!0);n==!0&&t.push({ID:1,Name:i18nextko.t("roChangePwdBt"),CssClass:"ro-icon-ChangePwd"});t.push({ID:2,Name:i18nextko.t("lng"),CssClass:"ro-icon-info"});f(t);e(!0);$("#scrollview").height($("#panelsContent").height()-70)}var f=ko.observable([]),e=ko.observable(!1),t=ko.observable(!1),r=ko.observable(!1),h=ko.observable(i18nextko.i18n.t("lngProfile")),u=ko.observable(""),n=ko.observable(""),o=ko.observable(""),i=ko.observable(window.VTPortal.roApp.getLanguageByID(VTPortal.roApp.db.settings.language)),w=function(){VTPortal.roApp.loggedIn&&new WebServiceRobotics(function(n){window.VTPortalUtils.utils.onLogoutSuccessFunc(n)},function(n){window.VTPortalUtils.utils.onLogoutErrorFunc(n)}).logout(VTPortal.roApp.db.settings.UUID)},s=function(){t(!0)},l=function(){t(!1)},a=function(){r(!0)},v=function(){r(!1)},y=function(){var n;VTPortal.roApp.setLanguage(i().tag);VTPortal.roApp.db.settings.language=i().ID;VTPortal.roApp.db.settings.save();VTPortal.roApp.db.settings.adfsCredential!=""?(n=window.VTPortal.roApp.db.settings,new WebServiceRobotics(function(){setTimeout(function(){VTPortal.app.navigate("loading",{root:!0})},200)},function(){setTimeout(function(){VTPortal.app.navigate("loading",{root:!0})},200)}).updateServerLanguage(window.VTPortal.roApp.getLanguageByID(n.language).ID)):(n=window.VTPortal.roApp.db.settings,new WebServiceRobotics(function(){VTPortal.roApp.redirectAtHome()},function(n){window.VTPortalUtils.utils.onLoginErrorFunc(n)},this.wsURL,this.isSSL).login(n.login,n.password,window.VTPortal.roApp.getLanguageByID(n.language).ID,VTPortal.roApp.infoVersion,"",!1))},p=function(i){var r=i.validationGroup.validate();r.isValid&&(t(!1),new WebServiceRobotics(function(t){if(t.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.db.settings.password=n(),VTPortal.roApp.db.settings.save(),u(""),n(""),o(""),$("#scrollview").find(".pass").each(function(){$(this).dxValidator("instance").reset()}),VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roOkChangingPwd"),"success",2500);else{var i=function(){s(!0)};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t(window.VTPortalUtils.utils.languageTag(t.Status)),"error",0,i)}}).changePassword(u(),n()))};return{modelIsReady:e,viewShown:c,lblLanguage:h,lblOldPwd:i18nextko.t("lblOldPwd"),lblNewPwd:i18nextko.t("lblNewPwd"),lblNewPwdRepeat:i18nextko.t("lblNewPwdRepeat"),popupChangePwdVisible:t,popupChangeLngVisible:r,listOptions:{dataSource:f,scrollingEnabled:!1,grouped:!1,itemTemplate:"configAction",onItemClick:function(n){switch(n.itemData.ID){case 1:s();break;case 2:a()}}},txtOldPwd:{placeholder:i18nextko.t("roPH_oldPwd"),value:u,mode:"password"},txtNewPwd:{placeholder:i18nextko.t("roPH_newPwd"),value:n,mode:"password"},txtNewPwdRepeat:{placeholder:i18nextko.t("roPH_newPwdRepeat"),value:o,mode:"password"},btnCancel:{onClick:l,text:i18nextko.t("roCancel")},btnCancelLng:{onClick:v,text:i18nextko.t("roCancel")},currentLanguage:i,dataSourceLanguages:{dataSource:VTPortal.roApp.availableLanguages,displayExpr:"Name",placeholder:i18nextko.t("language"),value:i,itemTemplate:"langItemTemplate",onItemClick:function(n){switch(n.itemData.ID){}}},btnChangePwd:{onClick:p,text:i18nextko.t("roChangePwd")},btnChangeLng:{onClick:y,text:i18nextko.t("roChangePwd")},requieredOldField:{validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]},requieredNewField:{validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]},compareField:{validationRules:[{type:"compare",comparisonType:"==",comparisonTarget:n,message:i18nextko.i18n.t("roPasswordsNotMatch")}]},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.profileUserFields=function(){function i(){r();t(!0);$("#scrollview").height($("#panelsContent").height()-70)}function r(){(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().UserFieldQuery)&&new WebServiceRobotics(function(t){var r,u,i,f;if(t.Status==window.VTPortalUtils.constants.OK.value){for(r=t.Categories,i=0;i<r.length;i++)for(u=0;u<r[i].items.length;u++)r[i].items[u].hasAction=t.CanCreateRequest?typeof r[i].items[u].CanDeliverDocument!="undefined"&&r[i].items[u].CanDeliverDocument?!0:!1:!1,r[i].items[u].cssClass="";for(n(r),i=0;i<r.length;i++)i>0&&$("#profileUserFields").dxList("instance").collapseGroup(i)}else n([]),f=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(t,f)}).getUserFields()}var t=ko.observable(!1),n=ko.observable([]),u=ko.computed(function(){return VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().UserFieldQuery?!0:!1});return{modelIsReady:t,viewShown:i,hasPermission:u,userFieldsDS:n,profileUserFields:{dataSource:n,scrollingEnabled:!1,grouped:!0,collapsibleGroups:!0,groupTemplate:function(n){return $("<div>"+n.key+"<\/div>")},itemTemplate:"userField",onItemClick:function(n){n.itemData.hasAction&&VTPortal.app.navigate("userFields/-1/"+n.itemData.Name)}},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.myPunches=function(){function e(t){n(t);i(!0)}var f=function(n,t){var i=t.targetOffset;i<0?u():i>0&&r()},n=ko.observable(new Date),i=ko.observable(!1),t=ko.observable([]),r=function(){n(moment(n()).subtract(1,"days"))},u=function(){n(moment(n()).add(1,"days"))},o=function(){VTPortal.app.navigate("forgottenPunch/-1/"+moment(n()).format("YYYY-MM-DD"))},s=ko.computed(function(){return VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&(VTPortal.roApp.empPermissions().Punch.ScheduleQuery||VTPortal.roApp.empPermissions().Punch.ProductiVQuery)?!0:!1}),c=function(){(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&(VTPortal.roApp.empPermissions().Schedule.ScheduleAccruals||VTPortal.roApp.empPermissions().Schedule.ProductivAccruals))&&new WebServiceRobotics(function(n){var o,u,f,i,e,r,s;if(n.Status==window.VTPortalUtils.constants.OK.value){if(o=t(),VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Schedule.ScheduleAccruals){for(u=n.ScheduleAccruals,i=0;i<u.length;i++){e="";switch(u[i].key){case"daily":u[i].key="presenceDaily";e="dx-icon-scheduleDaily"}for(r=0;r<u[i].items.length;r++)u[i].items[r].cssClass=e,u[i].items[r].hasAction=!1}u.length>0&&o.push(u[0])}if(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Schedule.ProductivAccruals){for(f=n.TaskAccruals,i=0;i<f.length;i++){e="";switch(f[i].key){case"daily":f[i].key="productiVDaily";e="dx-icon-productivDaily"}for(r=0;r<f[i].items.length;r++)f[i].items[r].cssClass=e,f[i].items[r].hasAction=!1}f.length>0&&o.push(f[0])}t(o);$("#scrollview").height($("#panelsContent").height()-70)}else productivDS([]),scheduleDS([]),s=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,s)}).getMyDailyAccruals(n())},h=function(n){(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&(VTPortal.roApp.empPermissions().Punch.ScheduleQuery||VTPortal.roApp.empPermissions().Punch.ProductiVQuery))&&new WebServiceRobotics(function(n){var i,r,u;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=n.Punches,r=0;r<i.length;r++){switch(i[r].Type){case 1:case 2:case 3:case 7:i[r].cssClass=i[r].TypeData!=null&&i[r].TypeData>0?i[r].ActualType==1?typeof i[r].InTelecommute!="undefined"&&i[r].InTelecommute.toLowerCase()=="true"?"dx-icon-TATC_in":"dx-icon-TA_in_cause":"dx-icon-TA_out_cause":i[r].ActualType==1?typeof i[r].InTelecommute!="undefined"&&i[r].InTelecommute.toLowerCase()=="true"?"dx-icon-TATC_in":"dx-icon-TA_in":"dx-icon-TA_out";i[r].hasAction=!0;break;case 4:i[r].cssClass="dx-icon-Task_change";i[r].hasAction=!1;break;case 13:i[r].cssClass="dx-icon-CostCenter";i[r].hasAction=!1}i[r].Name=moment.tz(i[r].DateTime,VTPortal.roApp.serverTimeZone).format("LLL");i[r].Value=i[r].RequestedTypeData!=""?i18nextko.i18n.t("roRequestPendingApprove")+i[r].RequestedTypeData:i[r].RelatedInfo}t(i);$("#scrollview").height($("#panelsContent").height()-70)}else t([]),u=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,u)}).getMyPunches(n.value)};return{title:i18nextko.i18n.t("roMyPunchesTitle"),modelIsReady:i,initializeView:e,punchesDS:t,hasPermission:s,headerDate:{value:n,pickerType:"rollers",displayFormat:"shortDate",onValueChanged:h},btnPrevious:{icon:"chevronprev",onClick:r},btnNext:{icon:"chevronnext",onClick:u},myEventHandler:f,listOptions:{dataSource:t,scrollingEnabled:!1,grouped:!1,onItemClick:function(n){n.itemData.hasAction&&VTPortal.app.navigate("justifyPunch/-1/"+moment(n.itemData.DateTime).format("YYYYMMDDHHmmss"))}},newRequest:{onClick:o,text:"",icon:"Images/Common/plus.png",visible:VTPortal.roApp.ReadMode()==!1},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.myPunchRequests=function(){function e(){s();u(!0);n()?$("#scrollview").height($("#panelsContent").height()-94):$("#scrollview").height($("#panelsContent").height()-70)}function s(){n(!1);var i=VTPortal.roApp.punchesFilters(),r=function(n){var i,r,u,f,e;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=n.Requests,r=0;r<i.length;r++){i[r].Name=i18nextko.i18n.t("roRequestType_"+i[r].RequestType);i[r].hasAction=n.CanCreateRequest?!0:!1;u="";switch(i[r].Status){case 0:u="ro_Status_pending";break;case 1:u="ro_Status_ongoing";break;case 2:u="ro_Status_accepted";break;case 3:u="ro_Status_denied"}f="";switch(i[r].IdRequestType){case 2:f="dx-icon-forbiddenPunch";break;case 3:f="dx-icon-justifyPunch";break;case 10:f="dx-icon-forbiddenPunch";break;case 12:f="dx-icon-forbiddenPunch"}i[r].cssContainerClass=u;i[r].cssClass=f;$("#scrollview").height($("#panelsContent").height())}t(i)}else t([]),e=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,e)};i==null?(n(!1),new WebServiceRobotics(function(n){r(n)}).getMyRequests(!1,moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").add(1,"day"),"0*1*2*3|2*3*10*12","RequestDate DESC",moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").add(1,"year"))):(n(!0),new WebServiceRobotics(function(n){r(n)}).getMyRequests(!1,i.filter.iDate,i.filter.eDate,i.filter.status.join("*")+"|"+i.filter.types.join("*"),i.order.by+" "+i.order.direction,i.filter.iRequestedDate,i.filter.eRequestedDate))}var u=ko.observable(!1),t=ko.observable([]),i=ko.observable(!1),r=ko.observable("Images/Common/more.png"),n=ko.observable(!1),f=ko.computed(function(){return VTPortal.roApp.punchesFilters()!=null?i18nextko.i18n.t("roFilteringData"):""}),o=ko.computed(function(){var t,n;if(VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Requests!=null){for(t=!1,n=0;n<VTPortal.roApp.empPermissions().Requests.length;n++)if(VTPortal.roApp.empPermissions().Requests[n].Permission){t=!0;break}return t}return!1}),h=function(){i(!0);r("Images/Common/moreV.png")},c=function(){r("Images/Common/more.png")},l=function(){i(!1);r("Images/Common/more.png");VTPortal.app.navigate("RequestFilters/2")},a=function(){i(!1);VTPortal.app.navigate("requestsList/2,3,10,12/null")};return{modelIsReady:u,initializeView:e,hasPermission:o,requestsDS:t,dataFiltered:n,filterDescription:f,listRequests:{dataSource:t,scrollingEnabled:!1,grouped:!1,itemTemplate:"RequestItem",onItemClick:function(n){if(n.itemData.hasAction)switch(n.itemData.IdRequestType){case 2:VTPortal.app.navigate("forgottenPunch/"+n.itemData.Id);break;case 3:VTPortal.app.navigate("justifyPunch/"+n.itemData.Id);break;case 10:VTPortal.app.navigate("forgottenPunch/"+n.itemData.Id);break;case 12:VTPortal.app.navigate("forgottenPunch/"+n.itemData.Id)}}},actionMenuPopover:{target:"#btnActionMenuPopover",position:"top",shading:!0,shadingColor:"rgba(0, 0, 0, 0.5)",visible:i,onHidden:c},showOptions:{onClick:h,text:"",icon:r},btnFilterRequests:{onClick:l,text:"",hint:i18nextko.i18n.t("roFilter"),icon:"Images/Common/filter.png"},btnNewRequests:{onClick:a,text:"",hint:i18nextko.i18n.t("roNew"),icon:"Images/Common/plus.png",visible:VTPortal.roApp.ReadMode()==!1},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.punchManagement=function(n){function s(){r.modelIsReady(!1);u.modelIsReady(!1);switch(t()){case 1:r.initializeView(o());break;case 2:u.initializeView()}}function c(){e().viewShown();s()}var i=ko.observable(0),t=ko.observable(1),o=ko.observable(new Date),e;typeof n.id!="undefined"&&(i(parseInt(n.id,10)-1),t(parseInt(n.id,10)));typeof n.param!="undefined"&&o(moment(n.param,"YYYY-MM-DD").toDate());var r=VTPortal.myPunches(),u=VTPortal.myPunchRequests(),h=ko.computed(function(){switch(t()){case 1:return i18nextko.i18n.t("roPunchesTitle");case 2:return i18nextko.i18n.t("roMyPunchRequests")}},this),f=[];f.push({ID:1,cssClass:"dx-icon-myPunches"});f.push({ID:2,cssClass:"dx-icon-myPuncheRequests"});e=ko.observable(VTPortal.bigUserInfo());var l=function(n){t(n.ID);s()},a=function(){VTPortal.roApp.db.settings.password="";VTPortal.roApp.db.settings.save();VTPortal.roApp.impersonatedIDEmployee=-1;VTPortal.roApp.supervisedEmployees=[];VTPortal.roApp.loggedIn=!1;VTPortal.app.navigate("login",{root:!0})};return{viewShown:c,title:h,subscribeBlock:e(),myPunchesBlock:r,myPunchRequestsBlock:u,selectedTab:i,selectedView:t,tabPanelOptions:{dataSource:f,selectedIndex:i,itemTemplate:"title",onSelectionChanged:function(n){l(n.addedItems[0])}}}};VTPortal.approvalHistory=function(){var n=ko.observable([]),t=function(t){for(var r,u=[],i=0;i<t.length;i++){r="";switch(t[i].Action){case 0:r="dx-icon-requestPending";break;case 1:r="dx-icon-requestOnGoing";break;case 2:r="dx-icon-requestApprove";break;case 3:r="dx-icon-requestDenied"}u.push({cssClass:r,Name:moment.tz(t[i].ActionDate,VTPortal.roApp.serverTimeZone).format("LLL"),Description:t[i].User+":"+t[i].Comment})}n(u)};return{refreshApprovals:t,lblRequestApprovals:i18nextko.t("roLblRequestApprovals"),listApprovals:{dataSource:n,scrollingEnabled:!1,grouped:!1,itemTemplate:"ApprovalItem",onItemClick:function(n){n.itemData.hasAction&&VTPortal.app.navigate("userFields/"+n.itemData.Id)}}}};VTPortal.cancelHolidays=function(n){function p(n){if(i()=="C")var t=f()/100;new WebServiceRobotics(function(n){var i,t,u;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=r(),t=0;t<n.oCalendar.DayData.length;t++)i[moment.tz(n.oCalendar.DayData[t].PlanDate,VTPortal.roApp.serverTimeZone).add(12,"hours").format("YYYYMMDD")]=n.oCalendar.DayData[t];r(i);v()==1&&setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},100)}else r([]),u=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,u);a=!1},function(){a=!1}).getAvailablePermitsCalendar(n,i()=="C"?t:-1)}function ft(){if(k().viewShown(),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Holidays)it("plannedholiday"),t()!=null&&t()>0&&(y(!0),VTPortalUtils.utils.markRequestAsRead(t())),VTPortal.roApp.impersonatedIDEmployee==-1?t()!=null&&s(!0):t()!=null&&h(!1),t()==null&&d(!0),t()!=null&&g(!0);else{var n=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roIncorrectApiVersion"),"error",0,n)}}function et(){var r="",n=moment().startOf("month"),s=moment().endOf("year").add(1,"year"),t=f()!=null?f():"-1",e,o;for(t!="-1"&&i()=="C"&&(t=t/100);n<s;)u[n.format("YYYYMMDD")],typeof u[n.format("YYYYMMDD")]!="undefined"&&u[n.format("YYYYMMDD")]==!0&&(r!=""&&(r+="/"),r+=n.format("YYYYMMDD")),n=n.add(1,"day");r==""?(v(1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roSelectDayInfo"),"info",2e3)):(e=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},o=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(11),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var u=function(){c.saveCancelHolidays(r,i()=="C"?t:-1,i()=="S"?t:-1,l(),!0)};VTPortalUtils.utils.processRequestErrorMessage(n,u,function(){})}},c==null&&(c=new WebServiceRobotics(o,e)),c.saveCancelHolidays(r,i()=="C"?t:-1,i()=="S"?t:-1,l(),!1))}function ot(){t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}function st(n){var h="",c="#dcdcdc",l="#dcdcdc",v=90,y=95,w=r()[moment(n.date).format("YYYYMMDD")],b=!1,k="",s,nt,tt,d,g;if(moment(n.date).format("YYYYMMDD")==moment().format("YYYYMMDD")&&(k="actualDate"),w!=null){if(w.MainShift!=null&&(b=!1,i()=="S"&&w.IsHoliday==!0&&w.MainShift.ID==parseInt(f(),10)?b=!0:i()=="C"&&w.Alerts.OnHolidaysHours&&(b=!0)),c=VTPortalUtils.calendar.getCellColor(u,n.date,n.view),absenceStyle="width:100%;height:100%;color: "+l+";",absenceStyle+="background: "+l+";",absenceStyle+="background: -webkit-radial-gradient(circle closest-side, "+l+" 95%,rgba(255,255,255,0) 100%);",absenceStyle+="background: -moz-radial-gradient(circle closest-side, "+l+" 95%,rgba(255,255,255,0) 100%);",absenceStyle+="background: -ms-radial-gradient(circle closest-side, "+l+" 95%,rgba(255,255,255,0) 100%);",absenceStyle+="background: -o-radial-gradient(circle closest-side, "+l+" 95%,rgba(255,255,255,0) 100%);",absenceStyle+="background: radial-gradient(circle closest-side at center, "+l+" 95%,rgba(255,255,255,0) 100%);",absenceStyle+="background-repeat: no-repeat;",absenceStyle+="background-position: center center;display:table;",h="width:100%;height:100%;color: #000000;",h+="background: "+c+";",h+="background: -webkit-radial-gradient(circle closest-side, "+c+" "+v+"%,rgba(255,255,255,0) "+y+"%);",h+="background: -moz-radial-gradient(circle closest-side, "+c+" "+v+"%,rgba(255,255,255,0) "+y+"%);",h+="background: -ms-radial-gradient(circle closest-side, "+c+" "+v+"%,rgba(255,255,255,0) "+y+"%);",h+="background: -o-radial-gradient(circle closest-side, "+c+" "+v+"%,rgba(255,255,255,0) "+y+"%);",h+="background: radial-gradient(circle closest-side at center, "+c+" "+v+"%,rgba(255,255,255,0) "+y+"%);",h+="background-repeat: no-repeat;",h+="background-position: center center;display:table;",n.view=="month")return moment(n.date).isAfter(moment(e()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(o()))?moment(n.date).startOf("day")>=moment(e()).startOf("day")?b||t()>0?"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+h+"'> <span class='"+k+"' style='display:table-cell;vertical-align:middle;font-weight:bold'>"+n.text+"<\/span><\/div><\/div><\/div><\/div>":"<div class='no-working-day'> <span class='"+k+"' >"+n.text+"<\/span><\/div>":"<span>"+n.text+"<\/span>":"";if(n.view=="year"){if(moment(n.date).isAfter(moment(e()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(o()))){for(s=moment(n.date).startOf("month"),nt=moment(n.date).endOf("month"),s<moment().startOf("day")&&(s=moment().startOf("day")),tt=!1,d=0;s<nt;){if(g=!1,i()=="S"&&typeof r()[s]!="undefined"&&r()[s.format("YYYYMMDD")].IsHoliday==!0&&r()[s.format("YYYYMMDD")].MainShift.ID==parseInt(f(),10)?g=!0:i()=="C"&&typeof r()[s]!="undefined"&&r()[s.format("YYYYMMDD")].Alerts.OnHolidaysHours&&(g=!0),g){tt=!0;break}s=s.add(1,"day")}for(s=moment(n.date).startOf("month"),s<moment().startOf("day")&&(s=moment().startOf("day"));s<nt;)u[s.format("YYYYMMDD")]==!0&&(d+=1),s=s.add(1,"day");return tt||t()>0?d>0?"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+h+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+" ("+d+")<\/span><\/div><\/div><\/div><\/div>":"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+h+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+"<\/span><\/div><\/div><\/div><\/div>":"<span>"+n.text+"<\/span>"}return""}}else return moment(n.date).isAfter(moment(e()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(o()))?(a||(a=!0,p(n.date)),"<span class='"+k+"' >"+n.text+"<\/span>"):""}var t=ko.observable(null),l=ko.observable(""),d=ko.observable(!1),s=ko.observable(!1),g=ko.observable(!1),nt=ko.observable(!1),h=ko.observable(!1),e=ko.observable(moment().startOf("day").toDate()),o=ko.observable(moment().startOf("day").endOf("year").add(1,"year").toDate()),r=ko.observable({}),a=!0,v=ko.observable(0),i=ko.observable(""),f=ko.observable(null),w=ko.observable([]),b=[],u,it,k,c;b.push({ID:1,cssClass:"dx-icon-configRequest"});b.push({ID:2,cssClass:"dx-icon-selectDate"});u={};typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));var y=ko.observable(!1),tt=VTPortal.approvalHistory(),rt=ko.computed(function(){return"76%"}),ut=function(){new WebServiceRobotics(function(n){var r,t,c,a;if(n.Status==window.VTPortalUtils.constants.OK.value){if(l(n.Comments),n.ReqStatus==0?s(!0):s(!1),h(!1),VTPortal.roApp.impersonatedIDEmployee!=-1&&(n.ReqStatus==0||n.ReqStatus==1)&&(h(!0),s(!1)),tt.refreshApprovals(n.RequestsHistoryEntries),moment(n.strDate1,"YYYY-MM-DD HH:mm:ss")<moment(e())&&e(moment(n.strDate1,"YYYY-MM-DD HH:mm:ss").startOf("month").toDate()),moment(n.strDate2,"YYYY-MM-DD HH:mm:ss")>moment(o())&&o(moment(n.strDate2,"YYYY-MM-DD HH:mm:ss").endOf("year")),n.RequestDays!=null&&n.RequestDays.length>0)for(r=0;r<n.RequestDays.length;r++)u[moment.tz(n.RequestDays[r].RequestDate,VTPortal.roApp.serverTimeZone).add(12,"hours").format("YYYYMMDD")]=!0;else for(t=moment(n.strDate1,"YYYY-MM-DD HH:mm:ss").startOf("day"),c=moment(n.strDate2,"YYYY-MM-DD HH:mm:ss").startOf("day");t<=c;)u[t.clone().add(12,"hours").format("YYYYMMDD")]=!0,t=t.add(1,"day");parseInt(n.IdShift,10)>0?(f(n.IdShift+""),i("S")):parseInt(n.IdCause,10)>0&&(f(n.IdCause+""),i("C"));p(new Date)}else a=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,a)},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())};it=function(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)n.SelectFields.forEach(function(n){n.RelatedInfo=="C"&&(n.FieldValue=n.FieldValue*100)}),w(n.SelectFields),t()!=null&&t()>0?ut(t()):n.SelectFields.length>0&&(f(n.SelectFields[0].FieldValue),i(n.SelectFields[0].RelatedInfo),p(new Date));else{var r=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,r)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)};k=ko.observable(VTPortal.bigUserInfo());c=null;var ht=function(n){var i;if(t()==null&&typeof r()[moment(n.value).format("YYYYMMDD")]!="undefined"&&(r()[moment(n.value).format("YYYYMMDD")].IsHoliday||r()[moment(n.value).format("YYYYMMDD")].Alerts.OnHolidaysHours)){var f="#ff5c35",s="#000000",e=90,o=95;typeof u[moment(n.value).format("YYYYMMDD")]!="undefined"&&u[moment(n.value).format("YYYYMMDD")]==!0?(u[moment(n.value).format("YYYYMMDD")]=!1,f="#dcdcdc",i="width:100%;height:100%;color: "+s+";",i+="background: "+f+";",i+="background: -webkit-radial-gradient(circle closest-side, "+f+" "+e+"%,rgba(255,255,255,0) "+o+"%);",i+="background: -moz-radial-gradient(circle closest-side, "+f+" "+e+"%,rgba(255,255,255,0) "+o+"%);",i+="background: -ms-radial-gradient(circle closest-side, "+f+" "+e+"%,rgba(255,255,255,0) "+o+"%);",i+="background: -o-radial-gradient(circle closest-side, "+f+" "+e+"%,rgba(255,255,255,0) "+o+"%);",i+="background: radial-gradient(circle closest-side at center, "+f+" "+e+"%,rgba(255,255,255,0) "+o+"%);",i+="background-repeat: no-repeat;",i+="background-position: center center;display:table;",$("#"+moment(n.value).format("YYYYMMDD")).attr("style",i)):(f="#ff5c35",u[moment(n.value).format("YYYYMMDD")]=!0,i="width:100%;height:100%;color: "+s+";",i+="background: "+f+";",i+="background: -webkit-radial-gradient(circle closest-side, "+f+" "+e+"%,rgba(255,255,255,0) "+o+"%);",i+="background: -moz-radial-gradient(circle closest-side, "+f+" "+e+"%,rgba(255,255,255,0) "+o+"%);",i+="background: -ms-radial-gradient(circle closest-side, "+f+" "+e+"%,rgba(255,255,255,0) "+o+"%);",i+="background: -o-radial-gradient(circle closest-side, "+f+" "+e+"%,rgba(255,255,255,0) "+o+"%);",i+="background: radial-gradient(circle closest-side at center, "+f+" "+e+"%,rgba(255,255,255,0) "+o+"%);",i+="background-repeat: no-repeat;",i+="background-position: center center;display:table;",$("#"+moment(n.value).format("YYYYMMDD")).attr("style",i))}},ct=function(n){n.ID==2&&setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},200)};return{requestId:t,myApprovalsBlock:tt,viewShown:ft,title:i18nextko.t("roRequestType_CancelHolidays"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:i18nextko.t("roSelectPlannedHoliday"),lblSelectDaysInfo:i18nextko.t("roSelectDayInfo"),subscribeBlock:k(),selectedTab:v,scrollContent:{height:rt},tabPanelOptions:{dataSource:b,selectedIndex:v,itemTemplate:"title",onSelectionChanged:function(n){ct(n.addedItems[0])}},popupVisible:nt,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),11,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:h},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),11,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:h},btnHistory:{onClick:function(){nt(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:g},btnSave:{onClick:et,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:d},btnDelete:{onClick:ot,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:s},remarks:{value:l,readOnly:y},calendarOptions:{width:"100%",useCellTemplate:!0,cellTemplate:st,firstDayOfWeek:moment()._locale._week.dow,maxZoomLevel:"month",zoomLevel:"year",minZoomLevel:"year",onCellClick:ht,showTodayButton:!1,min:e,max:o},cmbRequestValue1:{dataSource:w,displayExpr:"FieldName",valueExpr:"FieldValue",value:f,readOnly:y,onValueChanged:function(n){y()||(u={});var t=$.grep(w(),function(t){return t.FieldValue==n.value});t.length>0&&(i(t[0].RelatedInfo),r({}),p(new Date))}},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.changeShift=function(n){function at(){if(ot().viewShown(),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Holidays)g([]),nt([]),ft([{FieldName:i18nextko.i18n.t("roShift_DayBefore"),FieldValue:"0"},{FieldName:i18nextko.i18n.t("roShift_ActualDay"),FieldValue:"1"},{FieldName:i18nextko.i18n.t("roShift_DayAfter"),FieldValue:"2"}]),s("1"),lt("shifts.workingtype"),t()!=null&&t()>0&&(e(!0),VTPortalUtils.utils.markRequestAsRead(t())),VTPortal.roApp.impersonatedIDEmployee==-1?t()!=null&&h(!0):t()!=null&&c(!1),t()==null&&it(!0),t()!=null&&rt(!0);else{var n=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roIncorrectApiVersion"),"error",0,n)}}function tt(n){new WebServiceRobotics(function(n){var i,t,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=l(),t=0;t<n.oCalendar.DayData.length;t++)i[moment.tz(n.oCalendar.DayData[t].PlanDate,VTPortal.roApp.serverTimeZone).add(12,"hours").format("YYYYMMDD")]=n.oCalendar.DayData[t];l(i);b()==1&&setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},100)}else l([]),r=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r);w=!1},function(){w=!1}).getAvailablePermitsCalendar(n,-1)}function vt(){var n,h,c;if(i()==null||r==null)b(1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roSelectDayInfo"),"info",2e3);else{var t="",u=o()!=null?o():"-1",e=v()!=null?v():"-1";if(f()){n=moment("1899-12-30 "+moment(a()).format("HH:mm")+":00","YYYY-MM-DD HH:mm:ss");switch(s()){case"0":n.add(-1,"days");break;case"2":n.add(1,"days")}t=n.format("YYYY-MM-DD HH:mm")}h=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)};c=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(5),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var f=function(){y.saveChangeShift(i()==null?VTPortalUtils.nullDate:i(),r()==null?VTPortalUtils.nullDate:r(),e,u,t,p(),!0)};VTPortalUtils.utils.processRequestErrorMessage(n,f,function(){})}};y==null&&(y=new WebServiceRobotics(c,h));y.saveChangeShift(i()==null?VTPortalUtils.nullDate:i(),r()==null?VTPortalUtils.nullDate:r(),e,u,t,p(),!1)}}function yt(){t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}function pt(n){var t="",i="#dcdcdc",r="#dcdcdc",f=90,e=95,o=l()[moment(n.date).format("YYYYMMDD")],a=0,v=!1,h="";if(moment(n.date).format("YYYYMMDD")==moment().format("YYYYMMDD")&&(h="actualDate"),o!=null){if(o.MainShift!=null&&(a=o.MainShift.PlannedHours,v=o.IsHoliday),i=VTPortalUtils.calendar.getCellColor(u,n.date,n.view),absenceStyle="width:100%;height:100%;color: "+r+";",absenceStyle+="background: "+r+";",absenceStyle+="background: -webkit-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -moz-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -ms-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -o-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: radial-gradient(circle closest-side at center, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background-repeat: no-repeat;",absenceStyle+="background-position: center center;display:table;",t="width:100%;height:100%;color: #000000;",t+="background: "+i+";",t+="background: -webkit-radial-gradient(circle closest-side, "+i+" "+f+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -moz-radial-gradient(circle closest-side, "+i+" "+f+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -ms-radial-gradient(circle closest-side, "+i+" "+f+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -o-radial-gradient(circle closest-side, "+i+" "+f+"%,rgba(255,255,255,0) "+e+"%);",t+="background: radial-gradient(circle closest-side at center, "+i+" "+f+"%,rgba(255,255,255,0) "+e+"%);",t+="background-repeat: no-repeat;",t+="background-position: center center;display:table;",n.view=="month")return"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span class='"+h+"' style='display:table-cell;vertical-align:middle;font-weight:bold'>"+n.text+"<\/span><\/div><\/div><\/div><\/div>";if(n.view=="year"){if(moment(n.date).isAfter(moment(k()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(d()))){for(var s=moment(n.date).startOf("month"),y=moment(n.date).endOf("month"),c=0;s<y;)u[s.format("YYYYMMDD")]==!0&&(c+=1),s=s.add(1,"day");return c>0?"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+" ("+c+")<\/span><\/div><\/div><\/div><\/div>":"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+"<\/span><\/div><\/div><\/div><\/div>"}return""}}else return moment(n.date).isAfter(moment(k()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(d()))?(w||(w=!0,tt(n.date)),"<span class='"+h+"' >"+n.text+"<\/span>"):""}var t=ko.observable(null),p=ko.observable(""),it=ko.observable(!1),h=ko.observable(!1),rt=ko.observable(!1),ut=ko.observable(!1),c=ko.observable(!1),l=ko.observable({}),w=!0,b=ko.observable(0),k=ko.observable(moment().startOf("day").startOf("year").add(-1,"year").toDate()),d=ko.observable(moment().startOf("day").endOf("year").add(1,"year").toDate()),u={},a=ko.observable(moment().startOf("day").toDate()),kt=ko.observable(moment().endOf("day").toDate()),i=ko.observable(null),r=ko.observable(null),f=ko.observable(!1),a=ko.observable(moment().startOf("day").toDate()),y;typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));typeof n.param!="undefined"&&parseInt(n.param,10)!=-1&&(i(null),r(null));var e=ko.observable(!1),o=ko.observable(null),v=ko.observable(null),s=ko.observable(null),g=ko.observable([]),nt=ko.observable([]),ft=ko.observable([]),et=VTPortal.approvalHistory(),st=function(n){if(!(t()!=null&&t()>0)){var i=n.value;new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)n.IsFloating?(a(moment.tz(n.StartFloating,VTPortal.roApp.serverTimeZone).toDate()),f(!0)):(a(moment().startOf("day").toDate()),f(!1));else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingShiftInfo"),"error",0,n)}).checkIsFloatingShift(i)}},ht=ko.computed(function(){return"76%"}),ct=function(){new WebServiceRobotics(function(n){var t,i,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(p(n.Comments),n.ReqStatus==0?h(!0):h(!1),c(!1),VTPortal.roApp.impersonatedIDEmployee!=-1&&(n.ReqStatus==0||n.ReqStatus==1)&&(c(!0),h(!1)),et.refreshApprovals(n.RequestsHistoryEntries),t=moment(n.strDate1,"YYYY-MM-DD HH:mm:ss").startOf("day"),i=moment(n.strDate2,"YYYY-MM-DD HH:mm:ss").startOf("day");t<=i;)u[t.clone().add(12,"hours").format("YYYYMMDD")]=!0,t=t.add(1,"day");if(n.strStartShift!=""){a(moment(n.strStartShift,"YYYY-MM-DD HH:mm:ss"));switch(moment(n.strStartShift,"YYYY-MM-DD HH:mm:ss").date()){case 29:s("0");break;case 30:s("1");break;case 31:s("2")}f(!0)}else f(!1);v(n.IdShift+"");n.Field4==0?o("-1"):o(n.Field4+"");tt(new Date)}else r=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r)},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())},lt=function(n){new WebServiceRobotics(function(n){var i,r;n.Status==window.VTPortalUtils.constants.OK.value?(i=[{FieldName:i18nextko.i18n.t("roAllShifts"),FieldValue:"-1"}],i=i.add(n.SelectFields.clone()),g(i),nt(n.SelectFields.clone()),t()!=null&&t()>0?ct(t()):(i.length>0&&o(i[0].FieldValue),n.SelectFields.length>0&&v(n.SelectFields[0].FieldValue),tt(new Date))):(r=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r))},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},ot=ko.observable(VTPortal.bigUserInfo());y=null;var wt=function(n){if(t()==null&&typeof l()[moment(n.value).format("YYYYMMDD")]!="undefined"){i()==null&&r()==null?(i(moment(n.value)),r(moment(n.value))):moment(n.value).isSame(i())?i(r()):moment(n.value).isSame(r())?r(i()):moment(n.value)>i()?r(moment(n.value)):moment(n.value)<i()&&i(moment(n.value));for(var f=moment(k()),e=moment(d());f<e;)f>=i()&&f<=r()?u[f.format("YYYYMMDD")]=!0:typeof u[f.format("YYYYMMDD")]!="undefined"&&(u[f.format("YYYYMMDD")]=!1),f=f.add(1,"day");$("#calendarSelectorContainer").dxCalendar("instance").repaint()}},bt=function(n){n.ID==2&&setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},200)};return{requestId:t,myApprovalsBlock:et,viewShown:at,title:i18nextko.t("roRequestType_ChangeShift"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:i18nextko.t("roSelectShift"),lblRequestValue2:i18nextko.t("roReeplaceShift"),lblInitialHour:i18nextko.t("roRequestShiftInitialHourLbl"),lblSelectDay:i18nextko.t("roRequestShiftSelectDayLbl"),lblSelectDaysInfo:i18nextko.t("roSelectDayInfo"),subscribeBlock:ot(),selectedTab:b,scrollContent:{height:ht},tabPanelOptions:{dataSource:[{ID:1,cssClass:"dx-icon-configRequest"},{ID:2,cssClass:"dx-icon-selectDate"}],selectedIndex:b,itemTemplate:"title",onSelectionChanged:function(n){bt(n.addedItems[0])}},popupVisible:ut,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),5,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:c},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),5,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:c},btnHistory:{onClick:function(){ut(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:rt},btnSave:{onClick:vt,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:it},btnDelete:{onClick:yt,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:h},calendarOptions:{width:"100%",useCellTemplate:!0,cellTemplate:pt,firstDayOfWeek:moment()._locale._week.dow,maxZoomLevel:"month",zoomLevel:"year",minZoomLevel:"year",onCellClick:wt,showTodayButton:!1,min:k,max:d},remarks:{value:p,readOnly:e},beginHour:{type:"time",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:a,readOnly:e,valueChangeEvent:"focusout"},cmbRequestValue1:{dataSource:g,displayExpr:"FieldName",valueExpr:"FieldValue",value:o,readOnly:e},cmbRequestValue2:{dataSource:nt,displayExpr:"FieldName",valueExpr:"FieldValue",value:v,readOnly:e,onValueChanged:st},cmbRequestValue3:{dataSource:ft,displayExpr:"FieldName",valueExpr:"FieldValue",value:s,readOnly:e},isFloating:f,loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.externalWork=function(n){function d(){p().viewShown();k("causes.externalwork");t()!=null&&t()>0&&(e(!0),VTPortalUtils.utils.markRequestAsRead(t()));VTPortal.roApp.impersonatedIDEmployee==-1?t()!=null&&r(!0):t()!=null&&u(!1);t()==null&&c(!0);t()!=null&&l(!0)}function g(){var n=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},t=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(4),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var t=function(){o.saveExternalWork(moment(f()),moment(h()).format("HH:mm"),s(),i()!=null?i():"-1",!0)};VTPortalUtils.utils.processRequestErrorMessage(n,t,function(){})}};o==null&&(o=new WebServiceRobotics(t,n));o.saveExternalWork(moment(f()),moment(h()).format("HH:mm"),s(),i()!=null?i():"-1",!1)}function nt(){t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}var t=ko.observable(null),s=ko.observable(""),c=ko.observable(!1),r=ko.observable(!1),l=ko.observable(!1),a=ko.observable(!1),u=ko.observable(!1),f=ko.observable(moment().startOf("day").toDate()),h=ko.observable(moment().startOf("day").toDate()),o;typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));typeof n.param!="undefined"&&parseInt(n.param,10)!=-1&&f(moment(n.param,"YYYY-MM-DD"));var e=ko.observable(!1),i=ko.observable(null),v=ko.observable([]),y=VTPortal.approvalHistory(),w=ko.computed(function(){return"76%"}),b=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)s(n.Comments),n.ReqStatus==0?r(!0):r(!1),u(!1),VTPortal.roApp.impersonatedIDEmployee!=-1&&(n.ReqStatus==0||n.ReqStatus==1)&&(u(!0),r(!1)),y.refreshApprovals(n.RequestsHistoryEntries),f(moment(n.strDate1,"YYYY-MM-DD HH:mm:ss").startOf("day").toDate()),h(moment(n.strHours,"HH:mm").toDate()),i(n.IdCause+"");else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())},k=function(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)v(n.SelectFields),t()!=null&&t()>0?b(t()):n.SelectFields.length>0&&i(n.SelectFields[0].FieldValue);else{var r=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,r)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},p=ko.observable(VTPortal.bigUserInfo());return o=null,{requestId:t,myApprovalsBlock:y,viewShown:d,title:i18nextko.t("roRequestType_ExternalWorkResumePart"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:i18nextko.t("roRequestCauseLbl"),lblInitialDate:i18nextko.t("roRequestDateLbl"),lblInitialHour:i18nextko.t("roRequestDurationLbl"),subscribeBlock:p(),scrollContent:{height:w},popupVisible:a,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),4,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:u},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),4,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:u},btnHistory:{onClick:function(){a(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:l},btnSave:{onClick:g,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:c},btnDelete:{onClick:nt,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:r},remarks:{value:s,readOnly:e},beginDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:f,readOnly:e,valueChangeEvent:"focusout"},beginHour:{type:"time",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:h,readOnly:e,valueChangeEvent:"focusout"},cmbRequestValue1:{dataSource:v,displayExpr:"FieldName",valueExpr:"FieldValue",value:i,readOnly:e},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.externalWorkWeekResume=function(n){function b(){v().viewShown();t()!=null&&t()>0&&(i(!0),VTPortalUtils.utils.markRequestAsRead(t()),w());VTPortal.roApp.impersonatedIDEmployee==-1?t()!=null&&r(!0):t()!=null&&u(!1);t()==null&&h(!0);t()!=null&&c(!0)}function k(){var n=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},t=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(15),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var t=function(){f.saveExternalWorkWeekResume(e(),o(),!0)};VTPortalUtils.utils.processRequestErrorMessage(n,t,function(){})}};f==null&&(f=new WebServiceRobotics(t,n));f.saveExternalWorkWeekResume(e(),o().sortBy(function(n){return n.DateTime}),!1)}function d(){t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}var t=ko.observable(null),e=ko.observable(""),h=ko.observable(!1),r=ko.observable(!1),c=ko.observable(!1),l=ko.observable(!1),u=ko.observable(!1),i=ko.observable(!1),a=VTPortal.approvalHistory(),o=ko.observable([]),s=ko.computed(function(){return!i()}),y=[{Name:i18nextko.i18n.t("roEntry"),Direction:"E"},{Name:i18nextko.i18n.t("roExit"),Direction:"S"}],f;typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));var p=ko.computed(function(){return"76%"}),w=function(){new WebServiceRobotics(function(n){var f,i,t,s;if(n.Status==window.VTPortalUtils.constants.OK.value){if(e(n.Comments),n.ReqStatus==0?r(!0):r(!1),u(!1),VTPortal.roApp.impersonatedIDEmployee!=-1&&(n.ReqStatus==0||n.ReqStatus==1)&&(u(!0),r(!1)),f=[],n.RequestDays!=null&&n.RequestDays.length>0)for(i=0;i<n.RequestDays.length;i++)t=n.RequestDays[i],f.push({Description:"",DateTime:moment.tz(t.RequestDate,VTPortal.roApp.serverTimeZone).toDate(),Direction:t.ActualType==1?"E":"S",IdCause:t.IdCause,Remark:t.Remark});o(f);a.refreshApprovals(n.RequestsHistoryEntries)}else s=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,s)},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())},v=ko.observable(VTPortal.bigUserInfo());return f=null,{requestId:t,myApprovalsBlock:a,viewShown:b,title:i18nextko.t("roRequestType_ExternalWorkWeekResume"),lblPunchesInfo:i18nextko.t("roExternalWorkWeekResumeDays"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),remarks:{value:e,readOnly:i},daysInfo:{dataSource:o,editing:{mode:"form",allowUpdating:s,allowDeleting:s,allowAdding:s,texts:{deleteRow:"Delete",editRow:"Edit"}},onInitNewRow:function(n){n.data={Description:"",DateTime:moment().startOf("day").toDate(),Direction:"E",IdCause:-1,Remark:""}},onCellPrepared:function(n){n.column&&n.column.command=="edit"&&(n.cellElement.find(".dx-link:contains('Edit')").html($("<span class='dx-icon-edit icon' />").height(16).width(16)),n.cellElement.find(".dx-link:contains('Delete')").html($("<span class='dx-icon-remove icon' />").height(16).width(16)))},columns:[{allowEditing:!1,visible:!0,dataField:"Description",caption:i18nextko.i18n.t("roGrid_Description"),dataType:"string",allowSorting:!1,formItem:{visible:!1},calculateCellValue:function(n){var r="",i,t;if(typeof n.IdCause!="undefined")for(i=VTPortalUtils.causes,t=0;t<i.length;t++)i[t].ID==n.IdCause&&(r=i[t].Name);return n.Direction+": "+moment.tz(n.DateTime,VTPortal.roApp.serverTimeZone).format("DD/MM/YYYY HH:mm")+(r!=""?" - "+r:"")+(n.Remark!=""?"("+n.Remark+")":"")}},{sortIndex:1,sortOrder:"asc",allowEditing:i,visible:!1,dataField:"DateTime",caption:i18nextko.i18n.t("roGrid_DateTime"),dataType:"date",format:"dd/MM/yyyy HH:mm",editorOptions:{type:"datetime",pickerType:VTPortalUtils.utils.datetimeTypeSelect()}},{allowEditing:i,visible:!1,dataField:"Direction",caption:i18nextko.i18n.t("roGrid_Direction"),lookup:{dataSource:y,displayExpr:"Name",valueExpr:"Direction"}},{allowEditing:i,visible:!1,dataField:"IdCause",caption:i18nextko.i18n.t("roGrid_Cause"),lookup:{dataSource:VTPortalUtils.causes,displayExpr:"Name",valueExpr:"ID"}},{allowEditing:i,visible:!1,dataField:"Remark",caption:i18nextko.i18n.t("roGrid_Remark")}],readOnly:i},subscribeBlock:v(),scrollContent:{height:p},popupVisible:l,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),15,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:u},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),15,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:u},btnHistory:{onClick:function(){l(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:c},btnSave:{onClick:k,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:h},btnDelete:{onClick:d,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:r},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.forgottenPunch=function(n){function wt(){ct().viewShown();u(nt()[0].ID);tt([]);VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Telecommuting&&VTPortal.roApp.userStatus().Telecommuting==!0?g(1):g(0);et([{FieldName:i18nextko.i18n.t("roOffice"),FieldValue:"0"},{FieldName:i18nextko.i18n.t("roHome"),FieldValue:"1"}]);ot([{FieldName:i18nextko.i18n.t("roEntry"),FieldValue:"E"},{FieldName:i18nextko.i18n.t("roExit"),FieldValue:"S"}]);l("E");s("0");t()!=null&&t()>0?(r(!0),pt(t()),VTPortalUtils.utils.markRequestAsRead(t())):p(u());VTPortal.roApp.impersonatedIDEmployee==-1?t()!=null&&a(!0):t()!=null&&v(!1);t()==null&&rt(!0);t()!=null&&ut(!0)}function p(n){switch(n){case 1:it("causes.readerinputcode");break;case 2:it("tasks.availabletasks");break;case 3:it("costcenters")}}function bt(){var n=moment(moment(o()).format("YYYY-MM-DD HH:mm:ss"));if(n<=moment())switch(u()){case 1:kt();break;case 2:dt();break;case 3:gt()}else VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingFuturePunch"),"error",0)}function kt(){l()=="S"&&s("0");var n=moment(moment(o()).format("YYYY-MM-DD HH:mm:ss")),t=e()!=null?e():"-1",i=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},r=function(i){if(i.Status==window.VTPortalUtils.constants.OK.value)i.PunchWithoutRequest==!0?(VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("lblPunchDone"),"success",2e3)):(VTPortal.roApp.redirectAtRequestList(2),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3));else{var r=function(){f.saveForbbidenPunch(n,t,h(),l(),!0,s())};VTPortalUtils.utils.processRequestErrorMessage(i,r,function(){})}};f==null&&(f=new WebServiceRobotics(r,i));f.saveForbbidenPunch(n,t,h(),l(),!1,s())}function dt(){var t=moment(o()).format("YYYY-MM-DD HH:mm"),i=e()==null?-1:e(),r=k()==null?-1:k(),u=moment(o()).format("YYYY-MM-DD")+" "+moment(b()).format("HH:mm"),a=y(),n,c,l;d.savePunchInfo();n=VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue;w()&&(momentEndHour=moment(o()).format("YYYY-MM-DD")+" "+moment(b()).format("HH:mm"));c=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)};l=function(e){if(e.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(10),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var o=function(){f.SaveRequest_ForbiddenTaskPunch(t,i,u,r,y(),h(),n[0],n[1],n[2],n[3],n[4],n[5],!0,s())};VTPortalUtils.utils.processRequestErrorMessage(e,o,function(){})}};f==null&&(f=new WebServiceRobotics(l,c));f.SaveRequest_ForbiddenTaskPunch(t,i,u,r,y(),h(),n[0],n[1],n[2],n[3],n[4],n[5],!1,s())}function gt(){var n=moment(moment(o()).format("YYYY-MM-DD HH:mm:ss")),t=e()==null?-1:e(),i=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},r=function(i){if(i.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(12),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var r=function(){f.saveCostCenterPunch(n,t,h(),!0,s())};VTPortalUtils.utils.processRequestErrorMessage(i,r,function(){})}};f==null&&(f=new WebServiceRobotics(r,i));f.saveCostCenterPunch(n,t,h(),!1,s())}function ni(){t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}function lt(){VTPortal.roApp.taskPunchRequest({currentAction:-2,newAction:-1,currentTaskUserFieldsDefinition:null,currentTaskUserFieldsValue:["","","",-1,-1,-1],newTaskUserFieldsDefinition:null,newTaskUserFieldsValue:["","","",-1,-1,-1]});r()&&i!=null&&(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[0]=i.Field1,VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[1]=i.Field2,VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[2]=i.Field3,VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[3]=i.Field4,VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[4]=i.Field5,VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsValue[5]=i.Field6);new WebServiceRobotics(function(n){var i,t,u;if(n.Status==window.VTPortalUtils.constants.OK.value){for(VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition=n.Fields,i=!1,t=0;t<n.Fields.length;t++)n.Fields[t].Used&&(i=!0);i&&d.initTaskProperties(r())}else u=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingTaskInfo"),"error",0,u)}).getTaskUserFieldsAction(VTPortalUtils.taskAction.change,e())}var t=ko.observable(null),h=ko.observable(""),rt=ko.observable(!1),a=ko.observable(!1),ut=ko.observable(!1),ft=ko.observable(!1),v=ko.observable(!1),w=ko.observable(!1),y=ko.observable(!1),d=VTPortal.taskFieldsInput(),g=ko.observable(null),u=ko.observable(null),nt=ko.observable([]),at=ko.computed(function(){if(u()!=null)switch(u()){case 1:return i18nextko.i18n.t("roRequestCauseLbl");case 2:return i18nextko.i18n.t("roRequestTaskLbl");case 3:return i18nextko.i18n.t("roRequestCostCenersLbl")}}),c=[],f;VTPortal.roApp.impersonateOnlyRequest?(c.push({ID:1,Name:i18nextko.i18n.t("roForgottenType_Presence")}),c.push({ID:2,Name:i18nextko.i18n.t("roForgottenType_Task")}),c.push({ID:3,Name:i18nextko.i18n.t("roForgottenType_CostCenter")})):($.grep(VTPortal.roApp.empPermissions().Requests,function(n){return n.RequestType==2&&n.Permission==!0}).length==1&&c.push({ID:1,Name:i18nextko.i18n.t("roForgottenType_Presence")}),$.grep(VTPortal.roApp.empPermissions().Requests,function(n){return n.RequestType==10&&n.Permission==!0}).length==1&&c.push({ID:2,Name:i18nextko.i18n.t("roForgottenType_Task")}),$.grep(VTPortal.roApp.empPermissions().Requests,function(n){return n.RequestType==12&&n.Permission==!0}).length==1&&c.push({ID:3,Name:i18nextko.i18n.t("roForgottenType_CostCenter")}));nt(c);var vt=ko.observable(""),o=ko.observable(moment().startOf("day").toDate()),b=ko.observable(moment().startOf("day").toDate());typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));typeof n.param!="undefined"&&parseInt(n.param,10)!=-1&&o(moment(n.param,"YYYY-MM-DD"));typeof n.iDate!="undefined"&&parseInt(n.iDate,10)!=-1&&vt(n.iDate);var r=ko.observable(!1),l=ko.observable(null),e=ko.observable(null),s=ko.observable(null),k=ko.observable(null),et=ko.observable([]),ot=ko.observable([]),tt=ko.observable([]),st=ko.observable([]),ht=VTPortal.approvalHistory(),yt=ko.computed(function(){return"76%"}),i=null,pt=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value){i=n;h(n.Comments);n.ReqStatus==0?a(!0):a(!1);v(!1);VTPortal.roApp.impersonatedIDEmployee!=-1&&(n.ReqStatus==0||n.ReqStatus==1)&&(v(!0),a(!1));ht.refreshApprovals(n.RequestsHistoryEntries);o(moment(n.strDate1,"YYYY-MM-DD HH:mm:ss").toDate());u();switch(n.RequestType){case 2:u(1);p(1);break;case 10:u(2);p(2);break;case 12:u(3);p(3)}}else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())},it=function(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)if(tt(n.SelectFields),st(n.SelectFields.clone()),t()!=null&&t()>0&&i!=null)switch(u()){case 1:l(i.Field1+"");e(i.IdCause+"");break;case 2:e(i.IdTask+"");y(i.CompletedTask);w(i.IdTask2>=0);b(moment(i.strDate2,"YYYY-MM-DD HH:mm:ss").toDate());k(i.IdTask2+"");i.IdTask2>=0&&lt();break;case 3:e(i.IdCenter+"")}else n.SelectFields.length>0&&r()==!1&&e(n.SelectFields[0].FieldValue);else{var f=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,f)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},ct=ko.observable(VTPortal.bigUserInfo());return f=null,{requestId:t,myApprovalsBlock:ht,viewShown:wt,title:i18nextko.t("roRequestType_ForbiddenPunch"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblForgottenPunchType:i18nextko.t("roForgottenPunchType"),lblRequestValue1:i18nextko.t("roRequestDirectionLbl"),lblRequestValue2:at,lblInitialDate:i18nextko.t("roRequestDateHourLbl"),subscribeBlock:ct(),scrollContent:{height:yt},popupVisible:ft,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),2,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:v},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),2,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:v},btnHistory:{onClick:function(){ft(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:ut},btnSave:{onClick:bt,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:rt},btnDelete:{onClick:ni,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:a},remarks:{value:h,readOnly:r},beginDate:{type:"datetime",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:o,readOnly:r},tcEnabled:g,forgottenPunchType:u,cmbforgottenPunchType:{dataSource:nt,displayExpr:"Name",valueExpr:"ID",value:u,readOnly:r,onValueChanged:function(n){r()||p(n.value)}},reqValue1:l,cmbRequestValue1:{dataSource:ot,displayExpr:"FieldName",valueExpr:"FieldValue",value:l,readOnly:r},cmbTCType:{dataSource:et,displayExpr:"FieldName",valueExpr:"FieldValue",value:s,readOnly:r},cmbRequestValue2:{dataSource:tt,displayExpr:"FieldName",valueExpr:"FieldValue",value:e,readOnly:r,onValueChanged:function(){u()!=2||r()||lt()}},lblTC:i18nextko.t("roTCWhereF"),lblContinueWith:i18nextko.t("rolblContinueWith"),finishVisible:w,cmbContinueWith:{dataSource:st,displayExpr:"FieldName",valueExpr:"FieldValue",value:k,readOnly:r},lblEndTaskHour:i18nextko.t("rolblEndTaskHour"),endTaskHour:{type:"time",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:b,readOnly:r,valueChangeEvent:"focusout"},taskFieldsBlock:d,ckCompleteTask:{text:i18nextko.t("roCompleteTaks"),value:y,readOnly:r},ckCustomizeFinish:{text:i18nextko.t("roCustomizeFinishLbl"),value:w,readOnly:r},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.justifyPunch=function(n){function k(){y().viewShown();b("causes.readerinputcode");t()!=null&&t()>0&&(o(!0),VTPortalUtils.utils.markRequestAsRead(t()));VTPortal.roApp.impersonatedIDEmployee==-1?t()!=null&&i(!0):t()!=null&&r(!1);t()==null&&h(!0);t()!=null&&c(!0)}function d(){var n=moment(s(),"YYYYMMDDHHmmss"),t=u()!=null?u():"-1",i=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},r=function(i){if(i.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(3),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var r=function(){f.savePunchCause(t,n,e(),!0)};VTPortalUtils.utils.processRequestErrorMessage(i,r,function(){})}};f==null&&(f=new WebServiceRobotics(r,i));f.savePunchCause(t,n,e(),!1)}function g(){t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}var t=ko.observable(null),e=ko.observable(""),s=ko.observable(""),h=ko.observable(!1),i=ko.observable(!1),c=ko.observable(!1),l=ko.observable(!1),r=ko.observable(!1),f;typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));typeof n.param!="undefined"&&s(n.param);var o=ko.observable(!1),u=ko.observable(null),a=ko.observable([]),v=VTPortal.approvalHistory(),p=ko.computed(function(){return"76%"}),w=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)e(n.Comments),n.ReqStatus==0?i(!0):i(!1),r(!1),VTPortal.roApp.impersonatedIDEmployee!=-1&&(n.ReqStatus==0||n.ReqStatus==1)&&(r(!0),i(!1)),v.refreshApprovals(n.RequestsHistoryEntries),u(n.IdCause+"");else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())},b=function(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)a(n.SelectFields),t()!=null&&t()>0?w(t()):n.SelectFields.length>0&&u(n.SelectFields[0].FieldValue);else{var i=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,i)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},y=ko.observable(VTPortal.bigUserInfo());return f=null,{requestId:t,myApprovalsBlock:v,viewShown:k,title:i18nextko.t("roRequestType_JustifyPunch"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:i18nextko.t("roRequestCauseLbl"),subscribeBlock:y(),scrollContent:{height:p},popupVisible:l,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),3,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:r},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),3,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:r},btnHistory:{onClick:function(){l(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:c},btnSave:{onClick:d,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:h},btnDelete:{onClick:g,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:i},remarks:{value:e,readOnly:o},cmbRequestValue1:{dataSource:a,displayExpr:"FieldName",valueExpr:"FieldValue",value:u,readOnly:o},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.plannedAbsence=function(n){function si(){if(dt().viewShown(),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Holidays)b([]),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.CausesPermissions?kt("causes.programmedAbsence"):kt("causes.visibilitypermissions"),i()!=null&&i()>0&&(p(!0),VTPortalUtils.utils.markRequestAsRead(i())),VTPortal.roApp.impersonatedIDEmployee==-1?i()!=null&&h(!0):i()!=null&&v(!1),i()==null&&ct(!0),i()!=null&&lt(!0);else{var n=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roIncorrectApiVersion"),"error",0,n)}}function ht(n){new WebServiceRobotics(function(n){var i,t,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=y(),t=0;t<n.oCalendar.DayData.length;t++)i[moment.tz(n.oCalendar.DayData[t].PlanDate,VTPortal.roApp.serverTimeZone).add(12,"hours").format("YYYYMMDD")]=n.oCalendar.DayData[t];y(i);nt()==1&&setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},100)}else y([]),r=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r);g=!1},function(){g=!1}).getAvailablePermitsCalendar(n,-1)}function hi(){t()==null||r==null?(nt(1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roSelectDayInfo"),"info",2e3)):ci()}function ci(){var i=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},n=ot.getDocument(),u=function(i){if(i.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(7),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var u=function(){e.saveAbsences(t()==null?VTPortalUtils.nullDate:t(),r()==null?VTPortalUtils.nullDate:r(),w(),k(),!0,n)};VTPortalUtils.utils.processRequestErrorMessage(i,u,function(){})}};e==null&&(e=new WebServiceRobotics(u,i));e.saveAbsences(t()==null?VTPortalUtils.nullDate:t(),r()==null?VTPortalUtils.nullDate:r(),w(),k(),!1,n)}function li(){typeof o()!="undefined"&&o()!=null&&o()>0?VTPortalUtils.utils.deleteProgrammedAbsence(o(),"days"):i()!=null&&i()>0&&VTPortalUtils.utils.deleteRequest(i())}function ai(n){var t="",i="#dcdcdc",r="#dcdcdc",u=90,e=95,o=y()[moment(n.date).format("YYYYMMDD")],l=0,a=!1,h="";if(moment(n.date).format("YYYYMMDD")==moment().format("YYYYMMDD")&&(h="actualDate"),o!=null){if(o.MainShift!=null&&(l=o.MainShift.PlannedHours,a=o.IsHoliday),i=VTPortalUtils.calendar.getCellColor(f,n.date,n.view),absenceStyle="width:100%;height:100%;color: "+r+";",absenceStyle+="background: "+r+";",absenceStyle+="background: -webkit-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -moz-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -ms-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -o-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: radial-gradient(circle closest-side at center, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background-repeat: no-repeat;",absenceStyle+="background-position: center center;display:table;",t="width:100%;height:100%;color: #000000;",t+="background: "+i+";",t+="background: -webkit-radial-gradient(circle closest-side, "+i+" "+u+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -moz-radial-gradient(circle closest-side, "+i+" "+u+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -ms-radial-gradient(circle closest-side, "+i+" "+u+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -o-radial-gradient(circle closest-side, "+i+" "+u+"%,rgba(255,255,255,0) "+e+"%);",t+="background: radial-gradient(circle closest-side at center, "+i+" "+u+"%,rgba(255,255,255,0) "+e+"%);",t+="background-repeat: no-repeat;",t+="background-position: center center;display:table;",n.view=="month")return"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span class='"+h+"' style='display:table-cell;vertical-align:middle;font-weight:bold'>"+n.text+"<\/span><\/div><\/div><\/div><\/div>";if(n.view=="year"){if(moment(n.date).isAfter(moment(tt()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(it()))){for(var s=moment(n.date).startOf("month"),v=moment(n.date).endOf("month"),c=0;s<v;)f[s.format("YYYYMMDD")]==!0&&(c+=1),s=s.add(1,"day");return c>0?"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+" ("+c+")<\/span><\/div><\/div><\/div><\/div>":"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+"<\/span><\/div><\/div><\/div><\/div>"}return""}}else return moment(n.date).isAfter(moment(tt()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(it()))?(g||(g=!0,ht(n.date)),"<span class='"+h+"' >"+n.text+"<\/span>"):""}var i=ko.observable(null),o=ko.observable(null),k=ko.observable(""),ct=ko.observable(!1),h=ko.observable(!1),lt=ko.observable(!1),pi=ko.observable(!1),d=ko.observable(!1),at=ko.observable(!1),v=ko.observable(!1),y=ko.observable({}),g=!0,nt=ko.observable(0),tt=ko.observable(moment().startOf("day").startOf("year").add(-1,"year").toDate()),it=ko.observable(moment().startOf("day").endOf("year").add(1,"year").toDate()),u=[{ID:1,cssClass:"dx-icon-configRequest",badge:0},{ID:2,cssClass:"dx-icon-selectDate",badge:0}],vt,e;$.grep(VTPortal.roApp.empPermissions().Requests,function(n){return n.RequestType==7&&n.Permission==!0&&typeof n.HasRankings!="undefined"&&n.HasRankings==!0}).length==1&&(vt=u.find(function(n){return n.ID=="3"}),vt==null&&u.push({ID:3,cssClass:"dx-icon-rankings",badge:""}));var c=ko.observable(!0),l=ko.observable(!1),a=ko.observable(!1),rt=ko.observable([]),yt=ko.observable(0),pt=ko.observable(0),st=ko.observable(0),ut=ko.observable(0),ft=ko.observable(0),wi=ko.observable(i18nextko.i18n.t("roFindFile")),gt=ko.observable(i18nextko.i18n.t("roFileAdded")),wt=ko.observable(!1),s=ko.observable(0),et=ko.observable([]),ot=new VTPortal.documentInput,ni=ko.computed(function(){return et().length>0}),ti=function(n){if(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.PortalNext)et([]),new WebServiceRobotics(function(i){var u,e;i.Status==window.VTPortalUtils.constants.OK.value?(et(i.SelectFields),ot.initializeData(i.SelectFields,!1,-1),ut(7),ft(parseInt(n.value,10)),u=b().find(function(t){return parseInt(t.FieldValue,10)==parseInt(n.value,10)}),u!=null?parseInt(u.RelatedInfo,10)>0?s(parseInt(u.RelatedInfo,10)):s(0):s(0),t(null),r(null),p()||(f={})):(e=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(i,e))},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingCauseInfo"),"error",0,n)}).getRequieredCauseDocuments(parseInt(n.value,10));else{et([]);ut(7);ft(parseInt(n.value,10));var i=b().find(function(t){return parseInt(t.FieldValue,10)==parseInt(n.value,10)});i!=null?parseInt(i.RelatedInfo,10)>0?s(parseInt(i.RelatedInfo,10)):s(0):s(0);t(null);r(null);p()||(f={})}},ii=function(){var n=u.find(function(n){return n.ID==3});if(n==null&&(n={ID:3,cssClass:"dx-icon-rankings",badge:""}),st()==0||st()==1)if(VTPortalUtils.utils.checkIfRequestHasRanquings(ut(),ft())){var i=null,r=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorRequestingRankings"),"error",0)},f=function(t){if(t.Status==window.VTPortalUtils.constants.OK.value){if(setTimeout(function(){$("#configRequestTab").dxTabs("instance").repaint()},150),t.Rankings!=null){for(var i=0;i<t.Rankings.RequestEmployeeRankingPositions.length;i++)t.Rankings.RequestEmployeeRankingPositions[i].cssClass=t.Rankings.RequestEmployeeRankingPositions[i].IDEmployee==VTPortal.roApp.employeeId?"rankingMyPosition":"listMenuItemPosition";rt(t.Rankings.RequestEmployeeRankingPositions)}else rt([]);n.badge=t.RankingEnabled?t.ActualPosition:"";t.CoverageEnabled&&(yt(t.Coverages.MinCoverage),pt(t.Coverages.DifferentialQuantity),n.badge=n.badge+"/"+t.Coverages.DifferentialQuantity);u=u.remove(function(n){return n.ID==3});u.push(n);c(!1);l(t.RankingEnabled);a(t.CoverageEnabled)}else c(!0),l(!1),a(!1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorRequestingRankings"),"error",0)};i==null&&(i=new WebServiceRobotics(f,r));t()!=null?i.getRankingForDay(t(),ut(),ft()):(c(!0),l(!1),a(!1))}else c(!0),l(!1),a(!1),n.badge="",u=u.remove(function(n){return n.ID==3}),u.push(n),setTimeout(function(){$("#configRequestTab").dxTabs("instance").repaint()},150);else c(!0),l(!1),a(!1),n.badge="",u=u.remove(function(n){return n.ID==3}),u.push(n),setTimeout(function(){$("#configRequestTab").dxTabs("instance").repaint()},150)},f={},bi=ko.observable(moment().startOf("day").toDate()),ki=ko.observable(moment().endOf("day").toDate()),t=ko.observable(null),r=ko.observable(null);typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&i(parseInt(n.id,10));typeof n.iDate!="undefined"&&parseInt(n.iDate,10)!=-1&&(t(moment(n.iDate,"YYYY-MM-DD")),r(moment(n.iDate,"YYYY-MM-DD")),f[moment(n.iDate,"YYYY-MM-DD").format("YYYYMMDD")]=!0);var ri=ko.computed(function(){return i18nextko.i18n.t("roRequestType_PlannedAbsences")}),ui=ko.computed(function(){return i18nextko.i18n.t("roSelectAbsence")}),p=ko.observable(!1),w=ko.observable(null),b=ko.observable([]),bt=VTPortal.approvalHistory(),fi=ko.computed(function(){return"76%"}),ei=function(){new WebServiceRobotics(function(n){var i,u,e;if(n.Status==window.VTPortalUtils.constants.OK.value){for(k(n.Comments),o(n.AbsenceId),st(n.ReqStatus),n.ReqStatus==0?h(!0):h(!1),v(!1),VTPortal.roApp.impersonatedIDEmployee!=-1&&(n.ReqStatus==0||n.ReqStatus==1)&&(v(!0),h(!1)),i=moment(n.strDate1,"YYYY-MM-DD HH:mm:ss").startOf("day"),t(i.clone()),u=moment(n.strDate2,"YYYY-MM-DD HH:mm:ss").startOf("day"),r(u);i<=u;)f[i.clone().add(12,"hours").format("YYYYMMDD")]=!0,i=i.add(1,"day");typeof o()!="undefined"&&o()!=null&&o()>0&&(moment(n.strDate1,"YYYY-MM-DD HH:mm:ss")>moment()?h(!0):h(!1));bt.refreshApprovals(n.RequestsHistoryEntries);w(n.IdCause+"");ht(new Date)}else e=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,e)},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(i())},kt=function(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)b(n.SelectFields),i()!=null&&i()>0?ei(i()):(n.SelectFields.length>0&&w(n.SelectFields[0].FieldValue),ht(new Date));else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},dt=ko.observable(VTPortal.bigUserInfo()),e=null,oi=function(){var t=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},r=function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDocumentUploaded"),"success",2e3)):VTPortalUtils.utils.processErrorMessage(n)},n;e==null&&(e=new WebServiceRobotics(r,t));n=ot.getDocument();VTPortal.roApp.isModeApp()==!1?(n.append("idRelatedObject",i()),n.append("forecastType","request"),e.uploadDocumentDesktop(n)):(n.append("idRelatedObject",i()),e.uploadDocumentMobile(n,"request","",""))};e=null;var vi=function(n){var u,e;if(i()==null&&typeof y()[moment(n.value).format("YYYYMMDD")]!="undefined"){if(s()==0)for(t()==null&&r()==null?(t(moment(n.value)),r(moment(n.value))):moment(n.value).isSame(t())?t(r()):moment(n.value).isSame(r())?r(t()):moment(n.value)>t()?r(moment(n.value)):moment(n.value)<t()&&t(moment(n.value)),u=moment(tt()),e=moment(it());u<e;)u>=t()&&u<=r()?f[u.format("YYYYMMDD")]=!0:typeof f[u.format("YYYYMMDD")]!="undefined"&&(f[u.format("YYYYMMDD")]=!1),u=u.add(1,"day");else{if(u=null,e=null,t()!=null&&(u=t().clone()),r()!=null&&(e=r().clone()),u!=null)while(u<=e)f[u.format("YYYYMMDD")]=!1,u=u.add(1,"day");for(t(moment(n.value)),r(t().clone().add(s()-1,"day")),u=t().clone(),e=r().clone();u<=e;)f[u.format("YYYYMMDD")]=!0,u=u.add(1,"day")}$("#calendarSelectorContainer").dxCalendar("instance").repaint()}},yi=function(n){n.ID==2?setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},200):n.ID==3&&ii()};return{requestId:i,myApprovalsBlock:bt,viewShown:si,title:ri,lblDocument:i18nextko.t("roLblDocument"),btnCancelUpload:{onClick:function(){d(!1)},text:i18nextko.t("roCancel")},btnAcceptUpload:{onClick:function(){i()!=null&&i()>0?oi():(wt(!0),d(!1))},text:i18nextko.t("roSaveRequest")},lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:ui,lblSelectDaysInfo:i18nextko.t("roSelectDayInfo"),subscribeBlock:dt(),selectedTab:nt,scrollContent:{height:fi},tabPanelOptions:{dataSource:u,selectedIndex:nt,itemTemplate:"title",onSelectionChanged:function(n){yi(n.addedItems[0])}},popupVisible:at,popupDocumentsVisible:d,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(i(),7,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:v},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(i(),7,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:v},btnHistory:{onClick:function(){at(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:lt},btnDocuments:{onClick:function(){d(!0)},text:"",hint:i18nextko.i18n.t("roLblDocuments"),icon:"Images/Common/Document.png"},btnSave:{onClick:hi,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:ct},btnDelete:{onClick:li,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:h},calendarOptions:{width:"100%",useCellTemplate:!0,cellTemplate:ai,firstDayOfWeek:moment()._locale._week.dow,maxZoomLevel:"month",zoomLevel:"year",minZoomLevel:"year",onCellClick:vi,showTodayButton:!1,min:tt,max:it},remarks:{value:k,readOnly:p},cmbRequestValue1:{dataSource:b,displayExpr:"FieldName",valueExpr:"FieldValue",value:w,readOnly:p,onValueChanged:ti},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),noRankingDateSelected:c,hasRankingData:l,hasCoverageData:a,rankingDS:rt,listRanking:{dataSource:rt,scrollingEnabled:!1,collapsibleGroups:!1,itemTemplate:"RankingItem"},lblRankingHeader:i18nextko.t("roRankingTitle"),lblCoverageHeader:i18nextko.t("roCoverageTitle"),lblNoDataDescription:i18nextko.t("roNoRankingDescription"),lblMinimumCoverageRequiered:i18nextko.t("rolblMinimumCoverageRequiered"),txtMinimumCoverageRequiered:{value:yt,readOnly:!0},lblDiferentialCoverage:i18nextko.t("rolblDiferentialCoverage"),txtDifferentialCoverage:{value:pt,readOnly:!0},myDocumentsBlock:ot,hasDocuments:ni,fileAdded:gt,documentAttached:wt}};VTPortal.plannedCause=function(n){function ci(){if(ti().viewShown(),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Holidays)k([]),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.CausesPermissions?ni("causes.programmedCause"):ni("causes.visibilitypermissions"),t()!=null&&t()>0&&(h(!0),VTPortalUtils.utils.markRequestAsRead(t())),VTPortal.roApp.impersonatedIDEmployee==-1?t()!=null&&c(!0):t()!=null&&y(!1),t()==null&&vt(!0),t()!=null&&yt(!0);else{var n=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roIncorrectApiVersion"),"error",0,n)}}function at(n){new WebServiceRobotics(function(n){var i,t,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=p(),t=0;t<n.oCalendar.DayData.length;t++)i[moment.tz(n.oCalendar.DayData[t].PlanDate,VTPortal.roApp.serverTimeZone).add(12,"hours").format("YYYYMMDD")]=n.oCalendar.DayData[t];p(i);tt()==1&&setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},100)}else p([]),r=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r);nt=!1},function(){nt=!1}).getAvailablePermitsCalendar(n,-1)}function li(){if(i()==null||r==null)tt(1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roSelectDayInfo"),"info",2e3);else{var n=moment(ht()).format("HH:mm"),t=moment(ct()).format("HH:mm"),u="1899-12-";u+=n>t?"31 ":"30 ";var f=moment("1899-12-30 "+n.format("HH:mm"),"YYYY-MM-DD HH:mm"),o=moment(u+t.format("HH:mm"),"YYYY-MM-DD HH:mm"),h=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},s=st.getDocument(),c=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(9),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var t=function(){e.saveIncidence(i()==null?VTPortalUtils.nullDate:i(),r()==null?VTPortalUtils.nullDate:r(),f,o,moment(w()).format("HH:mm"),b(),d(),!0,s)};VTPortalUtils.utils.processRequestErrorMessage(n,t,function(){})}};e==null&&(e=new WebServiceRobotics(c,h));e.saveIncidence(i()==null?VTPortalUtils.nullDate:i(),r()==null?VTPortalUtils.nullDate:r(),f,o,moment(w()).format("HH:mm"),b(),d(),!1,s)}}function ai(){typeof o()!="undefined"&&o()!=null&&o()>0?VTPortalUtils.utils.deleteProgrammedAbsence(o(),"hours"):t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}function ii(){var n=moment(ht()),t=moment(ct()),i="1970-01-",r,u;i+=n.isAfter(t)?"31":"30";r=moment("1970-01-30 "+n.format("HH:mm")+":00","YYYY-MM-DD HH:mm:ss");u=moment(i+" "+t.format("HH:mm")+":00","YYYY-MM-DD HH:mm:ss");w(moment("1970-01-30 "+moment(u.diff(r)).utc().format("HH:mm")+":00").toDate())}function vi(n){var t="",i="#dcdcdc",r="#dcdcdc",u=90,e=95,o=p()[moment(n.date).format("YYYYMMDD")],l=0,a=!1,h="";if(moment(n.date).format("YYYYMMDD")==moment().format("YYYYMMDD")&&(h="actualDate"),o!=null){if(o.MainShift!=null&&(l=o.MainShift.PlannedHours,a=o.IsHoliday),i=VTPortalUtils.calendar.getCellColor(f,n.date,n.view),absenceStyle="width:100%;height:100%;color: "+r+";",absenceStyle+="background: "+r+";",absenceStyle+="background: -webkit-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -moz-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -ms-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -o-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: radial-gradient(circle closest-side at center, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background-repeat: no-repeat;",absenceStyle+="background-position: center center;display:table;",t="width:100%;height:100%;color: #000000;",t+="background: "+i+";",t+="background: -webkit-radial-gradient(circle closest-side, "+i+" "+u+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -moz-radial-gradient(circle closest-side, "+i+" "+u+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -ms-radial-gradient(circle closest-side, "+i+" "+u+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -o-radial-gradient(circle closest-side, "+i+" "+u+"%,rgba(255,255,255,0) "+e+"%);",t+="background: radial-gradient(circle closest-side at center, "+i+" "+u+"%,rgba(255,255,255,0) "+e+"%);",t+="background-repeat: no-repeat;",t+="background-position: center center;display:table;",n.view=="month")return"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span class='"+h+"' style='display:table-cell;vertical-align:middle;font-weight:bold'>"+n.text+"<\/span><\/div><\/div><\/div><\/div>";if(n.view=="year"){if(moment(n.date).isAfter(moment(it()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(rt()))){for(var s=moment(n.date).startOf("month"),v=moment(n.date).endOf("month"),c=0;s<v;)f[s.format("YYYYMMDD")]==!0&&(c+=1),s=s.add(1,"day");return c>0?"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+" ("+c+")<\/span><\/div><\/div><\/div><\/div>":"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+"<\/span><\/div><\/div><\/div><\/div>"}return""}}else return moment(n.date).isAfter(moment(it()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(rt()))?(nt||(nt=!0,at(n.date)),"<span class='"+h+"' >"+n.text+"<\/span>"):""}var t=ko.observable(null),o=ko.observable(null),d=ko.observable(""),vt=ko.observable(!1),c=ko.observable(!1),yt=ko.observable(!1),wi=ko.observable(!1),g=ko.observable(!1),pt=ko.observable(!1),y=ko.observable(!1),p=ko.observable({}),nt=!0,tt=ko.observable(0),it=ko.observable(moment().startOf("day").startOf("year").add(-1,"year").toDate()),rt=ko.observable(moment().startOf("day").endOf("year").add(1,"year").toDate()),u=[{ID:1,cssClass:"dx-icon-configRequest"},{ID:2,cssClass:"dx-icon-selectDate"}],wt,e;$.grep(VTPortal.roApp.empPermissions().Requests,function(n){return n.RequestType==9&&n.Permission==!0&&typeof n.HasRankings!="undefined"&&n.HasRankings==!0}).length==1&&(wt=u.find(function(n){return n.ID=="3"}),wt==null&&u.push({ID:3,cssClass:"dx-icon-rankings",badge:""}));var l=ko.observable(!0),a=ko.observable(!1),v=ko.observable(!1),ut=ko.observable([]),bt=ko.observable(0),kt=ko.observable(0),lt=ko.observable(0),ft=ko.observable(0),et=ko.observable(0),ri=ko.observable(i18nextko.i18n.t("roFileAdded")),dt=ko.observable(!1),s=ko.observable(0),ot=ko.observable([]),st=new VTPortal.documentInput,ui=ko.computed(function(){return ot().length>0}),fi=function(n){if(ot([]),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.PortalNext)new WebServiceRobotics(function(t){var i,r;t.Status==window.VTPortalUtils.constants.OK.value?(ot(t.SelectFields),st.initializeData(t.SelectFields,!1,-1),ft(9),et(parseInt(n.value,10)),i=k().find(function(t){return parseInt(t.FieldValue,10)==parseInt(n.value,10)}),i!=null?parseInt(i.RelatedInfo,10)>0?s(parseInt(i.RelatedInfo,10)):s(0):s(0),h()||(f={})):(r=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(t,r))},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingCauseInfo"),"error",0,n)}).getRequieredCauseDocuments(parseInt(n.value,10));else{ot([]);ft(9);et(parseInt(n.value,10));var t=k().find(function(t){return parseInt(t.FieldValue,10)==parseInt(n.value,10)});t!=null?parseInt(t.RelatedInfo,10)>0?s(parseInt(t.RelatedInfo,10)):s(0):s(0);h()||(f={})}},ei=function(){var n=u.find(function(n){return n.ID==3});if(n==null&&(n={ID:3,cssClass:"dx-icon-rankings",badge:""}),lt()==0||lt()==1)if(VTPortalUtils.utils.checkIfRequestHasRanquings(ft(),et())){var t=null,r=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorRequestingRankings"),"error",0)},f=function(t){if(t.Status==window.VTPortalUtils.constants.OK.value){if(setTimeout(function(){$("#configRequestTab").dxTabs("instance").repaint()},150),t.Rankings!=null){for(var i=0;i<t.Rankings.RequestEmployeeRankingPositions.length;i++)t.Rankings.RequestEmployeeRankingPositions[i].cssClass=t.Rankings.RequestEmployeeRankingPositions[i].IDEmployee==VTPortal.roApp.employeeId?"rankingMyPosition":"listMenuItemPosition";ut(t.Rankings.RequestEmployeeRankingPositions)}else ut([]);n.badge=t.RankingEnabled?t.ActualPosition:"";t.CoverageEnabled&&(bt(t.Coverages.MinCoverage),kt(t.Coverages.DifferentialQuantity),n.badge=n.badge+"/"+t.Coverages.DifferentialQuantity);u=u.remove(function(n){return n.ID==3});u.push(n);l(!1);a(t.RankingEnabled);v(t.CoverageEnabled)}else l(!0),a(!1),v(!1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorRequestingRankings"),"error",0)};t==null&&(t=new WebServiceRobotics(f,r));i()!=null?t.getRankingForDay(i(),ft(),et()):(l(!0),a(!1),v(!1))}else l(!0),a(!1),v(!1),n.badge="",u=u.remove(function(n){return n.ID==3}),u.push(n),setTimeout(function(){$("#configRequestTab").dxTabs("instance").repaint()},150);else l(!0),a(!1),v(!1),n.badge="",u=u.remove(function(n){return n.ID==3}),u.push(n),setTimeout(function(){$("#configRequestTab").dxTabs("instance").repaint()},150)},f={},ht=ko.observable(moment().startOf("day").toDate()),ct=ko.observable(moment().endOf("day").toDate()),i=ko.observable(null),r=ko.observable(null),ht=ko.observable(moment().startOf("day").toDate()),ct=ko.observable(moment().endOf("day").toDate()),w=ko.observable(moment().endOf("day").toDate());typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));typeof n.param!="undefined"&&parseInt(n.param,10)!=-1&&(f[moment(n.param,"YYYY-MM-DD").format("YYYYMMDD")]=!0);var h=ko.observable(!1),b=ko.observable(null),k=ko.observable([]),gt=VTPortal.approvalHistory(),oi=ko.computed(function(){return"76%"}),si=function(){new WebServiceRobotics(function(n){var t,i,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(d(n.Comments),o(n.AbsenceId),lt(n.ReqStatus),n.ReqStatus==0?c(!0):c(!1),typeof o()!="undefined"&&o()!=null&&o()>0&&c(!0),y(!1),VTPortal.roApp.impersonatedIDEmployee!=-1&&(n.ReqStatus==0||n.ReqStatus==1)&&(y(!0),c(!1)),gt.refreshApprovals(n.RequestsHistoryEntries),t=moment(n.strDate1,"YYYY-MM-DD HH:mm:ss").startOf("day"),i=moment(n.strDate2,"YYYY-MM-DD HH:mm:ss").startOf("day");t<=i;)f[t.clone().add(12,"hours").format("YYYYMMDD")]=!0,t=t.add(1,"day");b(n.IdCause+"");ht(moment(n.strFromTime,"YYYY-MM-DD HH:mm:ss").toDate());ct(moment(n.strToTime,"YYYY-MM-DD HH:mm:ss").toDate());w(moment(n.strHours,"HH:mm").toDate());at(new Date)}else r=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r)},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())},hi=function(){var i=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},r=function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDocumentUploaded"),"success",2e3)):VTPortalUtils.utils.processErrorMessage(n)},n;e==null&&(e=new WebServiceRobotics(r,i));n=st.getDocument();VTPortal.roApp.isModeApp()==!1?(n.append("idRelatedObject",t()),n.append("forecastType","request"),e.uploadDocumentDesktop(n)):(n.append("idRelatedObject",t()),e.uploadDocumentMobile(n,"request","",""))},ni=function(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)k(n.SelectFields),t()!=null&&t()>0?si(t()):(n.SelectFields.length>0&&b(n.SelectFields[0].FieldValue),at(new Date));else{var i=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,i)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},ti=ko.observable(VTPortal.bigUserInfo());e=null;var yi=function(n){var u,e;if(t()==null&&typeof p()[moment(n.value).format("YYYYMMDD")]!="undefined"){if(s()==0)for(i()==null&&r()==null?(i(moment(n.value)),r(moment(n.value))):moment(n.value).isSame(i())?i(r()):moment(n.value).isSame(r())?r(i()):moment(n.value)>i()?r(moment(n.value)):moment(n.value)<i()&&i(moment(n.value)),u=moment(it()),e=moment(rt());u<e;)u>=i()&&u<=r()?f[u.format("YYYYMMDD")]=!0:typeof f[u.format("YYYYMMDD")]!="undefined"&&(f[u.format("YYYYMMDD")]=!1),u=u.add(1,"day");else{if(u=null,e=null,i()!=null&&(u=i().clone()),r()!=null&&(e=r().clone()),u!=null)while(u<=e)f[u.format("YYYYMMDD")]=!1,u=u.add(1,"day");for(i(moment(n.value)),r(i().clone().add(s()-1,"day")),u=i().clone(),e=r().clone();u<=e;)f[u.format("YYYYMMDD")]=!0,u=u.add(1,"day")}$("#calendarSelectorContainer").dxCalendar("instance").repaint()}},pi=function(n){n.ID==2?setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},200):n.ID==3&&ei()};return{requestId:t,myApprovalsBlock:gt,viewShown:ci,title:i18nextko.t("roRequestType_PlannedCauses"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:i18nextko.t("roSelectAbsence"),lblInitialHour:i18nextko.t("roRequestInitialHourLbl"),lblEndHour:i18nextko.t("roRequestEndHourLbl"),lblSelectDaysInfo:i18nextko.t("roSelectDayInfo"),lblDuration:i18nextko.t("roRequestDurationLbl"),subscribeBlock:ti(),selectedTab:tt,scrollContent:{height:oi},tabPanelOptions:{dataSource:u,selectedIndex:tt,itemTemplate:"title",onSelectionChanged:function(n){pi(n.addedItems[0])}},lblDocument:i18nextko.t("roLblDocument"),popupDocumentsVisible:g,btnCancelUpload:{onClick:function(){g(!1)},text:i18nextko.t("roCancel")},btnDocuments:{onClick:function(){g(!0)},text:"",hint:i18nextko.i18n.t("roLblDocuments"),icon:"Images/Common/Document.png"},btnAcceptUpload:{onClick:function(){t()!=null&&t()>0?hi():(g(!1),dt(!0))},text:i18nextko.t("roSaveRequest")},popupVisible:pt,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),9,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:y},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),9,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:y},btnHistory:{onClick:function(){pt(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:yt},btnSave:{onClick:li,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:vt},btnDelete:{onClick:ai,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:c},calendarOptions:{width:"100%",useCellTemplate:!0,cellTemplate:vi,firstDayOfWeek:moment()._locale._week.dow,maxZoomLevel:"month",zoomLevel:"year",minZoomLevel:"year",onCellClick:yi,showTodayButton:!1,min:it,max:rt},remarks:{value:d,readOnly:h},beginHour:{type:"time",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:ht,readOnly:h,onValueChanged:ii,valueChangeEvent:"focusout"},endHour:{type:"time",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:ct,readOnly:h,onValueChanged:ii,valueChangeEvent:"focusout"},duration:{type:"time",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:w,readOnly:h,valueChangeEvent:"focusout"},cmbRequestValue1:{dataSource:k,displayExpr:"FieldName",valueExpr:"FieldValue",value:b,readOnly:h,onValueChanged:fi},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),noRankingDateSelected:l,hasRankingData:a,hasCoverageData:v,rankingDS:ut,listRanking:{dataSource:ut,scrollingEnabled:!1,collapsibleGroups:!1,itemTemplate:"RankingItem"},lblRankingHeader:i18nextko.t("roRankingTitle"),lblCoverageHeader:i18nextko.t("roCoverageTitle"),lblNoDataDescription:i18nextko.t("roNoRankingDescription"),lblMinimumCoverageRequiered:i18nextko.t("rolblMinimumCoverageRequiered"),txtMinimumCoverageRequiered:{value:bt,readOnly:!0},lblDiferentialCoverage:i18nextko.t("rolblDiferentialCoverage"),txtDifferentialCoverage:{value:kt,readOnly:!0},myDocumentsBlock:st,hasDocuments:ui,fileAdded:ri,documentAttached:dt}};VTPortal.plannedHoliday=function(n){function ii(){if(pt().viewShown(),VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Holidays)rt([]),ti("plannedholiday"),t()!=null&&t()>0&&(a(!0),VTPortalUtils.utils.markRequestAsRead(t())),VTPortal.roApp.impersonatedIDEmployee==-1?t()!=null&&k(!0):t()!=null&&d(!1),t()==null&&ht(!0),t()!=null&&ct(!0);else{var n=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roIncorrectApiVersion"),"error",0,n)}}function wt(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)w=n.Result,p()==1&&setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},100);else{var t=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}}).checkIsWorkingdayShift(n)}function st(n){new WebServiceRobotics(function(n){var i,t,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=f(),t=0;t<n.oCalendar.DayData.length;t++)i[moment.tz(n.oCalendar.DayData[t].PlanDate,VTPortal.roApp.serverTimeZone).add(12,"hours").format("YYYYMMDD")]=n.oCalendar.DayData[t];f(i);p()==1&&setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},100)}else f([]),r=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r);nt=!1},function(){nt=!1}).getAvailablePermitsCalendar(n,-1)}function ri(){e()=="S"?fi():ui()}function ui(){var r=moment(ut()).format("HH:mm"),f=moment(ft()).format("HH:mm"),e="1899-12-",c,l;e+=r>f?"31 ":"30 ";for(var s=moment("1899-12-30 "+r.format("HH:mm"),"YYYY-MM-DD HH:mm"),h=moment(e+f.format("HH:mm"),"YYYY-MM-DD HH:mm"),t="",n=moment().startOf("year").add(-1,"year"),a=moment().endOf("year").add(1,"year");n<a;)i[n.format("YYYYMMDD")],typeof i[n.format("YYYYMMDD")]!="undefined"&&i[n.format("YYYYMMDD")]==!0&&(t!=""&&(t+="/"),t+=n.format("YYYYMMDD")),n=n.add(1,"day");t==""?(p(1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roSelectDayInfo"),"info",2e3)):(c=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},l=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var i=function(){v.savePlannedHoliday(t,o(),s,h,u()==null?-1:u()/100,y(),!0)};VTPortalUtils.utils.processRequestErrorMessage(n,i,function(){})}},v=new WebServiceRobotics(l,c),v.savePlannedHoliday(t,o(),s,h,u()==null?-1:u()/100,y(),!1))}function fi(){for(var t="",n=moment().startOf("year").add(-1,"year"),e=moment().endOf("year").add(1,"year"),r,f;n<e;)i[n.format("YYYYMMDD")],typeof i[n.format("YYYYMMDD")]!="undefined"&&i[n.format("YYYYMMDD")]==!0&&(t!=""&&(t+="/"),t+=n.format("YYYYMMDD")),n=n.add(1,"day");r=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)};t==""?(p(1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roSelectDayInfo"),"info",2e3)):(f=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(13),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var i=function(){v.savePermissions(t,u()==null?-1:u(),y(),!0)};VTPortalUtils.utils.processRequestErrorMessage(n,i,function(){})}},v=new WebServiceRobotics(f,r),v.savePermissions(t,u()==null?-1:u(),y(),!1))}function ei(){t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}function oi(n){var u="",o="#dcdcdc",h="#dcdcdc",l=90,a=95,c=f()[moment(n.date).format("YYYYMMDD")],p=0,k=!1,v="";if(moment(n.date).format("YYYYMMDD")==moment().format("YYYYMMDD")&&(v="actualDate"),c!=null){if(c.MainShift!=null&&(p=c.MainShift.PlannedHours,k=e()=="C"?c.IsHoliday:c.IsHoliday||c.Alerts.OnHolidaysHours),o=VTPortalUtils.calendar.getCellColor(i,n.date,n.view),absenceStyle="width:100%;height:100%;color: "+h+";",absenceStyle+="background: "+h+";",absenceStyle+="background: -webkit-radial-gradient(circle closest-side, "+h+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -moz-radial-gradient(circle closest-side, "+h+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -ms-radial-gradient(circle closest-side, "+h+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -o-radial-gradient(circle closest-side, "+h+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: radial-gradient(circle closest-side at center, "+h+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background-repeat: no-repeat;",absenceStyle+="background-position: center center;display:table;",u="width:100%;height:100%;color: #000000;",u+="background: "+o+";",u+="background: -webkit-radial-gradient(circle closest-side, "+o+" "+l+"%,rgba(255,255,255,0) "+a+"%);",u+="background: -moz-radial-gradient(circle closest-side, "+o+" "+l+"%,rgba(255,255,255,0) "+a+"%);",u+="background: -ms-radial-gradient(circle closest-side, "+o+" "+l+"%,rgba(255,255,255,0) "+a+"%);",u+="background: -o-radial-gradient(circle closest-side, "+o+" "+l+"%,rgba(255,255,255,0) "+a+"%);",u+="background: radial-gradient(circle closest-side at center, "+o+" "+l+"%,rgba(255,255,255,0) "+a+"%);",u+="background-repeat: no-repeat;",u+="background-position: center center;display:table;",n.view=="month")return moment(n.date).isAfter(moment(s()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(b()))?moment(n.date).startOf("day")>=moment(s()).startOf("day")?(p>0&&w==!0||w==!1)&&k==!1||t()>0?"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+u+"'> <span class='"+v+"' style='display:table-cell;vertical-align:middle;font-weight:bold'>"+n.text+"<\/span><\/div><\/div><\/div><\/div>":"<div class='no-working-day'> <span class='"+v+"' >"+n.text+"<\/span><\/div>":"<span class='"+v+"' >"+n.text+"<\/span>":"";if(n.view=="year"){if(moment(n.date).isAfter(moment(s()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(b()))){for(var r=moment(n.date).startOf("month"),d=moment(n.date).endOf("month"),g=!1,y=0;r<d;){if(typeof f()[r.format("YYYYMMDD")]!="undefined"&&f()[r.format("YYYYMMDD")].MainShift!=null&&f()[r.format("YYYYMMDD")].MainShift.PlannedHours>0&&f()[r.format("YYYYMMDD")].IsHoliday==!1){g=!0;break}r=r.add(1,"day")}for(r=moment(n.date).startOf("month"),r<moment().startOf("day")&&(r=moment().startOf("day"));r<d;)i[r.format("YYYYMMDD")]==!0&&(y+=1),r=r.add(1,"day");return g||t()>0?y>0?"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+u+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+" ("+y+")<\/span><\/div><\/div><\/div><\/div>":"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+u+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+"<\/span><\/div><\/div><\/div><\/div>":"<span>"+n.text+"<\/span>"}return""}}else return moment(n.date).isAfter(moment(s()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(b()))?(nt||(nt=!0,st(n.date)),"<span class='"+v+"' >"+n.text+"<\/span>"):""}var t=ko.observable(null),y=ko.observable(""),ht=ko.observable(!1),k=ko.observable(!1),ct=ko.observable(!1),lt=ko.observable(!1),d=ko.observable(!1),o=ko.observable(!0),f=ko.observable({}),nt=!0,p=ko.observable(0),w=!1,e=ko.observable(""),s=ko.observable(moment().startOf("day").startOf("year").add(-1,"year").toDate()),b=ko.observable(moment().startOf("day").endOf("year").add(1,"year").toDate()),r=[{ID:1,cssClass:"dx-icon-configRequest"},{ID:2,cssClass:"dx-icon-selectDate"}],tt,v;$.grep(VTPortal.roApp.empPermissions().Requests,function(n){return n.RequestType==9&&n.Permission==!0&&typeof n.HasRankings!="undefined"&&n.HasRankings==!0}).length==1&&(tt=r.find(function(n){return n.ID=="3"}),tt==null&&r.push({ID:3,cssClass:"dx-icon-rankings",badge:""}));var i={},ut=ko.observable(moment().startOf("day").toDate()),ft=ko.observable(moment().endOf("day").toDate()),h=ko.observable(!0),c=ko.observable(!1),l=ko.observable(!1),it=ko.observable([]),at=ko.observable(0),vt=ko.observable(0),et=ko.observable(0),g=ko.observable(0),ot=ko.observable(0);typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));$.grep(VTPortal.roApp.empPermissions().Requests,function(n){return n.RequestType==6&&n.Permission==!0&&typeof n.HasRankings!="undefined"&&n.HasRankings==!0||n.RequestType==13&&n.Permission==!0&&typeof n.HasRankings!="undefined"&&n.HasRankings==!0}).length==1&&(tt=r.find(function(n){return n.ID=="3"}),tt==null&&r.push({ID:3,cssClass:"dx-icon-rankings",badge:""}));var bt=function(n){a()||(i={});var t=$.grep(rt(),function(t){return t.FieldValue==n.value});g(6);ot(parseInt(n.value,10));t.length>0&&(t[0].RelatedInfo=="S"?(g(6),wt(parseInt(n.value,10)),o(!0)):(g(13),w=!0),e(t[0].RelatedInfo))},kt=function(){var n=r.find(function(n){return n.ID==3}),f,e;if(n==null&&(n={ID:3,cssClass:"dx-icon-rankings",badge:""}),et()==0||et()==1)if(VTPortalUtils.utils.checkIfRequestHasRanquings(g(),ot())){var o=null,s=function(){h(!0);c(!1);l(!1);VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorRequestingRankings"),"error",0)},a=function(t){if(t.Status==window.VTPortalUtils.constants.OK.value){if(setTimeout(function(){$("#configRequestTab").dxTabs("instance").repaint()},150),t.Rankings!=null){for(var i=0;i<t.Rankings.RequestEmployeeRankingPositions.length;i++)t.Rankings.RequestEmployeeRankingPositions[i].cssClass=t.Rankings.RequestEmployeeRankingPositions[i].IDEmployee==VTPortal.roApp.employeeId?"rankingMyPosition":"listMenuItemPosition";it(t.Rankings.RequestEmployeeRankingPositions)}else it([]);n.badge=t.RankingEnabled?t.ActualPosition:"";t.CoverageEnabled&&(at(t.Coverages.MinCoverage),vt(t.Coverages.DifferentialQuantity),n.badge=n.badge+"/"+t.Coverages.DifferentialQuantity);r=r.remove(function(n){return n.ID==3});r.push(n);h(!1);c(t.RankingEnabled);l(t.CoverageEnabled)}else h(!0),c(!1),l(!1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorRequestingRankings"),"error",0)};o==null&&(o=new WebServiceRobotics(a,s));for(var u="",t=moment().startOf("year"),v=moment().endOf("year").add(1,"year");t<v;)i[t.format("YYYYMMDD")],typeof i[t.format("YYYYMMDD")]!="undefined"&&i[t.format("YYYYMMDD")]==!0&&(u!=""&&(u+="/"),u+=t.format("YYYYMMDD")),t=t.add(1,"day");f=u.split("/");e=null;f.length>0&&f[0]!=""&&(e=moment(f[0],"YYYYMMDD"));e!=null?o.getRankingForDay(e,g(),ot()):(h(!0),c(!1),l(!1))}else n.badge="",r=r.remove(function(n){return n.ID==3}),r.push(n),h(!0),c(!1),l(!1),setTimeout(function(){$("#configRequestTab").dxTabs("instance").repaint()},150);else n.badge="",r=r.remove(function(n){return n.ID==3}),r.push(n),h(!0),c(!1),l(!1),setTimeout(function(){$("#configRequestTab").dxTabs("instance").repaint()},150)},a=ko.observable(!1),dt=ko.computed(function(){return e()=="C"}),u=ko.observable(null),rt=ko.observable([]),yt=VTPortal.approvalHistory(),gt=ko.computed(function(){return"76%"}),ni=function(){new WebServiceRobotics(function(n){var t,r,f,h;if(n.Status==window.VTPortalUtils.constants.OK.value){if(y(n.Comments),et(n.ReqStatus),n.ReqStatus==0?k(!0):k(!1),d(!1),VTPortal.roApp.impersonatedIDEmployee!=-1&&(n.ReqStatus==0||n.ReqStatus==1)&&(d(!0),k(!1)),yt.refreshApprovals(n.RequestsHistoryEntries),moment(n.strDate1,"YYYY-MM-DD HH:mm:ss")<moment(s())&&s(moment(n.strDate1,"YYYY-MM-DD HH:mm:ss").startOf("month").toDate()),moment(n.strDate2,"YYYY-MM-DD HH:mm:ss")>moment(b())&&b(moment(n.strDate2,"YYYY-MM-DD HH:mm:ss").endOf("year")),n.RequestDays!=null&&n.RequestDays.length>0)for(t=0;t<n.RequestDays.length;t++)o(n.RequestDays[t].AllDay),i[moment.tz(n.RequestDays[t].RequestDate,VTPortal.roApp.serverTimeZone).add(12,"hours").format("YYYYMMDD")]=!0,ut(moment.tz(n.RequestDays[t].FromTime,VTPortal.roApp.serverTimeZone).toDate()),ft(moment.tz(n.RequestDays[t].ToTime,VTPortal.roApp.serverTimeZone).toDate());else for(o(!0),r=moment(n.strDate1,"YYYY-MM-DD HH:mm:ss").startOf("day"),f=moment(n.strDate2,"YYYY-MM-DD HH:mm:ss").startOf("day");r<=f;)i[r.clone().add(12,"hours").format("YYYYMMDD")]=!0,r=r.add(1,"day");n.RequestType==6?(e("S"),u(n.IdShift+"")):n.RequestType==13&&(e("C"),u(n.IdCause+""));st(new Date)}else h=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,h)},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())},ti=function(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)n.SelectFields.forEach(function(n){n.RelatedInfo=="C"&&(n.FieldValue=n.FieldValue*100)}),rt(n.SelectFields),t()!=null&&t()>0?ni(t()):n.SelectFields.length>0&&(u(n.SelectFields[0].FieldValue),e(n.SelectFields[0].RelatedInfo),n.SelectFields[0].RelatedInfo=="S"&&wt(n.SelectFields[0].FieldValue),st(new Date));else{var i=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,i)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},pt=ko.observable(VTPortal.bigUserInfo());v=null;var si=function(n){var c,u;if(t()==null&&typeof f()[moment(n.value).format("YYYYMMDD")]!="undefined"&&(c=!1,u=f()[moment(n.value).format("YYYYMMDD")],c=e()=="C"?u.IsHoliday:u.IsHoliday||u.Alerts.OnHolidaysHours,(u.MainShift!=null&&u.MainShift.PlannedHours>0>0&&w==!0||w==!1)&&c==!1))if(typeof i[moment(n.value).format("YYYYMMDD")]!="undefined"&&i[moment(n.value).format("YYYYMMDD")]==!0)i[moment(n.value).format("YYYYMMDD")]=!1,$("#"+moment(n.value).format("YYYYMMDD")).css("background","transparent");else{i[moment(n.value).format("YYYYMMDD")]=!0;var o="#ff5c35",s=90,h=95,r="width:100%;height:100%;color: #000000;";r+="background: "+o+";";r+="background: -webkit-radial-gradient(circle closest-side, "+o+" "+s+"%,rgba(255,255,255,0) "+h+"%);";r+="background: -moz-radial-gradient(circle closest-side, "+o+" "+s+"%,rgba(255,255,255,0) "+h+"%);";r+="background: -ms-radial-gradient(circle closest-side, "+o+" "+s+"%,rgba(255,255,255,0) "+h+"%);";r+="background: -o-radial-gradient(circle closest-side, "+o+" "+s+"%,rgba(255,255,255,0) "+h+"%);";r+="background: radial-gradient(circle closest-side at center, "+o+" "+s+"%,rgba(255,255,255,0) "+h+"%);";r+="background-repeat: no-repeat;";r+="background-position: center center;display:table;";$("#"+moment(n.value).format("YYYYMMDD")).attr("style",r)}},hi=function(n){n.ID==2?setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},200):n.ID==3&&kt()};return{requestId:t,myApprovalsBlock:yt,viewShown:ii,title:i18nextko.t("roRequestType_PlannedHoliday"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:i18nextko.t("roSelectPlannedHoliday"),lblInitialHour:i18nextko.t("roRequestInitialHourLbl"),lblEndHour:i18nextko.t("roRequestEndHourLbl"),lblAllDay:i18nextko.t("roRequestAllDayLbl"),lblSelectDaysInfo:i18nextko.t("roSelectDayInfo"),subscribeBlock:pt(),selectedTab:p,scrollContent:{height:gt},tabPanelOptions:{dataSource:r,selectedIndex:p,itemTemplate:"title",onSelectionChanged:function(n){hi(n.addedItems[0])}},popupVisible:lt,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),13,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:d},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),13,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:d},btnHistory:{onClick:function(){lt(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:ct},btnSave:{onClick:ri,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:ht},btnDelete:{onClick:ei,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:k},calendarOptions:{width:"100%",height:450,useCellTemplate:!0,cellTemplate:oi,firstDayOfWeek:moment()._locale._week.dow,maxZoomLevel:"month",zoomLevel:"year",minZoomLevel:"year",onCellClick:si,showTodayButton:!1,min:s,max:b},remarks:{value:y,readOnly:a},ckAllDay:{text:i18nextko.t("roRequestAllDayLbl"),value:o,readOnly:a,visible:dt},beginHour:{type:"time",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:ut,readOnly:a,valueChangeEvent:"focusout"},endHour:{type:"time",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:ft,readOnly:a,valueChangeEvent:"focusout"},cmbRequestValue1:{dataSource:rt,displayExpr:"FieldName",valueExpr:"FieldValue",value:u,readOnly:a,onValueChanged:bt},allDayPermit:o,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),noRankingDateSelected:h,hasRankingData:c,hasCoverageData:l,rankingDS:it,listRanking:{dataSource:it,scrollingEnabled:!1,collapsibleGroups:!1,itemTemplate:"RankingItem"},lblRankingHeader:i18nextko.t("roRankingTitle"),lblCoverageHeader:i18nextko.t("roCoverageTitle"),lblNoDataDescription:i18nextko.t("roNoRankingDescription"),lblMinimumCoverageRequiered:i18nextko.t("rolblMinimumCoverageRequiered"),txtMinimumCoverageRequiered:{value:at,readOnly:!0},lblDiferentialCoverage:i18nextko.t("rolblDiferentialCoverage"),txtDifferentialCoverage:{value:vt,readOnly:!0}}};VTPortal.plannedOvertime=function(n){function bt(){st().viewShown();tt([]);pt("plannedovertime");t()!=null&&t()>0&&(o(!0),VTPortalUtils.utils.markRequestAsRead(t()));VTPortal.roApp.impersonatedIDEmployee==-1?t()!=null&&h(!0):t()!=null&&c(!1);t()==null&&rt(!0);t()!=null&&ut(!0)}function it(n){new WebServiceRobotics(function(n){var i,t,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=l(),t=0;t<n.oCalendar.DayData.length;t++)i[moment.tz(n.oCalendar.DayData[t].PlanDate,VTPortal.roApp.serverTimeZone).add(12,"hours").format("YYYYMMDD")]=n.oCalendar.DayData[t];l(i);p()==1&&setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},100)}else l([]),r=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r);y=!1},function(){y=!1}).getAvailablePermitsCalendar(n,-1)}function kt(){if(i()==null||r==null)p(1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roSelectDayInfo"),"info",2e3);else{var n=moment(k()).format("HH:mm"),t=moment(d()).format("HH:mm"),u=nt.getDocument(),e="1899-12-";e+=n>t?"31 ":"30 ";var o=moment("1899-12-30 "+n.format("HH:mm"),"YYYY-MM-DD HH:mm"),h=moment(e+t.format("HH:mm"),"YYYY-MM-DD HH:mm"),c=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},l=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(14),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var t=function(){f.saveOvertime(i()==null?VTPortalUtils.nullDate:i(),r()==null?VTPortalUtils.nullDate:r(),o,h,ct(),s()!=null?s():"-1",a(),!0,u)};VTPortalUtils.utils.processRequestErrorMessage(n,t,function(){})}};f==null&&(f=new WebServiceRobotics(l,c));f.saveOvertime(i()==null?VTPortalUtils.nullDate:i(),r()==null?VTPortalUtils.nullDate:r(),o,h,ct(),s()!=null?s():"-1",a(),!1,u)}}function dt(){typeof e()!="undefined"&&e()!=null&&e()>0?VTPortalUtils.utils.deleteProgrammedAbsence(e(),"overtime"):t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}function ct(){var n=moment(k()),t=moment(d()),i="1970-01-",r,u;return i+=n.isAfter(t)?"31":"30",r=moment("1970-01-30 "+n.format("HH:mm")+":00","YYYY-MM-DD HH:mm:ss"),u=moment(i+" "+t.format("HH:mm")+":00","YYYY-MM-DD HH:mm:ss"),moment(u.diff(r)).utc().format("HH:mm")}function gt(n){var t="",i="#dcdcdc",r="#dcdcdc",f=90,e=95,o=l()[moment(n.date).format("YYYYMMDD")],a=0,v=!1,h="";if(moment(n.date).format("YYYYMMDD")==moment().format("YYYYMMDD")&&(h="actualDate"),o!=null){if(o.MainShift!=null&&(a=o.MainShift.PlannedHours,v=o.IsHoliday),i=VTPortalUtils.calendar.getCellColor(u,n.date,n.view),absenceStyle="width:100%;height:100%;color: "+r+";",absenceStyle+="background: "+r+";",absenceStyle+="background: -webkit-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -moz-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -ms-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: -o-radial-gradient(circle closest-side, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background: radial-gradient(circle closest-side at center, "+r+" 90%,rgba(255,255,255,0) 95%);",absenceStyle+="background-repeat: no-repeat;",absenceStyle+="background-position: center center;display:table;",t="width:100%;height:100%;color: #000000;",t+="background: "+i+";",t+="background: -webkit-radial-gradient(circle closest-side, "+i+" "+f+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -moz-radial-gradient(circle closest-side, "+i+" "+f+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -ms-radial-gradient(circle closest-side, "+i+" "+f+"%,rgba(255,255,255,0) "+e+"%);",t+="background: -o-radial-gradient(circle closest-side, "+i+" "+f+"%,rgba(255,255,255,0) "+e+"%);",t+="background: radial-gradient(circle closest-side at center, "+i+" "+f+"%,rgba(255,255,255,0) "+e+"%);",t+="background-repeat: no-repeat;",t+="background-position: center center;display:table;",n.view=="month")return"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span class='"+h+"' style='display:table-cell;vertical-align:middle;font-weight:bold'>"+n.text+"<\/span><\/div><\/div><\/div><\/div>";if(n.view=="year"){if(moment(n.date).isAfter(moment(w()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(b()))){for(var s=moment(n.date).startOf("month"),p=moment(n.date).endOf("month"),c=0;s<p;)u[s.format("YYYYMMDD")]==!0&&(c+=1),s=s.add(1,"day");return c>0?"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+" ("+c+")<\/span><\/div><\/div><\/div><\/div>":"<div style='width:100%;height:100%'><div class='innerCalCellTemplate' style='"+absenceStyle+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(n.date).format("YYYYMMDD")+"' style='"+t+"'> <span style='display:table-cell;vertical-align:middle'>"+n.text.capitalize(!0,!0)+"<\/span><\/div><\/div><\/div><\/div>"}return""}}else return moment(n.date).isAfter(moment(w()).startOf("month").add(-1,"day"))&&moment(n.date).isBefore(moment(b()))?(y||(y=!0,it(n.date)),"<span class='"+h+"' >"+n.text+"<\/span>"):""}var t=ko.observable(null),e=ko.observable(null),a=ko.observable(""),rt=ko.observable(!1),h=ko.observable(!1),ut=ko.observable(!1),ft=ko.observable(!1),v=ko.observable(!1),c=ko.observable(!1),l=ko.observable({}),y=!0,p=ko.observable(0),w=ko.observable(moment().startOf("day").startOf("year").add(-1,"year").toDate()),b=ko.observable(moment().startOf("day").endOf("year").add(1,"year").toDate()),u={},k=ko.observable(moment().startOf("day").toDate()),d=ko.observable(moment().endOf("day").toDate()),i=ko.observable(null),r=ko.observable(null),ii=ko.observable(i18nextko.i18n.t("roFindFile")),lt=ko.observable(i18nextko.i18n.t("roFileAdded")),et=ko.observable(!1),g=ko.observable([]),nt=new VTPortal.documentInput,at=ko.computed(function(){return g().length>0}),f,ht;typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));typeof n.param!="undefined"&&parseInt(n.param,10)!=-1&&(i(moment(n.param,"YYYY-MM-DD")),r(moment(n.param,"YYYY-MM-DD")),u[moment(n.param,"YYYY-MM-DD").format("YYYYMMDD")]=!0);var o=ko.observable(!1),s=ko.observable(null),tt=ko.observable([]),ot=VTPortal.approvalHistory(),vt=ko.computed(function(){return"76%"}),yt=function(){new WebServiceRobotics(function(n){var t,i,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(e(n.AbsenceId),a(n.Comments),n.ReqStatus==0?h(!0):h(!1),typeof e()!="undefined"&&e()!=null&&e()>0&&h(!0),c(!1),VTPortal.roApp.impersonatedIDEmployee!=-1&&(n.ReqStatus==0||n.ReqStatus==1)&&(c(!0),h(!1)),ot.refreshApprovals(n.RequestsHistoryEntries),t=moment(n.strDate1,"YYYY-MM-DD HH:mm:ss").startOf("day"),i=moment(n.strDate2,"YYYY-MM-DD HH:mm:ss").startOf("day");t<=i;)u[t.clone().add(12,"hours").format("YYYYMMDD")]=!0,t=t.add(1,"day");s(n.IdCause+"");k(moment(n.strFromTime,"YYYY-MM-DD HH:mm:ss").toDate());d(moment(n.strToTime,"YYYY-MM-DD HH:mm:ss").toDate());it(new Date)}else r=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r)},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())},pt=function(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)tt(n.SelectFields),t()!=null&&t()>0?yt(t()):(n.SelectFields.length>0&&s(n.SelectFields[0].FieldValue),it(new Date));else{var i=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,i)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},st=ko.observable(VTPortal.bigUserInfo()),wt=function(n){if(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.PortalNext)g([]),new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)g(n.SelectFields),nt.initializeData(n.SelectFields,!1,-1),i(null),r(null),o()||(u={});else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingCauseInfo"),"error",0,n)}).getRequieredCauseDocuments(parseInt(n.value,10));else{g([]);var t=tt().find(function(t){return parseInt(t.FieldValue,10)==parseInt(n.value,10)});t!=null?parseInt(t.RelatedInfo,10)>0?calendarSelectMode(parseInt(t.RelatedInfo,10)):calendarSelectMode(0):calendarSelectMode(0);i(null);r(null);o()||(u={})}};f=null;ht=function(){var i=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},r=function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDocumentUploaded"),"success",2e3)):VTPortalUtils.utils.processErrorMessage(n)},n;f==null&&(f=new WebServiceRobotics(r,i));n=nt.getDocument();VTPortal.roApp.isModeApp()==!1?(n.append("idRelatedObject",t()),n.append("forecastType","request"),f.uploadDocumentDesktop(n)):(n.append("idRelatedObject",t()),f.uploadDocumentMobile(n,"request","",""))};var ni=function(n){if(t()==null&&typeof l()[moment(n.value).format("YYYYMMDD")]!="undefined"){i()==null&&r()==null?(i(moment(n.value)),r(moment(n.value))):moment(n.value).isSame(i())?i(r()):moment(n.value).isSame(r())?r(i()):moment(n.value)>i()?r(moment(n.value)):moment(n.value)<i()&&i(moment(n.value));for(var f=moment(w()),e=moment(b());f<e;)f>=i()&&f<=r()?u[f.format("YYYYMMDD")]=!0:typeof u[f.format("YYYYMMDD")]!="undefined"&&(u[f.format("YYYYMMDD")]=!1),f=f.add(1,"day");$("#calendarSelectorContainer").dxCalendar("instance").repaint()}},ti=function(n){n.ID==2&&setTimeout(function(){$("#calendarSelectorContainer").dxCalendar("instance").repaint()},200)};return{requestId:t,myApprovalsBlock:ot,myDocumentsBlock:nt,viewShown:bt,title:i18nextko.t("roRequestType_PlannedOvertime"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:i18nextko.t("roSelectOvertime"),lblInitialHour:i18nextko.t("roRequestInitialHourLbl"),lblEndHour:i18nextko.t("roRequestEndHourLbl"),lblSelectDaysInfo:i18nextko.t("roSelectDayInfo"),subscribeBlock:st(),selectedTab:p,scrollContent:{height:vt},tabPanelOptions:{dataSource:[{ID:1,cssClass:"dx-icon-configRequest"},{ID:2,cssClass:"dx-icon-selectDate"}],selectedIndex:p,itemTemplate:"title",onSelectionChanged:function(n){ti(n.addedItems[0])}},popupVisible:ft,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),14,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:c},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),14,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:c},btnCancelUpload:{onClick:function(){v(!1)},text:i18nextko.t("roCancel")},btnAcceptUpload:{onClick:function(){t()!=null&&t()>0?ht():(et(!0),v(!1))},text:i18nextko.t("roSaveRequest")},btnHistory:{onClick:function(){ft(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:ut},btnSave:{onClick:kt,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:rt},btnDocuments:{onClick:function(){v(!0)},text:"",hint:i18nextko.i18n.t("roLblDocuments"),icon:"Images/Common/Document.png"},btnDelete:{onClick:dt,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:h},popupDocumentsVisible:v,fileAdded:lt,documentAttached:et,calendarOptions:{width:"100%",height:450,useCellTemplate:!0,cellTemplate:gt,firstDayOfWeek:moment()._locale._week.dow,maxZoomLevel:"month",zoomLevel:"year",minZoomLevel:"year",onCellClick:ni,showTodayButton:!1,min:w,max:b},remarks:{value:a,readOnly:o},beginHour:{type:"time",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:k,readOnly:o,valueChangeEvent:"focusout"},endHour:{type:"time",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:d,readOnly:o,valueChangeEvent:"focusout"},hasDocuments:at,cmbRequestValue1:{dataSource:tt,displayExpr:"FieldName",valueExpr:"FieldValue",value:s,readOnly:o,onValueChanged:wt},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.requestsList=function(n){function u(){var f,e,t,u;for(i().viewShown(),f=VTPortal.roApp.empPermissions().Requests,e=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],typeof n.id!="undefined"&&(e=n.id.split(",").map(Number)),t=[],u=0;u<f.length;u++)if(f[u].Permission&&e.includes(f[u].RequestType))switch(f[u].RequestType){case 1:t.push({ID:1,Name:i18nextko.i18n.t("roRequestType_UserFieldsChange"),cssClass:"dx-icon-userFieldChange",hasAction:!0});break;case 2:$.grep(t,function(n){return n.ID==2}).length==0&&t.push({ID:2,Name:i18nextko.i18n.t("roRequestType_ForbiddenPunch"),cssClass:"dx-icon-forbiddenPunch",hasAction:!0});break;case 4:t.push({ID:4,Name:i18nextko.i18n.t("roRequestType_ExternalWorkResumePart"),cssClass:"dx-icon-externalWorkResume",hasAction:!0});break;case 5:t.push({ID:5,Name:i18nextko.i18n.t("roRequestType_ChangeShift"),cssClass:"dx-icon-changeShift",hasAction:!0});break;case 6:$.grep(t,function(n){return n.ID==13}).length==0&&t.push({ID:13,Name:i18nextko.i18n.t("roRequestType_PlannedHoliday"),cssClass:"dx-icon-plannedHoliday",hasAction:!0});break;case 7:t.push({ID:7,Name:i18nextko.i18n.t("roRequestType_PlannedAbsences"),cssClass:"dx-icon-plannedAbsences",hasAction:!0});break;case 8:t.push({ID:8,Name:i18nextko.i18n.t("roRequestType_ShiftExchange"),cssClass:"dx-icon-shiftExchange",hasAction:!0});break;case 9:t.push({ID:9,Name:i18nextko.i18n.t("roRequestType_PlannedCauses"),cssClass:"dx-icon-plannedCauses",hasAction:!0});break;case 10:$.grep(t,function(n){return n.ID==2}).length==0&&t.push({ID:2,Name:i18nextko.i18n.t("roRequestType_ForbiddenPunch"),cssClass:"dx-icon-forbiddenPunch",hasAction:!0});break;case 11:t.push({ID:11,Name:i18nextko.i18n.t("roRequestType_CancelHolidays"),cssClass:"dx-icon-holidaysCancel",hasAction:!0});break;case 12:$.grep(t,function(n){return n.ID==2}).length==0&&t.push({ID:2,Name:i18nextko.i18n.t("roRequestType_ForbiddenPunch"),cssClass:"dx-icon-forbiddenPunch",hasAction:!0});break;case 13:$.grep(t,function(n){return n.ID==13}).length==0&&t.push({ID:13,Name:i18nextko.i18n.t("roRequestType_PlannedHoliday"),cssClass:"dx-icon-plannedHoliday",hasAction:!0});break;case 14:t.push({ID:14,Name:i18nextko.i18n.t("roRequestType_PlannedOvertime"),cssClass:"dx-icon-plannedOvertime",hasAction:!0});break;case 15:t.push({ID:15,Name:i18nextko.i18n.t("roRequestType_ExternalWorkWeekResume"),cssClass:"dx-icon-externalWorkWeekResume",hasAction:!0})}t=t.sortBy(function(n){return n.Name});r(t)}var r=ko.observable([]),t=null,i;return typeof n.param!="undefined"&&n.param!="null"&&(t=moment(n.param)),i=ko.observable(VTPortal.bigUserInfo()),{viewShown:u,title:i18nextko.t("roSelectRequestType"),subscribeBlock:i(),listOptions:{dataSource:r,height:"76%",itemTemplate:"RequestTypeItem",onItemClick:function(n){if(n.itemData.hasAction)switch(n.itemData.ID){case 1:VTPortal.app.navigate("userFields/-1",{target:"current"});break;case 2:VTPortal.app.navigate("forgottenPunch/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"});break;case 4:VTPortal.app.navigate("externalWork/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):"")),{target:"current"};break;case 5:VTPortal.app.navigate("changeShift/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"});break;case 6:VTPortal.app.navigate("plannedHoliday/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"});break;case 7:VTPortal.app.navigate("plannedAbsence/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"});break;case 8:VTPortal.app.navigate("shiftExchange/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"});break;case 9:VTPortal.app.navigate("plannedCause/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"});break;case 10:VTPortal.app.navigate("forgottenPunch/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"});break;case 11:VTPortal.app.navigate("cancelHolidays/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"});break;case 12:VTPortal.app.navigate("forgottenPunch/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"});break;case 13:VTPortal.app.navigate("plannedHoliday/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"});break;case 14:VTPortal.app.navigate("plannedOvertime/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"});break;case 15:VTPortal.app.navigate("externalWorkWeekResume/-1"+(t!=null?"/ "+t.format("YYYY-MM-DD"):""),{target:"current"})}}}}};VTPortal.shiftExchange=function(n){function dt(){ht().viewShown();a([]);c(null);v([]);f(null);t()!=null&&t()>0?(et("shifts.fullList"),h(!0)):moment(i()).isSame(moment(e()))&&st(i());VTPortal.roApp.impersonatedIDEmployee==-1&&t()!=null&&l(!0);t()==null&&g(!0);t()!=null&&nt(!0)}function gt(){var e=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},s=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(8),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var t=function(){var n=r()==!1?"":o()==null?VTPortalUtils.nullDate:moment(o()).format("YYYY-MM-DD HH:mm");p.saveShiftExchange(i()==null?VTPortalUtils.nullDate:i(),n,f(),c(),u().MainShift.ID,w(),!0)};VTPortalUtils.utils.processRequestErrorMessage(n,t,function(){})}},n,t;p==null&&(p=new WebServiceRobotics(s,e));n=v().find(function(n){return n.FieldValue==f()});n!=null&&n.RelatedInfo==""?!r()||r()&&o()!=null?(t=r()==!1?"":o()==null?VTPortalUtils.nullDate:moment(o()).format("YYYY-MM-DD HH:mm"),p.saveShiftExchange(i()==null?VTPortalUtils.nullDate:i(),t,f(),c(),u().MainShift.ID,w(),!1)):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roCompensateDateNeeded"),"error",0):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNotAvailableEmployeeSelected"),"error",0)}function ni(){t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}var t=ko.observable(null),w=ko.observable(""),g=ko.observable(!1),l=ko.observable(!1),nt=ko.observable(!1),tt=ko.observable(!1),s=ko.observable(!1),b=ko.observable(null),h=ko.observable(!1),u=ko.observable(null),k=ko.observable(""),i=ko.observable(moment().startOf("day").toDate()),e=ko.observable(moment().startOf("day").toDate()),p,d,ct;typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));typeof n.param!="undefined"&&parseInt(n.param,10)!=-1&&(i(moment(n.param,"YYYY-MM-DD").toDate()),e(moment(n.param,"YYYY-MM-DD").toDate()));var it=ko.observable(moment("01/01/"+moment(i()).year(),"DD/MM/YYYY")),rt=ko.observable(moment("31/12/"+moment(i()).year(),"DD/MM/YYYY")),c=ko.observable(null),f=ko.observable(null),a=ko.observable([]),v=ko.observable([]),r=ko.observable(!1),ut=ko.observable(0),o=ko.observable(null),y=ko.observable(!0),ft=VTPortal.approvalHistory(),lt=ko.computed(function(){return t()!=null&&t()>0?k():u()!=null?u().MainShift.Name:""}),at=function(n){t()!=null&&t()>0||y()!=!1||new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)n.Days>0?(ut(n.Days),r(!0)):(ut(0),r(!1));else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getDaysToCompensate(i(),e(),n.value)},vt=function(n){var s,h,f;t()!=null&&t()>0||(s=n.value,parseInt(s,10)>0&&ot(i(),e(),u().MainShift.ID,s),h=a().find(function(t){return parseInt(t.FieldValue,10)==parseInt(n.value,10)}),h!=null?(f=parseFloat(h.RelatedInfo),f==-1?r(!1):f>0&&u().MainShift.PlannedHours==0||f==0&&u().MainShift.PlannedHours>0?r(!0):r(!1)):r(!1),r()&&o(null))},yt=ko.computed(function(){return"76%"}),pt=function(){new WebServiceRobotics(function(n){var u,e;n.Status==window.VTPortalUtils.constants.OK.value?(b(n.ReqStatus),VTPortal.roApp.impersonatedIDEmployee==-1&&VTPortal.roApp.employeeId==n.IdEmployee&&VTPortalUtils.utils.markRequestAsRead(t()),w(n.Comments),n.ReqStatus==0||n.ReqStatus==1?l(!0):l(!1),s(!1),VTPortal.roApp.impersonatedIDEmployee==n.IdEmployee&&n.ReqStatus==1||VTPortal.roApp.impersonatedIDEmployee==n.IdEmployeeExchange&&n.ReqStatus==0?(s(!0),l(!1)):(VTPortal.roApp.employeeId!=n.IdEmployee&&(n.ReqStatus==0&&s(!0),l(!1)),VTPortal.roApp.db.settings.supervisorPortalEnabled==!0&&VTPortal.roApp.employeeId!=n.IdEmployeeExchange&&(n.ReqStatus==0?s(!1):s(!0))),ft.refreshApprovals(n.RequestsHistoryEntries),i(moment(n.strDate1,"YYYY-MM-DD HH:mm:ss").startOf("day").toDate()),n.strDate2!=""&&(o(moment(n.strDate2,"YYYY-MM-DD HH:mm:ss").startOf("day").toDate()),r(!0)),VTPortal.roApp.employeeId==n.IdEmployee?(f(""+n.IdEmployeeExchange),c(""+n.IdShift),u=a().find(function(t){return parseInt(t.FieldValue,10)==parseInt(n.Field4,10)}),k(u.FieldName)):(f(""+n.IdEmployee),c(""+parseInt(n.Field4,10)),u=a().find(function(t){return parseInt(t.FieldValue,10)==parseInt(n.IdShift,10)}),k(u.FieldName),d(i18nextko.i18n.t("roEmployeeSource")))):(e=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,e))},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())},et=function(n){new WebServiceRobotics(function(n){var r,f;n.Status==window.VTPortalUtils.constants.OK.value?(r=Object.clone(n.SelectFields,!0),r=r.add({FieldName:"---",FieldValue:-1,RelatedInfo:-1},0),a(r),t()!=null&&t()>0?wt("employees.fullList"):r.length>0&&(c(r[0].FieldValue),y()&&r[0].FieldValue>0&&ot(i(),e(),u().MainShift.ID,n.SelectFields[0].FieldValue))):(f=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,f))},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},wt=function(n){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)v(n.SelectFields),t()!=null&&t()>0&&pt(t());else{var i=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,i)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},ot=function(n,i,r,u){new WebServiceRobotics(function(n){var i,r;n.Status==window.VTPortalUtils.constants.OK.value?(i=n.SelectFields.clone(),v(i),t()!=null&&t()>0||i.length>0&&f()==null&&f(i[0].FieldValue)):(r=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r))},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getAvailableEmployeesForDate(n,i,r,u)},st=function(n){var t=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)n.DayInfo.DayData[0].MainShift!=null?n.DayInfo.DayData[0].Locked==!1?n.DayInfo.DayData[0].EmployeeStatusOnDay!=1?(u(n.DayInfo.DayData[0]),et("shifts.exchangeshifts")):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorNoContract"),"error",0,t):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLockedDay"),"error",0,t):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorNoDailySchedule"),"error",0,t);else{var t=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}};new WebServiceRobotics(function(n){t(n)}).getEmployeeDayInfo(n)},bt=function(){t()!=null&&t()>0||(it(moment("01/01/"+moment(i()).year(),"DD/MM/YYYY")),rt(moment("31/12/"+moment(i()).year(),"DD/MM/YYYY")),e(i()),st(i()))},kt=function(){t()!=null&&t()>0||(moment(i()).isSame(moment(e()))?y(!0):y(!1))},ht=ko.observable(VTPortal.bigUserInfo());return p=null,d=ko.observable(i18nextko.i18n.t("roEmployeesAvailable")),ct={requestId:t,myApprovalsBlock:ft,viewShown:dt,title:i18nextko.t("roRequestType_ShiftExchange"),lblInitialDate:i18nextko.t("roRequestExchangeDate"),lblEndDate:i18nextko.t("roRequestEndDateLbl"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:i18nextko.t("roChangeShiftTo"),lblRequestValue2:d,lblInitialShift:i18nextko.t("roInitialShift"),subscribeBlock:ht(),scrollContent:{height:yt},popupVisible:tt,btnApprove:{onClick:function(){b()==1?VTPortalUtils.utils.approveRefuseRequest(t(),8,!0):VTPortalUtils.utils.approveRefuseRequestByEmp(t(),8,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:s},btnRefuse:{onClick:function(){b()==1?VTPortalUtils.utils.approveRefuseRequest(t(),8,!1):VTPortalUtils.utils.approveRefuseRequestByEmp(t(),8,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:s},btnHistory:{onClick:function(){tt(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:nt},btnSave:{onClick:gt,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:g},btnDelete:{onClick:ni,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:l},beginDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:i,readOnly:h,valueChangeEvent:"focusout",onValueChanged:bt},endDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:e,readOnly:h,valueChangeEvent:"focusout",onValueChanged:kt},remarks:{value:w,readOnly:h},cmbRequestValue1:{dataSource:a,displayExpr:"FieldName",valueExpr:"FieldValue",value:c,readOnly:h,onValueChanged:vt},cmbRequestValue2:{dataSource:v,displayExpr:"FieldName",valueExpr:"FieldValue",value:f,readOnly:h,fieldTemplate:function(n,t){var i="";n!=null?(i=$("<div class='custom-item'><div style='margin-top:5px;' class='"+(n.RelatedInfo==""?"availableEmployee":"notAvailableEmployee")+"' /><div class='employee-name "+(n.RelatedInfo==""?"":"notAvailableDesc")+"'><\/div><\/div>"),i.find(".employee-name").dxTextBox({value:n.FieldName,readOnly:!0})):(i=$("<div class='custom-item'><div style='margin-top:5px;' class='emptyEmployee' /><div class='employee-name'><\/div><\/div>"),i.find(".employee-name").dxTextBox({value:i18nextko.i18n.t("roNoAvailableEmp"),readOnly:!0}));t.append(i)},itemTemplate:function(n){return"<div class='custom-item'><div class='"+(n.RelatedInfo==""?"":"notAvailableDesc")+"'>"+n.FieldName+" "+(n.RelatedInfo==""?"":" ("+i18nextko.i18n.t("roNoAvailable")+")")+"<\/div><\/div>"},onValueChanged:at},txtInitialShift:{value:lt,readOnly:!0},needToCompensate:r,needShift:y,lblCompensateDate:i18nextko.t("roCompensateWithDay"),compensateDate:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:o,readOnly:h,max:rt,min:it,valueChangeEvent:"focusout"},loadingPanel:VTPortalUtils.utils.loadingPanelConf()},ct};VTPortal.telecommute=function(n){function v(){h().viewShown();t()!=null&&t()>0&&(o(!0),VTPortalUtils.utils.markRequestAsRead(t()),a());VTPortal.roApp.impersonatedIDEmployee==-1?t()!=null&&i(!0):t()!=null&&r(!1);t()==null&&c(!0);t()!=null&&f(!0)}function p(){t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}var t=ko.observable(null),u=ko.observable(""),c=ko.observable(!1),i=ko.observable(!1),f=ko.observable(!1),e=ko.observable(!1),r=ko.observable(!1),o=ko.observable(!1),s=VTPortal.approvalHistory(),w=ko.observable([]),y;typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));var l=ko.computed(function(){return"76%"}),a=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)n.Field1=="0"?u(i18nextko.i18n.t("roRequestTelecommuteOffice")+moment(n.Date1).format("DD/MM/YYYY")):u(i18nextko.i18n.t("roRequestTelecommuteHome")+moment(n.Date1).format("DD/MM/YYYY")),n.ReqStatus==0?i(!0):i(!1),r(!1),VTPortal.roApp.impersonatedIDEmployee!=-1&&(n.ReqStatus==0||n.ReqStatus==1)&&(r(!0),i(!1)),s.refreshApprovals(n.RequestsHistoryEntries);else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())},h=ko.observable(VTPortal.bigUserInfo());return y=null,{requestId:t,myApprovalsBlock:s,viewShown:v,title:i18nextko.t("roRequestType_telecommute"),lblPunchesInfo:i18nextko.t("rotelecommuteDays"),lblRemarks:i18nextko.t("rotelecommuteDaysDetail"),remarks:{value:u,readOnly:o},subscribeBlock:h(),scrollContent:{height:l},popupVisible:e,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),16,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:r},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),16,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:r},btnHistory:{onClick:function(){e(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:f},btnDelete:{onClick:p,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:i},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.userFields=function(n){function vt(){et().viewShown();s("");l([]);i(!0,!1,!1,!1);at("userfields");t()!=null&&t()>0&&(u(!0),VTPortalUtils.utils.markRequestAsRead(t()));VTPortal.roApp.impersonatedIDEmployee==-1?t()!=null&&o(!0):t()!=null&&e(!1);t()==null&&it(!0);t()!=null&&ut(!0)}function yt(){var i=s().split("__"),o=parseInt(i[1],10),t,n,u,e;if(o==9)u=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)},e=function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDocumentUploaded"),"success",2e3)):VTPortalUtils.utils.processErrorMessage(n)},r==null&&(r=new WebServiceRobotics(e,u)),t=y.getDocument(),VTPortal.roApp.isModeApp()?r.uploadDocumentMobile(t,-1,f(),""):(t.append("idRelatedObject",1),t.append("remarks",f()),t.append("docRelatedInfo",""),r.uploadDocumentDesktop(t));else{n="";switch(o){case 2:n=moment(w()).format("YYYY/MM/DD");break;case 4:n=moment(b()).format("HH:mm");break;case 5:n=c();break;default:n=p()}u=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorSavingRequest"),"error",0)};e=function(t){if(t.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtRequestList(1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3);else{var u=function(){r.saveUserFieldRequest(i[0],n,f(),i[2].toLowerCase()=="false"?!1:!0,moment().startOf("day"),!0)};VTPortalUtils.utils.processRequestErrorMessage(t,u,function(){})}};r==null&&(r=new WebServiceRobotics(e,u));r.saveUserFieldRequest(i[0],n,f(),i[2].toLowerCase()=="false"?!1:!0,moment().startOf("day"),!1)}}function pt(){t()!=null&&t()>0&&VTPortalUtils.utils.deleteRequest(t())}var t=ko.observable(null),f=ko.observable(""),a=ko.observable(""),e=ko.observable(!1),it=ko.observable(!1),o=ko.observable(!1),rt=ko.observable(!1),ut=ko.observable(!1),s=ko.observable(""),ot=ko.observable([]),v=ko.observable(!1),y=new VTPortal.documentInput,r;typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&t(parseInt(n.id,10));typeof n.param!="undefined"&&a(n.param);var u=ko.observable(!1),h=ko.observable(null),c=ko.observable(null),wt=ko.observable(""),p=ko.observable(""),w=ko.observable(moment().startOf("day").toDate()),b=ko.observable(moment().startOf("day").toDate()),k=ko.observable([]),l=ko.observable([]),d=ko.observable(!1),g=ko.observable(!1),nt=ko.observable(!1),tt=ko.observable(!1),ft=VTPortal.approvalHistory(),st=ko.computed(function(){return"76%"}),i=function(n,t,i,r){n?d(!0):d(!1);t?g(!0):g(!1);i?nt(!0):nt(!1);r?tt(!0):tt(!1)},ht=function(n){var t=n.value.split("__");s(n.value);v(!1);switch(parseInt(t[1],10)){case 2:i(!1,!0,!1,!1);break;case 4:i(!1,!1,!0,!1);break;case 5:i(!0,!1,!1,!1);new WebServiceRobotics(function(n){var t,i,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(t=[],i=0;i<n.Values.length;i++)t.push({FieldName:n.Values[i],FieldValue:n.Values[i]});l(t);t.length>0&&c(t[0].FieldValue)}else r=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r)},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getUserFieldAvailableValues(t[0]);break;case 9:ct(t[3]);break;default:i(!1,!1,!1,!0)}},ct=function(n){new WebServiceRobotics(function(t){if(t.Status==window.VTPortalUtils.constants.OK.value)ot(t.SelectFields),y.initializeData(t.SelectFields,!1,parseInt(n,10)),v(!0);else{var i=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(t,i)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingCauseInfo"),"error",0,n)}).getGenericList("documents")},lt=function(){new WebServiceRobotics(function(n){var r,t,u,a,v;if(n.Status==window.VTPortalUtils.constants.OK.value){for(f(n.Comments),n.ReqStatus==0?o(!0):o(!1),e(!1),VTPortal.roApp.impersonatedIDEmployee!=-1&&(n.ReqStatus==0||n.ReqStatus==1)&&(e(!0),o(!1)),ft.refreshApprovals(n.RequestsHistoryEntries),r=k(),t=0;t<r.length;t++)r[t].FieldValue==n.FieldName&&(s(r[t].FieldValue),h(r[t].FieldValue));u=s().split("__");switch(parseInt(u[1],10)){case 2:w(moment(n.FieldValue,"YYYY/MM/DD").toDate());i(!1,!0,!1,!1);break;case 4:b(moment(n.FieldValue,"HH:mm").toDate());i(!1,!1,!0,!1);break;case 5:i(!0,!1,!1,!1);a=n;new WebServiceRobotics(function(n){var i,t,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=[],t=0;t<n.Values.length;t++)i.push({FieldName:n.Values[t],FieldValue:n.Values[t]});l(i);setTimeout(function(){c(a.FieldValue)},50)}else r=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r)},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getUserFieldAvailableValues(u[0]);break;default:i(!1,!1,!1,!0);p(n.FieldValue)}}else v=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,v)},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequest(t())},at=function(n){new WebServiceRobotics(function(n){var i,r;if(n.Status==window.VTPortalUtils.constants.OK.value)if(k(n.SelectFields),t()!=null&&t()>0)lt(t());else if(a()=="")n.SelectFields.length>0&&h(n.SelectFields[0].FieldValue);else for(i=0;i<n.SelectFields.length;i++)n.SelectFields[i].FieldValue.startsWith(a()+"__")&&h(n.SelectFields[i].FieldValue);else r=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r)},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequestInfo"),"error",0,n)}).getGenericList(n)},et=ko.observable(VTPortal.bigUserInfo());return r=null,{requestId:t,myApprovalsBlock:ft,viewShown:vt,title:i18nextko.t("roRequestType_UserFieldsChange"),lblRemarks:i18nextko.t("roRequestRemarksLbl"),lblRequestValue1:i18nextko.t("roRequestUserFieldLbl"),lblRequestValue2:i18nextko.t("roRequestUserFieldValueLbl"),subscribeBlock:et(),scrollContent:{height:st},popupVisible:rt,btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),1,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:e},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequest(t(),1,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:e},btnHistory:{onClick:function(){rt(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:ut},btnSave:{onClick:yt,text:"",hint:i18nextko.i18n.t("roSaveRequest"),icon:"Images/Common/save.png",visible:it},btnDelete:{onClick:pt,text:"",hint:i18nextko.i18n.t("roDeleteRequest"),icon:"Images/Common/delete.png",visible:o},remarks:{value:f,readOnly:u},cmbRequestValue1:{dataSource:k,displayExpr:"FieldName",valueExpr:"FieldValue",value:h,onValueChanged:ht,readOnly:u},cmbRequestValue2:{dataSource:l,displayExpr:"FieldName",valueExpr:"FieldValue",value:c,visible:d,readOnly:u},dateRequestValue2:{type:"date",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:w,visible:g,readOnly:u,valueChangeEvent:"focusout"},timeRequestValue2:{type:"time",pickerType:VTPortalUtils.utils.datetimeTypeSelect(),value:b,visible:nt,readOnly:u,valueChangeEvent:"focusout"},txtRequestValue2:{value:p,visible:tt,readOnly:u},hasDocuments:v,myDocumentsBlock:y,loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.absence=function(n){function ht(){c(!0);et();st()}function ct(){l().viewShown();ht()}var l=ko.observable(VTPortal.bigUserInfo()),lt=ko.observable(moment().add(-1,"days").toDate()),r=ko.observable(null),t=ko.observable(),a=ko.observable([]),tt=ko.observable([]),u=ko.observable(!1),v=ko.observable(0),y=ko.observable(0),p=ko.observable(0),e=ko.observable(!1),o=ko.observable(!1),s=ko.observable(!1),f=ko.observable(!1),h=ko.observable(!1),w=ko.observable(!1),b=ko.observable(!1),k=ko.observable(""),d=VTPortal.approvalHistory(),it=ko.observable(!1),g=ko.observable(!1),c=ko.observable(!1),nt=ko.observable(new DevExpress.data.DataSource({store:[]})),at=ko.computed(function(){return"76%"});typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&r(parseInt(n.id,10));var rt=ko.computed(function(){if(typeof t()!="undefined")return t().EmployeeName;""}),ut=ko.computed(function(){if(typeof t()!="undefined")return t().RequestInfo;""}),ft=ko.computed(function(){if(typeof t()!="undefined")return t().EmployeeGroup;""}),et=function(){new WebServiceRobotics(function(n){var i,r;n.Status==window.VTPortalUtils.constants.OK.value?(c(!1),g(!0),t(n),n.RequestDays!=null?n.RequestDays.length>1?(i=[],n.RequestDays.forEach(function(n){i.push({RequestDate:moment(n.RequestDate).format("dddd DD MMMM")})}),nt(new DevExpress.data.DataSource({store:i})),f(!0)):f(!1):f(!1),n.RequestType==6?(o(!0),tt(n.EmployeeAccruals),p(n.EmployeeAccruals.Lasting),v(n.EmployeeAccruals.Available),y(n.EmployeeAccruals.Pending)):o(!1),n.Comments!=""?(e(!0),k(n.Comments)):e(!1),u(!1),(n.ReqStatus==0||n.ReqStatus==1)&&u(!0),d.refreshApprovals(n.RequestsHistoryEntries)):(r=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,r))},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequestForSupervisor(r())},ot=ko.computed(function(){return typeof t()!="undefined"?t().EmployeeImage!=""?"url(data:image/png;base64,"+t().EmployeeImage+")":"url(Images/logovtl.png)":""}),st=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)if(n.Overlays.length>0){for(s(!0),h(!1),i=0;i<n.Overlays.length;i++)n.Overlays[i].EmployeeImage=n.Overlays[i].EmployeeImage==""?n.DefaultImage.replace("no-repeat center center",""):n.Overlays[i].EmployeeImage.replace("no-repeat center center","");a(n.Overlays)}else s(!1),h(!0)}).getOverlappingEmployees(r())};return{viewShown:ct,title:i18nextko.i18n.t("roRequestType_PlannedAbsences"),subscribeBlock:l(),empImage:ot,lblEmployee:rt,detailsVisible:function(){b(!0)},lblRequestDates:ut,lblOverlays:i18nextko.i18n.t("lblOverlays"),lblAccruals:i18nextko.i18n.t("roMyAccrualsHint"),lblNoOverlays:i18nextko.i18n.t("lblNoOverlays"),lblAvailable:v,lblPending:y,lblApproved:p,lblRemarks:i18nextko.i18n.t("lblRemarks"),lblApprovedText:i18nextko.i18n.t("lblApprovedText"),lblPendingText:i18nextko.i18n.t("lblPendingText"),lblAvailableText:i18nextko.i18n.t("lblAvailableText"),lblRequestedDays:i18nextko.i18n.t("lblRequestedDays"),lblLoading:i18nextko.i18n.t("lblLoading"),lblGroupName:ft,remarks:k,myApprovalsBlock:d,popupVisible:w,popupRequestDaysVisible:b,accrualsDivVisible:o,infoDivVisible:e,requestMainDivVisible:g,daysDetailDiv:f,loadingDivVisible:c,overlaysDivVisible:s,noOverlaysDivVisible:h,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),scrollContent:{},listRequestDays:{dataSource:nt,scrollingEnabled:!0,grouped:!1,height:300,itemTemplate:"RequestItem"},overlays:{items:a,height:175,direction:"horizontal",baseItemHeight:75,baseItemWidth:75,itemMargin:10,itemTemplate(n,t,i){var r,u;n.IsRequest==!0?(i.append(`<div class="imageTileviewRequest" id="div_${n.IdEmployee}_${n.IdCounter}"><div class="textTileview">${n.EmployeeName}</div><div class="imageTileviewRequest" style="border: 3px solid #FF5C35; background-image: ${n.EmployeeImage}"></div></div>`),r=$("<div>"),u=$("<div style='margin:10px; font-size: 10px;'>").html(n.AbsenceResume),r.append(u),r.dxPopover({target:`#div_${n.IdEmployee}_${n.IdCounter}`,showEvent:"dxclick",position:"top",width:300}).appendTo(i)):(i.append(`<div class="imageTileview" id="div_${n.IdEmployee}_${n.IdCounter}"><div class="textTileview">${n.EmployeeName}</div><div class="imageTileview" style="background-image: ${n.EmployeeImage}"></div></div>`),r=$("<div>"),u=$("<div style='margin:10px; font-size: 10px;'>").html(n.AbsenceResume),r.append(u),r.dxPopover({target:`#div_${n.IdEmployee}_${n.IdCounter}`,showEvent:"dxclick",position:"top",width:300}).appendTo(i))}},btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequestNew(r(),t().RequestType,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:u},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequestNew(r(),t().RequestType,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:u},btnHistory:{onClick:function(){w(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:it}}};VTPortal.forgotten=function(n){function ft(){o(!0);it()}function et(){s().viewShown();ft()}var s=ko.observable(VTPortal.bigUserInfo()),i=ko.observable([]),ot=ko.observable(new Date),st=ko.computed(function(){return VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().TaskTitle.length<=50?i18nextko.i18n.t("inTask")+VTPortal.roApp.userStatus().TaskTitle:i18nextko.i18n.t("inTask")+VTPortal.roApp.userStatus().TaskTitle.substr(0,48)+"...":""}),h=ko.computed(function(){return i18nextko.i18n.t("noPunches")}),r=ko.observable(null),t=ko.observable(),ht=ko.observable([]),u=ko.observable(!1),y=ko.observable(0),p=ko.observable(0),w=ko.observable(0),b=ko.observable(!1),c=ko.observable(!1),l=ko.observable(""),f=ko.observable(!1),e=ko.observable(!1),a=VTPortal.approvalHistory(),k=ko.observable(!1),v=ko.observable(!1),o=ko.observable(!1),ct=ko.observable(new DevExpress.data.DataSource({store:[]})),lt=ko.computed(function(){return"76%"});typeof n.id!="undefined"&&parseInt(n.id,10)!=-1&&r(parseInt(n.id,10));var d=ko.computed(function(){if(typeof t()!="undefined")return t().RequestInfo;""}),g=ko.computed(function(){if(typeof t()!="undefined")return t().EmployeeName;""}),nt=ko.computed(function(){if(typeof t()!="undefined")return t().RequestInfo;""}),tt=ko.computed(function(){if(typeof t()!="undefined")return t().EmployeeGroup;""}),it=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)o(!1),v(!0),t(n),rt(),u(!1),(n.ReqStatus==0||n.ReqStatus==1)&&u(!0),n.Comments!=""?(f(!0),l(n.Comments)):f(!1),a.refreshApprovals(n.RequestsHistoryEntries);else{var i=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,i)}},function(){var n=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingRequest"),"error",0,n)}).getRequestForSupervisor(r())},rt=function(){VTPortal.roApp.newPunchDone(!1);new WebServiceRobotics(function(n){var t,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(e(!0),t=n.Punches,r=0;r<t.length;r++){switch(t[r].Type){case 1:case 2:case 3:case 7:t[r].TypeData!=null&&t[r].TypeData>0?t[r].ActualType==1?typeof t[r].InTelecommute!="undefined"&&t[r].InTelecommute.toLowerCase()=="true"?(t[r].cssClass="dx-icon-TATC_in",t[r].Name=i18nextko.i18n.t("roEntry")+": "+moment.tz(t[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")):(t[r].cssClass="dx-icon-TA_in_cause",t[r].Name=i18nextko.i18n.t("roPunches_TA_in_causeHome")+": "+moment.tz(t[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")):(t[r].cssClass="dx-icon-TA_out_cause",t[r].Name=i18nextko.i18n.t("roPunches_TA_out_causeHome")+": "+moment.tz(t[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")):t[r].ActualType==1?typeof t[r].InTelecommute!="undefined"&&t[r].InTelecommute.toLowerCase()=="true"?(t[r].cssClass="dx-icon-TATC_in",t[r].Name=i18nextko.i18n.t("roEntry")+": "+moment.tz(t[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")):(t[r].cssClass="dx-icon-TA_in",t[r].Name=i18nextko.i18n.t("roEntry")+": "+moment.tz(t[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")):(t[r].cssClass="dx-icon-TA_out",t[r].Name=i18nextko.i18n.t("roExit")+": "+moment.tz(t[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm"));t[r].hasAction=!0;break;case 4:t[r].cssClass="dx-icon-Task_change";t[r].hasAction=!1;t[r].Name=i18nextko.i18n.t("roPunches_Task_changeHome")+": "+moment.tz(t[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm");break;case 13:t[r].cssClass="dx-icon-CostCenter";t[r].hasAction=!1;t[r].Name=i18nextko.i18n.t("roPunches_CostCenter")+": "+moment.tz(t[r].DateTime,VTPortal.roApp.serverTimeZone).format("HH:mm")}t[r].Value=t[r].RequestedTypeData!=""?i18nextko.i18n.t("roRequestPendingApprove")+t[r].RequestedTypeData:t[r].RelatedInfo}i(t)}else e(!1),i([])}).getPunchesOnDate(t().IdEmployee,t().Date1)},ut=ko.computed(function(){return typeof t()!="undefined"?t().EmployeeImage!=""?"url(data:image/png;base64,"+t().EmployeeImage+")":"url(Images/logovtl.png)":""});return{viewShown:et,title:i18nextko.i18n.t("roRequestType_ForbiddenPunch"),subscribeBlock:s(),empImage:ut,lblEmployee:g,detailsVisible:function(){popupRequestDaysVisible(!0)},lblRequestDates:nt,lblOverlays:i18nextko.i18n.t("lblOverlays"),lblAccruals:i18nextko.i18n.t("roMyAccrualsHint"),lblNoOverlays:i18nextko.i18n.t("lblNoOverlays"),lblAvailable:y,lblPending:p,lblApproved:w,noPunches:h,lblRemarks:i18nextko.i18n.t("lblRemarks"),lblApprovedText:i18nextko.i18n.t("lblApprovedText"),lblPendingText:i18nextko.i18n.t("lblPendingText"),lblAvailableText:i18nextko.i18n.t("lblAvailableText"),lblRequestedDays:i18nextko.i18n.t("lblRequestedDays"),lblCurrentPunches:i18nextko.i18n.t("lblCurrentPunches"),lblLoading:i18nextko.i18n.t("lblLoading"),lblGroupName:tt,remarks:l,lblPunchInfo:d,myApprovalsBlock:a,popupVisible:c,infoDivVisible:b,remarksDivVisible:f,currentPunchesDivVisible:e,requestMainDivVisible:v,loadingDivVisible:o,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),punchesDS:i,noPunches:h,listCurrentPunches:{dataSource:i,scrollingEnabled:!0,grouped:!1,height:300},scrollContent:{},btnApprove:{onClick:function(){VTPortalUtils.utils.approveRefuseRequestNew(r(),t().RequestType,!0)},text:"",hint:i18nextko.i18n.t("roApprove"),icon:"Images/Common/approve.png",visible:u},btnRefuse:{onClick:function(){VTPortalUtils.utils.approveRefuseRequestNew(r(),t().RequestType,!1)},text:"",hint:i18nextko.i18n.t("roRefuse"),icon:"Images/Common/refuse.png",visible:u},btnHistory:{onClick:function(){c(!0)},text:"",hint:i18nextko.i18n.t("roLblRequestApprovals"),icon:"Images/Common/historic.png",visible:k}}};VTPortal.capacityDetail=function(n){function o(){r().viewShown();var t=moment(n.id,"YYYY-MM-DD");f(i18nextko.i18n.t("rocapacityDetail")+" "+n.id);u(t.toDate());i(!0);VTPortal.roApp.loggedIn?e():(i(!1),VTPortalUtils.utils.loginIfNecessary("",e))}var t=ko.observable(new DevExpress.data.DataSource({store:VTPortal.roApp.capacityEmployees,searchOperation:"contains",searchExpr:["Name","Group"]})),r=ko.observable(VTPortal.bigUserInfo()),i=ko.observable(!1),u=ko.observable(new Date),f=ko.observable(""),e=function(){new WebServiceRobotics(function(n){var r,u;if(i(!1),n.Status==window.VTPortalUtils.constants.OK.value){for(r=n.Employees,u=0;u<r.length;u++)r[u].Image==""&&(r[u].Image=n.DefaultImage);VTPortal.roApp.capacityEmployees=n.Employees;t(new DevExpress.data.DataSource({store:r,searchOperation:"contains",searchExpr:["Name","Group"]}))}else VTPortalUtils.utils.processErrorMessage(n)}).getCapacityDetail(u())};return{viewShown:o,title:f,subscribeBlock:r(),listOptions:{dataSource:t,grouped:!1,indicateLoading:!1,pageLoadMode:"nextButton",height:"90%",itemTemplate:"item"},searchOptions:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(n){t().searchValue(n.value);t().load()}},loadingPanel:{showPane:!1,height:110,shading:!0,shadingColor:"rgba(255,255,255,0.5)",indicatorSrc:"Images/DoubleRing.gif",visible:i}}};VTPortal.dayInfo=function(n){function d(){a().viewShown();var t=moment(n.id,"YYYY-MM-DD");i(t.toDate())}function nt(n){var t=Math.floor(n/60),i=n%60;return t=t<10?"0"+t:t,i=i<10?"0"+i:i,t+":"+i}function ht(n,t){var i=function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorDeleteProgrammedAbsence"),"error",0)},r=function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtHome(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDeleteProgrammedAbsenceSaved"),"success",2e3);else{var t=function(){};VTPortalUtils.utils.processRequestErrorMessage(n,t,function(){})}};h==null&&(h=new WebServiceRobotics(r,i));h.deleteProgrammedAbsence(n,t)}var y=i18nextko.i18n.t("roDayDetail"),i=ko.observable(new Date),t=ko.observable(null),f=ko.observable([{key:"forecasts",items:[]}]),r=ko.observable([{key:"forecasts",items:[]}]),e=ko.observable([]),u=null,o=ko.observable(!1),s=ko.observable(!1),c=function(){i(moment(i()).subtract(1,"days"))},l=function(){i(moment(i()).add(1,"days"))},p=function(n,t){var i=t.targetOffset;i<0?l():i>0&&c()},w=function(){var n,r;VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.CauseNote?(n=function(n){var i,r,u,e;if(n.Status==window.VTPortalUtils.constants.OK.value){for(n.DayInfo!=null&&n.DayInfo.DayData.length>0&&t(n.DayInfo.DayData[0]),i=n.Forecasts,r=0;r<i.length;r++){switch(i[r].ForecastType){case"days":i[r].cssClass="dx-icon-plannedAbsences";break;case"hours":i[r].cssClass="dx-icon-plannedCauses";break;case"holidayhours":i[r].cssClass="dx-icon-plannedHoliday";break;case"overtime":i[r].cssClass="dx-icon-plannedOvertime"}i[r].hasAction=i[r].HasDocuments;i[r].Description=i18nextko.i18n.t("roLeavesFrom")+" "+moment(i[r].BeginDate).format("L")+" "+i18nextko.i18n.t("roLeavesCause")+" "+i[r].Cause;i[r].AlertDescription=i[r].DocAlerts!=null&&i[r].DocAlerts.length>0?i18nextko.i18n.t("roLeavesRequiereDocuments"):i18nextko.i18n.t("roLeavesNoAlerts")}u=[{key:"forecasts",items:i}];f(u);b(n);k()}else t(null),f([{key:"forecasts",items:[]}]),e=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,e)},new WebServiceRobotics(function(t){n(t)}).getEmployeeDayInfo(i())):(r=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roIncorrectApiVersion"),"error",0,r))},b=function(n){var s=[],c=moment(),f=c.clone().startOf("day"),i,u,o,t;if(typeof n.DayInfo!="undefined"&&n.DayInfo!=null&&n.DayInfo.DayData.length>0&&n.DayInfo.DayData[0].MainShift!=null){if(i=n.DayInfo.DayData[0].MainShift,i.ShiftLayers==0)f=moment(i.StartHour).endOf("day"),t=moment(i.StartHour).diff(f,"minutes")-1,u=moment(i.EndHour).diff(moment(i.StartHour),"minutes"),s.push({Name:"",Gauge:{scale:{startValue:t,endValue:t+u,tickInterval:60,label:{indentFromTick:-3,"true":!1,customizeText:VTPortalUtils.utils.convertShiftHourToTime(t+u)},tick:{color:"#536878"}},value:0,subvalues:[t,t+u],subvalueIndicator:{type:"textCloud",color:"#ff5c35",text:{font:{size:12},customizeText:VTPortalUtils.utils.convertShiftHourToTime(t+u)}},rangeContainer:{offset:10,ranges:[{startValue:t,endValue:t+u,color:"#77DD77"}]}}});else for(o=0;o<i.ShiftLayers;o++){var r=i.ShiftLayersDefinition[o],l=moment.tz(moment(r.LayerStartTime),VTPortal.roApp.serverTimeZone),h=l.format("YYYYMMDDHHmmss");f=moment(h,"YYYYMMDDHHmmss").endOf("day");t=moment(h,"YYYYMMDDHHmmss").diff(f,"minutes")-1;s.push({Name:i18nextko.i18n.t("roLayer")+" "+r.LayerID,Gauge:{scale:{startValue:t,endValue:t+r.LayerDuration,tickInterval:60,label:{indentFromTick:-3,visible:!1,customizeText:VTPortalUtils.utils.convertShiftHourToTime(t+r.LayerDuration)},tick:{color:"#536878"}},value:0,subvalues:[t,t+r.LayerOrdinaryHours,t+r.LayerDuration],subvalueIndicator:{type:"textCloud",color:"#ff5c35",text:{font:{size:12},customizeText:VTPortalUtils.utils.convertShiftHourToTime(t+i.PlannedHours)}},rangeContainer:{offset:10,ranges:[{startValue:t,endValue:t+r.LayerOrdinaryHours,color:"#77DD77"},{startValue:t+r.LayerOrdinaryHours,endValue:t+r.LayerDuration,color:"#ff0000"}]}}})}e([{key:"Franjas",items:s}])}else e([])},k=function(){if(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Holidays)(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&(VTPortal.roApp.empPermissions().Schedule.ScheduleAccruals||VTPortal.roApp.empPermissions().Schedule.ProductivAccruals))&&new WebServiceRobotics(function(n){var f,e,o;if(n.Status==window.VTPortalUtils.constants.OK.value){if(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Schedule.ScheduleAccruals){var t=[],u=[],i=n.ScheduleSummary;i.DailyAccruals.length>0&&(u=u.concat(VTPortalUtils.utils.generateAccrualsArray(i.DailyAccruals)));i.WeekAccruals.length>0&&(t=t.concat(VTPortalUtils.utils.generateAccrualsArray(i.WeekAccruals)));i.MonthAccruals.length>0&&(t=t.concat(VTPortalUtils.utils.generateAccrualsArray(i.MonthAccruals)));i.YearAccruals.length>0&&(t=t.concat(VTPortalUtils.utils.generateAccrualsArray(i.YearAccruals)));i.ContractAccruals.length>0&&(t=t.concat(VTPortalUtils.utils.generateAccrualsArray(i.ContractAccruals)));f=[];t.length==0&&u.length==0?f.push({key:"forecasts",items:[]}):(u.length>0&&f.push({key:"Daily",items:u.sortBy(function(n){return n.Name})}),t.length>0&&f.push({key:"Total",items:t.sortBy(function(n){return n.Name})}));r(f)}if(r()[0].items.length>0)for(e=0;e<r().length;e++)$("#listSchedule").dxList("instance").collapseGroup(e);$("#scrollview").height($("#panelsContent").height()-70)}else r(ko.observable([{key:"forecasts",items:[]}])),o=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,o)}).getAccrualsSummary(i());else{var n=function(){};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roIncorrectApiVersion"),"error",0,n)}},a=ko.observable(VTPortal.bigUserInfo()),g=ko.computed(function(){return t()!=null&&t().MainShift!=null?t().MainShift.Name:""}),tt=ko.computed(function(){return t()!=null&&t().MainShift!=null?i18nextko.i18n.t("roPlannedLbl")+": "+nt(t().MainShift.PlannedHours):""}),v=ko.computed(function(){return t()!=null&&t().IncidenceData!=null&&typeof t().IncidenceData.NormalWork!="undefined"&&t().IncidenceData.NormalWork!=0?t().IncidenceData.NormalWork:0}),it=ko.computed(function(){return t()!=null&&t().Alerts!=null?t().Alerts.OnAbsenceDays:!1}),rt=ko.computed(function(){return t()!=null&&t().Alerts!=null?t().Alerts.OnAbsenceHours:!1}),ut=ko.computed(function(){return t()!=null&&t().Alerts!=null?t().Alerts.OnHolidaysHours:!1}),ft=ko.computed(function(){return t()!=null&&t().Alerts!=null?t().Alerts.OnOvertimesHours:!1}),et=ko.computed(function(){return t()!=null&&t().Alerts!=null?t().Alerts.OnHolidays:!1}),ot=function(){VTPortal.app.navigate("sendLeaveDocument/-1/"+u.itemData.ForecastID+"/"+u.itemData.IdCause+"/"+u.itemData.ForecastType)},st=function(){ht(u.itemData.ForecastID,u.itemData.ForecastType)},h=null;return{viewShown:d,title:y,subscribeBlock:a(),forecastsDS:f,listForecasts:{dataSource:f,scrollingEnabled:!1,grouped:!0,collapsibleGroups:!1,itemTemplate:"ForecastItem",groupTemplate:function(){return $("<div>"+i18nextko.i18n.t("roDailyForecasts")+"<\/div>")},onItemClick:function(n){u=n;n.itemData.hasAction?o(!0):o(!1);VTPortal.roApp.empPermissions().Forecast==!0?s(!0):s(!1)}},headerDate:{value:i,pickerType:"rollers",displayFormat:"shortDate",onValueChanged:w},btnPrevious:{icon:"chevronprev",onClick:c},btnNext:{icon:"chevronnext",onClick:l},myEventHandler:p,lblShift:i18nextko.t("roShiftLbl"),lblAccrual:i18nextko.t("roAccrualLbl"),txtDayShift:{placeholder:i18nextko.t("roShiftLbl"),value:g,readOnly:!0},txtPlannedHours:{placeholder:i18nextko.t("roPlannedLbl"),value:tt,readOnly:!0},remarkValue:v,txtRemarkValue:{placeholder:i18nextko.t("roAccrualLbl"),value:v,readOnly:!0},onHolidays:et,onPlannedAbsence:it,onPlannedCause:rt,onPlannedHoliday:ut,onPlannedOvertime:ft,scheduleDS:r,listSchedule:{dataSource:r,scrollingEnabled:!1,grouped:!0,collapsibleGroups:!0,itemTemplate:"ScheduleItem",groupTemplate:function(n){return $("<div>"+i18nextko.i18n.t("roResumeAccruals_"+n.key)+"<\/div>")}},listShiftLayer:{dataSource:e,scrollingEnabled:!1,grouped:!0,collapsibleGroups:!0,itemTemplate:"ScheduleItem",groupTemplate:function(n){return $("<div>"+i18nextko.i18n.t("roResumeAccruals_"+n.key)+"<\/div>")}},btnDeleteRequest:{visible:s,onClick:st,text:"",icon:"Images/Common/delete.png"},btnEditRequest:{visible:o,onClick:ot,text:"",icon:"Images/Common/plus.png"}}};VTPortal.myAccruals=function(){function h(){r(moment().add(-1,"days").toDate());u();f(!0)}var l=function(n,t){var i=t.targetOffset;i<0?o():i>0&&e()},r=ko.observable(moment().add(-1,"days").toDate()),f=ko.observable(!1),t=ko.observable([]),n=ko.observable([]),i=ko.observable([]),s=ko.computed(function(){return VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&(VTPortal.roApp.empPermissions().Schedule.ScheduleAccruals||VTPortal.roApp.empPermissions().Schedule.ProductivAccruals)?!0:!1}),e=function(){r(moment(r()).subtract(1,"days"));u()},o=function(){r(moment(r()).add(1,"days"));u()},c=function(){VTPortal.app.navigate("requestsList/6,11,13,14/null")},u=function(){if(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Holidays)(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&(VTPortal.roApp.empPermissions().Schedule.ScheduleAccruals||VTPortal.roApp.empPermissions().Schedule.ProductivAccruals||VTPortal.roApp.empPermissions().Schedule.QuerySchedule))&&new WebServiceRobotics(function(r){var s,u,e,v,c,l,a,o,f,y;if(r.Status==window.VTPortalUtils.constants.OK.value){if(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Schedule.ScheduleAccruals){var e=[],h=[],u=r.ScheduleSummary;u.WeekAccruals.length>0&&(e=e.concat(VTPortalUtils.utils.generateAccrualsArray(u.WeekAccruals)));u.MonthAccruals.length>0&&(e=e.concat(VTPortalUtils.utils.generateAccrualsArray(u.MonthAccruals)));u.YearAccruals.length>0&&(e=e.concat(VTPortalUtils.utils.generateAccrualsArray(u.YearAccruals)));u.ContractAccruals.length>0&&(e=e.concat(VTPortalUtils.utils.generateAccrualsArray(u.ContractAccruals)));o=[];e.length==0&&h.length==0?n([]):(h.length>0&&o.push({key:"Daily",items:h.sortBy(function(n){return n.Name})}),e.length>0&&o.push({key:"Total",items:e.sortBy(function(n){return n.Name})}));n(o)}if(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Schedule.QuerySchedule){if(e=[],u=r.HolidaysSummary,u.HolidaysInfo.length>0)for(f=0;f<u.HolidaysInfo.length;f++)u.HolidaysInfo[f].Type=u.HolidaysInfo[f].IDShift>0?"O":"H",s=[],u.HolidaysInfo[f].Type=="O"?s.push({valueField:"Done",name:i18nextko.i18n.t("roHolidayResume_Done")}):u.HolidaysInfo[f].Done>0&&s.push({valueField:"Done",name:i18nextko.i18n.t("roHolidayResume_Done")}),s.push({valueField:"Pending",name:i18nextko.i18n.t("roHolidayResume_Pending")}),s.push({valueField:"Lasting",name:i18nextko.i18n.t("roHolidayResume_Lasting")}),s.push({valueField:"Available",name:i18nextko.i18n.t("roHolidayResume_Available")}),s.push({valueField:"Prevision",name:i18nextko.i18n.t("roHolidayResume_Prevision")}),e.push({Name:u.HolidaysInfo[f].Name,Gauge:{dataSource:[{task:u.HolidaysInfo[f].Name,Done:u.HolidaysInfo[f].Done,Pending:u.HolidaysInfo[f].Pending,Lasting:u.HolidaysInfo[f].Lasting,Available:u.HolidaysInfo[f].Available,Prevision:u.HolidaysInfo[f].Prevision}],commonSeriesSettings:{argumentField:"task",type:"bar",label:{visible:!0,customizeText:VTPortalUtils.utils.convertHoursToTime(u.HolidaysInfo[f],!1)}},series:s,title:{text:u.HolidaysInfo[f].Name},legend:{verticalAlignment:"bottom",horizontalAlignment:"center"},argumentAxis:{label:{visible:!1}}}});e.length>0?(o=[{key:"Vacaciones",items:e.sortBy(function(n){return n.Name})}],i(o)):i([])}if(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Schedule.ProductivAccruals)if(u=r.ProductiVSummary,e=[],u.YearAccruals.length>0){for(f=0;f<u.YearAccruals.length;f++)u.YearAccruals[f].MaxValue=u.YearAccruals[f].TaskValue,u.YearAccruals[f].Type="H",v=u.YearAccruals[f].TaskValue,c=0,$.grep(u.MonthAccruals,function(n){n.IdTask==u.YearAccruals[f].IdTask&&(c=n.TaskValue)}),l=0,$.grep(u.WeekAccruals,function(n){n.IdTask==u.YearAccruals[f].IdTask&&(l=n.TaskValue)}),a=0,$.grep(u.DailyAccruals,function(n){n.IdTask==u.YearAccruals[f].IdTask&&(a=n.TaskValue)}),e.push({Name:u.YearAccruals[f].TaskName,Gauge:{dataSource:[{task:u.YearAccruals[f].TaskName,year:v,month:c,week:l,day:a}],commonSeriesSettings:{argumentField:"task",type:"bar",label:{visible:!0,customizeText:VTPortalUtils.utils.convertHoursToTime(u.YearAccruals[f],!1)}},series:[{valueField:"year",name:i18nextko.i18n.t("roPeriod_year")},{valueField:"month",name:i18nextko.i18n.t("roPeriod_month")},{valueField:"week",name:i18nextko.i18n.t("roPeriod_week")},{valueField:"day",name:i18nextko.i18n.t("roPeriod_daily")}],title:{text:u.YearAccruals[f].TaskName,subtitle:{text:"tiempo en horas"}},legend:{verticalAlignment:"bottom",horizontalAlignment:"center"},argumentAxis:{label:{visible:!1}}}});o=[{key:"ProductiV",items:e.sortBy(function(n){return n.Name})}];t(o)}else t([]);if(n().length>0&&(t().length>0||i().length>0))for(f=0;f<n().length;f++)$("#listSchedule").dxList("instance").collapseGroup(f);t().length>0&&(n().length>0||i().length>0)&&$("#listProductiV").dxList("instance").collapseGroup(0);i().length>0&&(n().length>0||t().length>0)&&$("#listHolidays").dxList("instance").collapseGroup(0);$("#scrollview").height($("#panelsContent").height())}else t([]),n([]),i([]),y=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(r,y)}).getAccrualsSummary(r());else{var u=function(){};VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roIncorrectApiVersion"),"error",0,u)}};return{modelIsReady:f,initializeView:h,hasPermission:s,headerDate:{value:r,pickerType:"rollers",displayFormat:"shortDate"},btnPrevious:{icon:"chevronprev",onClick:e},btnNext:{icon:"chevronnext",onClick:o},scheduleDS:n,productivDS:t,holidaysDS:i,listSchedule:{dataSource:n,scrollingEnabled:!1,grouped:!0,collapsibleGroups:!0,itemTemplate:"ScheduleItem",groupTemplate:function(){return $("<div>"+i18nextko.i18n.t("roResumeAccruals")+"<\/div>")}},listHolidays:{dataSource:i,scrollingEnabled:!1,grouped:!0,collapsibleGroups:!0,itemTemplate:"HolidaysItem",groupTemplate:function(){return $("<div>"+i18nextko.i18n.t("roResumeHolidays")+"<\/div>")}},listProductiV:{dataSource:t,scrollingEnabled:!1,grouped:!0,collapsibleGroups:!0,itemTemplate:"ProductiVItem",groupTemplate:function(){return $("<div>"+i18nextko.i18n.t("roResumeProductiV")+"<\/div>")}},newRequest:{onClick:c,text:"",icon:"Images/Common/plus.png",visible:VTPortal.roApp.ReadMode()==!1},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.myAuthorizations=function(){function e(){s();u(!0);n()?$("#scrollview").height($("#panelsContent").height()-94):$("#scrollview").height($("#panelsContent").height()-70)}function s(){n(!1);var i=VTPortal.roApp.authorizationFilters(),r=function(n){var i,r,u,f,e;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=n.Requests,r=0;r<i.length;r++){i[r].Name=i18nextko.i18n.t("roRequestType_"+i[r].RequestType);i[r].hasAction=n.CanCreateRequest?!0:!1;u="";switch(i[r].Status){case 0:u="ro_Status_pending";i[r].StatusDesc=i18nextko.i18n.t("roRequestStatus_pending");break;case 1:u="ro_Status_ongoing";i[r].StatusDesc=i18nextko.i18n.t("roRequestStatus_running");break;case 2:u="ro_Status_accepted";i[r].StatusDesc=i18nextko.i18n.t("roRequestStatus_approved");break;case 3:u="ro_Status_denied";i[r].StatusDesc=i18nextko.i18n.t("roRequestStatus_denied");break;case 4:u="ro_Status_canceled";i[r].StatusDesc=i18nextko.i18n.t("roRequestStatus_canceled");i[r].hasAction=!1}f="";switch(i[r].IdRequestType){case 9:f="dx-icon-plannedCauses";break;case 14:f="dx-icon-plannedOvertime"}i[r].cssContainerClass=u;i[r].cssClass=f;$("#scrollview").height($("#panelsContent").height())}t(i)}else t([]),e=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,e)};i==null?(n(!1),new WebServiceRobotics(function(n){r(n)}).getMyRequests(!1,moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").add(1,"day"),"0*1*2*3*4|9*14","RequestDate DESC",moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").add(1,"year"))):(n(!0),new WebServiceRobotics(function(n){r(n)}).getMyRequests(!1,i.filter.iDate,i.filter.eDate,i.filter.status.join("*")+"|"+i.filter.types.join("*"),i.order.by+" "+i.order.direction,i.filter.iRequestedDate,i.filter.eRequestedDate))}var u=ko.observable(!1),t=ko.observable([]),i=ko.observable(!1),r=ko.observable("Images/Common/more.png"),n=ko.observable(!1),f=ko.computed(function(){return VTPortal.roApp.authorizationFilters()!=null?i18nextko.i18n.t("roFilteringData"):""}),o=ko.computed(function(){var t,n;if(VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Requests!=null){for(t=!1,n=0;n<VTPortal.roApp.empPermissions().Requests.length;n++)if(VTPortal.roApp.empPermissions().Requests[n].Permission){t=!0;break}return t}return!1}),h=function(){i(!0);r("Images/Common/moreV.png")},c=function(){r("Images/Common/more.png")},l=function(){i(!1);r("Images/Common/more.png");VTPortal.app.navigate("RequestFilters/3")},a=function(){i(!1);VTPortal.app.navigate("requestsList/9,14/null")};return{modelIsReady:u,initializeView:e,hasPermission:o,requestsDS:t,dataFiltered:n,filterDescription:f,listRequests:{dataSource:t,scrollingEnabled:!1,grouped:!1,itemTemplate:"RequestItem",onItemClick:function(n){if(n.itemData.hasAction)switch(n.itemData.IdRequestType){case 9:VTPortal.app.navigate("plannedCause/"+n.itemData.Id);break;case 14:VTPortal.app.navigate("plannedOvertime/"+n.itemData.Id)}}},actionMenuPopover:{target:"#btnActionMenuPopover",position:"top",shading:!0,shadingColor:"rgba(0, 0, 0, 0.5)",visible:i,onHidden:c},showOptions:{onClick:h,text:"",icon:r},btnFilterRequests:{onClick:l,text:"",hint:i18nextko.i18n.t("roFilter"),icon:"Images/Common/filter.png"},btnNewRequests:{onClick:a,text:"",hint:i18nextko.i18n.t("roNew"),icon:"Images/Common/plus.png",visible:VTPortal.roApp.ReadMode()==!1},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.myRequests=function(){function e(){s();u(!0);n()?$("#scrollview").height($("#panelsContent").height()-94):$("#scrollview").height($("#panelsContent").height()-70)}function s(){n(!1);var i=VTPortal.roApp.requestFilters(),r=function(n){var i,r,f,u,e;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=n.Requests,r=0;r<i.length;r++){i[r].Name=i18nextko.i18n.t("roRequestType_"+i[r].RequestType);i[r].hasAction=n.CanCreateRequest?!0:!1;f="";switch(i[r].Status){case 0:f="ro_Status_pending";i[r].StatusDesc=i18nextko.i18n.t("roRequestStatus_pending");break;case 1:f="ro_Status_ongoing";i[r].StatusDesc=i18nextko.i18n.t("roRequestStatus_running");break;case 2:f="ro_Status_accepted";i[r].StatusDesc=i18nextko.i18n.t("roRequestStatus_approved");break;case 3:f="ro_Status_denied";i[r].StatusDesc=i18nextko.i18n.t("roRequestStatus_denied");break;case 4:f="ro_Status_canceled";i[r].StatusDesc=i18nextko.i18n.t("roRequestStatus_canceled");i[r].hasAction=!1}u="";switch(i[r].IdRequestType){case 1:u="dx-icon-userFieldChange";break;case 4:u="dx-icon-externalWorkResume";break;case 5:u="dx-icon-changeShift";break;case 6:u="dx-icon-plannedHoliday";break;case 8:u="dx-icon-shiftExchange";break;case 7:u="dx-icon-plannedAbsences";break;case 11:u="dx-icon-holidaysCancel";break;case 13:u="dx-icon-plannedHoliday";break;case 15:u="dx-icon-externalWorkWeekResume"}i[r].cssContainerClass=f;i[r].cssClass=u;$("#scrollview").height($("#panelsContent").height())}t(i)}else t([]),e=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,e)};i==null?(n(!1),new WebServiceRobotics(function(n){r(n)}).getMyRequests(!1,moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").add(1,"day"),"0*1*2*3*4|1*5*6*7*8*11*13","RequestDate DESC",moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").add(1,"year"))):(n(!0),new WebServiceRobotics(function(n){r(n)}).getMyRequests(!1,i.filter.iDate,i.filter.eDate,i.filter.status.join("*")+"|"+i.filter.types.join("*"),i.order.by+" "+i.order.direction,i.filter.iRequestedDate,i.filter.eRequestedDate))}var u=ko.observable(!1),t=ko.observable([]),i=ko.observable(!1),r=ko.observable("Images/Common/more.png"),n=ko.observable(!1),f=ko.computed(function(){return VTPortal.roApp.requestFilters()!=null?i18nextko.i18n.t("roFilteringData"):""}),o=ko.computed(function(){var t,n;if(VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Requests!=null){for(t=!1,n=0;n<VTPortal.roApp.empPermissions().Requests.length;n++)if(VTPortal.roApp.empPermissions().Requests[n].Permission){t=!0;break}return t}return!1}),h=function(){i(!0);r("Images/Common/moreV.png")},c=function(){r("Images/Common/more.png")},l=function(){i(!1);r("Images/Common/more.png");VTPortal.app.navigate("RequestFilters/0")},a=function(){i(!1);VTPortal.app.navigate("requestsList/1,5,6,7,8,11,13/null")};return{modelIsReady:u,initializeView:e,hasPermission:o,requestsDS:t,dataFiltered:n,filterDescription:f,listRequests:{dataSource:t,scrollingEnabled:!1,grouped:!1,itemTemplate:"RequestItem",onItemClick:function(n){if(n.itemData.hasAction)switch(n.itemData.IdRequestType){case 1:VTPortal.app.navigate("userFields/"+n.itemData.Id);break;case 5:VTPortal.app.navigate("changeShift/"+n.itemData.Id);break;case 6:VTPortal.app.navigate("plannedHoliday/"+n.itemData.Id);break;case 7:VTPortal.app.navigate("plannedAbsence/"+n.itemData.Id);break;case 8:VTPortal.app.navigate("shiftExchange/"+n.itemData.Id);break;case 11:VTPortal.app.navigate("cancelHolidays/"+n.itemData.Id);break;case 13:VTPortal.app.navigate("plannedHoliday/"+n.itemData.Id);break;case 15:VTPortal.app.navigate("externalWorkWeekResume/"+n.itemData.Id)}}},actionMenuPopover:{target:"#btnActionMenuPopover",position:"top",shading:!0,shadingColor:"rgba(0, 0, 0, 0.5)",visible:i,onHidden:c},showOptions:{onClick:h,text:"",icon:r},btnFilterRequests:{onClick:l,text:"",hint:i18nextko.i18n.t("roFilter"),icon:"Images/Common/filter.png"},btnNewRequests:{onClick:a,text:"",hint:i18nextko.i18n.t("roNew"),icon:"Images/Common/plus.png",visible:VTPortal.roApp.ReadMode()==!1},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.myCalendar=function(){function c(n){(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Schedule.QuerySchedule)&&new WebServiceRobotics(function(n){var r,t,u;if(n.Status==window.VTPortalUtils.constants.OK.value){for(r=i(),t=0;t<n.oCalendar.DayData.length;t++)r[moment.tz(n.oCalendar.DayData[t].PlanDate,VTPortal.roApp.serverTimeZone).add(12,"hours").format("YYYYMMDD")]=n.oCalendar.DayData[t];i(r);setTimeout(function(){$("#calendarContainer").dxCalendar("instance").repaint();$("#calendarContainer").height($("#scrollview").height())},100)}else i([]),u=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,u);o=!1},function(){o=!1}).getMyCalendar(n);l(!0)}function g(n,t,i){var r=n.charAt(0)==="#"?n.substring(1,7):n,f=parseInt(r.substring(0,2),16),e=parseInt(r.substring(2,4),16),o=parseInt(r.substring(4,6),16),s=[f/255,e/255,o/255],u=s.map(function(n){return n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4)}),h=.2126*u[0]+.7152*u[1]+.0722*u[2];return h>.7?i:t}function nt(n){var u="",s="#ffffff",r="",t=i()[moment(n.date).format("YYYYMMDD")],f="",h,l,e;return moment(n.date).format("YYYYMMDD")==moment().format("YYYYMMDD")&&(f="actualDate"),h=null,t!=null?(t.MainShift!=null&&(s=t.MainShift.Color),t.IncidenceData!=null&&typeof t.IncidenceData.NormalWork!="undefined"&&t.IncidenceData.NormalWork!=0?(h=t.IncidenceData.NormalWork,t.IncidenceData.NormalWork>0?r="#05580c":t.IncidenceData.NormalWork<0&&(r="#e00032")):t.MainShift!=null&&(r=s,(t.Alerts.OnAbsenceHours||t.Alerts.OnAbsenceDays||t.Alerts.OnHolidays||t.Alerts.OnOvertimesHours||t.Alerts.OnHolidaysHours)&&(t.Alerts.OnAbsenceHours?r="#00f12b":t.Alerts.OnOvertimesHours?r="#0019cc":t.Alerts.OnHolidaysHours?r="#ffa500":t.Alerts.OnAbsenceDays?r="#a400cc":t.Alerts.OnHolidays&&(r="#dc7214")))):o||(o=!0,c(n.date)),l=VTPortalUtils.utils.generateGradientFromColor(t),e=g(s,"#FFFFFF","#000000"),u="height:100%;border-radius: 10%;"+l,r!=""&&(u=u+";border:2px solid "+r),t!=null&&typeof t!="undefined"?VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Telecommuting&&t.TelecommutingExpected==!0?"<div style='width:100%'><div class='CalendarCellDailyLayout'><div style='height:100%' class='innerCalCellTemplate'><div style='"+u+"'> <div class='dx-icon-Cal_TC_Home'><\/div><span class='CalendarCellDailyLayoutText "+f+"' id='"+moment(n.date).format("YYYYMMDD")+"' style='color: "+e+"'>"+n.text+"<\/span><\/div><\/div><\/div>":"<div style='width:100%'><div class='CalendarCellDailyLayout'><div style='height:100%' class='innerCalCellTemplate'><div style='"+u+"'> <span class='CalendarCellDailyLayoutText "+f+"' id='"+moment(n.date).format("YYYYMMDD")+"' style='color: "+e+"'>"+n.text+"<\/span><\/div><\/div><\/div>":"<div style='width:100%'><div class='CalendarCellDailyLayout'><div style='height:100%' class='innerCalCellTemplate'><div style='"+u+"'> <span class='CalendarCellDailyLayoutText "+f+"' id='"+moment(n.date).format("YYYYMMDD")+"' style='color: "+e+"'>"+n.text+"<\/span><\/div><\/div><\/div>"}function v(n,t){var i="";i=t=="office"?i18nextko.i18n.t("roDoRequestFromHome"):i18nextko.i18n.t("roDoRequestFromOffice");VTPortalUtils.utils.questionMessage(i,"info",0,function(){new WebServiceRobotics(function(t){t.Status==window.VTPortalUtils.constants.OK.value?(c(n),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRequestSaved"),"success",2e3)):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t(window.VTPortalUtils.utils.languageTag(t.Status)),"error",0)}).changeTelecommutingByRequest(moment(n).format("YYYY-MM-DD"),t,VTPortal.roApp.impersonatedIDEmployee!=-1)},function(){},i18nextko.i18n.t("roContinue"),i18nextko.i18n.t("roCancel"))}function y(n,t){new WebServiceRobotics(function(t){t.Status==window.VTPortalUtils.constants.OK.value?(c(n),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roTCChanged"),"success",2e3)):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t(window.VTPortalUtils.utils.languageTag(t.Status)),"error",0)}).changeTelecommuting(moment(n).format("YYYY/MM/DD"),t,VTPortal.roApp.impersonatedIDEmployee!=-1)}function tt(n,t){for(var u=0,r=moment(n).startOf("week"),f=moment(n).endOf("week");r<=f;)t.includes(moment(r).day().toString())&&i()[moment(r).format("YYYYMMDD")].TelecommutingExpected==!0&&(u=u+1),r=r.add(1,"days");return u}function it(n,t){for(var u=0,r=moment(n).startOf("month"),f=moment(n).endOf("month");r<=f;)t.includes(moment(r).day().toString())&&i()[moment(r).format("YYYYMMDD")].TelecommutingExpected==!0&&(u=u+1),r=r.add(1,"days");return u}function w(){var t=[],r,e,l,o,c;return VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Telecommuting&&VTPortal.roApp.userStatus().Telecommuting==!0&&i()[moment(n).format("YYYYMMDD")].CanTelecommute==!0&&(moment(n)>=moment().startOf("day")&&(r=[],e=[],i()[moment(n).format("YYYYMMDD")].TelecommutingOptionalDays!=""&&(r=i()[moment(n).format("YYYYMMDD")].TelecommutingOptionalDays.split(",")),i()[moment(n).format("YYYYMMDD")].TelecommutingMandatoryDays!=""&&(e=i()[moment(n).format("YYYYMMDD")].TelecommutingMandatoryDays.split(",")),l=i()[moment(n).format("YYYYMMDD")].TelecommutingMaxOptionalDays,o=i()[moment(n).format("YYYYMMDD")].TelecommutingPeriodType,i()[moment(n).format("YYYYMMDD")].TelecommutingExpected==!0?e.includes(moment(n).day().toString())?s()>=f()&&f()>0?t.push({ID:0,cssClass:"dx-icon-taTelecommuting_OfficeFullCal",cssClassText:"textActionCalendar",Content:i18nextko.i18n.t("roRequestTelecommutingOffice"),Desc:u()}):t.push({ID:1,cssClass:"dx-icon-taTelecommuting_OfficeCal",cssClassText:"textActionCalendar",Content:i18nextko.i18n.t("roRequestTelecommutingOffice"),Desc:u()}):s()>=f()&&f()>0?t.push({ID:0,cssClass:"dx-icon-taTelecommuting_OfficeFullCal",cssClassText:"textActionCalendar",Content:i18nextko.i18n.t("roRequestTelecommutingOffice"),Desc:u()}):t.push({ID:8,cssClass:"dx-icon-taTelecommuting_OfficeCal",cssClassText:"textActionCalendar",Content:i18nextko.i18n.t("roRequestTelecommutingOffice"),Desc:u()}):r.length>0&&r.includes(moment(n).day().toString())?(c=0,c=typeof o=="undefined"||o==0?tt(n,r):it(n,r),c<l?t.push({ID:2,cssClass:"dx-icon-taTelecommuting_HomeCal",cssClassText:"textActionCalendar",Content:i18nextko.i18n.t("roRequestTelecommutingHome"),Desc:u()}):t.push({ID:7,cssClass:"dx-icon-taTelecommuting_HomeCal",cssClassText:"textActionCalendar",Content:i18nextko.i18n.t("roRequestTelecommutingHome"),Desc:u()})):e.length>0&&e.includes(moment(n).day().toString())?t.push({ID:2,cssClass:"dx-icon-taTelecommuting_HomeCal",cssClassText:"textActionCalendar",Content:i18nextko.i18n.t("roRequestTelecommutingHome"),Desc:u()}):e.includes(moment(n).day().toString())||r.includes(moment(n).day().toString())?t.push({ID:7,cssClass:"dx-icon-taTelecommuting_HomeCal",cssClassText:"textActionCalendar",Content:i18nextko.i18n.t("roRequestTelecommutingHome"),Desc:u()}):t.push({ID:7,cssClass:"dx-icon-taTelecommuting_HomeCal",cssClassText:"textActionCalendar",Content:i18nextko.i18n.t("roRequestTelecommutingHome"),Desc:u()})),h()==!0&&t.push({ID:6,cssClass:"dx-icon-taTelecommuting_Capacity",cssClassText:"textActionCalendar",Content:i18nextko.i18n.t("roRequestTelecommutingOfficeWho")})),(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&(VTPortal.roApp.empPermissions().Punch.ScheduleQuery||VTPortal.roApp.empPermissions().Punch.ProductiVQuery))&&t.push({ID:3,cssClass:"dx-icon-taPunches_DetailCal",cssClassText:"textActionCalendar",Content:i18nextko.i18n.t("roPunches_Detail")}),(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().CanCreateRequests)&&VTPortal.roApp.ReadMode()==!1&&t.push({ID:4,cssClass:"dx-icon-taNewRequest_DetailCal",cssClassText:"textActionCalendar",Content:i18nextko.i18n.t("roNewRequest_Detail")}),t.push({ID:5,cssClass:"dx-icon-taInformationCal",cssClassText:"textActionCalendar",Content:i18nextko.i18n.t("roInformationDay")}),p(new DevExpress.data.DataSource({store:t})),t}var i=ko.observable({}),t=ko.observable(null),o=!0,n=moment().toDate(),r=ko.observable(!1),l=ko.observable(!1),rt=ko.observable([]),e=ko.observable(""),s=ko.observable(0),f=ko.observable(0),h=ko.observable(!1),a=ko.observable(null),d=ko.computed(function(){return VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Schedule.QuerySchedule?!0:!1}),u=ko.computed(function(){return e()!=""&&h()==!0?i18nextko.i18n.t("roCurrentCapacity")+": "+e():""}),p=ko.observable(new DevExpress.data.DataSource({})),ut=ko.computed(function(){return t()!=null&&t().MainShift!=null?t().MainShift.Name:""}),ft=ko.computed(function(){return t()!=null&&t().IncidenceData!=null&&typeof t().IncidenceData.NormalWork!="undefined"&&t().IncidenceData.NormalWork!=0?t().IncidenceData.NormalWork:0}),et=ko.computed(function(){return t()!=null&&t().Alerts!=null?t().Alerts.OnAbsenceDays:!1}),ot=ko.computed(function(){return t()!=null&&t().Alerts!=null?t().Alerts.OnAbsenceHours:!1}),st=ko.computed(function(){return t()!=null&&t().Alerts!=null?t().Alerts.OnHolidays:!1}),b=ko.observable("#calendarContainer"),k=function(t){n=t.value;b("#"+moment(t.value).format("YYYYMMDD"));VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Telecommuting&&VTPortal.roApp.userStatus().Telecommuting==!0?new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)s(parseInt(n.capacities.CurrentSeating)),f(parseInt(n.capacities.MaxSeatingCapacity)),typeof n.capacities.ZoneCapacityVisible=="undefined"?h(!0):h(n.capacities.ZoneCapacityVisible),n.capacities.MaxSeatingCapacity>0?e(n.capacities.CurrentSeating+"/"+n.capacities.MaxSeatingCapacity):e(""),a(n.oCalendar),$.when(w()).then(r(!0));else{s(0);f(0);a([]);var t=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}},function(){}).getLoadSeatingCapacity(n):$.when(w()).then(r(!0))};return{onCellClicked:k,modelIsReady:l,initializeView:c,hasPermission:d,calendarOptions:{width:"100%",useCellTemplate:!0,height:450,cellTemplate:nt,firstDayOfWeek:moment()._locale._week.dow,zoomLevel:"month",maxZoomLevel:"month",minZoomLevel:"month",onCellClick:k,showTodayButton:!1},calendarCellPopover:{target:b,position:"top",width:300,shading:!0,shadingColor:"rgba(0, 0, 0, 0.5)",visible:r},dayToolbarActions:{dataSource:p,scrollingEnabled:!1,grouped:!1,itemTemplate:"actionItem",onItemClick:function(t){switch(t.itemData.ID){case 0:VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roTCFull"),"error",2e3);r(!1);break;case 1:r(!1);v(n,"home");break;case 2:r(!1);y(n,"office");break;case 7:r(!1);v(n,"office");break;case 8:r(!1);y(n,"home");break;case 3:r(!1);VTPortal.app.navigate("punchManagement/1/"+moment(n).format("YYYY-MM-DD"));break;case 4:r(!1);VTPortal.app.navigate("requestsList/5,6,7,8,9,11,13,14/"+moment(n).format("YYYY-MM-DD"));break;case 5:r(!1);VTPortal.app.navigate("dayInfo/"+moment(n).format("YYYY-MM-DD"));break;case 6:r(!1);VTPortal.app.navigate("capacityDetail/"+moment(n).format("YYYY-MM-DD"))}}},capacityInfo:e,lblCapacityInfo:u,loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.scheduler=function(n){function y(){var i=moment(n.param);u.modelIsReady(!1);f.modelIsReady(!1);e.modelIsReady(!1);o.modelIsReady(!1);switch(t()){case 1:u.initializeView(i);break;case 2:f.initializeView(i);break;case 3:e.initializeView(i);break;case 4:o.initializeView()}}var t=ko.observable(1),r=ko.observable(0),c,l;typeof n.id!="undefined"&&(t(parseInt(n.id,10)),r(parseInt(n.id,10)-1));var s=ko.observable(VTPortal.bigUserInfo()),a=function(){s().viewShown()},u=VTPortal.myCalendar(),f=VTPortal.myAccruals(),e=VTPortal.myAuthorizations(),o=VTPortal.myRequests(),v=ko.computed(function(){switch(t()){case 1:return i18nextko.i18n.t("roMyCalendarTitle");case 2:return i18nextko.i18n.t("roMyAccrualsTitle");case 3:return i18nextko.i18n.t("roMyAuthorizationsTitle");case 4:return i18nextko.i18n.t("roProfileRequests")}},this),h=ko.observable([]),i=[];return i.push({ID:1,cssClass:"dx-icon-myCalendar",hint:i18nextko.i18n.t("roMyCalendarHint")}),i.push({ID:2,cssClass:"dx-icon-myAccruals",hint:i18nextko.i18n.t("roMyAccrualsHint")}),i.push({ID:3,cssClass:"dx-icon-myAuthorizations",hint:i18nextko.i18n.t("roMyAuthorizationsHint")}),i.push({ID:4,cssClass:"dx-icon-profileRequests",hint:i18nextko.i18n.t("roMyRequestsHint")}),h(i),c=function(n){t(n.ID);y();r(n.ID-1)},l={viewShown:a,title:v,subscribeBlock:s(),myCalendarBlock:u,myAccrualsBlock:f,myAuthorizationsBlock:e,myRequestsBlock:o,selectedView:t,selectedIndex:r,tabPanelOptions:{dataSource:h,selectedIndex:r,itemTemplate:"title",onSelectionChanged:function(n){c(n.addedItems[0])}}},l};VTPortal.surveyDetail=function(n){function u(t){new WebServiceRobotics(function(n){n.oState.Result==window.VTPortalUtils.constants.OK.value?setTimeout(function(){VTPortal.roApp.refreshEmployeeStatus(!1,!1);VTPortal.app.navigate("home",{root:!0})},2e3):setTimeout(function(){DevExpress.ui.notify(i18nextko.t("roSurveySaveError"),"warning",3e3);VTPortal.app.navigate("surveys",{root:!0})},2e3)}).sendSurveyResponse(n.id,VTPortal.roApp.employeeId,t.data)}function f(){t().viewShown();r()}var t=ko.observable(VTPortal.bigUserInfo()),i=ko.observable(),r=function(){new WebServiceRobotics(function(n){if(n.oState.Result==window.VTPortalUtils.constants.OK.value){i(n);Survey.StylesManager.applyTheme("orange");var t=new Survey.Model(n.Survey.Content,"surveyContainer");t.locale="es";t.onComplete.add(u)}else DevExpress.ui.notify(i18nextko.t("roSurveyError"),"warning",3e3),VTPortal.app.navigate("surveys",{root:!0})}).getSurveyById(n.id)};return{viewShown:f,title:i18nextko.i18n.t("roHomeSurvey"),subscribeBlock:t(),surveyModel:i,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),commScroll:{height:"75%",onPullDown:function(){}}}};VTPortal.surveys=function(){function i(){var u=[],o="",i=VTPortal.roApp.userStatus().Surveys,f,e,r;if(i!=null&&i.length>0)for(f="",e="",r=0;r<i.length;r++){var s=moment(),h=moment(i[r].ExpirationDate),c=h.diff(s,"days");i[r].IsMandatory==!0?(f="dx-icon-surveyImportant",e="textCommuniqueNotRead"):(f="dx-icon-surveyNotRead",e="textCommuniqueNotRead");o=i[r].Anonymous==!0?i18nextko.i18n.t("roIsAnonymous"):"";name=i[r].Title;u.push({ID:i[r].Id,cssClass:f,cssClassText:e,Content:i[r].Content,SentOn:moment(i[r].SentOn).format("DD/MM/YYYY"),Subject:i[r].Title,CreatedBy:i[r].CreatedByName,IsAnonymous:o,ExpiresOn:i18nextko.i18n.t("roExpiresOn")+c+i18nextko.i18n.t("roExpiresOnDays")})}return u.length>0?t(!0):t(!1),n(new DevExpress.data.DataSource({store:u,searchOperation:"contains",searchExpr:["Subject","Message","SentOn","CreatedBy"]})),u}function u(){r().viewShown();i()}var t=ko.observable(!1),n=ko.observable(new DevExpress.data.DataSource({searchOperation:"contains",searchExpr:["Subject","Message","SentOn","CreatedBy"]})),r=ko.observable(VTPortal.bigUserInfo());return{viewShown:u,title:i18nextko.t("rosurveysTitle"),subscribeBlock:r(),surveyDS:t,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),commScroll:{height:"70%",onPullDown:function(){i()}},listsurveys:{dataSource:n,scrollingEnabled:!1,grouped:!1,itemTemplate:"surveyItem",onItemClick:function(n){VTPortal.app.navigate("surveyDetail/"+n.itemData.ID)}},searchOptions:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(t){n().searchValue(t.value);n().load()}},allComm:{onClick:i,text:i18nextko.t("roAllComm")}}};VTPortal.myWork=function(){function h(n){t([]);o(n);f(!0)}function l(t){var i="",u="",f="#dcdcdc",e="#dcdcdc",c=90,l=95,p="",y,s,a,h,v;for(moment(t.date).format("YYYYMMDD")==moment().format("YYYYMMDD")&&(p="actualDate"),y=r(),s=null,a=0;a<y.length;a++){if(h=y[a],h.RequestDays!=null&&h.RequestDays.length>0){for(v=0;v<h.RequestDays.length;v++)if(s=moment.tz(h.RequestDays[v].RequestDate,VTPortal.roApp.serverTimeZone).startOf("day").isSame(moment(t.date))?!0:!1,s)break}else s=moment.tz(h.Date1,VTPortal.roApp.serverTimeZone).isSame(moment(t.date))?!0:!1;if(s)break}return s!=null?s&&(f="#ff5c35"):n||(n=!0,o(t.date)),i="width:100%;height:100%;color: "+e+";",i+="background: "+e+";",i+="background: -webkit-radial-gradient(circle closest-side, "+e+" 90%,rgba(255,255,255,0) 95%);",i+="background: -moz-radial-gradient(circle closest-side, "+e+" 90%,rgba(255,255,255,0) 95%);",i+="background: -ms-radial-gradient(circle closest-side, "+e+" 90%,rgba(255,255,255,0) 95%);",i+="background: -o-radial-gradient(circle closest-side, "+e+" 90%,rgba(255,255,255,0) 95%);",i+="background: radial-gradient(circle closest-side at center, "+e+" 90%,rgba(255,255,255,0) 95%);",i+="background-repeat: no-repeat;",i+="background-position: center center;display:table;",u="width:100%;height:100%;min-height:50px;color: #000000;",u+="background: "+f+";",u+="background: -webkit-radial-gradient(circle closest-side, "+f+" "+c+"%,rgba(255,255,255,0) "+l+"%);",u+="background: -moz-radial-gradient(circle closest-side, "+f+" "+c+"%,rgba(255,255,255,0) "+l+"%);",u+="background: -ms-radial-gradient(circle closest-side, "+f+" "+c+"%,rgba(255,255,255,0) "+l+"%);",u+="background: -o-radial-gradient(circle closest-side, "+f+" "+c+"%,rgba(255,255,255,0) "+l+"%);",u+="background: radial-gradient(circle closest-side at center, "+f+" "+c+"%,rgba(255,255,255,0) "+l+"%);",u+="background-repeat: no-repeat;",u+="background-position: center center;display:table;","<div style='width:100%;height:100%;min-height:50px;'><div class='innerCalCellTemplate' style='"+i+"'><div style='display:table-cell;vertical-align:middle'><div id='"+moment(t.date).format("YYYYMMDD")+"' style='"+u+"'> <span class='"+p+"' style='display:table-cell;vertical-align:middle;font-weight:bold'>"+t.text+"<\/span><\/div><\/div><\/div><\/div>"}var f=ko.observable(!1),r=ko.observable([]),i=ko.observable(!1),n=!0,e=ko.observable("#calendarContainer"),t=ko.observable([]),o=function(i){var u=moment(i).year();t().indexOf(u)==-1&&s()?(t().push(u),new WebServiceRobotics(function(t){if(t.Status==window.VTPortalUtils.constants.OK.value)r(t.Requests),setTimeout(function(){$("#calendarContainer").dxCalendar("instance").repaint()},100);else{r([]);var i=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(t,i)}n=!1},function(){t(t().remove(u));n=!1}).getTeleworkingDetail(moment().startOf("day").startOf("year"),moment().startOf("day").endOf("year"))):n=!1},s=ko.computed(function(){return VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Punch.ScheduleQuery?!0:!1}),c=function(){VTPortal.app.navigate("requestsList/4,15")},a=function(n){selectedDay=n.value;e("#"+moment(n.value).format("YYYYMMDD"));i(!0)},u=[];return(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().CanCreateRequests)&&u.push({location:"center",widget:"dxButton",options:{hint:i18nextko.i18n.t("roNewRequest_Detail"),icon:"taNewRequest_Detail",onClick:function(){i(!1);VTPortal.app.navigate("requestsList/4,15/"+moment(selectedDay).format("YYYY-MM-DD"))}}}),u.push({location:"center",widget:"dxButton",options:{hint:i18nextko.i18n.t("roInformation"),icon:"taInformation",onClick:function(){i(!1);VTPortal.app.navigate("teleworking/2/"+moment(selectedDay).format("YYYY-MM-DD"),{target:"current"})}}}),{modelIsReady:f,initializeView:h,hasPermission:s,calendarOptions:{width:"100%",height:450,useCellTemplate:!0,cellTemplate:l,firstDayOfWeek:moment()._locale._week.dow,zoomLevel:"month",maxZoomLevel:"month",minZoomLevel:"month",onCellClick:a,showTodayButton:!1},calendarCellPopover:{target:e,position:"top",width:300,shading:!0,shadingColor:"rgba(0, 0, 0, 0.5)",visible:i},dayToolbarActions:{items:u},newRequest:{onClick:c,text:"",icon:"Images/Common/plus.png",visible:VTPortal.roApp.ReadMode()==!1},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.myWorkDaily=function(){function e(t){n(t);i(!0)}var f=function(n,t){var i=t.targetOffset;i<0?u():i>0&&r()},n=ko.observable(new Date),i=ko.observable(!1),t=ko.observable([]),r=function(){n(moment(n()).subtract(1,"days"))},u=function(){n(moment(n()).add(1,"days"))},o=function(){VTPortal.app.navigate("requestsList/4,15/"+moment(n()).format("YYYY-MM-DD"))},s=ko.computed(function(){return VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Punch.ScheduleQuery?!0:!1}),h=function(n){if(VTPortal.roApp.empPermissions()==null||VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Punch.ScheduleQuery){var i=function(n){var i,r,u,f,e;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=n.Requests,r=0;r<i.length;r++){i[r].Name=i18nextko.i18n.t("roRequestType_"+i[r].RequestType);i[r].hasAction=n.CanCreateRequest?!0:!1;u="";switch(i[r].Status){case 0:u="ro_Status_pending";break;case 1:u="ro_Status_ongoing";break;case 2:u="ro_Status_accepted";break;case 3:u="ro_Status_denied"}f="";switch(i[r].IdRequestType){case 4:f="dx-icon-externalWorkResume";break;case 15:f="dx-icon-externalWorkWeekResume"}i[r].cssContainerClass=u;i[r].cssClass=f}t(i);$("#scrollview").height($("#panelsContent").height()-70)}else t([]),e=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,e)};new WebServiceRobotics(function(n){i(n)}).getMyDailyTeleWorking(moment(n.value).startOf("day"))}};return{modelIsReady:i,initializeView:e,requestsDS:t,hasPermission:s,headerDate:{value:n,pickerType:"rollers",displayFormat:"shortDate",onValueChanged:h},btnPrevious:{icon:"chevronprev",onClick:r},btnNext:{icon:"chevronnext",onClick:u},myEventHandler:f,listOptions:{dataSource:t,grouped:!1,scrollingEnabled:!1,onItemClick:function(n){if(n.itemData.hasAction)switch(n.itemData.IdRequestType){case 4:VTPortal.app.navigate("externalWork/"+n.itemData.Id);break;case 15:VTPortal.app.navigate("externalWorkWeekResume/"+n.itemData.Id)}}},newRequest:{onClick:o,text:"",icon:"Images/Common/plus.png",visible:VTPortal.roApp.ReadMode()==!1},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.myWorkRequests=function(){function e(){s();u(!0);n()?$("#scrollview").height($("#panelsContent").height()-94):$("#scrollview").height($("#panelsContent").height()-70)}function s(){n(!1);var i=VTPortal.roApp.teleWorkingFilters(),r=function(n){var i,r,u,f,e;if(n.Status==window.VTPortalUtils.constants.OK.value){for(i=n.Requests,r=0;r<i.length;r++){i[r].Name=i18nextko.i18n.t("roRequestType_"+i[r].RequestType);i[r].hasAction=n.CanCreateRequest?!0:!1;u="";switch(i[r].Status){case 0:u="ro_Status_pending";break;case 1:u="ro_Status_ongoing";break;case 2:u="ro_Status_accepted";break;case 3:u="ro_Status_denied"}f="";switch(i[r].IdRequestType){case 4:f="dx-icon-externalWorkResume";break;case 15:f="dx-icon-externalWorkWeekResume"}i[r].cssContainerClass=u;i[r].cssClass=f}t(i)}else t([]),e=function(){VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1);VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.processErrorMessage(n,e)};i==null?(n(!1),new WebServiceRobotics(function(n){r(n)}).getMyRequests(!1,moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").add(1,"day"),"0*1*2*3|4,15","RequestDate DESC",moment().startOf("day").startOf("year").add(-6,"month"),moment().startOf("day").add(1,"year"))):(n(!0),new WebServiceRobotics(function(n){r(n)}).getMyRequests(!1,i.filter.iDate,i.filter.eDate,i.filter.status.join("*")+"|"+i.filter.types.join(","),i.order.by+" "+i.order.direction,i.filter.iRequestedDate,i.filter.eRequestedDate))}var u=ko.observable(!1),t=ko.observable([]),i=ko.observable(!1),r=ko.observable("Images/Common/more.png"),n=ko.observable(!1),f=ko.computed(function(){return VTPortal.roApp.teleWorkingFilters()!=null?i18nextko.i18n.t("roFilteringData"):""}),o=ko.computed(function(){return VTPortal.roApp.empPermissions()!=null&&VTPortal.roApp.empPermissions().Requests!=null&&VTPortal.roApp.empPermissions().Requests.length>0&&(VTPortal.roApp.empPermissions().Requests[3].Permission==!0||VTPortal.roApp.empPermissions().Requests[14].Permission==!0)?!0:!1}),h=function(){i(!1);VTPortal.app.navigate("requestsList/4,15/null")},c=function(){i(!0);r("Images/Common/moreV.png")},l=function(){r("Images/Common/more.png")},a=function(){i(!1);r("Images/Common/more.png");VTPortal.app.navigate("RequestFilters/1")};return{modelIsReady:u,initializeView:e,hasPermission:o,requestsDS:t,dataFiltered:n,filterDescription:f,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),listRequests:{dataSource:t,scrollingEnabled:!1,grouped:!1,itemTemplate:"RequestItem",onItemClick:function(n){if(n.itemData.hasAction)switch(n.itemData.IdRequestType){case 4:VTPortal.app.navigate("externalWork/"+n.itemData.Id);break;case 15:VTPortal.app.navigate("externalWorkWeekResume/"+n.itemData.Id)}}},actionMenuPopover:{target:"#btnActionMenuPopover",position:"top",shading:!0,shadingColor:"rgba(0, 0, 0, 0.5)",visible:i,onHidden:l},showOptions:{onClick:c,text:"",icon:r},btnFilterRequests:{onClick:a,text:"",hint:i18nextko.i18n.t("roFilter"),icon:"Images/Common/filter.png"},btnNewRequests:{onClick:h,text:"",hint:i18nextko.i18n.t("roNew"),icon:"Images/Common/plus.png",visible:VTPortal.roApp.ReadMode()==!1},loadingPanel:VTPortalUtils.utils.loadingPanelConf()}};VTPortal.teleworking=function(n){function l(){u().viewShown()}function v(){var i=moment(n.param);f.modelIsReady(!1);e.modelIsReady(!1);o.modelIsReady(!1);switch(t()){case 1:f.initializeView(i);break;case 2:e.initializeView(i);break;case 3:o.initializeView(i)}}var t=ko.observable(1),i=ko.observable(0),u,h,c;typeof n.id!="undefined"&&(t(parseInt(n.id,10)),i(parseInt(n.id,10)-1));u=ko.observable(VTPortal.bigUserInfo());var f=VTPortal.myWork(),e=VTPortal.myWorkDaily(),o=VTPortal.myWorkRequests(),a=ko.computed(function(){switch(t()){case 1:return i18nextko.i18n.t("roMyWorkTitle");case 2:return i18nextko.i18n.t("roMyWorkDaily");case 3:return i18nextko.i18n.t("roMyWorkRequests")}},this),s=ko.observable([]),r=[];return r.push({ID:1,cssClass:"dx-icon-myWork"}),r.push({ID:2,cssClass:"dx-icon-myWorkDaily"}),r.push({ID:3,cssClass:"dx-icon-myWorkRequests"}),s(r),h=function(n){t(n.ID);v();i(n.ID-1)},c={viewShown:l,title:a,subscribeBlock:u(),myWorkBlock:f,myWorkDailyBlock:e,myWorkRequestsBlock:o,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),selectedView:t,selectedIndex:i,tabPanelOptions:{dataSource:s,selectedIndex:i,itemTemplate:"title",onSelectionChanged:function(n){h(n.addedItems[0])}}},c};VTPortal.alerts=function(){var n=ko.observable([]),i=ko.observable(VTPortal.bigUserInfo()),r=function(n){switch(n.itemData.IdNotificationType){case 51:VTPortal.app.navigate("scheduler/1/"+n.itemData.NotificationDate.format("YYYY-MM-DD"),{target:"current"});break;case 52:VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRead"),"success",1e3);t();break;case 75:VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roRead"),"success",1e3);t()}},t=function(){var r,f,u,e,s,o,t;if(i().viewShown(),r=VTPortal.roApp.userStatus().ScheduleStatus,f=[],r!=null){if(u="",e=!0,typeof r.RequestAlerts!="undefined")for(t=0;t<r.RequestAlerts.length;t++){switch(r.RequestAlerts[t].IdRequestType){case 1:u="dx-icon-userFieldChange";break;case 2:u="dx-icon-forbiddenPunch";break;case 3:u="dx-icon-justifyPunch";break;case 4:u="dx-icon-externalWorkResume";break;case 5:u="dx-icon-changeShift";break;case 6:u="dx-icon-plannedHoliday";break;case 7:u="dx-icon-plannedAbsences";break;case 8:u="dx-icon-shiftExchange";break;case 9:u="dx-icon-plannedCauses";break;case 10:u="dx-icon-forbiddenPunch";break;case 11:u="dx-icon-holidaysCancel";break;case 12:u="dx-icon-forbiddenPunch";break;case 13:u="dx-icon-plannedHoliday";break;case 14:u="dx-icon-plannedOvertime";break;case 15:u="dx-icon-externalWorkWeekResume";break;case 16:u="dx-icon-telecommute"}switch(r.RequestAlerts[t].Status){case 0:name=i18nextko.i18n.t("roRequest_pending");break;case 1:name=i18nextko.i18n.t("roRequest_running");break;case 2:name=i18nextko.i18n.t("roRequest_approved");break;case 3:name=i18nextko.i18n.t("roRequest_denied");break;case 4:name=i18nextko.i18n.t("roRequest_canceled")}f.push({ID:r.RequestAlerts[t].IdRequest,IdRequestType:r.RequestAlerts[t].IdRequestType,IdRelatedObject:-1,IdNotificationType:-1,NotificationDate:null,cssClass:u,name:typeof r.RequestAlerts[t].AlertSubject!="undefined"?r.RequestAlerts[t].AlertSubject:name,hasAction:!0,type:"request",description:r.RequestAlerts[t].Description,iDate:null})}if(typeof r.IncompletePunches!="undefined")for(u="dx-icon-incompletePunch",t=0;t<r.IncompletePunches.length;t++)f.push({ID:-1,IdRequestType:-1,IdRelatedObject:-1,IdNotificationType:-1,NotificationDate:null,cssClass:u,name:typeof r.IncompletePunches[t].AlertSubject!="undefined"?r.IncompletePunches[t].AlertSubject:i18nextko.i18n.t("roIncompletePunch"),hasAction:!0,type:"incomplete",description:typeof r.IncompletePunches[t].AlertDescription!="undefined"?r.IncompletePunches[t].AlertDescription:i18nextko.i18n.t("roIncompletePunchAt")+" "+moment.tz(r.IncompletePunches[t].DateTime,VTPortal.roApp.serverTimeZone).format("DD/MM/YYYY"),iDate:moment.tz(r.IncompletePunches[t].DateTime,VTPortal.roApp.serverTimeZone)});if(typeof r.ForecastDocuments!="undefined")for(u="dx-icon-trackingDocuments",t=0;t<r.ForecastDocuments.length;t++)s="days",o=0,r.ForecastDocuments[t].IdHoursAbsence>0?(s="hours",o=r.ForecastDocuments[t].IdHoursAbsence):r.ForecastDocuments[t].IdOvertimeForecast>0?(s="overtime",o=r.ForecastDocuments[t].IdOvertimeForecast):r.ForecastDocuments[t].IdDaysAbsence>0?(s="days",o=r.ForecastDocuments[t].IdDaysAbsence):r.ForecastDocuments[t].IdRequest>0&&(s="request",o=r.ForecastDocuments[t].IdRequest),e=!1,r.ForecastDocuments[t].IDDocument<=0&&(e=!0),f.push({ID:-1,IdDocumentTemplate:r.ForecastDocuments[t].IDDocumentTemplate,IdRelatedObject:o,IdCause:r.ForecastDocuments[t].IdCause,ForecatstType:s,NotificationDate:moment.tz(r.ForecastDocuments[t].DateTime,VTPortal.roApp.serverTimeZone),cssClass:u,name:i18nextko.i18n.t("roTrackingDocument"),hasAction:e,type:"tracking",description:r.ForecastDocuments[t].Description,iDate:null});if(typeof r.SignDocuments!="undefined")for(u="dx-icon-Document_Sign",t=0;t<r.SignDocuments.length;t++)e=!1,r.SignDocuments[t].IDDocument<=0&&(e=!0),f.push({ID:-1,IdDocumentTemplate:r.SignDocuments[t].IDDocumentTemplate,IdRelatedObject:o,NotificationDate:moment.tz(r.SignDocuments[t].DateTime,VTPortal.roApp.serverTimeZone),cssClass:u,name:r.SignDocuments[t].DocumentTemplateName,hasAction:e,type:"sign",description:r.SignDocuments[t].Description,iDate:null});if(typeof r.Notifications!="undefined")for(t=0;t<r.Notifications.length;t++){u="dx-icon-trackingDocuments";switch(r.Notifications[t].IdNotificationType){case 51:u="dx-icon-assignedShift";break;case 75:u="dx-icon-taTelecommuting_Home"}f.push({ID:-1,IdRequestType:-1,IdRelatedObject:r.Notifications[t].IdNotification,IdNotificationType:r.Notifications[t].IdNotificationType,NotificationDate:moment.tz(r.Notifications[t].DateTime,VTPortal.roApp.serverTimeZone),cssClass:u,name:r.Notifications[t].Name,hasAction:e,type:"notification",description:r.Notifications[t].Description,iDate:null})}typeof r.ExpiredDocAlert!="undefined"&&r.ExpiredDocAlert!=null&&(u="dx-icon-expiredDocAlert",f.push({ID:-1,IdRequestType:-1,IdRelatedObject:-1,IdNotificationType:-1,NotificationDate:null,cssClass:u,name:typeof r.ExpiredDocAlert[t].AlertSubject!="undefined"?r.ExpiredDocAlert[t].AlertSubject:i18nextko.i18n.t("roExpiredDocument"),hasAction:!1,type:"expired",description:typeof r.ExpiredDocAlert[t].AlertDescription!="undefined"?r.ExpiredDocAlert[t].AlertDescription:i18nextko.i18n.t("roExpiredDocuments")+" "+moment.tz(r.ExpiredDocAlert[t].DateTime,VTPortal.roApp.serverTimeZone).format("DD/MM/YYYY"),iDate:null}))}n(f)};return{viewShown:t,title:i18nextko.t("roAlertsTitle"),subscribeBlock:i(),alertDS:n,listAlerts:{dataSource:n,scrollingEnabled:!1,grouped:!1,itemTemplate:"AlertItem",onItemClick:function(n){if(n.itemData.hasAction)switch(n.itemData.type){case"tracking":VTPortal.app.navigate("sendLeaveDocument/"+n.itemData.IdDocumentTemplate+"/"+n.itemData.IdRelatedObject+"/"+n.itemData.IdCause+"/"+n.itemData.ForecatstType);break;case"sign":VTPortal.app.navigate("documents");break;case"notification":new WebServiceRobotics(function(t){t.Status==window.VTPortalUtils.constants.OK.value?t.Result?$.when(VTPortal.roApp.loadInitialData(!1,!1,!0,!1,!1)).then(r(n)):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNotificationNotExists"),"error",1e3):VTPortalUtils.utils.processErrorMessage(t)},function(){VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNotificationLoadError"),"error",1e3)}).setNotificationReaded(n.itemData.IdRelatedObject);break;case"request":n.itemData.IdRequestType!=16?(VTPortalUtils.utils.markRequestAsRead(n.itemData.ID),VTPortalUtils.utils.navigateToRequest(n.itemData)):(VTPortalUtils.utils.markRequestAsRead(n.itemData.ID),VTPortal.app.navigate("scheduler/1/"+moment().format("YYYY-MM-DD")));break;case"incomplete":VTPortal.app.navigate("forgottenPunch/-1/"+n.itemData.iDate.format("YYYY-MM-DD"))}}}}};VTPortal.documents=function(){function v(){h().viewShown();e()}function e(){if(t(!1),c()){var n=VTPortal.roApp.documentsFilters(),i=function(n){var t,i,u,r;if(n.Status==window.VTPortalUtils.constants.OK.value){for(t=n.Documents,i=0;i<t.length;i++){t[i].Name=t[i].Title;t[i].TypeName=t[i].DocumentTemplate.Name;t[i].Description=i18nextko.i18n.t("roDocumentDelivered")+" "+moment.tz(t[i].DeliveredDate,VTPortal.roApp.serverTimeZone).format("LL")+" "+moment.tz(t[i].DeliveredDate,VTPortal.roApp.serverTimeZone).format("LT");t[i].hasAction=!0;u=t[i].SignStatus;t[i].SignDesc="";r="";switch(t[i].DocumentTemplate.Scope){case 0:r="dx-icon-Document_EmployeeField";break;case 1:r="dx-icon-Document_EmployeeContract";break;case 2:r="dx-icon-Document_Punch";break;case 3:r="dx-icon-Document_Reason";break;case 4:r="dx-icon-Document_LeaveOrPermission";break;case 5:r="dx-icon-Document_Company";break;case 6:r="dx-icon-Document_Visit"}if(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.DocumentSign&&t[i].DocumentTemplate.RequiresSigning==!0){r="dx-icon-Document_Sign";switch(u){case 1:t[i].SignDesc=i18nextko.i18n.t("roDocumentsStatus")+": "+i18nextko.i18n.t("roDocPending");break;case 2:t[i].SignDesc=i18nextko.i18n.t("roDocumentsStatus")+": "+i18nextko.i18n.t("roDocInProgress");break;case 3:t[i].SignDesc=i18nextko.i18n.t("roDocumentsStatus")+": "+i18nextko.i18n.t("roDocSigned");break;case 4:t[i].SignDesc=i18nextko.i18n.t("roDocumentsStatus")+": "+i18nextko.i18n.t("roDocRejected")}}t[i].cssContainerClass="";t[i].cssClass=r}f(t)}};n==null?(t(!1),new WebServiceRobotics(function(n){i(n)}).getMyDocuments(null,null,"0*1*2*3*4*5*6","DeliveryDate DESC")):(t(!0),new WebServiceRobotics(function(n){i(n)}).getMyDocuments(n.filter.iDate,n.filter.eDate,n.filter.status.join("*"),n.order.by+" "+n.order.direction))}}function w(n,t){var r,f,i;if(typeof cordova!="undefined"&&typeof cordova.InAppBrowser!="undefined"){r=typeof VTPortal.roApp.isMT()!="undefined"&&VTPortal.roApp.isMT().toLowerCase()=="true"?btoa("https://vtportal.visualtime.net/SigningPage.aspx?GUID="+n.GUID+"&MTClient="+VTPortal.roApp.companyID+"&App=1&IdDocument="+t):VTPortal.roApp.isMTApp()==!0?btoa("https://vtportal.visualtime.net/SigningPage.aspx?GUID="+n.GUID+"&MTClient="+VTPortal.roApp.companyID+"&App=1&IdDocument="+t):btoa("https://"+VTPortal.roApp.db.settings.wsURL+"/VTPortal/SigningPage.aspx?GUID="+n.GUID+"&MTClient="+VTPortal.roApp.companyID+"&App=1&IdDocument="+t);var i=n.SignatureViDRemoteURL+"&url_return="+r;adfsLoginAttempts=0;u(!0);b(i,"_blank","usewkwebview=yes,fullscreen=yes,hidespinner=yes,hidden=yes,location=yes,hideurlbar=yes,hidenavigationbuttons=yes,toolbar=no,clearcache=no,clearsessioncache=no")}else o(!0),f=typeof VTPortal.roApp.isMT()!="undefined"&&VTPortal.roApp.isMT().toLowerCase()=="true"?btoa("https://vtportal.visualtime.net/SigningPage.aspx?GUID="+n.GUID+"&MTClient="+VTPortal.roApp.companyID+"&App=0&IdDocument="+t):btoa("http://"+VTPortal.roApp.db.settings.wsURL+"/VTPortal/SigningPage.aspx?GUID="+n.GUID+"&MTClient="+VTPortal.roApp.companyID+"&App=0&IdDocument="+t),i=n.SignatureViDRemoteURL+"&url_return="+f,k(i)}function b(n,t,i){setTimeout(function(){inAppBrowserRef=cordova.InAppBrowser.open(n,t,i);inAppBrowserRef.addEventListener("loadstop",function(){g()});inAppBrowserRef.addEventListener("exit",function(){d()})},3e3)}function k(n){setTimeout(function(){window.open(n,"_self")},5e3)}function d(){u(!1);e()}function g(){VTPortal.roApp.wsRequestCounter()>0&&VTPortal.roApp.wsRequestCounter(0);inAppBrowserRef!=null&&inAppBrowserRef.show();timer=setTimeout(function(){inAppBrowserRef!=null&&inAppBrowserRef.executeScript({code:"returnToMobile()"},l)},3e3)}var f=ko.observable([]),i=ko.observable(!1),r=ko.observable("Images/Common/more.png"),n=ko.observable(),o=ko.observable(!1),u=ko.observable(!1),s=ko.observable(!1),h=ko.observable(VTPortal.bigUserInfo()),a=ko.computed(function(){if(VTPortal.roApp.db.settings.ApiVersion<VTPortalUtils.apiVersion.DocumentSign)return!1;if(typeof n()!="undefined"){if(n().DocumentTemplate.RequiresSigning==!0)return!0}else return!1}),t=ko.observable(!1),y=ko.computed(function(){return VTPortal.roApp.documentsFilters()!=null?i18nextko.i18n.t("roFilteringData"):""}),p=ko.computed(function(){return t()?"95%":"100%"}),c=ko.computed(function(){return!0}),l=function(n){u(!1);n=="1"?(inAppBrowserRef.close(),inAppBrowserRef=null,e()):timer=setTimeout(function(){inAppBrowserRef!=null&&inAppBrowserRef.executeScript({code:"returnToMobile()"},l)},3e3)},nt=function(){i(!1);VTPortal.app.navigate("sendDocument/-1")},tt=function(){i(!0);r("Images/Common/moreV.png")},it=function(){r("Images/Common/more.png")},rt=function(){i(!1);r("Images/Common/more.png");VTPortal.app.navigate("DocumentFilters/1")};return{viewShown:v,title:i18nextko.t("roDocumentsTitle"),subscribeBlock:h(),hasPermission:c,documentsDS:f,requieresSign:a,dataFiltered:t,lblSignInfo:i18nextko.t("roSignInfo"),lblSignInfoApp:i18nextko.t("roSignInfoApp"),showPopupSign:o,showPopupSignApp:u,filterDescription:y,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),signOptions:{dataSource:[{text:"Firmar"},{text:"Descargar"}],visible:s,showTitle:!1,showCancelButton:ko.observable(!0),onItemClick:function(t){t.itemIndex==0?new WebServiceRobotics(function(t){switch(t.Status){case 0:w(t.Value,n().Id);break;case-95:VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoDocumentUploaded"),"info",2e3);break;case-96:VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roInvalidPhoneNumber"),"info",2e3);break;case-97:VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roEmptyFile"),"info",2e3);case-98:VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roDocExceeded"),"info",2e3)}}).uploadDocumenttoSign(n().Id):new WebServiceRobotics(function(n){window.VTPortalUtils.utils.downloadBytes(n.Value)}).getDocumentBytes(n().Id)}},listRequests:{dataSource:f,scrollingEnabled:!0,grouped:!1,itemTemplate:"RequestItem",onItemClick:function(t){t.itemData.hasAction&&(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.DocumentSign?t.itemData.DocumentTemplate.RequiresSigning==!0&&t.itemData.SignStatus==1?(n(t.itemData),s(!0)):new WebServiceRobotics(function(n){window.VTPortalUtils.utils.downloadBytes(n.Value)}).getDocumentBytes(t.itemData.Id):new WebServiceRobotics(function(n){window.VTPortalUtils.utils.downloadBytes(n.Value)}).getDocumentBytes(t.itemData.Id))}},scrollContent:{height:p},showOptions:{onClick:tt,text:"",icon:r},actionMenuPopover:{target:"#btnActionMenuPopover",position:"top",shading:!0,shadingColor:"rgba(0, 0, 0, 0.5)",visible:i,onHidden:it},btnFilterRequests:{onClick:rt,text:"",hint:i18nextko.i18n.t("roFilter"),icon:"Images/Common/filter.png"},btnNewDocument:{onClick:nt,visible:VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.SendDocuments&&VTPortal.roApp.ReadMode()==!1,text:"",hint:i18nextko.i18n.t("roNew"),icon:"Images/Common/plus.png"}}};VTPortal.home=function(n){var ti=ko.observable(new Date),lr=ko.observable([]),ii=VTPortal.summaryHome(),b=VTPortal.notificationsHome(),s=VTPortal.punchesHome(),k=VTPortal.accrualsHome(),at=VTPortal.emptyHome(),st=VTPortal.surveysHome(),d=VTPortal.telecommutingHome(),g=VTPortal.communiquesHome(),vt=ko.observable(VTPortal.bigUserInfo()),r=ko.observable(!1),ht=ko.observable(!1),h=ko.observable(!1),ri=ko.observable(!1),nt=ko.observable(!1),tt=ko.observable(!1),it=ko.observable(!1),rt=ko.observable(!1),ut=ko.observable(!1),v=ko.observable(!1),ft=ko.observable(!1),c=ko.observable(!1),e=ko.observable(""),y=ko.observable(!1),o=ko.observable(!1),l=ko.observable(!1),a=ko.observable(!1),ct=ko.observable(!1),u=ko.observable(!1),et=ko.observable(!1),lt=ko.observable(""),p=ko.observable(""),yt=ko.observable(""),pt=ko.observable(""),ot=ko.observable(!1),ui=ko.computed(function(){return VTPortal.roApp.db.settings.ApiVersion}),fi=ko.computed(function(){if(VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"){var n=VTPortal.roApp.userStatus().Surveys;return n!=null&&typeof n!="undefined"&&n.length>0?!0:!1}return!1}),ei=ko.computed(function(){if(VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"){var n=VTPortal.roApp.userStatus().Telecommuting;return n!=null&&typeof n!="undefined"&&n?!0:!1}return!1}),ar=ko.computed(function(){var n;if(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Communiques&&VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"){for(n=0;n<VTPortal.roApp.userStatus().Communiques.length;++n)VTPortal.roApp.userStatus().Communiques[n].EmployeeCommuniqueStatus[0].AnswerRequired==!0&&VTPortal.roApp.userStatus().Communiques[n].EmployeeCommuniqueStatus[0].Answer==""&&VTPortal.roApp.userStatus().Communiques[n].Communique.MandatoryRead==!0&&VTPortal.roApp.userStatus().Communiques[n].Communique.Archived==!1&&u()==!1&&o(!0);for(n=0;n<VTPortal.roApp.userStatus().Communiques.length;++n)VTPortal.roApp.userStatus().Communiques[n].EmployeeCommuniqueStatus[0].Read==!1&&VTPortal.roApp.userStatus().Communiques[n].Communique.MandatoryRead==!0&&VTPortal.roApp.userStatus().Communiques[n].Communique.Archived==!1&&c(!0)}if(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Surveys&&VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"&&typeof VTPortal.roApp.userStatus().Surveys!="undefined")for(n=0;n<VTPortal.roApp.userStatus().Surveys.length;++n)VTPortal.roApp.userStatus().Surveys[n].IsMandatory==!0&&u()==!1&&VTPortal.roApp.stopShowingSurveysPopup()==!1&&(VTPortal.roApp.stopShowingSurveysPopup(!0),y(!0))}),vr=ko.computed(function(){nt()==!1&&tt()==!1?(o()==!0&&c()==!0?(l(!0),a(!0)):o()==!1&&c()==!0?(l(!1),a(!0)):o()==!0&&c()==!1?(l(!0),a(!1)):(l(!1),a(!1)),y()==!0?ct(!0):ct(!1)):(l(!1),a(!1))}),wt=ko.computed(function(){return!VTPortal.roApp.licenseAccepted()&&VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.LicenseAgreement&&VTPortal.roApp.impersonatedIDEmployee==-1}),oi=ko.computed(function(){return VTPortal.roApp.AnywhereLicense==!0?"display:''":"display:'none'"}),si=ko.computed(function(){return VTPortal.roApp.AnywhereLicense==!0?"display:''":"display:'none'"}),hi=ko.computed(function(){return VTPortal.roApp.licenseConsent()==null?i18nextko.i18n.t("roLicenseText"):VTPortal.roApp.licenseConsent().Message}),bt=ko.computed(function(){return VTPortal.roApp.lastRequestFailed()?i18nextko.i18n.t("roQuickPunchIn"):VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().PresenceStatus=="Inside"?i18nextko.i18n.t("roQuickPunchOut"):i18nextko.i18n.t("roQuickPunchIn"):i18nextko.i18n.t("roQuickPunchIn")}),ci=ko.computed(function(){return i18nextko.i18n.t("ropunchNotAllowed")}),li=ko.computed(function(){return VTPortal.roApp.licenseConsent()==null?!1:!0}),ai=function(n){var t=n.validationGroup.validate();t.isValid&&new WebServiceRobotics(function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.loggedIn=!1,VTPortal.roApp.db.settings.password=p(),VTPortal.roApp.db.settings.save(),lt(""),p(""),yt(""),$("#scrollview").find(".pass").each(function(){$(this).dxValidator("instance").reset()}),nt(!1),window.VTPortalUtils.utils.loginIfNecessary("",function(){VTPortal.roApp.db.settings.onlySupervisor?VTPortal.roApp.redirectAtHome(!1):VTPortal.roApp.redirectAtHome(!0)})):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t(window.VTPortalUtils.utils.languageTag(n.Status)),"error",0)}).changePassword(lt(),p())},vi=function(){ot()&&(VTPortal.roApp.licenseConsent()==null?new WebServiceRobotics(function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.db.settings.licenseAccepted=!0,VTPortal.roApp.db.settings.save(),VTPortal.roApp.licenseAccepted(!0)):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t(window.VTPortalUtils.utils.languageTag(n.Status)),"error",0)}).acceptMyLicense(ot()):new WebServiceRobotics(function(n){n.Status==window.VTPortalUtils.constants.OK.value?(VTPortal.roApp.db.settings.licenseAccepted=!0,VTPortal.roApp.db.settings.save(),VTPortal.roApp.licenseAccepted(!0)):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t(window.VTPortalUtils.utils.languageTag(n.Status)),"error",0)}).acceptConsent(VTPortal.roApp.licenseConsent().Message))},t=function(){VTPortal.roApp.empPermissions()==null||VTPortal.roApp.userStatus()==null?(ft(!1),et(!1)):(VTPortal.roApp.empPermissions().Punch.SchedulePunch&&VTPortal.roApp.userStatus().PunchesEnabled?ft(!0):ft(!1),VTPortal.roApp.empPermissions().Punch.SchedulePunch&&VTPortal.roApp.userStatus().PunchesEnabled||VTPortal.roApp.empPermissions().Punch.ProductiVPunch&&VTPortal.roApp.userStatus().ProductiVEnabled||VTPortal.roApp.empPermissions().Punch.CostCenterPunch&&VTPortal.roApp.userStatus().PunchesEnabled&&VTPortal.roApp.userStatus().CostCenterEnabled?et(!0):et(!1))},yi=function(n){var t=n.validationGroup.validate();t.isValid&&(tt(!1),window.VTPortalUtils.utils.loginIfNecessary(pt(),function(){VTPortal.roApp.db.settings.onlySupervisor?VTPortal.roApp.redirectAtHome(!1):VTPortal.roApp.redirectAtHome(!0)}))},pi=ko.computed(function(){return VTPortal.roApp.impersonatedIDEmployee==-1?i18nextko.i18n.t("roHomeTitle"):i18nextko.i18n.t("roHomeTitle")}),wi=function(){et()==!0?VTPortal.app.navigate("punches"):ut(!0)},bi=function(){VTPortal.app.navigate("requestsList/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15/"+moment(ti.Value).format("YYYY-MM-DD"))},ki=function(){VTPortal.roApp.impersonatedIDEmployee=-1;VTPortal.roApp.db.settings.onlySupervisor?VTPortal.roApp.redirectAtHome(!1):(VTPortal.roApp.selectedTab(2),VTPortal.app.navigate("myteam",{root:!0}));VTPortal.roApp.loadInitialData(!0,!0,!0,!1,!1)},w=function(){},di=function(){var t,i;u(!1);VTPortal.roApp.punchInProgress(!1);s.viewShown();k.viewShown();b.viewShown();VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Communiques&&g.viewShown();VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Telecommuting&&VTPortal.roApp.userStatus().Telecommuting==!0&&d.viewShown();VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Surveys&&st.viewShown();var n=new Date,r=n-VTPortal.roApp.lastOkRefresh(),f=Math.round(r%864e5%36e5/6e4);f>10&&VTPortal.roApp.refreshEmployeeStatus(!0,!0);VTPortal.roApp.lastOkRequests()==null?w():(t=n-VTPortal.roApp.lastOkRequests(),i=Math.round(t%864e5%36e5/6e4),i>10&&w());VTPortal.roApp.clientTimeZone=moment.tz.guess(!0);new WebServiceRobotics(function(){},function(){}).updateServerTimeZone(VTPortal.roApp.clientTimeZone)},kt=function(){u(!1);VTPortal.roApp.punchInProgress(!1);s.viewShown();k.refreshAcc();b.viewShown();VTPortal.roApp.refreshEmployeeStatus(!0,!0);w();t();VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Communiques&&g.viewShown();VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Telecommuting&&VTPortal.roApp.userStatus().Telecommuting==!0&&d.viewShown();VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Surveys&&st.viewShown();VTPortal.roApp.loadInitialData(!1,!0,!1,!1,!1,!1)},gi=function(){e(0);VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Telecommuting?VTPortal.roApp.userStatus().Telecommuting==!0?VTPortal.roApp.userStatus().PresenceStatus=="Inside"?$.when(t()).then(f()):$.when(t()).then(ht(!0)):$.when(t()).then(f()):$.when(t()).then(f())},nr=function(n){new WebServiceRobotics(function(n){n.oState.Result==window.VTPortalUtils.constants.OK.value}).registerFirebaseToken(n,VTPortal.roApp.db.settings.UUID)},tr=function(){FirebasePlugin.getToken(function(n){VTPortal.roApp.FirebaseToken=n;nr(n)})},ir=function(n){VTPortal.roApp.popupZoneVisible(!1);VTPortal.roApp.ZoneSelected(!0);VTPortal.roApp.SelectedZone(n.itemData.Id);f()},rr=function(){if(VTPortal.roApp.nfcEnabled(!1),VTPortal.roApp.nfcPunchInProgress(!1),setTimeout(function(){var i=new Date,o=i-VTPortal.roApp.lastOkRefresh(),h=Math.round(o%864e5%36e5/6e4),f,e,n;(h>10||VTPortal.roApp.documentSent()==!0)&&(VTPortal.roApp.documentSent(!1),VTPortal.roApp.refreshEmployeeStatus(!0,!0));VTPortal.roApp.lastOkRequests()==null?w():(f=i-VTPortal.roApp.lastOkRequests(),e=Math.round(f%864e5%36e5/6e4),e>10&&w());n=0;$("#target").on("mousedown touchstart",function(){$("#btnActionMenuPopover2").addClass("pressing");r(!0);n=setTimeout(gi,1500)}).on("mouseup mouseleave mouseout touchend",function(){$("#btnActionMenuPopover2").removeClass("pressing");r(!1);clearTimeout(n)});u(!1);vt().viewShown();s.viewShown();k.viewShown();at.viewShown();b.viewShown();VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Communiques&&g.viewShown();VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Telecommuting&&VTPortal.roApp.userStatus()!=null&&typeof VTPortal.roApp.userStatus()!="undefined"&&VTPortal.roApp.userStatus().Telecommuting==!0&&d.viewShown();t();wt&&ot(!1)},1e3),VTPortal.roApp.isModeApp()&&VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Firebase)try{tr()}catch(n){}};if(typeof n.id=="undefined")window.VTPortalUtils.utils.loginIfNecessary("",rr);else switch(parseInt(n.id,10)){case 1:nt(!0);break;case 2:tt(!0);break;case 3:VTPortal.roApp.impersonatedIDEmployee=-1;VTPortal.roApp.db.settings.onlySupervisor?VTPortal.roApp.redirectAtHome(!1):VTPortal.roApp.redirectAtHome(!0);VTPortal.roApp.loadInitialData(!0,!0,!0,!1,!1)}var dt=function(n){VTPortal.roApp.ZoneSelected()?typeof n!="undefined"&&n():VTPortal.roApp.empPermissions().MustUseGPS?(h(!0),navigator.geolocation.getCurrentPosition(function(t){var r=VTPortal.roApp.currentLocationInfo();r.coords[0]!=t.coords.latitude||r.coords[1]!=t.coords.longitude||r.reliable==!1||r.location=="-"?(geocoder=new google.maps.Geocoder,geocoder.geocode({address:t.coords.latitude+","+t.coords.longitude,language:"es"},function(r,u){var f=VTPortal.roApp.currentLocationInfo();if(u==google.maps.GeocoderStatus.OK){for(i=0;i<r[0].address_components.length;i++)if(r[0].address_components[i].types[0]=="locality")try{f.location=r[0].address_components[i].long_name}catch(e){f.location="API Error parsing city"}try{f.fullAddress=r[0].formatted_address}catch(e){f.fullAddress="API Error parsing address"}f.coords=[t.coords.latitude,t.coords.longitude];f.reliable=!0;VTPortal.roApp.currentLocationInfo(f)}else f=VTPortal.roApp.currentLocationInfo(),f.coords[0]=0,f.coords[1]=0,f.location="API Error parsing city",f.fullAddress="API Error parsing address",f.reliable=!1,VTPortal.roApp.currentLocationInfo(f);h(!1);n()})):(h(!1),n())},function(t){var i;h(!1);t.code==1?(i=VTPortal.roApp.currentLocationInfo(),i.coords[0]=0,i.coords[1]=0,i.location="API Error parsing city",i.fullAddress="API Error parsing address",i.reliable=!1,VTPortal.roApp.gpsEmployeePermission(!1)):t.message.indexOf("Only secure origins are allowed")==0?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("chromeGeolocationAccessForbidden"),"error",0):(i=VTPortal.roApp.currentLocationInfo(),i.coords[0]=0,i.coords[1]=0,i.location="API Error parsing city",i.fullAddress="API Error parsing address",i.reliable=!1,VTPortal.roApp.currentLocationInfo(i),VTPortal.roApp.gpsEmployeePermission(!0));typeof n!="undefined"&&n()},{timeout:1e4})):(h(!1),typeof n!="undefined"&&n())},gt=function(){VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):(VTPortal.roApp.punchInProgress(!0),VTPortal.roApp.userStatus().PresenceStatus=="Inside"?window.VTPortalUtils.utils.doPunch("ta",{idCause:-1,direction:"S",fast:!0,tcType:e()}):window.VTPortalUtils.utils.doPunch("ta",{idCause:-1,direction:"E",fast:!0,tcType:e(),selectedZone:VTPortal.roApp.SelectedZone()}))},ur=function(n,t){n=="S"?t==!0&&(v(i18nextko.i18n.t("roQuickPunchOutDone")),it(!0),s.viewShown()):t==!0&&(v(i18nextko.i18n.t("roQuickPunchInDone")),it(!0),s.viewShown())},f=function(){$("#btnActionMenuPopover2").removeClass("pressing");r(!1);ft()==!0?VTPortal.roApp.empPermissions().MustUseGPS?dt(gt):dt(gt):ut(!0)},fr=ko.computed(function(){var n=[];return n.push({text:i18nextko.i18n.t("roOffice"),type:"success",cssClassText:"textPunchOption",ImageSrc:"Images/icons8-office-48.png"}),n.push({text:i18nextko.i18n.t("roHome"),type:"success",cssClassText:"textPunchOption",ImageSrc:"Images/icons8-home-48.png"}),n}),er=function(){it(!1)},or=function(){$("#btnActionMenuPopover2").removeClass("pressing");r(!1);rt(!1)},sr=function(){ut(!1)},hr=function(){c(!1);o(!1);VTPortal.roApp.db.settings.supervisorPortalEnabled?(VTPortal.roApp.selectedTab(5),VTPortal.app.navigate("communiques",{root:!0})):(VTPortal.roApp.selectedTab(4),VTPortal.app.navigate("communiques",{root:!0}))},cr=function(){y(!1);u(!0);VTPortal.app.navigate("surveys",{root:!0})},ni={commitPunchResponse:ur,title:pi,subscribeBlock:vt(),summaryHome:ii,notificationsHome:b,punchesHome:s,accrualsHome:k,emptyHome:at,communiquesHome:g,surveysHome:st,telecommutingHome:d,popupChangePwdVisible:nt,lblOldPwd:i18nextko.t("lblOldPwd"),lblNewPwd:i18nextko.t("lblNewPwd"),lblPunchDone:v,lblPunchNotAllowed:i18nextko.t("ropunchNotAllowed"),lblNewPwdRepeat:i18nextko.t("lblNewPwdRepeat"),punchOptions:{dataSource:fr,visible:ht,showTitle:!1,title:"Desde dnde trabajars hoy?",showCancelButton:ko.observable(!1),itemTemplate:function(n,t,i){var r;t==0?(r=$("<div>").attr("class","listMenuItemContentPunchOptions"),r.append($("<img>").attr("src",n.ImageSrc).attr("class","listMenuItemIcon EmployeeImagePhoto")),r.append($("<div>").attr("class",n.cssClassText).text(n.text)),i.append(r)):(r=$("<div>").attr("class","listMenuItemContentPunchOptions"),r.append($("<img>").attr("src",n.ImageSrc).attr("class","listMenuItemIcon EmployeeImagePhoto")),r.append($("<div>").attr("class",n.cssClassText).text(n.text)),i.append(r))},onItemClick:function(n){if(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.NewRequests)if(n.itemIndex==0){e(0);var t=Object.clone(VTPortal.roApp.currentLocationInfo(),!0);!t.reliable&&VTPortal.roApp.empPermissions().MustSelectZone&&VTPortal.roApp.empPermissions().MustUseGPS||VTPortal.roApp.empPermissions().MustSelectZone&&!VTPortal.roApp.empPermissions().MustUseGPS?VTPortal.roApp.empPermissions().MustUseGPS?VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("errorGettingGPSNew"),"info",0,function(){VTPortal.roApp.loadZones();VTPortal.roApp.popupZoneVisible(!0)},function(){VTPortal.roApp.redirectAtHome()},i18nextko.i18n.t("roSelectZone"),i18nextko.i18n.t("roCancel")):(VTPortal.roApp.loadZones(),VTPortal.roApp.popupZoneVisible(!0)):f()}else e(1),f();else n.itemIndex==0?e(0):e(1),f()}},listZones:{dataSource:VTPortal.roApp.zonesDataSource,scrollingEnabled:!0,height:300,grouped:!1,itemTemplate:"RequestItem",onItemClick:ir},searchOptions:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(n){VTPortal.roApp.zonesDataSource().searchValue(n.value);VTPortal.roApp.zonesDataSource().load()}},doPunch:{onClick:function(){$.when(t()).then(wi())},visible:ko.computed(function(){return VTPortal.roApp.impersonatedIDEmployee==-1}),text:i18nextko.t("roPunchButton")},dxholdHandler:function(){$.when(t()).then(f())},quickPunchFailed:{onClick:function(){v(i18nextko.i18n.t("roHoldToPunch"));rt(!0)},text:bt,visible:ko.computed(function(){return VTPortal.roApp.impersonatedIDEmployee==-1})},quickPunch:{onClick:function(){$("#btnActionMenuPopover2").removeClass("pressing");r(!1);ht()==!1&&(v(i18nextko.i18n.t("roHoldToPunch")),rt(!0))},text:bt,visible:ko.computed(function(){return VTPortal.roApp.impersonatedIDEmployee==-1})},quickPunchCss:ko.computed(function(){return VTPortal.roApp.lastRequestFailed()?"quickPunchCssIn":VTPortal.roApp.userStatus()!=null?VTPortal.roApp.userStatus().PresenceStatus=="Inside"?"quickPunchCssOut":"quickPunchCssIn":"quickPunchCssIn"}),goBack:{onClick:ki,text:i18nextko.t("lblGoBack"),visible:ko.computed(function(){return VTPortal.roApp.impersonatedIDEmployee!=-1})},punchNotAllowed:{text:ci},request:{onClick:bi,visible:ko.computed(function(){return VTPortal.roApp.impersonatedIDEmployee==-1}),text:i18nextko.t("roRequestButton")},txtOldPwd:{placeholder:i18nextko.t("roPH_oldPwd"),value:lt,mode:"password"},txtNewPwd:{placeholder:i18nextko.t("roPH_newPwd"),value:p,mode:"password"},txtNewPwdRepeat:{placeholder:i18nextko.t("roPH_newPwdRepeat"),value:yt,mode:"password"},btnChangePwd:{validationGroup:"changePwd",onClick:ai,text:i18nextko.t("roChangePwd")},requieredOldField:{validationGroup:"changePwd",validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]},requieredNewField:{validationGroup:"changePwd",validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]},compareField:{validationGroup:"changePwd",validationRules:[{type:"compare",comparisonType:"==",comparisonTarget:p,message:i18nextko.i18n.t("roPasswordsNotMatch")}]},popupValidationCodeVisible:tt,quickPunchDone:it,quickPunchFailed:rt,punchNotAllowedVisible:ut,lblValidationCode:i18nextko.t("lblValidationCode"),txtValidationCode:{placeholder:i18nextko.t("roPH_ValidationCode"),value:pt,mode:"password"},requieredValidationField:{validationGroup:"validationCode",validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]},btnAcceptValidationCode:{validationGroup:"validationCode",onClick:yi,text:i18nextko.t("sendMsg")},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),progressPanel:{message:i18nextko.t("roKeepPushing"),showPane:!0,height:150,shading:!1,delay:200,shadingColor:"rgba(0,0,0,0)",indicatorSrc:"Images/Ripple1.gif",visible:r},progressPanelLoc:{message:i18nextko.t("roLocalizating"),showPane:!0,shading:!1,height:150,shadingColor:"rgba(0,0,0,0)",indicatorSrc:"Images/Ripple1.gif",visible:h},licenceViewContent:{bounceEnabled:!0,showScrollbar:"always",height:200},homeContent:{bounceEnabled:!0,onPullDown:function(n){kt();n.component.release()}},lblTermsAndContidions:i18nextko.t("roTermsAndConditions"),lblWhereAreYou:i18nextko.t("lblWhereAreYou"),customConsent:li,lbllicenseText:hi,lbllicenseAdv1:i18nextko.t("roAgreement1"),lbllicenseAdv2:i18nextko.t("roAgreement2"),lbllicenseAdv2Visibile:oi,lbllicenseAdv3:i18nextko.t("roAgreement3"),lbllicenseAdv3Visibile:si,licenseVisible:wt,ListZonesVisible:VTPortal.roApp.popupZoneVisible,lblmandatoryCommuniques:i18nextko.t("roMandatoryCommuniques"),lblmandatorySurveys:i18nextko.t("roMandatorySurveys"),lblmandatoryAnswer:i18nextko.t("roMandatoryAnswer"),ApiVersion:ui,HasSurveys:fi,TelecommutingEnabled:ei,ckLicenceAccepted:{text:i18nextko.t("roLicenseAccept"),value:ot,disabled:ri},btnAcceptLicense:{onClick:vi,text:i18nextko.t("roSaveLicense")},btnAccept:{onClick:er,text:i18nextko.t("closeConfig")},btnAcceptFailed:{onClick:or,text:i18nextko.t("closeConfig")},btnAcceptPunch:{onClick:sr,text:i18nextko.t("closeConfig")},btnMandatorySurvey:{onClick:cr,text:i18nextko.t("roGoNow")},btnMandatoryCommunique:{onClick:hr,text:i18nextko.t("roGoNow")},btnAnswerLaterSurvey:{onClick:function(){u(!0);y(!1)},text:i18nextko.t("roGoLater")},btnAnswerLater:{onClick:function(){u(!0);o(!1)},text:i18nextko.t("roGoLater")},actionMenuPopover:{target:"#btnActionMenuPopover2",shading:!1,width:300,shadingColor:"rgba(0, 0, 0, 0.1)",visible:VTPortal.roApp.showPopover},quickPunchHelp:i18nextko.t("roquickPunchHelp"),refresh:kt,punchAllowedCalc:t,resume:di,showPopupSurveys:ct,showPopupCommuniques:a,showPopupAnswer:l,hasMandatoryCommuniques:c,hasMandatorySurveys:y,hasMandatoryAnswer:o,startProgressImage:function(){$("#btnActionMenuPopover2").addClass("pressing");r(!0)},endProgressImage:function(){$("#btnActionMenuPopover2").removeClass("pressing");r(!1)}};return VTPortal.roApp.homeView=ni,ni};VTPortal.loading=function(){function n(){setTimeout(function(){VTPortal.roApp.loadInitialData(!0,!0,!0,!0,!0,function(){VTPortal.roApp.db.settings.onlySupervisor?VTPortal.roApp.redirectAtHome(!1):VTPortal.roApp.redirectAtHome(!0)})},500)}return{viewShown:n,loadingPanel:{message:i18nextko.i18n.t("roApplyingLanguage"),showPane:!0,shading:!0,height:150,shadingColor:"rgba(0,0,0,0)",indicatorSrc:"Images/loader_v4.gif",visible:!0}}};VTPortal.login=function(){function di(n){setTimeout(function(){window.open(n,"_self")},5e3)}function ii(n){if(typeof cordova!="undefined"&&typeof cordova.InAppBrowser!="undefined")wt=0,r=cordova.InAppBrowser.open(n,"_blank","usewkwebview=yes,fullscreen=yes,hidespinner=yes,hidden=yes,location=no,hideurlbar=yes,hidenavigationbuttons=yes,toolbar=no,clearcache=no,clearsessioncache=no"),r.addEventListener("loadstop",function(){gi(!0)});else di(n)}var r=null,at=-1,u=VTPortal.roApp.userName,i=ko.observable(""),ot=VTPortal.roApp.mtServer,t=VTPortal.roApp.configWS,s=VTPortal.roApp.configSSL,f=ko.observable(window.VTPortal.roApp.getLanguageByID(VTPortal.roApp.db.settings.language)),hi=ko.observable(!1),ci=ko.observable(""),li=ko.observable("error"),n="",ut=null,vt=ko.observable("password"),h=ko.observable(i18nextko.i18n.t("user")),st=ko.observable(i18nextko.i18n.t("configuration")),c=ko.observable(i18nextko.i18n.t("client")),l=ko.observable(i18nextko.i18n.t("username")),a=ko.observable(i18nextko.i18n.t("pwd")),v=ko.observable(i18nextko.i18n.t("password")),y=ko.observable(i18nextko.i18n.t("lng")),p=ko.observable(i18nextko.i18n.t("sendMsg")),w=ko.observable(i18nextko.i18n.t("sendSSOLogin")),b=ko.observable(i18nextko.i18n.t("recoverPwd")),k=ko.observable(i18nextko.i18n.t("roRecoverTitle")),d=ko.observable(i18nextko.i18n.t("roRecoverUserName")),g=ko.observable(i18nextko.i18n.t("roRecoverEmail")),nt=ko.observable(i18nextko.i18n.t("roRecoverFullInfo")),tt=ko.observable(i18nextko.i18n.t("roNextStep")),yt=ko.observable(!0),pt=ko.observable(!0),e=ko.observable(!1),ri=ko.observable(!0),ui=ko.observable(!0),ft=ko.observable(!0),wt=0,ct=ko.observable(""),dt=ko.observable(""),o=ko.observable(!1),gt=ko.observable(!1),it=ko.observable(!1),bt=ko.observable(!1),ni=ko.observable(""),kt=ko.observable(""),ai=ko.computed(function(){return Cookies.get("IsMT")=="True"?"True":"False"}),ht=ko.computed(function(){var i,n;return VTPortal.roApp.isModeApp()?!0:(i=Cookies.get("VTPortalApi"),i!=null&&i!=""?(i=decodeURIComponent(i),n=i.replace("https://","").replace("http://",""),n=n.substr(0,n.indexOf("/")),VTPortal.roApp.configWS(n),i.toLowerCase().indexOf("https://")==-1?VTPortal.roApp.configSSL(!1):VTPortal.roApp.configSSL(!0)):(n=window.location.href.toLowerCase().replace("https://","").replace("http://",""),n=n.substr(0,n.indexOf("/")),VTPortal.roApp.db.settings.wsURL=t(n),window.location.href.toLowerCase().indexOf("https://")==-1?s(!1):s(!0)),!1)}),ti=function(){VTPortal.roApp.automaticLogin=!0;rt(!0)},vi=function(){ei()},yi=function(){FirebasePlugin.grantPermission(function(n){n;console.log("Permission was "+(n?"granted":"denied"))})},et=function(){var r,t;typeof VTPortal.roApp.isMT()!="undefined"&&VTPortal.roApp.isMT().toLowerCase()=="true"&&(VTPortal.roApp.companyID=ot(),VTPortal.roApp.db.companyID=VTPortal.roApp.companyID);r=DevExpress.validationEngine.getGroupConfig("validationCode").validate();VTPortal.roApp.db.settings.isUsingAdfs&&VTPortal.roApp.db.settings.adfsCredential==""?(VTPortal.roApp.wsRequestCounter(0),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roLoginFromWeb"),"info",0)):(r.isValid||VTPortal.roApp.db.settings.isUsingAdfs&&VTPortal.roApp.db.settings.adfsCredential!="")&&(VTPortal.roApp.db.settings.wsURL=n,VTPortal.roApp.db.settings.isSSL=ut,VTPortal.roApp.db.settings.login=u().trim(),VTPortal.roApp.db.settings.language=f().ID,VTPortal.roApp.db.settings.companyID=ot().trim(),VTPortal.roApp.db.settings.MT=localStorage.getItem("IsMT")=="true"?!0:!1,VTPortal.roApp.db.settings.isUsingAdfs||VTPortal.roApp.db.settings.adfsCredential!=""?(VTPortal.roApp.automaticLogin=!1,VTPortal.roApp.db.settings.isUsingAdfs&&VTPortal.roApp.db.settings.adfsCredential!=""&&(t=VTPortal.roApp.db.settings.adfsCredential.decodeBase64().split("#"),VTPortal.roApp.guidToken=t[0],VTPortal.roApp.securityToken=t[1],t.length>2&&(VTPortal.roApp.companyID=t[2]),VTPortal.roApp.setLanguage(f().tag),VTPortal.roApp.db.settings.save(),new WebServiceRobotics(function(n){var t=function(){VTPortal.roApp.automaticLogin=!0;VTPortal.roApp.db.settings.password=i().trim();VTPortal.roApp.setLanguage(f().tag);VTPortal.roApp.redirectAtHome()};window.VTPortalUtils.utils.onCheckUserSession(n,t,f().ID)},function(n){window.VTPortalUtils.utils.onLoginErrorFunc(n)}).getLoggedInUserInfo())):new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value&&n.Token!=null){if(VTPortal.roApp.db.settings.password=i().trim(),VTPortal.roApp.setLanguage(f().tag),localStorage.setItem("ApiVersion",n.ApiVersion),VTPortal.roApp.isModeApp()&&n.ApiVersion>=VTPortalUtils.apiVersion.Firebase)try{FirebasePlugin.hasPermission(function(n){n||yi()})}catch(t){}typeof n.ServerTimezone!="undefined"&&(VTPortal.roApp.serverTimeZone=n.ServerTimezone,VTPortal.roApp.serverTimeZone!=VTPortal.roApp.db.settings.serverTimezone&&(VTPortal.roApp.db.settings.serverTimezone=VTPortal.roApp.serverTimeZone));VTPortal.roApp.db.settings.ApiVersion!=n.ApiVersion&&(VTPortal.roApp.db.emptyViewsCatalogs(),VTPortal.roApp.db.settings.ApiVersion=n.ApiVersion);typeof n.Consent!="undefined"&&VTPortal.roApp.licenseConsent(n.Consent);VTPortal.roApp.licenseAccepted()!=n.LicenseAccepted&&(VTPortal.roApp.db.settings.licenseAccepted=n.LicenseAccepted,VTPortal.roApp.licenseAccepted(n.LicenseAccepted));typeof n.IsSaas!="undefined"&&VTPortal.roApp.isSaas(n.IsSaas);moment(n.LastLogin).year()!=2079&&VTPortal.roApp.LastLogin(n.LastLogin);VTPortal.roApp.automaticLogin=!0;VTPortal.roApp.securityToken=n.Token;VTPortal.roApp.loggedIn=!0;VTPortal.roApp.userId=n.UserId;VTPortal.roApp.AnywhereLicense=n.AnywhereLicense;VTPortal.roApp.RequiereFineLocation=typeof n.RequiereFineLocation!="undefined"?n.RequiereFineLocation:!0;VTPortal.roApp.ShowForbiddenSections=typeof n.ShowForbiddenSections!="undefined"?n.ShowForbiddenSections:!0;VTPortal.roApp.showLogoutHome(typeof n.ShowLogoutHome!="undefined"?n.ShowLogoutHome:!0);VTPortal.roApp.isAD=n.IsAD;VTPortal.roApp.db.settings.showForbiddenSections=VTPortal.roApp.ShowForbiddenSections;VTPortal.roApp.db.settings.showLogoutHome=n.ShowLogoutHome;VTPortal.roApp.db.settings.isAD=n.IsAD;VTPortal.roApp.db.settings.AnywhereLicense=n.AnywhereLicense;VTPortal.roApp.db.settings.RequiereFineLocation=typeof n.RequiereFineLocation!="undefined"?n.RequiereFineLocation:!0;VTPortal.roApp.employeeId=typeof n.EmployeeId!="undefined"?n.EmployeeId:-1;VTPortal.roApp.db.settings.onlySupervisor=VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.SupervisorPortal&&VTPortal.roApp.employeeId==-1?!0:!1;VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.SupervisorPortal&&(VTPortal.roApp.db.settings.supervisorPortalEnabled=n.SupervisorPortalEnabled);VTPortal.roApp.db.settings.save();setTimeout(function(){VTPortal.roApp.loadInitialData(!0,!0,!0,!0,!0);VTPortal.roApp.redirectAtHome();i("")},200)}else VTPortal.roApp.automaticLogin=!1,VTPortalUtils.utils.processSecurityMessage(n),VTPortal.roApp.db.settings.password=i().trim()}).login(u().trim(),i().trim(),f().ID,VTPortal.roApp.infoVersion,"",!0))},lt=function(){var i=DevExpress.validationEngine.getGroupConfig("requestRecover").validate();i.isValid&&(pt()==!0&&(pt(!1),n=t().trim()),ut=s(),new WebServiceRobotics(function(n){n.Status==window.VTPortalUtils.constants.OK.value?(bt(!1),pt(!0),gt(!0),$("#txtRequestKey :input").focus()):VTPortalUtils.utils.processErrorMessage(n,function(){})},function(){if(ht()){var i=t().split(".");i.length==3&&t().trim().indexOf(".visualtime.net")<0?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNotValidVisualTimeServer"),"error",0,function(){}):e()==!1?n.trim().indexOf(".visualtime.net")>0&&n.trim().indexOf("-vtportal.visualtime.net")<0?(n=n.replace(".visualtime.net","-vtportal.visualtime.net"),e(!0),lt()):n.trim().indexOf(".visualtime.net")>0&&n.trim().indexOf("-vtportal.visualtime.net")>0?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNotValidVisualTimeServer"),"error",0,function(){n=n.replace("-vtportal.visualtime.net",".visualtime.net");n=n.replace(".visualtime.net","")}):i.length==1&&n!=""?(n=t().concat(".visualtime.net"),lt()):i.length==3&&n!=""&&n.trim().indexOf(".visualtime.net")<0&&n.trim().indexOf("-vtportal.visualtime.net")<0?(n=n.concat(".visualtime.net"),lt()):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNotValidVisualTimeServer"),"error",0,function(){n=n.replace("-vtportal.visualtime.net",".visualtime.net");n=n.replace(".visualtime.net","")}):(e(!1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNotValidVisualTimeServer"),"error",0,function(){n=n.replace("-vtportal.visualtime.net",".visualtime.net");n=n.replace(".visualtime.net","")}))}else VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNotValidVisualTimeServer"),"error",0,function(){})},n,ut).recoverPassword(ct().trim(),dt().trim()))},fi=function(){var t=DevExpress.validationEngine.getGroupConfig("setRecoveredPwd").validate();t.isValid&&new WebServiceRobotics(function(n){n.Status==window.VTPortalUtils.constants.OK.value?(bt(!1),gt(!1),u(ct()),i(kt()),ni(""),kt(""),ct(""),dt(""),ti()):VTPortalUtils.utils.processErrorMessage(n,function(){})},function(){},n,ut).resetPasswordToNew(ct().trim(),ni().trim(),kt().trim())},pi=function(){o(!0);e(!1);yt(!0);$("#txtServerLocation :input").focus()},wi=function(){it(!0);$("#txtClientLocation :input").focus()},bi=function(){yt(!0);e(!1);rt(!1)},ki=function(){VTPortal.roApp.companyID=ot();rt(!1)},ei=function(){localStorage.setItem("adfsLoginInprogress","true");VTPortal.roApp.adfsLoginInprogress=!0;VTPortal.roApp.db.settings.isUsingAdfs=!0;VTPortal.roApp.adfsEnabled(!0);o(!1);it(!1);VTPortal.roApp.wsRequestCounter(VTPortal.roApp.wsRequestCounter()+1);typeof VTPortal.roApp.isMT()!="undefined"&&VTPortal.roApp.isMT().toLowerCase()=="true"?n.toLowerCase().indexOf("vtportaldev")!=-1?(n=n.toLowerCase().replace("vtportaldev","vtlivedev"),ii("http"+(s()==!0?"s":"")+"://vtlivedev-idi01.azurewebsites.net/VTLogin/VTPortalLogin.aspx?isApp="+(ht()?"1":"0")+"&referer="+VTPortal.roApp.companyID+"&_="+(new Date).getMilliseconds())):ii("http"+(s()==!0?"s":"")+"://vtlive.visualtime.net/VTLogin/VTPortalLogin.aspx?isApp="+(ht()?"1":"0")+"&referer="+VTPortal.roApp.companyID+"&_="+(new Date).getMilliseconds()):ii("http"+(s()==!0?"s":"")+"://"+n+"/VTLive/VTLogin/VTPortalLogin.aspx?isApp="+(ht()?"1":"0")+"&referer="+VTPortal.roApp.companyID+"&_="+(new Date).getMilliseconds())},rt=function(r){yt()==!0&&(yt(!1),n=t().trim());ut=s();var f=n.split("."),h=n.split(":");typeof VTPortal.roApp.isMT()!="undefined"&&VTPortal.roApp.isMT().toLowerCase()=="true"&&(VTPortal.roApp.companyID=ot(),VTPortal.roApp.companyID=VTPortal.roApp.companyID.toLowerCase(),VTPortal.roApp.db.settings.companyID=VTPortal.roApp.companyID);new WebServiceRobotics(function(t){if(t.Status==window.VTPortalUtils.constants.OK.value)if(typeof t.ApiVersion!="undefined"?(localStorage.setItem("ApiVersion",t.ApiVersion),VTPortal.roApp.db.settings.ApiVersion=t.ApiVersion):VTPortal.roApp.db.settings.ApiVersion=0,n.trim().indexOf("vtportal.visualtime.net")>=0?(VTPortal.roApp.db.settings.MT=!0,VTPortal.roApp.db.settings.wsURL=n,VTPortal.roApp.db.settings.isSSL=ut,localStorage.setItem("IsMT",VTPortal.roApp.db.settings.MT),VTPortal.roApp.db.settings.saveParameter("wsURL",function(){var n=window.location.href.substr(0,window.location.href.indexOf("index.html"));n=n.replace("1/","index.html");document.location.href=n})):(VTPortal.roApp.db.settings.MT=!1,localStorage.setItem("IsMT",VTPortal.roApp.db.settings.MT)),VTPortal.roApp.connectedToMT(!1),ui(!t.Result),t.Result==!0&&(t.SSOmixedModeEnabled==undefined||t.SSOmixedModeEnabled==!1))if(t.SSOmixedModeEnabled!=undefined?ft(!t.SSOmixedModeEnabled):ft(!1),VTPortal.roApp.adfsLoginInprogress){if(VTPortal.roApp.db.settings.adfsCredential==""){localStorage.setItem("adfsLoginInprogress","false");VTPortal.roApp.adfsLoginInprogress=!1;VTPortal.roApp.db.settings.isUsingAdfs=!1;VTPortal.roApp.db.settings.adfsCredential="";VTPortal.roApp.db.settings.save();var f=Cookies.get("VTPortalAdfsUserName"),e="Usuario no reconocido";f!=null&&f!=""&&(e=f+" no existe en VisualTime",Cookies.remove("VTPortalAdfsUserName"));VTPortalUtils.utils.notifyMesage(e,"error",0,function(){})}}else VTPortal.roApp.automaticLogin==!0&&ei();else ft(!1),typeof t.SSOServerEnabled!="undefined"&&t.SSOServerEnabled==!0&&t.SSOUserLoggedIn==!0?(VTPortal.roApp.ssoEnabled(!0),VTPortal.roApp.ssoUserName(t.SSOUserName),r||(u(VTPortal.roApp.ssoUserName()),i(VTPortal.roApp.ssoUserName().toLowerCase()))):(VTPortal.roApp.ssoEnabled(!1),VTPortal.roApp.ssoUserName("")),VTPortal.roApp.db.settings.isUsingAdfs=!1,VTPortal.roApp.db.settings.adfsCredential="",VTPortal.roApp.adfsEnabled(!1),o(!1),it(!1),VTPortal.roApp.automaticLogin&&r&&et(r);else VTPortal.roApp.db.settings.wsURL=VTPortal.roApp.db.settings.wsURL.toString().replace("-vtportal.visualtime.net",".visualtime.net"),VTPortal.roApp.db.settings.wsURL=VTPortal.roApp.db.settings.wsURL.toString().replace(".visualtime.net",""),VTPortal.roApp.db.settings.save(),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNotValidVisualTimeServer"),"error",0,function(){})},function(){if(VTPortal.roApp.companyID="",VTPortal.roApp.db.settings.adfsCredential="",VTPortal.roApp.db.settings.isUsingAdfs=!1,VTPortal.roApp.adfsEnabled(!1),ht()){var i=t().split(".");i.length==3&&t().trim().indexOf(".visualtime.net")<0?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNotValidVisualTimeServer"),"error",0,function(){o(!1);r&&et(r)}):e()==!1?n.trim().indexOf(".visualtime.net")>0&&n.trim().indexOf("-vtportal.visualtime.net")<0?(n=n.replace(".visualtime.net","-vtportal.visualtime.net"),e(!0),rt(r)):n.trim().indexOf(".visualtime.net")>0&&n.trim().indexOf("-vtportal.visualtime.net")>0?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNotValidVisualTimeServer"),"error",0,function(){n=n.replace("-vtportal.visualtime.net",".visualtime.net");n=n.replace(".visualtime.net","");o(!1);it(!1);r&&et(r)}):i.length==1&&n!=""?(n=t().concat(".visualtime.net"),rt(r)):i.length==3&&n!=""&&n.trim().indexOf(".visualtime.net")<0&&n.trim().indexOf("-vtportal.visualtime.net")<0?(n=n.concat(".visualtime.net"),rt(r)):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNotValidVisualTimeServer"),"error",0,function(){n=n.replace("-vtportal.visualtime.net",".visualtime.net");n=n.replace(".visualtime.net","");o(!1);it(!1);r&&et(r)}):(e(!1),VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNotValidVisualTimeServer"),"error",0,function(){n=n.replace("-vtportal.visualtime.net",".visualtime.net");n=n.replace(".visualtime.net","");o(!1);it(!1);r&&et(r)}))}else VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNotValidVisualTimeServer"),"error",0,function(){o(!1);it(!1);r&&et(r)})},n,ut).isAdfsActive()},oi=function(n){var e=n[0],f=!1,t;try{e!=null&&e.toUpperCase()!="NULL"?(t=JSON.parse(e),typeof t!="undefined"&&t!=null?(f=t.close,wt>15?(u(""),i(""),VTPortal.roApp.db.settings.adfsCredential="",r.close(),r=null,VTPortalUtils.utils.notifyMesage("No se han podido obtener las credenciales del servidor ADFS","error",0,function(){})):f&&t.username!=""&&t.token!=""?(u(t.username),i("\\"+t.username),VTPortal.roApp.db.settings.adfsCredential=t.token,at!=-1&&clearInterval(at),r.close(),r=null,et(!0)):(u(""),i(""),VTPortal.roApp.db.settings.adfsCredential="",wt=wt+1)):f=!1):f=!1}catch(o){f=!1}at=setTimeout(function(){r!=null&&r.executeScript({code:"getLoggedInUserInfo()"},oi)},3e3)},gi=function(n){VTPortal.roApp.wsRequestCounter()>0&&VTPortal.roApp.wsRequestCounter(0);n&&r!=null&&r.show();at=setTimeout(function(){r!=null&&r.executeScript({code:"getLoggedInUserInfo()"},oi)},3e3)},nr=ko.computed(function(){if(t().trim=="")i18nextko.i18n.t("roRequieredServer");else return t().trim().replace("-vtportal.visualtime.net",".visualtime.net")}),si=function(n){n.jQueryEvent.keyCode==13&&rt(!0)},tr=function(n){n.jQueryEvent.keyCode==13&&ti(n)},ir=function(n){n.jQueryEvent.keyCode==13&&$("#accessPwd :input").focus()},rr=function(n){n.jQueryEvent.keyCode==13&&$("#txtRecoverEmail :input").focus()},ur=function(n){n.jQueryEvent.keyCode==13&&lt(n)},fr=function(){pt(!0);e(!1);bt(!0);$("#txtRecoverUserName :input").focus()},er=function(n){n.jQueryEvent.keyCode==13&&$("#txtNewPassword :input").focus()},or=function(n){n.jQueryEvent.keyCode==13&&fi(n)},sr=function(){VTPortal.roApp.connectedToMT(!1);$(".toggle-password").off("click");$(".toggle-password").click(function(){vt()=="password"?vt("text"):vt("password")});t(t().replace("-vtportal.visualtime.net",".visualtime.net"));try{navigator.splashscreen.hide()}catch(n){}VTPortal.roApp.wsRequestCounter(0);t().trim()!=""&&rt(!1);VTPortal.roApp.automaticLogin==!1&&(i(""),VTPortal.roApp.ssoEnabled()==!0&&VTPortal.roApp.ssoUserName()!=""&&(u(VTPortal.roApp.ssoUserName()),i(VTPortal.roApp.ssoUserName().toLowerCase())))},hr=function(){VTPortal.roApp.setLanguage(f().tag)};return{viewShown:sr,beforeViewSetup:hr,lblConfiguration:st,lblClient:c,lblLanguage:y,lblServerLocation:i18nextko.t("serverLocation"),lblClientLocation:i18nextko.t("clientLocation"),lblSecureConnection:i18nextko.t("isSSL"),lblUsername:h,lblPassword:a,isModeApp:ht,isMT:ai,txtUsername:{placeholder:l,value:u,onKeyUp:ir,disabled:ft},txtClient:{readOnly:!0,onFocusIn:wi,value:ot},txtPwd:{placeholder:v,value:i,mode:vt,onKeyUp:tr,disabled:ft},txtServer:{readOnly:!0,onFocusIn:pi,placeholder:nr,value:t},currentLanguage:f,dataSourceLanguages:{dataSource:VTPortal.roApp.availableLanguages,displayExpr:"Name",placeholder:i18nextko.t("language"),value:f,itemTemplate:"langItemTemplate",onItemClick:function(n){switch(n.itemData.ID){case"ESP":st("configuracin");c("servidor");h("usuario");a("contrasea");y("idioma");p("Enviar");w("Iniciar sesin con SSO");b("He olvidado la contrasea");l("Introduzca login");v("Introduzca contrasea");k("Recuperar contrasea");d("Nombre de usuario");g("Direccin de correo");nt('Indique su nombre de usuario y correo electrnico. Al pulsar sobre el botn "Siguiente" se le enviar un mensaje con la clave de recuperacin que deber introducir para poder restablecer la contrasea.');tt("Siguiente");break;case"CAT":st("configuraci");c("servidor");h("usuari");a("contrasenya");y("idioma");p("Enviar");w("Iniciar sessi amb SSO");b("He oblidat la contrasenya");l("Introdueixi el login");v("Introdueixi la contrasenya");k("Recuperar contrasea");d("Nom usuari");g("Direcci de correu");nt('Indiqui el seu usuari i correu electrnic.Al premer sobre el bot "Segent" el sistema enviar un correu electrnic amb la clau de de recuperaci que haur de introdur al segent formulari conjuntament amb la nova contrasenya.');tt("Segent");break;case"ENG":st("configuration");c("server");h("user");a("password");y("language");p("Send");w("Start session with SSO");b("I have forgotten my password");l("Enter login");v("Enter password");k("Recover password");d("User name");g("Email");nt('Enter your username and email address. By clicking "Next" a message will be sent to you with the recovery key that you will be required to enter in order to recover your password.');tt("Next");break;case"FRA":st("configuration");c("client");h("utilisateur");a("mot de passe");y("langue");p("Envoyer");w("Connexion avec SSO");b("J`ai oubli mon mot de passe");l("Entrez le login");v("Entrez le mot de passe");k("Rcuprer le mot de passe");d("Nom d`utilisateur");g("Adresse e-mail");nt('Indiquez votre nom d`utilisateur et votre e-mail.En cliquant sur le bouton "Suivant", vous enverrez un message avec la cl de rcupration que vous devez saisir pour rinitialiser le mot de passe.');tt("Suivant");break;case"ITA":st("configurazione");c("cliente");h("utente");a("password");y("lingua");p("Invia");w("Inizia la sessione con SSO");b("Ho dimenticato la password");l("Nome utente");v("Immetti la password");k("Recupera password.");d("Nome utente");g("Indirizzo di posta");nt('Indica il tuo nome utente e il tuo indirizzo email. Cliccando il tasto "Avanti" riceverai un messaggio con il codice di recupero che dovrai inserire per poter ripristinare la password.');tt("Avanti");break;case"GAL":h("usuario");c("servidor");a("contrasinal");y("linguaxe");p("Enviar");w("Iniciar sesin con SSO");b("Esqueime o meu contrasinal");l("Introduce o usuario");v("Introduce o contrasinal");k("Recuperar contrasea");d("Nombre de usuario");g("Direccin de correo");nt('Indique su nombre de usuario y correo electrnico. Al pulsar sobre el botn "Siguiente" se le enviar un mensaje con la clave de recuperacin que deber introducir para poder restablecer la contrasea.');tt("Enviar");break;case"POR":h("usurio");c("servidor");a("palavra-passe");y("lngua");p("Mandar");w("Entrar com SSO");b("Recuperar palavra-passe");l("Digite o usurio");v("Recuperar palavra-passe");k("Nova palavra-passe");d("Nome de utilizador");g("Endereo de correio");nt("Indique o seu nome e endereo de correio eletrnico. Ao premir o boto Seguinte receber uma mensagem com a senha de recuperao, que dever introduzir para poder redefinir a palavra-passe.");tt("Seguinte")}}},btnLogin:{onClick:ti,text:p,disabled:ft},btnRedirectToSSO:{onClick:vi,text:w,disabled:ui,visible:ko.computed(function(){return!VTPortal.roApp.connectedToMT()})},btnAcceptConf:{onClick:bi,text:i18nextko.t("closeConfig")},btnAcceptMTConf:{onClick:ki,text:i18nextko.t("closeConfig")},btnRecover:{onClick:fr,text:b,disabled:ft},popupVisible:o,popupMTVisible:it,txtServerLocation:{value:t,placeholder:i18nextko.t("serverLocation"),onKeyUp:si},txtClientLocation:{value:ot,placeholder:i18nextko.t("serverLocation"),onKeyUp:si},ckServerSecurity:{text:i18nextko.t("isSSL"),value:s},toast:{message:ci,type:li,displayTime:3e3,visible:hi},requiredField:{validationGroup:"validationCode",validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),recoverPwdPopupVisible:bt,lblRecoverTitle:k,lblRecoverUserName:d,txtRecoverUserName:{placeholder:i18nextko.t("roRecoverUserNamePH"),value:ct,onKeyUp:rr},lblRecoverEmail:g,txtRecoverEmail:{placeholder:i18nextko.t("roRecoverEmailPH"),value:dt,onKeyUp:ur},requieredRecoverEmail:{validationGroup:"requestRecover",validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]},requieredRecoverUserName:{validationGroup:"requestRecover",validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]},btnSendRecoverRequest:{validationGroup:"requestRecover",onClick:lt,text:tt},setPwdPopupVisible:gt,lblSetPassword:i18nextko.t("roSetRecoveredPassword"),lblRequestKey:i18nextko.t("roRequestKey"),txtRequestKey:{placeholder:i18nextko.t("roRequestKeyPH"),value:ni,onKeyUp:er},commScroll:{height:"80%",bounceEnabled:!1},lblNewPassword:i18nextko.t("roNewPassword"),txtNewPassword:{placeholder:i18nextko.t("roNewPasswordPH"),mode:"password",value:kt,onKeyUp:or},requieredRequestKey:{validationGroup:"setRecoveredPwd",validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]},requieredNewPassword:{validationGroup:"setRecoveredPwd",validationRules:[{type:"required",message:i18nextko.i18n.t("roRequieredField")}]},btnSetNewPassword:{validationGroup:"setRecoveredPwd",onClick:fi,text:i18nextko.t("sendMsg")},lblRecoverFullInfo:nt,ssoEnabled:VTPortal.roApp.ssoEnabled,ckUseSSOLogin:{value:ri,text:i18nextko.t("sendUsingSSOIdentity"),onValueChanged:function(){VTPortal.roApp.ssoEnabled()&&ri()?(u(VTPortal.roApp.ssoUserName()),i(VTPortal.roApp.ssoUserName().toLowerCase())):(u(""),i(""))}}}};VTPortal.punches=function(){function b(n){var t=[];switch(n){case 1:VTPortal.roApp.empPermissions().Punch.SchedulePunch&&VTPortal.roApp.userStatus().PunchesEnabled&&(t.push({ID:0,cssClass:"dx-icon-TA_in",cssClassText:"textActionPunch",Action:i18nextko.i18n.t("roPunches_TA_in")}),t.push({ID:1,cssClass:"dx-icon-TA_out",cssClassText:"textActionPunch",Action:i18nextko.i18n.t("roPunches_TA_out")}),t.push({ID:2,cssClass:"dx-icon-TA_in_cause",cssClassText:"textActionPunch",Action:i18nextko.i18n.t("roPunches_TA_in_cause")}),t.push({ID:3,cssClass:"dx-icon-TA_out_cause",cssClassText:"textActionPunch",Action:i18nextko.i18n.t("roPunches_TA_out_cause")}));break;case 2:VTPortal.roApp.empPermissions().Punch.ProductiVPunch&&VTPortal.roApp.userStatus().ProductiVEnabled&&(t.push({ID:4,cssClass:"dx-icon-Task_change",cssClassText:"textActionPunch",Action:i18nextko.i18n.t("roPunches_Task_change")}),VTPortal.roApp.userStatus().HasCompletePermission&&VTPortal.roApp.userStatus().TaskId>0&&t.push({ID:5,cssClass:"dx-icon-Task_complete",cssClassText:"textActionPunch",Action:i18nextko.i18n.t("roPunches_Task_complete")}),VTPortal.roApp.userStatus().TaskId>0&&t.push({ID:6,cssClass:"dx-icon-Task_alert",cssClassText:"textActionPunch",Action:i18nextko.i18n.t("roPunches_Task_alert")}));break;case 3:VTPortal.roApp.empPermissions().Punch.CostCenterPunch&&VTPortal.roApp.userStatus().PunchesEnabled&&VTPortal.roApp.userStatus().CostCenterEnabled&&t.push({ID:7,cssClass:"dx-icon-CostCenter",cssClassText:"textActionPunch",Action:i18nextko.i18n.t("roPunches_CostCenter")})}return t.length>0?(a(!0),g(t)):a(!1),t}function lt(t){if(VTPortal.app.navigationManager._currentItem.uri=="punches")if(typeof t.tag.ndefMessage[0]!="undefined"){if(VTPortal.roApp.nfcPunchInProgress()==!1){VTPortal.roApp.nfcPunchInProgress(!0);var i=function(){cordova.platformId==="ios"&&nfc.invalidateSession();VTPortal.roApp.nfcEnabled(!1);VTPortal.roApp.nfcPunchInProgress(!1)};VTPortal.roApp.lastRequestFailed()||window.VTPortalUtils.utils.doPunch("ta",{idCause:-1,direction:"X",fast:!1,nfcTag:ndef.textHelper.decodePayload(t.tag.ndefMessage[0].payload),tcType:n()},i)}}else VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roInvalidNFC"),"warning",2e3)}function it(){nfc.addNdefListener(lt,function(){VTPortal.roApp.nfcEnabled(!0)},function(){VTPortal.roApp.nfcEnabled(!1);VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorNFC"),"warning",2e3)})}function at(){VTPortal.roApp.nfcEnabled(!1);VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorNFC"),"warning",2e3)}function vt(){VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Communiques&&typeof nfc!="undefined"&&cordova.platformId==="ios"&&nfc.beginSession(it,at)}function yt(){VTPortal.roApp.nfcPunchInProgress(!1);VTPortal.roApp.isModeApp()&&VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Communiques&&typeof nfc!="undefined"&&(cordova.platformId==="ios"||it());tt().viewShown();k();setTimeout(function(){$(".scrollview").each(function(){$(this).height($("#panelsContent").height()-75)})},200);s==-1&&(s=setInterval(function(){k()},1e4))}var o=ko.observable("presence"),ut=ko.observable(0),a=ko.observable(!1),v=ko.observable([]),ft=ko.computed(function(){return VTPortal.roApp.currentLocationInfo().reliable}),et=ko.computed(function(){return VTPortal.roApp.empPermissions().MustUseGPS}),s=-1,h=ko.observable(!1),y=VTPortal.taskFieldsInput(),d="",g=ko.observable([]),r=ko.observable(!1),c=ko.observable(!1),p=ko.observable(""),nt=ko.observable(""),t=ko.observable(""),u=ko.observable(!1),ot=ko.observable(""),l=ko.observable(Math.floor(Math.random()*100001)),n=ko.observable(""),dt=ko.observable(new DevExpress.data.DataSource({store:[],searchOperation:"contains",searchExpr:"Name"})),w=function(){t()=="NoCause"?VTPortal.roApp.userStatus().PresenceStatus=="Inside"?(VTPortalUtils.utils.isShowingPopup(!1),VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roAlreadyIn"),"warning",0,function(){window.VTPortalUtils.utils.doPunch("ta",{idCause:-1,direction:"S",tcType:n(),selectedZone:VTPortal.roApp.SelectedZone()})},function(){},i18nextko.i18n.t("roContinue"),i18nextko.i18n.t("roCancel"))):window.VTPortalUtils.utils.doPunch("ta",{idCause:-1,direction:"E",tcType:n(),selectedZone:VTPortal.roApp.SelectedZone()}):VTPortal.roApp.userStatus().PresenceStatus=="Inside"?(VTPortalUtils.utils.isShowingPopup(!1),VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roAlreadyIn"),"warning",0,function(){VTPortal.app.navigate("SelectListObject/causes.readerinputcode/S/"+n())},function(){},i18nextko.i18n.t("roContinue"),i18nextko.i18n.t("roCancel"))):VTPortal.app.navigate("SelectListObject/causes.readerinputcode/E/"+n())},st=ko.computed(function(){var n=[];return n.push({text:i18nextko.i18n.t("roOffice"),type:"success",cssClassText:"textPunchOption",ImageSrc:"Images/icons8-office-48.png"}),n.push({text:i18nextko.i18n.t("roHome"),type:"success",cssClassText:"textPunchOption",ImageSrc:"Images/icons8-home-48.png"}),n}),ht=ko.computed(function(){switch(o()){case"presence":return i18nextko.i18n.t("roATPuncheTitle");case"productiv":return i18nextko.i18n.t("roTPunchesTitle");case"costcenter":return i18nextko.i18n.t("roCCPunchesTitle")}},this),f,rt;VTPortal.roApp.empPermissions().Punch.SchedulePunch&&VTPortal.roApp.userStatus().PunchesEnabled||VTPortal.roApp.empPermissions().Punch.ProductiVPunch&&VTPortal.roApp.userStatus().ProductiVEnabled||VTPortal.roApp.empPermissions().Punch.CostCenterPunch&&VTPortal.roApp.userStatus().PunchesEnabled&&VTPortal.roApp.userStatus().CostCenterEnabled?(f=[],VTPortal.roApp.empPermissions().Punch.SchedulePunch&&VTPortal.roApp.userStatus().PunchesEnabled&&f.push({ID:1,cssClass:"dx-icon-presence"}),VTPortal.roApp.empPermissions().Punch.ProductiVPunch&&VTPortal.roApp.userStatus().ProductiVEnabled&&f.push({ID:2,cssClass:"dx-icon-productiV"}),VTPortal.roApp.empPermissions().Punch.CostCenterPunch&&VTPortal.roApp.userStatus().PunchesEnabled&&VTPortal.roApp.userStatus().CostCenterEnabled&&f.push({ID:3,cssClass:"dx-icon-costCenter"}),v(f)):v([]);var ct=function(n){n.ID==1?o("presence"):n.ID==2?o("productiv"):n.ID==3&&o("costcenter");k();setTimeout(function(){$(".scrollview").each(function(){$(this).height($("#panelsContent").height()-75)})},200)},k=function(){VTPortal.roApp.gpsEmployeePermission()&&VTPortal.roApp.empPermissions().MustUseGPS&&navigator.geolocation.getCurrentPosition(function(n){var t=VTPortal.roApp.currentLocationInfo();(t.coords[0]!=n.coords.latitude||t.coords[1]!=n.coords.longitude||t.reliable==!1||t.location=="-")&&(geocoder=new google.maps.Geocoder,geocoder.geocode({address:n.coords.latitude+","+n.coords.longitude,language:"es"},function(t,r){var u=VTPortal.roApp.currentLocationInfo();if(r==google.maps.GeocoderStatus.OK){for(i=0;i<t[0].address_components.length;i++)if(t[0].address_components[i].types[0]=="locality")try{u.location=t[0].address_components[i].long_name}catch(f){u.location="API Error parsing city"}try{u.fullAddress=t[0].formatted_address}catch(f){u.fullAddress="API Error parsing address"}u.coords=[n.coords.latitude,n.coords.longitude];u.reliable=!0;VTPortal.roApp.currentLocationInfo(u)}else u=VTPortal.roApp.currentLocationInfo(),u.coords[0]=0,u.coords[1]=0,u.location="API Error parsing city",u.fullAddress="API Error parsing address",u.reliable=!1,VTPortal.roApp.currentLocationInfo(u)}))},function(n){var t;n.code==1?(t=VTPortal.roApp.currentLocationInfo(),t.coords[0]=0,t.coords[1]=0,t.location="API Error parsing city",t.fullAddress="API Error parsing address",t.reliable=!1,VTPortal.roApp.gpsEmployeePermission(!1)):n.message.indexOf("Only secure origins are allowed")==0?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("chromeGeolocationAccessForbidden"),"error",0):(t=VTPortal.roApp.currentLocationInfo(),t.coords[0]=0,t.coords[1]=0,t.location="API Error parsing city",t.fullAddress="API Error parsing address",t.reliable=!1,VTPortal.roApp.currentLocationInfo(t),VTPortal.roApp.gpsEmployeePermission(!0))},{timeout:1e4})},tt=ko.observable(VTPortal.bigUserInfo());rt=function(n){VTPortal.roApp.popupZoneVisible(!1);VTPortal.roApp.ZoneSelected(!0);VTPortal.roApp.SelectedZone(n.itemData.Id);w()};var pt=function(){clearInterval(s);s=-1},wt=function(n){var t=n.validationGroup.validate();t.isValid&&(u(!1),e("SelectListObject/tasks.availabletasks/TCO",VTPortalUtils.taskAction.complete))},e=function(n,t){d=n;VTPortal.roApp.taskPunchRequest({currentAction:-1,newAction:-1,currentTaskUserFieldsDefinition:null,currentTaskUserFieldsValue:["","","",-1,-1,-1],newTaskUserFieldsDefinition:null,newTaskUserFieldsValue:["","","",-1,-1,-1]});VTPortal.roApp.userStatus().TaskId>0?new WebServiceRobotics(function(i){var u,r,f;if(i.Status==window.VTPortalUtils.constants.OK.value){for(VTPortal.roApp.taskPunchRequest().currentAction=t,VTPortal.roApp.taskPunchRequest().currentTaskUserFieldsDefinition=i.Fields,u=!1,r=0;r<i.Fields.length;r++)i.Fields[r].Used&&(u=!0);u?(y.initTaskProperties(!1),h(!0)):VTPortal.app.navigate(n)}else f=function(){VTPortal.roApp.redirectAtHome()},VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roErrorLoadingTaskInfo"),"error",0,f)}).getTaskUserFieldsAction(t,VTPortal.roApp.userStatus().TaskId):VTPortal.app.navigate(n)},bt=function(){h(!1);y.savePunchInfo();VTPortal.app.navigate(d)},kt=function(){new WebServiceRobotics(function(n){if(n.Status==window.VTPortalUtils.constants.OK.value)VTPortal.roApp.redirectAtHome();else{var t=function(){VTPortal.roApp.redirectAtHome()};VTPortalUtils.utils.processErrorMessage(n,t)}}).saveNewTaskAlert(VTPortal.roApp.userStatus().TaskId,nt())};return{title:ht,viewShown:yt,viewHidden:pt,lblCaptcha:i18nextko.t("roCaptchaTitle"),lblCaptchaDescription:i18nextko.t("roCaptchaDescription"),lblCaptchaValue:l,subscribeBlock:tt(),positionreliable:ft,mustUseGps:et,tabPanelOptions:{height:"85%",dataSource:v,selectedIndex:ut,animationEnabled:!1,swipeEnabled:!1,itemTitleTemplate:"title",onSelectionChanged:function(n){ct(n.addedItems[0]);switch(n.addedItems[0].ID){case 1:b(1);break;case 2:b(2);break;case 3:b(3)}}},commScroll:{height:"70%"},listactions:{dataSource:g,scrollingEnabled:!1,grouped:!1,itemTemplate:"actionItem",onItemClick:function(n){if(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.NewRequests)switch(n.itemData.ID){case 0:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Telecommuting&&VTPortal.roApp.userStatus().Telecommuting==!0?(t("NoCause"),r(!0)):(t("NoCause"),VTPortal.roApp.userStatus().PresenceStatus=="Inside"?(VTPortalUtils.utils.isShowingPopup(!1),VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roAlreadyIn"),"warning",0,function(){window.VTPortalUtils.utils.doPunch("ta",{idCause:-1,direction:"E"})},function(){},i18nextko.i18n.t("roContinue"),i18nextko.i18n.t("roCancel"))):window.VTPortalUtils.utils.doPunch("ta",{idCause:-1,direction:"E"}));break;case 1:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):VTPortal.roApp.userStatus().PresenceStatus=="Outside"?(VTPortalUtils.utils.isShowingPopup(!1),VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roAlreadyOut"),"warning",0,function(){window.VTPortalUtils.utils.doPunch("ta",{idCause:-1,direction:"S"})},function(){},i18nextko.i18n.t("roContinue"),i18nextko.i18n.t("roCancel"))):window.VTPortalUtils.utils.doPunch("ta",{idCause:-1,direction:"S"});break;case 2:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Telecommuting&&VTPortal.roApp.userStatus().Telecommuting==!0?(t("Cause"),r(!0)):VTPortal.roApp.userStatus().PresenceStatus=="Inside"?(VTPortalUtils.utils.isShowingPopup(!1),VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roAlreadyIn"),"warning",0,function(){VTPortal.app.navigate("SelectListObject/causes.readerinputcode/E")},function(){},i18nextko.i18n.t("roContinue"),i18nextko.i18n.t("roCancel"))):VTPortal.app.navigate("SelectListObject/causes.readerinputcode/E");break;case 3:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):VTPortal.roApp.userStatus().PresenceStatus=="Outside"?(VTPortalUtils.utils.isShowingPopup(!1),VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roAlreadyOut"),"warning",0,function(){VTPortal.app.navigate("SelectListObject/causes.readerinputcode/S")},function(){},i18nextko.i18n.t("roContinue"),i18nextko.i18n.t("roCancel"))):VTPortal.app.navigate("SelectListObject/causes.readerinputcode/S");break;case 4:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):VTPortal.roApp.userStatus().PresenceStatus=="Inside"?VTPortal.roApp.userStatus().TaskId>0?e("SelectListObject/tasks.availabletasks/TCH",VTPortalUtils.taskAction.change):e("SelectListObject/tasks.availabletasks/TCH",VTPortalUtils.taskAction.begin):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoPresence"),"info",0);break;case 5:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoPresence"),"info",0):VTPortal.roApp.userStatus().PresenceStatus=="Inside"?VTPortal.roApp.userStatus().CanCompleteTask?(l(Math.floor(Math.random()*100001)),u(!0)):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoPresence"),"info",0):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0);break;case 6:p(i18nextko.i18n.t("roCurrentTaskAlert")+VTPortal.roApp.userStatus().TaskTitle);c(!0);break;case 7:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):VTPortal.roApp.userStatus().PresenceStatus=="Inside"?VTPortal.app.navigate("SelectListObject/costcenters/C"):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoPresence"),"info",0)}else switch(n.itemData.ID){case 0:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Telecommuting&&VTPortal.roApp.userStatus().Telecommuting==!0?(t("NoCause"),r(!0)):VTPortal.roApp.userStatus().PresenceStatus=="Inside"?(VTPortalUtils.utils.isShowingPopup(!1),VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roAlreadyIn"),"warning",0,function(){window.VTPortalUtils.utils.doPunch("ta",{idCause:-1,direction:"E"})},function(){},i18nextko.i18n.t("roContinue"),i18nextko.i18n.t("roCancel"))):window.VTPortalUtils.utils.doPunch("ta",{idCause:-1,direction:"E"});break;case 1:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):VTPortal.roApp.userStatus().PresenceStatus=="Outside"?(VTPortalUtils.utils.isShowingPopup(!1),VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roAlreadyOut"),"warning",0,function(){window.VTPortalUtils.utils.doPunch("ta",{idCause:-1,direction:"S"})},function(){},i18nextko.i18n.t("roContinue"),i18nextko.i18n.t("roCancel"))):window.VTPortalUtils.utils.doPunch("ta",{idCause:-1,direction:"S"});break;case 2:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Telecommuting&&VTPortal.roApp.userStatus().Telecommuting==!0?(t("Cause"),r(!0)):VTPortal.roApp.userStatus().PresenceStatus=="Inside"?(VTPortalUtils.utils.isShowingPopup(!1),VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roAlreadyIn"),"warning",0,function(){VTPortal.app.navigate("SelectListObject/causes.readerinputcode/E")},function(){},i18nextko.i18n.t("roContinue"),i18nextko.i18n.t("roCancel"))):VTPortal.app.navigate("SelectListObject/causes.readerinputcode/E");break;case 3:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):VTPortal.roApp.userStatus().PresenceStatus=="Outside"?(VTPortalUtils.utils.isShowingPopup(!1),VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roAlreadyOut"),"warning",0,function(){VTPortal.app.navigate("SelectListObject/causes.readerinputcode/S")},function(){},i18nextko.i18n.t("roContinue"),i18nextko.i18n.t("roCancel"))):VTPortal.app.navigate("SelectListObject/causes.readerinputcode/S");break;case 4:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):VTPortal.roApp.userStatus().PresenceStatus=="Inside"?VTPortal.roApp.userStatus().TaskId>0?e("SelectListObject/tasks.availabletasks/TCH",VTPortalUtils.taskAction.change):e("SelectListObject/tasks.availabletasks/TCH",VTPortalUtils.taskAction.begin):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoPresence"),"info",0);break;case 5:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoPresence"),"info",0):VTPortal.roApp.userStatus().PresenceStatus=="Inside"?VTPortal.roApp.userStatus().CanCompleteTask?(l(Math.floor(Math.random()*100001)),u(!0)):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoPresence"),"info",0):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0);break;case 6:p(i18nextko.i18n.t("roCurrentTaskAlert")+VTPortal.roApp.userStatus().TaskTitle);c(!0);break;case 7:VTPortal.roApp.lastRequestFailed()?VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roPunchOffline"),"warning",0):VTPortal.roApp.userStatus().PresenceStatus=="Inside"?VTPortal.app.navigate("SelectListObject/costcenters/C"):VTPortalUtils.utils.notifyMesage(i18nextko.i18n.t("roNoPresence"),"info",0)}}},progressPanel:{message:i18nextko.t("roNFCPunch"),showPane:!0,shading:!1,height:150,delay:200,shadingColor:"rgba(0,0,0,0)",indicatorSrc:"Images/loader_v4.gif",visible:VTPortal.roApp.showNfcPanel},captchaVisible:u,txtCaptcha:{placeholder:i18nextko.t("roCaptchaTitlePH"),value:ot},actionDS:a,btnAcceptCptcha:{validationGroup:"validateCaptcha",text:i18nextko.t("roAcceptCaptcha"),onClick:wt},btnCancelCaptcha:{onClick:function(){u(!1)},text:i18nextko.t("roCancelCaptcha")},compareField:{validationGroup:"validateCaptcha",validationRules:[{type:"compare",comparisonType:"==",comparisonTarget:l,message:i18nextko.i18n.t("roCaptchaNotMatch")}]},punchOptions:{dataSource:st,visible:r,showTitle:!1,title:"Desde dnde trabajars hoy?",showCancelButton:ko.observable(!1),itemTemplate:function(n,t,i){var r;t==0?(r=$("<div>").attr("class","listMenuItemContentPunchOptions"),r.append($("<img>").attr("src",n.ImageSrc).attr("class","listMenuItemIcon EmployeeImagePhoto")),r.append($("<div>").attr("class",n.cssClassText).text(n.text)),i.append(r)):(r=$("<div>").attr("class","listMenuItemContentPunchOptions"),r.append($("<img>").attr("src",n.ImageSrc).attr("class","listMenuItemIcon EmployeeImagePhoto")),r.append($("<div>").attr("class",n.cssClassText).text(n.text)),i.append(r))},onItemClick:function(i){if(VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.NewRequests)if(i.itemIndex==0){n(0);var r=Object.clone(VTPortal.roApp.currentLocationInfo(),!0);!r.reliable&&VTPortal.roApp.empPermissions().MustSelectZone&&VTPortal.roApp.empPermissions().MustUseGPS||VTPortal.roApp.empPermissions().MustSelectZone&&!VTPortal.roApp.empPermissions().MustUseGPS?VTPortal.roApp.empPermissions().MustUseGPS?VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("errorGettingGPSNew"),"info",0,function(){VTPortal.roApp.loadZones();VTPortal.roApp.popupZoneVisible(!0)},function(){VTPortal.roApp.redirectAtHome()},i18nextko.i18n.t("roSelectZone"),i18nextko.i18n.t("roCancel")):(VTPortal.roApp.loadZones(),VTPortal.roApp.popupZoneVisible(!0)):w()}else n(1),w();else i.itemIndex==0?n(0):n(1),t()=="NoCause"?VTPortal.roApp.userStatus().PresenceStatus=="Inside"?(VTPortalUtils.utils.isShowingPopup(!1),VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roAlreadyIn"),"warning",0,function(){window.VTPortalUtils.utils.doPunch("ta",{idCause:-1,direction:"E",tcType:n()})},function(){},i18nextko.i18n.t("roContinue"),i18nextko.i18n.t("roCancel"))):window.VTPortalUtils.utils.doPunch("ta",{idCause:-1,direction:"E",tcType:n()}):VTPortal.roApp.userStatus().PresenceStatus=="Inside"?(VTPortalUtils.utils.isShowingPopup(!1),VTPortalUtils.utils.questionMessage(i18nextko.i18n.t("roAlreadyIn"),"warning",0,function(){VTPortal.app.navigate("SelectListObject/causes.readerinputcode/E/"+n())},function(){},i18nextko.i18n.t("roContinue"),i18nextko.i18n.t("roCancel"))):VTPortal.app.navigate("SelectListObject/causes.readerinputcode/E/"+n())}},ListZonesVisible:VTPortal.roApp.popupZoneVisible,listZones:{dataSource:VTPortal.roApp.zonesDataSource,scrollingEnabled:!0,height:300,grouped:!1,itemTemplate:"RequestItem",onItemClick:rt},searchOptions:{valueChangeEvent:"keyup",mode:"search",height:"10%",onValueChanged:function(n){VTPortal.roApp.zonesDataSource().searchValue(n.value);VTPortal.roApp.zonesDataSource().load()}},taskFieldsVisible:h,taskFieldsBlock:y,btnCancelTaskFields:{onClick:function(){h(!1)},text:i18nextko.t("roCancelCaptcha")},btnAcceptUserFields:{onClick:function(){bt()},text:i18nextko.t("roContinue")},lblTaskAlert:i18nextko.t("roTaskAlert"),lblWhereAreYou:i18nextko.t("lblWhereAreYou"),taskAlertVisible:c,lblSaveTaskAlertTitle:p,btnCancelTaskAlert:{onClick:function(){c(!1)},text:i18nextko.t("roCancel")},btnAcceptTaskAlert:{onClick:function(){kt()},text:i18nextko.t("roContinue")},txtTaskAlert:{value:nt},loadingPanel:VTPortalUtils.utils.loadingPanelConf(),btnNFCIos:{onClick:vt,text:i18nextko.t("roPunchNFC"),visible:VTPortal.roApp.onIosDevice()&&VTPortal.roApp.db.settings.ApiVersion>=VTPortalUtils.apiVersion.Communiques}}};VTPortal.telecommutingSelector=function(n){function f(){var n=[];return n.push({ID:0,cssClass:"dx-icon-taTelecommuting_Office",cssClassText:"textActionPunch",Content:i18nextko.i18n.t("roOffice")}),n.push({ID:1,cssClass:"dx-icon-taTelecommuting_Home",cssClassText:"textActionPunch",Content:i18nextko.i18n.t("roHome")}),n.length>0?t(!0):t(!1),r(new DevExpress.data.DataSource({store:n})),n}function e(){u().viewShown();f();n.param=="0"?i(i18nextko.i18n.t("roTCWhere")):i(i18nextko.i18n.t("roTCWhereF"))}var t=ko.observable(!1),i=ko.observable(""),r=ko.observable(new DevExpress.data.DataSource({})),u=ko.observable(VTPortal.bigUserInfo());return{viewShown:e,title:i,subscribeBlock:u(),telecommutingSelectorDS:t,loadingPanel:VTPortalUtils.utils.loadingPanelConf(),commScroll:{height:"70%",onPullDown:function(){f()}},listtelecommutingSelector:{dataSource:r,scrollingEnabled:!1,grouped:!1,itemTemplate:"actionItem",onItemClick:function(t){n.param=="0"?VTPortal.app.navigate("punches/"+t.itemData.ID):VTPortal.app.navigate("forgottenPunch/-1/"+moment(n.iDate).format("YYYY-MM-DD")+"/"+t.itemData.ID)}}}};