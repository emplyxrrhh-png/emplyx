function dynamicSort(n,t){var i=1;return n[0]==="-"&&(i=-1,n=n.substr(1)),function(r,u){var f="",e="",o;switch(n){case"":f=r.Pos;e=u.Pos;break;case"assignment":typeof r.PeriodData.DayData[t].AssigData!="undefined"&&r.PeriodData.DayData[t].AssigData!=null&&(f=r.PeriodData.DayData[t].AssigData.Name);typeof u.PeriodData.DayData[t].AssigData!="undefined"&&u.PeriodData.DayData[t].AssigData!=null&&(e=u.PeriodData.DayData[t].AssigData.Name);break;case"group":f=r.EmployeeData.GroupName;e=u.EmployeeData.GroupName;break;case"employee":f=r.EmployeeData.EmployeeName;e=u.EmployeeData.EmployeeName;break;case"shift":typeof r.PeriodData.DayData[t].MainShift!="undefined"&&r.PeriodData.DayData[t].MainShift!=null&&(f=r.PeriodData.DayData[t].MainShift.Name);typeof u.PeriodData.DayData[t].MainShift!="undefined"&&u.PeriodData.DayData[t].MainShift!=null&&(e=u.PeriodData.DayData[t].MainShift.Name);break;case"budget":typeof r.PeriodData.DayData[t].IDDailyBudgetPosition!="undefined"&&r.PeriodData.DayData[t].IDDailyBudgetPosition!=null&&(f=r.PeriodData.DayData[t].IDDailyBudgetPosition);typeof u.PeriodData.DayData[t].IDDailyBudgetPosition!="undefined"&&u.PeriodData.DayData[t].IDDailyBudgetPosition!=null&&(e=u.PeriodData.DayData[t].IDDailyBudgetPosition)}return o=f<e?-1:f>e?1:0,o*i}}function dynamicSortMultiple(n,t){var i=n;return function(n,r){for(var u=0,f=0,e=i.length-1;f===0&&u<e;)f=dynamicSort(i[u],t)(n,r),u++;return f}}function ckTelecommuteVisibilityChanged(){ctl00_contentMainBody_oCalendar_dlgAdvCopy_rbTelecommuteKeepClient.GetChecked()?(ctl00_contentMainBody_oCalendar_dlgAdvCopy_rbAdvancedHolidaysDisabledClient.SetEnabled(!0),ctl00_contentMainBody_oCalendar_dlgAdvCopy_rbAdvancedHolidaysEnabledClient.SetEnabled(!0)):(ctl00_contentMainBody_oCalendar_dlgAdvCopy_rbAdvancedHolidaysDisabledClient.SetChecked(!0),ctl00_contentMainBody_oCalendar_dlgAdvCopy_rbAdvancedHolidaysDisabledClient.SetEnabled(!1),ctl00_contentMainBody_oCalendar_dlgAdvCopy_rbAdvancedHolidaysEnabledClient.SetEnabled(!1))}(function(){var n=function(n){for(var r=n.split("."),i=window,t=0;t<r.length;t+=1)i=i[r[t]]=i[r[t]]||{};return i};n("Robotics.Client.Controls");n("Robotics.Client.Language");n("Robotics.Client.Constants")})();Robotics.Client.Language.Tags={NoSolection:"Language.NoSolection",Employee:"Language.Employee",Employees:"Language.Employees",Department:"Language.Department",Departments:"Language.Departments",Connector:"Language.Connector",PlannedHours:"Language.PlannedHours",Holidays:"Language.Holidays",Mandatory:"Language.Mandatory",Flexible:"Language.Flexible",Complementary:"Language.Complementary",ContextMenu_Details:"Language.ContextMenu_Details",ContextMenu_RemoveHolidays:"Language.ContextMenu_RemoveHolidays",ContextMenu_Copy:"Language.ContextMenu_Copy",ContextMenu_Paste:"Language.ContextMenu_Paste",ContextMenu_Block:"Language.ContextMenu_Block",ContextMenu_UnBlock:"Language.ContextMenu_UnBlock",ContextMenu_CancelSelection:"Language.ContextMenu_CancelSelection",ContextMenu_EditComplementary:"Language.ContextMenu_EditComplementary",ContextMenu_AdvPaste:"Language.ContextMenu_AdvPaste",ContextMenu_CopyHolidays:"Language.ContextMenu_CopyHolidays",ContextMenu_CopyWorking:"Language.ContextMenu_CopyWorking",ContextMenu_CopyAssignments:"Language.ContextMenu_CopyAssignments",ContextMenu_EditAssignments:"Language.ContextMenu_EditAssignments",ContextMenu_SetCoverage:"Language.ContextMenu_SetCoverage",ContextMenu_PlanifyCoverage:"Language.ContextMenu_PlanifyCoverage",ContextMenu_Sort:"Language.ContextMenu_Sort",ContextMenu_SetFeast:"Language.ContextMenu_SetFeast",ContextMenu_RemoveFeast:"Language.ContextMenu_RemoveFeast",Empty:"Language.Empty",Accept:"Language.Accept",Cancel:"Language.Cancel",Download:"Language.Download",Tooltip_absent:"Language.Tooltip_absent",Tooltip_holidays:"Language.Tooltip_holidays",Tooltip_absence:"Language.Tooltip_absence",Tooltip_incidence:"Language.Tooltip_incidence",Tooltip_overtime:"Language.Tooltip_overtime",Tooltip_notes:"Language.Tooltip_notes",Tooltip_remark1:"Language.Tooltip_remark1",Tooltip_remark2:"Language.Tooltip_remark2",Tooltip_remark3:"Language.Tooltip_remark3",Tooltip_feast:"Language.Tooltip_feast",Scheduler_Real:"Language.Scheduler_Real",Scheduler_Planified:"Language.Scheduler_Planified",Scheduler_Recursive:"Language.Scheduler_Recursive",Scheduler_NonRecursive:"Language.Scheduler_NonRecursive",Scheduler_Filter:"Language.Scheduler_Filter",Scheduler_Shifts:"Language.Scheduler_Shifts",Scheduler_Assignments:"Language.Scheduler_Assignments",Scheduler_Concepts:"Language.Scheduler_Concepts",Empty_Assignment:"Language.Empty_Assignment",Empty_Assignment_SN:"Language.Empty_Assignment_SN",Tooltip_plannedHoliday:"Language.Tooltip_plannedHoliday"};Robotics.Client.Language.translator=function(n){this.langContainer=n};Robotics.Client.Language.translator.prototype.translate=function(n){return this.langContainer.Get(n)};Robotics.Client.Constants.WorkMode={roCalendar:0,roProductiveUnit:1,roBudget:2,roDayDetail:3};Robotics.Client.Constants.TypeView={DayDetail:0,DaySchedule:1,Review:0,Definition:0,Planification:1,Detail:2};Robotics.Client.Constants.ViewRange={Daily:0,Period:1};Robotics.Client.Constants.ShiftType={Normal:0,NormalFloating:1,Holiday:2,Holiday_NonWorking:3};Robotics.Client.Constants.BudgetRowState={NoChanged:0,New:1,Updated:2,Deleted:3};Robotics.Client.Constants.CoverageDayStatus={OK:0,KO:1,OVERLOAD:2,WITHOUTCOVERAGE:3};Robotics.Client.Constants.CoverageDayView={Planified:0,Real:1};Robotics.Client.Constants.EmployeeStatusOnDay={Ok:0,NoContract:1,InOtherDepartment:2};Robotics.Client.Constants.ProductiveUnitStatusOnDay={Ok:0,NoPlanned:1};Robotics.Client.Constants.DailyHourType={Untyped:0,Mandatory:1,Flexible:2,Complementary:3};Robotics.Client.Constants.TableNames={Calendar:"FullCalendar",ColShifts:"ColumnShiftsTable",ColAssignments:"ColumnAssignmentsTable",ColIndictments:"ColIndictmentsTable",ColCapacity:"ColCapacity",RowAccruals:"RowAccrualsTable",RowShifts:"RowShiftsTable",RowAssignments:"RowAssignmentsTable",AccrualTotals:"AccrualTotals"};Robotics.Client.Constants.LayoutNames={Center:"Center",East:"East",Calendar:"Main",ColumnTabs:"ColumnTabs",RowTabs:"RowTabs",Resume:"Resume",ColumnTabShifts:"tabColumnShifts",ColumnTabAssignments:"tabColumnAssignments",ColumnTabIndictments:"tabColumnIndictments",ColumnTabCapacity:"tabColumnCapacity",RowTabAccruals:"tabRowAccruals",RowTabShifts:"tabRowShifts",RowTabAssignments:"tabRowAssignments"};Robotics.Client.Constants.Actions={LoadData:"LOADCALENDAR",SaveChanges:"SAVECALENDAR",LoadHourData:"LOADHOURDATA",LoadDayDefinition:"LOADDAYDEFINITION",ExportToExcel:"EXPORTTOEXCEL",ImportFromExcel:"IMPORTFROMEXCEL",ImportFromExcelKO:"IMPORTFROMEXCELKO",ImportFromExcelWarning:"IMPORTFROMEXCELWARNING",ShiftLayerDefinition:"SHIFTLAYERDEFINITION",ShiftLayerDefinitionEdit:"SHIFTLAYERDEFINITIONEDIT",SaveAndContinue:"SAVEANDCONTINUE",DiscardAndContinue:"DISCARDANDCONTINUE",LoadCoverages:"LOADCOVERAGES",CopyCoverages:"COPYCOVERAGES",PositionModeDayData:"POSITIONMODEDAYDATA",UpdateCurrentDayData:"UPDATECURRENTDAYDATA",LoadBudget:"LOADBUDGET",SaveBudgetChanges:"SAVEBUDGETCHANGES",DiscardBudgetAndContinue:"DISCARDBUDGETANDCONTINUE",SaveBudgetChangesAndContinue:"SAVEBUDGETCHANGESANDCONTINUE",GetNewBudgetRow:"GETNEWBUDGETROW",DeleteBudgetRow:"DELETEBUDGETROW",GetBudgetHourPeriodDeinition:"GETBUDGETHOURPERIODDEFINITION",GetAvailablePositionEmployees:"GETAVAILABLEPOSITIONEMPLOYEES",GetAvailablePositionEmployeesForFulFill:"GETAVAILABLEPOSITIONEMPLOYEESFORFULFILL",AddEmployeePlanOnPosition:"ADDEMPLOYEEPLANONPOSITION",RemoveEmployeeFromPosition:"REMOVEEMPLOYEEFROMPOSITION",LoadAvailableEmployeesDetail:"LOADAVAILABLEEMPLOYEESDETAIL",CheckCalendarIndictments:"CHECKCALENDARINDITMENTS",RunAIPlanner:"RUNAIPLANNER",CleanAIPlanner:"CLEANAIPLANNER",UpdateProductiveUnitQuantity:"UPDATEPRODUCTIVEUNITQUANTITY"},function(){var n=function(n){for(var r=n.split("."),i=window,t=0;t<r.length;t+=1)i=i[r[t]]=i[r[t]]||{};return i};n("Robotics.Client.Controls");n("Robotics.Client.Language");n("Robotics.Client.Constants")}();Robotics.Client.Controls.roSchedulerCalendar=function(n){this.name="Robotics.Client.Controls.roSchedulerCalendar";this.oBaseControl=n;this.rowTableVisible=1;this.columnTableVisible=1;this.fixedCalendarTable=null;this.pageLayoutOptions={name:"pageLayout",resizable:!1,center__slidable:!1,center__closable:!1,center__paneSelector:"#"+this.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.Center,center__children:{name:"tabsContainerLayout",resizable:!1,center__slidable:!1,center__closable:!1,center__paneSelector:"#"+this.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.Calendar,south__paneSelector:"#"+this.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabs,south__slidable:!0,south__closable:!0,south__togglerLength_closed:250,south__togglerContent_closed:'<div class="btnExpand"> <div class="imgToUp"><\/div> <span style="font-weight: 100; color: #525252;">'+Globalize.formatMessage("roCalendarToggle")+'<\/span> <div class="imgToUp shiftToRight"><\/div> <\/div>',south__onopen:this.synchronizeRowLayout(!0,this),south__onclose:this.synchronizeRowLayout(!1,this),spacing_closed:35,initClosed:!0},east__closable:!0,east__slidable:!1,east__togglerLength_closed:250,east__togglerContent_closed:'<div class="btnExpandVer"> <div class="imgToLeft"><\/div> <span style="font-weight: 100; color: #525252;">'+Globalize.formatMessage("roCalendarToggle")+'<\/span> <div class="imgToLeft shiftToBottom" ><\/div> <\/div>',east__onopen:this.synchronizeColumnLayout(!0,this),east__onclose:this.synchronizeColumnLayout(!1,this),east__paneSelector:"#"+this.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.East,east__children:{name:"tabsContainerLayout",resizable:!1,slidable:!1,closable:!0,center__slidable:!0,center__closable:!0,center__paneSelector:"#"+this.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.RowTabs,south__paneSelector:"#"+this.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.Resume,south__slidable:!1,south__closable:!0,south__onopen:this.synchronizeSummaryLayout(!0,this),south__onclose:this.synchronizeSummaryLayout(!1,this),spacing_closed:15,initClosed:!0},spacing_closed:35};this.calendarIndictments={};this.calendarIndictmentsDS=[];this.currentUpdateCell=null;this.validationInProgress=!1;this.copyInProgress=!1;this.bRelatedTables=!1;this.dragTarget=null;this.resumeInfoLoaded=!1;this.processingloadingClick=!1};Robotics.Client.Controls.roSchedulerCalendar.prototype.getLayout=function(){return this.pageLayoutOptions};Robotics.Client.Controls.roSchedulerCalendar.prototype.setHasChanges=function(n){var u=this.oBaseControl,i=u.oCalendar,r,f,t,e;if(u.hasChanges=n,!u.hasChanges&&i!=null&&i.CalendarData!=null)for(r=0;r<i.CalendarData.length;r++)if(i.CalendarData[r].PeriodData.DayData!=null)for(f=0;f<i.CalendarData[r].PeriodData.DayData.length;f++)i.CalendarData[r].PeriodData.DayData[f].HasChanged=!1;!n&&u.capatityEnabled&&(t=u,e=t.capacityList[Object.keys(t.capacityList)[0]],typeof e!="undefined"&&Object.keys(e).forEach(function(i){var r=null,u;if(t.viewRange==Robotics.Client.Constants.ViewRange.Daily)for(u=t.getMinDailyCell();u<t.getMaxDailyCell();u++)r=t.oCalendar.CalendarHeader.PeriodHeaderData[u].Row1Text+"_"+t.oCalendar.CalendarHeader.PeriodHeaderData[u].Row2Text,r=r.replace(":","_"),typeof t.columnCapacityList[r][i]!="undefined"&&(t.columnCapacityList[r][i].HasChanges=n);else for(u=0;u<t.oCalendar.CalendarHeader.PeriodHeaderData.length;u++)r=t.oCalendar.CalendarHeader.PeriodHeaderData[u].Row1Text+"_"+t.oCalendar.CalendarHeader.PeriodHeaderData[u].Row2Text,r=r.replace(":","_"),typeof t.columnCapacityList[r][i]!="undefined"&&(t.columnCapacityList[r][i].HasChanges=n)}));try{hasChanges(n)}catch(o){}};Robotics.Client.Controls.roSchedulerCalendar.prototype.create=function(){var n=this.oBaseControl,i=n.oCalendar,t;this.buildHTMLStructure();n.pageLayout=n.container.layout(this.pageLayoutOptions);$("#"+n.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabs).tabs();$("#"+n.prefix+Robotics.Client.Constants.LayoutNames.RowTabs).tabs();t=this};Robotics.Client.Controls.roSchedulerCalendar.prototype.buildHTMLStructure=function(){var v=this,n=this.oBaseControl,rt=n.oCalendar,y=$("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.Center).attr("class","ui-layout-center"),g=$("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.Calendar).attr("class","ui-layout-center"),p=$("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabs).attr("class","ui-layout-south container tabs"),u=$("<ul><\/ul>").attr("id","tabbuttonsColumn"),f=$("<li><\/li>").attr("class","tab1").attr("style","cursor:pointer").append($("<a><\/a>").attr("href","#"+n.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabShifts).html(n.translator.translate(Robotics.Client.Language.Tags.Scheduler_Shifts))),o,s,t,e,l,r,a;f.on("click",this.clickColumnShiftsTableHeader(this));o=$("<li><\/li>").attr("class","tab1").attr("style","cursor:pointer").append($("<a><\/a>").attr("href","#"+n.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabCapacity).html(Globalize.formatMessage("roCapacityTab")));o.on("click",this.clickColumnCapacityTableHeader(this));if(n.isScheduleActive){s=$("<li><\/li>").attr("class","tab2").attr("style","cursor:pointer").append($("<a><\/a>").attr("href","#"+n.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabAssignments).html(n.translator.translate(Robotics.Client.Language.Tags.Scheduler_Assignments)));s.on("click",this.clickColumnAssignmentsTableHeader(this));t=$("<li><\/li>").attr("class","tab3").attr("style","cursor:pointer").append($("<a><\/a>").attr("href","#"+n.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabIndictments).html(Globalize.formatMessage("roIndictmentsTab")));t.on("click",this.clickColumnIndictmentsTableHeader(this));u.append(f,s,t)}else if(n.saasPremiumActive){t=$("<li><\/li>").attr("class","tab3").attr("style","cursor:pointer").append($("<a><\/a>").attr("href","#"+n.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabIndictments).html(Globalize.formatMessage("roIndictmentsTab")));t.on("click",this.clickColumnIndictmentsTableHeader(this));u.append(f,t)}else u.append(f);n.telecommuteEnabled&&u.append(o);var i=$("<div><\/div>").attr("id","tabpanelsColumn").attr("style","border-top: 0"),w=function(n){return function(){n.processingloadingClick==!1&&(n.processingloadingClick=!0,$("#columnWaitingIcon").addClass("loadingMove"),$("#rowWaitingIcon").addClass("loadingMove"),setTimeout(function(){n.resumeInfoLoaded||n.generateShiftTotalizerInfo();n.loadRelatedTables();n.processingloadingClick=!1},100))}},b=$("<div><\/div>").attr("id","tabColumnWaiting").attr("style","display:none;");b.append($('<div id="columnWaitingIcon" class="loadingRelatedImg"><\/div>').on("click",w(v)));i.append(b);i.append($("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabShifts).attr("class","container columnTableMain"));n.isScheduleActive&&i.append($("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabAssignments).attr("class","container columnTableMain"));(n.isScheduleActive||n.saasPremiumActive)&&i.append($("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabIndictments).attr("class","container columnTableMain"));i.append($("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabCapacity).attr("class","container columnTableMain"));p.append(u,i);y.append(g,p);var k=$("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.East).attr("class","ui-layout-east"),d=$("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.RowTabs).attr("class","ui-layout-center container tabs"),h=$("<ul><\/ul>").attr("id","tabbuttonsRow"),c=$("<li><\/li>").attr("class","tab1").attr("style","cursor:pointer").append($("<a><\/a>").attr("href","#"+n.prefix+Robotics.Client.Constants.LayoutNames.RowTabAccruals).html(n.translator.translate(Robotics.Client.Language.Tags.Scheduler_Concepts)));c.on("click",this.clickRowAccrualsTableHeader(this));e=$("<li><\/li>").attr("class","tab2").attr("style","cursor:pointer").append($("<a><\/a>").attr("href","#"+n.prefix+Robotics.Client.Constants.LayoutNames.RowTabShifts).html(n.translator.translate(Robotics.Client.Language.Tags.Scheduler_Shifts)));e.on("click",this.clickRowShiftsTableHeader(this));if(n.isScheduleActive){l=$("<li><\/li>").attr("class","tab3").attr("style","cursor:pointer").append($("<a><\/a>").attr("href","#"+n.prefix+Robotics.Client.Constants.LayoutNames.RowTabAssignments).html(n.translator.translate(Robotics.Client.Language.Tags.Scheduler_Assignments)));l.on("click",this.clickRowAssignmentsTableHeader(this));h.append(c,e,l)}else h.append(c,e);r=$("<div><\/div>").attr("id","tabpanelsRow").attr("style","border-top: 0");a=$("<div><\/div>").attr("id","tabRowWaiting").attr("style","display:none;");a.append($('<div id="rowWaitingIcon" class="rowLoadingRelatedImg"><\/div>').on("click",w(v)));r.append(a);r.append($("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.RowTabAccruals).attr("class","container rowTableMain"));r.append($("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.RowTabShifts).attr("class","container rowTableMain"));n.isScheduleActive&&r.append($("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.RowTabAssignments).attr("class","container rowTableMain"));d.append(h,r);var nt=$("<div><\/div>"),tt=$("<div><\/div>").attr("id","tabResumeWaiting").attr("style","display:none;"),it=$("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.Resume).attr("class","ui-layout-south");k.append(d,nt.append(tt,it));n.container.append(y,k)};Robotics.Client.Controls.roSchedulerCalendar.prototype.synchronizeRowLayout=function(n,t){return function(){n?(t!=null&&t.oBaseControl.pageLayout.east.children.tabsContainerLayout.south!=!1&&t.oBaseControl.pageLayout.east.children.tabsContainerLayout.south.state.isClosed&&t.oBaseControl.pageLayout.east.children.tabsContainerLayout.toggle("south"),$("#columnWaitingIcon").addClass("loadingMove"),$("#rowWaitingIcon").addClass("loadingMove"),$("#tabColumnWaiting").show(),$("#tabRowWaiting").show(),$("#tabResumeWaiting").show(),t.resumeInfoLoaded||t.generateShiftTotalizerInfo(),t.loadSouthTables(),t.loadResumeTables(),t.prepareLayoutHeight(!0),t.oBaseControl.pageLayout.east==!1||t.oBaseControl.pageLayout.east.state.isClosed?t.prepareLayoutWidth(!1):t.prepareLayoutWidth(!0),$("#columnWaitingIcon").removeClass("loadingMove"),$("#rowWaitingIcon").removeClass("loadingMove"),$("#tabColumnWaiting").hide(),$("#tabRowWaiting").hide(),$("#tabResumeWaiting").hide()):(t==null||t.oBaseControl.pageLayout.east.children.tabsContainerLayout.south==!1||t.oBaseControl.pageLayout.east.children.tabsContainerLayout.south.state.isClosed||t.oBaseControl.pageLayout.east.children.tabsContainerLayout.toggle("south"),t.prepareLayoutHeight(!1));prepareFixedHeight()}};Robotics.Client.Controls.roSchedulerCalendar.prototype.synchronizeColumnLayout=function(n,t){return function(){n?(t==null||t.oBaseControl.pageLayout.center.children.tabsContainerLayout.south.state.isClosed?t.oBaseControl.pageLayout.east.children.tabsContainerLayout.hide("south"):t.oBaseControl.pageLayout.east.children.tabsContainerLayout.show("south"),$("#columnWaitingIcon").addClass("loadingMove"),$("#rowWaitingIcon").addClass("loadingMove"),$("#tabColumnWaiting").show(),$("#tabRowWaiting").show(),$("#tabResumeWaiting").show(),t.resumeInfoLoaded||t.generateShiftTotalizerInfo(),t.loadLeftTables(),t.loadResumeTables(),t.prepareLayoutWidth(!0),t.oBaseControl.pageLayout.center.children.tabsContainerLayout.south==!1||t.oBaseControl.pageLayout.center.children.tabsContainerLayout.south.state.isClosed?t.prepareLayoutHeight(!1):t.prepareLayoutHeight(!0),$("#columnWaitingIcon").removeClass("loadingMove"),$("#rowWaitingIcon").removeClass("loadingMove"),$("#tabColumnWaiting").hide(),$("#tabRowWaiting").hide(),$("#tabResumeWaiting").hide()):t.prepareLayoutWidth(!1);prepareFixedHeight()}};Robotics.Client.Controls.roSchedulerCalendar.prototype.prepareFixedHeight=function(){var n=this;n.oBaseControl.pageLayout.center.children.tabsContainerLayout.south==!1||n.oBaseControl.pageLayout.center.children.tabsContainerLayout.south.state.isClosed?n.prepareLayoutHeight(!1):n.prepareLayoutHeight(!0);n.oBaseControl.pageLayout.east==!1||n.oBaseControl.pageLayout.east.state.isClosed?n.prepareLayoutWidth(!1):n.prepareLayoutWidth(!0)};Robotics.Client.Controls.roSchedulerCalendar.prototype.prepareLayoutHeight=function(n){var t=this,i=this.oBaseControl;n?($("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.Calendar+" .fht-fixed-body .fht-tbody").css("height","calc(100vh - 370px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.Calendar+" .fht-fixed-column .fht-tbody").css("height","calc(100vh - 388px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.RowTabAccruals+" .fht-table-wrapper").css("height","calc(100vh - 250px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.RowTabAccruals+" .fht-table-wrapper .fht-tbody").css("height","calc(100vh - 390px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabShifts+" .fht-fixed-column .fht-tbody").css("height","116px"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabAssignments+" .fht-fixed-column .fht-tbody").css("height","116px"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabShifts+" .fht-fixed-column .fht-tfoot").css("top","0px"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabAssignments+" .fht-fixed-column .fht-tfoot").css("top","0px")):($("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.Calendar+" .fht-fixed-body .fht-tbody").css("height","calc(100vh - 235px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.Calendar+" .fht-fixed-column .fht-tbody").css("height","calc(100vh - 254px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.RowTabAccruals+" .fht-table-wrapper").css("height","calc(100vh - 205px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.RowTabAccruals+" .fht-table-wrapper .fht-tbody").css("height","calc(100vh - 250px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabShifts+" .fht-fixed-column .fht-tbody").css("height","116px"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabAssignments+" .fht-fixed-column .fht-tbody").css("height","116px"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabShifts+" .fht-fixed-column .fht-tfoot").css("top","0px"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabAssignments+" .fht-fixed-column .fht-tfoot").css("top","0px"));$("#"+i.prefix+Robotics.Client.Constants.TableNames.RowAccruals).parent().scrollTop($("#"+i.prefix+Robotics.Client.Constants.TableNames.Calendar).parent().scrollTop())};Robotics.Client.Controls.roSchedulerCalendar.prototype.prepareLayoutWidth=function(n){var t=this,i=this.oBaseControl;n?($("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.Calendar+" .fht-fixed-body .fht-tbody").css("width","calc(100vw - 270px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.Calendar+" .fht-fixed-body .fht-thead").css("width","calc(100vw - 270px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabShifts+" .fht-fixed-body .fht-tbody").css("width","calc(100vw - 270px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabShifts+" .fht-fixed-body .fht-thead").css("width","calc(100vw - 270px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabShifts+" .fht-fixed-body .fht-tfoot").css("width","calc(100vw - 270px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabAssignments+" .fht-fixed-body .fht-tbody").css("width","calc(100vw - 270px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabAssignments+" .fht-fixed-body .fht-thead").css("width","calc(100vw - 270px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabAssignments+" .fht-fixed-body .fht-tfoot").css("width","calc(100vw - 270px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabCapacity+" .fht-fixed-body .fht-tbody").css("width","calc(100vw - 270px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabCapacity+" .fht-fixed-body .fht-thead").css("width","calc(100vw - 270px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabCapacity+" .fht-fixed-body .fht-tfoot").css("width","calc(100vw - 270px)")):($("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.Calendar+" .fht-fixed-body .fht-tbody").css("width","calc(100vw - 100px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.Calendar+" .fht-fixed-body .fht-thead").css("width","calc(100vw - 100px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabShifts+" .fht-fixed-body .fht-tbody").css("width","calc(100vw - 100px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabShifts+" .fht-fixed-body .fht-thead").css("width","calc(100vw - 100px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabShifts+" .fht-fixed-body .fht-tfoot").css("width","calc(100vw - 100px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabAssignments+" .fht-fixed-body .fht-tbody").css("width","calc(100vw - 100px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabAssignments+" .fht-fixed-body .fht-thead").css("width","calc(100vw - 100px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabAssignments+" .fht-fixed-body .fht-tfoot").css("width","calc(100vw - 100px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabCapacity+" .fht-fixed-body .fht-tbody").css("width","calc(100vw - 100px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabCapacity+" .fht-fixed-body .fht-thead").css("width","calc(100vw - 100px)"),$("#"+t.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabCapacity+" .fht-fixed-body .fht-tfoot").css("width","calc(100vw - 100px)"));$("#"+i.prefix+Robotics.Client.Constants.TableNames.ColShifts).parent().scrollLeft($("#"+i.prefix+Robotics.Client.Constants.TableNames.Calendar).parent().scrollLeft())};Robotics.Client.Controls.roSchedulerCalendar.prototype.synchronizeSummaryLayout=function(n,t){return function(){n?(t!=null&&t.oBaseControl.pageLayout.center.children.tabsContainerLayout.south.state.isClosed&&t.oBaseControl.pageLayout.center.children.tabsContainerLayout.toggle("south"),t.loadResumeTables()):t==null||t.oBaseControl.pageLayout.center.children.tabsContainerLayout.south.state.isClosed||t.oBaseControl.pageLayout.center.children.tabsContainerLayout.toggle("south")}};Robotics.Client.Controls.roSchedulerCalendar.prototype.onresize=function(n){return function(){n.loadingFunctionExtended(!0);n.prepareFixedHeight();n.loadingFunctionExtended(!1)}};Robotics.Client.Controls.roSchedulerCalendar.prototype.loadingFunctionExtended=function(n){var t=this.oBaseControl;(t.isShowingLoader&&!n||!t.isShowingLoader&&n)&&(t.isShowingLoader=n,n?$("#loadingCalendar").show():t.pageLayout.east.state.isClosed?setTimeout(function(){t.typeView==Robotics.Client.Constants.TypeView.Planification?($("#"+t.prefix+"East-resizer").css("position","inherit"),$("#"+t.prefix+"Center").css("height",parseInt($("#"+t.prefix+"Center").css("height"),10)-20+"px"),$("#"+t.prefix+"Center").css("width",parseInt($("#"+t.prefix+"Center").css("width"),10)-20+"px")):($("#"+t.prefix+"Center").css("height",parseInt($("#"+t.prefix+"Center").css("height"),10)-20+"px"),$("#"+t.prefix+"Center").css("width",parseInt($("#"+t.prefix+"Center").css("width"),10)-20+"px"));setTimeout(function(){t.typeView==Robotics.Client.Constants.TypeView.Planification?($("#"+t.prefix+"East-resizer").css("position","absolute"),$("#"+t.prefix+"Center").css("height",parseInt($("#"+t.prefix+"Center").css("height"),10)+20+"px"),$("#"+t.prefix+"Center").css("width",parseInt($("#"+t.prefix+"Center").css("width"),10)+20+"px")):($("#"+t.prefix+"Center").css("height",parseInt($("#"+t.prefix+"Center").css("height"),10)+20+"px"),$("#"+t.prefix+"Center").css("width",parseInt($("#"+t.prefix+"Center").css("width"),10)+20+"px"));$("#loadingCalendar").hide()},50)},50):$("#loadingCalendar").hide(),t.loadingFunc(n))};Robotics.Client.Controls.roSchedulerCalendar.prototype.getContextMenuSelector=function(){var t=this,n=this.oBaseControl;return n.typeView==Robotics.Client.Constants.TypeView.Planification?n.viewRange==Robotics.Client.Constants.ViewRange.Daily?".calendarDailyBodyCell":".calendarOuterBodyCell":".reviewDailyBodyCell"};Robotics.Client.Controls.roSchedulerCalendar.prototype.getContextMenuHeaderSelector=function(){var n=this,t=this.oBaseControl;return".CalendarDayFixedHeader"};Robotics.Client.Controls.roSchedulerCalendar.prototype.processKeyUpEvent=function(){var n=this;n.cancelCurrentMultipleSelect(null,!1);n.cancelCurrentMultipleHeaderSelect(null,!1)};Robotics.Client.Controls.roSchedulerCalendar.prototype.processKeyDownEvent=function(n){var i=this,t=this.oBaseControl;t.ctrlDown&&n.keyCode==t.cKey&&(t.selectedMinHeaderColumn!=-1&&t.selectedMaxHeaderColumn!=-1?i.copyHeaderSelection(t.selectedHeaderContainer):i.copySelection(t.selectedContainer,!0,!0,!0));t.ctrlDown&&n.keyCode==t.vKey&&(t.selectionCopied?i.pasteSelection(t.selectedContainer):t.selectionHeaderCopied&&i.pasteHeaderSelection(t.selectedHeaderContainer))};Robotics.Client.Controls.roSchedulerCalendar.prototype.onDrop=function(n){var t=this.oBaseControl,s=t.oCalendar,i,u,o,f,r,e;if(this.setSingleSelectedObject($(this.dragTarget)),i=null,i=typeof n.srcElement!="undefined"?$(n.srcElement):$(n.originalEvent.target),typeof i.attr("data-IDShift")!="undefined"){u=JSON.parse(i.attr("data-AdvParameters"));o=!1;typeof u!="undefined"&&u!=null&&u.length>0&&u.find(function(n){return n.Name.toLowerCase()=="starter"&&n.Value=="1"})!=null&&(o=!0);t.showAssignmentsDialog=!1;t.showStarterDialog=!1;t.showComplementaryAssignDialog=!1;o?t.showStarterDialog=!0:(parseInt(i.attr("data-AllowAssignments"),10)==1&&(t.showAssignmentsDialog=!0),(parseInt(i.attr("data-AllowComplementary"),10)==1||parseInt(i.attr("data-AllowFloatingData"),10)==1)&&(t.showComplementaryAssignDialog=!0));f=Robotics.Client.Constants.ShiftType.Normal;switch(i.attr("data-ShiftType")){case"0":f=Robotics.Client.Constants.ShiftType.Normal;break;case"1":t.showComplementaryAssignDialog=!0;f=Robotics.Client.Constants.ShiftType.NormalFloating;break;case"2":f=Robotics.Client.Constants.ShiftType.Holiday;break;case"3":f=Robotics.Client.Constants.ShiftType.Holiday_NonWorking}r={ID:parseInt(i.attr("data-IDShift"),10),ShortName:i.attr("data-ShortName"),PlannedHours:parseFloat(i.attr("data-ShiftHours")),Color:i.attr("data-ShiftColor"),Name:i.attr("data-Name"),Type:f,StartHour:moment(i.attr("data-StartHour"),"YYYY/MM/DD HH:mm").toDate(),AdvancedParameters:u};i.attr("data-EndHour")!=""&&(r.EndHour=moment(i.attr("data-EndHour"),"YYYY/MM/DD HH:mm").toDate());t.showComplementaryAssignDialog||t.showAssignmentsDialog||t.showStarterDialog?(t.showComplementaryAssignDialog&&(t.complementaryShift=r),t.showAssignmentsDialog&&(t.assignmentShift=r),t.showStarterDialog&&(t.starterShift=r),typeof t.shiftsExtendedDataCache[r.ID]=="undefined"?(e={},e.idShift=r.ID,e.StampParam=(new Date).getMilliseconds(),t.performAction(e,Robotics.Client.Constants.Actions.ShiftLayerDefinition)):t.showComplementaryAssignDialog?t.prepareComplementaryDialog(null):t.showAssignmentsDialog?t.prepareAssignmentsDialog(null):t.showStarterDialog&&t.prepareStarterDialog(null)):(t.complementaryShift=null,t.assignmentShift=null,t.isBatchMode()?r.Type==Robotics.Client.Constants.ShiftType.Normal||r.Type==Robotics.Client.Constants.ShiftType.NormalFloating?this.assignShiftToDayBatch(r,null,null,!1,!0,!0):this.assignShiftToDayBatch(null,r,undefined,undefined,!0,!0):r.Type==Robotics.Client.Constants.ShiftType.Normal||r.Type==Robotics.Client.Constants.ShiftType.NormalFloating?this.assignShiftToDay(t.selectedContainer,t.selectedDay,r,null,null,!1,!0,!0,t.selectedEmployee.EmployeeData):this.assignShiftToDay(t.selectedContainer,t.selectedDay,null,r,t.selectedDay.AssigData,t.selectedDay.AllowAssignment,!0,!0,t.selectedEmployee.EmployeeData),this.waitForUserToRefresh())}};Robotics.Client.Controls.roSchedulerCalendar.prototype.alteLoadPunchesModeAndReload=function(){var t=this,n=this.oBaseControl;n.loadPunches=n.loadPunches==!1?!0:!1;n.loadPunches?($(".LoadPunches").addClass("showPunches-active"),$(".LoadPunches").removeClass("showPunches-inactive")):($(".LoadPunches").removeClass("showPunches-active"),$(".LoadPunches").addClass("showPunches-inactive"));n.setFiltersCookieValue();t.loadData()};Robotics.Client.Controls.roSchedulerCalendar.prototype.alterLoadCapacitiesModeAndReload=function(){var t=this,n=this.oBaseControl;n.loadCapacities=n.loadCapacities==!1?!0:!1;n.loadCapacities?($(".LoadCapacities").addClass("showCapacities-active"),$(".LoadCapacities").removeClass("showCapacities-inactive")):($(".LoadCapacities").removeClass("showCapacities-active"),$(".LoadCapacities").addClass("showCapacities-inactive"));n.setFiltersCookieValue();n.hasChanges||t.loadData()};Robotics.Client.Controls.roSchedulerCalendar.prototype.alterLoadIndictmentsModeAndReload=function(){var t=this,n=this.oBaseControl;n.loadIndictments=n.isScheduleActive||n.saasPremiumActive?n.loadIndictments==!1?!0:!1:!1;n.loadIndictments?($(".LoadIndictments").addClass("showIndictments-active"),$(".LoadIndictments").removeClass("showIndictments-inactive")):($(".LoadIndictments").removeClass("showIndictments-active"),$(".LoadIndictments").addClass("showIndictments-inactive"));n.setFiltersCookieValue();n.hasChanges?n.loadIndictments?t.checkCalendarIndictments():n.refreshTables(this,!1,!0):t.loadData()};Robotics.Client.Controls.roSchedulerCalendar.prototype.changeDailyPeriod=function(){var n=this.oBaseControl;n.showDailyConfig()};Robotics.Client.Controls.roSchedulerCalendar.prototype.setRecursiveData=function(){var n=this.oBaseControl,t=n.oCalendar;n.loadRecursive=!n.loadRecursive;n.loadRecursive?($(".RecursiveAction").addClass("minimizeGroup"),$(".RecursiveAction").removeClass("expandGroup")):($(".RecursiveAction").removeClass("minimizeGroup"),$(".RecursiveAction").addClass("expandGroup"));n.setFiltersCookieValue()};Robotics.Client.Controls.roSchedulerCalendar.prototype.changeLoadRecursive=function(){var n=this.oBaseControl,t=n.oCalendar;this.setRecursiveData();n.refresh()};Robotics.Client.Controls.roSchedulerCalendar.prototype.mapModeEvents=function(){var t=this,n=this.oBaseControl,i=n.viewRange==Robotics.Client.Constants.ViewRange.Daily?".calendarDailyBodyCell":".calendarOuterBodyCell";$(".fullCalendarShow").off("click");$(".fullCalendarShow").on("click",function(){var t="Scheduler/AnnualView.aspx?EmployeeID="+$(this).attr("data-IDEmployee")+"&Year="+n.firstDate.getFullYear();parent.ShowExternalForm2(t,950,560,"","",!0,!1,!1)});$(i+",.reviewDailyBodyCell").off("click");$(i+",.reviewDailyBodyCell").on("click",function(){n.shiftDown?t.selectMultiple(n.selectedContainer,this):t.setSingleSelectedObject(this)});$(".RecursiveAction").off("click");$(".RecursiveAction").on("click",function(){n.hasChanges==!1?t.changeLoadRecursive():n.showChangesWarning(n.clientInstanceName+".clientMode.changeLoadRecursive();")});$(".DailyPeriod").off("click");$(".DailyPeriod").on("click",function(){n.hasChanges==!1?t.changeDailyPeriod():n.showChangesWarning(n.clientInstanceName+".clientMode.changeDailyPeriod();")});$(".LoadIndictments").off("click");$(".LoadIndictments").on("click",function(){t.alterLoadIndictmentsModeAndReload()});$(".LoadCapacities").off("click");$(".LoadCapacities").on("click",function(){t.alterLoadCapacitiesModeAndReload()});$(".LoadPunches").off("click");$(".LoadPunches").on("click",function(){t.alteLoadPunchesModeAndReload()});$(".FilterAction").off("click");$(".FilterAction").on("click",function(){n.hasChanges==!1?n.openFilterAssignments():n.showChangesWarning(n.clientInstanceName+".openFilterAssignments();")});$(i+",.reviewDailyBodyCell").off("dblclick");$(i+",.reviewDailyBodyCell").on("dblclick",function(){t.enterDetailAction($(this).attr("data-IDGroup"),$(this).attr("data-IDEmployee"),$(this).attr("data-Date"))});$(i).off("dragenter");$(i).off("dragover");$(i).on("dragenter",function(n){return t.dragTarget=this,n.preventDefault(),!1});$(i).on("dragover",function(n){return t.dragTarget=this,n.preventDefault(),!1});if(n.typeView==Robotics.Client.Constants.TypeView.Planification&&n.viewRange!=Robotics.Client.Constants.ViewRange.Daily){try{$("#"+n.prefix+Robotics.Client.Constants.TableNames.Calendar+"_tbody").selectableScroll("destroy")}catch(r){}$("#"+n.prefix+Robotics.Client.Constants.TableNames.Calendar+"_tbody").selectableScroll({distance:10,filter:".calendarOuterBodyCell",stop:function(){t.endSelectOperation()},scrollElement:$("#"+n.prefix+Robotics.Client.Constants.LayoutNames.Calendar+" .fht-fixed-body .fht-tbody")})}else try{$("#"+n.prefix+Robotics.Client.Constants.TableNames.Calendar+"_tbody").selectableScroll("destroy")}catch(r){}if(n.isScheduleActive&&n.typeView==Robotics.Client.Constants.TypeView.Planification){if(n.viewRange==Robotics.Client.Constants.ViewRange.Period&&n.isScheduleActive){try{$("#"+n.prefix+Robotics.Client.Constants.TableNames.Calendar+"_thead").selectableScroll("destroy")}catch(r){}$("#"+n.prefix+Robotics.Client.Constants.TableNames.Calendar+"_thead").selectableScroll({distance:10,filter:".CalendarDayFixedHeader",stop:function(){t.endHeaderSelectOperation()},scrollElement:$("#"+n.prefix+Robotics.Client.Constants.LayoutNames.Calendar+" .fht-fixed-body .fht-thead")})}$(".CalendarDayFixedHeader").off("click");$(".CalendarDayFixedHeader").on("click",function(){n.shiftDown?t.selectHeaderMultiple(n.selectedHeaderContainer,this):t.setSingleHeaderSelectedObejct(this)})}else{$(".CalendarDayFixedHeader").off("click");try{$("#"+n.prefix+Robotics.Client.Constants.TableNames.Calendar+"_thead").selectableScroll("destroy")}catch(r){}$.contextMenu("destroy",".CalendarDayFixedHeader")}n.viewRange==Robotics.Client.Constants.ViewRange.Daily&&($("#"+n.prefix+"Main div.fht-fixed-body div.fht-tbody").scrollLeft((n.firstCellPrinted-n.getMinDailyCell()-2)*30),n.firstCellPrinted=-1);window.focus()};Robotics.Client.Controls.roSchedulerCalendar.prototype.refreshModeTables=function(n,t,i){var r=this;n!=null&&(r=n instanceof Robotics.Client.Controls.roCalendar?n.clientMode:n);i&&(this.bRelatedTables=!0,this.clearRelatedTables(),r.refreshCalendarTable(t));i&&this.prepareFixedHeight();this.refreshTooltips()};Robotics.Client.Controls.roSchedulerCalendar.prototype.loadSouthTables=function(){var n=this;if(n.resumeInfoLoaded)switch(n.columnTableVisible){case 1:n.refreshColumnShiftTable();break;case 2:n.refreshColumnassignmentsTable();break;case 3:n.refreshColumnIndictmentsTable();break;case 4:n.refreshColumnCapacityTable()}};Robotics.Client.Controls.roSchedulerCalendar.prototype.loadLeftTables=function(){var n=this,t;if(n.resumeInfoLoaded)switch(n.rowTableVisible){case 1:n.refreshrowAccrualsTable();t=!0;$("#ctl00_contentMainBody_oCalendar_hdnHolidayShiftPeriodicity").val()=="L"&&(t=!1);n.refreshRelatedTooltips(t);break;case 2:n.refreshrowShiftsTable();break;case 3:n.refreshrowAssignmentsTable()}};Robotics.Client.Controls.roSchedulerCalendar.prototype.loadResumeTables=function(){var n=this;if(n.resumeInfoLoaded)switch(n.rowTableVisible){case 1:n.refreshrowAccrualsTotalTable()}};Robotics.Client.Controls.roSchedulerCalendar.prototype.loadRelatedTables=function(){var n=this,t=this.oBaseControl;this.oBaseControl.mapEvents();this.resumeInfoLoaded&&(n.oBaseControl.typeView==Robotics.Client.Constants.TypeView.Planification?(n.oBaseControl.pageLayout.center.children.tabsContainerLayout.south.state.isClosed||n.loadSouthTables(),n.oBaseControl.pageLayout.east.state.isClosed||n.loadLeftTables(),n.oBaseControl.pageLayout.center.children.tabsContainerLayout.south.state.isClosed||n.oBaseControl.pageLayout.east.state.isClosed||n.loadResumeTables(),n.oBaseControl.pageLayout.show("east"),n.oBaseControl.pageLayout.center.children.tabsContainerLayout.show("south")):(n.oBaseControl.pageLayout.hide("east"),n.oBaseControl.pageLayout.center.children.tabsContainerLayout.hide("south")),$("#"+t.prefix+Robotics.Client.Constants.TableNames.ColShifts).parent().scrollLeft($("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).parent().scrollLeft()),$("#"+t.prefix+Robotics.Client.Constants.TableNames.RowAccruals).parent().scrollTop($("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).parent().scrollTop()),$("#"+t.prefix+Robotics.Client.Constants.TableNames.RowShifts).parent().scrollTop($("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).parent().scrollTop()),$("#"+t.prefix+Robotics.Client.Constants.TableNames.RowAssignments).parent().scrollTop($("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).parent().scrollTop()),this.prepareFixedHeight(),$("#tabColumnWaiting").hide(),$("#tabRowWaiting").hide(),$("#tabResumeWaiting").hide());this.bRelatedTables=!1};Robotics.Client.Controls.roSchedulerCalendar.prototype.refreshTooltips=function(){var n=this.oBaseControl,t=this;if(n.loadIndictments==!0){$(".indictments_target").off("mouseover");$(".indictments_target").on("mouseover",function(){var n=$(this).find(".tooltipIndictmentsContainer"),t;n.length!=0&&(t=this.id,$(n).dxTooltip({target:"#"+t,hideEvent:"mouseleave",position:"bottom"}),$(n).dxTooltip("instance").show())})}if(n.typeView==Robotics.Client.Constants.TypeView.Review&&n.loadPunches){$(".punchTooltipTarget").off("mouseover");$(".punchTooltipTarget").on("mouseover",function(){var n=$(this).find(".tooltipPunchesReviewContainer"),t;n.length!=0&&(t=this.id,$(n).dxTooltip({target:"#"+t,hideEvent:"mouseleave",position:"bottom"}),$(n).dxTooltip("instance").show())})}};Robotics.Client.Controls.roSchedulerCalendar.prototype.refreshRelatedTooltips=function(n=true){var i=this.oBaseControl,t=this;if(t.rowTableVisible){if(n){$(".resumeHolidayCell").off("mouseover");$(".resumeHolidayCell").on("mouseover",function(){var n=$(this).find(".tooltipHolidaysContainer"),t,i;n.length!=0&&(t=this.id,i=t.replace("_tooltipHolidays_","_tooltipTarget_"),$(n).dxTooltip({target:"#"+i,hideEvent:"mouseleave",position:"bottom"}),$(n).dxTooltip("instance").show())})}$(".resumeAccrualCell").off("mouseover");$(".resumeAccrualCell").on("mouseover",function(){var n=$(this).find(".tooltipAccrualsContainer"),t,i;n.length!=0&&(t=this.id,i=t.replace("_tooltipAccruals_","_tooltipTarget_"),$(n).dxTooltip({target:"#"+i,hideEvent:"mouseleave",position:"bottom"}),$(n).dxTooltip("instance").show())})}};Robotics.Client.Controls.roSchedulerCalendar.prototype.clearRelatedTables=function(){var t=this.oBaseControl,n;try{n=$("#"+t.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabShifts);n.empty()}catch(i){}try{n=$("#"+t.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabAssignments);n.empty()}catch(i){}try{n=$("#"+t.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabIndictments);n.empty()}catch(i){}try{n=$("#"+t.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabCapacity);n.empty()}catch(i){}try{n=$("#"+t.prefix+Robotics.Client.Constants.LayoutNames.RowTabAccruals);n.empty()}catch(i){}try{n=$("#"+t.prefix+Robotics.Client.Constants.LayoutNames.RowTabShifts);n.empty()}catch(i){}try{n=$("#"+t.prefix+Robotics.Client.Constants.LayoutNames.RowTabAssignments);n.empty()}catch(i){}try{n=$("#"+t.prefix+Robotics.Client.Constants.LayoutNames.Resume);n.empty()}catch(i){}};Robotics.Client.Controls.roSchedulerCalendar.prototype.refreshCalendarTable=function(n){var t=this.oBaseControl;try{$("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).fixedHeaderTable("destroy");$("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).find("tfoot").each(function(){this.id==""&&$(this).remove()})}catch(i){}n||this.createResumeTables(Robotics.Client.Constants.TableNames.Calendar,Robotics.Client.Constants.LayoutNames.Calendar);this.fixedCalendarTable=$("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).fixedHeaderTable({altClass:"odd",footer:t.isScheduleActive,fixedColumn:!0})};Robotics.Client.Controls.roSchedulerCalendar.prototype.refreshColumnShiftTable=function(){var n=this.oBaseControl;try{$("#"+n.prefix+Robotics.Client.Constants.TableNames.ColShifts).fixedHeaderTable("destroy");$("#"+n.prefix+Robotics.Client.Constants.TableNames.ColShifts).find("tfoot").each(function(){this.id==""&&$(this).remove()})}catch(t){}this.createResumeTables(Robotics.Client.Constants.TableNames.ColShifts,Robotics.Client.Constants.LayoutNames.ColumnTabShifts);$("#"+n.prefix+Robotics.Client.Constants.TableNames.ColShifts).fixedHeaderTable({altClass:"odd",footer:!0,fixedColumn:!0});$("#"+n.prefix+Robotics.Client.Constants.TableNames.Calendar).parent().on("scroll",function(){$("#"+n.prefix+Robotics.Client.Constants.TableNames.ColShifts).parent().scrollLeft($(this).scrollLeft())})};Robotics.Client.Controls.roSchedulerCalendar.prototype.refreshColumnassignmentsTable=function(){var n=this.oBaseControl;try{$("#"+n.prefix+Robotics.Client.Constants.TableNames.ColAssignments).fixedHeaderTable("destroy");$("#"+n.prefix+Robotics.Client.Constants.TableNames.ColAssignments).find("tfoot").each(function(){this.id==""&&$(this).remove()})}catch(t){}n.isScheduleActive&&this.createResumeTables(Robotics.Client.Constants.TableNames.ColAssignments,Robotics.Client.Constants.LayoutNames.ColumnTabAssignments);$("#"+n.prefix+Robotics.Client.Constants.TableNames.ColAssignments).fixedHeaderTable({altClass:"odd",footer:!0,fixedColumn:!0});$("#"+n.prefix+Robotics.Client.Constants.TableNames.Calendar).parent().on("scroll",function(){$("#"+n.prefix+Robotics.Client.Constants.TableNames.ColAssignments).parent().scrollLeft($(this).scrollLeft())})};Robotics.Client.Controls.roSchedulerCalendar.prototype.refreshColumnIndictmentsTable=function(){var n=this.oBaseControl;(n.isScheduleActive||n.saasPremiumActive)&&this.createResumeTables(Robotics.Client.Constants.TableNames.ColIndictments,Robotics.Client.Constants.LayoutNames.ColumnTabIndictments)};Robotics.Client.Controls.roSchedulerCalendar.prototype.refreshColumnCapacityTable=function(){var n=this.oBaseControl;if(n.telecommuteEnabled){try{$("#"+n.prefix+Robotics.Client.Constants.TableNames.ColCapacity).fixedHeaderTable("destroy");$("#"+n.prefix+Robotics.Client.Constants.TableNames.ColCapacity).find("tfoot").each(function(){this.id==""&&$(this).remove()})}catch(t){}this.createResumeTables(Robotics.Client.Constants.TableNames.ColCapacity,Robotics.Client.Constants.LayoutNames.ColumnTabCapacity);$("#"+n.prefix+Robotics.Client.Constants.TableNames.ColCapacity).fixedHeaderTable({altClass:"odd",footer:!0,fixedColumn:!0});$("#"+n.prefix+Robotics.Client.Constants.TableNames.Calendar).parent().on("scroll",function(){$("#"+n.prefix+Robotics.Client.Constants.TableNames.ColCapacity).parent().scrollLeft($(this).scrollLeft())})}};Robotics.Client.Controls.roSchedulerCalendar.prototype.refreshrowAccrualsTable=function(){var n=this.oBaseControl;try{$("#"+n.prefix+Robotics.Client.Constants.TableNames.RowAccruals).fixedHeaderTable("destroy");$("#"+n.prefix+Robotics.Client.Constants.TableNames.RowAccruals).find("tfoot").each(function(){this.id==""&&$(this).remove()})}catch(t){}this.createResumeTables(Robotics.Client.Constants.TableNames.RowAccruals,Robotics.Client.Constants.LayoutNames.RowTabAccruals);$("#"+n.prefix+Robotics.Client.Constants.TableNames.RowAccruals).fixedHeaderTable({altClass:"odd",footer:n.isScheduleActive,height:$("#"+n.prefix+Robotics.Client.Constants.LayoutNames.Calendar).find(".fht-fixed-body")[0].clientHeight-15});$("#"+n.prefix+Robotics.Client.Constants.TableNames.Calendar).parent().on("scroll",function(){$("#"+n.prefix+Robotics.Client.Constants.TableNames.RowAccruals).parent().scrollTop($(this).scrollTop())})};Robotics.Client.Controls.roSchedulerCalendar.prototype.refreshrowShiftsTable=function(){var n=this.oBaseControl;try{$("#"+n.prefix+Robotics.Client.Constants.TableNames.RowShifts).fixedHeaderTable("destroy");$("#"+n.prefix+Robotics.Client.Constants.TableNames.RowShifts).find("tfoot").each(function(){this.id==""&&$(this).remove()})}catch(t){}this.createResumeTables(Robotics.Client.Constants.TableNames.RowShifts,Robotics.Client.Constants.LayoutNames.RowTabShifts);$("#"+n.prefix+Robotics.Client.Constants.TableNames.RowShifts).fixedHeaderTable({altClass:"odd",footer:n.isScheduleActive,height:$("#"+n.prefix+Robotics.Client.Constants.LayoutNames.Calendar).find(".fht-fixed-body")[0].clientHeight-19});$("#"+n.prefix+Robotics.Client.Constants.TableNames.Calendar).parent().on("scroll",function(){$("#"+n.prefix+Robotics.Client.Constants.TableNames.RowShifts).parent().scrollTop($(this).scrollTop())})};Robotics.Client.Controls.roSchedulerCalendar.prototype.refreshrowAssignmentsTable=function(){var n=this.oBaseControl;try{$("#"+n.prefix+Robotics.Client.Constants.TableNames.RowAssignments).fixedHeaderTable("destroy");$("#"+n.prefix+Robotics.Client.Constants.TableNames.RowAssignments).find("tfoot").each(function(){this.id==""&&$(this).remove()})}catch(t){}n.isScheduleActive&&this.createResumeTables(Robotics.Client.Constants.TableNames.RowAssignments,Robotics.Client.Constants.LayoutNames.RowTabAssignments);$("#"+n.prefix+Robotics.Client.Constants.TableNames.RowAssignments).fixedHeaderTable({altClass:"odd",footer:n.isScheduleActive,height:$("#"+n.prefix+Robotics.Client.Constants.LayoutNames.Calendar).find(".fht-fixed-body")[0].clientHeight-19});$("#"+n.prefix+Robotics.Client.Constants.TableNames.Calendar).parent().on("scroll",function(){$("#"+n.prefix+Robotics.Client.Constants.TableNames.RowAssignments).parent().scrollTop($(this).scrollTop())})};Robotics.Client.Controls.roSchedulerCalendar.prototype.refreshrowAccrualsTotalTable=function(){var n=this.oBaseControl;try{$("#"+n.prefix+Robotics.Client.Constants.TableNames.AccrualTotals).fixedHeaderTable("destroy");$("#"+n.prefix+Robotics.Client.Constants.TableNames.AccrualTotals).find("tfoot").each(function(){this.id==""&&$(this).remove()})}catch(t){}this.createResumeTables(Robotics.Client.Constants.TableNames.AccrualTotals,Robotics.Client.Constants.LayoutNames.Resume);$("#"+n.prefix+Robotics.Client.Constants.TableNames.AccrualTotals).fixedHeaderTable({altClass:"odd",footer:!0,fixedColumn:!1})};Robotics.Client.Controls.roSchedulerCalendar.prototype.clickColumnShiftsTableHeader=function(n){return function(){n.columnTableVisible!=1&&(n.columnTableVisible=1,n.refreshColumnShiftTable(),n.prepareFixedHeight())}};Robotics.Client.Controls.roSchedulerCalendar.prototype.clickColumnAssignmentsTableHeader=function(n){return function(){n.columnTableVisible!=2&&(n.columnTableVisible=2,n.refreshColumnassignmentsTable(),n.prepareFixedHeight())}};Robotics.Client.Controls.roSchedulerCalendar.prototype.clickColumnIndictmentsTableHeader=function(n){return function(){n.columnTableVisible!=3&&(n.columnTableVisible=3,n.refreshColumnIndictmentsTable(),n.prepareFixedHeight())}};Robotics.Client.Controls.roSchedulerCalendar.prototype.clickColumnCapacityTableHeader=function(n){return function(){n.columnTableVisible!=4&&(n.columnTableVisible=4,n.refreshColumnCapacityTable(),n.prepareFixedHeight())}};Robotics.Client.Controls.roSchedulerCalendar.prototype.clickRowAccrualsTableHeader=function(n){var t=this;return function(){n.rowTableVisible!=1&&(n.rowTableVisible=1,n.refreshrowAccrualsTable(),n.refreshrowAccrualsTotalTable(),t.refreshTooltips(),t.refreshRelatedTooltips(),n.prepareFixedHeight())}};Robotics.Client.Controls.roSchedulerCalendar.prototype.clickRowShiftsTableHeader=function(n){return function(){n.rowTableVisible!=2&&(n.rowTableVisible=2,n.refreshrowShiftsTable(),n.prepareFixedHeight())}};Robotics.Client.Controls.roSchedulerCalendar.prototype.clickRowAssignmentsTableHeader=function(n){return function(){n.rowTableVisible!=3&&(n.rowTableVisible=3,n.refreshrowAssignmentsTable(),n.prepareFixedHeight())}};Robotics.Client.Controls.roSchedulerCalendar.prototype.createResumeTables=function(n,t){switch(n){case Robotics.Client.Constants.TableNames.Calendar:this.createCalendarTable(n,t);break;case Robotics.Client.Constants.TableNames.ColShifts:this.createColumnShiftsTable(n,t);break;case Robotics.Client.Constants.TableNames.ColAssignments:this.createColumnAssignmentsTable(n,t);break;case Robotics.Client.Constants.TableNames.ColCapacity:this.createCapacityTable(n,t);break;case Robotics.Client.Constants.TableNames.ColIndictments:this.createIndictmentscolumnTable(n,t);break;case Robotics.Client.Constants.TableNames.RowAccruals:this.createAccrualsTable(n,t);break;case Robotics.Client.Constants.TableNames.RowShifts:this.createShiftsRowTable(n,t);break;case Robotics.Client.Constants.TableNames.RowAssignments:this.createAssignmentsRowTable(n,t);break;case Robotics.Client.Constants.TableNames.AccrualTotals:this.createAcrrualTotalsTable(n,t)}};Robotics.Client.Controls.roSchedulerCalendar.prototype.createCalendarTable=function(n,t){var i=this.oBaseControl,r=i.oCalendar,u,e,f;if(typeof r.CalendarShift!="undefined"&&r.CalendarShift!=null&&r.CalendarShift.length>0)for(i.shiftsExtendedDataCache={},u=0;u<r.CalendarShift.length;u++)typeof i.shiftsExtendedDataCache[r.CalendarShift[u].IDShift]=="undefined"&&(i.shiftsExtendedDataCache[r.CalendarShift[u].IDShift]=r.CalendarShift[u]);e=$("#"+i.prefix+t);e.empty();f=$("<table><\/table>").attr("id",i.prefix+n).attr("class","fancyTable");f.append(this.createCalendarTableHeader(n,t));f.append(this.createCalendarTableBody(n,t));i.isScheduleActive&&f.append(this.createCalendarTableFooter(n,t));e.append(f)};Robotics.Client.Controls.roSchedulerCalendar.prototype.createCalendarTableHeader=function(n){var t=this.oBaseControl,r=t.oCalendar,v=$("<thead><\/thead>").attr("id",t.prefix+n+"_thead").attr("class","HeaderSelectable"),f=$("<tr><\/tr>"),d=$("<th><\/th>"),g=$("<div><\/div>").attr("class","CalendarFixed CalendarFixedHeader"),y=$("<div><\/div>").attr("class","CalendarEmployeeFixed CalendarEmployeeFixedHeader"),h=$("<div><\/div>").attr("class","NorthCell NorthCellHeaderEmployee"),w,o,b,c,l,a,i,s,u,k;h.append($("<div><\/div>").attr("class","EmpCellTextNorth").html(r.CalendarHeader.EmployeeHeaderData.Row1Text));var p=$("<div><\/div>").attr("class","RecursiveAction "+(t.loadRecursive?"minimizeGroup":"expandGroup")).attr("style","float:left").attr("title",t.loadRecursive?t.translator.translate(Robotics.Client.Language.Tags.Scheduler_Recursive):t.translator.translate(Robotics.Client.Language.Tags.Scheduler_NonRecursive)),nt=$("<div><\/div>").attr("class","LoadIndictments "+(t.loadIndictments==!1?"showIndictments-inactive":"showIndictments-active")).attr("style","float:left;padding-left:7px;").attr("title",Globalize.formatMessage("roShowIndictments")),tt=$("<div><\/div>").attr("class","LoadCapacities "+(t.loadCapacities==!1?"showCapacities-inactive":"showCapacities-active")).attr("style","float:left;padding-left:7px;").attr("title",Globalize.formatMessage("roShowCapacities")),it=$("<div><\/div>").attr("class","DailyPeriod interval-"+t.dailyPeriod).attr("style","float:left").attr("title",t.dailyPeriodDescription()),e=$("<div><\/div>").attr("class","EmpCellIconsNorth");if(t.typeView==Robotics.Client.Constants.TypeView.Review&&(w=$("<div><\/div>").attr("class","LoadPunches "+(t.loadPunches==!1?"showPunches-inactive":"showPunches-active")).attr("style","float:left;padding-left:7px;").attr("title",Globalize.formatMessage("roShowPunches")),e.append(w)),t.viewRange==Robotics.Client.Constants.ViewRange.Daily&&e.append(it),t.isScheduleActive||t.saasPremiumActive?e.append(nt,p,tt):e.append(p),h.append(e),o=$("<div><\/div>").attr("class","SouthCell"),o.append($("<div><\/div>").attr("class","EmpCellTextSouth").html(t.isScheduleActive==!1?"":r.CalendarHeader.EmployeeHeaderData.Row2Text+" - "+(t.schedulingView==Robotics.Client.Constants.CoverageDayView.Planified?t.translator.translate(Robotics.Client.Language.Tags.Scheduler_Planified):t.translator.translate(Robotics.Client.Language.Tags.Scheduler_Real)))),b=$("<div><\/div>").attr("class","FilterAction "+(t.assignmentsFilter==""?"filterGroup":"filter-activeGroup")).attr("title",t.translator.translate(Robotics.Client.Language.Tags.Scheduler_Filter)),o.append($("<div><\/div>").attr("class","EmpCellIconsSouth").append(t.isScheduleActive?b:"&nbsp;")),y.append(h,o),c=$("<div><\/div>").attr("class","CalendarSummaryFixed CalendarSummaryFixedHeader"),l=$("<div><\/div>").attr("class","NorthCell"),l.append($("<div><\/div>").attr("class","EmpCellTextNorth").html(r.CalendarHeader.SummaryHeaderData.Row1Text)),a=$("<div><\/div>").attr("class","SouthCell"),a.append($("<div><\/div>").attr("class","EmpCellTextSouth").html(r.CalendarHeader.SummaryHeaderData.Row2Text)),c.append(l,a),f.append(d.append(g.append(y,c))),t.viewRange==Robotics.Client.Constants.ViewRange.Daily)for(i=t.getMinDailyCell();i<t.getMaxDailyCell();i++)s=$("<th><\/th>"),u=$("<div><\/div>").attr("id",t.ascxPrefix+"_calHeaderCell_"+i).attr("class","CalendarDayFixed CalendarDayFixedHeader DailyCell").attr("data-IDColumn",i).attr("style","background:"+r.CalendarHeader.PeriodHeaderData[i].BackColor),u.append($("<div><\/div>").attr("class",t.isScheduleActive==!1?"NorthCellExpanded":"NorthCell dayInfo DailyCell").html(r.CalendarHeader.PeriodHeaderData[i].Row2Text)),t.isScheduleActive&&(t.sortColumn==i&&u.append($("<div><\/div>").attr("class","columnSorted")),u.append(this.buildCellScheduleStatus(0,!0).attr("id",t.ascxPrefix+"_IDHeaderCell_"+i))),f.append(s.append(u));else for(i=0;i<r.CalendarHeader.PeriodHeaderData.length;i++)s=$("<th><\/th>"),u=$("<div><\/div>").attr("id",t.ascxPrefix+"_calHeaderCell_"+i).attr("class","CalendarDayFixed CalendarDayFixedHeader").attr("data-IDColumn",i).attr("style","background:"+r.CalendarHeader.PeriodHeaderData[i].BackColor),u.append($("<div><\/div>").attr("class",t.isScheduleActive==!1?"NorthCellExpanded":"NorthCell dayInfo").html(r.CalendarHeader.PeriodHeaderData[i].Row1Text+"<\/br>"+r.CalendarHeader.PeriodHeaderData[i].Row2Text)),t.isScheduleActive&&(t.sortColumn==i&&u.append($("<div><\/div>").attr("class","columnSorted")),u.append(this.buildCellScheduleStatus(i,!0).attr("id",t.ascxPrefix+"_IDHeaderCell_"+i))),f.append(s.append(u));return k=$('<th style="width:100%"><\/th>').html("&nbsp;"),f.append(k),v.append(f),v};Robotics.Client.Controls.roSchedulerCalendar.prototype.createCalendarTableBody=function(n){var u=this.oBaseControl,i=u.oCalendar,h=$("<tbody><\/tbody>").attr("id",u.prefix+n+"_tbody").attr("class","bodySelectable"),y=-1,l=-1,r,f,e,c,s;if(i.CalendarData!=null&&i.CalendarData.length>0)for(r=0;r<i.CalendarData.length;r++){if(l=i.CalendarData[r].EmployeeData.IDGroup,u.sortColumn==-1&&l!=y){var t=$("<tr><\/tr>"),a=$("<td><\/td>").attr("class","calendarOuterBodyFixedSeparator"),v=$("<div><\/div>").attr("class","CalendarFixed CalendarFixedBody"),o=$("<div><\/div>").attr("class","CalendarEmployeeFixed CalendarEmployeeSepartaorBody").append($("<span><\/span>").html(i.CalendarData[r].EmployeeData.GroupName)),f=$("<div><\/div>").attr("class","CalendarSummaryFixed CalendarEmployeeSepartaorBody");for(t.append(a.append(v.append(o,f))),e=0;e<i.CalendarHeader.PeriodHeaderData.length;e++)c=$("<td><\/td>").attr("class","calendarOuterBodyFixedSeparator"),s=$("<div><\/div>"),u.viewRange==Robotics.Client.Constants.ViewRange.Period&&s.attr("class","calendarOuterBodyCellSeparator"),t.append(c.append(s));tmpCell=$('<td style="width:100%"><\/td>').html("&nbsp;");t.append(tmpCell);h.append(t)}var t=$("<tr><\/tr>"),a=$("<td><\/td>"),v=$("<div><\/div>").attr("class","CalendarFixed CalendarFixedBody"),o=$("<div><\/div>").attr("class","CalendarEmployeeFixed CalendarEmployeeFixedBody");o.append($("<div><\/div>").attr("class","EmployeeName").attr("title",i.CalendarData[r].EmployeeData.GroupName).html(i.CalendarData[r].EmployeeData.EmployeeName));o.append(this.generateEmployeeAssignments(i.CalendarData[r].EmployeeData,t));f=$("<div><\/div>").attr("class","CalendarSummaryFixed CalendarSummaryFixedBody");f.append(this.generateEmployeeAccrual(i.CalendarData[r].SummaryData));f.append(this.generateEmployeeAlerts(i.CalendarData[r].SummaryData));t.append(a.append(v.append(o,f)));u.typeView==Robotics.Client.Constants.TypeView.Planification?this.buildPlanificationRowView(r,t):u.typeView==Robotics.Client.Constants.TypeView.Review&&this.buildReviewRowView(r,t);tmpCell=$('<td style="width:100%"><\/td>').html("&nbsp;");t.append(tmpCell);h.append(t);y=l}else{var t=$("<tr><\/tr>"),a=$("<td><\/td>"),v=$("<div><\/div>").attr("class","CalendarFixed CalendarFixedBody"),o=$("<div><\/div>").attr("class","CalendarEmployeeFixed CalendarEmployeeFixedBody"),f=$("<div><\/div>").attr("class","CalendarSummaryFixed CalendarSummaryFixedBody");for(t.append(a.append(v.append(o,f))),e=0;e<i.CalendarHeader.PeriodHeaderData.length;e++)c=$("<td><\/td>"),s=$("<div><\/div>").attr("class","calendarOuterBodyCellInOtherDepartment"),t.append(c.append(s));tmpCell=$('<td style="width:100%"><\/td>').html("&nbsp;");t.append(tmpCell);h.append(t)}return h};Robotics.Client.Controls.roSchedulerCalendar.prototype.createCalendarTableFooter=function(n){var i=this.oBaseControl,o=i.oCalendar,e=$("<tfoot><\/tfoot>").attr("id",i.prefix+n+"_tfoot"),u=$("<tr><\/tr>"),s=$("<td><\/td>"),h=$("<div><\/div>").attr("class","CalendarFixed CalendarFixedFooter").html("&nbsp"),t,f,r;if(u.append(s.append(h)),i.viewRange==Robotics.Client.Constants.ViewRange.Daily)for(t=i.getMinDailyCell();t<i.getMaxDailyCell();t++)f=$("<td><\/td>"),r=$("<div><\/div>").attr("class","CalendarDayFixed CalendarDayFixedFooter DailyCell"),r.append(this.buildCellScheduleStatus(0,!1).attr("id",i.ascxPrefix+"_IDFooterCell_"+t)),u.append(f.append(r));else for(t=0;t<o.CalendarHeader.PeriodHeaderData.length;t++)f=$("<td><\/td>"),r=$("<div><\/div>").attr("class","CalendarDayFixed CalendarDayFixedFooter"),r.append(this.buildCellScheduleStatus(t,!1).attr("id",i.ascxPrefix+"_IDFooterCell_"+t)),u.append(f.append(r));return tmpCell=$('<td style="width:100%"><\/td>').html("&nbsp;"),u.append(tmpCell),e.append(u),e};Robotics.Client.Controls.roSchedulerCalendar.prototype.buildCellScheduleStatus=function(n,t){var f=this.oBaseControl,i=f.oCalendar,u=$("<div><\/div>").attr("class","SouthCell dayStatus"+(f.viewRange==Robotics.Client.Constants.ViewRange.Daily?" DailyCell":"")),e,r;if(f.typeView==Robotics.Client.Constants.TypeView.Planification&&typeof i.CalendarHeader.PeriodCoverageData!="undefined"&&i.CalendarHeader.PeriodCoverageData.length>0&&i.CalendarHeader.PeriodCoverageData[n].PlannedStatus!=Robotics.Client.Constants.CoverageDayStatus.WITHOUTCOVERAGE){if(e="",typeof i.CalendarHeader.PeriodCoverageData[n].AssignmentData!="undefined"&&i.CalendarHeader.PeriodCoverageData[n].AssignmentData.length>0)for(r=0;r<i.CalendarHeader.PeriodCoverageData[n].AssignmentData.length;r++)e+=f.schedulingView==Robotics.Client.Constants.CoverageDayView.Planified?"("+i.CalendarHeader.PeriodCoverageData[n].AssignmentData[r].Planned.toString().lpad("0",2)+"/"+i.CalendarHeader.PeriodCoverageData[n].AssignmentData[r].Expected.toString().lpad("0",2)+")  -"+i.CalendarHeader.PeriodCoverageData[n].AssignmentData[r].Name+" \n ":"("+i.CalendarHeader.PeriodCoverageData[n].AssignmentData[r].Actual.toString().lpad("0",2)+"/"+i.CalendarHeader.PeriodCoverageData[n].AssignmentData[r].Expected.toString().lpad("0",2)+")  -"+i.CalendarHeader.PeriodCoverageData[n].AssignmentData[r].Name+" \n ";if(t&&u.append($("<div><\/div>").attr("class","assignmentExists").attr("title",e)),f.schedulingView==Robotics.Client.Constants.CoverageDayView.Planified)switch(i.CalendarHeader.PeriodCoverageData[n].PlannedStatus){case Robotics.Client.Constants.CoverageDayStatus.OK:u.attr("style","background: #38e219;");break;case Robotics.Client.Constants.CoverageDayStatus.KO:u.attr("style","background: #ff2323;");break;case Robotics.Client.Constants.CoverageDayStatus.OVERLOAD:u.attr("style","background: #ffbb23;")}else switch(i.CalendarHeader.PeriodCoverageData[n].ActualStatus){case Robotics.Client.Constants.CoverageDayStatus.OK:u.attr("style","background: #38e219;");break;case Robotics.Client.Constants.CoverageDayStatus.KO:u.attr("style","background: #ff2323;");break;case Robotics.Client.Constants.CoverageDayStatus.OVERLOAD:u.attr("style","background: #ffbb23;")}}return u};Robotics.Client.Controls.roSchedulerCalendar.prototype.generateEmployeeAccrual=function(n){var t=this.oBaseControl,r=t.oCalendar,i=$("<div><\/div>").attr("class","EmployeeAccrual").html(t.ConvertHoursToHourFormat(n.Accrual*60));return n.Accrual<0&&i.attr("style","color:red"),i};Robotics.Client.Controls.roSchedulerCalendar.prototype.generateEmployeeAlerts=function(n){var t=this.oBaseControl,r=t.oCalendar,i=$("<div><\/div>").attr("class","EmployeeAlertsContainer");return(moment().startOf("day").isBetween(moment(r.FirstDay),moment(r.LastDay))||moment().startOf("day").isSame(moment(r.FirstDay)))&&n.Alerts!=null&&(n.Alerts.OnAbsenceDays&&i.append($("<div><\/div>").attr("class","calendarPlannedAbsence contentHorizontally").attr("title",t.translator.translate(Robotics.Client.Language.Tags.Tooltip_absence))),n.Alerts.OnAbsenceHours&&i.append($("<div><\/div>").attr("class","calendarPlannedIncidence contentHorizontally").attr("title",t.translator.translate(Robotics.Client.Language.Tags.Tooltip_incidence))),n.Alerts.OnOvertimesHours&&i.append($("<div><\/div>").attr("class","calendarPlannedOvertme contentHorizontally").attr("title",t.translator.translate(Robotics.Client.Language.Tags.Tooltip_overtime))),n.Alerts.OnHolidaysHours&&i.append($("<div><\/div>").attr("class","calendarPlannedHoliday contentHorizontally").attr("title",t.translator.translate(Robotics.Client.Language.Tags.Tooltip_plannedHoliday))),n.Alerts.OnHolidays&&i.append($("<div><\/div>").attr("class","calendarHolidays contentHorizontally").attr("title",t.translator.translate(Robotics.Client.Language.Tags.Tooltip_holidays))),n.Alerts.UnexpectedlyAbsent&&i.append($("<div><\/div>").attr("class","calendarUnexpectedlyAbsent contentHorizontally").attr("title",t.translator.translate(Robotics.Client.Language.Tags.Tooltip_absent)))),i};Robotics.Client.Controls.roSchedulerCalendar.prototype.generateEmployeeAssignments=function(n,t){var u=this.oBaseControl,c=u.oCalendar,f=$("<div><\/div>").attr("class","EmployeeAssignmentContainer"),e,o,r,i,s,h;if(u.isScheduleActive&&typeof n.Assignments!="undefined"&&n.Assignments!=null&&n.Assignments.length>0){for(e=$("<div><\/div>").attr("class","assignmentsContainerLeft"),o="",r=0;r<n.Assignments.length;r++)i=n.Assignments[r],s=$("<div><\/div>").attr("class","AssignmentCell").attr("style","background:"+i.Color+";color:"+(new Robotics.Client.Common.roHtmlColor).invertCssColor(i.Color)),s.attr("title",i.Name).html(i.ShortName.substring(0,2)),e.append(s),o+=i.ShortName+";";t.attr("data-filterData",o);f.append(e)}else t.attr("data-filterData","");return u.typeView!=Robotics.Client.Constants.TypeView.Review&&(h=$("<div><\/div>").attr("data-IDEmployee",n.IDEmployee).attr("class","fullCalendarShow").attr("style","float: right;margin-top: 8px;"),f.append(h)),f};Robotics.Client.Controls.roSchedulerCalendar.prototype.buildPlanificationRowView=function(n,t){var r=this.oBaseControl,f=r.oCalendar,e=f.CalendarData[n].EmployeeData,u=f.CalendarData[n].PeriodData.DayData,i;if(r.viewRange==Robotics.Client.Constants.ViewRange.Daily)for(i=r.getMinDailyCell();i<r.getMaxDailyCell();i++)t.append(this.createDailyCalendarCell(e,u[0],u[0].HourData[i],n,i));else if(r.viewRange==Robotics.Client.Constants.ViewRange.Period)for(i=0;i<u.length;i++)t.append(this.createCalendarCell(e,u[i],n,i))};Robotics.Client.Controls.roSchedulerCalendar.prototype.createDailyCalendarCell=function(n,t,i,r,u){var e=this.oBaseControl,s=e.oCalendar,o=$("<td><\/td>"),f;return u%2==0&&o.addClass("columnDailyCalendarOdd"),f=$("<div><\/div>").attr("id",e.ascxPrefix+"_calDailyCell_"+r+"_"+u).attr("class","calendarDailyBodyCell DailyCell").attr("data-IDEmployee",n.IDEmployee).attr("data-IDGroup",n.IDGroup),f.attr("data-IDRow",r).attr("data-IDColumn",u).attr("data-Date",moment(t.PlanDate).format("DD/MM/YYYY")),this.createDailyCalendarCellContent(f,n,t,i,u),o.append(f)};Robotics.Client.Controls.roSchedulerCalendar.prototype.createDailyCalendarCellContent=function(n,t,i,r,u){var h=this.oBaseControl,d=h.oCalendar,l=$("<div><\/div>").attr("class","calendarDailyInnerBodyCell"),p=null,w=null,s=this.getAssignedShift(i),e,o,v,c;if(r.DailyHourType!=Robotics.Client.Constants.DailyHourType.Untyped||s!=null&&s.PlannedHours==0&&(i.ShiftBase==null||i.ShiftBase!=null&&i.ShiftBase.PlannedHours==0)){i.Locked&&l.addClass("dailyLock");var f="#ffffff",b="",a="",k="",y="";h.isScheduleActive&&(typeof i.AssigData!="undefined"&&i.AssigData!=null?(k=" ("+i.AssigData.Name+")",a="border-bottom: 8px "+i.AssigData.Color+" solid;",y="margin-top: -30px;"):(a="border-bottom: 8px #F2F4F2 solid;",y="margin-top: -30px;"));s!=null&&(f=s.Color,b=s.Name);switch(r.DailyHourType){case Robotics.Client.Constants.DailyHourType.Mandatory:f=f;break;case Robotics.Client.Constants.DailyHourType.Flexible:f=(new Robotics.Client.Common.roHtmlColor).shadeBlendConvert(.5,f);break;case Robotics.Client.Constants.DailyHourType.Complementary:f=(new Robotics.Client.Common.roHtmlColor).shadeBlendConvert(-.5,f)}if((h.firstCellPrinted==-1&&r.DailyHourType!=Robotics.Client.Constants.DailyHourType.Untyped||u<h.firstCellPrinted)&&(h.firstCellPrinted=u),r.IsHoursAbsence||r.IsHoursHoliday?(e=(new Robotics.Client.Common.roHtmlColor).shadeBlendConvert(.5,f),o="",o+="background: "+f+";",o+="background: -moz-linear-gradient(top, "+f+" 0%, "+e+" 50%, "+e+" 50%, "+e+" 50%, "+f+" 100%);",o+="background: -webkit-gradient(left top, left bottom, color-stop(0%, "+f+"), color-stop(50%, "+e+"), color-stop(50%, "+e+"), color-stop(50%, "+e+"), color-stop(100%, "+f+"));",o+="background: -webkit-linear-gradient(top, "+f+" 0%, "+e+" 50%, "+e+" 50%, "+e+" 50%, "+f+" 100%);",o+="background: -o-linear-gradient(top, "+f+" 0%, "+e+" 50%, "+e+" 50%, "+e+" 50%, "+f+" 100%);",o+="background: -ms-linear-gradient(top, "+f+" 0%, "+e+" 50%, "+e+" 50%, "+e+" 50%, "+f+" 100%);",o+="background: linear-gradient(to bottom, "+f+" 0%, "+e+" 50%, "+e+" 50%, "+e+" 50%, "+f+" 100%);",o+='filter: progid:DXImageTransform.Microsoft.gradient( startColorstr="'+f+'", endColorstr="'+f+'", GradientType=0 );',l.attr("style",o+a)):l.attr("style","background: "+f+";"+a),(u==0||u>0&&i.HourData[u-1].DailyHourType==Robotics.Client.Constants.DailyHourType.Untyped&&i.HourData[u].DailyHourType!=Robotics.Client.Constants.DailyHourType.Untyped||u==h.getMinDailyCell()&&s!=null&&s.PlannedHours==0&&i.ShiftBase==null)&&(p=this.generateShiftInfoDailyContainer(b+k,f,i.Feast,i.FeastDescription,i.IDDailyBudgetPosition,i.ProductiveUnit,moment(i.PlanDate)<=moment(t.FreezingDate))),s!=null&&s.PlannedHours!=0&&(u==0||r.DailyHourType!=i.HourData[u-1].DailyHourType)){for(v=h.dailyPeriodHourFraction(),c=u;c>0&&i.HourData[c].DailyHourType==i.HourData[c+1].DailyHourType;)v=v+h.dailyPeriodHourFraction(),c=c+1;w=this.generateShiftTypeInfoDailyContainer(r.DailyHourType,f,v,y)}}n.append(p,l,w)};Robotics.Client.Controls.roSchedulerCalendar.prototype.generateShiftTypeInfoDailyContainer=function(n,t,i,r){var u=this.oBaseControl,s=u.oCalendar,f="",e,o;switch(n){case Robotics.Client.Constants.DailyHourType.Mandatory:f=u.translator.translate(Robotics.Client.Language.Tags.Mandatory);break;case Robotics.Client.Constants.DailyHourType.Flexible:f=u.translator.translate(Robotics.Client.Language.Tags.Flexible);break;case Robotics.Client.Constants.DailyHourType.Complementary:f=u.translator.translate(Robotics.Client.Language.Tags.Complementary)}return e=f+"("+i+"h)",o=$("<div><\/div>").attr("class","calendarShiftTypeInfoDailyContainer").attr("title",e).html(e),o.attr("style","color:"+(new Robotics.Client.Common.roHtmlColor).invertCssColor(t)+";"+r),o};Robotics.Client.Controls.roSchedulerCalendar.prototype.generateShiftInfoDailyContainer=function(n,t,i,r,u,f,e){var s=this.oBaseControl,h=s.oCalendar,o=$("<div><\/div>").attr("class","calendarShiftInfoDailyContainer").attr("title",n).append($("<span class='fontBold calendarFeastLeft'><\/span>").html(n));return i&&o.append("<div class='calendarFeast calendarFeastLeft' title='"+(r!=""?r:s.translator.translate(Robotics.Client.Language.Tags.Tooltip_feast))+"'><\/div>"),e&&o.append("<div class='calendarLockDate calendarFeastLeft' title='"+Globalize.formatMessage("roPeriodInFreezeDate")+"'>  <\/div>"),u>0&&o.append($("<div><\/div>").attr("class","dailyCalendarBudgetResticted calendarFeastLeft").attr("title",Globalize.formatMessage("roAlreadyInBudget",f))),o.attr("style","color:"+(new Robotics.Client.Common.roHtmlColor).invertCssColor(t)),o};Robotics.Client.Controls.roSchedulerCalendar.prototype.createCalendarCell=function(n,t,i,r){var f=this.oBaseControl,o=f.oCalendar,e=$("<td><\/td>"),u=$("<div><\/div>").attr("id",f.ascxPrefix+"_calCell_"+i+"_"+r);return u.attr("data-IDEmployee",n.IDEmployee).attr("data-IDGroup",n.IDGroup),u.attr("data-IDRow",i).attr("data-IDColumn",r).attr("data-Date",moment(t.PlanDate).format("DD/MM/YYYY")),t.EmployeeStatusOnDay==Robotics.Client.Constants.EmployeeStatusOnDay.Ok?(u.attr("class","calendarOuterBodyCell"),this.buildCalendarCellContent(u,t,!0,n.FreezingDate)):t.EmployeeStatusOnDay==Robotics.Client.Constants.EmployeeStatusOnDay.NoContract?u.attr("class","calendarOuterBodyCellNoContract"):t.EmployeeStatusOnDay==Robotics.Client.Constants.EmployeeStatusOnDay.InOtherDepartment&&u.attr("class","calendarOuterBodyCellInOtherDepartment"),e.append(u)};Robotics.Client.Controls.roSchedulerCalendar.prototype.buildCalendarCellContent=function(n,t,i,r){var e=this.oBaseControl,o=e.oCalendar,u=$("<div><\/div>").attr("class","calendarInnerBodyCell").html("&nbsp;"),f;u.attr("style",this.generateGradientFromColor(t));u.append(this.generateShiftInfoContainer(t,n.attr("data-IDRow"),n.attr("data-IDColumn"),moment(t.PlanDate)<=moment(r)));u.append(this.generateCalendarAlertsContainer(t,n.attr("data-IDRow"),n.attr("data-IDColumn"),i));f=!1;typeof t!="undefined"&&t.MainShift!=null&&t.MainShift.AdvancedParameters.find(function(n){return n.Name.toLowerCase()=="starter"&&n.Value=="1"})!=null&&(f=!0);f||typeof t=="undefined"||t.ShiftBase==null||t.ShiftBase.AdvancedParameters.find(function(n){return n.Name.toLowerCase()=="starter"&&n.Value=="1"})==null||(f=!0);!f&&e.isScheduleActive&&u.append(this.generateCalendarAssignmentsContainer(t));n.append(u);t.Locked&&n.append(this.generateLockedDayMask())};Robotics.Client.Controls.roSchedulerCalendar.prototype.generateCalendarAlertsContainer=function(n,t,i,r){var e=this,f=this.oBaseControl,b=f.oCalendar,u=$("<div><\/div>").attr("class","calendarCellContainer"),s,h,o,l,c;if(e.currentUpdateCell!=null&&e.currentUpdateCell.Alerts!=null&&(n.Alerts=Object.clone(e.currentUpdateCell.Alerts,!0),n.HasChanged=!0),n.Alerts!=null&&(f.telecommuteEnabled&&(typeof n.TelecommuteForced!="undefined"&&n.TelecommuteForced?typeof n.MainShift!="undefined"&&n.MainShift!=null&&n.MainShift.PlannedHours>0&&!n.Alerts.OnAbsenceDays&&!n.Alerts.OnHolidays&&(n.TelecommutingExpected?u.append($("<div><\/div>").attr("class","calendarTelecommuting").attr("title",Globalize.formatMessage("roOnTelecommute"))):n.TelecommutingOptional?u.append($("<div><\/div>").attr("class","calendarOptionalTelecommuting").attr("title",Globalize.formatMessage("roOnOptional"))):u.append($("<div><\/div>").attr("class","calendarPresence").attr("title",Globalize.formatMessage("roOnPresence")))):n.CanTelecommute&&typeof n.MainShift!="undefined"&&n.MainShift!=null&&n.MainShift.PlannedHours>0&&!n.Alerts.OnAbsenceDays&&!n.Alerts.OnHolidays&&(n.TelecommutingOptionalDays!=null&&n.TelecommutingOptionalDays.indexOf(moment(n.PlanDate).day().toString())>=0?u.append($("<div><\/div>").attr("class","calendarOptionalTelecommuting").attr("title",Globalize.formatMessage("roOnOptional"))):n.PresenceMandatoryDays!=null&&n.PresenceMandatoryDays.indexOf(moment(n.PlanDate).day().toString())>=0?u.append($("<div><\/div>").attr("class","calendarPresence").attr("title",Globalize.formatMessage("roOnPresence"))):n.TelecommutingMandatoryDays!=null&&n.TelecommutingMandatoryDays.indexOf(moment(n.PlanDate).day().toString())>=0&&u.append($("<div><\/div>").attr("class","calendarTelecommuting").attr("title",Globalize.formatMessage("roOnTelecommute"))))),n.Alerts.OnAbsenceDays&&u.append($("<div><\/div>").attr("class","calendarPlannedAbsence").attr("title",f.translator.translate(Robotics.Client.Language.Tags.Tooltip_absence))),n.Alerts.OnAbsenceHours&&u.append($("<div><\/div>").attr("class","calendarPlannedIncidence").attr("title",f.translator.translate(Robotics.Client.Language.Tags.Tooltip_incidence))),n.Alerts.OnOvertimesHours&&u.append($("<div><\/div>").attr("class","calendarPlannedOvertme").attr("title",f.translator.translate(Robotics.Client.Language.Tags.Tooltip_overtime))),n.Alerts.OnHolidaysHours&&u.append($("<div><\/div>").attr("class","calendarPlannedHoliday").attr("title",f.translator.translate(Robotics.Client.Language.Tags.Tooltip_plannedHoliday))),n.Alerts.OnHolidays&&u.append($("<div><\/div>").attr("class","calendarHolidays").attr("title",f.translator.translate(Robotics.Client.Language.Tags.Tooltip_holidays))),f.loadIndictments)){if(s=[],h="calendarUnexpectedlyAbsent",n.Alerts!=null&&n.Alerts.UnexpectedlyAbsent!=null&&n.Alerts.UnexpectedlyAbsent&&s.push({employeeName:"",indictment:{ErrorText:f.translator.translate(Robotics.Client.Language.Tags.Tooltip_absent)}}),f.loadIndictments&&n.Alerts!=null&&n.Alerts.Indictments!=null&&n.Alerts.Indictments.length>0)for(h="calendarIndictments",iInd=0;iInd<n.Alerts.Indictments.length;iInd++)s.push({employeeName:"",indictment:Object.clone(n.Alerts.Indictments[iInd],!0)}),r&&(typeof e.calendarIndictments[n.Alerts.Indictments[iInd].RuleName]=="undefined"&&(e.calendarIndictments[n.Alerts.Indictments[iInd].RuleName]={key:n.Alerts.Indictments[iInd].RuleName,counter:0,items:[]}),o=e.calendarIndictments[n.Alerts.Indictments[iInd].RuleName].items.find(function(t){return t.idIndictment==n.Alerts.Indictments[iInd].ID}),o==null?(l=e.oBaseControl.oCalendar.CalendarData[t].EmployeeData.EmployeeName,o={idRow:[t],idColumn:[i],idIndictment:n.Alerts.Indictments[iInd].ID,description:l+": "+n.Alerts.Indictments[iInd].ErrorText,dates:[moment(n.PlanDate).format("DD/MM/YYYY")]},e.calendarIndictments[n.Alerts.Indictments[iInd].RuleName].items.push(o),e.calendarIndictments[n.Alerts.Indictments[iInd].RuleName].counter++):(o.idRow.push(t),o.idColumn.push(i),o.dates.push(moment(n.PlanDate).format("DD/MM/YYYY"))));if(s.length>0){!e.validationInProgress&&n.HasChanged&&h.indexOf("calendarIndictments")>=0&&(h="calendarIndictments-recalc");var y=$("<div><\/div>").attr("id",f.ascxPrefix+"_tooltipIndictments_"+t+"_"+i).attr("class",h+" indictments_target"),p=$("<div><\/div>").attr("style","position:absolute; left:-200%"),a=$("<div><\/div>").attr("id",f.ascxPrefix+"_tooltipIndictmentsContainer_"+t+"_"+i).attr("class","tooltipIndictmentsContainer"),w=$("<div><\/div>").html('<span class="fontBold fontBig" style="text-align:left">'+Globalize.formatMessage("roIndictmentsTitle")+"<\/span>"),v=$("<ul><\/ul>");for(c=0;c<s.length;c++)v.append($("<li><\/li>").html(s[c].indictment.ErrorText));a.append(w,v);u.append(y.append(p.append(a)))}}return n.Remarks!="0"&&n.Remarks!=""&&u.append($("<div><\/div>").attr("class","calendarNotes").attr("title",f.translator.translate(Robotics.Client.Language.Tags.Tooltip_notes))),e.currentUpdateCell!=null&&(e.currentUpdateCell=null),u};Robotics.Client.Controls.roSchedulerCalendar.prototype.generateCalendarAssignmentsContainer=function(n){var i=this.oBaseControl,r=i.oCalendar,t=$("<div><\/div>").attr("class","calendarCellContainer cellborderinset");return typeof n.AssigData!="undefined"&&n.AssigData!=null&&(t.attr("style","background:"+n.AssigData.Color+";color:"+(new Robotics.Client.Common.roHtmlColor).invertCssColor(n.AssigData.Color)),t.append($("<div><\/div>").attr("class","AssignmentText").attr("title",n.AssigData.Name).html(n.AssigData.ShortName.substring(0,2))),n.IDDailyBudgetPosition>0&&t.append($("<div><\/div>").attr("class","calendarBudgetResticted").attr("title",Globalize.formatMessage("roAlreadyInBudget",n.ProductiveUnit)))),t};Robotics.Client.Controls.roSchedulerCalendar.prototype.generateGradientFromColor=function(n){var o=this.oBaseControl,s=o.oCalendar,t="#ffffff",i="#ffffff",u="100%",f="100%",e,r;return n.Alerts!=null&&o.typeView!=Robotics.Client.Constants.TypeView.Review&&(n.Alerts.OnAbsenceDays?(u="21%",f="50%"):(n.Alerts.OnAbsenceHours||n.Alerts.OnHolidaysHours)&&(u="50%",f="85%")),e=this.getAssignedShift(n),e!=null&&(t=e.Color),r="",r="background: "+t+";",r+="background: -moz-linear-gradient(-45deg, "+t+" 0%, "+t+" "+u+", "+i+" "+f+", "+i+" 100%);",r+="background: -webkit-gradient(left top, right bottom, color-stop(0%, "+t+"), color-stop("+u+", "+t+"), color-stop("+f+", "+i+"), color-stop(100%, "+i+"));",r+="background: -webkit-linear-gradient(-45deg, "+t+" 0%, "+t+" "+u+", "+i+" "+f+", "+i+" 100%);",r+="background: -o-linear-gradient(-45deg, "+t+" 0%, "+t+" "+u+", "+i+" "+f+", "+i+" 100%);",r+="background: -ms-linear-gradient(-45deg, "+t+" 0%, "+t+" "+u+", "+i+" "+f+", "+i+" 100%);",r+="background: linear-gradient(135deg, "+t+" 0%, "+t+" "+u+", "+i+" "+f+", "+i+" 100%);",r+('filter: progid:DXImageTransform.Microsoft.gradient( startColorstr="'+t+'", endColorstr="'+i+'", GradientType=1 );')};Robotics.Client.Controls.roSchedulerCalendar.prototype.generateLockedDayMask=function(){return $("<div><\/div>").attr("class","calendarLockedDay")};Robotics.Client.Controls.roSchedulerCalendar.prototype.generateShiftInfoContainer=function(n,t,i,r){var f=this.oBaseControl,s=f.oCalendar,u=null,e=this.getAssignedShift(n),o=!1;return e!=null?(typeof n!="undefined"&&n.MainShift!=null&&n.MainShift.AdvancedParameters.find(function(n){return n.Name.toLowerCase()=="starter"&&n.Value=="1"})!=null&&(o=!0),u=f.typeView!=Robotics.Client.Constants.TypeView.Review?this.generateShiftDetailCell(e,n.ShiftBase,n.Feast,n.FeastDescription,n.Alerts,r):this.generateReviewShiftDetailCell(n,t,i,r)):u=this.generateEmptyShiftDetailCell(n.Feast,n.FeastDescription,r),u==null?(u=f.typeView!=Robotics.Client.Constants.TypeView.Review?$("<div><\/div>").attr("class","calendarShiftInfoContainer"):$("<div><\/div>").attr("class","calendarReviewShiftInfoContainer"),u.attr("style","color:"+(new Robotics.Client.Common.roHtmlColor).invertCssColor("#FFFFFF"))):o&&u.attr("style","font-size:10px"),u};Robotics.Client.Controls.roSchedulerCalendar.prototype.generateReviewShiftDetailCell=function(n,t,i,r){var c=this.oBaseControl,l=c.oCalendar,u=this.getAssignedShift(n),f=$("<div><\/div>").attr("class","calendarReviewShiftInfoContainer").attr("title",u.Name),e=$("<div><\/div>").attr("class","calendarReviewShiftName"),o,s,h;return e.attr("style","background-color:"+u.Color+";border:2px solid "+(new Robotics.Client.Common.roHtmlColor).shadeBlendConvert(-.5,u.Color)),e.append($("<div><\/div>").attr("class","reviewShift").html(u.ShortName.substr(0,3))),r&&e.append("<div class='calendarLockDate calendarFloatIcon' title='"+Globalize.formatMessage("roPeriodInFreezeDate")+"'>  <\/div>"),f.append(e),o=$("<div><\/div>").attr("class","calendarReviewContainter"),s=$("<div><\/div>").attr("class","calendarReviewRemarks"),s.append(this.generateReviewCalendarAlertsContainer(n,t,i)),o.append(s),h=$("<div><\/div>").attr("class","calendarReviewAlerts"),h.append(this.generateReviewCalendarRemarksContainer(n)),o.append(h),f.append(o),f.attr("style","color:"+(new Robotics.Client.Common.roHtmlColor).invertCssColor(u.Color)),f};Robotics.Client.Controls.roSchedulerCalendar.prototype.generateReviewCalendarAlertsContainer=function(n,t,i){var f=this,r=this.oBaseControl,w=r.oCalendar,u=$("<div><\/div>"),s,o,e,c,h;if(n.Alerts!=null&&(!n.Alerts.OnAbsenceDays&&n.TelecommutingExpected&&u.append($("<div><\/div>").attr("class","calendarTelecommuting contentHorizontally").attr("title",Globalize.formatMessage("roOnTelecommute"))),n.Alerts.OnAbsenceDays&&u.append($("<div><\/div>").attr("class","calendarPlannedAbsence contentHorizontally").attr("title",r.translator.translate(Robotics.Client.Language.Tags.Tooltip_absence))),n.Alerts.OnAbsenceHours&&u.append($("<div><\/div>").attr("class","calendarPlannedIncidence contentHorizontally").attr("title",r.translator.translate(Robotics.Client.Language.Tags.Tooltip_incidence))),n.Alerts.OnOvertimesHours&&u.append($("<div><\/div>").attr("class","calendarPlannedOvertme contentHorizontally").attr("title",r.translator.translate(Robotics.Client.Language.Tags.Tooltip_overtime))),n.Alerts.OnHolidaysHours&&u.append($("<div><\/div>").attr("class","calendarPlannedHoliday contentHorizontally").attr("title",r.translator.translate(Robotics.Client.Language.Tags.Tooltip_plannedHoliday))),n.Alerts.OnHolidays&&u.append($("<div><\/div>").attr("class","calendarHolidays contentHorizontally").attr("title",r.translator.translate(Robotics.Client.Language.Tags.Tooltip_holidays))),s="calendarUnexpectedlyAbsent contentHorizontally",r.loadIndictments)){if(o=[],n.Alerts!=null&&n.Alerts.UnexpectedlyAbsent!=null&&n.Alerts.UnexpectedlyAbsent&&o.push({employeeName:"",indictment:{ErrorText:r.translator.translate(Robotics.Client.Language.Tags.Tooltip_absent)}}),r.loadIndictments&&n.Alerts!=null&&n.Alerts.Indictments!=null&&n.Alerts.Indictments.length>0)for(s="calendarIndictments contentHorizontally",iInd=0;iInd<n.Alerts.Indictments.length;iInd++)o.push({employeeName:"",indictment:Object.clone(n.Alerts.Indictments[iInd],!0)}),typeof f.calendarIndictments[n.Alerts.Indictments[iInd].IDScheduleRule]=="undefined"&&(f.calendarIndictments[n.Alerts.Indictments[iInd].IDScheduleRule]={key:n.Alerts.Indictments[iInd].RuleName,counter:0,items:[]}),e=f.calendarIndictments[n.Alerts.Indictments[iInd].IDScheduleRule].items.find(function(t){return t.idIndictment==n.Alerts.Indictments[iInd].ID}),e==null?(c=f.oBaseControl.oCalendar.CalendarData[t].EmployeeData.EmployeeName,e={idRow:[t],idColumn:[i],idIndictment:n.Alerts.Indictments[iInd].ID,description:c+": "+n.Alerts.Indictments[iInd].ErrorText,dates:[moment(n.PlanDate).format("DD/MM/YYYY")]},f.calendarIndictments[n.Alerts.Indictments[iInd].IDScheduleRule].items.push(e),f.calendarIndictments[n.Alerts.Indictments[iInd].IDScheduleRule].counter++):(e.idRow.push(t),e.idColumn.push(i),e.dates.push(moment(n.PlanDate).format("DD/MM/YYYY")));if(o.length>0){!f.validationInProgress&&n.HasChanged&&s.indexOf("calendarIndictments")>=0&&(s="calendarIndictments-recalc contentHorizontally");var v=$("<div><\/div>").attr("id",r.ascxPrefix+"_tooltipIndictments_"+t+"_"+i).attr("title","").attr("class",s+" indictments_target"),y=$("<div><\/div>").attr("style","position:absolute; left:-200%"),l=$("<div><\/div>").attr("id",r.ascxPrefix+"_tooltipIndictmentsContainer_"+t+"_"+i).attr("class","tooltipIndictmentsContainer"),p=$("<div><\/div>").html('<span class="fontBold fontBig" style="text-align:left">'+Globalize.formatMessage("roIndictmentsTitle")+"<\/span>"),a=$("<ul><\/ul>");for(h=0;h<o.length;h++)a.append($("<li><\/li>").html(o[h].indictment.ErrorText));l.append(p,a);u.append(v.append(y.append(l)))}}return n.Remarks!="0"&&n.Remarks!=""&&u.append($("<div><\/div>").attr("class","calendarNotes").attr("title",r.translator.translate(Robotics.Client.Language.Tags.Tooltip_notes))),u};Robotics.Client.Controls.roSchedulerCalendar.prototype.generateReviewCalendarRemarksContainer=function(n){var t=this.oBaseControl,r=t.oCalendar,i=$("<div><\/div>").attr("class","calendarRemarks");return n.IncidenceData!=null?(n.IncidenceData.Remark1?i.append($("<div><\/div>").attr("class","calendarRemark1 remark1Active").attr("style","background-color:"+t.remarksColor[0]+";border:1px solid "+(new Robotics.Client.Common.roHtmlColor).shadeBlendConvert(-.5,t.remarksColor[0])).attr("title",t.translator.translate(Robotics.Client.Language.Tags.Tooltip_remark1))):i.append($("<div><\/div>").attr("class","calendarRemark1 remarkInactive").attr("title","")),n.IncidenceData.Remark2?i.append($("<div><\/div>").attr("class","calendarRemark2 remark2Active").attr("style","background-color:"+t.remarksColor[1]+";border:1px solid "+(new Robotics.Client.Common.roHtmlColor).shadeBlendConvert(-.5,t.remarksColor[1])).attr("title",t.translator.translate(Robotics.Client.Language.Tags.Tooltip_remark2))):i.append($("<div><\/div>").attr("class","calendarRemark2 remarkInactive").attr("title","")),n.IncidenceData.Remark3?i.append($("<div><\/div>").attr("class","calendarRemark3 remark3Active").attr("style","background-color:"+t.remarksColor[2]+";border:1px solid "+(new Robotics.Client.Common.roHtmlColor).shadeBlendConvert(-.5,t.remarksColor[2])).attr("title",t.translator.translate(Robotics.Client.Language.Tags.Tooltip_remark3))):i.append($("<div><\/div>").attr("class","calendarRemark3 remarkInactive").attr("title",""))):(i.append($("<div><\/div>").attr("class","calendarRemark1 remarkInactive").attr("title",n.IncidenceData.Remark1?t.translator.translate(Robotics.Client.Language.Tags.Tooltip_remark1):"")),i.append($("<div><\/div>").attr("class","calendarRemark2 remarkInactive").attr("title",n.IncidenceData.Remark2?t.translator.translate(Robotics.Client.Language.Tags.Tooltip_remark2):"")),i.append($("<div><\/div>").attr("class","calendarRemark3 remarkInactive").attr("title",n.IncidenceData.Remark3?t.translator.translate(Robotics.Client.Language.Tags.Tooltip_remark3):""))),i};Robotics.Client.Controls.roSchedulerCalendar.prototype.generateEmptyShiftDetailCell=function(n,t,i){var f=this.oBaseControl,e=f.oCalendar,u=$("<div><\/div>").attr("class","calendarShiftInfoContainer").attr("title",""),r=$("<div><\/div>");return r.append($("<span class='fontBold calendarFeastLeft'><\/span>").html("")),n&&r.append("<div class='calendarFeast calendarFeastRight' title='"+(t!=""?t:f.translator.translate(Robotics.Client.Language.Tags.Tooltip_feast))+"'>  <\/div>"),i&&r.append("<div class='calendarLockDate calendarFeastRight' title='"+Globalize.formatMessage("roPeriodInFreezeDate")+"'>  <\/div>"),u.append(r),u.attr("style","color:"+(new Robotics.Client.Common.roHtmlColor).invertCssColor("#FFFFFF")),u};Robotics.Client.Controls.roSchedulerCalendar.prototype.generateShiftDetailCell=function(n,t,i,r,u,f){var h=this.oBaseControl,it=h.oCalendar,e=$("<div><\/div>").attr("class","calendarShiftInfoContainer").attr("title",n.Name),tt=n.Color,w=$('<div style="clear:both"><\/div>'),b=w.append($("<span class='fontBold calendarFeastLeft'><\/span>").html(n.ShortName)),l,a,y,o,k,v,p,d,nt;i&&b.append("<div class='calendarFeast calendarFeastRight' title='"+(r!=""?r:h.translator.translate(Robotics.Client.Language.Tags.Tooltip_feast))+"'>  <\/div>");f&&b.append("<div class='calendarLockDate calendarFeastRight' title='"+Globalize.formatMessage("roPeriodInFreezeDate")+"'>  <\/div>");var g=0,c=0,s=null;if(s=n.Type!=Robotics.Client.Constants.ShiftType.Holiday&&n.Type!=Robotics.Client.Constants.ShiftType.Holiday_NonWorking?n:t,s.ExistComplementaryData)for(l=0;l<s.ShiftLayers;l++)g+=s.ShiftLayersDefinition[l].LayerOrdinaryHours,c+=s.ShiftLayersDefinition[l].LayerComplementaryHours;if(a="",y="",a=s.ExistComplementaryData?h.ConvertHoursToHourFormat(g):h.ConvertHoursToHourFormat(s.PlannedHours),c>0&&(y=h.ConvertHoursToHourFormat(c)),o="",(a!=""||c>0)&&(o=a!=""?a:h.ConvertHoursToHourFormat(0)),y!=""&&(o=o+"-"+y),n.Type!=Robotics.Client.Constants.ShiftType.Holiday&&n.Type!=Robotics.Client.Constants.ShiftType.Holiday_NonWorking?(e.append(w),typeof n.EndHour=="undefined"&&(n.EndHour=moment(n.StartHour).add(n.PlannedHours,"minutes").toDate()),n.PlannedHours>0&&e.append($('<div style="clear:both"><\/div>').append($("<span><\/span>").attr("class","fontSmall calendarFeastLeft").html(moment(n.StartHour).format("HH:mm")+"-"+moment(n.EndHour).format("HH:mm")))),n.PlannedHours<=0&&(o="")):(e.append(w),e.append($("<div><\/div>").append($('<span style="clear:both"><\/span>').attr("class","fontBold fontSmall calendarFeastLeft").html(t.ShortName))),t.PlannedHours<=0&&(o="")),n.Type!=Robotics.Client.Constants.ShiftType.Holiday&&n.Type!=Robotics.Client.Constants.ShiftType.Holiday_NonWorking&&o!="")for(k=o.split("-"),v=0;v<k.length;v++)p=$('<div style="clear:both"><\/div>'),b=p.append($("<span><\/span>").attr("class","fontBold")),p.append($('<span style="'+(c>0?"font-size: 8px !important":"")+'"><\/span>').attr("class","fontSmall").html((v===0?"HO:":"HC:")+k[v])),e.append(p);return d=this.buildAlertsShortText(u),nt=$('<div style="clear:both" class="alertCausesContainer"><\/div>').append($("<span style='"+(c>0?"font-size: 9px; margin-top:-1px;":"")+"' title='"+d+"' class='fontBold calendarFeastLeft'><\/span>").html(d)),e.append(nt),e.attr("style","color:"+(new Robotics.Client.Common.roHtmlColor).invertCssColor(tt)),e};Robotics.Client.Controls.roSchedulerCalendar.prototype.buildAlertsShortText=function(n){var t="";return typeof n!="undefined"&&n!=null&&(n.OnAbsenceDaysInfo!=""&&(t+=n.OnAbsenceDaysInfo+";"),n.OnAbsenceHoursInfo!=""&&(t+=n.OnAbsenceHoursInfo+";"),n.OnHolidaysHoursInfo!=""&&(t+=n.OnHolidaysHoursInfo+";"),n.OnOvertimesHoursInfo!=""&&(t+=n.OnOvertimesHoursInfo+";"),t!=""&&(t=t.substring(0,t.length-1))),t};Robotics.Client.Controls.roSchedulerCalendar.prototype.buildReviewRowView=function(n,t){for(var f=this.oBaseControl,r=f.oCalendar,e=r.CalendarData[n].EmployeeData,u=r.CalendarData[n].PeriodData.DayData,i=0;i<u.length;i++)t.append(this.createReviewCell(e,u[i],n,i))};Robotics.Client.Controls.roSchedulerCalendar.prototype.createReviewCell=function(n,t,i,r){var f=this.oBaseControl,o=f.oCalendar,e=$("<td><\/td>"),u;return r%2==0&&e.addClass("columnDailyCalendarOdd"),u=$("<div><\/div>").attr("id",f.ascxPrefix+"_reviewDailyCell_"+i+"_"+r).attr("class","reviewDailyBodyCell reviewOuterCellV2").attr("data-IDEmployee",n.IDEmployee).attr("data-IDGroup",n.IDGroup),u.attr("data-IDRow",i).attr("data-IDColumn",r).attr("data-Date",moment(t.PlanDate).format("DD/MM/YYYY")),f.loadPunches?this.buildReviewCalendarCellPunches(u,t):this.buildReviewCalendarCellContentV2(u,t,n.FreezingDate),e.append(u)};Robotics.Client.Controls.roSchedulerCalendar.prototype.buildReviewCalendarCellPunches=function(n,t){var e=this.oBaseControl,b=e.oCalendar,c=n.attr("data-IDRow"),l=n.attr("data-IDColumn"),o=$("<div><\/div>").attr("id",e.ascxPrefix+"_tooltipPunchesReview_"+c+"_"+l).attr("class","reviewInnerCellV2 punchTooltipTarget"),s=0,a=$('<div style="width:200px"><\/div>'),r,u,f,i,h,v;if(t.EmployeeStatusOnDay==Robotics.Client.Constants.EmployeeStatusOnDay.Ok){if(r=$("<div><\/div>").attr("class","bottomReview"),typeof t.PunchData!="undefined"&&t.PunchData.length>0)for(u=$("<div>").attr("style","clear:both;line-height:20px;height:20px;color:#000;overflow:hidden;font-size:10px;border-bottom:1px dashed #cdcdcd;text-align:center"),f=$("<div>").attr("style","clear:both;line-height:20px;height:20px;color:#000;overflow:hidden;font-size:10px;border-bottom:1px dashed #cdcdcd;text-align:center"),i=0;i<t.PunchData.length;i++)i%2==0&&(u=$("<div>").attr("style","clear:both;line-height:20px;height:20px;color:#000;overflow:hidden;font-size:10px;border-bottom:1px dashed #cdcdcd;text-align:center"),f=$("<div>").attr("style","clear:both;line-height:20px;height:20px;color:#000;overflow:hidden;font-size:10px;border-bottom:1px dashed #cdcdcd;text-align:center")),u.append($("<div>").attr("style","float:left;width:50%").html("<span style='font-weight:bold;'>"+(t.PunchData[i].ActualType==1?"E":"S")+" <\/span>"+moment(t.PunchData[i].DateTimePunch).format("HH:mm"))),f.append($("<div>").attr("style","float:left;width:50%").html("<span style='font-weight:bold;'>"+(t.PunchData[i].ActualType==1?"E":"S")+" <\/span>"+moment(t.PunchData[i].DateTimePunch).format("HH:mm"))),(i%2!=0||i==t.PunchData.length-1)&&(s<3&&r.append(u),a.append(f),s++);h=this.buildAlertsShortText(t.Alerts);v=$('<div style="clear:both;position:relative" class="alertCausesContainer"><\/div>').append($("<span style='' title='"+h+"' class='fontBold calendarFeastLeft'><\/span>").html(h));r.append(v);o.append(r)}if(s>0){var p=$("<div><\/div>").attr("style","position:absolute; left:-200%"),y=$("<div><\/div>").attr("id",e.ascxPrefix+"_tooltipPunchesReviewContainer_"+c+"_"+l).attr("class","tooltipPunchesReviewContainer"),w=$("<div><\/div>").html('<span class="fontBold fontBig" style="text-align:left">'+Globalize.formatMessage("roPunchesTitle")+"<\/span>");y.append(w,a);o.append(p.append(y))}n.append(o)};Robotics.Client.Controls.roSchedulerCalendar.prototype.buildReviewCalendarCellContentV2=function(n,t,i){var e=this.oBaseControl,s=e.oCalendar,u=$("<div><\/div>").attr("class","reviewInnerCellV2");if(t.EmployeeStatusOnDay==Robotics.Client.Constants.EmployeeStatusOnDay.Ok&&(u.append(this.generateShiftInfoContainer(t,n.attr("data-IDRow"),n.attr("data-IDColumn"),moment(t.PlanDate)<=moment(i))),typeof t.MainShift!="undefined")){var r=$("<div><\/div>").attr("class","bottomReview"),f=this.buildAlertsShortText(t.Alerts),o=$('<div style="clear:both;position:absolute;padding-left:3px;max-width:90px" class="alertCausesContainer"><\/div>').append($("<span style='color:black;font-size:12px;height:18px;line-height:18px;padding-top:1px;' title='"+f+"' class='calendarFeastLeft'><\/span>").html(f));r.append(o);r.append($("<div><\/div>").attr("class","reviewColor blueBackground").attr("style",t.IncidenceData.NormalWork==0?"display:none;":"width:calc("+t.IncidenceData.NormalWork+"%);"));r.append($("<div><\/div>").attr("class","reviewColor greenBackground").attr("style",t.IncidenceData.OverWorking==0?"display:none;":"width:calc("+t.IncidenceData.OverWorking+"%);"));r.append($("<div><\/div>").attr("class","reviewColor redBackground").attr("style",t.IncidenceData.Absence==0?"display:none;":"width:calc("+t.IncidenceData.Absence+"%);"));u.append(r)}n.append(u)};Robotics.Client.Controls.roSchedulerCalendar.prototype.buildReviewCalendarCellContent=function(n,t){var r=this.oBaseControl,u=r.oCalendar,i=$("<div><\/div>").attr("class","reviewInnerCell");t.EmployeeStatusOnDay==Robotics.Client.Constants.EmployeeStatusOnDay.Ok&&(i.append($("<div><\/div>").attr("class","reviewColor").attr("style","background:blue;width:calc("+t.IncidenceData.NormalWork+"%);")),i.append($("<div><\/div>").attr("class","reviewColor").attr("style","background:green;width:calc("+t.IncidenceData.OverWorking+"%);")),i.append($("<div><\/div>").attr("class","reviewColor").attr("style","background:red;width:calc("+t.IncidenceData.Absence+"%);")));n.append(i)};Robotics.Client.Controls.roSchedulerCalendar.prototype.updateShiftTotalizerInfo=function(n,t,i,r,u,f){var o,v,a,l,h;if(this.resumeInfoLoaded){var e=this.oBaseControl,c=e.oCalendar,s=c.CalendarHeader.PeriodHeaderData[r].Row1Text+"_"+c.CalendarHeader.PeriodHeaderData[r].Row2Text;if(s=s.replace(":","_"),o=c.CalendarData[i].EmployeeData.IDEmployee+"_"+c.CalendarData[i].EmployeeData.IDGroup,e.accrualsTotal.PlannedHours.WorkingHours-=e.employeeDataList[o].WorkingHours,e.accrualsTotal.PlannedHours.ComplementaryHours-=e.employeeDataList[o].ComplementaryHours,e.accrualsTotal.HolidayResume.AssignedHolidays-=e.employeeDataList[o].AssignedHolidays,f)typeof u.ZoneName!="undefined"&&u.ZoneName!=""&&(v=c.CalendarData[i].PeriodData.DayData[r],moment(v.PlanDate).isSameOrAfter(moment().startOf("day"))&&typeof v.MainShift!="undefined"&&v.MainShift!=null&&v.MainShift.PlannedHours>0&&v.IsHoliday==!1&&v.Alerts.OnAbsenceDays==!1&&(e.columnCapacityList[s][u.ZoneName].OnTelecommute-=c.CalendarData[i].PeriodData.DayData[r].TelecommutingExpected?0:1,e.columnCapacityList[s][u.ZoneName].Actual+=c.CalendarData[i].PeriodData.DayData[r].TelecommutingExpected?-1:1,e.columnCapacityList[s][u.ZoneName].Actual>e.columnCapacityList[s][u.ZoneName].Max&&e.columnCapacityList[s][u.ZoneName].Max>0&&(e.columnCapacityList[s][u.ZoneName].HasChanges=!0,e.capacityError=!0)));else{if(a=0,typeof n!="undefined"&&n!=null&&typeof t!="undefined"&&(l=null,t==null?a=-1:n.Type!=t.Type&&t.Type==2?a=-1:n.Type!=t.Type&&t.Type==0?a=1:n.Type==t.Type&&n.PlannedHours>0&&t.PlannedHours==0?a=-1:n.Type==t.Type&&n.PlannedHours==0&&t.PlannedHours>0&&(a=1),l=e.viewRange!=Robotics.Client.Constants.ViewRange.Daily?c.CalendarData[i].PeriodData.DayData[r]:c.CalendarData[i].PeriodData.DayData[0],l!=null&&l.TelecommutingExpected==!1&&a!=0&&typeof l.ZoneName!="undefined"&&(e.columnCapacityList[s][l.ZoneName].Actual+=a,e.columnCapacityList[s][l.ZoneName].Actual>e.columnCapacityList[s][l.ZoneName].Max&&e.columnCapacityList[s][l.ZoneName].Max>0&&(e.columnCapacityList[s][u.ZoneName].HasChanges=!0,e.capacityError=!0))),typeof n!="undefined"&&(e.columnShiftsList[s][n.ShortName].Count-=1,typeof n.AssigData!="undefined"&&n.AssigData!=null&&(e.columnAssignmentsList[s][n.AssigData.ID].Count-=1*n.AssigData.Cover),e.rowsShiftsList[o][n.ShortName].Count-=1,typeof n.AssigData!="undefined"&&n.AssigData!=null&&(e.rowsAssignmentsList[o][n.AssigData.ID].Count-=1*n.AssigData.Cover),n.Type==Robotics.Client.Constants.ShiftType.Holiday||n.Type==Robotics.Client.Constants.ShiftType.Holiday_NonWorking?e.employeeDataList[o].AssignedHolidays-=1:(e.employeeDataList[o].WorkingHours-=n.PlannedHours,e.employeeDataList[o].PlannedHours.YearTotal-=n.PlannedHours/60),n.ExistComplementaryData))for(h=0;h<n.ShiftLayers;h++)n.ShiftLayersDefinition[h].LayerComplementaryHours!=-1&&(e.employeeDataList[o].ComplementaryHours-=n.ShiftLayersDefinition[h].LayerComplementaryHours);if(typeof t!="undefined"&&t!=null&&(typeof e.shiftsList[t.ShortName]=="undefined"&&(e.shiftsList[t.ShortName]={Name:t.Name,ShortName:t.ShortName,IsHoliday:t.Type!=Robotics.Client.Constants.ShiftType.Holiday&&t.Type!=Robotics.Client.Constants.ShiftType.Holiday_NonWorking?!1:!0}),typeof e.columnShiftsList[s][t.ShortName]=="undefined"&&(e.columnShiftsList[s][t.ShortName]={Name:t.Name,ShortName:t.ShortName,Count:0}),e.columnShiftsList[s][t.ShortName].Count+=1,typeof t.AssigData!="undefined"&&t.AssigData!=null&&(typeof e.assignmentsList[t.AssigData.ID]=="undefined"&&(e.assignmentsList[t.AssigData.ID]={ID:t.AssigData.ID,Name:t.AssigData.Name,ShortName:t.AssigData.ShortName}),e.columnAssignmentsList[s][t.AssigData.ID].Count+=1*t.AssigData.Cover),typeof e.rowsShiftsList[o][t.ShortName]=="undefined"&&(e.rowsShiftsList[o][t.ShortName]={Name:t.Name,ShortName:t.ShortName,Count:0}),e.rowsShiftsList[o][t.ShortName].Count+=1,typeof t.AssigData!="undefined"&&t.AssigData!=null&&(typeof e.rowsAssignmentsList[o][t.AssigData.ID]=="undefined"&&(e.rowsAssignmentsList[o][t.AssigData.ID]={ID:t.AssigData.ID,Name:t.AssigData.Name,ShortName:t.AssigData.ShortName,Count:0}),e.rowsAssignmentsList[o][t.AssigData.ID].Count+=1*t.AssigData.Cover),t.Type==Robotics.Client.Constants.ShiftType.Holiday||t.Type==Robotics.Client.Constants.ShiftType.Holiday_NonWorking?e.employeeDataList[o].AssignedHolidays+=1:(e.employeeDataList[o].WorkingHours+=t.PlannedHours,e.employeeDataList[o].PlannedHours.YearTotal+=t.PlannedHours/60),t.ExistComplementaryData))for(h=0;h<t.ShiftLayers;h++)t.ShiftLayersDefinition[h].LayerComplementaryHours!=-1&&(e.employeeDataList[o].ComplementaryHours+=t.ShiftLayersDefinition[h].LayerComplementaryHours);e.accrualsTotal.PlannedHours.WorkingHours+=e.employeeDataList[o].WorkingHours;e.accrualsTotal.PlannedHours.ComplementaryHours+=e.employeeDataList[o].ComplementaryHours;e.accrualsTotal.HolidayResume.AssignedHolidays+=e.employeeDataList[o].AssignedHolidays}}};Robotics.Client.Controls.roSchedulerCalendar.prototype.generateShiftTotalizerInfo=function(){var n=this.oBaseControl,u=n.oCalendar,k,l,v,y,p,a,r,h,c,b,s,e,f,o,t,i,w;for(n.shiftsList={},n.capacityList={},n.assignmentsList={},n.columnShiftsList={},n.columnCapacityList={},n.rowsShiftsList={},n.employeeDataList={},n.columnAssignmentsList={},n.rowsAssignmentsList={},typeof n.assignmentsList[0]=="undefined"&&(n.assignmentsList[0]={ID:0,Name:n.translator.translate(Robotics.Client.Language.Tags.Empty_Assignment),ShortName:n.translator.translate(Robotics.Client.Language.Tags.Empty_Assignment_SN)}),k=[].concat.apply([],u.CalendarHeader.PeriodSeatingCapacityData.map(function(n){return n.Capacities})),l=[...new Map(k.map(n=>[n.ZoneName,n])).values()],v=0;v<u.CalendarHeader.PeriodSeatingCapacityData.length;v++){for(r=u.CalendarHeader.PeriodHeaderData[v].Row1Text+"_"+u.CalendarHeader.PeriodHeaderData[v].Row2Text,r=r.replace(":","_"),y=u.CalendarHeader.PeriodSeatingCapacityData[v].Capacities,p={},a=0;a<y.length;a++)typeof p[y[a].ZoneName]=="undefined"&&(p[y[a].ZoneName]={Actual:y[a].CurrentSeating,Max:y[a].MaxSeatingCapacity});for(h=0;h<l.length;h++)c=l[h].ZoneName,typeof p[c]=="undefined"&&(p[c]={Actual:l[h].CurrentSeating,Max:l[h].MaxSeatingCapacity});typeof n.capacityList[r]=="undefined"&&(n.capacityList[r]=p)}for(o=0;o<u.CalendarHeader.PeriodHeaderData.length;o++){for(r=u.CalendarHeader.PeriodHeaderData[o].Row1Text+"_"+u.CalendarHeader.PeriodHeaderData[o].Row2Text,r=r.replace(":","_"),typeof n.columnShiftsList[r]=="undefined"&&(n.columnShiftsList[r]={}),typeof n.columnCapacityList[r]=="undefined"&&(n.columnCapacityList[r]={}),typeof n.columnAssignmentsList[r]=="undefined"&&(n.columnAssignmentsList[r]={}),h=0;h<l.length;h++)c=l[h].ZoneName,typeof n.columnCapacityList[r][c]=="undefined"&&(n.columnCapacityList[r][c]={Actual:n.capacityList[r][c].Actual,Max:n.capacityList[r][c].Max,OnTelecommute:0,HasChanges:!1});if((n.viewRange==Robotics.Client.Constants.ViewRange.Daily&&o==0||n.viewRange==Robotics.Client.Constants.ViewRange.Period)&&typeof u.CalendarHeader.PeriodCoverageData!="undefined"&&u.CalendarHeader.PeriodCoverageData.length>0&&typeof u.CalendarHeader.PeriodCoverageData[o].AssignmentData!="undefined"&&u.CalendarHeader.PeriodCoverageData[o].AssignmentData.length>0)for(typeof n.columnAssignmentsList[r][0]=="undefined"&&(n.columnAssignmentsList[r][0]={ID:0,Name:n.translator.translate(Robotics.Client.Language.Tags.Empty_Assignment),ShortName:n.translator.translate(Robotics.Client.Language.Tags.Empty_Assignment_SN),Count:0}),b=0;b<u.CalendarHeader.PeriodCoverageData[o].AssignmentData.length;b++)s=u.CalendarHeader.PeriodCoverageData[o].AssignmentData[b],typeof n.columnAssignmentsList[r][s.ID]=="undefined"&&(n.columnAssignmentsList[r][s.ID]={ID:s.ID,Name:s.Name,ShortName:s.ShortName,Count:0,Expected:s.Expected*-1}),typeof n.assignmentsList[s.ID]=="undefined"&&(n.assignmentsList[s.ID]={ID:s.ID,Name:s.Name,ShortName:s.ShortName});for(e=0;e<u.CalendarData.length;e++)if(n.viewRange==Robotics.Client.Constants.ViewRange.Period)t=u.CalendarData[e].PeriodData.DayData[o],t!=null&&t.EmployeeStatusOnDay==Robotics.Client.Constants.EmployeeStatusOnDay.Ok&&(typeof t.ZoneName!="undefined"&&t.ZoneName!=""&&(n.columnCapacityList[r][t.ZoneName].OnTelecommute+=t.TelecommutingExpected?1:0),i=this.getAssignedShift(t),i!=null&&(typeof n.columnShiftsList[r][i.ShortName]=="undefined"&&(n.columnShiftsList[r][i.ShortName]={Name:i.Name,ShortName:i.ShortName,Count:0,OnAbsence:0}),typeof n.shiftsList[i.ShortName]=="undefined"&&(n.shiftsList[i.ShortName]={Name:i.Name,ShortName:i.ShortName,IsHoliday:i.Type!=Robotics.Client.Constants.ShiftType.Holiday&&i.Type!=Robotics.Client.Constants.ShiftType.Holiday_NonWorking?!1:!0}),n.columnShiftsList[r][i.ShortName].Count+=1,t.Alerts.OnAbsenceDays&&(n.columnShiftsList[r][i.ShortName].OnAbsence+=1),typeof t.AssigData!="undefined"&&t.AssigData!=null?(typeof n.columnAssignmentsList[r][t.AssigData.ID]=="undefined"&&(n.columnAssignmentsList[r][t.AssigData.ID]={ID:t.AssigData.ID,Name:t.AssigData.Name,ShortName:t.AssigData.ShortName,Count:0}),typeof n.assignmentsList[t.AssigData.ID]=="undefined"&&(n.assignmentsList[t.AssigData.ID]={ID:t.AssigData.ID,Name:t.AssigData.Name,ShortName:t.AssigData.ShortName}),t.Alerts.OnAbsenceDays==!1&&i.Type!=Robotics.Client.Constants.ShiftType.Holiday&&i.Type!=Robotics.Client.Constants.ShiftType.Holiday_NonWorking&&(n.columnAssignmentsList[r][t.AssigData.ID].Count+=1*t.AssigData.Cover,typeof n.columnAssignmentsList[r][t.AssigData.ID].Expected!="undefined"&&(n.columnAssignmentsList[r][t.AssigData.ID].Expected+=1*t.AssigData.Cover))):(typeof n.columnAssignmentsList[r][0]=="undefined"&&(n.columnAssignmentsList[r][0]={ID:0,Name:n.translator.translate(Robotics.Client.Language.Tags.Empty_Assignment),ShortName:n.translator.translate(Robotics.Client.Language.Tags.Empty_Assignment_SN),Count:0}),t.Alerts.OnAbsenceDays==!1&&i.Type!=Robotics.Client.Constants.ShiftType.Holiday&&i.Type!=Robotics.Client.Constants.ShiftType.Holiday_NonWorking&&(n.columnAssignmentsList[r][0].Count+=1))));else{var t=u.CalendarData[e].PeriodData.DayData[0],i=this.getAssignedShift(t),d=u.CalendarData[e].PeriodData.DayData[0].HourData[o];typeof t.ZoneName!="undefined"&&(n.columnCapacityList[r][t.ZoneName].OnTelecommute+=t.TelecommutingExpected?1:0);d.DailyHourType!=Robotics.Client.Constants.DailyHourType.Untyped&&i!=null&&(typeof n.columnShiftsList[r][i.ShortName]=="undefined"&&(n.columnShiftsList[r][i.ShortName]={Name:i.Name,ShortName:i.ShortName,Count:0,OnAbsence:0}),typeof n.shiftsList[i.ShortName]=="undefined"&&(n.shiftsList[i.ShortName]={Name:i.Name,ShortName:i.ShortName,IsHoliday:i.Type!=Robotics.Client.Constants.ShiftType.Holiday&&i.Type!=Robotics.Client.Constants.ShiftType.Holiday_NonWorking?!1:!0}),n.columnShiftsList[r][i.ShortName].Count+=1,t.Alerts.OnAbsenceDays&&(n.columnShiftsList[r][i.ShortName].OnAbsence+=1),typeof t.AssigData!="undefined"&&t.AssigData!=null&&(typeof n.columnAssignmentsList[r][t.AssigData.ID]=="undefined"&&(n.columnAssignmentsList[r][t.AssigData.ID]={ID:t.AssigData.ID,Name:t.AssigData.Name,ShortName:t.AssigData.ShortName,Count:0}),typeof n.assignmentsList[t.AssigData.ID]=="undefined"&&(n.assignmentsList[t.AssigData.ID]={ID:t.AssigData.ID,Name:t.AssigData.Name,ShortName:t.AssigData.ShortName}),t.Alerts.OnAbsenceDays==!1&&i.Type!=Robotics.Client.Constants.ShiftType.Holiday&&i.Type!=Robotics.Client.Constants.ShiftType.Holiday_NonWorking?(n.columnAssignmentsList[r][t.AssigData.ID].Count+=1*t.AssigData.Cover,typeof n.columnAssignmentsList[r][t.AssigData.ID].Expected!="undefined"&&(n.columnAssignmentsList[r][t.AssigData.ID].Expected+=1*t.AssigData.Cover)):(typeof n.columnAssignmentsList[r][0]=="undefined"&&(n.columnAssignmentsList[r][0]={ID:0,Name:n.translator.translate(Robotics.Client.Language.Tags.Empty_Assignment),ShortName:n.translator.translate(Robotics.Client.Language.Tags.Empty_Assignment_SN),Count:0}),t.Alerts.OnAbsenceDays==!1&&i.Type!=Robotics.Client.Constants.ShiftType.Holiday&&i.Type!=Robotics.Client.Constants.ShiftType.Holiday_NonWorking&&(n.columnAssignmentsList[r][0].Count+=1))))}}for(e=0;e<u.CalendarData.length;e++){for(f=u.CalendarData[e].EmployeeData.IDEmployee+"_"+u.CalendarData[e].EmployeeData.IDGroup,typeof n.rowsShiftsList[f]=="undefined"&&(n.rowsShiftsList[f]={}),typeof n.rowsAssignmentsList[f]=="undefined"&&(n.rowsAssignmentsList[f]={}),typeof n.employeeDataList[f]=="undefined"?n.employeeDataList[f]={InitialHolidays:u.CalendarData[e].SummaryData.AccrualHolidays,AssignedHolidays:0,WorkingHours:0,AbsenceHours:0,ComplementaryHours:0,PlannedHours:Object.clone(u.CalendarData[e].SummaryData.PlannedHours,!0),HolidayResume:Object.clone(u.CalendarData[e].SummaryData.HolidayResume,!0)}:(n.employeeDataList[f].PlannedHours=Object.clone(u.CalendarData[e].SummaryData.PlannedHours,!0),n.employeeDataList[f].HolidayResume=Object.clone(u.CalendarData[e].SummaryData.HolidayResume,!0)),o=0;o<u.CalendarHeader.PeriodHeaderData.length;o++)if(t=u.CalendarData[e].PeriodData.DayData[o],t!=null&&t.EmployeeStatusOnDay==Robotics.Client.Constants.EmployeeStatusOnDay.Ok){if(i=this.getAssignedShift(t),i!=null)if(typeof n.rowsShiftsList[f][i.ShortName]=="undefined"&&(n.rowsShiftsList[f][i.ShortName]={Name:i.Name,ShortName:i.ShortName,Count:0}),typeof n.shiftsList[i.ShortName]=="undefined"&&(n.shiftsList[i.ShortName]={Name:i.Name,ShortName:i.ShortName,IsHoliday:i.Type!=Robotics.Client.Constants.ShiftType.Holiday&&i.Type!=Robotics.Client.Constants.ShiftType.Holiday_NonWorking?!1:!0}),n.rowsShiftsList[f][i.ShortName].Count+=1,i.Type==Robotics.Client.Constants.ShiftType.Holiday||i.Type==Robotics.Client.Constants.ShiftType.Holiday_NonWorking||t.Alerts.OnAbsenceDays)i.Type==Robotics.Client.Constants.ShiftType.Holiday||i.Type==Robotics.Client.Constants.ShiftType.Holiday_NonWorking?n.employeeDataList[f].AssignedHolidays+=1:n.employeeDataList[f].AbsenceHours+=i.PlannedHours;else if(n.employeeDataList[f].WorkingHours+=i.PlannedHours,i.ExistComplementaryData)for(w=0;w<i.ShiftLayers;w++)i.ShiftLayersDefinition[w].LayerComplementaryHours!=-1&&(n.employeeDataList[f].ComplementaryHours+=i.ShiftLayersDefinition[w].LayerComplementaryHours);typeof t.AssigData!="undefined"&&t.AssigData!=null?(typeof n.rowsAssignmentsList[f][t.AssigData.ID]=="undefined"&&(n.rowsAssignmentsList[f][t.AssigData.ID]={ID:t.AssigData.ID,Name:t.AssigData.Name,ShortName:t.AssigData.ShortName,Count:0}),typeof n.assignmentsList[t.AssigData.ID]=="undefined"&&(n.assignmentsList[t.AssigData.ID]={ID:t.AssigData.ID,Name:t.AssigData.Name,ShortName:t.AssigData.ShortName}),typeof t.Alerts!="undefined"&&t.Alerts.OnAbsenceDays==!1&&i!=null&&i.Type!=Robotics.Client.Constants.ShiftType.Holiday&&i.Type!=Robotics.Client.Constants.ShiftType.Holiday_NonWorking&&(n.rowsAssignmentsList[f][t.AssigData.ID].Count+=1*t.AssigData.Cover)):(typeof n.rowsAssignmentsList[f][0]=="undefined"&&(n.rowsAssignmentsList[f][0]={ID:0,Name:n.translator.translate(Robotics.Client.Language.Tags.Empty_Assignment),ShortName:n.translator.translate(Robotics.Client.Language.Tags.Empty_Assignment_SN),Count:0}),typeof t.Alerts!="undefined"&&t.Alerts.OnAbsenceDays==!1&&i!=null&&i.Type!=Robotics.Client.Constants.ShiftType.Holiday&&i.Type!=Robotics.Client.Constants.ShiftType.Holiday_NonWorking&&(n.rowsAssignmentsList[f][0].Count+=1))}n.employeeDataList[f].PlannedHours.YearTotal=n.employeeDataList[f].PlannedHours.YearTotal+n.employeeDataList[f].WorkingHours/60}n.accrualsTotal.PlannedHours.WorkingHours=0;n.accrualsTotal.PlannedHours.ComplementaryHours=0;n.accrualsTotal.HolidayResume.AssignedHolidays=0;Object.keys(n.employeeDataList).forEach(function(t){n.accrualsTotal.PlannedHours.WorkingHours+=n.employeeDataList[t].WorkingHours;n.accrualsTotal.PlannedHours.ComplementaryHours+=n.employeeDataList[t].ComplementaryHours;n.accrualsTotal.HolidayResume.AssignedHolidays+=n.employeeDataList[t].AssignedHolidays});this.resumeInfoLoaded=!0};Robotics.Client.Controls.roSchedulerCalendar.prototype.createAcrrualTotalsTable=function(n,t){var r=this.oBaseControl,f=r.oCalendar,u=$("#"+r.prefix+t),i;u.empty();i=$("<table><\/table>").attr("id",r.prefix+n).attr("class","fancyColumnTable");i.append(this.createAccrualsTotalTableHeader(n,t));i.append(this.createAccrualsTotalsTableBody(n,t));i.append(this.createAccrualsTotalTableFooter(n,t));u.append(i)};Robotics.Client.Controls.roSchedulerCalendar.prototype.createAccrualsTotalTableHeader=function(n){var t=this.oBaseControl,s=t.oCalendar,u=$("<thead><\/thead>").attr("id",t.prefix+n+"_thead"),i=$("<tr><\/tr>"),o=$("<th><\/th>"),f=$("<div><\/div>").attr("class","CalendarDayFixed CalendarRowFixedHeader"),e,r;return f.append($("<div><\/div>").attr("class","NorthRowCell").html(t.translator.translate(Robotics.Client.Language.Tags.PlannedHours))),e=$("<th><\/th>"),r=$("<div><\/div>").attr("class","CalendarDayFixed CalendarRowFixedHeader"),r.append($("<div><\/div>").attr("class","NorthRowCell").html(t.translator.translate(Robotics.Client.Language.Tags.Holidays))),i.append(o.append(f)),i.append(e.append(r)),u.append(i),u};Robotics.Client.Controls.roSchedulerCalendar.prototype.createAccrualsTotalsTableBody=function(n){var t=this.oBaseControl,l=t.oCalendar,f=$("<tbody><\/tbody>").attr("id",t.prefix+n+"_tbody"),i=$("<tr><\/tr>").attr("style","color: #333333;"),h=$("<td><\/td>"),e=$("<div><\/div>").attr("class","ColumnAccrualsTableBodyCell"),r=$("<div><\/div>").attr("class","ContentAccrualsRowCell"),u;r.append($("<div><\/div>").attr("class","totalAccrual").html(t.ConvertHoursToHourFormat(t.accrualsTotal.PlannedHours.WorkingHours)));t.accrualsTotal.PlannedHours.ComplementaryHours>0&&(u=$("<div><\/div>"),u.html("(HO:"+t.ConvertHoursToHourFormat(t.accrualsTotal.PlannedHours.WorkingHours-t.accrualsTotal.PlannedHours.ComplementaryHours)+" HC:"+t.ConvertHoursToHourFormat(t.accrualsTotal.PlannedHours.ComplementaryHours)+")"),r.append(u));e.append(r);var c=$("<td><\/td>"),o=$("<div><\/div>").attr("class","ColumnAccrualsTableBodyCell"),s=$("<div><\/div>").attr("class","ContentAccrualsRowCell");return s.append($("<div><\/div>").attr("class","totalAccrual").html(t.accrualsTotal.HolidayResume.AssignedHolidays)),o.append(s),i.append(h.append(e)),i.append(c.append(o)),tmpCell=$('<td style="width:100%"><\/td>').html("&nbsp;"),i.append(tmpCell),f.append(i),f};Robotics.Client.Controls.roSchedulerCalendar.prototype.createAccrualsTotalTableFooter=function(n){var t=this.oBaseControl,s=t.oCalendar,u=$("<tfoot><\/tfoot>").attr("id",t.prefix+n+"_tfoot"),i=$("<tr><\/tr>"),o=$("<td><\/td>"),f=$("<div><\/div>").attr("class","CalendarDayFixed CalendarRowFixedHeader"),e,r;return f.append($("<div><\/div>").attr("class","SouthRowCell").html(t.translator.translate(Robotics.Client.Language.Tags.PlannedHours))),e=$("<td><\/td>"),r=$("<div><\/div>").attr("class","CalendarDayFixed CalendarRowFixedHeader"),r.append($("<div><\/div>").attr("class","SouthRowCell").html(t.translator.translate(Robotics.Client.Language.Tags.Holidays))),i.append(o.append(f)),i.append(e.append(r)),u.append(i),u};Robotics.Client.Controls.roSchedulerCalendar.prototype.createColumnShiftsTable=function(n,t){var r=this.oBaseControl,f=r.oCalendar,u=$("#"+r.prefix+t),i;u.empty();i=$("<table><\/table>").attr("id",r.prefix+n).attr("class","fancyColumnTable");i.append(this.createEmptyColumnTableHeader(n,t));i.append(this.createColumnShiftsTableBody(n,t));i.append(this.createColumnShiftsTableFooter(n,t));u.append(i)};Robotics.Client.Controls.roSchedulerCalendar.prototype.createEmptyColumnTableHeader=function(n){var t=this.oBaseControl,h=t.oCalendar,o=$("<thead><\/thead>").attr("id",t.prefix+n+"_thead"),i=$("<tr><\/tr>"),c=$("<th><\/th>"),l=$("<div><\/div>").attr("class","CalendarFixed CalendarFixedHeader"),a=$("<div><\/div>").attr("class","CalendarEmployeeFixed CalendarEmployeeFixedHeader").attr("style","height:0px"),f,e,r,u,s;if(i.append(c.append(l.append(a))),t.viewRange==Robotics.Client.Constants.ViewRange.Daily)for(f=t.getMinDailyCell();f<t.getMaxDailyCell();f++)r=$("<th><\/th>"),u=$("<div><\/div>").attr("class","CalendarDayFixed CalendarDayFixedHeader DailyCell").attr("style","height:0px"),i.append(r.append(u));else for(e=0;e<h.CalendarHeader.PeriodHeaderData.length;e++)r=$("<th><\/th>"),u=$("<div><\/div>").attr("class","CalendarDayFixed CalendarDayFixedHeader").attr("style","height:0px"),i.append(r.append(u));return s=$('<th style="width:100%"><\/th>').attr("style","height:0px"),i.append(s),o.append(i),o};Robotics.Client.Controls.roSchedulerCalendar.prototype.createColumnShiftsTableBody=function(n){var i=this.oBaseControl,u=i.oCalendar,r=$("<tbody><\/tbody>").attr("id",i.prefix+n+"_tbody"),t=i;return Object.keys(t.shiftsList).forEach(function(n){var o=$("<tr><\/tr>").attr("class","shiftColumnRow"),c=$("<td><\/td>"),h=$("<div><\/div>").attr("class","CalendarShiftsFixed CalendarShiftFixedBody"),u;h.append($("<div><\/div>").attr("class","CalendarShiftContentFixedBody").html('<span style="font-weight:bold">'+n+"<\/span>:   "+t.shiftsList[n].Name));o.append(c.append(h));var i=null,f=0,s=null,e=null;if(t.viewRange==Robotics.Client.Constants.ViewRange.Daily)for(u=t.getMinDailyCell();u<t.getMaxDailyCell();u++)i=t.oCalendar.CalendarHeader.PeriodHeaderData[u].Row1Text+"_"+t.oCalendar.CalendarHeader.PeriodHeaderData[u].Row2Text,i=i.replace(":","_"),f=0,typeof t.columnShiftsList[i][t.shiftsList[n].ShortName]!="undefined"&&(f=t.columnShiftsList[i][t.shiftsList[n].ShortName].Count),s=$("<td><\/td>"),e=$("<div><\/div>").attr("class","ColumnShiftTableBodyCell DailyCell"),e.append($("<div><\/div>").attr("class","ContentShiftsColumnCell").html(f)),o.append(s.append(e));else for(u=0;u<t.oCalendar.CalendarHeader.PeriodHeaderData.length;u++)i=t.oCalendar.CalendarHeader.PeriodHeaderData[u].Row1Text+"_"+t.oCalendar.CalendarHeader.PeriodHeaderData[u].Row2Text,i=i.replace(":","_"),f=0,typeof t.columnShiftsList[i][t.shiftsList[n].ShortName]!="undefined"&&(f=t.columnShiftsList[i][t.shiftsList[n].ShortName].Count),s=$("<td><\/td>"),e=$("<div><\/div>").attr("class","ColumnShiftTableBodyCell"),e.append($("<div><\/div>").attr("class","ContentShiftsColumnCell").html(f)),o.append(s.append(e));tmpCell=$('<td style="width:100%"><\/td>').html("&nbsp;");o.append(tmpCell);r.append(o)}),r};Robotics.Client.Controls.roSchedulerCalendar.prototype.createColumnShiftsTableFooter=function(n){var s=this.oBaseControl,a=s.oCalendar,h=$("<tfoot><\/tfoot>").attr("id",s.prefix+n+"_tfoot"),t=s,e=$("<tr><\/tr>").attr("class","shiftColumnRow"),l=$("<td><\/td>"),c=$("<div><\/div>").attr("class","CalendarShiftsFixed CalendarShiftFixedBody"),r;c.append($("<div><\/div>").attr("class","CalendarShiftContentFixedBody").html("&nbsp;"));e.append(l.append(c));var i=null,u=0,o=null,f=null;if(t.viewRange==Robotics.Client.Constants.ViewRange.Daily)for(r=t.getMinDailyCell();r<t.getMaxDailyCell();r++)i=t.oCalendar.CalendarHeader.PeriodHeaderData[r].Row1Text+"_"+t.oCalendar.CalendarHeader.PeriodHeaderData[r].Row2Text,i=i.replace(":","_"),o=$("<td><\/td>"),f=$("<div><\/div>").attr("class","ColumnShiftTableBodyCell DailyCell totalRowBackground"),u=0,Object.keys(t.shiftsList).forEach(function(n){typeof t.columnShiftsList[i][t.shiftsList[n].ShortName]!="undefined"&&(t.shiftsList[n].IsHoliday||(u+=t.columnShiftsList[i][t.shiftsList[n].ShortName].Count),u-=t.columnShiftsList[i][t.shiftsList[n].ShortName].OnAbsence)}),f.append($("<div><\/div>").attr("class","ContentShiftsColumnCell").html(u)),e.append(o.append(f));else for(r=0;r<t.oCalendar.CalendarHeader.PeriodHeaderData.length;r++)i=t.oCalendar.CalendarHeader.PeriodHeaderData[r].Row1Text+"_"+t.oCalendar.CalendarHeader.PeriodHeaderData[r].Row2Text,i=i.replace(":","_"),o=$("<td><\/td>"),f=$("<div><\/div>").attr("class","ColumnShiftTableBodyCell totalRowBackground"),u=0,Object.keys(t.shiftsList).forEach(function(n){typeof t.columnShiftsList[i][t.shiftsList[n].ShortName]!="undefined"&&(t.shiftsList[n].IsHoliday||(u+=t.columnShiftsList[i][t.shiftsList[n].ShortName].Count),u-=t.columnShiftsList[i][t.shiftsList[n].ShortName].OnAbsence)}),f.append($("<div><\/div>").attr("class","ContentShiftsColumnCell").html(u)),e.append(o.append(f));return tmpCell=$('<td style="width:100%"><\/td>').attr("class","totalRowBackground").html("&nbsp;"),e.append(tmpCell),h.append(e),h};Robotics.Client.Controls.roSchedulerCalendar.prototype.createCapacityTable=function(n,t){var r=this.oBaseControl,f=r.oCalendar,u=$("#"+r.prefix+t),i;u.empty();i=$("<table><\/table>").attr("id",r.prefix+n).attr("class","fancyColumnTable");i.append(this.createEmptyColumnTableHeader(n,t));i.append(this.createColumnCapacityTableBody(n,t));i.append(this.createColumnCapacityTableFooter(n,t));u.append(i)};Robotics.Client.Controls.roSchedulerCalendar.prototype.createColumnCapacityTableBody=function(n){var i=this.oBaseControl,h=i.oCalendar,r=$("<tbody><\/tbody>").attr("id",i.prefix+n+"_tbody"),t=i,u=t.capacityList[Object.keys(t.capacityList)[0]],e=!1;if(typeof u!="undefined"&&Object.keys(u).forEach(function(n){n!="?"&&(e=!0)}),e)Object.keys(u).forEach(function(n){var u,o;if(n!="?"){var s=$("<tr><\/tr>").attr("class","shiftColumnRow"),l=$("<td><\/td>"),c=$("<div><\/div>").attr("class","CalendarShiftsFixed CalendarShiftFixedBody");c.append($("<div><\/div>").attr("class","CalendarShiftContentFixedBody").html('<span style="font-weight:bold">'+n+"<\/span>"));s.append(l.append(c));var i=null,f="",h=null,e=null;if(t.viewRange==Robotics.Client.Constants.ViewRange.Daily)for(u=t.getMinDailyCell();u<t.getMaxDailyCell();u++)i=t.oCalendar.CalendarHeader.PeriodHeaderData[u].Row1Text+"_"+t.oCalendar.CalendarHeader.PeriodHeaderData[u].Row2Text,i=i.replace(":","_"),f="",o=!1,typeof t.columnCapacityList[i][n]!="undefined"&&(t.columnCapacityList[i][n].Max>0?(f=t.columnCapacityList[i][n].Actual+"/"+t.columnCapacityList[i][n].Max,t.columnCapacityList[i][n].Actual>t.columnCapacityList[i][n].Max&&(o=!0)):f=t.columnCapacityList[i][n].Actual+"/ --"),h=$("<td><\/td>"),e=$("<div><\/div>").attr("class","ColumnShiftTableBodyCell DailyCell"),e.append($("<div><\/div>").attr("class","ContentShiftsColumnCell").attr("style",o?"color:red":"color:black").html(f)),s.append(h.append(e));else for(u=0;u<t.oCalendar.CalendarHeader.PeriodHeaderData.length;u++)i=t.oCalendar.CalendarHeader.PeriodHeaderData[u].Row1Text+"_"+t.oCalendar.CalendarHeader.PeriodHeaderData[u].Row2Text,i=i.replace(":","_"),f="",o=!1,typeof t.columnCapacityList[i][n]!="undefined"&&(t.columnCapacityList[i][n].Max>0?(f=t.columnCapacityList[i][n].Actual+"/"+t.columnCapacityList[i][n].Max,t.columnCapacityList[i][n].Actual>t.columnCapacityList[i][n].Max&&(o=!0)):f=t.columnCapacityList[i][n].Actual+"/ --"),h=$("<td><\/td>"),e=$("<div><\/div>").attr("class","ColumnShiftTableBodyCell"),e.append($("<div><\/div>").attr("class","ContentShiftsColumnCell").attr("style",o?"color:red":"color:gray").html(f)),s.append(h.append(e));tmpCell=$('<td style="width:100%"><\/td>').html("&nbsp;");s.append(tmpCell);r.append(s)}});else{var f=$("<tr><\/tr>").attr("class","shiftColumnRow"),s=$("<td><\/td>"),o=$("<div><\/div>").attr("class","CalendarShiftsFixed CalendarShiftFixedBody");o.append($("<div><\/div>").attr("class","CalendarShiftContentFixedBody").html('<span style="font-weight:bold">'+Globalize.formatMessage("roNoWorkCenter")+"<\/span>"));f.append(s.append(o));f.append($('<td style="width:100%"><\/td>').html("&nbsp;"));r.append(f)}return r};Robotics.Client.Controls.roSchedulerCalendar.prototype.createColumnCapacityTableFooter=function(n){var e=this.oBaseControl,c=e.oCalendar,o=$("<tfoot><\/tfoot>").attr("id",e.prefix+n+"_tfoot"),i=e,u=$("<tr><\/tr>").attr("class","shiftColumnRow"),h=$("<td><\/td>"),s=$("<div><\/div>").attr("class",""),t;s.append($("<div><\/div>").attr("class","CalendarShiftContentFixedBody").html("&nbsp;"));u.append(h.append(s));var r=null,f=null;if(i.viewRange==Robotics.Client.Constants.ViewRange.Daily)for(t=i.getMinDailyCell();t<i.getMaxDailyCell();t++)r=i.oCalendar.CalendarHeader.PeriodHeaderData[t].Row1Text+"_"+i.oCalendar.CalendarHeader.PeriodHeaderData[t].Row2Text,r=r.replace(":","_"),f=$("<td><\/td>"),u.append(f);else for(t=0;t<i.oCalendar.CalendarHeader.PeriodHeaderData.length;t++)r=i.oCalendar.CalendarHeader.PeriodHeaderData[t].Row1Text+"_"+i.oCalendar.CalendarHeader.PeriodHeaderData[t].Row2Text,r=r.replace(":","_"),f=$("<td><\/td>"),u.append(f);return tmpCell=$('<td style="width:100%"><\/td>').html("&nbsp;"),u.append(tmpCell),o.append(u),o};Robotics.Client.Controls.roSchedulerCalendar.prototype.createColumnAssignmentsTable=function(n,t){var r=this.oBaseControl,f=r.oCalendar,u=$("#"+r.prefix+t),i;u.empty();i=$("<table><\/table>").attr("id",r.prefix+n).attr("class","fancyColumnTable");i.append(this.createEmptyColumnTableHeader(n,t));i.append(this.createColumnAssignmentsTableBody(n,t));i.append(this.createColumnAssignmentsTableFooter(n,t));u.append(i)};Robotics.Client.Controls.roSchedulerCalendar.prototype.createColumnAssignmentsTableBody=function(n){var i=this.oBaseControl,f=i.oCalendar,r=$("<tbody><\/tbody>").attr("id",i.prefix+n+"_tbody"),t=i,u=t.assignmentsFilter.split(",");return Object.keys(t.assignmentsList).forEach(function(n){var y=!1,a,o,h,c;if(t.assignmentsFilter!=""){for(a=0;a<u.length;a++)if(parseInt(n,10)==parseInt(u[a],10)){y=!0;break}}else y=!0;if(y){var l=$("<tr><\/tr>").attr("class","shiftColumnRow"),w=$("<td><\/td>"),p=$("<div><\/div>").attr("class","CalendarShiftsFixed CalendarShiftFixedBody");p.append($("<div><\/div>").attr("class","CalendarShiftContentFixedBody").html('<span style="font-weight:bold">'+t.assignmentsList[n].ShortName+"<\/span>:   "+t.assignmentsList[n].Name));l.append(w.append(p));var f=null,e=0,i=undefined,v=null,s=null;if(t.viewRange==Robotics.Client.Constants.ViewRange.Daily)for(o=t.getMinDailyCell();o<t.getMaxDailyCell();o++)i=undefined,f=t.oCalendar.CalendarHeader.PeriodHeaderData[o].Row1Text+"_"+t.oCalendar.CalendarHeader.PeriodHeaderData[o].Row2Text,f=f.replace(":","_"),e=0,typeof t.columnAssignmentsList[f][t.assignmentsList[n].ID]!="undefined"&&(e=t.columnAssignmentsList[f][t.assignmentsList[n].ID].Count,t.loadRecursive&&typeof t.columnAssignmentsList[f][t.assignmentsList[n].ID].Expected!="undefined"&&(i=t.columnAssignmentsList[f][t.assignmentsList[n].ID].Expected),e=Math.round(e*100)/100,typeof i!="undefined"&&(i=Math.round(i*100)/100)),v=$("<td><\/td>"),s=$("<div><\/div>").attr("class","ColumnShiftTableBodyCell DailyCell"),h="",c=e,typeof i!="undefined"&&i==0&&(h="color:#38e219"),typeof i!="undefined"&&i!=0&&t.schedulingView==Robotics.Client.Constants.CoverageDayView.Planified&&(c+='<span style="color:'+(i>=0?'orange"> (+ ':'red"> (')+i+")<\/span>"),s.append($("<div><\/div>").attr("class","ContentShiftsColumnCell").attr("style",h).html(c)),l.append(v.append(s));else for(o=0;o<t.oCalendar.CalendarHeader.PeriodHeaderData.length;o++)i=undefined,f=t.oCalendar.CalendarHeader.PeriodHeaderData[o].Row1Text+"_"+t.oCalendar.CalendarHeader.PeriodHeaderData[o].Row2Text,f=f.replace(":","_"),e=0,typeof t.columnAssignmentsList[f][t.assignmentsList[n].ID]!="undefined"&&(e=t.columnAssignmentsList[f][t.assignmentsList[n].ID].Count,t.loadRecursive&&typeof t.columnAssignmentsList[f][t.assignmentsList[n].ID].Expected!="undefined"&&(i=t.columnAssignmentsList[f][t.assignmentsList[n].ID].Expected),e=Math.round(e*100)/100,typeof i!="undefined"&&(i=Math.round(i*100)/100)),v=$("<td><\/td>"),s=$("<div><\/div>").attr("class","ColumnShiftTableBodyCell"),h="",c=e,typeof i!="undefined"&&i==0&&(h="color:#38e219"),typeof i!="undefined"&&i!=0&&t.schedulingView==Robotics.Client.Constants.CoverageDayView.Planified&&(c+='<span style="color:'+(i>=0?'orange"> (+ ':'red"> (')+i+")<\/span>"),s.append($("<div><\/div>").attr("class","ContentShiftsColumnCell").attr("style",h).html(c)),l.append(v.append(s));tmpCell=$('<td style="width:100%"><\/td>').html("&nbsp;");l.append(tmpCell);r.append(l)}}),r};Robotics.Client.Controls.roSchedulerCalendar.prototype.createColumnAssignmentsTableFooter=function(n){var h=this.oBaseControl,v=h.oCalendar,c=$("<tfoot><\/tfoot>").attr("id",h.prefix+n+"_tfoot"),t=h,o=t.assignmentsFilter.split(","),e=$("<tr><\/tr>").attr("class","shiftColumnRow"),a=$("<td><\/td>"),l=$("<div><\/div>").attr("class","CalendarShiftsFixed CalendarShiftFixedBody"),r;l.append($("<div><\/div>").attr("class","CalendarShiftContentFixedBody").html("&nbsp;"));e.append(a.append(l));var i=null,u=0,s=null,f=null;if(t.viewRange==Robotics.Client.Constants.ViewRange.Daily)for(r=t.getMinDailyCell();r<t.getMaxDailyCell();r++)i=t.oCalendar.CalendarHeader.PeriodHeaderData[r].Row1Text+"_"+t.oCalendar.CalendarHeader.PeriodHeaderData[r].Row2Text,i=i.replace(":","_"),s=$("<td><\/td>"),f=$("<div><\/div>").attr("class","ColumnShiftTableBodyCell DailyCell totalRowBackground"),u=0,Object.keys(t.assignmentsList).forEach(function(n){var f=!1,r;if(t.assignmentsFilter!=""){for(r=0;r<o.length;r++)if(parseInt(n,10)==parseInt(o[r],10)){f=!0;break}}else f=!0;f&&typeof t.columnAssignmentsList[i][t.assignmentsList[n].ID]!="undefined"&&(u+=t.columnAssignmentsList[i][t.assignmentsList[n].ID].Count)}),f.append($("<div><\/div>").attr("class","ContentShiftsColumnCell").html(Math.round(u*100)/100)),e.append(s.append(f));else for(r=0;r<t.oCalendar.CalendarHeader.PeriodHeaderData.length;r++)i=t.oCalendar.CalendarHeader.PeriodHeaderData[r].Row1Text+"_"+t.oCalendar.CalendarHeader.PeriodHeaderData[r].Row2Text,i=i.replace(":","_"),s=$("<td><\/td>"),f=$("<div><\/div>").attr("class","ColumnShiftTableBodyCell totalRowBackground"),u=0,Object.keys(t.assignmentsList).forEach(function(n){var f=!1,r;if(t.assignmentsFilter!=""){for(r=0;r<o.length;r++)if(parseInt(n,10)==parseInt(o[r],10)){f=!0;break}}else f=!0;f&&typeof t.columnAssignmentsList[i][t.assignmentsList[n].ID]!="undefined"&&(u+=t.columnAssignmentsList[i][t.assignmentsList[n].ID].Count)}),f.append($("<div><\/div>").attr("class","ContentShiftsColumnCell").html(Math.round(u*100)/100)),e.append(s.append(f));return tmpCell=$('<td style="width:100%"><\/td>').attr("class","totalRowBackground").html("&nbsp;"),e.append(tmpCell),c.append(e),c};Robotics.Client.Controls.roSchedulerCalendar.prototype.createAccrualsTable=function(n,t){var r=this.oBaseControl,f=r.oCalendar,u=$("#"+r.prefix+t),i;u.empty();i=$("<table><\/table>").attr("id",r.prefix+n).attr("class","fancyTable");i.append(this.createAccrualsTableHeader(n,t));i.append(this.createAccrualsTableBody(n,t));r.isScheduleActive&&i.append(this.createAccrualsTableFooter(n,t));u.append(i)};Robotics.Client.Controls.roSchedulerCalendar.prototype.createAccrualsTooltipContainer=function(n,t){var i=this.oBaseControl,v=i.oCalendar,u=$("<div><\/div>").attr("style","position:absolute; left:-200%"),r=$("<div><\/div>").attr("id",i.ascxPrefix+"_tooltipAccrualsContainer_"+n+"_0").attr("class","tooltipAccrualsContainer"),f=$("<div><\/div>").html('<span class="fontBold fontBig" style="text-align:left">'+Globalize.formatMessage("roAccrualDetail")+"<\/span>"),e=$('<div style="margin-top:5px;clear:both"><\/div>'),o=$('<div style="clear:both;width:250px"><\/div>').html('<div class="tooltipAccrualsLeftCell"><span style="font-weight:bold">'+Globalize.formatMessage("roWorkingHoursAssigned")+'<\/span><\/div><div class="tooltipAccrualsRightCell"> '+i.ConvertHoursToHourFormat(i.employeeDataList[t].WorkingHours)+"<\/div>"),s=$('<div style="clear:both;width:250px"><\/div>').html('<div class="tooltipAccrualsLeftCell"><span style="font-weight:bold">'+Globalize.formatMessage("roCommonHoursAssigned")+'<\/span><\/div><div class="tooltipAccrualsRightCell"> '+i.ConvertHoursToHourFormat(i.employeeDataList[t].WorkingHours-i.employeeDataList[t].ComplementaryHours)+"<\/div>"),h=$('<div style="clear:both;width:250px"><\/div>').html('<div class="tooltipAccrualsLeftCell"><span style="font-weight:bold">'+Globalize.formatMessage("roComplementaryHoursAssigned")+'<\/span><\/div><div class="tooltipAccrualsRightCell"> '+i.ConvertHoursToHourFormat(i.employeeDataList[t].ComplementaryHours)+"<\/div>"),c=$('<div style="clear:both;width:250px"><\/div>').html('<div class="tooltipAccrualsLeftCell"><span style="font-weight:bold">'+Globalize.formatMessage("roAbsenceHoursAssigned")+'<\/span><\/div><div class="tooltipAccrualsRightCell"> '+i.ConvertHoursToHourFormat(i.employeeDataList[t].AbsenceHours)+"<\/div>"),l=$('<div style="clear:both;width:250px"><\/div>').html('<div class="tooltipAccrualsLeftCell"><span style="font-weight:bold">'+Globalize.formatMessage("roAccruedHours")+'<\/span><\/div><div class="tooltipAccrualsRightCell"> '+i.ConvertHoursToHourFormat(i.employeeDataList[t].PlannedHours.AccruedToDate*60)+"<\/div>"),a=$('<div style="clear:both;width:250px"><\/div>').html('<div class="tooltipAccrualsLeftCell"><span style="font-weight:bold">'+Globalize.formatMessage("roTotalHours")+'<\/span><\/div><div class="tooltipAccrualsRightCell"> '+i.ConvertHoursToHourFormat(i.employeeDataList[t].PlannedHours.YearTotal*60)+"<\/div>");return r.append(f,e.append(o,s,h,c,l,a)),u.append(r)};Robotics.Client.Controls.roSchedulerCalendar.prototype.createHolidaysTooltipContainer=function(n,t){var i=this.oBaseControl,a=i.oCalendar,f=$("<div><\/div>").attr("style","position:absolute; left:-200%"),r=$("<div><\/div>").attr("id",i.ascxPrefix+"_tooltipHolidaysContainer_"+n+"_1").attr("class","tooltipHolidaysContainer"),e=$("<div><\/div>").html('<span class="fontBold fontBig" style="text-align:left">'+Globalize.formatMessage("roHolidayDetail")+"<\/span>"),u=$('<div style="margin-top:5px;clear:both"><\/div>'),o=$('<div style="clear:both;width:175px"><\/div>').html('<div class="tooltipHolidaysLeftCell"><span style="font-weight:bold">'+Globalize.formatMessage("roHolidayAvilableDetail")+'<\/span><\/div><div class="tooltipHolidaysRightCell">  '+(i.employeeDataList[t].InitialHolidays-i.employeeDataList[t].AssignedHolidays)+"<\/div>"),s=$('<div style="clear:both;width:175px"><\/div>').html('<div class="tooltipHolidaysLeftCell"><span style="font-weight:bold">'+Globalize.formatMessage("roHolidayInPeriod")+'<\/span><\/div><div class="tooltipHolidaysRightCell"> '+i.employeeDataList[t].AssignedHolidays+"<\/div>"),h=$('<div style="clear:both;width:175px"><\/div>').html('<div class="tooltipHolidaysLeftCell"><span style="font-weight:bold">'+Globalize.formatMessage("roHolidayDoneDetail")+'<\/span><\/div><div class="tooltipHolidaysRightCell"> '+i.employeeDataList[t].HolidayResume.Done+"<\/div>"),c=$('<div style="clear:both;width:175px"><\/div>').html('<div class="tooltipHolidaysLeftCell"><span style="font-weight:bold">'+Globalize.formatMessage("roHolidayRequestedDetail")+'<\/span><\/div><div class="tooltipHolidaysRightCell"> '+i.employeeDataList[t].HolidayResume.Requested+"<\/div>"),l=$('<div style="clear:both;width:175px"><\/div>').html('<div class="tooltipHolidaysLeftCell"><span style="font-weight:bold">'+Globalize.formatMessage("roHolidayPendingDetail")+'<\/span><\/div><div class="tooltipHolidaysRightCell"> '+i.employeeDataList[t].HolidayResume.Pending+"<\/div>");return u.append(o,s,h,c,l),r.append(e,u),f.append(r)};Robotics.Client.Controls.roSchedulerCalendar.prototype.createAccrualsTableHeader=function(n){var t=this.oBaseControl,s=t.oCalendar,u=$("<thead><\/thead>").attr("id",t.prefix+n+"_thead"),i=$("<tr><\/tr>"),o=$("<th><\/th>"),f=$("<div><\/div>").attr("class","CalendarDayFixed CalendarRowFixedHeader"),e,r;return f.append($("<div><\/div>").attr("class","NorthRowCell").html(t.translator.translate(Robotics.Client.Language.Tags.PlannedHours))),e=$("<th><\/th>"),r=$("<div><\/div>").attr("class","CalendarDayFixed CalendarRowFixedHeader"),r.append($("<div><\/div>").attr("class","NorthRowCell").html(t.translator.translate(Robotics.Client.Language.Tags.Holidays))),i.append(o.append(f)),i.append(e.append(r)),u.append(i),u};Robotics.Client.Controls.roSchedulerCalendar.prototype.createAccrualsTableBody=function(n){for(var h,t=this.oBaseControl,f=t.oCalendar,e=$("<tbody><\/tbody>").attr("id",t.prefix+n+"_tbody"),c=-1,o=-1,i=0;i<f.CalendarData.length;i++){if(o=f.CalendarData[i].EmployeeData.IDGroup,t.sortColumn==-1&&o!=c){var u=$("<tr><\/tr>"),y=$("<td><\/td>").attr("class","calendarOuterBodyFixedSeparator"),p=$("<td><\/td>").attr("class","calendarOuterBodyFixedSeparator");u.append(y,p);e.append(u)}var u=$("<tr><\/tr>"),r=f.CalendarData[i].EmployeeData.IDEmployee+"_"+f.CalendarData[i].EmployeeData.IDGroup,w=$("<td><\/td>"),l=$("<div><\/div>").attr("id",t.ascxPrefix+"_tooltipAccruals_"+i+"_0").attr("class","ColumnAccrualsTableBodyCell resumeAccrualCell"),s=$("<div><\/div>").attr("id",t.ascxPrefix+"_tooltipTarget_"+i+"_0").attr("class","ContentAccrualsRowCell");s.append($("<div><\/div>").attr("class","totalAccrual").html(t.ConvertHoursToHourFormat(t.employeeDataList[r].WorkingHours+t.employeeDataList[r].AbsenceHours)));t.employeeDataList[r].ComplementaryHours>0&&(h=$("<div><\/div>"),h.html("(HO:"+t.ConvertHoursToHourFormat(t.employeeDataList[r].WorkingHours-t.employeeDataList[r].ComplementaryHours)+" HC:"+t.ConvertHoursToHourFormat(t.employeeDataList[r].ComplementaryHours)+")"),s.append(h));l.append(s,this.createAccrualsTooltipContainer(i,r));var b=$("<td><\/td>"),a=$("<div><\/div>").attr("id",t.ascxPrefix+"_tooltipHolidays_"+i+"_1").attr("class","ColumnAccrualsTableBodyCell resumeHolidayCell"),v=$("<div><\/div>").attr("id",t.ascxPrefix+"_tooltipTarget_"+i+"_1").attr("class","ContentAccrualsRowCell");v.append($("<div><\/div>").attr("class","totalAccrual").html(t.employeeDataList[r].InitialHolidays-t.employeeDataList[r].AssignedHolidays));a.append(v,this.createHolidaysTooltipContainer(i,r));u.append(w.append(l));u.append(b.append(a));tmpCell=$('<td style="width:100%"><\/td>').html("&nbsp;");u.append(tmpCell);e.append(u);c=o}return e};Robotics.Client.Controls.roSchedulerCalendar.prototype.createAccrualsTableFooter=function(n){var t=this.oBaseControl,s=t.oCalendar,u=$("<tfoot><\/tfoot>").attr("id",t.prefix+n+"_tfoot"),i=$("<tr><\/tr>"),o=$("<td><\/td>"),f=$("<div><\/div>").attr("class","CalendarDayFixed CalendarRowFixedHeader"),e,r;return f.append($("<div><\/div>").attr("class","SouthRowCell").html(t.translator.translate(Robotics.Client.Language.Tags.PlannedHours))),e=$("<td><\/td>"),r=$("<div><\/div>").attr("class","CalendarDayFixed CalendarRowFixedHeader"),r.append($("<div><\/div>").attr("class","SouthRowCell").html(t.translator.translate(Robotics.Client.Language.Tags.Holidays))),i.append(o.append(f)),i.append(e.append(r)),u.append(i),u};Robotics.Client.Controls.roSchedulerCalendar.prototype.createShiftsRowTable=function(n,t){var r=this.oBaseControl,f=r.oCalendar,u=$("#"+r.prefix+t),i;u.empty();i=$("<table><\/table>").attr("id",r.prefix+n).attr("class","fancyTable");i.append(this.createShiftsRowTableHeader(n,t));i.append(this.createShiftsRowTableBody(n,t));r.isScheduleActive&&i.append(this.createShiftsRowTableFooter(n,t));u.append(i)};Robotics.Client.Controls.roSchedulerCalendar.prototype.createShiftsRowTableHeader=function(n){var t=this.oBaseControl,f=t.oCalendar,i=$("<thead><\/thead>").attr("id",t.prefix+n+"_thead"),r=$("<tr><\/tr>"),u=t;return Object.keys(u.shiftsList).forEach(function(n){var i=$("<th><\/th>"),t=$("<div><\/div>").attr("class","CalendarShiftsDayFixed CalendarShiftRowFixedHeader");t.append($("<div><\/div>").attr("class","NorthRowCell").html(n));r.append(i.append(t))}),i.append(r),i};Robotics.Client.Controls.roSchedulerCalendar.prototype.createShiftsRowTableBody=function(n){for(var i,u=this.oBaseControl,o=u.oCalendar,f=$("<tbody><\/tbody>").attr("id",u.prefix+n+"_tbody"),t=u,s=-1,e=-1,r=0;r<o.CalendarData.length;r++)e=o.CalendarData[r].EmployeeData.IDGroup,u.sortColumn==-1&&e!=s&&(i=$("<tr><\/tr>"),Object.keys(t.shiftsList).forEach(function(){i.append($("<td><\/td>").attr("class","calendarOuterBodyFixedSeparator"))}),f.append(i)),i=$("<tr><\/tr>"),Object.keys(t.shiftsList).forEach(function(n){var o=$("<td><\/td>"),f=t.oCalendar.CalendarData[r].EmployeeData.IDEmployee+"_"+t.oCalendar.CalendarData[r].EmployeeData.IDGroup,e=0,u;typeof t.rowsShiftsList[f][t.shiftsList[n].ShortName]!="undefined"&&(e=t.rowsShiftsList[f][t.shiftsList[n].ShortName].Count);u=$("<div><\/div>").attr("class","ColumnShiftsTableBodyCell");u.append($("<div><\/div>").attr("class","ContentShiftsRowCell").html(e));i.append(o.append(u))}),tmpCell=$('<td style="width:100%"><\/td>').html("&nbsp;"),i.append(tmpCell),f.append(i),s=e;return f};Robotics.Client.Controls.roSchedulerCalendar.prototype.createShiftsRowTableFooter=function(n){var t=this.oBaseControl,f=t.oCalendar,i=$("<tfoot><\/tfoot>").attr("id",t.prefix+n+"_tfoot"),r=$("<tr><\/tr>"),u=t;return Object.keys(u.shiftsList).forEach(function(n){var i=$("<td><\/td>"),t=$("<div><\/div>").attr("class","CalendarShiftsDayFixed CalendarShiftRowFixedHeader");t.append($("<div><\/div>").attr("class","NorthRowCell").html(n));r.append(i.append(t))}),i.append(r),i};Robotics.Client.Controls.roSchedulerCalendar.prototype.createAssignmentsRowTable=function(n,t){var r=this.oBaseControl,f=r.oCalendar,u=$("#"+r.prefix+t),i;u.empty();i=$("<table><\/table>").attr("id",r.prefix+n).attr("class","fancyTable");i.append(this.createAssignmentsRowTableHeader(n,t));i.append(this.createAssignmentsRowTableBody(n,t));r.isScheduleActive&&i.append(this.createAssignmentsRowTableFooter(n,t));u.append(i)};Robotics.Client.Controls.roSchedulerCalendar.prototype.createAssignmentsRowTableHeader=function(n){var i=this.oBaseControl,e=i.oCalendar,r=$("<thead><\/thead>").attr("id",i.prefix+n+"_thead"),u=$("<tr><\/tr>"),t=i,f=t.assignmentsFilter.split(",");return Object.keys(t.assignmentsList).forEach(function(n){var r=!1,i,o,e;if(t.assignmentsFilter!=""){for(i=0;i<f.length;i++)if(parseInt(n,10)==parseInt(f[i],10)){r=!0;break}}else r=!0;r&&(o=$("<th><\/th>"),e=$("<div><\/div>").attr("class","CalendarShiftsDayFixed CalendarShiftRowFixedHeader"),e.append($("<div><\/div>").attr("class","NorthRowCell").attr("title",t.assignmentsList[n].Name).html(t.assignmentsList[n].ShortName)),u.append(o.append(e)))}),r.append(u),r};Robotics.Client.Controls.roSchedulerCalendar.prototype.createAssignmentsRowTableBody=function(n){for(var i,u=this.oBaseControl,o=u.oCalendar,f=$("<tbody><\/tbody>").attr("id",u.prefix+n+"_tbody"),t=u,s=t.assignmentsFilter.split(","),h=-1,e=-1,r=0;r<o.CalendarData.length;r++)e=o.CalendarData[r].EmployeeData.IDGroup,u.sortColumn==-1&&e!=h&&(i=$("<tr><\/tr>"),Object.keys(t.assignmentsList).forEach(function(){i.append($("<td><\/td>").attr("class","calendarOuterBodyFixedSeparator"))}),f.append(i)),i=$("<tr><\/tr>"),Object.keys(t.assignmentsList).forEach(function(n){var f=!1,u,e;if(t.assignmentsFilter!=""){for(u=0;u<s.length;u++)if(parseInt(n,10)==parseInt(s[u],10)){f=!0;break}}else f=!0;if(f){var c=$("<td><\/td>"),o=t.oCalendar.CalendarData[r].EmployeeData.IDEmployee+"_"+t.oCalendar.CalendarData[r].EmployeeData.IDGroup,h=0;typeof t.rowsAssignmentsList[o][t.assignmentsList[n].ID]!="undefined"&&(h=t.rowsAssignmentsList[o][t.assignmentsList[n].ID].Count);e=$("<div><\/div>").attr("class","ColumnShiftsTableBodyCell");e.append($("<div><\/div>").attr("class","ContentShiftsRowCell").html(Math.round(h*100)/100));i.append(c.append(e))}}),tmpCell=$('<td style="width:100%"><\/td>').html("&nbsp;"),i.append(tmpCell),f.append(i),h=e;return f};Robotics.Client.Controls.roSchedulerCalendar.prototype.createAssignmentsRowTableFooter=function(n){var i=this.oBaseControl,e=i.oCalendar,r=$("<tfoot><\/tfoot>").attr("id",i.prefix+n+"_tfoot"),u=$("<tr><\/tr>"),t=i,f=t.assignmentsFilter.split(",");return Object.keys(t.assignmentsList).forEach(function(n){var r=!1,i,o,e;if(t.assignmentsFilter!=""){for(i=0;i<f.length;i++)if(parseInt(n,10)==parseInt(f[i],10)){r=!0;break}}else r=!0;r&&(o=$("<td><\/td>"),e=$("<div><\/div>").attr("class","CalendarShiftsDayFixed CalendarShiftRowFixedHeader"),e.append($("<div><\/div>").attr("class","NorthRowCell").attr("title",t.assignmentsList[n].Name).html(t.assignmentsList[n].ShortName)),u.append(o.append(e)))}),r.append(u),r};Robotics.Client.Controls.roSchedulerCalendar.prototype.createIndictmentscolumnTable=function(n,t){var i=this,r=this.oBaseControl,f=r.oCalendar,u=$("#"+r.prefix+t);u.empty();u.append($("<div><\/div>").attr("id","calendar_indictments_groupedList"));i.calendarIndictmentsDS=[];Object.keys(i.calendarIndictments).forEach(function(n){i.calendarIndictmentsDS.push(i.calendarIndictments[n])});setTimeout(function(){$("#calendar_indictments_groupedList").dxList({dataSource:i.calendarIndictmentsDS,height:"100%",grouped:!0,collapsibleGroups:!0,groupTemplate:function(n){return $("<div>"+Globalize.formatMessage("roIndictmentRule")+": "+n.key+"("+n.counter+")<\/div>")},itemTemplate:function(n){return $('<div style="cursor:pointer">'+n.description+"<\/div>")},onContentReady:function(n){setTimeout(function(){for(var i=n.component.option("items"),t=0;t<i.length;t++)n.component.collapseGroup(t)},50)},onItemClick:function(n){var o=n.itemData.idRow[0],u=n.itemData.idColumn[0],t,f,e;for($("#"+r.prefix+"Main div.fht-fixed-body div.fht-tbody").scrollLeft((u-5)*100),i.setSingleSelectedObject($("#"+r.ascxPrefix+"_calCell_"+o+"_"+u)),t=0;t<n.itemData.idRow.length;t++)f=n.itemData.idRow[t],e=n.itemData.idColumn[t],$("#"+r.ascxPrefix+"_calCell_"+f+"_"+e).addClass("scaledObject");setTimeout(function(){for(var i,u,t=0;t<n.itemData.idRow.length;t++)i=n.itemData.idRow[t],u=n.itemData.idColumn[t],$("#"+r.ascxPrefix+"_calCell_"+i+"_"+u).removeClass("scaledObject")},350)}})},100)};Robotics.Client.Controls.roSchedulerCalendar.prototype.getSelectedIDEmployees=function(){var r=this.oBaseControl,i=r.oCalendar,n="",t;if(i!=null)for(t=0;t<i.CalendarData.length;t++)n!=""&&(n+=","),n+=i.CalendarData[t].EmployeeData.IDEmployee;return n};Robotics.Client.Controls.roSchedulerCalendar.prototype.getAssignedShift=function(n){return n.MainShift};Robotics.Client.Controls.roSchedulerCalendar.prototype.selectCellByEmployeeDate=function(n,t){var i=this.oBaseControl,u=i.oCalendar,e=!1,r,f;if(u!=null&&u.CalendarData!=null&&u.CalendarData.length>0)for(r=0;r<u.CalendarData.length;r++)if(u.CalendarData[r].EmployeeData.IDEmployee==n){for(i.selectedEmployee=u.CalendarData[r],f=0;f<u.CalendarData[r].PeriodData.DayData.length;f++)if(moment(u.CalendarData[r].PeriodData.DayData[f].PlanDate).isSame(t)){i.selectedDay=u.CalendarData[r].PeriodData.DayData[f];i.typeView==Robotics.Client.Constants.TypeView.Planification?i.viewRange==Robotics.Client.Constants.ViewRange.Period?i.selectedContainer=$("#"+i.ascxPrefix+"_calCell_"+r+"_"+f):i.viewRange==Robotics.Client.Constants.ViewRange.Daily&&(i.selectedContainer=$("#"+i.ascxPrefix+"_calDailyCell_"+r+"_60")):i.typeView==Robotics.Client.Constants.TypeView.Review&&(i.selectedContainer=$("#"+i.ascxPrefix+"_reviewDailyCell_"+r+"_"+f));e=!0;break}break}return e};Robotics.Client.Controls.roSchedulerCalendar.prototype.generateLoadFilters=function(){var n=this.oBaseControl,i=n.oCalendar,t={};return n.firstDate==null&&(n.firstDate=moment().startOf("month").toDate(),n.endDate=moment(n.firstDate).add(1,"month").subtract(1,"day").startOf("day").toDate()),t.firstDate=n.firstDate,t.endDate=n.endDate,t.employeeFilter=n.employeeFilter!=""?n.employeeFilter:"1=2",t.loadRecursive=n.loadRecursive,t.loadIndictments=n.isScheduleActive||n.saasPremiumActive?n.loadIndictments:!1,t.loadPunches=n.loadPunches,t.loadCapacities=n.loadCapacities,t.calendar=null,t.typeView=n.typeView,t.assignmentsFilter=n.assignmentsFilter,t.dailyPeriod=n.dailyPeriod,t.StampParam=(new Date).getMilliseconds(),t};Robotics.Client.Controls.roSchedulerCalendar.prototype.loadData=function(n,t,i,r,u,f,e,o,s,h){var c=this.oBaseControl,l=c.oCalendar;c.hasChanges==!1?(c.refreshTimmer!=-1&&clearTimeout(c.refreshTimmer),c.refreshTimmer=-1,c.sortColumn=-1,typeof i!="undefined"&&i!=null&&(c.employeeFilter=i),typeof r!="undefined"&&r!=null&&(c.loadRecursive=r),c.isScheduleActive||c.saasPremiumActive?typeof e!="undefined"&&e!=null&&(c.loadIndictments=e):c.loadIndictments=!1,typeof o!="undefined"&&o!=null&&(c.loadPunches=o),typeof h!="undefined"&&h!=null&&(c.loadPunches=h),typeof n!="undefined"&&n!=null&&(c.firstDate=n),typeof t!="undefined"&&t!=null&&(c.endDate=t),typeof u!="undefined"&&u!=null&&(c.typeView=u),typeof f!="undefined"&&f!=null&&(c.assignmentsFilter=f),typeof s!="undefined"&&s!=null&&(c.dailyPeriod=s),c.refresh()):c.showChangesWarning("refreshCalendar('',true);")};Robotics.Client.Controls.roSchedulerCalendar.prototype.saveChanges=function(){var t=this.oBaseControl,i,n,r;t.capatityEnabled?(i=!1,t.capacityError&&(n=t,r=n.capacityList[Object.keys(n.capacityList)[0]],typeof r!="undefined"&&Object.keys(r).forEach(function(t){var r=null,u;if(n.viewRange==Robotics.Client.Constants.ViewRange.Daily)for(u=n.getMinDailyCell();u<n.getMaxDailyCell();u++)r=n.oCalendar.CalendarHeader.PeriodHeaderData[u].Row1Text+"_"+n.oCalendar.CalendarHeader.PeriodHeaderData[u].Row2Text,r=r.replace(":","_"),typeof n.columnCapacityList[r][t]!="undefined"&&n.columnCapacityList[r][t].HasChanges&&n.columnCapacityList[r][t].Max>0&&n.columnCapacityList[r][t].Actual>n.columnCapacityList[r][t].Max&&(i=!0);else for(u=0;u<n.oCalendar.CalendarHeader.PeriodHeaderData.length;u++)r=n.oCalendar.CalendarHeader.PeriodHeaderData[u].Row1Text+"_"+n.oCalendar.CalendarHeader.PeriodHeaderData[u].Row2Text,r=r.replace(":","_"),typeof n.columnCapacityList[r][t]!="undefined"&&n.columnCapacityList[r][t].HasChanges&&n.columnCapacityList[r][t].Max>0&&n.columnCapacityList[r][t].Actual>n.columnCapacityList[r][t].Max&&(i=!0)})),i?t.showCapacityWarning():this.saveChangesFinally()):this.saveChangesFinally()};Robotics.Client.Controls.roSchedulerCalendar.prototype.saveChangesFinally=function(){var t=this.oBaseControl,i=t.oCalendar,n={};n.calendar=i;n.StampParam=(new Date).getMilliseconds();t.performAction(n,Robotics.Client.Constants.Actions.SaveChanges)};Robotics.Client.Controls.roSchedulerCalendar.prototype.reloadHourDayData=function(){var n=this.oBaseControl,u=n.oCalendar,i={},t,r;i.StampParam=(new Date).getMilliseconds();i.idEmployee=n.selectedEmployee.EmployeeData.IDEmployee;i.idGroup=n.selectedEmployee.EmployeeData.IDGroup;t=this.getAssignedShift(n.selectedDay);r=null;r={ID:t.ID,ShortName:t.ShortName,PlannedHours:t.PlannedHours,Color:t.Color,Name:t.Name,Type:t.Type,StartHour:t.StartHour,EndHour:moment(t.EndHour).clone().toDate(),ShiftLayers:n.selectedDay.MainShift.ShiftLayers,ShiftLayersDefinition:n.selectedDay.MainShift.ShiftLayersDefinition};t!=null?t.Type==Robotics.Client.Constants.ShiftType.Holiday||t.Type==Robotics.Client.Constants.ShiftType.Holiday_NonWorking?(i.idShift=n.selectedDay.ShiftBase.ID,r.ShiftLayers=n.selectedDay.ShiftBase.ShiftLayers,r.ShiftLayersDefinition=n.selectedDay.ShiftBase.ShiftLayersDefinition):i.idShift=t.ID:i.idShift=-1;i.shiftData=r;i.firstDate=n.selectedDay.PlanDate;i.dailyPeriod=n.dailyPeriod;i.endDate=(n.selectedDay.MainShift.Type==Robotics.Client.Constants.ShiftType.Holiday||n.selectedDay.MainShift.Type==Robotics.Client.Constants.ShiftType.Holiday_NonWorking)&&typeof n.selectedDay.ShiftBase!="undefined"&&n.selectedDay.ShiftBase!=null&&n.selectedDay.ShiftBase.Type==Robotics.Client.Constants.ShiftType.NormalFloating?n.selectedDay.ShiftBase.StartHour:n.selectedDay.MainShift.StartHour;n.performAction(i,Robotics.Client.Constants.Actions.LoadHourData)};Robotics.Client.Controls.roSchedulerCalendar.prototype.refreshFullDay=function(){var n=this.oBaseControl,t=n.oCalendar;n.typeView==Robotics.Client.Constants.TypeView.Planification?(n.viewRange==Robotics.Client.Constants.ViewRange.Period?(n.selectedContainer.empty(),this.buildCalendarCellContent(n.selectedContainer,n.selectedDay,!1,n.selectedEmployee.EmployeeData.FreezingDate)):n.viewRange==Robotics.Client.Constants.ViewRange.Daily&&this.reloadHourDayData(),this.waitForUserToRefresh()):n.typeView==Robotics.Client.Constants.TypeView.Review&&(n.selectedContainer.empty(),n.loadPunches?this.buildReviewCalendarCellPunches(n.selectedContainer,n.selectedDay):this.buildReviewCalendarCellContentV2(n.selectedContainer,n.selectedDay,n.selectedEmployee.EmployeeData.FreezingDate))};Robotics.Client.Controls.roSchedulerCalendar.prototype.refreshDailySelectedData=function(n){for(var f,t=this.oBaseControl,u=t.oCalendar,i=parseInt(t.selectedContainer.attr("data-IDRow"),10),r=t.getMinDailyCell();r<t.getMaxDailyCell();r++)f=$("#"+t.ascxPrefix+"_calDailyCell_"+i+"_"+r),f.empty(),this.createDailyCalendarCellContent(f,u.CalendarData[i].EmployeeData,u.CalendarData[i].PeriodData.DayData[0],u.CalendarData[i].PeriodData.DayData[0].HourData[r],r);n&&(u.CalendarData[i].PeriodData.DayData[0].HasChanged=!0,this.setHasChanges(!0));this.waitForUserToRefresh()};Robotics.Client.Controls.roSchedulerCalendar.prototype.buildContextMenu=function(n){var t=this.oBaseControl,e=t.oCalendar,o=n[0].innerText,i,r,u,f;return t.typeView==Robotics.Client.Constants.TypeView.Planification?(items={enter:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_Details),disabled:!1,icon:"detail"},complementary:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_EditComplementary),disabled:!1,icon:"complementary"},assignment:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_EditAssignments),disabled:!1,icon:"assignment"},removeShift:{name:Globalize.formatMessage("roRemoveShift"),disabled:!1,icon:"removeShift"},removeBudget:{name:Globalize.formatMessage("roRemoveFromBudget"),disabled:!1,icon:"removeBudget"},split1:{name:"---------",disabled:!0},setTelecommuteOffice:{name:Globalize.formatMessage("roSetTelecommuteOffice"),disabled:!1,icon:"tc_office"},setTelecommuteHome:{name:Globalize.formatMessage("roSetTelecommuteHome"),disabled:!1,icon:"tc_home"},setTelecommuteOptional:{name:Globalize.formatMessage("roSetTelecommuteOptional"),disabled:!1,icon:"tc_optional"},setTelecommuteLabAgree:{name:Globalize.formatMessage("roSetTelecommuteLabAgree"),disabled:!1,icon:"tc_labagree"},split2:{name:"---------",disabled:!0},vacation:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_RemoveHolidays),disabled:!1,icon:"vacation"},addFeast:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_SetFeast),disabled:!1,icon:"setFeast"},removeFeast:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_RemoveFeast),disabled:!1,icon:"removeFeast"},split3:{name:"---------",disabled:!0},copyShift:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_Copy),disabled:!1,icon:"copyShift"},copyHolidays:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_CopyHolidays),disabled:!1,icon:"copyHolidays"},copyWorking:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_CopyWorking),disabled:!1,icon:"copyWorking"},copyAssignments:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_CopyAssignments),disabled:!1,icon:"copyAssignments"},split4:{name:"---------",disabled:!0},advPaste:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_AdvPaste),disabled:!1,icon:"advPaste"},pasteShift:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_Paste),disabled:!1,icon:"pasteShift"},pasteTelecommute:{name:Globalize.formatMessage("roPasteTelecommute"),disabled:!1,icon:"tc_pasteTelecommute"},cancelSelection:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_CancelSelection),disabled:!1,icon:"cancelSelection"},split5:{name:"---------",disabled:!0},block:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_Block),disabled:!1,icon:"block"},removeblock:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_UnBlock),disabled:!1,icon:"removeblock"}},i=this.getAssignedShift(t.selectedDay),t.hasChanges&&(items.enter.disabled=!0),t.telecommuteEnabled?t.selectedDay.CanTelecommute&&typeof t.selectedDay.MainShift!="undefined"?(items.setTelecommuteOffice.disabled=!1,items.setTelecommuteHome.disabled=!1,items.setTelecommuteOptional.disabled=!1,items.setTelecommuteLabAgree.disabled=!1):(items.setTelecommuteOffice.disabled=!0,items.setTelecommuteHome.disabled=!0,items.setTelecommuteOptional.disabled=!0,items.setTelecommuteLabAgree.disabled=moment(t.selectedDay.PlanDate).isAfter(moment().startOf("day"))?!1:!0):(delete items.split2,delete items.setTelecommuteOffice,delete items.setTelecommuteHome,delete items.setTelecommuteOptional,delete items.pasteTelecommute,delete items.setTelecommuteLabAgree),t.selectedDay.IDDailyBudgetPosition>0?(items.removeBudget.disabled=!1,items.removeShift.disabled=!0,items.assignment.disabled=!0,items.vacation.disabled=!0,items.addFeast.disabled=!0,items.removeFeast.disabled=!0,items.copyShift.disabled=!0,items.copyHolidays.disabled=!0,items.copyWorking.disabled=!0,items.copyAssignments.disabled=!0,items.advPaste.disabled=!0,items.pasteShift.disabled=!0,items.cancelSelection.disabled=!0,items.block.disabled=!0,items.removeblock.disabled=!0,i!=null&&(i.ExistComplementaryData||i.ExistFloatingData)||(items.complementary.disabled=!0)):(items.removeBudget.disabled=!0,t.isScheduleActive?t.selectedDay.AllowAssignment!="undefined"&&(!t.selectedDay.AllowAssignment||t.selectedDay.IsHoliday)&&(items.assignment.disabled=!0):(delete items.assignment,delete items.copyAssignments),t.selectionCopied||(items.pasteShift.disabled=!0,items.advPaste.disabled=!0,items.cancelSelection.disabled=!0),r=!1,typeof i!="undefined"&&i!=null&&i.AdvancedParameters.find(function(n){return n.Name.toLowerCase()=="starter"&&n.Value=="1"})!=null&&(r=!0),r?items.complementary.disabled=!1:i!=null&&(i.Type==Robotics.Client.Constants.ShiftType.NormalFloating||i.ExistComplementaryData||i.ExistFloatingData)||(items.complementary.disabled=!0),t.selectedDay.Feast&&(items.addFeast.disabled=!0),t.selectedDay.Feast||(items.removeFeast.disabled=!0),t.selectedDay.IsHoliday||(items.vacation.disabled=!0),u=parseInt($(n).attr("data-IDRow"),10),f=parseInt($(n).attr("data-IDColumn"),10),u>=t.selectedMinRow&&u<=t.selectedMaxRow&&f>=t.selectedMinColumn&&f<=t.selectedMaxColumn?(items.enter.disabled=!0,items.complementary.disabled=!0,t.isScheduleActive&&(items.assignment.disabled=!0),items.pasteShift.disabled=!0,items.advPaste.disabled=!0):t.selectionCopied?(items.removeShift.disabled=!0,items.enter.disabled=!0,items.complementary.disabled=!0,t.isScheduleActive&&(items.assignment.disabled=!0),items.vacation.disabled=!0,items.copyShift.disabled=!0,items.copyHolidays.disabled=!0,items.copyWorking.disabled=!0,items.block.disabled=!0,items.removeblock.disabled=!0,t.isScheduleActive&&(items.copyAssignments.disabled=!0),t.selectedMinRow!=t.selectedMaxRow&&(items.advPaste.disabled=!0)):(i==null&&(items.removeShift.disabled=!0),this.initialPeriodHasHolidays(null)||(items.copyHolidays.disabled=!0)))):items={enter:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_Details),disabled:!1,icon:"detail"}},items};Robotics.Client.Controls.roSchedulerCalendar.prototype.initialPeriodHasHolidays=function(){var n=this.oBaseControl,u=n.oCalendar,t=!1,i,r;if(n.selectedMinRow>-1&&n.selectedMinColumn>-1)for(i=0;i<=n.selectedMaxRow-n.selectedMinRow;i++){for(r=0;r<=n.selectedMaxColumn-n.selectedMinColumn;r++){var f=n.selectedMinRow+i,e=n.selectedMinColumn+r,o=u.CalendarData[f].PeriodData.DayData[e];if(o.IsHoliday){t=!0;break}}if(t)break}else t=n.selectedDay.IsHoliday;return t};Robotics.Client.Controls.roSchedulerCalendar.prototype.executeContextMenuAction=function(n,t){var i=this.oBaseControl,r=i.oCalendar;switch(n){case"enter":this.enterDetailAction(i.selectedEmployee.EmployeeData.IDGroup,i.selectedEmployee.EmployeeData.IDEmployee,moment(i.selectedDay.PlanDate).format("DD/MM/YYYY"));break;case"complementary":this.editShiftInfo(t);break;case"assignment":this.editAssignmentsInfo(t);break;case"vacation":this.removeHolidays(t);break;case"copyWorking":this.copySelection(t,!0,!1,!1);break;case"copyHolidays":this.copySelection(t,!1,!0,!1);break;case"copyShift":this.copySelection(t,!0,!0,!0);break;case"copyAssignments":this.copySelection(t,!1,!1,!0);break;case"pasteShift":this.pasteSelection(t);break;case"pasteTelecommute":this.pasteTelecommuteSelection(t);break;case"block":this.lockUnlockSelectedDays(t,!0);break;case"removeblock":this.lockUnlockSelectedDays(t,!1);break;case"cancelSelection":this.cancelCurrentMultipleSelect(t,!0);break;case"advPaste":this.advancedPastePrepare(t,!0);break;case"addFeast":this.assignRemoveFeastDays(t,!0);break;case"removeFeast":this.assignRemoveFeastDays(t,!1);break;case"removeShift":this.removeCurrentDayShift(t);break;case"removeBudget":this.removeCurrentDayAssignedBudget(t);break;case"setTelecommuteOffice":this.assignTelecommuteDays(t,!1,!1,!1);break;case"setTelecommuteHome":this.assignTelecommuteDays(t,!1,!1,!0);break;case"setTelecommuteOptional":this.assignTelecommuteDays(t,!1,!0,!1);break;case"setTelecommuteLabAgree":this.assignTelecommuteDays(t,!0,!1,!1)}};Robotics.Client.Controls.roSchedulerCalendar.prototype.removeCurrentDayShift=function(n){var t=this.oBaseControl,o=t.oCalendar,v=!1,f,e,l,a,h;for(t.isBatchMode()||(t.selectedMaxRow=t.selectedMinRow=parseInt($(n).attr("data-IDRow"),10),t.selectedMaxColumn=t.selectedMinColumn=parseInt($(n).attr("data-IDColumn"),10)),f=0;f<=t.selectedMaxRow-t.selectedMinRow;f++)for(e=0;e<=t.selectedMaxColumn-t.selectedMinColumn;e++){var u=t.selectedMinRow+f,s=t.selectedMinColumn+e,r=!0,i=null,c=o.CalendarData[u].EmployeeData.FreezingDate;i=t.viewRange!=Robotics.Client.Constants.ViewRange.Daily?o.CalendarData[u].PeriodData.DayData[s]:o.CalendarData[u].PeriodData.DayData[0];i!=null&&(i.CanBeModified?moment(i.PlanDate)<=moment(c)?(t.isBatchMode()||t.showErrorPopup("Error.Title","error","Calendar.Client.FreezeDate","","Error.OK","Error.OKDesc",t.defaultMessageAction),r=!1):i.Locked?(t.isBatchMode()||t.showErrorPopup("Error.Title","error","Calendar.Client.LockedDay","","Error.OK","Error.OKDesc",t.defaultMessageAction),r=!1):i.IDDailyBudgetPosition>0&&(t.isBatchMode()||t.showErrorPopup("Error.Title","error","Calendar.Client.BudgetAssigned","","Error.OK","Error.OKDesc",t.defaultMessageAction),r=!1):(t.isBatchMode()||t.showErrorPopup("Error.Title","error","Calendar.Client.NoPermission","","Error.OK","Error.OKDesc",t.defaultMessageAction),r=!1),r&&(v=!0,l=this.getAssignedShift(i),a=Object.clone(l,!0),i.AssigData=null,i.ShiftBase=null,i.MainShift=null,i.IsHoliday=!1,i.HasChanged=!0,t.viewRange!=Robotics.Client.Constants.ViewRange.Daily?(h=$("#"+t.ascxPrefix+"_calCell_"+u+"_"+s),h.empty(),this.buildCalendarCellContent(h,i,!1,c)):this.refreshDailySelectedData(!0),this.updateShiftTotalizerInfo(a,null,u,s,i,!1)));r&&(t.setHasChanges(!0),this.waitForUserToRefresh())}t.isBatchMode()||(t.selectedMaxRow=t.selectedMinRow=-1,t.selectedMaxColumn=t.selectedMinColumn=-1)};Robotics.Client.Controls.roSchedulerCalendar.prototype.removeCurrentDayAssignedBudget=function(n){var t=this.oBaseControl,o=t.oCalendar,u,f,s;for(t.isBatchMode()||(t.selectedMaxRow=t.selectedMinRow=parseInt($(n).attr("data-IDRow"),10),t.selectedMaxColumn=t.selectedMinColumn=parseInt($(n).attr("data-IDColumn"),10)),u=0;u<=t.selectedMaxRow-t.selectedMinRow;u++)for(f=0;f<=t.selectedMaxColumn-t.selectedMinColumn;f++){var e=t.selectedMinRow+u,h=t.selectedMinColumn+f,r=!0,i=null,c=o.CalendarData[e].EmployeeData.FreezingDate;i=t.viewRange!=Robotics.Client.Constants.ViewRange.Daily?o.CalendarData[e].PeriodData.DayData[h]:o.CalendarData[e].PeriodData.DayData[0];i!=null&&(i.CanBeModified?moment(i.PlanDate)<=moment(c)?(t.isBatchMode()||t.showErrorPopup("Error.Title","error","Calendar.Client.FreezeDate","","Error.OK","Error.OKDesc",t.defaultMessageAction),r=!1):i.Locked&&(t.isBatchMode()||t.showErrorPopup("Error.Title","error","Calendar.Client.LockedDay","","Error.OK","Error.OKDesc",t.defaultMessageAction),r=!1):(t.isBatchMode()||t.showErrorPopup("Error.Title","error","Calendar.Client.NoPermission","","Error.OK","Error.OKDesc",t.defaultMessageAction),r=!1),r&&(i.IDDailyBudgetPosition=0,i.HasChanged=!0,t.viewRange!=Robotics.Client.Constants.ViewRange.Daily?(s=$("#"+t.ascxPrefix+"_calCell_"+e+"_"+h),s.empty(),this.buildCalendarCellContent(s,i,!1,c)):this.refreshDailySelectedData(!0)));r&&t.setHasChanges(!0)}t.isBatchMode()||(t.selectedMaxRow=t.selectedMinRow=-1,t.selectedMaxColumn=t.selectedMinColumn=-1)};Robotics.Client.Controls.roSchedulerCalendar.prototype.advancedPastePrepare=function(){var n=this.oBaseControl,t=n.oCalendar;n.hasChanges==!1?(n.advCopyManager.prepareForm(n.selectedMaxColumn-n.selectedMinColumn+1,n.selectedDay.PlanDate,Robotics.Client.Constants.TypeView.Planification),n.advCopyDialog.dialog("open")):n.showChangesWarning(n.clientInstanceName+".advancedPastePrepare();")};Robotics.Client.Controls.roSchedulerCalendar.prototype.cancelCurrentMultipleSelect=function(n,t){var i=this.oBaseControl,f=i.oCalendar,u,r;if(!i.selectionCopied||t){for(i.selectionCopied=!1,u=$(".calendarOuterBodyCell.ui-selected,.calendarDailyBodyCell.ui-selected"),r=0;r<u.length;r++)$(u[r]).removeClass("ui-selected");i.selectedMinRow=-1;i.selectedMaxRow=-1;i.selectedMinColumn=-1;i.selectedMaxColumn=-1;i.copyWorkingShifts=!1;i.copyHolidaysShifts=!1;i.copyAssignmentsShifts=!1}};Robotics.Client.Controls.roSchedulerCalendar.prototype.cancelCurrentMultipleHeaderSelect=function(n,t){var i=this.oBaseControl,f=i.oCalendar,u,r;if(!i.selectionHeaderCopied||t){for(i.selectionHeaderCopied=!1,u=$(".CalendarDayFixedHeader.ui-selected"),r=0;r<u.length;r++)$(u[r]).removeClass("ui-selected");i.selectedMinHeaderColumn=-1;i.selectedMaxHeaderColumn=-1}};Robotics.Client.Controls.roSchedulerCalendar.prototype.lockUnlockSelectedDays=function(n,t){var i=this.oBaseControl,o=i.oCalendar,s,h,c,r,e;for(i.isBatchMode()||(i.selectedMaxRow=i.selectedMinRow=parseInt($(n).attr("data-IDRow"),10),i.selectedMaxColumn=i.selectedMinColumn=parseInt($(n).attr("data-IDColumn"),10)),s=0;s<=i.selectedMaxRow-i.selectedMinRow;s++)for(h=0;h<=i.selectedMaxColumn-i.selectedMinColumn;h++){var f=i.selectedMinRow+s,l=i.selectedMinColumn+h,u=!0;i.viewRange!=Robotics.Client.Constants.ViewRange.Daily?(r=o.CalendarData[f].PeriodData.DayData[l],e=o.CalendarData[f].EmployeeData.FreezingDate,r.CanBeModified?moment(r.PlanDate)<=moment(e)&&(i.isBatchMode()||i.showErrorPopup("Error.Title","error","Calendar.Client.FreezeDate","","Error.OK","Error.OKDesc",i.defaultMessageAction),u=!1):(i.isBatchMode()||i.showErrorPopup("Error.Title","error","Calendar.Client.NoPermission","","Error.OK","Error.OKDesc",i.defaultMessageAction),u=!1),u&&(r.Locked=t,r.HasChanged=!0,c=$("#"+i.ascxPrefix+"_calCell_"+f+"_"+l),c.empty(),this.buildCalendarCellContent(c,r,!1,e))):(r=o.CalendarData[f].PeriodData.DayData[0],e=o.CalendarData[f].EmployeeData.FreezingDate,r.CanBeModified?moment(r.PlanDate)<=moment(e)&&(i.isBatchMode()||i.showErrorPopup("Error.Title","error","Calendar.Client.FreezeDate","","Error.OK","Error.OKDesc",i.defaultMessageAction),u=!1):(i.isBatchMode()||i.showErrorPopup("Error.Title","error","Calendar.Client.NoPermission","","Error.OK","Error.OKDesc",i.defaultMessageAction),u=!1),u&&(r.Locked=t,r.HasChanged=!0,this.refreshDailySelectedData(!0)));u&&i.setHasChanges(!0)}i.isBatchMode()||(i.selectedMaxRow=i.selectedMinRow=-1,i.selectedMaxColumn=i.selectedMinColumn=-1)};Robotics.Client.Controls.roSchedulerCalendar.prototype.assignTelecommuteDays=function(n,t,i,r){var p=this,f=this.oBaseControl,c=f.oCalendar,l,a,b,u,h,v,y,s;for(this.copyInProgress=!0,f.isBatchMode()||(f.selectedMaxRow=f.selectedMinRow=parseInt($(n).attr("data-IDRow"),10),f.selectedMaxColumn=f.selectedMinColumn=parseInt($(n).attr("data-IDColumn"),10)),l=0;l<=f.selectedMaxRow-f.selectedMinRow;l++)for(a=0;a<=f.selectedMaxColumn-f.selectedMinColumn;a++){var o=f.selectedMinRow+l,w=f.selectedMinColumn+a,e=!0;f.viewRange!=Robotics.Client.Constants.ViewRange.Daily?(u=c.CalendarData[o].PeriodData.DayData[w],h=c.CalendarData[o].EmployeeData.FreezingDate,u.CanBeModified?moment(u.PlanDate)<=moment(h)?(f.isBatchMode()||f.showErrorPopup("Error.Title","error","Calendar.Client.FreezeDate","","Error.OK","Error.OKDesc",f.defaultMessageAction),e=!1):u.Locked&&(f.isBatchMode()||f.showErrorPopup("Error.Title","error","Calendar.Client.LockedDay","","Error.OK","Error.OKDesc",f.defaultMessageAction),e=!1):(f.isBatchMode()||f.showErrorPopup("Error.Title","error","Calendar.Client.NoPermission","","Error.OK","Error.OKDesc",f.defaultMessageAction),e=!1),e&&(v=u.TelecommutingExpected,t||i?i?(u.TelecommuteForced=!0,u.TelecommutingExpected=!1,u.TelecommutingOptional=!0):typeof u.PresenceMandatoryDays!="undefined"?(u.TelecommutingExpected=u.PresenceMandatoryDays.indexOf(u.PlanDate.getDay()+"")>=0?!1:u.TelecommutingOptionalDays.indexOf(u.PlanDate.getDay()+"")>=0?!1:u.TelecommutingMandatoryDays.indexOf(u.PlanDate.getDay()+"")>=0?!0:!1,u.TelecommutingOptional=!1,u.TelecommuteForced=!1):(u.TelecommutingExpected=!1,u.TelecommutingOptional=!1,u.TelecommuteForced=!1):(u.TelecommutingExpected=r,u.TelecommuteForced=!0,u.TelecommutingOptional=!1),u.HasChanged=!0,b=$("#"+f.ascxPrefix+"_calCell_"+o+"_"+w),b.empty(),this.buildCalendarCellContent(b,u,!1,h),y=this.getAssignedShift(u),s=Object.clone(y,!0),p.updateShiftTotalizerInfo(s,s,o,w,u,v!=u.TelecommutingExpected))):(u=c.CalendarData[o].PeriodData.DayData[0],h=c.CalendarData[o].EmployeeData.FreezingDate,u.CanBeModified?moment(u.PlanDate)<=moment(h)?(f.isBatchMode()||f.showErrorPopup("Error.Title","error","Calendar.Client.FreezeDate","","Error.OK","Error.OKDesc",f.defaultMessageAction),e=!1):u.Locked&&(f.isBatchMode()||f.showErrorPopup("Error.Title","error","Calendar.Client.LockedDay","","Error.OK","Error.OKDesc",f.defaultMessageAction),e=!1):(f.isBatchMode()||f.showErrorPopup("Error.Title","error","Calendar.Client.NoPermission","","Error.OK","Error.OKDesc",f.defaultMessageAction),e=!1),e&&(v=u.TelecommutingExpected,t||i?i?(u.TelecommuteForced=!0,u.TelecommutingExpected=!1,u.TelecommutingOptional=!0):typeof u.PresenceMandatoryDays!="undefined"?(u.TelecommutingExpected=u.PresenceMandatoryDays.indexOf(u.PlanDate.getDay()+"")>=0?!1:u.TelecommutingOptionalDays.indexOf(u.PlanDate.getDay()+"")>=0?!1:u.TelecommutingMandatoryDays.indexOf(u.PlanDate.getDay()+"")>=0?!0:!1,u.TelecommutingOptional=!1,u.TelecommuteForced=!1):(u.TelecommutingExpected=!1,u.TelecommutingOptional=!1,u.TelecommuteForced=!1):(u.TelecommutingExpected=r,u.TelecommuteForced=!0,u.TelecommutingOptional=!1),u.HasChanged=!0,this.refreshDailySelectedData(!0),y=this.getAssignedShift(u),s=Object.clone(y,!0),p.updateShiftTotalizerInfo(s,s,o,0,u,v!=u.TelecommutingExpected)));e&&(f.setHasChanges(!0),this.waitForUserToRefresh())}f.loadIndictments&&p.checkCalendarIndictments();this.copyInProgress=!1;f.isBatchMode()||(f.selectedMaxRow=f.selectedMinRow=-1,f.selectedMaxColumn=f.selectedMinColumn=-1)};Robotics.Client.Controls.roSchedulerCalendar.prototype.assignRemoveFeastDays=function(n,t){var a=this,i=this.oBaseControl,o=i.oCalendar,s,h,c,r,e;for(this.copyInProgress=!0,i.isBatchMode()||(i.selectedMaxRow=i.selectedMinRow=parseInt($(n).attr("data-IDRow"),10),i.selectedMaxColumn=i.selectedMinColumn=parseInt($(n).attr("data-IDColumn"),10)),s=0;s<=i.selectedMaxRow-i.selectedMinRow;s++)for(h=0;h<=i.selectedMaxColumn-i.selectedMinColumn;h++){var f=i.selectedMinRow+s,l=i.selectedMinColumn+h,u=!0;i.viewRange!=Robotics.Client.Constants.ViewRange.Daily?(r=o.CalendarData[f].PeriodData.DayData[l],e=o.CalendarData[f].EmployeeData.FreezingDate,r.CanBeModified?moment(r.PlanDate)<=moment(e)?(i.isBatchMode()||i.showErrorPopup("Error.Title","error","Calendar.Client.FreezeDate","","Error.OK","Error.OKDesc",i.defaultMessageAction),u=!1):r.Locked&&(i.isBatchMode()||i.showErrorPopup("Error.Title","error","Calendar.Client.LockedDay","","Error.OK","Error.OKDesc",i.defaultMessageAction),u=!1):(i.isBatchMode()||i.showErrorPopup("Error.Title","error","Calendar.Client.NoPermission","","Error.OK","Error.OKDesc",i.defaultMessageAction),u=!1),u&&(r.Feast=t,r.HasChanged=!0,c=$("#"+i.ascxPrefix+"_calCell_"+f+"_"+l),c.empty(),this.buildCalendarCellContent(c,r,!1,e))):(r=o.CalendarData[f].PeriodData.DayData[0],e=o.CalendarData[f].EmployeeData.FreezingDate,r.CanBeModified?moment(r.PlanDate)<=moment(e)?(i.isBatchMode()||i.showErrorPopup("Error.Title","error","Calendar.Client.FreezeDate","","Error.OK","Error.OKDesc",i.defaultMessageAction),u=!1):r.Locked&&(i.isBatchMode()||i.showErrorPopup("Error.Title","error","Calendar.Client.LockedDay","","Error.OK","Error.OKDesc",i.defaultMessageAction),u=!1):(i.isBatchMode()||i.showErrorPopup("Error.Title","error","Calendar.Client.NoPermission","","Error.OK","Error.OKDesc",i.defaultMessageAction),u=!1),u&&(r.Feast=t,r.HasChanged=!0,this.refreshDailySelectedData(!0)));u&&i.setHasChanges(!0)}i.loadIndictments&&a.checkCalendarIndictments();this.copyInProgress=!1;i.isBatchMode()||(i.selectedMaxRow=i.selectedMinRow=-1,i.selectedMaxColumn=i.selectedMinColumn=-1)};Robotics.Client.Controls.roSchedulerCalendar.prototype.editAssignmentsInfo=function(n){var t=this.oBaseControl,u=t.oCalendar,f=parseInt($(n).attr("data-IDRow"),10),e=parseInt($(n).attr("data-IDColumn"),10),i=this.getAssignedShift(t.selectedDay),r;i!=null&&t.selectedDay.AllowAssignment==!0&&(t.assignmentShift=i,typeof t.shiftsExtendedDataCache[i.ID]=="undefined"?(t.showAssignmentsDialog=!0,r={},r.idShift=i.ID,r.StampParam=(new Date).getMilliseconds(),t.performAction(r,Robotics.Client.Constants.Actions.ShiftLayerDefinitionEdit)):this.editAssignmentsInfoFinally(t.shiftsExtendedDataCache[i.ID]))};Robotics.Client.Controls.roSchedulerCalendar.prototype.editAssignmentsInfoFinally=function(n){var t=this.oBaseControl,r=t.oCalendar,i;n!=null&&(t.shiftsExtendedDataCache[t.assignmentShift.ID]=n);t.assignmentsManager.prepareAssignmentsDialog(n,t.selectedEmployee.EmployeeData.Assignments,-1);t.assignmentsManager.selectcurrentAssignment(t.selectedDay.AssigData);t.assignmentsDialog.dialog("open");i=this;setTimeout(function(){i.assignmentsManager.focusDialog()},100)};Robotics.Client.Controls.roSchedulerCalendar.prototype.editShiftInfo=function(n){var t=this.oBaseControl,f=t.oCalendar,e=parseInt($(n).attr("data-IDRow"),10),o=parseInt($(n).attr("data-IDColumn"),10),i=this.getAssignedShift(t.selectedDay),u=!1,r;i.AdvancedParameters.find(function(n){return n.Name.toLowerCase()=="starter"&&n.Value=="1"})!=null&&(u=!0);u?typeof t.shiftsExtendedDataCache[i.ID]=="undefined"?(t.showStarterDialog=!0,r={},r.idShift=i.ID,r.StampParam=(new Date).getMilliseconds(),t.performAction(r,Robotics.Client.Constants.Actions.ShiftLayerDefinitionEdit)):this.editStarterInfoFinally(t.shiftsExtendedDataCache[i.ID],i):this.editComplementaryInfo(n)};Robotics.Client.Controls.roSchedulerCalendar.prototype.editStarterInfoFinally=function(n,t){var i=this.oBaseControl,u=i.oCalendar,r=null;i.showComplementaryAssignDialog=!1;r=typeof t!="undefined"?t:this.getAssignedShift(i.selectedDay);i.starterManager.prepareStarterDialog(n,-1,r);i.starterDialog.dialog("open")};Robotics.Client.Controls.roSchedulerCalendar.prototype.editComplementaryInfo=function(n){var i=this.oBaseControl,u=i.oCalendar,f=parseInt($(n).attr("data-IDRow"),10),e=parseInt($(n).attr("data-IDColumn"),10),t=this.getAssignedShift(i.selectedDay),r;t!=null&&(t.Type==Robotics.Client.Constants.ShiftType.NormalFloating||t.ExistComplementaryData||t.ExistFloatingData)&&(typeof i.shiftsExtendedDataCache[t.ID]=="undefined"?(i.showComplementaryAssignDialog=!0,r={},r.idShift=t.ID,r.StampParam=(new Date).getMilliseconds(),i.performAction(r,Robotics.Client.Constants.Actions.ShiftLayerDefinitionEdit)):this.editComplementaryInfoFinally(i.shiftsExtendedDataCache[t.ID],t))};Robotics.Client.Controls.roSchedulerCalendar.prototype.editComplementaryInfoFinally=function(n,t){var i=this.oBaseControl,u=i.oCalendar,r=null;i.showComplementaryAssignDialog=!1;r=typeof t!="undefined"?t:this.getAssignedShift(i.selectedDay);i.complementaryManager.prepareComplementaryDialog(n,-1,r);i.complementaryDialog.dialog("open")};Robotics.Client.Controls.roSchedulerCalendar.prototype.pasteSelection=function(container){var oCalendar=this.oBaseControl,oCalData=oCalendar.oCalendar,clickedRow=parseInt($(container).attr("data-IDRow"),10),clickedColumn=parseInt($(container).attr("data-IDColumn"),10),bHasBloquedDays=this.endPeriodHasBloquedDays(container),bHasEndHolidays=this.endPeriodHasHolidays(container);bHasBloquedDays||bHasEndHolidays?(bHasBloquedDays?$("#"+oCalendar.ascxPrefix+"_dlgCopy_advCopyKeepBloqued").css("display",""):$("#"+oCalendar.ascxPrefix+"_dlgCopy_advCopyKeepBloqued").css("display","none"),bHasEndHolidays?$("#"+oCalendar.ascxPrefix+"_dlgCopy_advCopyKeepHolidays").css("display",""):$("#"+oCalendar.ascxPrefix+"_dlgCopy_advCopyKeepHolidays").css("display","none"),bHasBloquedDays||bHasEndHolidays?$("#"+oCalendar.ascxPrefix+"_dlgCopy_advCopyKeepObjects").css("display",""):$("#"+oCalendar.ascxPrefix+"_dlgCopy_advCopyKeepObjects").css("display","none"),eval(oCalendar.ascxPrefix+"_dlgCopy_ckSPKeepBloquedDaysClient").SetChecked(!0),eval(oCalendar.ascxPrefix+"_dlgCopy_ckSPKeepHolidaysClient").SetChecked(!0),oCalendar.sourceDialogRow=clickedRow,oCalendar.sourceDialogColumn=clickedColumn,oCalendar.copyDialog.dialog("open")):this.pasteSelectionEnd(clickedRow,clickedColumn,oCalendar.copyWorkingShifts,oCalendar.copyHolidaysShifts,oCalendar.copyAssignmentsShifts,!0,!0)};Robotics.Client.Controls.roSchedulerCalendar.prototype.pasteTelecommuteSelection=function(container){var oCalendar=this.oBaseControl,oCalData=oCalendar.oCalendar,clickedRow=parseInt($(container).attr("data-IDRow"),10),clickedColumn=parseInt($(container).attr("data-IDColumn"),10),bHasBloquedDays=this.endPeriodHasBloquedDays(container),bHasEndHolidays=this.endPeriodHasHolidays(container);bHasBloquedDays||bHasEndHolidays?(bHasBloquedDays?$("#"+oCalendar.ascxPrefix+"_dlgCopy_advCopyKeepBloqued").css("display",""):$("#"+oCalendar.ascxPrefix+"_dlgCopy_advCopyKeepBloqued").css("display","none"),bHasEndHolidays?$("#"+oCalendar.ascxPrefix+"_dlgCopy_advCopyKeepHolidays").css("display",""):$("#"+oCalendar.ascxPrefix+"_dlgCopy_advCopyKeepHolidays").css("display","none"),bHasBloquedDays||bHasEndHolidays?$("#"+oCalendar.ascxPrefix+"_dlgCopy_advCopyKeepObjects").css("display",""):$("#"+oCalendar.ascxPrefix+"_dlgCopy_advCopyKeepObjects").css("display","none"),eval(oCalendar.ascxPrefix+"_dlgCopy_ckSPKeepBloquedDaysClient").SetChecked(!0),eval(oCalendar.ascxPrefix+"_dlgCopy_ckSPKeepHolidaysClient").SetChecked(!0),oCalendar.sourceDialogRow=clickedRow,oCalendar.sourceDialogColumn=clickedColumn,oCalendar.copyDialog.dialog("open")):this.pasteTelecommuteSelectionEnd(clickedRow,clickedColumn,oCalendar.copyWorkingShifts,oCalendar.copyHolidaysShifts,oCalendar.copyAssignmentsShifts,!0,!0)};Robotics.Client.Controls.roSchedulerCalendar.prototype.endPeriodHasBloquedDays=function(n){for(var i,r,o,s,t=this.oBaseControl,u=t.oCalendar,f=!1,h=parseInt($(n).attr("data-IDRow"),10),c=parseInt($(n).attr("data-IDColumn"),10),e=0;e<=t.selectedMaxRow-t.selectedMinRow;e++){for(i=0;i<=t.selectedMaxColumn-t.selectedMinColumn;i++)if(r=h+e,o=c+i,r<u.CalendarData.length&&o<u.CalendarData[r].PeriodData.DayData.length&&(s=u.CalendarData[r].PeriodData.DayData[o],s.Locked)){f=!0;break}if(f)break}return f};Robotics.Client.Controls.roSchedulerCalendar.prototype.endPeriodHasHolidays=function(n){for(var i,r,o,s,t=this.oBaseControl,u=t.oCalendar,f=!1,h=parseInt($(n).attr("data-IDRow"),10),c=parseInt($(n).attr("data-IDColumn"),10),e=0;e<=t.selectedMaxRow-t.selectedMinRow;e++){for(i=0;i<=t.selectedMaxColumn-t.selectedMinColumn;i++)if(r=h+e,o=c+i,r<u.CalendarData.length&&o<u.CalendarData[r].PeriodData.DayData.length&&(s=u.CalendarData[r].PeriodData.DayData[o],s.IsHoliday)){f=!0;break}if(f)break}return f};Robotics.Client.Controls.roSchedulerCalendar.prototype.pasteSelectionEnd=function(n,t,i,r,u,f,e){var rt=this,c=this.oBaseControl,a=c.oCalendar,w,b,o,s,y,p,h;for(this.copyInProgress=!0,w=0;w<=c.selectedMaxRow-c.selectedMinRow;w++)for(b=0;b<=c.selectedMaxColumn-c.selectedMinColumn;b++){var nt=c.selectedMinRow+w,ut=c.selectedMinColumn+b,v=n+w,g=t+b,l=null;if(l=c.viewRange!=Robotics.Client.Constants.ViewRange.Daily?a.CalendarData[nt].PeriodData.DayData[ut]:a.CalendarData[nt].PeriodData.DayData[0],o=null,s=null,o=l.IsHoliday==!0?l.ShiftBase:this.getAssignedShift(l),l.IsHoliday?(o=l.ShiftBase,s=this.getAssignedShift(l)):(o=this.getAssignedShift(l),s=null),y=!0,p=null,c.viewRange!=Robotics.Client.Constants.ViewRange.Daily?v<a.CalendarData.length&&g<a.CalendarData[v].PeriodData.DayData.length?(y=!0,p=a.CalendarData[v].PeriodData.DayData[g]):y=!1:v<a.CalendarData.length?(y=!0,p=a.CalendarData[v].PeriodData.DayData[0]):y=!1,y){var k=null,d=null,tt=null,it=!1;if(i&&o!=null)for(k={ID:o.ID,ShortName:o.ShortName,PlannedHours:o.PlannedHours,Color:o.Color,Name:o.Name,Type:o.Type,StartHour:moment(o.StartHour).clone().toDate(),EndHour:moment(o.EndHour).clone().toDate(),AdvancedParameters:Object.clone(o.AdvancedParameters,!0),BreakHours:o.BreakHours,ExistComplementaryData:o.ExistComplementaryData,ExistFloatingData:o.ExistFloatingData,ShiftLayers:o.ShiftLayers,ShiftLayersDefinition:[]},h=0;h<k.ShiftLayers;h++)k.ShiftLayersDefinition.push({LayerStartTime:moment(o.ShiftLayersDefinition[h].LayerStartTime).clone().toDate(),ExistLayerStartTime:o.ShiftLayersDefinition[h].ExistLayerStartTime,LayerOrdinaryHours:o.ShiftLayersDefinition[h].LayerOrdinaryHours,LayerDuration:o.ShiftLayersDefinition[h].LayerDuration,ExistLayerDuration:o.ShiftLayersDefinition[h].ExistLayerDuration,LayerID:o.ShiftLayersDefinition[h].LayerID,LayerComplementaryHours:o.ShiftLayersDefinition[h].LayerComplementaryHours});if(r&&s!=null)for(d={ID:s.ID,ShortName:s.ShortName,PlannedHours:s.PlannedHours,Color:s.Color,Name:s.Name,Type:s.Type,StartHour:moment(s.StartHour).clone().toDate(),EndHour:moment(s.EndHour).clone().toDate(),AdvancedParameters:Object.clone(s.AdvancedParameters,!0),BreakHours:s.BreakHours,ExistComplementaryData:s.ExistComplementaryData,ExistFloatingData:s.ExistFloatingData,ShiftLayers:s.ShiftLayers,ShiftLayersDefinition:[]},h=0;h<d.ShiftLayers;h++)d.ShiftLayersDefinition.push({LayerStartTime:moment(s.ShiftLayersDefinition[h].LayerStartTime).clone().toDate(),ExistLayerStartTime:s.ShiftLayersDefinition[h].ExistLayerStartTime,LayerOrdinaryHours:s.ShiftLayersDefinition[h].LayerOrdinaryHours,LayerDuration:s.ShiftLayersDefinition[h].LayerDuration,ExistLayerDuration:s.ShiftLayersDefinition[h].ExistLayerDuration,LayerID:s.ShiftLayersDefinition[h].LayerID,LayerComplementaryHours:s.ShiftLayersDefinition[h].LayerComplementaryHours});it=i?l.AllowAssignment:p.AllowAssignment;tt=u?l.AssigData:p.AssigData;this.assignShiftToDay($("#"+c.ascxPrefix+"_calCell_"+v+"_"+g),p,k,d,tt,it,f,e,a.CalendarData[v].EmployeeData)}}this.copyInProgress=!1;c.loadIndictments&&rt.checkCalendarIndictments();this.waitForUserToRefresh()};Robotics.Client.Controls.roSchedulerCalendar.prototype.pasteTelecommuteSelectionEnd=function(n,t){var y=this,r=this.oBaseControl,f=r.oCalendar,s,h,o,i,p,a,w,v;for(this.copyInProgress=!0,s=0;s<=r.selectedMaxRow-r.selectedMinRow;s++)for(h=0;h<=r.selectedMaxColumn-r.selectedMinColumn;h++){var l=r.selectedMinRow+s,b=r.selectedMinColumn+h,e=n+s,c=t+h,u=null;u=r.viewRange!=Robotics.Client.Constants.ViewRange.Daily?f.CalendarData[l].PeriodData.DayData[b]:f.CalendarData[l].PeriodData.DayData[0];o=!0;i=null;r.viewRange!=Robotics.Client.Constants.ViewRange.Daily?e<f.CalendarData.length&&c<f.CalendarData[e].PeriodData.DayData.length?(o=!0,i=f.CalendarData[e].PeriodData.DayData[c]):o=!1:e<f.CalendarData.length?(o=!0,i=f.CalendarData[e].PeriodData.DayData[0]):o=!1;o&&u!=null&&i.CanTelecommute&&(p=f.CalendarData[l].EmployeeData.FreezingDate,u.TelecommuteForced||u.TelecommutingOptional?(i.TelecommutingExpected=u.TelecommutingExpected,i.TelecommuteForced=!0,i.TelecommutingOptional=u.TelecommutingOptional):typeof u.PresenceMandatoryDays!="undefined"?(i.TelecommutingExpected=u.PresenceMandatoryDays.indexOf(i.PlanDate.getDay()+"")>=0?!1:u.TelecommutingOptionalDays.indexOf(i.PlanDate.getDay()+"")>=0?!1:u.TelecommutingMandatoryDays.indexOf(i.PlanDate.getDay()+"")>=0?!0:!1,i.TelecommutingOptional=!1,i.TelecommuteForced=!0):(i.TelecommutingExpected=!1,i.TelecommutingOptional=!1,i.TelecommuteForced=!1),i.HasChanged=!0,a=$("#"+r.ascxPrefix+"_calCell_"+e+"_"+c),a.empty(),this.buildCalendarCellContent(a,i,!1,p),w=this.getAssignedShift(i),v=Object.clone(w,!0),y.updateShiftTotalizerInfo(v,v,e,c,i,!0));o&&(r.setHasChanges(!0),this.waitForUserToRefresh())}this.copyInProgress=!1;r.loadIndictments&&y.checkCalendarIndictments();this.waitForUserToRefresh()};Robotics.Client.Controls.roSchedulerCalendar.prototype.copyHeaderSelection=function(n){var t=this.oBaseControl,r=t.oCalendar,i;(t.selectedMinHeaderColumn==-1||t.selectedMaxHeaderColumn==-1)&&n!=null&&(i=parseInt($(n).attr("data-IDColumn"),10),t.selectedMinHeaderColumn=t.selectedMaxHeaderColumn=i,$(n).addClass("ui-selected"));t.selectionHeaderCopied=!0};Robotics.Client.Controls.roSchedulerCalendar.prototype.copySelection=function(n,t,i,r){var u=this.oBaseControl,o=u.oCalendar,f,e;(u.selectedMinRow==-1||u.selectedMaxRow==-1||u.selectedMinColumn==-1||u.selectedMaxColumn==-1)&&n!=null&&(f=parseInt($(n).attr("data-IDRow"),10),e=parseInt($(n).attr("data-IDColumn"),10),u.selectedMinRow=u.selectedMaxRow=f,u.selectedMinColumn=u.selectedMaxColumn=e,$(n).addClass("ui-selected"));u.copyWorkingShifts=t;u.copyHolidaysShifts=i;u.copyAssignmentsShifts=r;u.selectionCopied=!0};Robotics.Client.Controls.roSchedulerCalendar.prototype.enterDetailAction=function(n,t,i){var u=this.oBaseControl,o=u.oCalendar,r,f,e;u.hasChanges==!1&&(u.isShowingDialog=!0,r=this.getSelectedIDEmployees(),r.length>200&&(r=t),f="Scheduler/MovesNew.aspx?&EmpFilter="+r+"&EmployeeID="+t+"&Date="+i+"&CalendarV2=1",e="",parent.ShowExternalForm2(f,1400,620,e,"",!1,!1,!1))};Robotics.Client.Controls.roSchedulerCalendar.prototype.removeHolidays=function(n){var l=this,t=this.oBaseControl,h=t.oCalendar,e,o,u,r;if(t.isBatchMode()){for(this.copyInProgress=!0,e=0;e<=t.selectedMaxRow-t.selectedMinRow;e++)for(o=0;o<=t.selectedMaxColumn-t.selectedMinColumn;o++){var f=t.selectedMinRow+e,c=t.selectedMinColumn+o,i=null,s=null;if(t.viewRange!=Robotics.Client.Constants.ViewRange.Daily?(i=h.CalendarData[f].PeriodData.DayData[c],s=$("#"+t.ascxPrefix+"_calCell_"+f+"_"+c)):(i=h.CalendarData[f].PeriodData.DayData[0],s=$("#"+t.ascxPrefix+"_calDailyCell_"+f+"_"+c)),i!=null&&s!=null&&i.ShiftBase!=null){for(u={ID:i.ShiftBase.ID,ShortName:i.ShiftBase.ShortName,PlannedHours:i.ShiftBase.PlannedHours,Color:i.ShiftBase.Color,Name:i.ShiftBase.Name,Type:i.ShiftBase.Type,StartHour:moment(i.ShiftBase.StartHour).clone().toDate(),EndHour:moment(i.ShiftBase.EndHour).clone().toDate(),AdvancedParameters:Object.clone(i.ShiftBase.AdvancedParameters,!0),BreakHours:i.ShiftBase.BreakHours,ExistComplementaryData:i.ShiftBase.ExistComplementaryData,ExistFloatingData:i.ShiftBase.ExistFloatingData,ShiftLayers:i.ShiftBase.ShiftLayers,ShiftLayersDefinition:[]},r=0;r<u.ShiftLayers;r++)u.ShiftLayersDefinition.push({LayerStartTime:moment(i.ShiftBase.ShiftLayersDefinition[r].LayerStartTime).clone().toDate(),ExistLayerStartTime:i.ShiftBase.ShiftLayersDefinition[r].ExistLayerStartTime,LayerOrdinaryHours:i.ShiftBase.ShiftLayersDefinition[r].LayerOrdinaryHours,LayerDuration:i.ShiftBase.ShiftLayersDefinition[r].LayerDuration,ExistLayerDuration:i.ShiftBase.ShiftLayersDefinition[r].ExistLayerDuration,LayerID:i.ShiftBase.ShiftLayersDefinition[r].LayerID,LayerComplementaryHours:i.ShiftBase.ShiftLayersDefinition[r].LayerComplementaryHours});(u.Type==Robotics.Client.Constants.ShiftType.Normal||u.Type==Robotics.Client.Constants.ShiftType.NormalFloating)&&this.assignShiftToDay(s,i,u,null,i.AssigData,i.AllowAssignment,!0,!1,h.CalendarData[f].EmployeeData)}}t.loadIndictments&&l.checkCalendarIndictments();this.copyInProgress=!1}else if(t.selectedDay.ShiftBase!=null){for(u={ID:t.selectedDay.ShiftBase.ID,ShortName:t.selectedDay.ShiftBase.ShortName,PlannedHours:t.selectedDay.ShiftBase.PlannedHours,Color:t.selectedDay.ShiftBase.Color,Name:t.selectedDay.ShiftBase.Name,Type:t.selectedDay.ShiftBase.Type,StartHour:moment(t.selectedDay.ShiftBase.StartHour).clone().toDate(),EndHour:moment(t.selectedDay.ShiftBase.EndHour).clone().toDate(),AdvancedParameters:Object.clone(t.selectedDay.ShiftBase.AdvancedParameters,!0),BreakHours:t.selectedDay.ShiftBase.BreakHours,ExistComplementaryData:t.selectedDay.ShiftBase.ExistComplementaryData,ExistFloatingData:t.selectedDay.ShiftBase.ExistFloatingData,ShiftLayers:t.selectedDay.ShiftBase.ShiftLayers,ShiftLayersDefinition:[]},r=0;r<u.ShiftLayers;r++)u.ShiftLayersDefinition.push({LayerStartTime:moment(t.selectedDay.ShiftBase.ShiftLayersDefinition[r].LayerStartTime).clone().toDate(),ExistLayerStartTime:t.selectedDay.ShiftBase.ShiftLayersDefinition[r].ExistLayerStartTime,LayerOrdinaryHours:t.selectedDay.ShiftBase.ShiftLayersDefinition[r].LayerOrdinaryHours,LayerDuration:t.selectedDay.ShiftBase.ShiftLayersDefinition[r].LayerDuration,ExistLayerDuration:t.selectedDay.ShiftBase.ShiftLayersDefinition[r].ExistLayerDuration,LayerID:t.selectedDay.ShiftBase.ShiftLayersDefinition[r].LayerID,LayerComplementaryHours:t.selectedDay.ShiftBase.ShiftLayersDefinition[r].LayerComplementaryHours});(u.Type==Robotics.Client.Constants.ShiftType.Normal||u.Type==Robotics.Client.Constants.ShiftType.NormalFloating)&&this.assignShiftToDay($(n),t.selectedDay,u,null,t.selectedDay.AssigData,t.selectedDay.AllowAssignment,!0,!1,t.selectedEmployee.EmployeeData)}this.waitForUserToRefresh()};Robotics.Client.Controls.roSchedulerCalendar.prototype.waitForUserToRefresh=function(){$("#columnWaitingIcon").removeClass("loadingMove");$("#rowWaitingIcon").removeClass("loadingMove");$("#tabColumnWaiting").show();$("#tabRowWaiting").show();$("#tabResumeWaiting").show()};Robotics.Client.Controls.roSchedulerCalendar.prototype.refreshShiftTotalizerInfo=function(){var n=this.oBaseControl,t=n.oCalendar;n.typeView==Robotics.Client.Constants.TypeView.Planification&&this.loadRelatedTables()};Robotics.Client.Controls.roSchedulerCalendar.prototype.getFirstObjectSelected=function(){var n=this.oBaseControl,i=n.oCalendar,t=null;return n.selectedMinRow!=-1&&n.selectedMinColumn!=-1&&(t=i.CalendarData[n.selectedMinRow].EmployeeData),t};Robotics.Client.Controls.roSchedulerCalendar.prototype.getFirstSelectedDay=function(){var n=this.oBaseControl,t=n.oCalendar,i=null;return n.selectedMinRow!=-1&&n.selectedMinColumn!=-1&&(i=n.viewRange!=Robotics.Client.Constants.ViewRange.Daily?t.CalendarData[n.selectedMinRow].PeriodData.DayData[n.selectedMinColumn]:t.CalendarData[n.selectedMinRow].PeriodData.DayData[0]),i};Robotics.Client.Controls.roSchedulerCalendar.prototype.buildHeaderContextMenu=function(n){var t=this.oBaseControl,r=t.oCalendar,u=n[0].innerText,i=parseInt($(n).attr("data-IDColumn"),10);return items={sort:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_Sort),disabled:!1,icon:"sort"}},i>=t.selectedMinHeaderColumn&&i<=t.selectedMaxHeaderColumn||t.selectionHeaderCopied&&(items.sort.disabled=!0),items};Robotics.Client.Controls.roSchedulerCalendar.prototype.executeHeaderContextMenuAction=function(n,t){var i=this.oBaseControl,r=i.oCalendar;switch(n){case"setCoverage":this.setDayCoverage(t);break;case"planifyCoverage":this.planifyDayCoverage(t);break;case"copyAssignments":this.copyHeaderSelection(t);break;case"pasteAssignment":this.pasteHeaderSelection(t);break;case"sort":i.sortColumn=parseInt($(t).attr("data-IDColumn"),10);i.calendarSortDialog.dialog("open");break;case"cancelSelection":this.cancelCurrentMultipleHeaderSelect(t,!0)}};Robotics.Client.Controls.roSchedulerCalendar.prototype.setDayCoverage=function(n){var t=this.oBaseControl,r=t.oCalendar,u=parseInt($(n).attr("data-IDColumn"),10),i=r.CalendarHeader.PeriodCoverageData[t.viewRange==Robotics.Client.Constants.ViewRange.Daily?0:u];ShowDailyCoverage(i.IDGroup,moment(i.CoverageDate).format("DD/MM/YYYY"))};Robotics.Client.Controls.roSchedulerCalendar.prototype.planifyDayCoverage=function(n){var t=this.oBaseControl,r=t.oCalendar,u=parseInt($(n).attr("data-IDColumn"),10),i=r.CalendarHeader.PeriodCoverageData[t.viewRange==Robotics.Client.Constants.ViewRange.Daily?0:u];ShowDailyCoveragePlanned(i.IDGroup,moment(i.CoverageDate).format("DD/MM/YYYY"))};Robotics.Client.Controls.roSchedulerCalendar.prototype.pasteHeaderSelection=function(n,t,i){var r=this.oBaseControl,f=r.oCalendar,e,o,v,s,u;if(typeof f.CalendarHeader.PeriodCoverageData!="undefined"&&f.CalendarHeader.PeriodCoverageData!=null&&f.CalendarHeader.PeriodCoverageData.length>0&&(e=null,o=null,n!=null?(v=parseInt($(n).attr("data-IDColumn"),10),s=f.CalendarHeader.PeriodCoverageData[r.viewRange==Robotics.Client.Constants.ViewRange.Daily?0:v],typeof s!="undefined"&&s!=null&&(e=s.CoverageDate)):t!=null&&i!=null&&(e=t,o=i),e!=null&&r.selectedMinHeaderColumn!=-1&&r.selectedMaxHeaderColumn!=-1)){var h=f.CalendarHeader.PeriodCoverageData[r.viewRange==Robotics.Client.Constants.ViewRange.Daily?0:r.selectedMinHeaderColumn],c=f.CalendarHeader.PeriodCoverageData[r.viewRange==Robotics.Client.Constants.ViewRange.Daily?0:r.selectedMaxHeaderColumn],y=null,l=null,a=null;typeof h!="undefined"&&h!=null&&typeof c!="undefined"&&c!=null&&(y=h.IDGroup,l=h.CoverageDate,a=c.CoverageDate,o==null&&(o=moment(e).add(moment(a).diff(moment(l),"days"),"days").toDate()),u={},u.firstDate=r.firstDate,u.endDate=r.endDate,u.employeeFilter=r.employeeFilter,u.loadRecursive=r.loadRecursive,u.calendar=null,u.typeView=r.typeView,u.assignmentsFilter=r.assignmentsFilter,u.idGroup=y,u.copyBeginDate=l,u.copyEndDate=a,u.pasteBegindDate=e,u.pasteEndDate=o,u.StampParam=(new Date).getMilliseconds(),r.performAction(u,Robotics.Client.Constants.Actions.CopyCoverages,!1))}};Robotics.Client.Controls.roSchedulerCalendar.prototype.selectHeaderMultiple=function(n,t){var i=this.oBaseControl,e=i.oCalendar,r,u,f;if(n!=null&&i.viewRange!=Robotics.Client.Constants.ViewRange.Daily)for(r=parseInt($(n).attr("data-IDColumn"),10),u=parseInt($(t).attr("data-IDColumn"),10),this.cancelCurrentMultipleSelect(null,!1),r<=u?(i.selectedMinHeaderColumn=r,i.selectedMaxHeaderColumn=u):(i.selectedMinHeaderColumn=u,i.selectedMaxHeaderColumn=r),f=i.selectedMinHeaderColumn;f<=i.selectedMaxHeaderColumn;f++)$("#"+i.ascxPrefix+"_calHeaderCell_"+f).addClass("ui-selected")};Robotics.Client.Controls.roSchedulerCalendar.prototype.selectMultiple=function(n,t){var i=this.oBaseControl,h=i.oCalendar,r,u;if(n!=null&&i.viewRange!=Robotics.Client.Constants.ViewRange.Daily){var f=parseInt($(n).attr("data-IDRow"),10),e=parseInt($(t).attr("data-IDRow"),10),o=parseInt($(n).attr("data-IDColumn"),10),s=parseInt($(t).attr("data-IDColumn"),10);for(this.cancelCurrentMultipleSelect(null,!1),f<=e?(i.selectedMinRow=f,i.selectedMaxRow=e):(i.selectedMinRow=e,i.selectedMaxRow=f),o<=s?(i.selectedMinColumn=o,i.selectedMaxColumn=s):(i.selectedMinColumn=s,i.selectedMaxColumn=o),r=i.selectedMinRow;r<=i.selectedMaxRow;r++)for(u=i.selectedMinColumn;u<=i.selectedMaxColumn;u++)$("#"+i.ascxPrefix+"_calCell_"+r+"_"+u).addClass("ui-selected")}};Robotics.Client.Controls.roSchedulerCalendar.prototype.setSingleHeaderSelectedObejct=function(n){var t=this.oBaseControl,r=t.oCalendar,i;n!=null&&this.setSingleSelectedObject(null);t.selectedHeaderContainer!=null&&t.selectedHeaderContainer.removeClass("singleCellSelected");n==null?t.selectedHeaderContainer=null:(i=parseInt($(n).attr("data-IDColumn"),10),i>=t.selectedMinHeaderColumn&&i<=t.selectedMaxHeaderColumn||t.selectionHeaderCopied||(this.cancelCurrentMultipleSelect(n,!0),this.cancelCurrentMultipleHeaderSelect(n,!0)),t.selectedHeaderContainer=$(n),t.selectedHeaderContainer.addClass("singleCellSelected"))};Robotics.Client.Controls.roSchedulerCalendar.prototype.setSingleSelectedObject=function(n){var t=this.oBaseControl,i=t.oCalendar,r,u;n!=null&&this.setSingleHeaderSelectedObejct(null);t.selectedContainer!=null&&t.selectedContainer.removeClass("singleCellSelected");n==null?(t.selectedEmployee=null,t.selectedDay=null,t.selectedContainer=null):(r=parseInt($(n).attr("data-IDRow"),10),u=parseInt($(n).attr("data-IDColumn"),10),r>=t.selectedMinRow&&r<=t.selectedMaxRow&&u>=t.selectedMinColumn&&u<=t.selectedMaxColumn||t.selectionCopied||(this.cancelCurrentMultipleSelect(null,!1),this.cancelCurrentMultipleHeaderSelect(null,!1)),t.selectedEmployee=i.CalendarData[parseInt($(n).attr("data-IDRow"),10)],t.selectedDay=t.viewRange!=Robotics.Client.Constants.ViewRange.Daily?i.CalendarData[parseInt($(n).attr("data-IDRow"),10)].PeriodData.DayData[parseInt($(n).attr("data-IDColumn"),10)]:i.CalendarData[parseInt($(n).attr("data-IDRow"),10)].PeriodData.DayData[0],t.selectedContainer=$(n),t.selectedContainer.addClass("singleCellSelected"))};Robotics.Client.Controls.roSchedulerCalendar.prototype.endSelectOperation=function(n){var r=this.oBaseControl,s=r.oCalendar,i=$(".calendarOuterBodyCell.ui-selected"),t;this.cancelCurrentMultipleHeaderSelect(n,!0);this.setSingleHeaderSelectedObejct(null);this.setSingleSelectedObject(null);var u=0,f=0,e=0,o=0;for(t=0;t<i.length;t++)t==0?(u=parseInt($(i[t]).attr("data-IDRow"),10),f=parseInt($(i[t]).attr("data-IDRow"),10),e=parseInt($(i[t]).attr("data-IDColumn"),10),o=parseInt($(i[t]).attr("data-IDColumn"),10)):(parseInt($(i[t]).attr("data-IDRow"),10)<u&&(u=parseInt($(i[t]).attr("data-IDRow"),10)),parseInt($(i[t]).attr("data-IDRow"),10)>f&&(f=parseInt($(i[t]).attr("data-IDRow"),10)),parseInt($(i[t]).attr("data-IDColumn"),10)<e&&(e=parseInt($(i[t]).attr("data-IDColumn"),10)),parseInt($(i[t]).attr("data-IDColumn"),10)>o&&(o=parseInt($(i[t]).attr("data-IDColumn"),10)));r.selectedMinRow=u;r.selectedMaxRow=f;r.selectedMinColumn=e;r.selectedMaxColumn=o};Robotics.Client.Controls.roSchedulerCalendar.prototype.endHeaderSelectOperation=function(n){var f=this.oBaseControl,e=f.oCalendar,i=$(".CalendarDayFixedHeader.ui-selected"),r,u,t;for(this.cancelCurrentMultipleSelect(n,!0),this.setSingleHeaderSelectedObejct(null),this.setSingleSelectedObject(null),r=0,u=0,t=0;t<i.length;t++)t==0?(r=parseInt($(i[t]).attr("data-IDColumn"),10),u=parseInt($(i[t]).attr("data-IDColumn"),10)):(parseInt($(i[t]).attr("data-IDColumn"),10)<r&&(r=parseInt($(i[t]).attr("data-IDColumn"),10)),parseInt($(i[t]).attr("data-IDColumn"),10)>u&&(u=parseInt($(i[t]).attr("data-IDColumn"),10)));f.selectedMinHeaderColumn=r;f.selectedMaxHeaderColumn=u};Robotics.Client.Controls.roSchedulerCalendar.prototype.sortCalendar=function(){var n=this.oBaseControl,t=n.oCalendar,i=n.sortElements.split(",");t.CalendarData=t.CalendarData.sort(dynamicSortMultiple(i,n.viewRange==Robotics.Client.Constants.ViewRange.Daily?0:n.sortColumn));n.refreshTables(null,!1,!0);this.refreshCoveragesHeadersInfo(null);n.calendarSortDialog.dialog("close")};Robotics.Client.Controls.roSchedulerCalendar.prototype.setCallbackReturnData=function(n,t){var e=this,i=this.oBaseControl,u=i.oCalendar,r=parseInt(i.selectedContainer.attr("data-IDRow"),10),f=parseInt(i.selectedContainer.attr("data-IDColumn"),10);e.currentUpdateCell=Object.clone(i.selectedDay,!0);i.viewRange==Robotics.Client.Constants.ViewRange.Daily?t?(i.selectedDay.HourData=n,u.CalendarData[r].PeriodData.DayData[0].HourData=n):(i.selectedDay=n,u.CalendarData[r].PeriodData.DayData[0]=n):(i.selectedDay=n,u.CalendarData[r].PeriodData.DayData[f]=n,setTimeout(function(){var n;if(i.loadIndictments){n=i.ascxPrefix+"_tooltipIndictment_"+r+"_"+f;$("#"+n).off("mouseover");$("#"+n).on("mouseover",function(){var n=$(this).find(".tooltipIndictmentsContainer"),t;n.length!=0&&(t=this.id,$(n).dxTooltip({target:"#"+t,hideEvent:"mouseleave",position:"bottom"}),$(n).dxTooltip("instance").show())})}if(i.loadPunches){n=i.ascxPrefix+"_tooltipPunchesReview_"+r+"_"+f;$("#"+n).off("mouseover");$("#"+n).on("mouseover",function(){var n=$(this).find(".tooltipPunchesReviewContainer"),t;n.length!=0&&(t=this.id,$(n).dxTooltip({target:"#"+t,hideEvent:"mouseleave",position:"bottom"}),$(n).dxTooltip("instance").show())})}},100))};Robotics.Client.Controls.roSchedulerCalendar.prototype.endCallback=function(action,objResult,objResultParams){var request=this,oCalendar=this.oBaseControl,oCalData=oCalendar.oCalendar,allCapacities,uniqueCapacities,i;switch(action){case Robotics.Client.Constants.Actions.CopyCoverages:this.copyCoverageResponse(objResult,objResultParams);break;case Robotics.Client.Constants.Actions.LoadCoverages:this.loadCoveragesResponse(objResult,objResultParams);break;case Robotics.Client.Constants.Actions.DiscardAndContinue:case Robotics.Client.Constants.Actions.LoadData:if(this.loadDataResponse(objResult,objResultParams),oCalendar.capatityEnabled=!1,typeof objResult.CalendarHeader.PeriodSeatingCapacityData!="undefined")for(allCapacities=[].concat.apply([],objResult.CalendarHeader.PeriodSeatingCapacityData.map(function(n){return n.Capacities})),uniqueCapacities=[...new Map(allCapacities.map(n=>[n.WorkCenter,n])).values()],i=0;i<uniqueCapacities.length;i++)uniqueCapacities[i].MaxSeatingCapacity>0&&(oCalendar.capatityEnabled=!0);(oCalendar.capatityEnabled||request.oBaseControl.pageLayout.center.children.tabsContainerLayout.south!=!1&&!request.oBaseControl.pageLayout.center.children.tabsContainerLayout.south.state.isClosed)&&request.generateShiftTotalizerInfo();break;case Robotics.Client.Constants.Actions.CheckCalendarIndictments:this.printInditcmentsResult(objResult,objResultParams);break;case Robotics.Client.Constants.Actions.SaveAndContinue:case Robotics.Client.Constants.Actions.SaveChanges:this.saveChangesResponse(objResult,objResultParams);break;case Robotics.Client.Constants.Actions.LoadHourData:this.loadHourDataResponse(objResult,objResultParams);break;case Robotics.Client.Constants.Actions.LoadDayDefinition:this.loadDayDefinitionResponse(objResult,objResultParams);break;case Robotics.Client.Constants.Actions.ExportToExcel:this.exportToExcelResponse(objResult,objResultParams);break;case Robotics.Client.Constants.Actions.ImportFromExcel:this.importFromExcelResponse(objResult,objResultParams);break;case Robotics.Client.Constants.Actions.ImportFromExcelKO:this.importFromExcelKOResponse(objResult,objResultParams);break;case Robotics.Client.Constants.Actions.ImportFromExcelWarning:this.importFromExcelWarningResponse(objResult,objResultParams);break;case Robotics.Client.Constants.Actions.ShiftLayerDefinition:this.shiftLayerDefinitionResponse(objResult,objResultParams);break;case Robotics.Client.Constants.Actions.ShiftLayerDefinitionEdit:this.shiftLayerDefinitionEditResponse(objResult,objResultParams)}action!=Robotics.Client.Constants.Actions.SaveChanges&&this.loadingFunctionExtended(!1);(action==Robotics.Client.Constants.Actions.DiscardAndContinue||action==Robotics.Client.Constants.Actions.SaveAndContinue)&&(eval(oCalendar.onContinueFunc),oCalendar.onContinueFunc="");this.bRelatedTables==!0&&setTimeout(function(){request.loadRelatedTables()},300)};Robotics.Client.Controls.roSchedulerCalendar.prototype.saveChangesResponse=function(){var n=this.oBaseControl,t=n.oCalendar;n.capacityError=!1;n.setHasChanges(!1);n.isScheduleActive&&this.setUpSchedulingTimmer(1);n.loadIndictments?this.refresh():this.loadingFunctionExtended(!1)};Robotics.Client.Controls.roSchedulerCalendar.prototype.printInditcmentsResult=function(n){var t=this.oBaseControl,i=t.oCalendar;this.validationInProgress=!0;t.oCalendar=n;t.setHasChanges(!0);t.refreshTables(null,!1,!0);this.validationInProgress=!1};Robotics.Client.Controls.roSchedulerCalendar.prototype.loadDataResponse=function(n,t){var i=this.oBaseControl,r=i.oCalendar;i.viewRange=moment(n.FirstDay).diff(moment(n.LastDay),"days")==0?i.typeView==Robotics.Client.Constants.TypeView.Review?Robotics.Client.Constants.ViewRange.Period:Robotics.Client.Constants.ViewRange.Daily:Robotics.Client.Constants.ViewRange.Period;i.initialize();i.oCalendar=n;i.remarksColor=t;i.setHasChanges(!1);i.refreshTables(null,!1,!0);i.isScheduleActive&&this.refreshCoveragesHeadersInfo(null)};Robotics.Client.Controls.roSchedulerCalendar.prototype.loadCoveragesResponse=function(n){var t=this.oBaseControl,i=t.oCalendar;this.refreshCoveragesHeadersInfo(n)};Robotics.Client.Controls.roSchedulerCalendar.prototype.copyCoverageResponse=function(n){var t=this.oBaseControl,i=t.oCalendar;this.refreshCoveragesHeadersInfo(n);t.selectionCopied=!1;t.selectionHeaderCopied=!1;this.cancelCurrentMultipleSelect(null,!1);this.cancelCurrentMultipleHeaderSelect(null,!1)};Robotics.Client.Controls.roSchedulerCalendar.prototype.loadHourDataResponse=function(n){this.setCallbackReturnData(n,!0);this.refreshDailySelectedData(!1)};Robotics.Client.Controls.roSchedulerCalendar.prototype.loadDayDefinitionResponse=function(n){var t=this.oBaseControl,i=t.oCalendar;this.setCallbackReturnData(n,!1);this.refreshFullDay();this.setUpSchedulingTimmer(1)};Robotics.Client.Controls.roSchedulerCalendar.prototype.exportToExcelResponse=function(){var n=this.oBaseControl,t=n.oCalendar;window.open("./../Base/WebUserControls/roCalendar/Wizards/downloadCalendar.aspx")};Robotics.Client.Controls.roSchedulerCalendar.prototype.importFromExcelResponse=function(n){var t=this.oBaseControl,i=t.oCalendar;this.calendarHasChanges(n)?(t.selectedDay=null,t.selectedContainer=null,t.selectedEmployee=null,t.oCalendar=n,t.refreshTables(null,!1,!0),t.setHasChanges(!0)):t.showErrorPopup("Info.ChangesTitle","info","Calendar.Client.NoDaysUpdated","","Error.OK","Error.OKDesc",t.defaultMessageAction)};Robotics.Client.Controls.roSchedulerCalendar.prototype.importFromExcelKOResponse=function(n){var t=this.oBaseControl,r=t.oCalendar,i;t.buildErrorMessage(n,!0);t.importErrorDialog.dialog("open");n.CalendarDataResult["0"].ErrorCode==15&&(i=document.getElementById("btDownload"),i.style.visibility="hidden")};Robotics.Client.Controls.roSchedulerCalendar.prototype.importFromExcelWarningResponse=function(n,t){var i=this.oBaseControl,r=i.oCalendar;this.calendarHasChanges(n)?(i.setHasChanges(!0),i.selectedDay=null,i.selectedContainer=null,i.selectedEmployee=null,i.oCalendar=n,i.refreshTables(null,!1,!0),i.buildErrorMessage(t,!0),i.importErrorDialog.dialog("open")):i.showErrorPopup("Info.ChangesTitle","info","Calendar.Client.NoDaysUpdated","","Error.OK","Error.OKDesc",i.defaultMessageAction)};Robotics.Client.Controls.roSchedulerCalendar.prototype.shiftLayerDefinitionResponse=function(n){var t=this.oBaseControl,i=t.oCalendar;t.showComplementaryAssignDialog?t.prepareComplementaryDialog(n):t.showAssignmentsDialog?t.prepareAssignmentsDialog(n):t.showStarterDialog&&t.prepareStarterDialog(n)};Robotics.Client.Controls.roSchedulerCalendar.prototype.shiftLayerDefinitionEditResponse=function(n){var t=this.oBaseControl,i=t.oCalendar;t.showComplementaryAssignDialog?this.editComplementaryInfoFinally(n):t.showAssignmentsDialog?this.editAssignmentsInfoFinally(n):t.showStarterDialog&&this.editStarterInfoFinally(n)};Robotics.Client.Controls.roSchedulerCalendar.prototype.calendarHasChanges=function(n){var o=this.oBaseControl,r=!1,i=o.oCalendar,u,t,f,e;if(typeof n!="undefined"&&(i=n),i.CalendarData!=null&&i.CalendarData.length>0)for(u=0;u<i.CalendarData.length;u++){if(t=i.CalendarData[u],t.PeriodData!=null&&t.PeriodData.DayData!=null&&t.PeriodData.DayData.length>0)for(f=0;f<t.PeriodData.DayData.length;f++)if(e=t.PeriodData.DayData[f],e.HasChanged&&(r=!0),r)break;if(r)break}return r};Robotics.Client.Controls.roSchedulerCalendar.prototype.setUpSchedulingTimmer=function(){var n=this.oBaseControl,t=this};Robotics.Client.Controls.roSchedulerCalendar.prototype.refreshTimmerFunc=function(){var n=this.oBaseControl};Robotics.Client.Controls.roSchedulerCalendar.prototype.refreshCoveragesHeadersInfo=function(){};Robotics.Client.Controls.roSchedulerCalendar.prototype.reloadCoveragesData=function(){var n=this.oBaseControl,i=n.oCalendar,t;n.employeeFilter.count("A")==1&&(t=this.generateLoadFilters(),n.performAction(t,Robotics.Client.Constants.Actions.LoadCoverages,!1))};Robotics.Client.Controls.roSchedulerCalendar.prototype.onAcceptCopyDialog=function(n,t){var i=this.oBaseControl;this.pasteSelectionEnd(i.sourceDialogRow,i.sourceDialogColumn,i.copyWorkingShifts,i.copyHolidaysShifts,i.copyAssignmentsShifts,n,t)};Robotics.Client.Controls.roSchedulerCalendar.prototype.prepareStarterDialog=function(n){var t=this.oBaseControl;if(n!=null&&(t.shiftsExtendedDataCache[t.starterShift.ID]=n),t.starterManager.prepareStarterDialog(t.shiftsExtendedDataCache[t.starterShift.ID],-1),t.viewRange==Robotics.Client.Constants.ViewRange.Daily){var i=parseInt(t.selectedContainer.attr("data-IDColumn"),10),r="1899/12/30 "+t.oCalendar.CalendarHeader.PeriodHeaderData[i].Row2Text,u=moment(r,"YYYY/MM/DD HH:mm").toDate();t.starterManager.setOffset(u)}t.starterDialog.dialog("open")};Robotics.Client.Controls.roSchedulerCalendar.prototype.onAcceptStarterDialog=function(){var n=this.oBaseControl,i=n.oCalendar,t;n.starterManager.isValid()&&(n.starterDialog.dialog("close"),n.showStarterDialog=!1,t=n.starterManager.getDayData(),n.isBatchMode()?t.Type==Robotics.Client.Constants.ShiftType.Normal||t.Type==Robotics.Client.Constants.ShiftType.NormalFloating?this.assignShiftToDayBatch(t,null,undefined,undefined,!0,!0):this.assignShiftToDayBatch(null,t,undefined,undefined,!0,!0):t.Type==Robotics.Client.Constants.ShiftType.Normal||t.Type==Robotics.Client.Constants.ShiftType.NormalFloating?this.assignShiftToDay(n.selectedContainer,n.selectedDay,t,null,n.selectedDay.AssigData,n.selectedDay.AllowAssignment,!0,!0,n.selectedEmployee.EmployeeData):this.assignShiftToDay(n.selectedContainer,n.selectedDay,null,t,n.selectedDay.AssigData,n.selectedDay.AllowAssignment,!0,!0,n.selectedEmployee.EmployeeData),n.complementaryShift=null,this.waitForUserToRefresh())};Robotics.Client.Controls.roSchedulerCalendar.prototype.prepareComplementaryDialog=function(n){var t=this.oBaseControl;if(n!=null&&(t.shiftsExtendedDataCache[t.complementaryShift.ID]=n),t.complementaryManager.prepareComplementaryDialog(t.shiftsExtendedDataCache[t.complementaryShift.ID],-1),t.viewRange==Robotics.Client.Constants.ViewRange.Daily){var i=parseInt(t.selectedContainer.attr("data-IDColumn"),10),r="1899/12/30 "+t.oCalendar.CalendarHeader.PeriodHeaderData[i].Row2Text,u=moment(r,"YYYY/MM/DD HH:mm").toDate();t.complementaryManager.setOffset(u)}t.complementaryDialog.dialog("open")};Robotics.Client.Controls.roSchedulerCalendar.prototype.onAcceptComplementaryDialog=function(){var n=this.oBaseControl,i=n.oCalendar,t;n.complementaryManager.isValid()&&(n.complementaryDialog.dialog("close"),n.showComplementaryAssignDialog=!1,t=n.complementaryManager.getDayData(),n.showAssignmentsDialog?(n.assignmentShift=t,this.prepareAssignmentsDialog(null)):(n.isBatchMode()?t.Type==Robotics.Client.Constants.ShiftType.Normal||t.Type==Robotics.Client.Constants.ShiftType.NormalFloating?this.assignShiftToDayBatch(t,null,undefined,undefined,!0,!0):this.assignShiftToDayBatch(null,t,undefined,undefined,!0,!0):t.Type==Robotics.Client.Constants.ShiftType.Normal||t.Type==Robotics.Client.Constants.ShiftType.NormalFloating?this.assignShiftToDay(n.selectedContainer,n.selectedDay,t,null,n.selectedDay.AssigData,n.selectedDay.AllowAssignment,!0,!0,n.selectedEmployee.EmployeeData):this.assignShiftToDay(n.selectedContainer,n.selectedDay,null,t,n.selectedDay.AssigData,n.selectedDay.AllowAssignment,!0,!0,n.selectedEmployee.EmployeeData),n.complementaryShift=null,this.waitForUserToRefresh()))};Robotics.Client.Controls.roSchedulerCalendar.prototype.prepareAssignmentsDialog=function(n){var t=this.oBaseControl;n!=null&&(t.shiftsExtendedDataCache[t.assignmentShift.ID]=n);t.assignmentsManager.prepareAssignmentsDialog(t.shiftsExtendedDataCache[t.assignmentShift.ID],t.selectedEmployee.EmployeeData.Assignments,-1);t.assignmentsDialog.dialog("open");setTimeout(function(){t.assignmentsManager.focusDialog()},100)};Robotics.Client.Controls.roSchedulerCalendar.prototype.onAcceptAssignmentsDialog=function(){var n=this.oBaseControl,i=n.oCalendar,t;n.assignmentsManager.isValid()&&(n.assignmentsDialog.dialog("close"),n.showAssignmentsDialog=!1,t=n.assignmentsManager.getDayData(),n.isBatchMode()?n.assignmentShift.Type==Robotics.Client.Constants.ShiftType.Normal||n.assignmentShift.Type==Robotics.Client.Constants.ShiftType.NormalFloating?this.assignShiftToDayBatch(n.assignmentShift,null,t,!0,!0,!0):this.assignShiftToDayBatch(null,n.assignmentShift,t,!0,!0,!0):n.assignmentShift.Type==Robotics.Client.Constants.ShiftType.Normal||n.assignmentShift.Type==Robotics.Client.Constants.ShiftType.NormalFloating?this.assignShiftToDay(n.selectedContainer,n.selectedDay,n.assignmentShift,null,t,!0,!0,!0,n.selectedEmployee.EmployeeData):this.assignShiftToDay(n.selectedContainer,n.selectedDay,null,n.assignmentShift,t,!0,!0,!0,n.selectedEmployee.EmployeeData),n.assignmentShift=null,this.waitForUserToRefresh())};Robotics.Client.Controls.roSchedulerCalendar.prototype.changeFilterAssignments=function(){for(var oCalendar=this.oBaseControl,oCalData=oCalendar.oCalendar,assignmentsGrid=eval(oCalendar.ascxPrefix+"_dlgFilterCalendar_grdAssignmentsClient"),rbPlannedView=eval(oCalendar.ascxPrefix+"_dlgFilterCalendar_rbPlannedView"),rbRealView=eval(oCalendar.ascxPrefix+"_dlgFilterCalendar_rbRealView"),selectedValues=assignmentsGrid.GetSelectedKeysOnPage(),calendarFilter="",i=0;i<selectedValues.length;i++)calendarFilter+=selectedValues[i]+",";calendarFilter!=""&&(calendarFilter=calendarFilter.substring(0,calendarFilter.length-1));oCalendar.assignmentsFilter=calendarFilter;this.schedulingView=rbPlannedView.GetChecked()?Robotics.Client.Constants.CoverageDayView.Planified:Robotics.Client.Constants.CoverageDayView.Real;oCalendar.setFiltersCookieValue();oCalendar.refresh()};Robotics.Client.Controls.roSchedulerCalendar.prototype.importFile=function(){var oCalendar=this.oBaseControl,oCalData=oCalendar.oCalendar,oParameters={};oParameters.firstDate=oCalendar.firstDate;oParameters.endDate=oCalendar.endDate;oParameters.employeeFilter=oCalendar.employeeFilter;oParameters.assignmentsFilter=oCalendar.assignmentsFilter;oParameters.loadRecursive=oCalendar.loadRecursive;oParameters.excelType=eval(oCalendar.ascxPrefix+"_dlgImport_rbExcelType2").GetChecked();oParameters.copyMainShifts=eval(oCalendar.ascxPrefix+"_dlgImport_ckImportCopyMainShiftsClient").GetChecked();oParameters.copyHolidays=eval(oCalendar.ascxPrefix+"_dlgImport_ckImportCopyHolidaysClient").GetChecked();oParameters.keepHolidays=eval(oCalendar.ascxPrefix+"_dlgImport_ckImportKeepHolidaysClient").GetChecked();oParameters.keepBloqued=eval(oCalendar.ascxPrefix+"_dlgImport_ckImportKeepBloquedDaysClient").GetChecked();oParameters.StampParam=(new Date).getMilliseconds();oCalendar.performAction(oParameters,Robotics.Client.Constants.Actions.ImportFromExcel)};Robotics.Client.Controls.roSchedulerCalendar.prototype.exportToExcel=function(){var t=this.oBaseControl,n={};n.calendar=t.oCalendar;n.StampParam=(new Date).getMilliseconds();t.performAction(n,Robotics.Client.Constants.Actions.ExportToExcel)};Robotics.Client.Controls.roSchedulerCalendar.prototype.saveAndContinue=function(){var t=this.oBaseControl,n={};n.calendar=t.oCalendar;n.StampParam=(new Date).getMilliseconds();t.performAction(n,Robotics.Client.Constants.Actions.SaveAndContinue)};Robotics.Client.Controls.roSchedulerCalendar.prototype.discardAndContinue=function(){var oCalendar=this.oBaseControl;eval(oCalendar.onContinueFunc);oCalendar.onContinueFunc=""};Robotics.Client.Controls.roSchedulerCalendar.prototype.refresh=function(){var t=this,n=this.oBaseControl,i=this.generateLoadFilters();n.sortColumn=-1;t.calendarIndictments={};t.calendarIndictmentsDS=[];n.shiftsList={};n.capacityList={};n.assignmentsList={};n.columnShiftsList={};n.columnCapacityList={};n.rowsShiftsList={};n.employeeDataList={};n.columnAssignmentsList={};n.rowsAssignmentsList={};this.resumeInfoLoaded=!1;t.oBaseControl.pageLayout.east!=null&&t.oBaseControl.pageLayout.east.children.tabsContainerLayout.hide("south");t.oBaseControl.pageLayout.east==!1||t.oBaseControl.pageLayout.east.state.isClosed||t.oBaseControl.pageLayout.toggle("east");n.performAction(i,Robotics.Client.Constants.Actions.LoadData)};Robotics.Client.Controls.roSchedulerCalendar.prototype.checkCalendarIndictments=function(){var t=this,i=this.oBaseControl,n={};n.calendar=i.oCalendar;n.StampParam=(new Date).getMilliseconds();t.calendarIndictments={};t.calendarIndictmentsDS=[];i.performAction(n,Robotics.Client.Constants.Actions.CheckCalendarIndictments)};Robotics.Client.Controls.roSchedulerCalendar.prototype.refreshDayWithParams=function(n,t){var r=this.oBaseControl,i;this.selectCellByEmployeeDate(n,t)&&(i={},i.StampParam=(new Date).getMilliseconds(),i.idEmployee=r.selectedEmployee.EmployeeData.IDEmployee,i.idGroup=r.selectedEmployee.EmployeeData.IDGroup,i.typeView=r.typeView,i.loadPunches=r.loadPunches,i.dailyPeriod=r.dailyPeriod,i.firstDate=r.selectedDay.PlanDate,r.performAction(i,Robotics.Client.Constants.Actions.LoadDayDefinition))};Robotics.Client.Controls.roSchedulerCalendar.prototype.getEmployeeCountResume=function(){var n=this.oBaseControl,t="",i,r,u,f;if(n.oCalendar.CalendarData.length==0)i=n.employeeFilter.count("A"),i==0?t+=n.translator.translate(Robotics.Client.Language.Tags.NoSolection):(t+="0 "+n.translator.translate(Robotics.Client.Language.Tags.Employees),i>0&&(t+=" "+n.translator.translate(Robotics.Client.Language.Tags.Connector)+" "+i,t+=i==1?" "+n.translator.translate(Robotics.Client.Language.Tags.Department):" "+n.translator.translate(Robotics.Client.Language.Tags.Departments)));else{var o={},s={},e=0,i=0;for(r=0;r<n.oCalendar.CalendarData.length;r++)u=n.oCalendar.CalendarData[r].EmployeeData.IDEmployee,f=n.oCalendar.CalendarData[r].EmployeeData.IDGroup,typeof o[u]=="undefined"&&(o[u]=u,e+=1),typeof s[f]=="undefined"&&(s[f]=f,i+=1);t+=e;t+=e==1?" "+n.translator.translate(Robotics.Client.Language.Tags.Employee):" "+n.translator.translate(Robotics.Client.Language.Tags.Employees);i>0&&(t+=" "+n.translator.translate(Robotics.Client.Language.Tags.Connector)+" "+i,t+=i==1?" "+n.translator.translate(Robotics.Client.Language.Tags.Department):" "+n.translator.translate(Robotics.Client.Language.Tags.Departments))}return t};Robotics.Client.Controls.roSchedulerCalendar.prototype.assignShiftToDayBatch=function(n,t,i,r,u,f){var y=this,e=this.oBaseControl,s=e.oCalendar,l,a;for(this.copyInProgress=!0,l=e.selectedMinRow;l<=e.selectedMaxRow;l++)for(a=e.selectedMinColumn;a<=e.selectedMaxColumn;a++){var o=l,v=a,h=!0,c=null;e.viewRange!=Robotics.Client.Constants.ViewRange.Daily?o<s.CalendarData.length&&v<s.CalendarData[o].PeriodData.DayData.length?(h=!0,c=s.CalendarData[o].PeriodData.DayData[v]):h=!1:o<s.CalendarData.length?(h=!0,c=s.CalendarData[o].PeriodData.DayData[0]):h=!1;h&&(typeof r=="undefined"&&(r=c.AllowAssignment),typeof i=="undefined"&&(i=c.AssigData),$("#"+e.ascxPrefix+"_calCell_"+o+"_"+v).hasClass("ui-selected")&&this.assignShiftToDay($("#"+e.ascxPrefix+"_calCell_"+o+"_"+v),c,n,t,i,r,u,f,s.CalendarData[o].EmployeeData))}e.loadIndictments&&y.checkCalendarIndictments();this.copyInProgress=!1};Robotics.Client.Controls.roSchedulerCalendar.prototype.assignShiftToDay=function(n,t,i,r,u,f,e,o,s){var b=this,h=this.oBaseControl,tt=h.oCalendar,l,c,g,p,a,y,v,w,k,d,nt;if(t.EmployeeStatusOnDay==Robotics.Client.Constants.EmployeeStatusOnDay.Ok){if(l=!0,t.CanBeModified?moment(t.PlanDate)<=moment(s.FreezingDate)?(h.isBatchMode()||h.showErrorPopup("Error.Title","error","Calendar.Client.FreezeDate","","Error.OK","Error.OKDesc",h.defaultMessageAction),l=!1):typeof t.Alerts!="undefined"&&r!=null&&t.Alerts.OnHolidaysHours?(h.isBatchMode()||h.showErrorPopup("Error.Title","error","Calendar.Client.OverlappedHolidays","","Error.OK","Error.OKDesc",h.defaultMessageAction),l=!1):t.IDDailyBudgetPosition>0?i!=null&&(t.MainShift.ExistComplementaryData||t.MainShift.ExistFloatingData)&&h.complementaryManager.canChangeShift(!0,t,i,u)||(h.isBatchMode()||h.showErrorPopup("Error.Title","error","Calendar.Client.BudgetAssigned","","Error.OK","Error.OKDesc",h.defaultMessageAction),l=!1):t.Locked&&(h.isBatchMode()||h.selectionCopied?e&&(l=!1):(h.showErrorPopup("Error.Title","error","Calendar.Client.LockedDay","","Error.OK","Error.OKDesc",h.defaultMessageAction),l=!1)):(h.isBatchMode()||h.showErrorPopup("Error.Title","error","Calendar.Client.NoPermission","","Error.OK","Error.OKDesc",h.defaultMessageAction),l=!1),l){if(c=this.getAssignedShift(t),g=Object.clone(c,!0),r!=null){if(c!=null&&(c.Type==Robotics.Client.Constants.ShiftType.Holiday||c.Type==Robotics.Client.Constants.ShiftType.Holiday_NonWorking)&&(c=t.ShiftBase),c==null&&i==null?(h.isBatchMode()||h.showErrorPopup("Error.Title","error","Calendar.Client.BaseShiftNeeded","","Error.OK","Error.OKDesc",h.defaultMessageAction),l=!1):r.Type==Robotics.Client.Constants.ShiftType.Holiday&&c.PlannedHours==0&&(h.isBatchMode()||h.showErrorPopup("Error.Title","error","Calendar.Client.WorkingBaseShiftNeeded","","Error.OK","Error.OKDesc",h.defaultMessageAction),l=!1),l){if(y=r,p=null,i!=null)p=i;else for(p={ID:c.ID,ShortName:c.ShortName,PlannedHours:c.PlannedHours,Color:c.Color,Name:c.Name,Type:c.Type,StartHour:moment(c.StartHour).clone().toDate(),EndHour:moment(c.EndHour).clone().toDate(),AdvancedParameters:Object.clone(c.AdvancedParameters,!0),BreakHours:c.BreakHours,ExistComplementaryData:c.ExistComplementaryData,ExistFloatingData:c.ExistFloatingData,ShiftLayers:c.ShiftLayers,ShiftLayersDefinition:[]},a=0;a<p.ShiftLayers;a++)p.ShiftLayersDefinition.push({LayerStartTime:moment(c.ShiftLayersDefinition[a].LayerStartTime).clone().toDate(),ExistLayerStartTime:c.ShiftLayersDefinition[a].ExistLayerStartTime,LayerOrdinaryHours:c.ShiftLayersDefinition[a].LayerOrdinaryHours,LayerDuration:c.ShiftLayersDefinition[a].LayerDuration,ExistLayerDuration:c.ShiftLayersDefinition[a].ExistLayerDuration,LayerID:c.ShiftLayersDefinition[a].LayerID,LayerComplementaryHours:c.ShiftLayersDefinition[a].LayerComplementaryHours});t.ShiftBase=p;t.MainShift=y;t.IsHoliday=!0;t.Alerts!=null?t.Alerts.OnHolidays=!0:t.Alerts={OnAbsenceDays:!1,OnAbsenceHours:!1,OnHolidays:!0,UnexpectedlyAbsent:!1,OnHolidaysHours:!1,OnOvertimesHours:!1};moment(t.PlanDate)<=moment(new Date)&&(t.ShiftUsed=y)}}else i!=null?(y=i,o&&c!=null&&(c.Type==Robotics.Client.Constants.ShiftType.Holiday||c.Type==Robotics.Client.Constants.ShiftType.Holiday_NonWorking)?y!=null&&(t.ShiftBase=y):(c!=null&&(c.Type==Robotics.Client.Constants.ShiftType.Holiday||c.Type==Robotics.Client.Constants.ShiftType.Holiday_NonWorking)&&(t.ShiftBase=null),t.IsHoliday=!1,t.MainShift=y,t.Alerts!=null?t.Alerts.OnHolidays=!1:t.Alerts={OnAbsenceDays:!1,OnAbsenceHours:!1,OnHolidays:!1,UnexpectedlyAbsent:!1,OnHolidaysHours:!1,OnOvertimesHours:!1},moment(t.PlanDate)<=moment(new Date)&&(t.ShiftUsed=y))):l=!1;if(h.isScheduleActive)if(t.AllowAssignment=f,f){if(typeof t.AssigData=="undefined"&&(t.AssigData=null),typeof u=="undefined"&&(u=null),u==null&&t.AssigData!=null||u!=null&&t.AssigData==null||u!=null&&t.AssigData!=null&&u.ID!=t.AssigData.ID){if(v=!0,u!=null){if(typeof s!="undefined"&&s.Assignments!=null&&s.Assignments.length>0){for(v=!1,w=0;w<s.Assignments.length;w++)if(s.Assignments[w].ID==u.ID){v=!0;break}}else v=!1;v||h.isBatchMode()||h.showErrorPopup("Error.Title","error","Calendar.Client.AssignmentNotAllowedByEmployee","","Error.OK","Error.OKDesc",h.defaultMessageAction);v&&(k=h,v=!1,Object.keys(k.shiftsExtendedDataCache).forEach(function(n){var i,r;if((t.IsHoliday==!1&&n==t.MainShift.ID||t.IsHoliday&&n==t.ShiftBase.ID)&&(i=k.shiftsExtendedDataCache[n],typeof i.Assignments!="undefined"&&i.Assignments!="null"&&i.Assignments.length>0))for(r=0;r<i.Assignments.length;r++)if(i.Assignments[r].IDAssig==u.ID){v=!0;break}}),v||h.isBatchMode()||h.showErrorPopup("Error.Title","error","Calendar.Client.AssignmentNotAllowedByShift","","Error.OK","Error.OKDesc",h.defaultMessageAction))}v?(t.AllowAssignment=f,t.AssigData=u,l=!0):l=!1}}else typeof u=="undefined"&&(u=null),u!=null?(l=!1,h.isBatchMode()||h.showErrorPopup("Error.Title","error","Calendar.Client.ShiftNotAllowAssignments","","Error.OK","Error.OKDesc",h.defaultMessageAction)):t.AssigData!=null&&(l=!0,t.AssigData=null,t.AllowAssignment=f);l&&(t.HasChanged=!0,typeof t.TelecommuteForced!="undefined"&&t.TelecommuteForced==!1&&(t.TelecommutingExpected=!1,t.TelecommutingOptional=!1,t.CanTelecommute&&typeof t.MainShift!="undefined"&&t.MainShift!=null&&(d=""+moment(t.PlanDate).day(),t.TelecommutingMandatoryDays.indexOf(d)>=0?(t.TelecommutingExpected=!0,t.TelecommutingOptional=!1):t.TelecommutingOptionalDays.indexOf(d)>=0&&(t.TelecommutingExpected=!1,t.TelecommutingOptional=!0))),h.viewRange!=Robotics.Client.Constants.ViewRange.Daily?(n.empty(),this.buildCalendarCellContent(n,t,!1,s.FreezingDate)):this.reloadHourDayData(),setTimeout(function(){var t;if(h.loadIndictments==!0){t=h.ascxPrefix+"_tooltipIndictment_"+n.attr("data-IDRow")+"_"+n.attr("data-IDColumn");$("#"+t).off("mouseover");$("#"+t).on("mouseover",function(){var n=$(this).find(".tooltipIndictmentsContainer"),t;n.length!=0&&(t=this.id,$(n).dxTooltip({target:"#"+t,hideEvent:"mouseleave",position:"bottom"}),$(n).dxTooltip("instance").show())})}if(h.loadPunches){t=h.ascxPrefix+"_tooltipPunchesReview_"+n.attr("data-IDRow")+"_"+n.attr("data-IDColumn");$("#"+t).off("mouseover");$("#"+t).on("mouseover",function(){var n=$(this).find(".tooltipPunchesReviewContainer"),t;n.length!=0&&(t=this.id,$(n).dxTooltip({target:"#"+t,hideEvent:"mouseleave",position:"bottom"}),$(n).dxTooltip("instance").show())})}},100),h.setHasChanges(!0),b.copyInProgress==!1&&h.loadIndictments&&b.checkCalendarIndictments(),nt=Object.clone(t.MainShift,!0),b.updateShiftTotalizerInfo(g,nt,n.attr("data-IDRow"),n.attr("data-IDColumn"),t,!1))}}else t.EmployeeStatusOnDay==Robotics.Client.Constants.EmployeeStatusOnDay.NoContract?h.isBatchMode()||h.showErrorPopup("Error.Title","error","Calendar.Client.NoContract","","Error.OK","Error.OKDesc",h.defaultMessageAction):t.EmployeeStatusOnDay==Robotics.Client.Constants.EmployeeStatusOnDay.InOtherDepartment&&(h.isBatchMode()||h.showErrorPopup("Error.Title","error","Calendar.Client.InOtherDepartment","","Error.OK","Error.OKDesc",h.defaultMessageAction))},function(){var n=function(n){for(var r=n.split("."),i=window,t=0;t<r.length;t+=1)i=i[r[t]]=i[r[t]]||{};return i};n("Robotics.Client.Controls");n("Robotics.Client.Language");n("Robotics.Client.Constants")}();Robotics.Client.Controls.roProductiveUnitCalendar=function(n){this.name="Robotics.Client.Controls.roProductiveUnitCalendar";this.oBaseControl=n;this.rowTableVisible=1;this.columnTableVisible=1;this.fixedCalendarTable=null;this.pageLayoutOptions={name:"pageLayout",resizable:!1,center__slidable:!1,center__closable:!1,center__paneSelector:"#"+this.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.Center,center__children:{name:"tabsContainerLayout",resizable:!1,center__slidable:!1,center__closable:!1,center__paneSelector:"#"+this.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.Calendar,center__onresize_start:this.onresize(this),center__onresize_end:this.onresize(this)},spacing_closed:15};this.descriptionExists=!1;this.isActionOnRow=!1};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.getLayout=function(){return this.pageLayoutOptions};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.setHasChanges=function(n){var t=this.oBaseControl;t.hasChanges=n};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.create=function(){var n=this.oBaseControl,t=n.oCalendar;this.buildHTMLStructure();n.pageLayout=n.container.layout(this.pageLayoutOptions)};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.loadData=function(n){var t=this.oBaseControl;t.firstDate=moment().startOf("day").toDate();t.endDate=t.firstDate;clearTimeout(t.refreshTimmer);t.refreshTimmer=-1;t.sortColumn=-1;t.dailyPeriod=30;t.oCalendar=n;t.initialize();t.setHasChanges(!1);t.refreshTables(null,!1,!0)};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.getPositions=function(){var n=this.oBaseControl;return n.oCalendar};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.buildHTMLStructure=function(){var n=this.oBaseControl,r=n.oCalendar,t=$("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.Center).attr("class","ui-layout-center"),i=$("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.Calendar).attr("class","ui-layout-center");t.append(i);n.container.append(t)};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.onresize=function(n){return function(){n.loadingFunctionExtended(!0);n.oBaseControl.refreshTables(n,!0,!0);n.loadingFunctionExtended(!1)}};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.loadingFunctionExtended=function(n){var t=this.oBaseControl;(t.isShowingLoader&&!n||!t.isShowingLoader&&n)&&(t.isShowingLoader=n,n?$("#loadingCalendar").show():$("#loadingCalendar").hide(),t.loadingFunc(n))};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.getContextMenuSelector=function(){return".calendarDailyBodyCell"};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.getContextMenuHeaderSelector=function(){return null};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.buildContextMenu=function(n){var t=this.oBaseControl,i=n[0].innerText;return items={changeShift:{name:Globalize.formatMessage("roChangeShift"),disabled:!1,icon:"copyShift"},complementary:{name:Globalize.formatMessage("roEditComplementary"),disabled:!0,icon:"complementary"},assignment:{name:Globalize.formatMessage("roEditAssignment"),disabled:!1,icon:"assignment"},split1:{name:"---------",disabled:!0},removePosition:{name:Globalize.formatMessage("roRemovePosition"),disabled:!1,icon:"removeblock"}},t.selectedEmployee!=null&&(t.selectedEmployee.ShiftData.ExistComplementaryData||t.selectedEmployee.ShiftData.ExistFloatingData)&&(items.complementary.disabled=!1),items};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.executeContextMenuAction=function(n,t){var i=this.oBaseControl,r=i.oCalendar;switch(n){case"changeShift":this.changeShift(t);break;case"complementary":this.editComplementaryInfo(t);break;case"assignment":this.editAssignmentsInfo(t);break;case"removePosition":this.removeSelectedPosition(t)}};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.changeShift=function(){var n=this.oBaseControl,t=n.oCalendar;n.selectedEmployee!=null&&(n.complementaryShift=null,n.showComplementaryAssignDialog=!1,n.showAssignmentsDialog=!1,this.isActionOnRow=!0,this.prepareShfitsDialog(null))};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.editComplementaryInfo=function(){var n=this.oBaseControl,i=n.oCalendar,t;n.selectedEmployee!=null&&(n.complementaryShift=n.selectedEmployee.ShiftData,n.showComplementaryAssignDialog=!0,n.showAssignmentsDialog=!1,this.isActionOnRow=!0,typeof n.shiftsExtendedDataCache[n.complementaryShift.ID]=="undefined"?(t={},t.idShift=n.complementaryShift.ID,t.StampParam=(new Date).getMilliseconds(),n.performAction(t,Robotics.Client.Constants.Actions.ShiftLayerDefinition)):n.prepareComplementaryDialog(null))};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.editAssignmentsInfo=function(){var n=this.oBaseControl,i=n.oCalendar,t;n.selectedEmployee!=null&&(n.assignmentShift=n.selectedEmployee.ShiftData,n.showComplementaryAssignDialog=!1,n.showAssignmentsDialog=!0,this.isActionOnRow=!0,typeof n.shiftsExtendedDataCache[n.assignmentShift.ID]=="undefined"?(t={},t.idShift=n.assignmentShift.ID,t.StampParam=(new Date).getMilliseconds(),n.performAction(t,Robotics.Client.Constants.Actions.ShiftLayerDefinition)):this.prepareAssignmentsDialog(null))};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.removeSelectedPosition=function(){var n=this.oBaseControl,t=n.oCalendar,i=DevExpress.ui.dialog.confirm(Globalize.formatMessage("roDeleteConfirm"),Globalize.formatMessage("roDeleteTitle"));i.done(function(i){i&&n.selectedEmployee!=null&&(t.remove(function(t){return t.ID==n.selectedEmployee.ID}),n.refreshTables(null,!1,!0))})};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.processKeyUpEvent=function(){var n=this.oBaseControl,t=n.oCalendar};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.processKeyDownEvent=function(){var n=this.oBaseControl,t=n.oCalendar};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.onDrop=function(){var n=this.oBaseControl,t=n.oCalendar};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.mapModeEvents=function(){var r=this,t=this.oBaseControl,i=t.oCalendar,n=".calendarDailyBodyCell";$(n+",.reviewDailyBodyCell").off("click");$(n+",.reviewDailyBodyCell").on("click",function(){r.setSingleSelectedObject(this)});$(n+",.productiveUnit-quantity").off("change");$(n+",.productiveUnit-quantity").on("change",function(){var n=parseInt($(this).attr("data-IDRow"),10);i[n].Quantity=parseInt($(this).val(),10)});$(n+",.productiveUnit-quantity").off("keydown");$(n+",.productiveUnit-quantity").on("keydown",function(n){$.inArray(n.keyCode,[46,8,9,27,13,110,190])!==-1||n.keyCode===65&&(n.ctrlKey===!0||n.metaKey===!0)||n.keyCode>=35&&n.keyCode<=40||(n.shiftKey||n.keyCode<48||n.keyCode>57)&&(n.keyCode<96||n.keyCode>105)&&n.preventDefault()});$(n+",.productiveUnit-expand").off("change");$(n+",.productiveUnit-expand").on("change",function(){var n=parseInt($(this).attr("data-IDRow"),10);i[n].IsExpandable=$(this).prop("checked")});$("#"+t.prefix+"Main div.fht-fixed-body div.fht-tbody").scrollLeft((t.firstCellPrinted-46)*30);t.firstCellPrinted=-1};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.setSingleSelectedObject=function(n){var t=this.oBaseControl,i=t.oCalendar;n==null?(t.selectedEmployee=null,t.selectedContainer=null):t.selectedEmployee=i[parseInt($(n).attr("data-IDRow"),10)]};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.refreshModeTables=function(n,t,i){var r=this;n!=null&&(r=n instanceof Robotics.Client.Controls.roCalendar?n.clientMode:n);i&&(r.refreshMainTable(t),this.oBaseControl.mapEvents())};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.refreshMainTable=function(n){var t=this.oBaseControl;try{$("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).fixedHeaderTable("destroy");$("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).find("tfoot").each(function(){this.id==""&&$(this).remove()})}catch(i){}n||this.createResumeTables(Robotics.Client.Constants.TableNames.Calendar,Robotics.Client.Constants.LayoutNames.Calendar);this.fixedCalendarTable=$("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).fixedHeaderTable({altClass:"odd",footer:!1,fixedColumn:!0})};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.createResumeTables=function(n,t){switch(n){case Robotics.Client.Constants.TableNames.Calendar:this.createPUnitTable(n,t)}};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.createPUnitTable=function(n,t){var r=this.oBaseControl,u=$("#"+r.prefix+t),i;u.empty();i=$("<table><\/table>").attr("id",r.prefix+n).attr("class","fancyTable");i.append(this.createPUnitTableHeader(n,t));i.append(this.createPUnitTableBody(n,t));u.append(i)};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.createPUnitTableHeader=function(n){var t=this.oBaseControl,k=t.oCalendar,c=$("<thead><\/thead>").attr("id",t.prefix+n+"_thead").attr("class","HeaderSelectable"),u=$("<tr><\/tr>"),y=$("<th><\/th>"),p=$("<div><\/div>").attr("class","ProductiveUnitFixed CalendarFixedHeader"),l=$("<div><\/div>").attr("class","ProductiveUnitHeaderCellFixed CalendarSummaryFixedHeader"),a=$("<div><\/div>").attr("class","NorthCell"),f,e,o,s;a.append($("<div><\/div>").attr("class","ProductiveUnitHeaderText").html(Globalize.formatMessage("roPUnitPosition")));f=$("<div><\/div>").attr("class","SouthCell");f.append($("<div><\/div>").attr("class","EmpCellTextSouth").html(""));l.append(a,f);e=$("<div><\/div>").attr("class","ProductiveUnitHeaderCellFixed CalendarEmployeeFixedHeader");o=$("<div><\/div>").attr("class","NorthCell NorthCellHeaderEmployee");o.append($("<div><\/div>").attr("class","ProductiveUnitHeaderText").html(Globalize.formatMessage("roPUnitQuantity")));s=$("<div><\/div>").attr("class","SouthCell");s.append($("<div><\/div>").attr("class","EmpCellTextSouth").html(""));e.append(o,s);u.append(y.append(p.append(l,e)));for(var r=moment(t.firstDate).add(-1,"days"),w=moment(t.firstDate).add(2,"days"),h=0;r<w;){if(h>=t.getMinDailyCell()&&h<t.getMaxDailyCell()){var b=$("<th><\/th>"),v=$("<div><\/div>").attr("id",t.ascxPrefix+"_calHeaderCell_"+i).attr("class","CalendarDayFixed CalendarDayFixedHeader DailyCell").attr("data-IDColumn",i).attr("style","background:#F2F4F2 ");v.append($("<div><\/div>").attr("class","NorthCell dayInfo DailyCell").html(r.format("HH:mm")));u.append(b.append(v))}r=r.add(30,"minutes");h++}return c.append(u),c};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.createPUnitTableBody=function(n){var u=this.oBaseControl,r=u.oCalendar,e=$("<tbody><\/tbody>").attr("id",u.prefix+n+"_tbody").attr("class","bodySelectable"),f,t,c,l;if(r!=null&&r.length>0)for(t=0;t<r.length;t++){var i=$("<tr><\/tr>"),s=$("<td><\/td>"),h=$("<div><\/div>").attr("class","ProductiveUnitFixed CalendarFixedBody"),o=$("<div><\/div>").attr("class","ProductiveUnitHeaderCellFixed CalendarSummaryFixedBody");o.append(this.generatePositionSection(t,r[t]));f=$("<div><\/div>").attr("class","ProductiveUnitHeaderCellFixed CalendarEmployeeFixedBody");f.append(this.generateQuantitySection(t,r[t]));i.append(s.append(h.append(o,f)));this.descriptionExists=!1;this.buildPUnitModePostionRow(t,i);tmpCell=$('<td style="width:100%"><\/td>').html("&nbsp;");i.append(tmpCell);e.append(i)}else{var i=$("<tr><\/tr>"),s=$("<td><\/td>"),h=$("<div><\/div>").attr("class","ProductiveUnitFixed CalendarFixedBody"),o=$("<div><\/div>").attr("class","ProductiveUnitHeaderCellFixed CalendarSummaryFixedBody"),f=$("<div><\/div>").attr("class","ProductiveUnitHeaderCellFixed CalendarEmployeeFixedBody");for(i.append(s.append(h.append(o,f))),t=u.getMinDailyCell();t<u.getMaxDailyCell();t++)c=$("<td><\/td>"),l=$("<div><\/div>").attr("class","calendarOuterBodyCellInOtherDepartment DailyCell"),i.append(c.append(l));e.append(i)}return e};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.generatePositionSection=function(n){var t=this.oBaseControl,r=t.oCalendar,i=$("<div><\/div>").attr("id",t.ascxPrefix+"_calPositionCell_"+n).attr("class","productiveUnit-position");return i.attr("data-IDRow",n).html(n+1),i};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.generateQuantitySection=function(n,t){var i=this.oBaseControl,c=i.oCalendar,e=$("<div><\/div>").attr("id",i.ascxPrefix+"_calPositionCell_"+n).attr("data-IDRow",n),o=$("<div><\/div>").attr("class","qtyPosition"),s=$("<input>").attr({type:"text",id:i.ascxPrefix+"_qty_"+n,"data-IDRow":n,"class":"productiveUnit-quantity"}),r,h,u,f;return $(s).val(t.Quantity),o.append(s),r=$("<div><\/div>").attr("class","lblExpandable"),h=$("<label>").attr({"class":"productiveUnit-quantity-text"}).html(Globalize.formatMessage("roPUnitExpandable")),r.append(h),u=$("<div><\/div>").attr("class","checkExpandable"),f=$("<input>").attr({type:"checkbox",id:i.ascxPrefix+"_expand_"+n,"data-IDRow":n,"class":"productiveUnit-expand"}),$(f).prop("checked",t.IsExpandable),u.append(f),e.append(o,r,u),e};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.buildPUnitModePostionRow=function(n,t){for(var r=this.oBaseControl,u=r.oCalendar,f=u[n].ShiftHourData,i=r.getMinDailyCell();i<r.getMaxDailyCell();i++)t.append(this.createDailyCalendarCell(u[n],f[i],n,i))};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.createDailyCalendarCell=function(n,t,i,r){var f=this.oBaseControl,o=f.oCalendar,e=$("<td><\/td>"),u;return r%2==0&&e.addClass("columnDailyCalendarOdd"),u=$("<div><\/div>").attr("id",f.ascxPrefix+"_calDailyCell_"+i+"_"+r).attr("class","calendarDailyBodyCell DailyCell"),u.attr("data-IDRow",i).attr("data-IDColumn",r),this.createDailyCalendarCellContent(u,n,t,r),e.append(u)};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.createDailyCalendarCellContent=function(n,t,i,r){var f=this.oBaseControl,v=f.oCalendar,e=$("<div><\/div>").attr("class","calendarDailyInnerBodyCell"),o=null,s=t.ShiftData;if(i.DailyHourType!=Robotics.Client.Constants.DailyHourType.Untyped){var u="#ffffff",h="",c="",l="",a="";l=" - "+s.Name;c="border-bottom: 8px "+s.Color+" solid;";a="margin-top: -30px;";u=t.AssignmentData.Color;h=t.AssignmentData.Name;switch(i.DailyHourType){case Robotics.Client.Constants.DailyHourType.Complementary:u=(new Robotics.Client.Common.roHtmlColor).shadeBlendConvert(-.5,u)}(f.firstCellPrinted==-1&&i.DailyHourType!=Robotics.Client.Constants.DailyHourType.Untyped||r<f.firstCellPrinted)&&(f.firstCellPrinted=r);e.attr("style","background: "+u+";"+c);this.descriptionExists||r!=0&&i.DailyHourType==t.ShiftHourData[r-1].DailyHourType||(this.descriptionExists=!0,o=this.generateShiftTypeInfoDailyContainer(h+l,u,0,a))}n.append(null,e,o)};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.generateShiftInfoDailyContainer=function(n,t){var r=this.oBaseControl,u=r.oCalendar,i=$("<div><\/div>").attr("class","calendarShiftInfoDailyContainer").attr("title",n).append($("<span class='fontBold calendarFeastLeft'><\/span>").html(n));return i.attr("style","color:"+(new Robotics.Client.Common.roHtmlColor).invertCssColor(t)),i};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.generateShiftTypeInfoDailyContainer=function(n,t,i,r){var e=this.oBaseControl,o=e.oCalendar,u=n,f=$("<div><\/div>").attr("class","calendarShiftTypeInfoDailyContainer").attr("title",u).html(u);return f.attr("style","color:"+(new Robotics.Client.Common.roHtmlColor).invertCssColor(t)+";"+r),f};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.endCallback=function(n,t,i){var r=this.oBaseControl,u=r.oCalendar;switch(n){case Robotics.Client.Constants.Actions.ShiftLayerDefinition:this.shiftLayerDefinitionResponse(t,i);break;case Robotics.Client.Constants.Actions.ShiftLayerDefinitionEdit:this.shiftLayerDefinitionEditResponse(t,i);break;case Robotics.Client.Constants.Actions.PositionModeDayData:this.shiftLayerDefinitionAddPosition(t,i);break;case Robotics.Client.Constants.Actions.UpdateCurrentDayData:this.updateCurrentDayDataHours(t,i)}this.loadingFunctionExtended(!1)};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.shiftLayerDefinitionResponse=function(n){var t=this.oBaseControl;t.showComplementaryAssignDialog?t.prepareComplementaryDialog(n):t.showAssignmentsDialog&&t.prepareAssignmentsDialog(n)};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.shiftLayerDefinitionEditResponse=function(n){var t=this.oBaseControl;t.showComplementaryAssignDialog?t.editComplementaryInfoFinally(n):t.showAssignmentsDialog&&t.editAssignmentsInfoFinally(n)};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.prepareShfitsDialog=function(){var n=this.oBaseControl;n.shiftsDialog.dialog("open")};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.onAcceptShiftsDialog=function(){var n=this.oBaseControl,t=n.shiftSelectorManager.getSelectedItem(),i,r,u;if(t==null)n.showErrorPopup("Error.Title","error","Calendar.Client.NoShiftSelected","","Error.OK","Error.OKDesc",n.defaultMessageAction);else{n.showAssignmentsDialog=!1;t.AllowAssignments==1&&(n.showAssignmentsDialog=!0);n.showComplementaryAssignDialog=!1;(t.AllowComplementary==1||t.AllowFloatingData==1)&&(n.showComplementaryAssignDialog=!0);i=Robotics.Client.Constants.ShiftType.Normal;switch(t.ShiftType){case 0:i=Robotics.Client.Constants.ShiftType.Normal;break;case 1:n.showComplementaryAssignDialog=!0;i=Robotics.Client.Constants.ShiftType.NormalFloating;break;case 2:i=Robotics.Client.Constants.ShiftType.Holiday;break;case 3:i=Robotics.Client.Constants.ShiftType.Holiday_NonWorking}r={ID:t.Id,ShortName:t.ShortName,PlannedHours:t.ShiftHours,Color:t.ShiftColor,Name:t.Name,Type:i,StartHour:moment(t.StartHour,"YYYY/MM/DD HH:mm").toDate()};n.showComplementaryAssignDialog||n.showAssignmentsDialog?(n.showComplementaryAssignDialog&&(n.complementaryShift=r),n.showAssignmentsDialog&&(n.assignmentShift=r),typeof n.shiftsExtendedDataCache[r.ID]=="undefined"?(u={},u.idShift=r.ID,u.StampParam=(new Date).getMilliseconds(),n.performAction(u,Robotics.Client.Constants.Actions.ShiftLayerDefinition)):n.showComplementaryAssignDialog?n.prepareComplementaryDialog(null):n.showAssignmentsDialog&&n.prepareAssignmentsDialog(null)):(n.complementaryShift=null,n.assignmentShift=null,n.showComplementaryAssignDialog=!1,n.showAssignmentsDialog=!1,n.showErrorPopup("Error.Title","error","Calendar.Client.ShiftWithNoAssignmentsSelected","","Error.OK","Error.OKDesc",n.defaultMessageAction));n.shiftsDialog.dialog("close")}};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.prepareComplementaryDialog=function(n){var t=this.oBaseControl;n!=null&&(t.shiftsExtendedDataCache[t.complementaryShift.ID]=n);t.complementaryManager.prepareComplementaryDialog(t.shiftsExtendedDataCache[t.complementaryShift.ID],-1);t.complementaryDialog.dialog("open")};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.onAcceptComplementaryDialog=function(){var n=this.oBaseControl,u=n.oCalendar,i,r,t;if(n.complementaryManager.isValid())if(n.showComplementaryAssignDialog=!1,i=n.complementaryManager.getDayData(),this.isActionOnRow&&!n.showAssignmentsDialog){for(r=0;r<u.length;r++)if(u[r].ID==n.selectedEmployee.ID){u[r].ShiftData=Object.clone(i);n.complementaryShift=null;n.assignmentShift=null;n.showComplementaryAssignDialog=!1;n.showAssignmentsDialog=!1;this.isActionOnRow=!1;t={};t.idShift=i.ID;t.StampParam=(new Date).getMilliseconds();t.endDate=i.StartHour;t.shiftData=i;t.dailyPeriod=30;n.performAction(t,Robotics.Client.Constants.Actions.UpdateCurrentDayData);break}}else n.showAssignmentsDialog?(n.complementaryDialog.dialog("close"),n.assignmentShift=i,this.prepareAssignmentsDialog(null)):(n.showComplementaryAssignDialog=!1,n.showAssignmentsDialog=!1,n.complementaryShift=null,n.assignmentShift=null,n.showErrorPopup("Error.Title","error","Calendar.Client.ShiftWithNoAssignmentsSelected","","Error.OK","Error.OKDesc",n.defaultMessageAction))};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.updateCurrentDayDataHours=function(n){for(var t=this.oBaseControl,r=t.oCalendar,i=0;i<r.length;i++)r[i].ID==t.selectedEmployee.ID&&(r[i].ShiftHourData=Object.clone(n,!0),t.refreshTables(null,!1,!0),t.complementaryDialog.dialog("close"),t.assignmentsDialog.dialog("close"))};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.prepareAssignmentsDialog=function(n){var t=this.oBaseControl;n!=null&&(t.shiftsExtendedDataCache[t.assignmentShift.ID]=n);t.assignmentsManager.prepareAssignmentsDialog(t.shiftsExtendedDataCache[t.assignmentShift.ID],null,-2,t.shiftSelectorManager.getAssignmentsDefinition());t.assignmentsDialog.dialog("open");setTimeout(function(){t.assignmentsManager.focusDialog()},100)};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.onAcceptAssignmentsDialog=function(){var n=this.oBaseControl,r=n.oCalendar,u,i,t;if(n.assignmentsManager.isValid())if(this.isActionOnRow){for(u=n.assignmentsManager.getDayData(),i=0;i<r.length;i++)if(r[i].ID==n.selectedEmployee.ID){n.assignmentShift!=null&&(r[i].ShiftData=Object.clone(n.assignmentShift));r[i].AssignmentData=Object.clone(u);n.complementaryShift=null;n.assignmentShift=null;n.showComplementaryAssignDialog=!1;n.showAssignmentsDialog=!1;this.isActionOnRow=!1;t={};t.idShift=r[i].ShiftData.ID;t.StampParam=(new Date).getMilliseconds();t.endDate=r[i].ShiftData.StartHour;t.shiftData=r[i].ShiftData;n.performAction(t,Robotics.Client.Constants.Actions.UpdateCurrentDayData);break}}else t={},t.idShift=n.assignmentShift.ID,t.StampParam=(new Date).getMilliseconds(),t.endDate=n.assignmentShift.StartHour,t.shiftData=n.assignmentShift,t.dailyPeriod=30,n.performAction(t,Robotics.Client.Constants.Actions.PositionModeDayData),n.assignmentsDialog.dialog("close"),n.showAssignmentsDialog=!1;else n.showComplementaryAssignDialog=!1,n.showAssignmentsDialog=!1,n.complementaryShift=null,n.assignmentShift=null,n.showErrorPopup("Error.Title","error","Calendar.Client.ShiftWithNoAssignmentsSelected","","Error.OK","Error.OKDesc",n.defaultMessageAction)};Robotics.Client.Controls.roProductiveUnitCalendar.prototype.shiftLayerDefinitionAddPosition=function(n){var t=this.oBaseControl,u=t.oCalendar,f,i,r,e;if(t.assignmentShift!=null){for(f=t.assignmentsManager.getDayData(),i=0,r=0;r<u.length;r++)u[r].ID<i&&(i=u[r].ID);i=i-1;e={ID:i,IDProductiveUnitMode:-1,Quantity:1,IsExpandable:!0,ShiftData:Object.clone(t.assignmentShift,!0),AssignmentData:f,ShiftHourData:Object.clone(n,!0),EmployeesData:null,Coverage:0};u.push(e);t.complementaryShift=null;t.assignmentShift=null;t.showComplementaryAssignDialog=!1;t.showAssignmentsDialog=!1;t.refreshTables(null,!1,!0)}else t.showComplementaryAssignDialog=!1,t.showAssignmentsDialog=!1,t.complementaryShift=null,t.assignmentShift=null,t.showErrorPopup("Error.Title","error","Calendar.Client.ShiftWithNoAssignmentsSelected","","Error.OK","Error.OKDesc",t.defaultMessageAction)},function(){var n=function(n){for(var r=n.split("."),i=window,t=0;t<r.length;t+=1)i=i[r[t]]=i[r[t]]||{};return i};n("Robotics.Client.Controls");n("Robotics.Client.Language");n("Robotics.Client.Constants")}();Robotics.Client.Controls.roBudgetCalendarDefinition=function(n){this.name="Robotics.Client.Controls.roBudgetCalendarDefinition";this.oBaseControl=n;this.rowTableVisible=1;this.columnTableVisible=1;this.fixedCalendarTable=null;this.pageLayoutOptions={name:"pageLayout",resizable:!1,center__slidable:!1,center__closable:!1,center__paneSelector:"#"+this.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.Center,center__children:{name:"tabsContainerLayout",resizable:!1,center__slidable:!1,center__closable:!1,center__paneSelector:"#"+this.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.Calendar,center__onresize_start:this.onresize(this),center__onresize_end:this.onresize(this)},spacing_closed:15};this.OnSelectedCell=null;this.OnDayClick=null;this.idUnitSelected=-1};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.getLayout=function(){return this.pageLayoutOptions};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.setHasChanges=function(n){var u=this.oBaseControl,t=u.oCalendar,i,r;if(u.hasChanges=n,!u.hasChanges&&t!=null&&t.BudgetData!=null)for(i=0;i<t.BudgetData.length;i++)if(t.BudgetData[i].RowState=Robotics.Client.Constants.BudgetRowState.NoChanged,t.BudgetData[i].PeriodData.DayData!=null)for(r=0;r<t.BudgetData[i].PeriodData.DayData.length;r++)t.BudgetData[i].PeriodData.DayData[r].HasChanged=!1;try{hasChanges(n)}catch(f){}};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.create=function(){var n=this.oBaseControl,t=n.oCalendar;this.buildHTMLStructure();n.pageLayout=n.container.layout(this.pageLayoutOptions)};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.buildHTMLStructure=function(){var n=this.oBaseControl,r=n.oCalendar,t=$("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.Center).attr("class","ui-layout-center"),i=$("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.Calendar).attr("class","ui-layout-center");t.append(i);n.container.empty();n.container.append(t)};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.onresize=function(n){return function(){n.loadingFunctionExtended(!0);n.oBaseControl.refreshTables(n,!0,!0);n.loadingFunctionExtended(!1)}};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.loadingFunctionExtended=function(n){var t=this.oBaseControl;(t.isShowingLoader&&!n||!t.isShowingLoader&&n)&&(t.isShowingLoader=n,n?$("#loadingCalendar").show():$("#loadingCalendar").hide(),t.loadingFunc(n))};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.getContextMenuSelector=function(){var t=this,n=this.oBaseControl;return n.viewRange==Robotics.Client.Constants.ViewRange.Daily?".calendarDailyBodyCell":".calendarOuterBodyCell"};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.getContextMenuHeaderSelector=function(){var n=this,t=this.oBaseControl;return".CalendarDayFixedHeader"};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.processKeyUpEvent=function(){var n=this;n.cancelCurrentMultipleSelect(null,!1);n.cancelCurrentMultipleHeaderSelect(null,!1)};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.processKeyDownEvent=function(n){var i=this,t=this.oBaseControl;t.ctrlDown&&n.keyCode==t.cKey&&(t.selectedMinHeaderColumn!=-1&&t.selectedMaxHeaderColumn!=-1?i.copyHeaderSelection(t.selectedHeaderContainer):i.copySelection(t.selectedContainer));t.ctrlDown&&n.keyCode==t.vKey&&(t.selectionCopied?i.pasteSelection(t.selectedContainer):t.selectionHeaderCopied&&i.pasteHeaderSelection(t.selectedHeaderContainer))};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.onDrop=function(n){var i=this.oBaseControl,e=i.oCalendar,t,f,r,u;if(this.setSingleSelectedObject($(n.target)),t=null,t=typeof n.srcElement!="undefined"?$(n.srcElement):$(n.originalEvent.target),typeof t.attr("data-IDMode")!="undefined")if(f=i.selectedEmployee.ProductiveUnitData.ProductiveUnit.UnitModes.find(function(n){return n.ID==parseInt(t.attr("data-IDMode"),10)}),typeof f!="undefined"){for(r={CostValue:parseFloat(t.attr("data-CostValue")),Coverage:0,HtmlColor:t.attr("data-HtmlColor"),ID:parseInt(t.attr("data-IDMode"),10),IDProductiveUnit:i.selectedEmployee.ProductiveUnitData.ProductiveUnit.ID,Name:t.attr("data-Name"),ShortName:t.attr("data-ShortName"),UnitModePositions:Object.clone(f.UnitModePositions)},u=0;u<r.UnitModePositions.length;u++)r.UnitModePositions[u].ID=-1;i.isBatchMode()?this.assignUnitModeToDayBatch(r):this.assignUnitModeToDay(i.selectedContainer,i.selectedDay,r)}else i.showErrorPopup("Error.Title","error","Calendar.Client.ModeNotAllowedForUnit","","Error.OK","Error.OKDesc",i.defaultMessageAction)};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.mapModeEvents=function(){var t=this,n=this.oBaseControl,i=n.viewRange==Robotics.Client.Constants.ViewRange.Daily?".calendarDailyBodyCell":".calendarOuterBodyCell";$(".fullCalendarShow").off("click");$(".fullCalendarShow").on("click",function(){var t="Scheduler/AnnualView.aspx?EmployeeID="+$(this).attr("data-IDEmployee")+"&Year="+n.firstDate.getFullYear();parent.ShowExternalForm2(t,950,560,"","",!0,!1,!1)});$(i+",.reviewDailyBodyCell").off("click");$(i+",.reviewDailyBodyCell").on("click",function(){n.shiftDown?t.selectMultiple(n.selectedContainer,this):t.setSingleSelectedObject(this)});$(".RecursiveAction").off("click");$(".RecursiveAction").on("click",function(){n.preparePUnitsDialog()});$(".FilterAction").off("click");$(".FilterAction").on("click",function(){n.hasChanges==!1?n.openFilterAssignments():n.showChangesWarning(n.clientInstanceName+".openFilterAssignments();")});$(i+",.reviewDailyBodyCell").off("dblclick");$(i+",.reviewDailyBodyCell").on("dblclick",function(){t.enterDetailAction(parseInt($(this).attr("data-IDPunit"),10),parseInt(n.employeeFilter,10),$(this).attr("data-Date"))});$(i).droppable({drop:function(n){return t.onDrop(n)}});try{$("#"+n.prefix+Robotics.Client.Constants.TableNames.Calendar+"_tbody").selectableScroll("destroy")}catch(r){}$("#"+n.prefix+Robotics.Client.Constants.TableNames.Calendar+"_tbody").selectableScroll({distance:10,filter:".calendarOuterBodyCell",stop:function(){t.endSelectOperation()},scrollElement:$("#"+n.prefix+Robotics.Client.Constants.LayoutNames.Calendar+" .fht-fixed-body .fht-tbody")});$(".CalendarDayFixedHeader").off("click");$(".CalendarDayFixedHeader").on("click",function(){n.shiftDown?t.selectHeaderMultiple(n.selectedHeaderContainer,this):t.setSingleHeaderSelectedObejct(this)});n.viewRange==Robotics.Client.Constants.ViewRange.Daily&&($("#"+n.prefix+"Main div.fht-fixed-body div.fht-tbody").scrollLeft((n.firstCellPrinted-46)*30),n.firstCellPrinted=-1);$(".tooltipDiv").each(function(){var n=this.id,t=n.replace("_tooltipInfo_","_calCell_");$("#"+n).dxTooltip({target:"#"+t,showEvent:{name:"mouseenter",delay:300},hideEvent:"mouseleave",position:"top"})});window.focus()};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.refreshModeTables=function(n,t,i){var r=this;n!=null&&(r=n instanceof Robotics.Client.Controls.roCalendar?n.clientMode:n);i&&(r.refreshCalendarTable(t),this.oBaseControl.mapEvents())};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.refreshCalendarTable=function(n){var t=this.oBaseControl;try{$("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).fixedHeaderTable("destroy");$("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).find("tfoot").each(function(){this.id==""&&$(this).remove()})}catch(i){}n||this.createResumeTables(Robotics.Client.Constants.TableNames.Calendar,Robotics.Client.Constants.LayoutNames.Calendar);this.fixedCalendarTable=$("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).fixedHeaderTable({altClass:"odd",footer:t.isScheduleActive,fixedColumn:!0})};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.createResumeTables=function(n,t){switch(n){case Robotics.Client.Constants.TableNames.Calendar:this.createCalendarTable(n,t)}};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.createCalendarTable=function(n,t){var r=this.oBaseControl,i=r.oCalendar,u,e,f;if(typeof i.CalendarShift!="undefined"&&i.CalendarShift!=null&&i.CalendarShift.length>0)for(r.shiftsExtendedDataCache={},u=0;u<i.CalendarShift.length;u++)typeof r.shiftsExtendedDataCache[i.CalendarShift[u].IDShift]=="undefined"&&(r.shiftsExtendedDataCache[i.CalendarShift[u].IDShift]=i.CalendarShift[u]);e=$("#"+r.prefix+t);e.empty();f=$("<table><\/table>").attr("id",r.prefix+n).attr("class","fancyTable");f.append(this.createCalendarTableHeader(n,t));f.append(this.createCalendarTableBody(n,t));e.append(f)};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.createCalendarTableHeader=function(n){var i=this.oBaseControl,r=i.oCalendar,h=$("<thead><\/thead>").attr("id",i.prefix+n+"_thead").attr("class","HeaderSelectable"),f=$("<tr><\/tr>"),p=$("<th><\/th>"),b=$("<div><\/div>").attr("class","BudgetFixed CalendarFixedHeader"),c=$("<div><\/div>").attr("class","CalendarBudgetFixed CalendarBudgetFixedHeader"),l=$("<div ><\/div>").attr("class","BudgetTitleFixed"),s,v,t,e,u,y;l.append($("<span><\/span>").attr("class","ProductiveUnitTextNorth").html(r.BudgetHeader.ProductiveUnitHeaderData.Row1Text));var a=$('<div"><\/div>').attr("class","BudgetActionsFixed"),o=$("<div><\/div>").attr("class","NorthCell NorthCellHeaderEmployee"),w=$("<div><\/div>").attr("class","RecursiveAction expandGroup").attr("title",i.loadIndictments?i.translator.translate(Robotics.Client.Language.Tags.Scheduler_Recursive):i.translator.translate(Robotics.Client.Language.Tags.Scheduler_NonRecursive));if(i.assignmentsFilter==""?o.append($("<div><\/div>").attr("class","EmpCellIconsNorth").append(w)):o.append($("<div><\/div>").attr("class","EmpCellIconsNorth").append("&nbsp;")),s=$("<div><\/div>").attr("class","SouthCell"),v=$("<div><\/div>").attr("class","FilterAction "+(i.assignmentsFilter==""?"filterGroup":"filter-activeGroup")).attr("title",i.translator.translate(Robotics.Client.Language.Tags.Scheduler_Filter)),s.append($("<div><\/div>").attr("class","EmpCellIconsSouth").append(v)),a.append(o,s),c.append(l,a),f.append(p.append(c)),i.viewRange==Robotics.Client.Constants.ViewRange.Daily)for(t=i.getMinDailyCell();t<i.getMaxDailyCell();t++)e=$("<th><\/th>"),u=$("<div><\/div>").attr("id",i.ascxPrefix+"_calHeaderCell_"+t).attr("class","CalendarDayFixed CalendarDayFixedHeader DailyCell").attr("data-IDColumn",t).attr("style","background:"+r.BudgetHeader.PeriodHeaderData[t].BackColor),u.append($("<div><\/div>").attr("class","NorthCell dayInfo DailyCell").html(r.BudgetHeader.PeriodHeaderData[t].Row2Text)),r.BudgetHeader.PeriodHeaderData[t].FeastDay&&u.append($("<div><\/div>").attr("class","columnIsFeast")),f.append(e.append(u));else for(t=0;t<r.BudgetHeader.PeriodHeaderData.length;t++)e=$("<th><\/th>"),u=$("<div><\/div>").attr("id",i.ascxPrefix+"_calHeaderCell_"+t).attr("class","CalendarDayFixed CalendarDayFixedHeader").attr("data-IDColumn",t).attr("style","background:"+r.BudgetHeader.PeriodHeaderData[t].BackColor),u.append($("<div><\/div>").attr("class","NorthCell dayInfo").html(r.BudgetHeader.PeriodHeaderData[t].Row1Text+"<\/br>"+r.BudgetHeader.PeriodHeaderData[t].Row2Text)),r.BudgetHeader.PeriodHeaderData[t].FeastDay&&u.append($("<div><\/div>").attr("class","columnIsFeast")),f.append(e.append(u));return y=$('<th style="width:100%"><\/th>').html("&nbsp;"),f.append(y),h.append(f),h};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.createCalendarTableBody=function(n){var o=this.oBaseControl,i=o.oCalendar,u=$("<tbody><\/tbody>").attr("id",o.prefix+n+"_tbody").attr("class","bodySelectable"),r,e,c,l;if(i.BudgetData!=null&&i.BudgetData.length>0)for(r=0;r<i.BudgetData.length;r++){var t=$("<tr><\/tr>"),s=$("<td><\/td>"),h=$("<div><\/div>").attr("class","BudgetFixed CalendarFixedHeader"),f=$("<div><\/div>").attr("class","CalendarBudgetFixed CalendarBudgetFixedBody");f.append($("<div><\/div>").attr("class","EmployeeName").attr("title",i.BudgetData[r].ProductiveUnitData.ProductiveUnit.Name).html(i.BudgetData[r].ProductiveUnitData.ProductiveUnit.Name));t.append(s.append(h.append(f)));this.buildDefinitionRowView(r,t);tmpCell=$('<td style="width:100%"><\/td>').html("&nbsp;");t.append(tmpCell);u.append(t)}else{var t=$("<tr><\/tr>"),s=$("<td><\/td>"),h=$("<div><\/div>").attr("class","BudgetFixed CalendarFixedHeader"),f=$("<div><\/div>").attr("class","CalendarBudgetFixed CalendarBudgetFixedHeader");for(t.append(s.append(h.append(f))),e=0;e<i.BudgetHeader.PeriodHeaderData.length;e++)c=$("<td><\/td>"),l=$("<div><\/div>").attr("class","calendarOuterBodyCellInOtherDepartment"),t.append(c.append(l));tmpCell=$('<td style="width:100%"><\/td>').html("&nbsp;");t.append(tmpCell);u.append(t)}return u};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.buildDefinitionRowView=function(n,t){for(var f=this.oBaseControl,r=f.oCalendar,e=r.BudgetData[n].ProductiveUnitData.ProductiveUnit,u=r.BudgetData[n].PeriodData.DayData,i=0;i<u.length;i++)t.append(this.createCalendarCell(e,u[i],n,i))};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.createCalendarCell=function(n,t,i,r){var f=this.oBaseControl,o=f.oCalendar,e=$("<td><\/td>"),u=$("<div><\/div>").attr("id",f.ascxPrefix+"_calCell_"+i+"_"+r);return t.ProductiveUnitStatus==Robotics.Client.Constants.ProductiveUnitStatusOnDay.Ok?(u.attr("class","calendarOuterBodyCell"),this.buildCalendarCellContent(u,t,i,r)):Robotics.Client.Constants.ProductiveUnitStatusOnDay.NoPlanned&&u.attr("class","calendarOuterBodyCell"),u.attr("data-IDPunit",n.ID),u.attr("data-IDRow",i).attr("data-IDColumn",r).attr("data-Date",moment(t.PlanDate).format("DD/MM/YYYY")),e.append(u)};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.buildCalendarCellContent=function(n,t,i,r){var f=this.oBaseControl,e=f.oCalendar,u=$("<div><\/div>").attr("class","calendarInnerBodyCell").html("&nbsp;");u.attr("style",this.generateGradientFromColor(t));pUnitModeContainer=this.generateModeDetailCell(t,t.ProductiveUnitMode,i,r);pUnitModeContainer==null&&(pUnitModeContainer=$("<div><\/div>").attr("class","calendarShiftInfoContainer"),pUnitModeContainer.attr("style","color:"+(new Robotics.Client.Common.roHtmlColor).invertCssColor("#FFFFFF")));u.append(pUnitModeContainer);n.append(u)};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.generateModeDetailCell=function(n,t,i,r){var o=this.oBaseControl,it=o.oCalendar,h=$("<div><\/div>").attr("class","calendarShiftInfoContainer pUnitModeWidth"),tt=t.HtmlColor,b=$("<div><\/div>"),rt=b.append($("<span class='fontBold'><\/span>").html(t.Name)),v,u,y,c,a,s,p,w,f,d,g,nt;for(h.append(b),v=$("<ul><\/ul>"),u=0;u<t.UnitModePositions.length;u++){y=t.UnitModePositions[u].Quantity+" "+t.UnitModePositions[u].AssignmentData.ShortName.toUpperCase()+" - "+t.UnitModePositions[u].ShiftData.ShortName.toUpperCase()+"";u==2&&t.UnitModePositions.length>3&&(y+="       ...");u<=2&&h.append($("<div><\/div>").append($("<span><\/span>").attr("class","fontMedium").html(y)));var k=0,l=0,e=t.UnitModePositions[u].ShiftData;if(e.ExistComplementaryData)for(f=0;f<e.ShiftLayers;f++)k+=e.ShiftLayersDefinition[f].LayerOrdinaryHours,l+=e.ShiftLayersDefinition[f].LayerComplementaryHours;if(c="",a="",c=e.ExistComplementaryData?o.ConvertHoursToHourFormat(k):o.ConvertHoursToHourFormat(e.PlannedHours),l>0&&(a=o.ConvertHoursToHourFormat(l)),s="",(c!=""||l>0)&&(s=c!=""?c:o.ConvertHoursToHourFormat(0)),a!=""&&(s=s+"-"+a),p="",e.Type!=Robotics.Client.Constants.ShiftType.Holiday&&e.Type!=Robotics.Client.Constants.ShiftType.Holiday_NonWorking&&s!="")for(w=s.split("-"),f=0;f<w.length;f++)d='<span class="fontBig"> '+(f===0?"HO:":"HC:")+w[f]+" <\/span>",p+=d;shiftDescription='<span class="fontBold fontBig">'+t.UnitModePositions[u].Quantity+" "+t.UnitModePositions[u].AssignmentData.Name+" - "+t.UnitModePositions[u].ShiftData.Name+'<\/span><span class="fontBig">['+moment(e.StartHour).format("HH:mm")+"]<\/span>";shiftDescription=shiftDescription+p;v.append($("<li><\/li>").html(shiftDescription))}return h.attr("style","color:"+(new Robotics.Client.Common.roHtmlColor).invertCssColor(tt)),g=$("<div><\/div>").attr("id",o.ascxPrefix+"_tooltipInfo_"+i+"_"+r).attr("class","tooltipDiv"),nt=$("<div><\/div>").html('<span class="fontBold fontBig">'+t.Name+"<\/span>"),h.append(g.append(nt,v)),h};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.generateGradientFromColor=function(n){var e=this.oBaseControl,o=e.oCalendar,t="#ffffff",i="#ffffff",u="100%",f="100%",r;return t=i=n.ProductiveUnitMode.HtmlColor,r="",r="background: "+t+";",r+="background: -moz-linear-gradient(-45deg, "+t+" 0%, "+t+" "+u+", "+i+" "+f+", "+i+" 100%);",r+="background: -webkit-gradient(left top, right bottom, color-stop(0%, "+t+"), color-stop("+u+", "+t+"), color-stop("+f+", "+i+"), color-stop(100%, "+i+"));",r+="background: -webkit-linear-gradient(-45deg, "+t+" 0%, "+t+" "+u+", "+i+" "+f+", "+i+" 100%);",r+="background: -o-linear-gradient(-45deg, "+t+" 0%, "+t+" "+u+", "+i+" "+f+", "+i+" 100%);",r+="background: -ms-linear-gradient(-45deg, "+t+" 0%, "+t+" "+u+", "+i+" "+f+", "+i+" 100%);",r+="background: linear-gradient(135deg, "+t+" 0%, "+t+" "+u+", "+i+" "+f+", "+i+" 100%);",r+('filter: progid:DXImageTransform.Microsoft.gradient( startColorstr="'+t+'", endColorstr="'+i+'", GradientType=1 );')};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.generateLoadFilters=function(){var n=this.oBaseControl,i=n.oCalendar,t={};return n.firstDate==null&&(n.firstDate=moment().startOf("month").toDate(),n.endDate=moment(n.firstDate).add(1,"month").subtract(1,"day").startOf("day").toDate()),t.firstDate=n.firstDate,t.endDate=n.endDate,t.orgChartFilter=n.employeeFilter!=""?n.employeeFilter:"-1",t.loadIndictments=!1,t.budget=null,t.typeView=n.typeView,t.pUnitFilter=n.assignmentsFilter,t.StampParam=(new Date).getMilliseconds(),t};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.loadData=function(n,t,i,r,u){var f=this.oBaseControl,e=f.oCalendar;f.hasChanges==!1?(f.refreshTimmer!=-1&&clearTimeout(f.refreshTimmer),f.refreshTimmer=-1,f.sortColumn=-1,typeof i!="undefined"&&i!=null&&(f.employeeFilter=i),typeof n!="undefined"&&n!=null&&(f.firstDate=n),typeof t!="undefined"&&t!=null&&(f.endDate=t),typeof r!="undefined"&&r!=null&&(f.typeView=r),typeof u!="undefined"&&u!=null&&(f.assignmentsFilter=u),f.refresh()):f.showChangesWarning("refreshBudget();")};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.saveChanges=function(){var t=this.oBaseControl,i=t.oCalendar,n={};n.budget=i;n.StampParam=(new Date).getMilliseconds();t.performAction(n,Robotics.Client.Constants.Actions.SaveBudgetChanges)};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.buildContextMenu=function(n){for(var t=this.oBaseControl,e=t.oCalendar,o=n[0].innerText,r=parseInt($(n).attr("data-IDRow"),10),u=parseInt($(n).attr("data-IDColumn"),10),f={},i=0;i<t.selectedEmployee.ProductiveUnitData.ProductiveUnit.UnitModes.length;i++)f["setMode"+i]={name:t.selectedEmployee.ProductiveUnitData.ProductiveUnit.UnitModes[i].Name,disabled:!1};return items={enter:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_Details),disabled:!1,icon:"detail"},split1:{name:"---------",disabled:!0},assignMode:{name:Globalize.formatMessage("roModesTitle"),disabled:!1,icon:"changeMode",items:f},reassign:{name:Globalize.formatMessage("roRefreshNode"),disabled:!1,icon:"refreshMode"},split2:{name:"---------",disabled:!0},copy:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_Copy),disabled:!1,icon:"copyShift"},split3:{name:"---------",disabled:!0},paste:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_Paste),disabled:!1,icon:"pasteShift"},advPaste:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_AdvPaste),disabled:!1,icon:"advPaste"},cancelSelection:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_CancelSelection),disabled:!1,icon:"cancelSelection"},split3:{name:"---------",disabled:!0},removeUnit:{name:Globalize.formatMessage("roDeleteRowMode"),disabled:!1,icon:"removeUnit"}},t.selectionCopied?(items.assignMode.disabled=!0,items.reassign.disabled=!0):(items.paste.disabled=!0,items.cancelSelection.disabled=!0,items.advPaste.disabled=!0),r>=t.selectedMinRow&&r<=t.selectedMaxRow&&u>=t.selectedMinColumn&&u<=t.selectedMaxColumn?(items.enter.disabled=!0,items.paste.disabled=!0,items.removeUnit.disabled=!0,items.advPaste.disabled=!0):t.selectionCopied&&(items.enter.disabled=!0,items.copy.disabled=!0,items.removeUnit.disabled=!0,(t.selectedMinRow!=t.selectedMaxRow||r!=t.selectedMinRow)&&(items.advPaste.disabled=!0,items.paste.disabled=!0)),t.hasChanges&&(items.removeUnit.disabled=!0),items};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.executeContextMenuAction=function(n,t){var i=this.oBaseControl,r=i.oCalendar;switch(n){case"enter":this.enterDetailAction(i.selectedEmployee.ProductiveUnitData.ProductiveUnit.ID,i.selectedEmployee.ProductiveUnitData.IDNode,moment(i.selectedDay.PlanDate).format("DD/MM/YYYY"));break;case"cancelSelection":this.cancelCurrentMultipleSelect(t,!0);break;case"copy":this.copySelection(t);break;case"paste":this.pasteSelection(t);break;case"removeUnit":this.removeSelectedProductiveUnit(t);break;case"reassign":this.refreshSelectedCellMode(n,t);break;case"advPaste":this.advancedPastePrepare(t);break;default:n.indexOf("setMode")==0&&this.assignContextMode(n,t)}};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.advancedPastePrepare=function(){var n=this.oBaseControl,t=n.oCalendar;n.hasChanges==!1?(n.advCopyManager.prepareForm(n.selectedMaxColumn-n.selectedMinColumn+1,n.selectedDay.PlanDate,Robotics.Client.Constants.TypeView.Definition),n.advCopyDialog.dialog("open")):n.showChangesWarning(n.clientInstanceName+".clientMode.advancedPastePrepare();")};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.cancelCurrentMultipleSelect=function(n,t){var i=this.oBaseControl,f=i.oCalendar,u,r;if(!i.selectionCopied||t){for(i.selectionCopied=!1,u=$(".calendarOuterBodyCell.ui-selected,.calendarDailyBodyCell.ui-selected"),r=0;r<u.length;r++)$(u[r]).removeClass("ui-selected");i.selectedMinRow=-1;i.selectedMaxRow=-1;i.selectedMinColumn=-1;i.selectedMaxColumn=-1}};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.cancelCurrentMultipleHeaderSelect=function(n,t){var i=this.oBaseControl,f=i.oCalendar,u,r;if(!i.selectionHeaderCopied||t){for(i.selectionHeaderCopied=!1,u=$(".CalendarDayFixedHeader.ui-selected"),r=0;r<u.length;r++)$(u[r]).removeClass("ui-selected");i.selectedMinHeaderColumn=-1;i.selectedMaxHeaderColumn=-1}};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.assignContextMode=function(n){var i=this.oBaseControl,e=i.oCalendar,f=parseInt(n.replace("setMode",""),10),t=i.selectedEmployee.ProductiveUnitData.ProductiveUnit.UnitModes[f],r,u;if(typeof t!="undefined"){for(r={CostValue:t.CostValue,Coverage:t.Coverage,HtmlColor:t.HtmlColor,ID:t.ID,IDProductiveUnit:t.IDProductiveUnit,Name:t.Name,ShortName:t.ShortName,UnitModePositions:Object.clone(t.UnitModePositions)},u=0;u<r.UnitModePositions.length;u++)r.UnitModePositions[u].ID=-1;this.assignUnitModeToDay(i.selectedContainer,i.selectedDay,r)}else i.showErrorPopup("Error.Title","error","Calendar.Client.ModeNotAllowedForUnit","","Error.OK","Error.OKDesc",i.defaultMessageAction)};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.refreshSelectedCellMode=function(){var t=this.oBaseControl,u=t.oCalendar,n=t.selectedEmployee.ProductiveUnitData.ProductiveUnit.UnitModes.find(function(n){return n.ID==t.selectedDay.ProductiveUnitMode.ID}),i,r;if(typeof n!="undefined"){for(i={CostValue:n.CostValue,Coverage:n.Coverage,HtmlColor:n.HtmlColor,ID:n.ID,IDProductiveUnit:n.IDProductiveUnit,Name:n.Name,ShortName:n.ShortName,UnitModePositions:Object.clone(n.UnitModePositions)},r=0;r<i.UnitModePositions.length;r++)i.UnitModePositions[r].ID=-1;this.assignUnitModeToDay(t.selectedContainer,t.selectedDay,i)}else t.showErrorPopup("Error.Title","error","Calendar.Client.ModeNotAllowedForUnit","","Error.OK","Error.OKDesc",t.defaultMessageAction)};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.pasteSelection=function(n){var t=this.oBaseControl,u=t.oCalendar,i=parseInt($(n).attr("data-IDRow"),10),r=parseInt($(n).attr("data-IDColumn"),10);this.pasteSelectionEnd(i,r)};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.pasteSelectionEnd=function(n,t){var i=this.oBaseControl,r=i.oCalendar,e,o,s,h,f,c;if(i.selectedMaxRow==i.selectedMinRow&&n==i.selectedMaxRow)for(e=0;e<=i.selectedMaxRow-i.selectedMinRow;e++)for(o=0;o<=i.selectedMaxColumn-i.selectedMinColumn;o++){var a=i.selectedMinRow+e,y=i.selectedMinColumn+o,u=n+e,l=t+o,v=null;for(v=i.viewRange!=Robotics.Client.Constants.ViewRange.Daily?r.BudgetData[a].PeriodData.DayData[y]:r.BudgetData[a].PeriodData.DayData[0],s=Object.clone(v.ProductiveUnitMode,!0),h=0;h<s.UnitModePositions.length;h++)s.UnitModePositions[h].ID=-1;f=!0;c=null;i.viewRange!=Robotics.Client.Constants.ViewRange.Daily?u<r.BudgetData.length&&l<r.BudgetData[u].PeriodData.DayData.length?(f=!0,c=r.BudgetData[u].PeriodData.DayData[l]):f=!1:u<r.BudgetData.length?(f=!0,c=r.BudgetData[u].PeriodData.DayData[0]):f=!1;f&&this.assignUnitModeToDay($("#"+i.ascxPrefix+"_calCell_"+u+"_"+l),c,s)}else i.isBatchMode()||i.showErrorPopup("Error.Title","error","Calendar.Client.RowChangeNotAllowed","","Error.OK","Error.OKDesc",i.defaultMessageAction)};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.copyHeaderSelection=function(n){var t=this.oBaseControl,r=t.oCalendar,i;(t.selectedMinHeaderColumn==-1||t.selectedMaxHeaderColumn==-1)&&n!=null&&(i=parseInt($(n).attr("data-IDColumn"),10),t.selectedMinHeaderColumn=t.selectedMaxHeaderColumn=i,$(n).addClass("ui-selected"));t.selectionHeaderCopied=!0};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.copySelection=function(n){var t=this.oBaseControl,u=t.oCalendar,i,r;(t.selectedMinRow==-1||t.selectedMaxRow==-1||t.selectedMinColumn==-1||t.selectedMaxColumn==-1)&&n!=null&&(i=parseInt($(n).attr("data-IDRow"),10),r=parseInt($(n).attr("data-IDColumn"),10),t.selectedMinRow=t.selectedMaxRow=i,t.selectedMinColumn=t.selectedMaxColumn=r,$(n).addClass("ui-selected"));t.selectionCopied=!0};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.removeSelectedProductiveUnitFinally=function(n){var t=this,i=this.oBaseControl,u=i.oCalendar,r=DevExpress.ui.dialog.confirm(Globalize.formatMessage("roDeleteUnitConfirm"),Globalize.formatMessage("roDeleteTitle"));r.done(function(i){i&&(t.idUnitSelected=n,showCaptcha(!0))})};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.finallyRemoveUnit=function(){var i=this,t=this.oBaseControl,r=t.oCalendar,n={};n.firstDate=t.firstDate;n.endDate=t.endDate;n.orgChartFilter=t.employeeFilter;n.pUnitFilter=i.idUnitSelected;n.StampParam=(new Date).getMilliseconds();t.performAction(n,Robotics.Client.Constants.Actions.DeleteBudgetRow)};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.removeSelectedProductiveUnit=function(){var n=this.oBaseControl,t=n.oCalendar;n.hasChanges==!1?this.removeSelectedProductiveUnitFinally(n.selectedEmployee.ProductiveUnitData.ProductiveUnit.ID):n.showChangesWarning(n.clientInstanceName+".clientMode.removeSelectedProductiveUnitFinally("+n.selectedEmployee.ProductiveUnitData.ProductiveUnit.ID+");")};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.enterDetailAction=function(n,t,i){var r=this.oBaseControl,u=r.oCalendar;r.hasChanges==!1?this.enterDetailActionFinally(n,t,i):r.showChangesWarning(r.clientInstanceName+".clientMode.enterDetailActionFinally("+n+","+t+",'"+i+"');")};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.enterDetailActionFinally=function(){var t=this.oBaseControl,i=t.oCalendar,n={};n.firstDate=t.selectedDay.PlanDate;n.endDate=t.selectedDay.PlanDate;n.loadIndictments=!1;n.orgChartFilter=t.employeeFilter;n.pUnitFilter=t.selectedDay.ProductiveUnitMode.IDProductiveUnit;n.StampParam=(new Date).getMilliseconds();t.performAction(n,Robotics.Client.Constants.Actions.GetBudgetHourPeriodDeinition)};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.buildHeaderContextMenu=function(n){var t=this.oBaseControl,i=t.oCalendar,r=n[0].innerText,u=parseInt($(n).attr("data-IDColumn"),10);return items={sort:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_Sort),disabled:!1,icon:"sort"}}};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.executeHeaderContextMenuAction=function(n,t){var i=this.oBaseControl,r=i.oCalendar;switch(n){case"sort":i.sortColumn=parseInt($(t).attr("data-IDColumn"),10);i.calendarSortDialog.dialog("open");break;case"cancelSelection":this.cancelCurrentMultipleHeaderSelect(t,!0)}};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.selectHeaderMultiple=function(n,t){var i=this.oBaseControl,e=i.oCalendar,r,u,f;if(n!=null&&i.viewRange!=Robotics.Client.Constants.ViewRange.Daily)for(r=parseInt($(n).attr("data-IDColumn"),10),u=parseInt($(t).attr("data-IDColumn"),10),this.cancelCurrentMultipleSelect(null,!1),r<=u?(i.selectedMinHeaderColumn=r,i.selectedMaxHeaderColumn=u):(i.selectedMinHeaderColumn=u,i.selectedMaxHeaderColumn=r),f=i.selectedMinHeaderColumn;f<=i.selectedMaxHeaderColumn;f++)$("#"+i.ascxPrefix+"_calHeaderCell_"+f).addClass("ui-selected")};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.selectMultiple=function(n,t){var i=this.oBaseControl,h=i.oCalendar,r,u;if(n!=null&&i.viewRange!=Robotics.Client.Constants.ViewRange.Daily){var f=parseInt($(n).attr("data-IDRow"),10),e=parseInt($(t).attr("data-IDRow"),10),o=parseInt($(n).attr("data-IDColumn"),10),s=parseInt($(t).attr("data-IDColumn"),10);for(this.cancelCurrentMultipleSelect(null,!1),f<=e?(i.selectedMinRow=f,i.selectedMaxRow=e):(i.selectedMinRow=e,i.selectedMaxRow=f),o<=s?(i.selectedMinColumn=o,i.selectedMaxColumn=s):(i.selectedMinColumn=s,i.selectedMaxColumn=o),r=i.selectedMinRow;r<=i.selectedMaxRow;r++)for(u=i.selectedMinColumn;u<=i.selectedMaxColumn;u++)$("#"+i.ascxPrefix+"_calCell_"+r+"_"+u).addClass("ui-selected")}};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.setSingleHeaderSelectedObejct=function(n){var t=this.oBaseControl,r=t.oCalendar,i;n!=null&&this.setSingleSelectedObject(null);t.selectedHeaderContainer!=null&&t.selectedHeaderContainer.removeClass("singleCellSelected");n==null?t.selectedHeaderContainer=null:(i=parseInt($(n).attr("data-IDColumn"),10),i>=t.selectedMinHeaderColumn&&i<=t.selectedMaxHeaderColumn||t.selectionHeaderCopied||(this.cancelCurrentMultipleSelect(n,!0),this.cancelCurrentMultipleHeaderSelect(n,!0)),t.selectedHeaderContainer=$(n),t.selectedHeaderContainer.addClass("singleCellSelected"))};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.setSingleSelectedObject=function(n){var t=this.oBaseControl,i=t.oCalendar,r,u;n!=null&&this.setSingleHeaderSelectedObejct(null);t.selectedContainer!=null&&t.selectedContainer.removeClass("singleCellSelected");n==null?(t.selectedEmployee=null,t.selectedDay=null,t.selectedContainer=null,this.OnSelectedCell!=null&&this.OnSelectedCell(null,null,null)):(r=parseInt($(n).attr("data-IDRow"),10),u=parseInt($(n).attr("data-IDColumn"),10),r>=t.selectedMinRow&&r<=t.selectedMaxRow&&u>=t.selectedMinColumn&&u<=t.selectedMaxColumn||t.selectionCopied||(this.cancelCurrentMultipleSelect(null,!1),this.cancelCurrentMultipleHeaderSelect(null,!1)),t.selectedEmployee=i.BudgetData[parseInt($(n).attr("data-IDRow"),10)],t.selectedDay=t.viewRange!=Robotics.Client.Constants.ViewRange.Daily?i.BudgetData[parseInt($(n).attr("data-IDRow"),10)].PeriodData.DayData[parseInt($(n).attr("data-IDColumn"),10)]:i.BudgetData[parseInt($(n).attr("data-IDRow"),10)].PeriodData.DayData[0],t.selectedContainer=$(n),t.selectedContainer.addClass("singleCellSelected"));this.OnSelectedCell!=null&&this.OnSelectedCell(t.selectedEmployee,t.selectedDay,t.selectedContainer)};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.endSelectOperation=function(n){var r=this.oBaseControl,s=r.oCalendar,i=$(".calendarOuterBodyCell.ui-selected"),t;this.cancelCurrentMultipleHeaderSelect(n,!0);this.setSingleHeaderSelectedObejct(null);this.setSingleSelectedObject(null);var u=0,f=0,e=0,o=0;for(t=0;t<i.length;t++)t==0?(u=parseInt($(i[t]).attr("data-IDRow"),10),f=parseInt($(i[t]).attr("data-IDRow"),10),e=parseInt($(i[t]).attr("data-IDColumn"),10),o=parseInt($(i[t]).attr("data-IDColumn"),10)):(parseInt($(i[t]).attr("data-IDRow"),10)<u&&(u=parseInt($(i[t]).attr("data-IDRow"),10)),parseInt($(i[t]).attr("data-IDRow"),10)>f&&(f=parseInt($(i[t]).attr("data-IDRow"),10)),parseInt($(i[t]).attr("data-IDColumn"),10)<e&&(e=parseInt($(i[t]).attr("data-IDColumn"),10)),parseInt($(i[t]).attr("data-IDColumn"),10)>o&&(o=parseInt($(i[t]).attr("data-IDColumn"),10)));r.selectedMinRow=u;r.selectedMaxRow=f;r.selectedMinColumn=e;r.selectedMaxColumn=o};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.endHeaderSelectOperation=function(n){var f=this.oBaseControl,e=f.oCalendar,i=$(".CalendarDayFixedHeader.ui-selected"),r,u,t;for(this.cancelCurrentMultipleSelect(n,!0),this.setSingleHeaderSelectedObejct(null),this.setSingleSelectedObject(null),r=0,u=0,t=0;t<i.length;t++)t==0?(r=parseInt($(i[t]).attr("data-IDColumn"),10),u=parseInt($(i[t]).attr("data-IDColumn"),10)):(parseInt($(i[t]).attr("data-IDColumn"),10)<r&&(r=parseInt($(i[t]).attr("data-IDColumn"),10)),parseInt($(i[t]).attr("data-IDColumn"),10)>u&&(u=parseInt($(i[t]).attr("data-IDColumn"),10)));f.selectedMinHeaderColumn=r;f.selectedMaxHeaderColumn=u};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.sortCalendar=function(){var n=this.oBaseControl,t=n.oCalendar,i=n.sortElements.split(",");t.CalendarData=t.CalendarData.sort(dynamicSortMultiple(i,n.viewRange==Robotics.Client.Constants.ViewRange.Daily?0:n.sortColumn));n.refreshTables(null,!1,!0);n.calendarSortDialog.dialog("close")};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.endCallback=function(action,objResult,objResultParams){var oCalendar=this.oBaseControl,oCalData=oCalendar.oCalendar;switch(action){case Robotics.Client.Constants.Actions.LoadBudget:case Robotics.Client.Constants.Actions.DiscardBudgetAndContinue:this.loadDataResponse(objResult,objResultParams);break;case Robotics.Client.Constants.Actions.SaveBudgetChangesAndContinue:case Robotics.Client.Constants.Actions.SaveBudgetChanges:this.saveChangesResponse(objResult,objResultParams);break;case Robotics.Client.Constants.Actions.GetNewBudgetRow:this.addBudgetRowToBudget(objResult,objResultParams);break;case Robotics.Client.Constants.Actions.DeleteBudgetRow:this.refresh();break;case Robotics.Client.Constants.Actions.GetBudgetHourPeriodDeinition:this.showBudgetHourPeriodDetail(objResult,objResultParams)}action!=Robotics.Client.Constants.Actions.DeleteBudgetRow&&this.loadingFunctionExtended(!1);(action==Robotics.Client.Constants.Actions.DiscardBudgetAndContinue||action==Robotics.Client.Constants.Actions.SaveBudgetChangesAndContinue)&&(eval(oCalendar.onContinueFunc),oCalendar.onContinueFunc="")};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.saveChangesResponse=function(){var n=this.oBaseControl,t=n.oCalendar;n.setHasChanges(!1);n.refreshTables(null,!1,!0)};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.loadDataResponse=function(n){var t=this.oBaseControl,i=t.oCalendar;t.viewRange=Robotics.Client.Constants.ViewRange.Period;t.initialize();t.oCalendar=n;t.setHasChanges(!1);t.refreshTables(null,!1,!0)};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.addBudgetRowToBudget=function(n){var t=this.oBaseControl,i=t.oCalendar;i.BudgetData.push(n.BudgetData[0]);t.setHasChanges(!0);t.refreshTables(null,!1,!0);t.pUnitsDialog.dialog("close")};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.showBudgetHourPeriodDetail=function(n){var t=this.oBaseControl,i=t.oCalendar;this.OnDayClick!=null&&this.OnDayClick(n,t.employeeFilter,t.selectedDay.PlanDate,t.selectedDay.ProductiveUnitMode,!1)};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.onAcceptPUnitsDialog=function(){for(var n=this.oBaseControl,r=n.oCalendar,u=parseInt(n.pUnitSelectorManager.getSelectedItem(),10),t=!1,i=0;i<r.BudgetData.length;i++)if(r.BudgetData[i].ProductiveUnitData.ProductiveUnit.ID==u){t=!0;break}parseInt(n.employeeFilter,10)>0&&!t?this.onAddNewRow():t?n.showErrorPopup("Error.Title","error","Calendar.Client.SelectOrgChartNode","","Error.OK","Error.OKDesc",n.defaultMessageAction):n.showErrorPopup("Error.Title","error","Calendar.Client.ProductiveUnitAlreadyExists","","Error.OK","Error.OKDesc",n.defaultMessageAction)};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.changeFilterAssignments=function(){for(var oCalendar=this.oBaseControl,oCalData=oCalendar.oCalendar,assignmentsGrid=eval(oCalendar.ascxPrefix+"_dlgFilterCalendar_grdAssignmentsClient"),selectedValues=assignmentsGrid.GetSelectedKeysOnPage(),calendarFilter="",i=0;i<selectedValues.length;i++)calendarFilter+=selectedValues[i]+",";calendarFilter!=""&&(calendarFilter=calendarFilter.substring(0,calendarFilter.length-1));oCalendar.assignmentsFilter=calendarFilter;oCalendar.setFiltersCookieValue();oCalendar.refresh()};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.preparePUnitsDialog=function(){var n=this.oBaseControl;n.pUnitsDialog.dialog("open")};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.onAddNewRow=function(){var t=this.oBaseControl,n={};n.firstDate=t.firstDate;n.endDate=t.endDate;n.orgChartFilter=t.employeeFilter;n.pUnitFilter=t.pUnitSelectorManager.getSelectedItem();n.StampParam=(new Date).getMilliseconds();t.performAction(n,Robotics.Client.Constants.Actions.GetNewBudgetRow)};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.saveAndContinue=function(){var t=this.oBaseControl,n={};n.budget=t.oCalendar;n.StampParam=(new Date).getMilliseconds();t.performAction(n,Robotics.Client.Constants.Actions.SaveBudgetChangesAndContinue)};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.discardAndContinue=function(){var n=this.oBaseControl,t=this.generateLoadFilters();n.performAction(t,Robotics.Client.Constants.Actions.DiscardBudgetAndContinue)};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.refresh=function(){var n=this.oBaseControl,t=this.generateLoadFilters();n.sortColumn=-1;n.performAction(t,Robotics.Client.Constants.Actions.LoadBudget)};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.getEmployeeCountResume=function(){var n=this.oBaseControl;return""};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.assignUnitModeToDayBatch=function(n){for(var f,t=this.oBaseControl,r=t.oCalendar,e=t.selectedMinRow;e<=t.selectedMaxRow;e++)for(f=t.selectedMinColumn;f<=t.selectedMaxColumn;f++){var i=e,o=f,u=!0,s=null;t.viewRange!=Robotics.Client.Constants.ViewRange.Daily?i<r.BudgetData.length&&o<r.BudgetData[i].PeriodData.DayData.length?(u=!0,s=r.BudgetData[i].PeriodData.DayData[o]):u=!1:i<r.BudgetData.length?(u=!0,s=r.BudgetData[i].PeriodData.DayData[0]):u=!1;u&&this.assignUnitModeToDay($("#"+t.ascxPrefix+"_calCell_"+i+"_"+o),s,n)}};Robotics.Client.Controls.roBudgetCalendarDefinition.prototype.assignUnitModeToDay=function(n,t,i){var r=this.oBaseControl,f=r.oCalendar,e,h;if(t.ProductiveUnitStatus==Robotics.Client.Constants.ProductiveUnitStatusOnDay.Ok||t.ProductiveUnitStatus==Robotics.Client.Constants.ProductiveUnitStatusOnDay.NoPlanned){var u=!0,o=parseInt($(n).attr("data-IDRow"),10),s=parseInt($(n).attr("data-IDColumn"),10),c=parseInt($(n).attr("data-IDPunit"),10);t.CanBeModified?moment(t.PlanDate)<=moment(f.FreezingDate)?(r.isBatchMode()||r.showErrorPopup("Error.Title","error","Calendar.Client.FreezeDate","","Error.OK","Error.OKDesc",r.defaultMessageAction),u=!1):moment(t.PlanDate)<=moment(f.FreezingDate)?(r.isBatchMode()||r.showErrorPopup("Error.Title","error","Calendar.Client.FreezeDate","","Error.OK","Error.OKDesc",r.defaultMessageAction),u=!1):c!=i.IDProductiveUnit&&(r.isBatchMode()||r.showErrorPopup("Error.Title","error","Calendar.Client.IncorrectProductiveUnit","","Error.OK","Error.OKDesc",r.defaultMessageAction),u=!1):(r.isBatchMode()||r.showErrorPopup("Error.Title","error","Calendar.Client.NoPermissionOrEmployeesAssigned","","Error.OK","Error.OKDesc",r.defaultMessageAction),u=!1);u&&(t.ProductiveUnitMode=Object.clone(i,!0),t.HasChanged=!0,t.ProductiveUnitStatus=Robotics.Client.Constants.ProductiveUnitStatusOnDay.Ok,r.setHasChanges(!0),f.BudgetData[parseInt(n.attr("data-idrow"),10)].RowState!=Robotics.Client.Constants.BudgetRowState.New&&(f.BudgetData[parseInt(n.attr("data-idrow"),10)].RowState=Robotics.Client.Constants.BudgetRowState.Updated),n.empty(),this.buildCalendarCellContent(n,t,o,s),e=r.ascxPrefix+"_tooltipInfo_"+o+"_"+s,h=e.replace("_tooltipInfo_","_calCell_"),$("#"+e).dxTooltip({target:"#"+h,showEvent:{name:"mouseenter",delay:300},hideEvent:"mouseleave",position:"top"}))}},function(){var n=function(n){for(var r=n.split("."),i=window,t=0;t<r.length;t+=1)i=i[r[t]]=i[r[t]]||{};return i};n("Robotics.Client.Controls");n("Robotics.Client.Language");n("Robotics.Client.Constants")}();Robotics.Client.Controls.roBudgetCalendarSchedule=function(n){this.name="Robotics.Client.Controls.roBudgetCalendarSchedule";this.oBaseControl=n;this.rowTableVisible=1;this.columnTableVisible=1;this.fixedCalendarTable=null;this.pageLayoutOptions={name:"pageLayout",resizable:!1,center__slidable:!1,center__closable:!1,center__paneSelector:"#"+this.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.Center,center__children:{name:"tabsContainerLayout",resizable:!1,center__slidable:!1,center__closable:!1,center__paneSelector:"#"+this.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.Calendar,center__onresize_start:this.onresize(this),center__onresize_end:this.onresize(this),south__paneSelector:"#"+this.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabs,south__slidable:!0,south__closable:!0,south__onopen:this.synchronizeContentLayout(!0,this),south__onclose:this.synchronizeContentLayout(!1,this),south__initClosed:!0,spacing_closed:25}};this.OnSelectedCell=null;this.OnDayClick=null;this.employeeAssignmentData=null};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.getLayout=function(){return this.pageLayoutOptions};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.setHasChanges=function(n){var u=this.oBaseControl,t=u.oCalendar,i,r;if(u.hasChanges=n,!u.hasChanges&&t!=null&&t.BudgetData!=null)for(i=0;i<t.BudgetData.length;i++)if(t.BudgetData[i].RowState=Robotics.Client.Constants.BudgetRowState.NoChanged,t.BudgetData[i].PeriodData.DayData!=null)for(r=0;r<t.BudgetData[i].PeriodData.DayData.length;r++)t.BudgetData[i].PeriodData.DayData[r].HasChanged=!1;try{hasChanges(n)}catch(f){}};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.create=function(){var n=this.oBaseControl,t=n.oCalendar;this.buildHTMLStructure();n.pageLayout=n.container.layout(this.pageLayoutOptions);$("#"+n.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabs).tabs()};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.buildHTMLStructure=function(){var n=this.oBaseControl,o=n.oCalendar,i=$("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.Center).attr("class","ui-layout-center"),f=$("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.Calendar).attr("class","ui-layout-center"),r=$("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabs).attr("class","ui-layout-south container tabs"),u=$("<ul><\/ul>").attr("id","tabbuttonsColumn"),e=$("<li><\/li>").attr("class","tab2").attr("style","cursor:pointer").append($("<a><\/a>").attr("href","#"+n.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabAssignments).html(Globalize.formatMessage("roAvailableEmployeeAssignments"))),t;u.append(e);t=$("<div><\/div>").attr("id","tabpanelsColumn").attr("style","border-top: 0");t.append($("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabAssignments).attr("class","container columnTableMain"));r.append(u,t);i.append(f,r);n.container.empty();n.container.append(i)};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.onresize=function(n){return function(){n.loadingFunctionExtended(!0);n.oBaseControl.refreshTables(n,!0,!0);n.loadingFunctionExtended(!1)}};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.synchronizeContentLayout=function(isShown,oScheduleCalendar){return function(){if(isShown){var oTmpCalendar=eval(oScheduleCalendar.oBaseControl.clientInstanceName+".clientMode.employeeAssignmentData");oTmpCalendar==null?oScheduleCalendar.loadEmployeeDetail():eval(oScheduleCalendar.oBaseControl.clientInstanceName+".clientMode.refreshColumnassignmentsTable();")}}};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.loadingFunctionExtended=function(n){var t=this.oBaseControl;(t.isShowingLoader&&!n||!t.isShowingLoader&&n)&&(t.isShowingLoader=n,n?$("#loadingCalendar").show():$("#loadingCalendar").hide(),t.loadingFunc(n))};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.getContextMenuSelector=function(){var t=this,n=this.oBaseControl;return n.viewRange==Robotics.Client.Constants.ViewRange.Daily?".calendarDailyBodyCell":".calendarOuterBodyCell"};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.getContextMenuHeaderSelector=function(){var n=this,t=this.oBaseControl;return".CalendarDayFixedHeader"};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.processKeyUpEvent=function(){var n=this;n.cancelCurrentMultipleSelect(null,!1);n.cancelCurrentMultipleHeaderSelect(null,!1)};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.processKeyDownEvent=function(n){var i=this,t=this.oBaseControl;t.ctrlDown&&n.keyCode==t.cKey&&(t.selectedMinHeaderColumn!=-1&&t.selectedMaxHeaderColumn!=-1?i.copyHeaderSelection(t.selectedHeaderContainer):i.copySelection(t.selectedContainer));t.ctrlDown&&n.keyCode==t.vKey&&(t.selectionCopied?i.pasteSelection(t.selectedContainer):t.selectionHeaderCopied&&i.pasteHeaderSelection(t.selectedHeaderContainer))};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.onDrop=function(n){var i=this.oBaseControl,e=i.oCalendar,t,f,r,u;if(this.setSingleSelectedObject($(n.target)),t=null,t=typeof n.srcElement!="undefined"?$(n.srcElement):$(n.originalEvent.target),typeof t.attr("data-IDMode")!="undefined")if(f=i.selectedEmployee.ProductiveUnitData.ProductiveUnit.UnitModes.find(function(n){return n.ID==parseInt(t.attr("data-IDMode"),10)}),typeof f!="undefined"){for(r={CostValue:parseFloat(t.attr("data-CostValue")),Coverage:0,HtmlColor:t.attr("data-HtmlColor"),ID:parseInt(t.attr("data-IDMode"),10),IDProductiveUnit:i.selectedEmployee.ProductiveUnitData.ProductiveUnit.ID,Name:t.attr("data-Name"),ShortName:t.attr("data-ShortName"),UnitModePositions:Object.clone(f.UnitModePositions)},u=0;u<r.UnitModePositions.length;u++)r.UnitModePositions[u].ID=-1;i.isBatchMode()?this.assignUnitModeToDayBatch(r):this.assignUnitModeToDay(i.selectedContainer,i.selectedDay,r)}else i.showErrorPopup("Error.Title","error","Calendar.Client.ModeNotAllowedForUnit","","Error.OK","Error.OKDesc",i.defaultMessageAction)};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.mapModeEvents=function(){var t=this,n=this.oBaseControl,i=n.viewRange==Robotics.Client.Constants.ViewRange.Daily?".calendarDailyBodyCell":".calendarOuterBodyCell";$(".fullCalendarShow").off("click");$(".fullCalendarShow").on("click",function(){var t="Scheduler/AnnualView.aspx?EmployeeID="+$(this).attr("data-IDEmployee")+"&Year="+n.firstDate.getFullYear();parent.ShowExternalForm2(t,950,560,"","",!0,!1,!1)});$(i+",.reviewDailyBodyCell").off("click");$(i+",.reviewDailyBodyCell").on("click",function(){n.shiftDown?t.selectMultiple(n.selectedContainer,this):t.setSingleSelectedObject(this)});$(".LoadIndictments").off("click");$(".LoadIndictments").on("click",function(){t.alterLoadIndictmentsModeAndReload()});$(".FilterAction").off("click");$(".FilterAction").on("click",function(){n.hasChanges==!1?n.openFilterAssignments():n.showChangesWarning(n.clientInstanceName+".openFilterAssignments();")});$(i+",.reviewDailyBodyCell").off("dblclick");$(i+",.reviewDailyBodyCell").on("dblclick",function(){t.enterDetailAction(parseInt($(this).attr("data-IDPunit"),10),parseInt(n.employeeFilter,10),$(this).attr("data-Date"))});$(i).droppable({drop:function(n){return t.onDrop(n)}});try{$("#"+n.prefix+Robotics.Client.Constants.TableNames.Calendar+"_tbody").selectableScroll("destroy")}catch(r){}$("#"+n.prefix+Robotics.Client.Constants.TableNames.Calendar+"_tbody").selectableScroll({distance:10,filter:".calendarOuterBodyCell",stop:function(){t.endSelectOperation()},scrollElement:$("#"+n.prefix+Robotics.Client.Constants.LayoutNames.Calendar+" .fht-fixed-body .fht-tbody")});$(".CalendarDayFixedHeader").off("click");$(".CalendarDayFixedHeader").on("click",function(){n.shiftDown?t.selectHeaderMultiple(n.selectedHeaderContainer,this):t.setSingleHeaderSelectedObejct(this)});n.viewRange==Robotics.Client.Constants.ViewRange.Daily&&($("#"+n.prefix+"Main div.fht-fixed-body div.fht-tbody").scrollLeft((n.firstCellPrinted-46)*30),n.firstCellPrinted=-1);$(".tooltipDiv").each(function(){var n=this.id,t=n.replace("_tooltipInfo_","_calCell_");$("#"+n).dxTooltip({target:"#"+t,showEvent:{name:"mouseenter",delay:300},hideEvent:"mouseleave",position:"top"})});$(".tooltipIndictmentsContainer").each(function(){var n=this.id,t=n.replace("_tooltipIndictmentsContainer_","_tooltipIndictments_");$("#"+n).dxTooltip({target:"#"+t,showEvent:{name:"mouseenter",delay:300},hideEvent:"mouseleave",position:"bottom"})});window.focus()};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.refreshModeTables=function(n,t,i){var r=this;n!=null&&(r=n instanceof Robotics.Client.Controls.roCalendar?n.clientMode:n);i&&r.refreshCalendarTable(t);t||r.oBaseControl.pageLayout.center.children.tabsContainerLayout.south.state.isClosed||r.refreshColumnassignmentsTable();i&&this.oBaseControl.mapEvents()};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.refreshCalendarTable=function(n){var t=this.oBaseControl;try{$("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).fixedHeaderTable("destroy");$("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).find("tfoot").each(function(){this.id==""&&$(this).remove()})}catch(i){}n||this.createResumeTables(Robotics.Client.Constants.TableNames.Calendar,Robotics.Client.Constants.LayoutNames.Calendar);this.fixedCalendarTable=$("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).fixedHeaderTable({altClass:"odd",footer:t.isScheduleActive,fixedColumn:!0})};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.refreshColumnassignmentsTable=function(){var n=this.oBaseControl;try{$("#"+n.prefix+Robotics.Client.Constants.TableNames.ColAssignments).fixedHeaderTable("destroy");$("#"+n.prefix+Robotics.Client.Constants.TableNames.ColAssignments).find("tfoot").each(function(){this.id==""&&$(this).remove()})}catch(t){}this.createResumeTables(Robotics.Client.Constants.TableNames.ColAssignments,Robotics.Client.Constants.LayoutNames.ColumnTabAssignments);$("#"+n.prefix+Robotics.Client.Constants.TableNames.ColAssignments).fixedHeaderTable({altClass:"odd",footer:!0,fixedColumn:!0});$("#"+n.prefix+Robotics.Client.Constants.TableNames.Calendar).parent().on("scroll",function(){$("#"+n.prefix+Robotics.Client.Constants.TableNames.ColAssignments).parent().scrollLeft($(this).scrollLeft())});$(".employeeTooltipDiv").each(function(){var n=this.id,t=n.replace("_EmployeeTooltipInfo_","_EmployeeAvailableCell_");$("#"+n).dxTooltip({target:"#"+t,showEvent:{name:"mouseenter",delay:300},hideEvent:"mouseleave",position:"top"})})};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.createResumeTables=function(n,t){switch(n){case Robotics.Client.Constants.TableNames.Calendar:this.createCalendarTable(n,t);break;case Robotics.Client.Constants.TableNames.ColAssignments:this.createColumnAssignmentsTable(n,t)}};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.createCalendarTable=function(n,t){var r=this.oBaseControl,i=r.oCalendar,u,e,f;if(typeof i.CalendarShift!="undefined"&&i.CalendarShift!=null&&i.CalendarShift.length>0)for(r.shiftsExtendedDataCache={},u=0;u<i.CalendarShift.length;u++)typeof r.shiftsExtendedDataCache[i.CalendarShift[u].IDShift]=="undefined"&&(r.shiftsExtendedDataCache[i.CalendarShift[u].IDShift]=i.CalendarShift[u]);e=$("#"+r.prefix+t);e.empty();f=$("<table><\/table>").attr("id",r.prefix+n).attr("class","fancyTable");f.append(this.createCalendarTableHeader(n,t));f.append(this.createCalendarTableBody(n,t));e.append(f)};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.createCalendarTableHeader=function(n){var b=this,i=this.oBaseControl,r=i.oCalendar,s=$("<thead><\/thead>").attr("id",i.prefix+n+"_thead").attr("class","HeaderSelectable"),f=$("<tr><\/tr>"),p=$("<th><\/th>"),k=$("<div><\/div>").attr("class","BudgetFixed CalendarFixedHeader"),h=$("<div><\/div>").attr("class","CalendarBudgetFixed CalendarBudgetFixedHeader"),c=$("<div ><\/div>").attr("class","BudgetTitleFixed"),o,v,t,e,u,y;c.append($("<span><\/span>").attr("class","ProductiveUnitTextNorth").html(r.BudgetHeader.ProductiveUnitHeaderData.Row1Text));var l=$('<div"><\/div>').attr("class","BudgetActionsFixed"),a=$("<div><\/div>").attr("class","NorthCell NorthCellHeaderEmployee"),w=$("<div><\/div>").attr("class","LoadIndictments "+(i.loadIndictments==!1?"showIndictments-inactive":"showIndictments-active")).attr("title",Globalize.formatMessage("roShowIndictments"));if(a.append($("<div><\/div>").attr("class","EmpCellIconsNorth").append(w)),o=$("<div><\/div>").attr("class","SouthCell"),v=$("<div><\/div>").attr("class","FilterAction "+(i.assignmentsFilter==""?"filterGroup":"filter-activeGroup")).attr("title",i.translator.translate(Robotics.Client.Language.Tags.Scheduler_Filter)),o.append($("<div><\/div>").attr("class","EmpCellIconsSouth").append(v)),l.append(a,o),h.append(c,l),f.append(p.append(h)),i.viewRange==Robotics.Client.Constants.ViewRange.Daily)for(t=i.getMinDailyCell();t<i.getMaxDailyCell();t++)e=$("<th><\/th>"),u=$("<div><\/div>").attr("id",i.ascxPrefix+"_calHeaderCell_"+t).attr("class","CalendarDayFixed CalendarDayFixedHeader DailyCell").attr("data-IDColumn",t).attr("style","background:"+r.BudgetHeader.PeriodHeaderData[t].BackColor),u.append($("<div><\/div>").attr("class","NorthCell dayInfo DailyCell").html(r.BudgetHeader.PeriodHeaderData[t].Row2Text)),r.BudgetHeader.PeriodHeaderData[t].FeastDay&&u.append($("<div><\/div>").attr("class","columnIsFeast")),f.append(e.append(u));else for(t=0;t<r.BudgetHeader.PeriodHeaderData.length;t++)e=$("<th><\/th>"),u=$("<div><\/div>").attr("id",i.ascxPrefix+"_calHeaderCell_"+t).attr("class","CalendarDayFixed CalendarDayFixedHeader").attr("data-IDColumn",t).attr("style","background:"+r.BudgetHeader.PeriodHeaderData[t].BackColor),u.append($("<div><\/div>").attr("class","NorthCell dayInfo").html(r.BudgetHeader.PeriodHeaderData[t].Row1Text+"<\/br>"+r.BudgetHeader.PeriodHeaderData[t].Row2Text)),r.BudgetHeader.PeriodHeaderData[t].FeastDay&&u.append($("<div><\/div>").attr("class","columnIsFeast")),f.append(e.append(u));return y=$('<th style="width:100%"><\/th>').html("&nbsp;"),f.append(y),s.append(f),s};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.createCalendarTableBody=function(n){var o=this.oBaseControl,i=o.oCalendar,u=$("<tbody><\/tbody>").attr("id",o.prefix+n+"_tbody").attr("class","bodySelectable"),r,e,c,l;if(i.BudgetData!=null&&i.BudgetData.length>0)for(r=0;r<i.BudgetData.length;r++){var t=$("<tr><\/tr>"),s=$("<td><\/td>"),h=$("<div><\/div>").attr("class","BudgetFixed CalendarFixedHeader"),f=$("<div><\/div>").attr("class","CalendarBudgetFixed CalendarBudgetFixedBody");f.append($("<div><\/div>").attr("class","EmployeeName").attr("title",i.BudgetData[r].ProductiveUnitData.ProductiveUnit.Name).html(i.BudgetData[r].ProductiveUnitData.ProductiveUnit.Name));t.append(s.append(h.append(f)));this.buildPlanificationRowView(r,t);tmpCell=$('<td style="width:100%"><\/td>').html("&nbsp;");t.append(tmpCell);u.append(t)}else{var t=$("<tr><\/tr>"),s=$("<td><\/td>"),h=$("<div><\/div>").attr("class","BudgetFixed CalendarFixedHeader"),f=$("<div><\/div>").attr("class","CalendarBudgetFixed CalendarBudgetFixedHeader");for(t.append(s.append(h.append(f))),e=0;e<i.BudgetHeader.PeriodHeaderData.length;e++)c=$("<td><\/td>"),l=$("<div><\/div>").attr("class","calendarOuterBodyCellInOtherDepartment"),t.append(c.append(l));tmpCell=$('<td style="width:100%"><\/td>').html("&nbsp;");t.append(tmpCell);u.append(t)}return u};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.buildPlanificationRowView=function(n,t){for(var f=this.oBaseControl,r=f.oCalendar,e=r.BudgetData[n].ProductiveUnitData.ProductiveUnit,u=r.BudgetData[n].PeriodData.DayData,i=0;i<u.length;i++)t.append(this.createCalendarCell(e,u[i],n,i))};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.createCalendarCell=function(n,t,i,r){var f=this.oBaseControl,o=f.oCalendar,e=$("<td><\/td>"),u=$("<div><\/div>").attr("id",f.ascxPrefix+"_calCell_"+i+"_"+r);return t.ProductiveUnitStatus==Robotics.Client.Constants.ProductiveUnitStatusOnDay.Ok?(u.attr("class","calendarOuterBodyCell"),this.buildCalendarCellContent(u,t,i,r)):Robotics.Client.Constants.ProductiveUnitStatusOnDay.NoPlanned&&u.attr("class","calendarOuterBodyCell"),u.attr("data-IDPunit",n.ID),u.attr("data-IDRow",i).attr("data-IDColumn",r).attr("data-Date",moment(t.PlanDate).format("DD/MM/YYYY")),e.append(u)};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.buildCalendarCellContent=function(n,t,i,r){var f=this.oBaseControl,e=f.oCalendar,u=$("<div><\/div>").attr("class","calendarInnerBodyCell").html("&nbsp;");u.attr("style",this.generateGradientFromColor(t));pUnitModeContainer=this.generateModeDetailCell(t,t.ProductiveUnitMode,i,r);pUnitModeContainer==null&&(pUnitModeContainer=$("<div><\/div>").attr("class","calendarShiftInfoContainer"),pUnitModeContainer.attr("style","color:"+(new Robotics.Client.Common.roHtmlColor).invertCssColor("#FFFFFF")));u.append(pUnitModeContainer);n.append(u)};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.generateModeDetailCell=function(n,t,i,r){var o=this.oBaseControl,pt=o.oCalendar,p=$("<div><\/div>").attr("class","calendarShiftInfoContainer pUnitModeWidth"),lt=t.HtmlColor,rt=$('<div style="float:left;width:67px;"><\/div>'),c,w,s,l,at,b,u,v,nt,h,y,d,a,tt,it,f,st,ht,ct;if(rt.append($("<span class='fontBold'><\/span>").html(t.Name)),c=$('<div style="float:right;"><\/div>'),t.Coverage!=100)if(t.Coverage>100){var g=t.Coverage-100,w=$("<div><\/div>").attr({"class":"overCoverageState"}),ut=$("<div><\/div>").attr({style:"height:"+g+"%;background-color:#1e571a;position: relative;top:"+(100-g)+"%;left: -1px;width: 21px;"});c.append(w.append(ut))}else{var g=100-t.Coverage,w=$("<div><\/div>").attr({"class":"overCoverageState"}),ut=$("<div><\/div>").attr({style:"max-height: 95%;height:"+g+"%;background-color:#ff0000;position: relative;width: 11px;border: 1px solid rgba(0, 0, 0, 0);"});c.append(w.append(ut))}else w=$("<div><\/div>").attr({"class":"coverageContainer"}),c.append(w.append($("<div><\/div>").attr({"class":"coverageOK"})));if(t.UnitModePositions.length>0){for(s=[],l=0;l<t.UnitModePositions.length;l++)for(at=t.UnitModePositions[l].Alerts,b=0;b<t.UnitModePositions[l].EmployeesData.length;b++)if(u=t.UnitModePositions[l].EmployeesData[b],u.Alerts!=null&&u.Alerts.OnAbsenceDays!=null&&u.Alerts.OnAbsenceDays&&s.push({employeeName:u.EmployeeName,indictment:{ErrorText:Globalize.formatMessage("roEmployeeAbsent")}}),u.Alerts!=null&&u.Alerts.Indictments!=null&&u.Alerts.Indictments.length>0)for(iInd=0;iInd<u.Alerts.Indictments.length;iInd++)s.push({employeeName:u.EmployeeName,indictment:Object.clone(u.Alerts.Indictments[iInd],!0)});if(s.length>0){var vt=$("<div><\/div>").attr("id",o.ascxPrefix+"_tooltipIndictments_"+i+"_"+r).attr("style","float:left;margin-top:20px;").attr("class","budgetMainDetailOnAbsence"),ft=$("<div><\/div>").attr("id",o.ascxPrefix+"_tooltipIndictmentsContainer_"+i+"_"+r).attr("class","tooltipIndictmentsContainer"),yt=$("<div><\/div>").html('<span class="fontBold fontBig" style="text-align:left">'+Globalize.formatMessage("roIndictmentsTitle")+"<\/span>"),et=$("<ul><\/ul>");for(v=0;v<s.length;v++)et.append($("<li><\/li>").html(s[v].employeeName+":"+s[v].indictment.ErrorText));ft.append(yt,et);c.append(vt,ft)}}for(p.append(rt,c),nt=$("<ul><\/ul>"),h=0;h<t.UnitModePositions.length;h++){var ot=0,k=0,e=t.UnitModePositions[h].ShiftData;if(e.ExistComplementaryData)for(f=0;f<e.ShiftLayers;f++)ot+=e.ShiftLayersDefinition[f].LayerOrdinaryHours,k+=e.ShiftLayersDefinition[f].LayerComplementaryHours;if(y="",d="",y=e.ExistComplementaryData?o.ConvertHoursToHourFormat(ot):o.ConvertHoursToHourFormat(e.PlannedHours),k>0&&(d=o.ConvertHoursToHourFormat(k)),a="",(y!=""||k>0)&&(a=y!=""?y:o.ConvertHoursToHourFormat(0)),d!=""&&(a=a+"-"+d),tt="",e.Type!=Robotics.Client.Constants.ShiftType.Holiday&&e.Type!=Robotics.Client.Constants.ShiftType.Holiday_NonWorking&&a!="")for(it=a.split("-"),f=0;f<it.length;f++)st='<span class="fontBig"> '+(f===0?"HO:":"HC:")+it[f]+" <\/span>",tt+=st;shiftDescription='<span class="fontBold fontBig">'+t.UnitModePositions[h].Quantity+" "+t.UnitModePositions[h].AssignmentData.Name+" - "+t.UnitModePositions[h].ShiftData.Name+'<\/span><span class="fontBig">['+moment(e.StartHour).format("HH:mm")+"]<\/span>";shiftDescription=shiftDescription+tt;nt.append($("<li><\/li>").html(shiftDescription))}return p.attr("style","color:"+(new Robotics.Client.Common.roHtmlColor).invertCssColor(lt)),ht=$("<div><\/div>").attr("id",o.ascxPrefix+"_tooltipInfo_"+i+"_"+r).attr("class","tooltipDiv"),ct=$("<div><\/div>").html('<span class="fontBold fontBig">'+t.Name+"<\/span>"),p.append(ht.append(ct,nt)),p};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.generateGradientFromColor=function(n){var e=this.oBaseControl,o=e.oCalendar,t="#ffffff",i="#ffffff",u="100%",f="100%",r;return t=i=n.ProductiveUnitMode.HtmlColor,r="",r="background: "+t+";",r+="background: -moz-linear-gradient(-45deg, "+t+" 0%, "+t+" "+u+", "+i+" "+f+", "+i+" 100%);",r+="background: -webkit-gradient(left top, right bottom, color-stop(0%, "+t+"), color-stop("+u+", "+t+"), color-stop("+f+", "+i+"), color-stop(100%, "+i+"));",r+="background: -webkit-linear-gradient(-45deg, "+t+" 0%, "+t+" "+u+", "+i+" "+f+", "+i+" 100%);",r+="background: -o-linear-gradient(-45deg, "+t+" 0%, "+t+" "+u+", "+i+" "+f+", "+i+" 100%);",r+="background: -ms-linear-gradient(-45deg, "+t+" 0%, "+t+" "+u+", "+i+" "+f+", "+i+" 100%);",r+="background: linear-gradient(135deg, "+t+" 0%, "+t+" "+u+", "+i+" "+f+", "+i+" 100%);",r+('filter: progid:DXImageTransform.Microsoft.gradient( startColorstr="'+t+'", endColorstr="'+i+'", GradientType=1 );')};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.createColumnAssignmentsTable=function(n,t){var r=this.oBaseControl,f=r.oCalendar,u,i;r.clientMode.employeeAssignmentData!=null?(u=$("#"+r.prefix+t),u.empty(),i=$("<table><\/table>").attr("id",r.prefix+n).attr("class","fancyColumnTable"),i.append(this.createEmptyColumnTableHeader(n,t)),i.append(this.createColumnAssignmentsTableBody(n,t)),i.append(this.createColumnAssignmentsTableFooter(n,t)),u.append(i)):this.loadEmployeeDetail()};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.createEmptyColumnTableHeader=function(n){var t=this.oBaseControl,h=t.oCalendar,o=$("<thead><\/thead>").attr("id",t.prefix+n+"_thead"),i=$("<tr><\/tr>"),c=$("<th><\/th>"),l=$("<div><\/div>").attr("class","CalendarFixed CalendarFixedHeader"),a=$("<div><\/div>").attr("class","CalendarEmployeeFixed CalendarEmployeeFixedHeader").attr("style","height:0px"),f,e,r,u,s;if(i.append(c.append(l.append(a))),t.viewRange==Robotics.Client.Constants.ViewRange.Daily)for(f=t.getMinDailyCell();f<t.getMaxDailyCell();f++)r=$("<th><\/th>"),u=$("<div><\/div>").attr("class","CalendarDayFixed CalendarDayFixedHeader DailyCell").attr("style","height:0px"),i.append(r.append(u));else for(e=0;e<h.BudgetHeader.PeriodHeaderData.length;e++)r=$("<th><\/th>"),u=$("<div><\/div>").attr("class","CalendarDayFixed CalendarDayFixedHeader").attr("style","height:0px"),i.append(r.append(u));return s=$('<th style="width:100%"><\/th>').attr("style","height:0px"),i.append(s),o.append(i),o};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.createColumnAssignmentsTableBody=function(n){var t=this,i=this.oBaseControl,u=i.oCalendar,f=$("<tbody><\/tbody>").attr("id",i.prefix+n+"_tbody"),e=i,r=0;return Object.keys(t.employeeAssignmentData.assignmentKeys).forEach(function(n){var s=$("<tr><\/tr>").attr("class","shiftColumnRow"),nt=$("<td><\/td>"),p=$("<div><\/div>").attr("class","CalendarShiftsFixed CalendarShiftFixedBody"),c,b,e,k,o,y,l,d,a,g;p.append($("<div><\/div>").attr("class","CalendarShiftContentFixedBody").html('<span style="font-weight:bold">'+t.employeeAssignmentData.assignmentKeys[n].Name+"<\/span>"));s.append(nt.append(p));var w=null,h=null,v=0;for(c=0;c<u.BudgetHeader.PeriodHeaderData.length;c++){if(w=$("<td><\/td>"),h=$("<div><\/div>").attr("class","ColumnShiftTableBodyCell"),b="",e=moment(u.BudgetHeader.PeriodHeaderData[c].Row2Text,"DD/MM/YYYY").format("YYYYMMDD"),typeof t.employeeAssignmentData.tableData[e]!="undefined"){for(k=typeof t.employeeAssignmentData.tableData[e].Assignments[n]=="undefined"?"0":t.employeeAssignmentData.tableData[e].Assignments[n].Counter,h.append($("<div><\/div>").attr("id",i.ascxPrefix+"_EmployeeAvailableCell_"+r+"_"+v).attr("class","ContentShiftsColumnCell").attr("style",b).html(k)),o=[],typeof t.employeeAssignmentData.tableData[e].Assignments[n]!="undefined"&&(o=t.employeeAssignmentData.tableData[e].Assignments[n].EmployeesData),y=$("<ul><\/ul>"),l=0;l<o.length;l++)d='<span class="fontBold fontBig">'+o[l].EmployeeName+"<\/span>",y.append($("<li><\/li>").html(d));a=$("<div><\/div>").attr("id",i.ascxPrefix+"_EmployeeTooltipInfo_"+r+"_"+v).attr("class","employeeTooltipDiv");g=$("<div><\/div>").html('<span class="fontBold fontBig">'+Globalize.formatMessage("roNoAvailableEmployeeAssignments")+"<\/span>");o.length>0?a.append(y):a.append(g);h.append(a)}s.append(w.append(h));v+=1}tmpCell=$('<td style="width:100%"><\/td>').html("&nbsp;");s.append(tmpCell);f.append(s);r+=1}),f};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.createColumnAssignmentsTableFooter=function(n){var s=this,r=this.oBaseControl,v=r.oCalendar,h=$("<tfoot><\/tfoot>").attr("id",r.prefix+n+"_tfoot"),u=r,i=$("<tr><\/tr>").attr("class","shiftColumnRow"),y=$("<td><\/td>"),c=$("<div><\/div>").attr("class","CalendarShiftsFixed CalendarShiftFixedBody"),t,o;c.append($("<div><\/div>").attr("class","CalendarShiftContentFixedBody").html("&nbsp;"));i.append(y.append(c));var f=null,l=0,a=null,e=null;for(t=0;t<v.BudgetHeader.PeriodHeaderData.length;t++)f=u.oCalendar.BudgetHeader.PeriodHeaderData[t].Row1Text+"_"+u.oCalendar.BudgetHeader.PeriodHeaderData[t].Row2Text,f=f.replace(":","_"),a=$("<td><\/td>"),e=$("<div><\/div>").attr("class","ColumnShiftTableBodyCell totalRowBackground"),o=moment(u.oCalendar.BudgetHeader.PeriodHeaderData[t].Row2Text,"DD/MM/YYYY").format("YYYYMMDD"),l=typeof s.employeeAssignmentData.tableData[o]!="undefined"?s.employeeAssignmentData.tableData[o].Total:"0",e.append($("<div><\/div>").attr("class","ContentShiftsColumnCell").html(Math.round(l*100)/100)),i.append(a.append(e));return tmpCell=$('<td style="width:100%"><\/td>').attr("class","totalRowBackground").html("&nbsp;"),i.append(tmpCell),h.append(i),h};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.generateLoadFilters=function(){var n=this.oBaseControl,i=n.oCalendar,t={};return n.firstDate==null&&(n.firstDate=moment().startOf("month").toDate(),n.endDate=moment(n.firstDate).add(1,"month").subtract(1,"day").startOf("day").toDate()),t.firstDate=n.firstDate,t.endDate=n.endDate,t.orgChartFilter=n.employeeFilter!=""?n.employeeFilter:"-1",t.loadIndictments=n.loadIndictments,t.budget=null,t.typeView=n.typeView,t.pUnitFilter=n.assignmentsFilter,t.StampParam=(new Date).getMilliseconds(),t};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.alterLoadIndictmentsModeAndReload=function(){var t=this,n=this.oBaseControl;n.loadIndictments=n.loadIndictments==!1?!0:!1;n.setFiltersCookieValue();t.loadData()};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.loadData=function(n,t,i,r,u,f){var o=this,e=this.oBaseControl,s=e.oCalendar;e.hasChanges==!1?(e.refreshTimmer!=-1&&clearTimeout(e.refreshTimmer),e.refreshTimmer=-1,e.sortColumn=-1,typeof f!="undefined"&&f!=null&&(e.loadIndictments=f),typeof i!="undefined"&&i!=null&&(e.employeeFilter=i),typeof n!="undefined"&&n!=null&&(e.firstDate=n),typeof t!="undefined"&&t!=null&&(e.endDate=t),typeof r!="undefined"&&r!=null&&(e.typeView=r),typeof u!="undefined"&&u!=null&&(e.assignmentsFilter=u),e.refresh()):e.showChangesWarning("refreshBudget();")};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.saveChanges=function(){var t=this.oBaseControl,i=t.oCalendar,n={};n.budget=i;n.StampParam=(new Date).getMilliseconds();t.performAction(n,Robotics.Client.Constants.Actions.SaveBudgetChanges)};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.runAIPlanner=function(){var t=this.oBaseControl,i=t.oCalendar,n={};n.budget=i;n.StampParam=(new Date).getMilliseconds();t.performAction(n,Robotics.Client.Constants.Actions.RunAIPlanner)};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.cleanAIPlanner=function(){var t=this.oBaseControl,i=t.oCalendar,n={};n.budget=i;n.StampParam=(new Date).getMilliseconds();t.performAction(n,Robotics.Client.Constants.Actions.CleanAIPlanner)};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.buildContextMenu=function(n){var t=this.oBaseControl,s=t.oCalendar,h=n[0].innerText,f=parseInt($(n).attr("data-IDRow"),10),o=parseInt($(n).attr("data-IDColumn"),10),e={},u,r,i;if(typeof t.selectedDay.ProductiveUnitMode!="undefined")for(u=0;u<t.selectedDay.ProductiveUnitMode.UnitModePositions.length;u++)for(r=t.selectedDay.ProductiveUnitMode.UnitModePositions[u],i=0;i<r.EmployeesData.length;i++)r.EmployeesData[i].IDEmployee>0&&(e["delEmployee_"+r.EmployeesData[i].IDEmployee]={name:r.EmployeesData[i].EmployeeName,disabled:!1,icon:"removeEmp"});return items={enter:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_Details),disabled:!1,icon:"detail"},split1:{name:"---------",disabled:!0},copy:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_Copy),disabled:!1,icon:"copyShift"},advPaste:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_AdvPaste),disabled:!1,icon:"advPaste"},cancelSelection:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_CancelSelection),disabled:!1,icon:"cancelSelection"},split2:{name:"---------",disabled:!0},removeEmployee:{name:Globalize.formatMessage("roRemoveEmployee"),disabled:!1,icon:"removeEmpMenu",items:e}},Object.keys(e).length==0&&(items.removeEmployee.disabled=!0),typeof t.selectedDay.ProductiveUnitMode=="undefined"&&(items.enter.disabled=!0,items.copy.disabled=!0),t.selectionCopied||(items.advPaste.disabled=!0,items.cancelSelection.disabled=!0),f>=t.selectedMinRow&&f<=t.selectedMaxRow&&o>=t.selectedMinColumn&&o<=t.selectedMaxColumn?(items.enter.disabled=!0,items.advPaste.disabled=!0):t.selectionCopied&&(items.enter.disabled=!0,items.copy.disabled=!0,(t.selectedMinRow!=t.selectedMaxRow||f!=t.selectedMinRow)&&(items.advPaste.disabled=!0)),items};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.executeContextMenuAction=function(n,t){var i=this.oBaseControl,r=i.oCalendar;switch(n){case"enter":this.enterDetailAction(i.selectedEmployee.ProductiveUnitData.ProductiveUnit.ID,i.selectedEmployee.ProductiveUnitData.IDNode,moment(i.selectedDay.PlanDate).format("DD/MM/YYYY"));break;case"cancelSelection":this.cancelCurrentMultipleSelect(t,!0);break;case"copy":this.copySelection(t);break;case"advPaste":this.advancedPastePrepare(t);break;default:n.indexOf("delEmployee_")==0&&this.removeEmployeeFromMenu(n,t)}};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.removeEmployeeFromMenu=function(n){var t=this.oBaseControl,u=t.oCalendar,i=parseInt(n.replace("delEmployee_",""),10),r=DevExpress.ui.dialog.confirm(Globalize.formatMessage("roUnassignEmployeeConfirmation"),Globalize.formatMessage("roDeleteTitle"));r.done(function(n){var o,s,e,u,f,r;if(n){for(o=null,s=null,e=0;e<t.selectedDay.ProductiveUnitMode.UnitModePositions.length;e++)for(u=t.selectedDay.ProductiveUnitMode.UnitModePositions[e],f=0;f<u.EmployeesData.length;f++)u.EmployeesData[f].IDEmployee==i&&(o=u.EmployeesData[f],s=u);r={};r.orgChartFilter=parseInt(t.employeeFilter,10);r.pUnitModePosition=s;r.firstDate=t.selectedDay.PlanDate;r.employeeData=[o];r.StampParam=(new Date).getMilliseconds();t.performAction(r,Robotics.Client.Constants.Actions.RemoveEmployeeFromPosition)}})};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.cancelCurrentMultipleSelect=function(n,t){var i=this.oBaseControl,f=i.oCalendar,u,r;if(!i.selectionCopied||t){for(i.selectionCopied=!1,u=$(".calendarOuterBodyCell.ui-selected,.calendarDailyBodyCell.ui-selected"),r=0;r<u.length;r++)$(u[r]).removeClass("ui-selected");i.selectedMinRow=-1;i.selectedMaxRow=-1;i.selectedMinColumn=-1;i.selectedMaxColumn=-1}};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.cancelCurrentMultipleHeaderSelect=function(n,t){var i=this.oBaseControl,f=i.oCalendar,u,r;if(!i.selectionHeaderCopied||t){for(i.selectionHeaderCopied=!1,u=$(".CalendarDayFixedHeader.ui-selected"),r=0;r<u.length;r++)$(u[r]).removeClass("ui-selected");i.selectedMinHeaderColumn=-1;i.selectedMaxHeaderColumn=-1}};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.advancedPastePrepare=function(){var n=this.oBaseControl,t=n.oCalendar;n.hasChanges==!1?(n.advCopyManager.prepareForm(n.selectedMaxColumn-n.selectedMinColumn+1,n.selectedDay.PlanDate,Robotics.Client.Constants.TypeView.Planification),n.advCopyDialog.dialog("open")):n.showChangesWarning(oCal.clientInstanceName+".advancedPastePrepare();")};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.copyHeaderSelection=function(n){var t=this.oBaseControl,r=t.oCalendar,i;(t.selectedMinHeaderColumn==-1||t.selectedMaxHeaderColumn==-1)&&n!=null&&(i=parseInt($(n).attr("data-IDColumn"),10),t.selectedMinHeaderColumn=t.selectedMaxHeaderColumn=i,$(n).addClass("ui-selected"));t.selectionHeaderCopied=!0};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.copySelection=function(n){var t=this.oBaseControl,u=t.oCalendar,i,r;(t.selectedMinRow==-1||t.selectedMaxRow==-1||t.selectedMinColumn==-1||t.selectedMaxColumn==-1)&&n!=null&&(i=parseInt($(n).attr("data-IDRow"),10),r=parseInt($(n).attr("data-IDColumn"),10),t.selectedMinRow=t.selectedMaxRow=i,t.selectedMinColumn=t.selectedMaxColumn=r,$(n).addClass("ui-selected"));t.selectionCopied=!0};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.enterDetailAction=function(n,t,i){var r=this.oBaseControl,u=r.oCalendar;r.hasChanges==!1?this.enterDetailActionFinally(n,t,i):r.showChangesWarning(r.clientInstanceName+".clientMode.enterDetailActionFinally("+n+","+t+",'"+i+"');")};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.enterDetailActionFinally=function(){var t=this.oBaseControl,n={};n.firstDate=t.selectedDay.PlanDate;n.endDate=t.selectedDay.PlanDate;n.loadIndictments=t.loadIndictments;n.orgChartFilter=t.employeeFilter;n.pUnitFilter=t.selectedDay.ProductiveUnitMode.IDProductiveUnit;n.StampParam=(new Date).getMilliseconds();t.performAction(n,Robotics.Client.Constants.Actions.GetBudgetHourPeriodDeinition)};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.showBudgetHourPeriodDetail=function(n){var t=this.oBaseControl,i=t.oCalendar;this.OnDayClick!=null&&this.OnDayClick(n,t.employeeFilter,t.selectedDay.PlanDate,t.selectedDay.ProductiveUnitMode,t.loadIndictments)};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.buildHeaderContextMenu=function(n){var t=this.oBaseControl,i=t.oCalendar,r=n[0].innerText,u=parseInt($(n).attr("data-IDColumn"),10);return items={sort:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_Sort),disabled:!1,icon:"sort"}}};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.executeHeaderContextMenuAction=function(n,t){var i=this.oBaseControl,r=i.oCalendar;switch(n){case"sort":i.sortColumn=parseInt($(t).attr("data-IDColumn"),10);i.calendarSortDialog.dialog("open");break;case"cancelSelection":this.cancelCurrentMultipleHeaderSelect(t,!0)}};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.selectHeaderMultiple=function(n,t){var i=this.oBaseControl,e=i.oCalendar,r,u,f;if(n!=null&&i.viewRange!=Robotics.Client.Constants.ViewRange.Daily)for(r=parseInt($(n).attr("data-IDColumn"),10),u=parseInt($(t).attr("data-IDColumn"),10),this.cancelCurrentMultipleSelect(null,!1),r<=u?(i.selectedMinHeaderColumn=r,i.selectedMaxHeaderColumn=u):(i.selectedMinHeaderColumn=u,i.selectedMaxHeaderColumn=r),f=i.selectedMinHeaderColumn;f<=i.selectedMaxHeaderColumn;f++)$("#"+i.ascxPrefix+"_calHeaderCell_"+f).addClass("ui-selected")};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.selectMultiple=function(n,t){var i=this.oBaseControl,h=i.oCalendar,r,u;if(n!=null&&i.viewRange!=Robotics.Client.Constants.ViewRange.Daily){var f=parseInt($(n).attr("data-IDRow"),10),e=parseInt($(t).attr("data-IDRow"),10),o=parseInt($(n).attr("data-IDColumn"),10),s=parseInt($(t).attr("data-IDColumn"),10);for(this.cancelCurrentMultipleSelect(null,!1),f<=e?(i.selectedMinRow=f,i.selectedMaxRow=e):(i.selectedMinRow=e,i.selectedMaxRow=f),o<=s?(i.selectedMinColumn=o,i.selectedMaxColumn=s):(i.selectedMinColumn=s,i.selectedMaxColumn=o),r=i.selectedMinRow;r<=i.selectedMaxRow;r++)for(u=i.selectedMinColumn;u<=i.selectedMaxColumn;u++)$("#"+i.ascxPrefix+"_calCell_"+r+"_"+u).addClass("ui-selected")}};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.setSingleHeaderSelectedObejct=function(n){var t=this.oBaseControl,r=t.oCalendar,i;n!=null&&this.setSingleSelectedObject(null);t.selectedHeaderContainer!=null&&t.selectedHeaderContainer.removeClass("singleCellSelected");n==null?t.selectedHeaderContainer=null:(i=parseInt($(n).attr("data-IDColumn"),10),i>=t.selectedMinHeaderColumn&&i<=t.selectedMaxHeaderColumn||t.selectionHeaderCopied||(this.cancelCurrentMultipleSelect(n,!0),this.cancelCurrentMultipleHeaderSelect(n,!0)),t.selectedHeaderContainer=$(n),t.selectedHeaderContainer.addClass("singleCellSelected"))};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.setSingleSelectedObject=function(n){var t=this.oBaseControl,i=t.oCalendar,r,u;n!=null&&this.setSingleHeaderSelectedObejct(null);t.selectedContainer!=null&&t.selectedContainer.removeClass("singleCellSelected");n==null?(t.selectedEmployee=null,t.selectedDay=null,t.selectedContainer=null,this.OnSelectedCell!=null&&this.OnSelectedCell(null,null,null)):(r=parseInt($(n).attr("data-IDRow"),10),u=parseInt($(n).attr("data-IDColumn"),10),r>=t.selectedMinRow&&r<=t.selectedMaxRow&&u>=t.selectedMinColumn&&u<=t.selectedMaxColumn||t.selectionCopied||(this.cancelCurrentMultipleSelect(null,!1),this.cancelCurrentMultipleHeaderSelect(null,!1)),t.selectedEmployee=i.BudgetData[parseInt($(n).attr("data-IDRow"),10)],t.selectedDay=t.viewRange!=Robotics.Client.Constants.ViewRange.Daily?i.BudgetData[parseInt($(n).attr("data-IDRow"),10)].PeriodData.DayData[parseInt($(n).attr("data-IDColumn"),10)]:i.BudgetData[parseInt($(n).attr("data-IDRow"),10)].PeriodData.DayData[0],t.selectedContainer=$(n),t.selectedContainer.addClass("singleCellSelected"));this.OnSelectedCell!=null&&this.OnSelectedCell(t.selectedEmployee,t.selectedDay,t.selectedContainer)};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.endSelectOperation=function(n){var r=this.oBaseControl,s=r.oCalendar,i=$(".calendarOuterBodyCell.ui-selected"),t;this.cancelCurrentMultipleHeaderSelect(n,!0);this.setSingleHeaderSelectedObejct(null);this.setSingleSelectedObject(null);var u=0,f=0,e=0,o=0;for(t=0;t<i.length;t++)t==0?(u=parseInt($(i[t]).attr("data-IDRow"),10),f=parseInt($(i[t]).attr("data-IDRow"),10),e=parseInt($(i[t]).attr("data-IDColumn"),10),o=parseInt($(i[t]).attr("data-IDColumn"),10)):(parseInt($(i[t]).attr("data-IDRow"),10)<u&&(u=parseInt($(i[t]).attr("data-IDRow"),10)),parseInt($(i[t]).attr("data-IDRow"),10)>f&&(f=parseInt($(i[t]).attr("data-IDRow"),10)),parseInt($(i[t]).attr("data-IDColumn"),10)<e&&(e=parseInt($(i[t]).attr("data-IDColumn"),10)),parseInt($(i[t]).attr("data-IDColumn"),10)>o&&(o=parseInt($(i[t]).attr("data-IDColumn"),10)));r.selectedMinRow=u;r.selectedMaxRow=f;r.selectedMinColumn=e;r.selectedMaxColumn=o};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.endHeaderSelectOperation=function(n){var f=this.oBaseControl,e=f.oCalendar,i=$(".CalendarDayFixedHeader.ui-selected"),r,u,t;for(this.cancelCurrentMultipleSelect(n,!0),this.setSingleHeaderSelectedObejct(null),this.setSingleSelectedObject(null),r=0,u=0,t=0;t<i.length;t++)t==0?(r=parseInt($(i[t]).attr("data-IDColumn"),10),u=parseInt($(i[t]).attr("data-IDColumn"),10)):(parseInt($(i[t]).attr("data-IDColumn"),10)<r&&(r=parseInt($(i[t]).attr("data-IDColumn"),10)),parseInt($(i[t]).attr("data-IDColumn"),10)>u&&(u=parseInt($(i[t]).attr("data-IDColumn"),10)));f.selectedMinHeaderColumn=r;f.selectedMaxHeaderColumn=u};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.sortCalendar=function(){var n=this.oBaseControl,t=n.oCalendar,i=n.sortElements.split(",");t.CalendarData=t.CalendarData.sort(dynamicSortMultiple(i,n.viewRange==Robotics.Client.Constants.ViewRange.Daily?0:n.sortColumn));n.refreshTables(null,!1,!0);n.calendarSortDialog.dialog("close")};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.endCallback=function(action,objResult,objResultParams){var oClientMode=this,oCalendar=this.oBaseControl,oCalData=oCalendar.oCalendar;switch(action){case Robotics.Client.Constants.Actions.LoadBudget:case Robotics.Client.Constants.Actions.DiscardBudgetAndContinue:this.loadDataResponse(objResult,objResultParams);break;case Robotics.Client.Constants.Actions.SaveBudgetChangesAndContinue:case Robotics.Client.Constants.Actions.SaveBudgetChanges:this.saveChangesResponse(objResult,objResultParams);break;case Robotics.Client.Constants.Actions.GetBudgetHourPeriodDeinition:this.showBudgetHourPeriodDetail(objResult,objResultParams);break;case Robotics.Client.Constants.Actions.RemoveEmployeeFromPosition:oClientMode.refreshFullData();break;case Robotics.Client.Constants.Actions.LoadAvailableEmployeesDetail:oClientMode.refreshAssignmentsTable(objResult,objResultParams);break;case Robotics.Client.Constants.Actions.RunAIPlanner:case Robotics.Client.Constants.Actions.CleanAIPlanner:oClientMode.refreshFullData()}action!=Robotics.Client.Constants.Actions.RemoveEmployeeFromPosition&&this.loadingFunctionExtended(!1);(action==Robotics.Client.Constants.Actions.DiscardBudgetAndContinue||action==Robotics.Client.Constants.Actions.SaveBudgetChangesAndContinue)&&(eval(oCalendar.onContinueFunc),oCalendar.onContinueFunc="")};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.loadEmployeeDetail=function(){var n=this,i=this.oBaseControl,f=i.oCalendar,u=n.generateLoadFilters(),t,r;n.oBaseControl.sortColumn=-1;n.oBaseControl.performAction(u,Robotics.Client.Constants.Actions.LoadAvailableEmployeesDetail);t=$("#"+i.prefix+Robotics.Client.Constants.LayoutNames.ColumnTabAssignments);t.empty();r=$("<div><\/div>").attr("class","loadingLayoutZone");t.append(r);n.loadingFunctionExtended(!1)};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.refreshAssignmentsTable=function(n){for(var r,f,t,o=this,s=this.oBaseControl,h=s.oCalendar,i={},e={},u=0;u<n.length;u++)for(r=moment(n[u].BudgetDate).format("YYYYMMDD"),typeof i[r]=="undefined"&&(i[r]={Assignments:{},Total:0}),f=0;f<n[u].BudgetEmployeeAvailableForNode.length;f++)t=n[u].BudgetEmployeeAvailableForNode[f],typeof e[t.IDAssignment]=="undefined"&&(e[t.IDAssignment]={IDAssignment:t.IDAssignment,Name:t.AssignmentName,Total:{}}),typeof i[r].Assignments[t.IDAssignment]=="undefined"&&(i[r].Assignments[t.IDAssignment]={Counter:0,EmployeesData:[]}),i[r].Total+=1,i[r].Assignments[t.IDAssignment].Counter+=1,i[r].Assignments[t.IDAssignment].EmployeesData.push(Object.clone(t,!0));this.employeeAssignmentData={assignmentKeys:e,tableData:i,serverData:n};o.refreshColumnassignmentsTable()};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.refreshFullData=function(){this.loadData()};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.saveChangesResponse=function(){var n=this.oBaseControl,t=n.oCalendar;this.employeeAssignmentData=null;n.setHasChanges(!1);n.refreshTables(null,!1,!0);this.cancelCurrentMultipleSelect(null,!0);this.cancelCurrentMultipleHeaderSelect(null,!0)};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.loadDataResponse=function(n){var t=this.oBaseControl,i=t.oCalendar;this.employeeAssignmentData=null;t.viewRange=Robotics.Client.Constants.ViewRange.Period;t.initialize();t.oCalendar=n;t.setHasChanges(!1);t.refreshTables(null,!1,!0)};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.onAcceptPUnitsDialog=function(){var n=this.oBaseControl,t=n.oCalendar};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.preparePUnitsDialog=function(){var n=this.oBaseControl;n.pUnitsDialog.dialog("open")};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.saveAndContinue=function(){var t=this.oBaseControl,n={};n.budget=t.oCalendar;n.StampParam=(new Date).getMilliseconds();t.performAction(n,Robotics.Client.Constants.Actions.SaveBudgetChangesAndContinue)};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.discardAndContinue=function(){var n=this.oBaseControl,t=this.generateLoadFilters();n.performAction(t,Robotics.Client.Constants.Actions.DiscardBudgetAndContinue)};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.refresh=function(){var n=this.oBaseControl,t=this.generateLoadFilters();n.sortColumn=-1;n.performAction(t,Robotics.Client.Constants.Actions.LoadBudget)};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.getEmployeeCountResume=function(){var n=this.oBaseControl;return""};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.onAcceptCopyDialog=function(){};Robotics.Client.Controls.roBudgetCalendarSchedule.prototype.changeFilterAssignments=function(){for(var oCalendar=this.oBaseControl,oCalData=oCalendar.oCalendar,assignmentsGrid=eval(oCalendar.ascxPrefix+"_dlgFilterCalendar_grdAssignmentsClient"),selectedValues=assignmentsGrid.GetSelectedKeysOnPage(),calendarFilter="",i=0;i<selectedValues.length;i++)calendarFilter+=selectedValues[i]+",";calendarFilter!=""&&(calendarFilter=calendarFilter.substring(0,calendarFilter.length-1));oCalendar.assignmentsFilter=calendarFilter;oCalendar.setFiltersCookieValue();oCalendar.refresh()},function(){var n=function(n){for(var r=n.split("."),i=window,t=0;t<r.length;t+=1)i=i[r[t]]=i[r[t]]||{};return i};n("Robotics.Client.Controls");n("Robotics.Client.Language");n("Robotics.Client.Constants")}();Robotics.Client.Controls.roBudgetCalendarDetail=function(n){this.name="Robotics.Client.Controls.roBudgetCalendarDetail";this.oBaseControl=n;this.rowTableVisible=1;this.columnTableVisible=1;this.fixedCalendarTable=null;this.pageLayoutOptions={name:"pageLayout",resizable:!1,center__slidable:!1,center__closable:!1,center__paneSelector:"#"+this.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.Center,center__children:{name:"tabsContainerLayout",resizable:!1,center__slidable:!1,center__closable:!1,center__paneSelector:"#"+this.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.Calendar,center__onresize_start:this.onresize(this),center__onresize_end:this.onresize(this)},spacing_closed:15};this.OnSelectedCell=null;this.OnDayClick=null;this.BudgetData=null;this.selectedPunitId=-1;this.pUnitsData=null;this.selectedPUnit=null;this.selectedPUnitMode=null;this.selectedPUnitModePosition=null;this.selectedEmployee=null;this.selectedDate=null;this.scrollInitPosition=null};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.getLayout=function(){return this.pageLayoutOptions};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.setHasChanges=function(n){var t=this.oBaseControl,i=t.oCalendar;t.hasChanges=n;try{hasChanges(n)}catch(r){}};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.create=function(){var n=this.oBaseControl,t=n.oCalendar;this.buildHTMLStructure();n.pageLayout=n.container.layout(this.pageLayoutOptions)};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.buildHTMLStructure=function(){var n=this.oBaseControl,r=n.oCalendar,t=$("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.Center).attr("class","ui-layout-center"),i=$("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.Calendar).attr("class","ui-layout-center");t.append(i);n.container.empty();n.container.append(t)};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.onresize=function(n){return function(){n.loadingFunctionExtended(!0);n.oBaseControl.refreshTables(n,!0,!0);n.loadingFunctionExtended(!1)}};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.loadingFunctionExtended=function(n){var t=this.oBaseControl;(t.isShowingLoader&&!n||!t.isShowingLoader&&n)&&(t.isShowingLoader=n,n?$("#loadingCalendar").show():$("#loadingCalendar").hide(),t.loadingFunc(n))};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.getContextMenuSelector=function(){var t=this,n=this.oBaseControl;return n.viewRange==Robotics.Client.Constants.ViewRange.Daily?".calendarDailyBodyCell":".calendarOuterBodyCell"};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.getContextMenuHeaderSelector=function(){var n=this,t=this.oBaseControl;return".CalendarDayFixedHeader"};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.processKeyUpEvent=function(){var n=this;n.cancelCurrentMultipleSelect(null,!1);n.cancelCurrentMultipleHeaderSelect(null,!1)};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.processKeyDownEvent=function(n){var i=this,t=this.oBaseControl;t.ctrlDown&&n.keyCode==t.cKey&&(t.selectedMinHeaderColumn!=-1&&t.selectedMaxHeaderColumn!=-1?i.copyHeaderSelection(t.selectedHeaderContainer):i.copySelection(t.selectedContainer));t.ctrlDown&&n.keyCode==t.vKey&&(t.selectionCopied?i.pasteSelection(t.selectedContainer):t.selectionHeaderCopied&&i.pasteHeaderSelection(t.selectedHeaderContainer))};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.onDrop=function(n){var i=this.oBaseControl,r=i.oCalendar,t;this.setSingleSelectedObject($(n.target));t=null;t=typeof n.srcElement!="undefined"?$(n.srcElement):$(n.originalEvent.target);typeof t.attr("data-IDMode")!="undefined"};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.mapModeEvents=function(){var t=this,n=this.oBaseControl,i=n.viewRange==Robotics.Client.Constants.ViewRange.Daily?".calendarDailyBodyCell":".calendarOuterBodyCell";$(i+",.reviewDailyBodyCell").off("click");$(i+",.reviewDailyBodyCell").on("click",function(){n.shiftDown?t.selectMultiple(n.selectedContainer,this):t.setSingleSelectedObject(this)});$(i+",.reviewDailyBodyCell").off("dblclick");$(i+",.reviewDailyBodyCell").on("dblclick",function(){t.enterDetailAction(parseInt($(this).attr("data-IDPunit"),10),parseInt(n.employeeFilter,10),$(this).attr("data-Date"))});if($(i).droppable({drop:function(n){return t.onDrop(n)}}),n.typeView==Robotics.Client.Constants.TypeView.Planification&&n.viewRange!=Robotics.Client.Constants.ViewRange.Daily){try{$("#"+n.prefix+Robotics.Client.Constants.TableNames.Calendar+"_tbody").selectableScroll("destroy")}catch(r){}$("#"+n.prefix+Robotics.Client.Constants.TableNames.Calendar+"_tbody").selectableScroll({distance:10,filter:".calendarOuterBodyCell",stop:function(){t.endSelectOperation()},scrollElement:$("#"+n.prefix+Robotics.Client.Constants.LayoutNames.Calendar+" .fht-fixed-body .fht-tbody")})}else try{$("#"+n.prefix+Robotics.Client.Constants.TableNames.Calendar+"_tbody").selectableScroll("destroy")}catch(r){}if(n.viewRange==Robotics.Client.Constants.ViewRange.Period&&n.isScheduleActive){try{$("#"+n.prefix+Robotics.Client.Constants.TableNames.Calendar+"_thead").selectableScroll("destroy")}catch(r){}$("#"+n.prefix+Robotics.Client.Constants.TableNames.Calendar+"_thead").selectableScroll({distance:10,filter:".CalendarDayFixedHeader",stop:function(){t.endHeaderSelectOperation()},scrollElement:$("#"+n.prefix+Robotics.Client.Constants.LayoutNames.Calendar+" .fht-fixed-body .fht-thead")})}$(".LoadIndictments").off("click");$(".LoadIndictments").on("click",function(){t.alterLoadIndictmentsModeAndReload()});$(".CalendarDayFixedHeader").off("click");$(".CalendarDayFixedHeader").on("click",function(){n.shiftDown?t.selectHeaderMultiple(n.selectedHeaderContainer,this):t.setSingleHeaderSelectedObejct(this)});$("#"+n.prefix+"_pUnitSelect").off("change");$("#"+n.prefix+"_pUnitSelect").on("change",function(){t.selectedPunitId=this.value;t.refresh()});$(".assignEmployeeDetail").off("click");$(".assignEmployeeDetail").on("click",function(n){var i=typeof n.srcElement!="undefined"?$(n.srcElement):$(n.originalEvent.target);t.onAddEmployee(i)});$(".deleteAssignedEmployeeDetail").off("click");$(".deleteAssignedEmployeeDetail").on("click",function(n){var i=typeof n.srcElement!="undefined"?$(n.srcElement):$(n.originalEvent.target);t.onRemoveEmployee(i)});t.selectedPunitId!=-1&&$("#"+n.prefix+"_pUnitSelect").val(t.selectedPunitId);t.scrollInitPosition!=null&&($("#"+n.prefix+"Main div.fht-fixed-body div.fht-tbody").scrollTop(t.scrollInitPosition.top),$("#"+n.prefix+"Main div.fht-fixed-body div.fht-tbody").scrollLeft(t.scrollInitPosition.left),t.scrollInitPosition=null);$(".tooltipIndictmentsContainer").each(function(){var n=this.id,t=n.replace("_tooltipIndictmentsContainer_","_tooltipIndictments_");$("#"+n).dxTooltip({target:"#"+t,showEvent:{name:"mouseenter",delay:300},hideEvent:"mouseleave",position:"bottom"})});window.focus()};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.refreshModeTables=function(n,t,i){var r=this;n!=null&&(r=n instanceof Robotics.Client.Controls.roCalendar?n.clientMode:n);i&&(r.refreshCalendarTable(t),this.oBaseControl.mapEvents())};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.refreshCalendarTable=function(n){var t=this.oBaseControl;try{$("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).fixedHeaderTable("destroy");$("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).find("tfoot").each(function(){this.id==""&&$(this).remove()})}catch(i){}n||this.createResumeTables(Robotics.Client.Constants.TableNames.Calendar,Robotics.Client.Constants.LayoutNames.Calendar);this.fixedCalendarTable=$("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).fixedHeaderTable({altClass:"odd",footer:t.isScheduleActive,fixedColumn:!0})};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.createResumeTables=function(n,t){switch(n){case Robotics.Client.Constants.TableNames.Calendar:this.createCalendarTable(n,t)}};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.createCalendarTable=function(n,t){var r=this.oBaseControl,f=r.oCalendar,u=$("#"+r.prefix+t),i;u.empty();i=$("<table><\/table>").attr("id",r.prefix+n).attr("class","fancyTable");i.append(this.createCalendarTableHeader(n,t));i.append(this.createCalendarTableBody(n,t));u.append(i)};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.createCalendarTableHeader=function(n){var v=this,i=this.oBaseControl,t=i.oCalendar,u=$("<thead><\/thead>").attr("id",i.prefix+n+"_thead").attr("class","HeaderSelectable"),r=$("<tr><\/tr>"),l=$("<th><\/th>"),y=$("<div><\/div>").attr("class","BudgetFixed CalendarFixedHeader"),f=$("<div><\/div>").attr("class","CalendarBudgetFixed CalendarBudgetFixedHeader"),e=$("<div ><\/div>").attr("class","BudgetTitleFixed"),h,c;e.append($("<span><\/span>").attr("class","ProductiveUnitTextNorth").html(this.BudgetData.BudgetHeader.ProductiveUnitHeaderData.Row1Text));var o=$('<div"><\/div>').attr("class","BudgetActionsFixed"),s=$("<div><\/div>").attr("class","NorthCell NorthCellHeaderEmployee"),a=$("<div><\/div>").attr("class","LoadIndictments "+(i.loadIndictments==!1?"showIndictments-inactive":"showIndictments-active")).attr("title",Globalize.formatMessage("roShowIndictments"));return s.append($("<div><\/div>").attr("class","EmpCellIconsNorth").append(a)),h=$("<div><\/div>").attr("class","SouthCell"),o.append(s,h),f.append(e,o),r.append(l.append(f)),Object.keys(t.calendarData).forEach(function(n){for(var o,f,e,s,h=t.calendarData[n],c=!0,u=t.columnLimits[n].min;u<t.columnLimits[n].max;u++)o=$("<th><\/th>"),f=$("<div><\/div>").attr("id",i.ascxPrefix+"_calHeaderCell_"+u).attr("class","CalendarDayFixed CalendarDayFixedHeader DailyCell").attr("data-IDColumn",u).attr("style","background:"+h.header[u].BackColor),c&&(o.attr("class","budgetDayDetailChange"),e=$("<div><\/div>").attr("class","budgetDailyDayTitle").attr("style","width:"+30*(t.columnLimits[n].max-t.columnLimits[n].min)+"px"),s=$("<div><\/div>").html(Globalize.formatDate(t.calendarData[n].dayDate,{date:"full"})),t.calendarData[n].isFeast&&e.append(s.attr("class","dailyColumnIsFeast")),e.append(s),f.append(e),c=!1),f.append($("<div><\/div>").attr("class","NorthCell dayInfo DailyCell").attr("style",u!=t.columnLimits[n].min?"padding-top:20px":"").html(h.header[u].Row2Text)),r.append(o.append(f))}),c=$('<th style="width:100%"><\/th>').html("&nbsp;"),r.append(c),u.append(r),u};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.createCalendarTableBody=function(n){var i=this,r=this.oBaseControl,t=r.oCalendar,u=$("<tbody><\/tbody>").attr("id",r.prefix+n+"_tbody").attr("class","bodySelectable"),o=0,f=0;if(Object.keys(t.rowMax).forEach(function(n){var s,a,e,y,c,p,h,l;for(o++,s=0,a=0;a<t.rowMax[n].maxEmployees;a++){if(e=$("<tr><\/tr>"),a==0){var w=$("<td><\/td>").attr("rowspan",t.rowMax[n].maxEmployees),b=$("<div><\/div>").attr("class","BudgetFixed CalendarFixedHeader").attr("style","height:100%"),v=$("<div><\/div>").attr("class","CalendarBudgetFixed CalendarBudgetFixedBody").attr("style","height:100%");if(i.pUnitsData.length>0){for(h=$("<div><\/div>").attr("class","EmployeeName").attr("style","height:"+55*t.rowMax[n].maxEmployees+"px !important;width:250px;display:table-cell;vertical-align:middle;"),y=$("<select><\/select>").attr("id",r.prefix+"_pUnitSelect"),c=0;c<i.pUnitsData.length;c++)p=$("<option />").text(i.pUnitsData[c].Name).val(i.pUnitsData[c].ID),y.append(p);v.append(h.append(y))}else h=$("<div><\/div>").attr("class","EmployeeName").attr("style","height:100% !important;line-height:"+55*t.rowMax[n].maxEmployees+"px").attr("title",t.rowMax[n].name),h.append($('<span style="padding-left:15px;white-space: nowrap;"><\/span>').html(t.rowMax[n].name)),v.append(h);e.append(w.append(b.append(v)))}l=0;Object.keys(t.calendarData).forEach(function(r){var c,u;i.descriptionExists=!1;var a=t.calendarData[r].pData[t.rowMax[n].idPunit],o=!0,h=!1;if(s==t.rowMax[n].maxEmployees-1&&(h=!0),s<a.EmployeesData.length)for(c=a.EmployeesData[s],u=t.columnLimits[r].min;u<t.columnLimits[r].max;u++)e.append(i.createDailyCalendarCell(c,c.HourData[u],f,l,u,o,h)),o=!1,l++;else for(u=t.columnLimits[r].min;u<t.columnLimits[r].max;u++)e.append(i.createEmptyDailyCalendarCell(f,l,o,h)),o=!1,l++});tmpCell=$('<td style="width:100%"><\/td>').addClass("budgetDayDetailChange").html("&nbsp;");e.append(tmpCell);u.append(e);s++;f++}}),o==0){var e=$("<tr><\/tr>"),s=$("<td><\/td>"),h=$("<div><\/div>").attr("class","BudgetFixed CalendarFixedHeader"),c=$("<div><\/div>").attr("class","CalendarBudgetFixed CalendarBudgetFixedHeader");e.append(s.append(h.append(c)));tmpCell=$('<td style="width:100%"><\/td>').html("&nbsp;");e.append(tmpCell);u.append(e)}return u};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.createDailyCalendarCell=function(n,t,i,r,u,f,e){var h=this.oBaseControl,c=h.oCalendar,o=$("<td><\/td>"),s;return r%2==0&&o.addClass("columnDailyCalendarOdd"),f&&o.addClass("budgetDayDetailChange"),e&&Object.keys(c.rowMax).length>1&&o.addClass("budgetRowDetailChange"),s=$("<div><\/div>").attr("id",h.ascxPrefix+"_calDailyCell_"+i+"_"+r).attr("class","calendarDailyBodyCell DailyCell"),s.attr("data-IDRow",i).attr("data-IDColumn",r),this.createDailyCalendarCellContent(s,n,t,u,i),o.append(s)};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.createEmptyDailyCalendarCell=function(n,t,i,r){var e=this.oBaseControl,o=e.oCalendar,u=$("<td><\/td>"),f;return t%2==0&&u.addClass("columnDailyCalendarOdd"),i&&u.addClass("budgetDayDetailChange"),r&&Object.keys(o.rowMax).length>1&&u.addClass("budgetRowDetailChange"),f=$("<div><\/div>").attr("id",e.ascxPrefix+"_calDailyCell_"+n+"_"+t).attr("class","calendarDailyBodyCell DailyCell"),f.attr("data-IDRow",n).attr("data-IDColumn",t),f.append($("<div><\/div>").attr("class","calendarDailyInnerBodyCell")),u.append(f)};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.createDailyCalendarCellContent=function(n,t,i,r,u){var v=this.oBaseControl,y=v.oCalendar,o=$("<div><\/div>").attr("class","calendarDailyInnerBodyCell"),s=null,h=t.ShiftData;if(i.DailyHourType!=Robotics.Client.Constants.DailyHourType.Untyped){var f="#ffffff",c="",l="",a="",e="";if(a=" - "+h.Name,l="border-bottom: 8px "+h.Color+" solid;",e="margin-top: -30px;",f=t.AssignmentData.Color,c=t.AssignmentData.Name,t.IDEmployee>0)switch(i.DailyHourType){case Robotics.Client.Constants.DailyHourType.Complementary:f=(new Robotics.Client.Common.roHtmlColor).shadeBlendConvert(-.2,f)}o.attr("style","background: "+f+";"+l);this.descriptionExists||r!=0&&i.DailyHourType==t.HourData[r-1].DailyHourType||(this.descriptionExists=!0,s=t.IDEmployee>0?this.generateShiftTypeInfoDailyContainer(t.EmployeeName+" - "+t.AssignmentData.Name.toUpperCase(),f,0,e,t,!0,r,u):this.generateShiftTypeInfoDailyContainer((c+a).toUpperCase(),f,0,e,t,!1,r,u))}n.append(null,o,s)};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.generateShiftInfoDailyContainer=function(n,t){var r=this.oBaseControl,u=r.oCalendar,i=$("<div><\/div>").attr("class","calendarShiftInfoDailyContainer").attr("title",n).append($("<span class='fontBold calendarFeastLeft'><\/span>").html(n));return i.attr("style","color:"+(new Robotics.Client.Common.roHtmlColor).invertCssColor(t)),i};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.generateShiftTypeInfoDailyContainer=function(n,t,i,r,u,f,e,o){var a=this.oBaseControl,b=a.oCalendar,p=n,h=$("<div><\/div>").attr("class","calendarBudgetDetailText"),c,l,s;if(f){if(c=[],u.Alerts!=null&&u.Alerts.OnAbsenceDays!=null&&u.Alerts.OnAbsenceDays&&c.push({employeeName:u.EmployeeName,indictment:{ErrorText:Globalize.formatMessage("roEmployeeAbsent")}}),u.Alerts!=null&&u.Alerts.Indictments!=null&&u.Alerts.Indictments.length>0)for(iInd=0;iInd<u.Alerts.Indictments.length;iInd++)c.push({employeeName:u.EmployeeName,indictment:Object.clone(u.Alerts.Indictments[iInd],!0)});if(c.length>0){var s=$("<div><\/div>").attr("id",a.ascxPrefix+"_tooltipIndictments_"+o+"_"+e).attr("style","float:left;").attr("class","budgetMainDetailOnAbsence"),v=$("<div><\/div>").attr("id",a.ascxPrefix+"_tooltipIndictmentsContainer_"+o+"_"+e).attr("class","tooltipIndictmentsContainer"),w=$("<div><\/div>").html('<span class="fontBold fontBig" style="text-align:left">'+Globalize.formatMessage("roIndictmentsTitle")+"<\/span>"),y=$("<ul><\/ul>");for(l=0;l<c.length;l++)y.append($("<li><\/li>").html(c[l].indictment.ErrorText));v.append(w,y);h.append(s,v)}}else s=$("<div><\/div>").attr("style","float:left").attr("class","assignEmployeeDetail"),s.attr("data-idPosition",u.IdPositionData).attr("data-dayKey",u.Keys.day).attr("data-idPunit",u.Keys.pUnit).attr("data-idEmployee",u.IDEmployee),h.append(s);return h.append($("<span><\/span>").attr("style","float:left").html(p)),f&&(s=$("<div><\/div>").attr("style","float:left").attr("class","deleteAssignedEmployeeDetail"),s.attr("data-idPosition",u.IdPositionData).attr("data-dayKey",u.Keys.day).attr("data-idPunit",u.Keys.pUnit).attr("data-idEmployee",u.IDEmployee),h.append(s)),h.attr("style","color:"+(new Robotics.Client.Common.roHtmlColor).invertCssColor(t)+";"+r),h};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.generateLoadFilters=function(){var n=this.oBaseControl,i=n.oCalendar,t={};return n.firstDate==null&&(n.firstDate=moment().startOf("month").toDate(),n.endDate=moment(n.firstDate).add(1,"month").subtract(1,"day").startOf("day").toDate()),t.firstDate=n.firstDate,t.endDate=n.endDate,t.orgChartFilter=n.employeeFilter!=""?n.employeeFilter:"-1",t.loadIndictments=n.loadIndictments,t.budget=null,t.typeView=n.typeView,t.pUnitFilter=this.selectedPunitId,t.StampParam=(new Date).getMilliseconds(),t};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.alterLoadIndictmentsModeAndReload=function(){var t=this,n=this.oBaseControl;n.loadIndictments=n.loadIndictments==!1?!0:!1;n.setFiltersCookieValue();t.loadData()};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.loadData=function(n,t,i,r,u,f){var o=this,e=this.oBaseControl,s=e.oCalendar;e.hasChanges==!1?(e.refreshTimmer!=-1&&clearTimeout(e.refreshTimmer),e.refreshTimmer=-1,e.sortColumn=-1,typeof f!="undefined"&&f!=null&&(e.loadIndictments=f),typeof i!="undefined"&&i!=null&&(e.employeeFilter=i),typeof n!="undefined"&&n!=null&&(e.firstDate=n),typeof t!="undefined"&&t!=null&&(e.endDate=t),typeof r!="undefined"&&r!=null&&(e.typeView=r),typeof u!="undefined"&&u!=null&&(e.assignmentsFilter=u),e.refresh()):e.showChangesWarning("refreshBudget();")};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.saveChanges=function(){var n=this.oBaseControl,t=n.oCalendar};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.buildContextMenu=function(n){var t=this.oBaseControl,i=t.oCalendar,r=n[0].innerText;return items={}};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.executeContextMenuAction=function(n){var t=this.oBaseControl,i=t.oCalendar;switch(n){case"enter":this.enterDetailAction(t.selectedEmployee.ProductiveUnitData.ProductiveUnit.ID,t.selectedEmployee.ProductiveUnitData.IDNode,moment(t.selectedDay.PlanDate).format("DD/MM/YYYY"))}};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.cancelCurrentMultipleSelect=function(n,t){var i=this.oBaseControl,f=i.oCalendar,u,r;if(!i.selectionCopied||t){for(i.selectionCopied=!1,u=$(".calendarOuterBodyCell.ui-selected,.calendarDailyBodyCell.ui-selected"),r=0;r<u.length;r++)$(u[r]).removeClass("ui-selected");i.selectedMinRow=-1;i.selectedMaxRow=-1;i.selectedMinColumn=-1;i.selectedMaxColumn=-1}};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.cancelCurrentMultipleHeaderSelect=function(n,t){var i=this.oBaseControl,f=i.oCalendar,u,r;if(!i.selectionHeaderCopied||t){for(i.selectionHeaderCopied=!1,u=$(".CalendarDayFixedHeader.ui-selected"),r=0;r<u.length;r++)$(u[r]).removeClass("ui-selected");i.selectedMinHeaderColumn=-1;i.selectedMaxHeaderColumn=-1}};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.pasteSelection=function(n){var t=this.oBaseControl,u=t.oCalendar,i=parseInt($(n).attr("data-IDRow"),10),r=parseInt($(n).attr("data-IDColumn"),10);this.pasteSelectionEnd(i,r)};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.pasteSelectionEnd=function(n,t){var i=this.oBaseControl,r=i.oCalendar,f,e,h,s,u,c;if(i.selectedMaxRow==i.selectedMinRow&&n==i.selectedMaxRow)for(f=0;f<=i.selectedMaxRow-i.selectedMinRow;f++)for(e=0;e<=i.selectedMaxColumn-i.selectedMinColumn;e++){var l=i.selectedMinRow+f,y=i.selectedMinColumn+e,o=n+f,a=t+e,v=null;for(v=i.viewRange!=Robotics.Client.Constants.ViewRange.Daily?r.BudgetData[l].PeriodData.DayData[y]:r.BudgetData[l].PeriodData.DayData[0],h=Object.clone(v.ProductiveUnitMode,!0),s=0;s<h.UnitModePositions.length;s++)h.UnitModePositions[s].ID=-1;u=!0;c=null;i.viewRange!=Robotics.Client.Constants.ViewRange.Daily?o<r.BudgetData.length&&a<r.BudgetData[o].PeriodData.DayData.length?(u=!0,c=r.BudgetData[o].PeriodData.DayData[a]):u=!1:o<r.BudgetData.length?(u=!0,c=r.BudgetData[o].PeriodData.DayData[0]):u=!1;u}};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.copyHeaderSelection=function(n){var t=this.oBaseControl,r=t.oCalendar,i;(t.selectedMinHeaderColumn==-1||t.selectedMaxHeaderColumn==-1)&&n!=null&&(i=parseInt($(n).attr("data-IDColumn"),10),t.selectedMinHeaderColumn=t.selectedMaxHeaderColumn=i,$(n).addClass("ui-selected"));t.selectionHeaderCopied=!0};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.copySelection=function(n){var t=this.oBaseControl,u=t.oCalendar,i,r;(t.selectedMinRow==-1||t.selectedMaxRow==-1||t.selectedMinColumn==-1||t.selectedMaxColumn==-1)&&n!=null&&(i=parseInt($(n).attr("data-IDRow"),10),r=parseInt($(n).attr("data-IDColumn"),10),t.selectedMinRow=t.selectedMaxRow=i,t.selectedMinColumn=t.selectedMaxColumn=r);t.selectionCopied=!0};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.enterDetailAction=function(n,t,i){var r=this.oBaseControl,u=r.oCalendar;r.hasChanges==!1?this.enterDetailActionFinally(n,t,i):r.showChangesWarning(r.clientInstanceName+".clientMode.enterDetailActionFinally("+n+","+t+",'"+i+"');")};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.enterDetailActionFinally=function(){};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.buildHeaderContextMenu=function(n){var t=this.oBaseControl,i=t.oCalendar,r=n[0].innerText,u=parseInt($(n).attr("data-IDColumn"),10);return items={sort:{name:t.translator.translate(Robotics.Client.Language.Tags.ContextMenu_Sort),disabled:!1,icon:"sort"}}};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.executeHeaderContextMenuAction=function(n,t){var i=this.oBaseControl,r=i.oCalendar;switch(n){case"sort":i.sortColumn=parseInt($(t).attr("data-IDColumn"),10);i.calendarSortDialog.dialog("open")}};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.selectHeaderMultiple=function(n,t){var i=this.oBaseControl,e=i.oCalendar,r,u,f;if(n!=null&&i.viewRange!=Robotics.Client.Constants.ViewRange.Daily)for(r=parseInt($(n).attr("data-IDColumn"),10),u=parseInt($(t).attr("data-IDColumn"),10),this.cancelCurrentMultipleSelect(null,!1),r<=u?(i.selectedMinHeaderColumn=r,i.selectedMaxHeaderColumn=u):(i.selectedMinHeaderColumn=u,i.selectedMaxHeaderColumn=r),f=i.selectedMinHeaderColumn;f<=i.selectedMaxHeaderColumn;f++)$("#"+i.ascxPrefix+"_calHeaderCell_"+f).addClass("ui-selected")};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.selectMultiple=function(n,t){var i=this.oBaseControl,h=i.oCalendar,r,u;if(n!=null&&i.viewRange!=Robotics.Client.Constants.ViewRange.Daily){var f=parseInt($(n).attr("data-IDRow"),10),e=parseInt($(t).attr("data-IDRow"),10),o=parseInt($(n).attr("data-IDColumn"),10),s=parseInt($(t).attr("data-IDColumn"),10);for(this.cancelCurrentMultipleSelect(null,!1),f<=e?(i.selectedMinRow=f,i.selectedMaxRow=e):(i.selectedMinRow=e,i.selectedMaxRow=f),o<=s?(i.selectedMinColumn=o,i.selectedMaxColumn=s):(i.selectedMinColumn=s,i.selectedMaxColumn=o),r=i.selectedMinRow;r<=i.selectedMaxRow;r++)for(u=i.selectedMinColumn;u<=i.selectedMaxColumn;u++)$("#"+i.ascxPrefix+"_calCell_"+r+"_"+u).addClass("ui-selected")}};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.setSingleHeaderSelectedObejct=function(n){var t=this.oBaseControl,r=t.oCalendar,i;n!=null&&this.setSingleSelectedObject(null);t.selectedHeaderContainer!=null&&t.selectedHeaderContainer.removeClass("singleCellSelected");n==null?t.selectedHeaderContainer=null:(i=parseInt($(n).attr("data-IDColumn"),10),i>=t.selectedMinHeaderColumn&&i<=t.selectedMaxHeaderColumn||t.selectionHeaderCopied||(this.cancelCurrentMultipleSelect(n,!0),this.cancelCurrentMultipleHeaderSelect(n,!0)),t.selectedHeaderContainer=$(n),t.selectedHeaderContainer.addClass("singleCellSelected"))};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.setSingleSelectedObject=function(n){var t=this.oBaseControl,u=t.oCalendar,i,r;n!=null&&this.setSingleHeaderSelectedObejct(null);t.selectedContainer!=null&&t.selectedContainer.removeClass("singleCellSelected");n==null?(t.selectedEmployee=null,t.selectedDay=null,t.selectedContainer=null,this.OnSelectedCell!=null&&this.OnSelectedCell(null,null,null)):(i=parseInt($(n).attr("data-IDRow"),10),r=parseInt($(n).attr("data-IDColumn"),10),i>=t.selectedMinRow&&i<=t.selectedMaxRow&&r>=t.selectedMinColumn&&r<=t.selectedMaxColumn||t.selectionCopied||(this.cancelCurrentMultipleSelect(null,!1),this.cancelCurrentMultipleHeaderSelect(null,!1)));this.OnSelectedCell!=null&&this.OnSelectedCell(t.selectedEmployee,t.selectedDay,t.selectedContainer)};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.endSelectOperation=function(n){var r=this.oBaseControl,s=r.oCalendar,i=$(".calendarOuterBodyCell.ui-selected"),t;this.cancelCurrentMultipleHeaderSelect(n,!0);this.setSingleHeaderSelectedObejct(null);this.setSingleSelectedObject(null);var u=0,f=0,e=0,o=0;for(t=0;t<i.length;t++)t==0?(u=parseInt($(i[t]).attr("data-IDRow"),10),f=parseInt($(i[t]).attr("data-IDRow"),10),e=parseInt($(i[t]).attr("data-IDColumn"),10),o=parseInt($(i[t]).attr("data-IDColumn"),10)):(parseInt($(i[t]).attr("data-IDRow"),10)<u&&(u=parseInt($(i[t]).attr("data-IDRow"),10)),parseInt($(i[t]).attr("data-IDRow"),10)>f&&(f=parseInt($(i[t]).attr("data-IDRow"),10)),parseInt($(i[t]).attr("data-IDColumn"),10)<e&&(e=parseInt($(i[t]).attr("data-IDColumn"),10)),parseInt($(i[t]).attr("data-IDColumn"),10)>o&&(o=parseInt($(i[t]).attr("data-IDColumn"),10)));r.selectedMinRow=u;r.selectedMaxRow=f;r.selectedMinColumn=e;r.selectedMaxColumn=o};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.endHeaderSelectOperation=function(n){var f=this.oBaseControl,e=f.oCalendar,i=$(".CalendarDayFixedHeader.ui-selected"),r,u,t;for(this.cancelCurrentMultipleSelect(n,!0),this.setSingleHeaderSelectedObejct(null),this.setSingleSelectedObject(null),r=0,u=0,t=0;t<i.length;t++)t==0?(r=parseInt($(i[t]).attr("data-IDColumn"),10),u=parseInt($(i[t]).attr("data-IDColumn"),10)):(parseInt($(i[t]).attr("data-IDColumn"),10)<r&&(r=parseInt($(i[t]).attr("data-IDColumn"),10)),parseInt($(i[t]).attr("data-IDColumn"),10)>u&&(u=parseInt($(i[t]).attr("data-IDColumn"),10)));f.selectedMinHeaderColumn=r;f.selectedMaxHeaderColumn=u};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.sortCalendar=function(){var n=this.oBaseControl,t=n.oCalendar,i=n.sortElements.split(",");t.CalendarData=t.CalendarData.sort(dynamicSortMultiple(i,n.viewRange==Robotics.Client.Constants.ViewRange.Daily?0:n.sortColumn));n.refreshTables(null,!1,!0);n.calendarSortDialog.dialog("close")};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.endCallback=function(action,objResult,objResultParams){var oClientMode=this,oCalendar=this.oBaseControl,oCalData=oCalendar.oCalendar;switch(action){case Robotics.Client.Constants.Actions.LoadBudget:case Robotics.Client.Constants.Actions.DiscardBudgetAndContinue:this.loadDataResponse(objResult,objResultParams);break;case Robotics.Client.Constants.Actions.SaveBudgetChangesAndContinue:case Robotics.Client.Constants.Actions.SaveBudgetChanges:this.saveChangesResponse(objResult,objResultParams);break;case Robotics.Client.Constants.Actions.GetAvailablePositionEmployees:oCalendar.prepareBudgetEmployeesDialog(objResult,objResultParams);break;case Robotics.Client.Constants.Actions.AddEmployeePlanOnPosition:case Robotics.Client.Constants.Actions.RemoveEmployeeFromPosition:oClientMode.refreshFullData()}(action==Robotics.Client.Constants.Actions.DiscardBudgetAndContinue||action==Robotics.Client.Constants.Actions.SaveBudgetChangesAndContinue)&&(eval(oCalendar.onContinueFunc),oCalendar.onContinueFunc="");action!=Robotics.Client.Constants.Actions.AddEmployeePlanOnPosition&&action!=Robotics.Client.Constants.Actions.RemoveEmployeeFromPosition&&this.loadingFunctionExtended(!1)};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.refreshFullData=function(){this.BudgetData=null;this.pUnitsData=null;this.selectedPUnit=null;this.selectedPUnitMode=null;this.selectedPUnitModePosition=null;this.selectedDate=null;this.selectedEmployee=null;this.loadData()};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.saveChangesResponse=function(n){var t=this.oBaseControl,i=t.oCalendar;t.setHasChanges(!1);this.BudgetData=n;t.oCalendar=this.BuildDayDetailObjectFromCalendar(n);t.refreshTables(null,!1,!0);this.cancelCurrentMultipleSelect(null,!0);this.cancelCurrentMultipleHeaderSelect(null,!0)};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.loadDataResponse=function(n,t){var i=this.oBaseControl,r=i.oCalendar;i.viewRange=moment(n.FirstDay).diff(moment(n.LastDay),"days")==0?i.typeView==Robotics.Client.Constants.TypeView.Review?Robotics.Client.Constants.ViewRange.Period:Robotics.Client.Constants.ViewRange.Daily:Robotics.Client.Constants.ViewRange.Period;i.initialize();this.BudgetData=n;this.pUnitsData=t;i.oCalendar=this.BuildDayDetailObjectFromCalendar(n);i.setHasChanges(!1);i.refreshTables(null,!1,!0)};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.BuildDayDetailObjectFromCalendar=function(n){var f,c,h,u,r,p,v,a,w,y,l,e;this.loadingFunctionExtended(!1);for(var i=n,t={calendarData:{},rowMax:{},columnLimits:{}},o=0,s=moment(n.FirstDay);s<moment(n.LastDay);)t.calendarData[s.format("YYYYMMDD")]={dayDate:s.toDate(),isFeast:i.BudgetHeader.PeriodHeaderData[o+48].FeastDay,header:i.BudgetHeader.PeriodHeaderData.slice(o,o+144),pData:{}},s=s.add(1,"day"),o+=48;for(t.calendarData[s.format("YYYYMMDD")]={dayDate:s.toDate(),isFeast:i.BudgetHeader.PeriodHeaderData[o+48].FeastDay,header:i.BudgetHeader.PeriodHeaderData.slice(o,o+144),pData:{}},Object.keys(t.calendarData).forEach(function(n){for(var u,r=0;r<i.BudgetData.length;r++)u={},u.ProductiveUnit=Object.clone(i.BudgetData[r].ProductiveUnitData.ProductiveUnit,!0),u.IDProductiveUnit=i.BudgetData[r].ProductiveUnitData.ProductiveUnit.ID,u.IDSecurityNode=i.BudgetData[r].ProductiveUnitData.IDNode,u.EmployeesData=[],t.calendarData[n].pData[i.BudgetData[r].ProductiveUnitData.ProductiveUnit.ID]=u}),f=0;f<i.BudgetData.length;f++)for(c=0;c<i.BudgetData[f].PeriodData.DayData.length;c++)for(h=moment(i.BudgetData[f].PeriodData.DayData[c].PlanDate).format("YYYYMMDD"),u=typeof i.BudgetData[f].PeriodData.DayData[c].ProductiveUnitMode!="undefined"?i.BudgetData[f].PeriodData.DayData[c].ProductiveUnitMode.UnitModePositions:[],r=0;r<u.length;r++){for(p=u[r].EmployeesData,v=0;v<p.length;v++)a=Object.clone(p[v],!0),a.AssignmentData=Object.clone(u[r].AssignmentData,!0),a.IdPositionData=Object.clone(u[r].ID,!0),a.Keys={day:h,pUnit:i.BudgetData[f].ProductiveUnitData.ProductiveUnit.ID},t.calendarData[h].pData[i.BudgetData[f].ProductiveUnitData.ProductiveUnit.ID].EmployeesData.push(a);for(w=u[r].EmployeesData.length;w<u[r].Quantity;)y={IDEmployee:-1,EmployeeName:Globalize.formatMessage("roAddEmployeeInShiftAssignment",u[r].AssignmentData.Name,u[r].ShiftData.Name),AssignmentData:Object.clone(u[r].AssignmentData,!0),ShiftData:Object.clone(u[r].ShiftData,!0),HourData:Object.clone(u[r].ShiftHourData,!0),IdPositionData:Object.clone(u[r].ID,!0),Keys:{day:h,pUnit:i.BudgetData[f].ProductiveUnitData.ProductiveUnit.ID}},t.calendarData[h].pData[i.BudgetData[f].ProductiveUnitData.ProductiveUnit.ID].EmployeesData.push(y),w++;u[r].IsExpandable&&(y={IDEmployee:-2,EmployeeName:Globalize.formatMessage("roAddEmployeeInShiftAssignment",u[r].AssignmentData.Name,u[r].ShiftData.Name),AssignmentData:Object.clone(u[r].AssignmentData,!0),ShiftData:Object.clone(u[r].ShiftData,!0),HourData:Object.clone(u[r].ShiftHourData,!0),IdPositionData:Object.clone(u[r].ID,!0),Keys:{day:h,pUnit:i.BudgetData[f].ProductiveUnitData.ProductiveUnit.ID}},t.calendarData[h].pData[i.BudgetData[f].ProductiveUnitData.ProductiveUnit.ID].EmployeesData.push(y))}for(l=0;l<i.BudgetData.length;l++)e=i.BudgetData[l].ProductiveUnitData.ProductiveUnit.ID,Object.keys(t.calendarData).forEach(function(n){typeof t.rowMax[e]=="undefined"&&(t.rowMax[e]={idPunit:i.BudgetData[l].ProductiveUnitData.ProductiveUnit.ID,name:i.BudgetData[l].ProductiveUnitData.ProductiveUnit.Name,maxEmployees:0});t.calendarData[n].pData[t.rowMax[e].idPunit].EmployeesData.length>t.rowMax[e].maxEmployees&&(t.rowMax[e].maxEmployees=t.calendarData[n].pData[t.rowMax[e].idPunit].EmployeesData.length)}),t.rowMax[e].maxEmployees==0&&(t.rowMax[e].maxEmployees=2);return Object.keys(t.calendarData).forEach(function(n){typeof t.columnLimits[n]=="undefined"&&(t.columnLimits[n]={min:144,max:0});t.columnLimits[n].min=144;t.columnLimits[n].max=0;Object.keys(t.calendarData[n].pData).forEach(function(i){for(var e,r,u=144,f=0,s=!1,o=0;o<t.calendarData[n].pData[i].EmployeesData.length;o++){for(s=!0,e=t.calendarData[n].pData[i].EmployeesData[o],r=0;r<e.HourData.length;r++)e.HourData[r].DailyHourType!=Robotics.Client.Constants.DailyHourType.Untyped&&r<u&&(u=r),e.HourData[r].DailyHourType!=Robotics.Client.Constants.DailyHourType.Untyped&&r>f&&(f=r);u<=t.columnLimits[n].min&&(t.columnLimits[n].min=u-2);f>=t.columnLimits[n].max&&(t.columnLimits[n].max=f+3)}u>f&&s&&(t.columnLimits[n].min=64,t.columnLimits[n].max=88)})}),t};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.onAcceptPUnitsDialog=function(){};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.preparePUnitsDialog=function(){var n=this.oBaseControl};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.saveAndContinue=function(){var t=this.oBaseControl,n={};n.budget=t.oCalendar;n.StampParam=(new Date).getMilliseconds();t.performAction(n,Robotics.Client.Constants.Actions.SaveBudgetChangesAndContinue)};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.discardAndContinue=function(){var n=this.oBaseControl,t=this.generateLoadFilters();n.performAction(t,Robotics.Client.Constants.Actions.DiscardBudgetAndContinue)};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.refresh=function(){var n=this.oBaseControl,t=this.generateLoadFilters();n.sortColumn=-1;n.performAction(t,Robotics.Client.Constants.Actions.LoadBudget)};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.getEmployeeCountResume=function(){var n=this.oBaseControl;return""};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.selectObjects=function(n){var t=this,o=this.oBaseControl,c=o.oCalendar,s=parseInt(n.attr("data-idPosition"),10),h=parseInt(n.attr("data-idPunit"),10),e=parseInt(n.attr("data-idEmployee"),10),i,u,r,f;for(t.selectedDate=moment(n.attr("data-dayKey"),"YYYYMMDD"),i=0;i<this.BudgetData.BudgetData.length;i++){if(this.BudgetData.BudgetData[i].ProductiveUnitData.ProductiveUnit.ID==h)for(t.selectedPUnit=this.BudgetData.BudgetData[i].ProductiveUnitData.ProductiveUnit,u=0;u<this.BudgetData.BudgetData[i].PeriodData.DayData.length;u++){if(moment(this.BudgetData.BudgetData[i].PeriodData.DayData[u].PlanDate).isSame(t.selectedDate))for(r=this.BudgetData.BudgetData[i].PeriodData.DayData[u].ProductiveUnitMode,t.selectedPUnitMode=r,iPos=0;iPos<r.UnitModePositions.length;iPos++)if(r.UnitModePositions[iPos].ID==s){if(t.selectedPUnitModePosition=Object.clone(r.UnitModePositions[iPos]),e>0)for(f=0;f<r.UnitModePositions[iPos].EmployeesData.length;f++)r.UnitModePositions[iPos].EmployeesData[f].IDEmployee==e&&(t.selectedEmployee=Object.clone(r.UnitModePositions[iPos].EmployeesData[f],!0));break}if(t.selectedPUnitModePosition!=null)break}if(t.selectedPUnitModePosition!=null)break}};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.onAddEmployee=function(n){var i=this,r=this.oBaseControl,u=r.oCalendar,t;i.selectObjects(n);i.selectedPUnitModePosition!=null&&(t={},t.orgChartFilter=parseInt(r.employeeFilter,10),t.pUnitModePosition=i.selectedPUnitModePosition,t.firstDate=i.selectedDate.toDate(),t.StampParam=(new Date).getMilliseconds(),r.performAction(t,Robotics.Client.Constants.Actions.GetAvailablePositionEmployees))};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.prepareBudgetEmployeesDialog=function(n,t){var r=this.oBaseControl,u=r.oCalendar,i={};i.pUnit=this.selectedPUnit;i.pUnitMode=this.selectedPUnitMode;i.pUnitModePosition=this.selectedPUnitModePosition;i.sDate=this.selectedDate.toDate();r.budgetEmployeesDialog.dialog("open");r.budgetEmployeesManager.InitializeDialog(n,t,i)};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.onAcceptBudgetEmployeesDialog=function(){var n=this,t=this.oBaseControl,o=t.oCalendar,i={},u;n.scrollInitPosition={top:$("#"+t.prefix+"Main div.fht-fixed-body div.fht-tbody").scrollTop(),left:$("#"+t.prefix+"Main div.fht-fixed-body div.fht-tbody").scrollLeft()};var r=t.budgetEmployeesManager.getMultipleEmployeeSelection(),e=[],f=r.length;for(n.selectedPUnitModePosition.IsExpandable||(f=n.selectedPUnitModePosition.Quantity-n.selectedPUnitModePosition.EmployeesData.length),f>r.length&&(f=r.length),u=0;u<f;u++)e.push({EmployeeName:r[u].EmployeeName,IDEmployee:r[u].IDEmployee,ShiftData:Object.clone(n.selectedPUnitModePosition.ShiftData,!0)});i.orgChartFilter=parseInt(t.employeeFilter,10);i.pUnitModePosition=n.selectedPUnitModePosition;i.firstDate=n.selectedDate.toDate();i.employeeData=e;i.StampParam=(new Date).getMilliseconds();t.performAction(i,Robotics.Client.Constants.Actions.AddEmployeePlanOnPosition);t.budgetEmployeesDialog.dialog("close")};Robotics.Client.Controls.roBudgetCalendarDetail.prototype.onRemoveEmployee=function(n){var t=this,i=this.oBaseControl,u=i.oCalendar,r;t.selectObjects(n);t.scrollInitPosition={top:$("#"+i.prefix+"Main div.fht-fixed-body div.fht-tbody").scrollTop(),left:$("#"+i.prefix+"Main div.fht-fixed-body div.fht-tbody").scrollLeft()};r=DevExpress.ui.dialog.confirm(Globalize.formatMessage("roDeleteConfirm"),Globalize.formatMessage("roDeleteTitle"));r.done(function(n){if(n){var r={};r.orgChartFilter=parseInt(i.employeeFilter,10);r.pUnitModePosition=t.selectedPUnitModePosition;r.firstDate=t.selectedDate.toDate();r.employeeData=[t.selectedEmployee];r.StampParam=(new Date).getMilliseconds();i.performAction(r,Robotics.Client.Constants.Actions.RemoveEmployeeFromPosition)}})},function(){var n=function(n){for(var r=n.split("."),i=window,t=0;t<r.length;t+=1)i=i[r[t]]=i[r[t]]||{};return i};n("Robotics.Client.Controls");n("Robotics.Client.Language");n("Robotics.Client.Constants")}();Robotics.Client.Controls.roDayDetailCalendar=function(n){this.name="Robotics.Client.Controls.roDayDetailCalendar";this.oBaseControl=n;this.rowTableVisible=1;this.columnTableVisible=1;this.fixedCalendarTable=null;this.pageLayoutOptions={name:"pageLayout",resizable:!1,center__slidable:!1,center__closable:!1,center__paneSelector:"#"+this.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.Center,center__children:{name:"tabsContainerLayout",resizable:!1,center__slidable:!1,center__closable:!1,center__paneSelector:"#"+this.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.Calendar,center__onresize_start:this.onresize(this),center__onresize_end:this.onresize(this)},spacing_closed:15};this.descriptionExists=!1;this.isActionOnRow=!1;this.selectedPUnit=null;this.selectedPUnitMode=null};Robotics.Client.Controls.roDayDetailCalendar.prototype.getLayout=function(){return this.pageLayoutOptions};Robotics.Client.Controls.roDayDetailCalendar.prototype.setHasChanges=function(n){var t=this.oBaseControl;t.hasChanges=n};Robotics.Client.Controls.roDayDetailCalendar.prototype.create=function(){var n=this.oBaseControl,t=n.oCalendar;this.buildHTMLStructure();n.pageLayout=n.container.layout(this.pageLayoutOptions)};Robotics.Client.Controls.roDayDetailCalendar.prototype.loadData=function(n,t,i,r,u,f){var e=this.oBaseControl;e.firstDate=moment().startOf("day").toDate();e.endDate=e.firstDate;clearTimeout(e.refreshTimmer);e.refreshTimmer=-1;e.sortColumn=-1;e.firstDate=i;e.employeeFilter=t;e.loadIndictments=f;e.oCalendar=n;this.selectedPUnit=r;this.selectedPUnitMode=u;e.initialize();e.setHasChanges(!1);e.refreshTables(null,!1,!0)};Robotics.Client.Controls.roDayDetailCalendar.prototype.getPositions=function(){var n=this.oBaseControl;return n.oCalendar};Robotics.Client.Controls.roDayDetailCalendar.prototype.buildHTMLStructure=function(){var n=this.oBaseControl,r=n.oCalendar,t=$("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.Center).attr("class","ui-layout-center"),i=$("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.Calendar).attr("class","ui-layout-center");t.append(i);n.container.append(t)};Robotics.Client.Controls.roDayDetailCalendar.prototype.onresize=function(n){return function(){n.loadingFunctionExtended(!0);n.oBaseControl.refreshTables(n,!0,!0);n.loadingFunctionExtended(!1)}};Robotics.Client.Controls.roDayDetailCalendar.prototype.loadingFunctionExtended=function(n){var t=this.oBaseControl;(t.isShowingLoader&&!n||!t.isShowingLoader&&n)&&(t.isShowingLoader=n,n?$("#loadingCalendar").show():$("#loadingCalendar").hide(),t.loadingFunc(n))};Robotics.Client.Controls.roDayDetailCalendar.prototype.getContextMenuSelector=function(){return".calendarDailyBodyCell"};Robotics.Client.Controls.roDayDetailCalendar.prototype.getContextMenuHeaderSelector=function(){return null};Robotics.Client.Controls.roDayDetailCalendar.prototype.buildContextMenu=function(n){var t=this.oBaseControl,i=n[0].innerText;return items={split1:{name:"---------",disabled:!0}}};Robotics.Client.Controls.roDayDetailCalendar.prototype.executeContextMenuAction=function(n){var t=this.oBaseControl,i=t.oCalendar;switch(n){}};Robotics.Client.Controls.roDayDetailCalendar.prototype.processKeyUpEvent=function(){var n=this.oBaseControl,t=n.oCalendar};Robotics.Client.Controls.roDayDetailCalendar.prototype.processKeyDownEvent=function(){var n=this.oBaseControl,t=n.oCalendar};Robotics.Client.Controls.roDayDetailCalendar.prototype.onDrop=function(){var n=this.oBaseControl,t=n.oCalendar};Robotics.Client.Controls.roDayDetailCalendar.prototype.mapModeEvents=function(){var r=this,t=this.oBaseControl,i=t.oCalendar,n=".calendarDailyBodyCell";$(n+",.productiveUnit-quantity").off("change");$(n+",.productiveUnit-quantity").on("change",function(){var n=parseInt($(this).attr("data-IDRow"),10);i[n].Quantity=parseInt($(this).val(),10)});$(n+",.productiveUnit-quantity").off("keydown");$(n+",.productiveUnit-quantity").on("keydown",function(n){$.inArray(n.keyCode,[46,8,9,27,13,110,190])!==-1||n.keyCode===65&&(n.ctrlKey===!0||n.metaKey===!0)||n.keyCode>=35&&n.keyCode<=40||(n.shiftKey||n.keyCode<48||n.keyCode>57)&&(n.keyCode<96||n.keyCode>105)&&n.preventDefault()});$(n+",.productiveUnit-expand").off("change");$(n+",.productiveUnit-expand").on("change",function(){var n=parseInt($(this).attr("data-IDRow"),10);i[n].IsExpandable=$(this).prop("checked")});$("#"+t.prefix+"Main div.fht-fixed-body div.fht-tbody").scrollLeft((t.firstCellPrinted-46)*30);t.firstCellPrinted=-1};Robotics.Client.Controls.roDayDetailCalendar.prototype.setSingleSelectedObject=function(n){var t=this.oBaseControl,i=t.oCalendar;n==null?(t.selectedEmployee=null,t.selectedContainer=null):t.selectedEmployee=i[parseInt($(n).attr("data-IDRow"),10)]};Robotics.Client.Controls.roDayDetailCalendar.prototype.refreshModeTables=function(n,t,i){var r=this;n!=null&&(r=n instanceof Robotics.Client.Controls.roCalendar?n.clientMode:n);i&&(r.refreshMainTable(t),this.oBaseControl.mapEvents())};Robotics.Client.Controls.roDayDetailCalendar.prototype.refreshMainTable=function(n){var t=this.oBaseControl;try{$("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).fixedHeaderTable("destroy");$("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).find("tfoot").each(function(){this.id==""&&$(this).remove()})}catch(i){}n||this.createResumeTables(Robotics.Client.Constants.TableNames.Calendar,Robotics.Client.Constants.LayoutNames.Calendar);this.fixedCalendarTable=$("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).fixedHeaderTable({altClass:"odd",footer:!1,fixedColumn:!0})};Robotics.Client.Controls.roDayDetailCalendar.prototype.createResumeTables=function(n,t){switch(n){case Robotics.Client.Constants.TableNames.Calendar:this.createPUnitTable(n,t)}};Robotics.Client.Controls.roDayDetailCalendar.prototype.createPUnitTable=function(n,t){var r=this.oBaseControl,u=$("#"+r.prefix+t),i;u.empty();i=$("<table><\/table>").attr("id",r.prefix+n).attr("class","fancyTable");i.append(this.createPUnitTableHeader(n,t));i.append(this.createPUnitTableBody(n,t));u.append(i)};Robotics.Client.Controls.roDayDetailCalendar.prototype.createPUnitTableHeader=function(n){var t=this.oBaseControl,k=t.oCalendar,c=$("<thead><\/thead>").attr("id",t.prefix+n+"_thead").attr("class","HeaderSelectable"),u=$("<tr><\/tr>"),y=$("<th><\/th>"),p=$("<div><\/div>").attr("class","ProductiveUnitFixed CalendarFixedHeader"),l=$("<div><\/div>").attr("class","ProductiveUnitHeaderCellFixed CalendarSummaryFixedHeader"),a=$("<div><\/div>").attr("class","NorthCell"),f,e,o,s;a.append($("<div><\/div>").attr("class","ProductiveUnitHeaderText").html(Globalize.formatMessage("roPUnitPosition")));f=$("<div><\/div>").attr("class","SouthCell");f.append($("<div><\/div>").attr("class","EmpCellTextSouth").html(""));l.append(a,f);e=$("<div><\/div>").attr("class","ProductiveUnitHeaderCellFixed CalendarEmployeeFixedHeader");o=$("<div><\/div>").attr("class","NorthCell NorthCellHeaderEmployee");o.append($("<div><\/div>").attr("class","ProductiveUnitHeaderText").html(Globalize.formatMessage("roPUnitQuantity")));s=$("<div><\/div>").attr("class","SouthCell");s.append($("<div><\/div>").attr("class","EmpCellTextSouth").html(""));e.append(o,s);u.append(y.append(p.append(l,e)));for(var r=moment(t.firstDate).add(-1,"days"),w=moment(t.firstDate).add(2,"days"),h=0;r<w;){if(h>=t.getMinDailyCell()&&h<t.getMaxDailyCell()){var b=$("<th><\/th>"),v=$("<div><\/div>").attr("id",t.ascxPrefix+"_calHeaderCell_"+i).attr("class","CalendarDayFixed CalendarDayFixedHeader DailyCell").attr("data-IDColumn",i).attr("style","background:#F2F4F2 ");v.append($("<div><\/div>").attr("class","NorthCell dayInfo DailyCell").html(r.format("HH:mm")));u.append(b.append(v))}r=r.add(30,"minutes");h++}return c.append(u),c};Robotics.Client.Controls.roDayDetailCalendar.prototype.createPUnitTableBody=function(n){var u=this.oBaseControl,r=u.oCalendar,e=$("<tbody><\/tbody>").attr("id",u.prefix+n+"_tbody").attr("class","bodySelectable"),f,t,c,l;if(r!=null&&r.length>0)for(t=0;t<r.length;t++){var i=$("<tr><\/tr>"),s=$("<td><\/td>"),h=$("<div><\/div>").attr("class","ProductiveUnitFixed CalendarFixedBody"),o=$("<div><\/div>").attr("class","ProductiveUnitHeaderCellFixed CalendarSummaryFixedBody");o.append(this.generatePositionSection(t,r[t]));f=$("<div><\/div>").attr("class","ProductiveUnitHeaderCellFixed CalendarEmployeeFixedBody");f.append(this.generateQuantitySection(t,r[t]));i.append(s.append(h.append(o,f)));this.descriptionExists=!1;this.buildPUnitModePostionRow(t,i);tmpCell=$('<td style="width:100%"><\/td>').html("&nbsp;");i.append(tmpCell);e.append(i)}else{var i=$("<tr><\/tr>"),s=$("<td><\/td>"),h=$("<div><\/div>").attr("class","ProductiveUnitFixed CalendarFixedBody"),o=$("<div><\/div>").attr("class","ProductiveUnitHeaderCellFixed CalendarSummaryFixedBody"),f=$("<div><\/div>").attr("class","ProductiveUnitHeaderCellFixed CalendarEmployeeFixedBody");for(i.append(s.append(h.append(o,f))),t=u.getMinDailyCell();t<u.getMaxDailyCell();t++)c=$("<td><\/td>"),l=$("<div><\/div>").attr("class","calendarOuterBodyCellInOtherDepartment DailyCell"),i.append(c.append(l));e.append(i)}return e};Robotics.Client.Controls.roDayDetailCalendar.prototype.generatePositionSection=function(n){var t=this.oBaseControl,r=t.oCalendar,i=$("<div><\/div>").attr("id",t.ascxPrefix+"_calPositionCell_"+n).attr("class","productiveUnit-position");return i.attr("data-IDRow",n).html(n+1),i};Robotics.Client.Controls.roDayDetailCalendar.prototype.generateQuantitySection=function(n,t){var i=this.oBaseControl,c=i.oCalendar,e=$("<div><\/div>").attr("id",i.ascxPrefix+"_calPositionCell_"+n).attr("data-IDRow",n),o=$("<div><\/div>").attr("class","qtyPosition"),s=$("<input>").attr({type:"text",id:i.ascxPrefix+"_qty_"+n,"data-IDRow":n,"class":"productiveUnit-quantity",disabled:"true"}),r,h,u,f;return $(s).val(t.Quantity),o.append(s),r=$("<div><\/div>").attr("class","lblExpandable"),h=$("<label>").attr({"class":"productiveUnit-quantity-text"}).html(Globalize.formatMessage("roPUnitExpandable")),r.append(h),u=$("<div><\/div>").attr("class","checkExpandable"),f=$("<input>").attr({type:"checkbox",id:i.ascxPrefix+"_expand_"+n,"data-IDRow":n,"class":"productiveUnit-expand",disabled:"true"}),$(f).prop("checked",t.IsExpandable),u.append(f),e.append(o,r,u),e};Robotics.Client.Controls.roDayDetailCalendar.prototype.buildPUnitModePostionRow=function(n,t){for(var r=this.oBaseControl,u=r.oCalendar,f=u[n].ShiftHourData,i=r.getMinDailyCell();i<r.getMaxDailyCell();i++)t.append(this.createDailyCalendarCell(u[n],f[i],n,i))};Robotics.Client.Controls.roDayDetailCalendar.prototype.createDailyCalendarCell=function(n,t,i,r){var f=this.oBaseControl,o=f.oCalendar,e=$("<td><\/td>"),u;return r%2==0&&e.addClass("columnDailyCalendarOdd"),u=$("<div><\/div>").attr("id",f.ascxPrefix+"_calDailyCell_"+i+"_"+r).attr("class","calendarDailyBodyCell DailyCell"),u.attr("data-IDRow",i).attr("data-IDColumn",r),this.createDailyCalendarCellContent(u,n,t,r),e.append(u)};Robotics.Client.Controls.roDayDetailCalendar.prototype.createDailyCalendarCellContent=function(n,t,i,r){var f=this.oBaseControl,v=f.oCalendar,e=$("<div><\/div>").attr("class","calendarDailyInnerBodyCell"),o=null,s=t.ShiftData;if(i.DailyHourType!=Robotics.Client.Constants.DailyHourType.Untyped){var u="#ffffff",h="",c="",l="",a="";l=" - "+s.Name;c="border-bottom: 8px "+s.Color+" solid;";a="margin-top: -30px;";u=t.AssignmentData.Color;h=t.AssignmentData.Name;switch(i.DailyHourType){case Robotics.Client.Constants.DailyHourType.Complementary:u=(new Robotics.Client.Common.roHtmlColor).shadeBlendConvert(-.5,u)}(f.firstCellPrinted==-1&&i.DailyHourType!=Robotics.Client.Constants.DailyHourType.Untyped||r<f.firstCellPrinted)&&(f.firstCellPrinted=r);e.attr("style","background: "+u+";"+c);this.descriptionExists||r!=0&&i.DailyHourType==t.ShiftHourData[r-1].DailyHourType||(this.descriptionExists=!0,o=this.generateShiftTypeInfoDailyContainer(h+l,u,0,a))}n.append(null,e,o)};Robotics.Client.Controls.roDayDetailCalendar.prototype.generateShiftInfoDailyContainer=function(n,t){var r=this.oBaseControl,u=r.oCalendar,i=$("<div><\/div>").attr("class","calendarShiftInfoDailyContainer").attr("title",n).append($("<span class='fontBold calendarFeastLeft'><\/span>").html(n));return i.attr("style","color:"+(new Robotics.Client.Common.roHtmlColor).invertCssColor(t)),i};Robotics.Client.Controls.roDayDetailCalendar.prototype.generateShiftTypeInfoDailyContainer=function(n,t,i,r){var e=this.oBaseControl,o=e.oCalendar,u=n,f=$("<div><\/div>").attr("class","calendarShiftTypeInfoDailyContainer").attr("title",u).html(u);return f.attr("style","color:"+(new Robotics.Client.Common.roHtmlColor).invertCssColor(t)+";"+r),f};Robotics.Client.Controls.roDayDetailCalendar.prototype.endCallback=function(n){var t=this.oBaseControl,i=t.oCalendar;switch(n){}this.loadingFunctionExtended(!1)};Robotics.Client.Controls.roDayDetailCalendar.prototype.prepareShfitsDialog=function(){};Robotics.Client.Controls.roDayDetailCalendar.prototype.onAcceptShiftsDialog=function(){};Robotics.Client.Controls.roDayDetailCalendar.prototype.prepareComplementaryDialog=function(){};Robotics.Client.Controls.roDayDetailCalendar.prototype.onAcceptComplementaryDialog=function(){};Robotics.Client.Controls.roDayDetailCalendar.prototype.prepareAssignmentsDialog=function(){};Robotics.Client.Controls.roDayDetailCalendar.prototype.onAcceptAssignmentsDialog=function(){},function(){var n=function(n){for(var r=n.split("."),i=window,t=0;t<r.length;t+=1)i=i[r[t]]=i[r[t]]||{};return i};n("Robotics.Client.Controls");n("Robotics.Client.Language");n("Robotics.Client.Constants");n("Robotics.Client.Global")}();Robotics.Client.Global.deferredItemData={oCalendar:null,d:null,itemData:null,idRow:-1};Robotics.Client.Global.rowContext={id:-1,oObject:null,quantity:0};Robotics.Client.Controls.roDayDetailSchedule=function(n){this.name="Robotics.Client.Controls.roDayDetailSchedule";this.oBaseControl=n;this.rowTableVisible=1;this.columnTableVisible=1;this.fixedCalendarTable=null;this.pageLayoutOptions={name:"pageLayout",resizable:!1,center__slidable:!1,center__closable:!1,center__paneSelector:"#"+this.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.Center,center__children:{name:"tabsContainerLayout",resizable:!1,center__slidable:!1,center__closable:!1,center__paneSelector:"#"+this.oBaseControl.prefix+Robotics.Client.Constants.LayoutNames.Calendar,center__onresize_start:this.onresize(this),center__onresize_end:this.onresize(this)},spacing_closed:15};this.descriptionExists=!1;this.isActionOnRow=!1;this.selectedPUnit=null;this.selectedPUnitMode=null;this.employeeLists={}};Robotics.Client.Controls.roDayDetailSchedule.prototype.getLayout=function(){return this.pageLayoutOptions};Robotics.Client.Controls.roDayDetailSchedule.prototype.setHasChanges=function(n){var t=this.oBaseControl;t.hasChanges=n};Robotics.Client.Controls.roDayDetailSchedule.prototype.create=function(){var n=this.oBaseControl,t=n.oCalendar;this.buildHTMLStructure();n.pageLayout=n.container.layout(this.pageLayoutOptions)};Robotics.Client.Controls.roDayDetailSchedule.prototype.loadData=function(n,t,i,r,u,f){var e=this.oBaseControl;e.firstDate=moment().startOf("day").toDate();e.endDate=e.firstDate;clearTimeout(e.refreshTimmer);e.refreshTimmer=-1;e.sortColumn=-1;e.firstDate=i;e.loadIndictments=f;e.employeeFilter=t;e.oCalendar=n;this.selectedPUnit=r;this.selectedPUnitMode=u;e.initialize();e.setHasChanges(!1);e.refreshTables(null,!1,!0)};Robotics.Client.Controls.roDayDetailSchedule.prototype.getPositions=function(){var n=this.oBaseControl;return n.oCalendar};Robotics.Client.Controls.roDayDetailSchedule.prototype.buildHTMLStructure=function(){var n=this.oBaseControl,r=n.oCalendar,t=$("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.Center).attr("class","ui-layout-center"),i=$("<div><\/div>").attr("id",n.prefix+Robotics.Client.Constants.LayoutNames.Calendar).attr("class","ui-layout-center");t.append(i);n.container.append(t)};Robotics.Client.Controls.roDayDetailSchedule.prototype.onresize=function(n){return function(){n.loadingFunctionExtended(!0);n.oBaseControl.refreshTables(n,!0,!0);n.loadingFunctionExtended(!1)}};Robotics.Client.Controls.roDayDetailSchedule.prototype.loadingFunctionExtended=function(n){var t=this.oBaseControl;(t.isShowingLoader&&!n||!t.isShowingLoader&&n)&&(t.isShowingLoader=n,n?$("#loadingCalendar").show():$("#loadingCalendar").hide(),t.loadingFunc(n))};Robotics.Client.Controls.roDayDetailSchedule.prototype.getContextMenuSelector=function(){return".calendarDailyBodyCell"};Robotics.Client.Controls.roDayDetailSchedule.prototype.getContextMenuHeaderSelector=function(){return null};Robotics.Client.Controls.roDayDetailSchedule.prototype.buildContextMenu=function(n){var t=this.oBaseControl,i=n[0].innerText;return items={split1:{name:"---------",disabled:!0}}};Robotics.Client.Controls.roDayDetailSchedule.prototype.executeContextMenuAction=function(n){var t=this.oBaseControl,i=t.oCalendar;switch(n){}};Robotics.Client.Controls.roDayDetailSchedule.prototype.processKeyUpEvent=function(){var n=this.oBaseControl,t=n.oCalendar};Robotics.Client.Controls.roDayDetailSchedule.prototype.processKeyDownEvent=function(){var n=this.oBaseControl,t=n.oCalendar};Robotics.Client.Controls.roDayDetailSchedule.prototype.onDrop=function(){var n=this.oBaseControl,t=n.oCalendar};Robotics.Client.Controls.roDayDetailSchedule.prototype.onUpdateRowQuantity=function(n,t,i,r){var e=this,f=this.oBaseControl,o=f.oCalendar,s=t.EmployeesData.count(function(n){return n.IDEmployee!=-1}),u;t.IsExpandable==!1&&s>i?(DevExpress.ui.dialog.alert(Globalize.formatMessage("roEmployeesExceedQuantity"),Globalize.formatMessage("roAlert")),r.val(s)):i<=0?(DevExpress.ui.dialog.alert(Globalize.formatMessage("roEmployeesGreaterThanZero"),Globalize.formatMessage("roAlert")),r.val(t.Quantity)):o.length>0&&n>=0?(Robotics.Client.Global.rowContext.id=n,Robotics.Client.Global.rowContext.quantity=i,u={},u.idOrgChartNode=parseInt(f.employeeFilter,10),u.pUnitModePosition=o[n],u.sDate=f.firstDate,u.quantity=i,u.iPUnit=e.selectedPUnit.ID,u.iPUnitMode=e.selectedPUnitMode.ID,u.StampParam=(new Date).getMilliseconds(),f.performAction(u,Robotics.Client.Constants.Actions.UpdateProductiveUnitQuantity)):Robotics.Client.Global.rowContext.id=-1};Robotics.Client.Controls.roDayDetailSchedule.prototype.onFulFillPositionEmployees=function(n){var u=this,i=this.oBaseControl,r=i.oCalendar,t;r.length>0&&n>=0?(Robotics.Client.Global.rowContext.id=n,t={},t.idOrgChartNode=parseInt(i.employeeFilter,10),t.pUnitModePosition=r[n],t.sDate=i.firstDate,t.StampParam=(new Date).getMilliseconds(),i.performAction(t,Robotics.Client.Constants.Actions.GetAvailablePositionEmployeesForFulFill)):Robotics.Client.Global.rowContext.id=-1};Robotics.Client.Controls.roDayDetailSchedule.prototype.onAddPositionEmployee=function(n){var u=this,i=this.oBaseControl,r=i.oCalendar,t;r.length>0&&n>=0?(Robotics.Client.Global.rowContext.id=n,t={},t.idOrgChartNode=parseInt(i.employeeFilter,10),t.pUnitModePosition=r[n],t.sDate=i.firstDate,t.StampParam=(new Date).getMilliseconds(),i.performAction(t,Robotics.Client.Constants.Actions.GetAvailablePositionEmployees)):Robotics.Client.Global.rowContext.id=-1};Robotics.Client.Controls.roDayDetailSchedule.prototype.mapModeEvents=function(){var i=this,t=this.oBaseControl,u=t.oCalendar,n=".calendarDailyBodyCell",r;$(n+",.fulfillEmployees").off("click");$(n+",.fulfillEmployees").on("click",function(n){var t=typeof n.srcElement!="undefined"?$(n.srcElement):$(n.originalEvent.target);i.onFulFillPositionEmployees(parseInt(t.attr("data-IDRow"),10))});$(n+",.addEmployee").off("click");$(n+",.addEmployee").on("click",function(n){var t=typeof n.srcElement!="undefined"?$(n.srcElement):$(n.originalEvent.target);i.onAddPositionEmployee(parseInt(t.attr("data-IDRow"),10))});$(n+",.productiveUnit-quantity").off("change");$(n+",.productiveUnit-quantity").on("change",function(){var n=null,t;n=typeof event.srcElement!="undefined"?$(event.srcElement):$(event.originalEvent.target);t=parseInt(n.attr("data-IDRow"),10);i.onUpdateRowQuantity(parseInt(n.attr("data-IDRow"),10),u[t],parseInt(n.val(),10),n)});$(n+",.productiveUnit-quantity").off("keydown");$(n+",.productiveUnit-quantity").on("keydown",function(n){$.inArray(n.keyCode,[46,8,9,27,13,110,190])!==-1||n.keyCode===65&&(n.ctrlKey===!0||n.metaKey===!0)||n.keyCode>=35&&n.keyCode<=40||(n.shiftKey||n.keyCode<48||n.keyCode>57)&&(n.keyCode<96||n.keyCode>105)&&n.preventDefault()});$(n+",.productiveUnit-expand").off("change");$(n+",.productiveUnit-expand").on("change",function(){var n=parseInt($(this).attr("data-IDRow"),10);u[n].IsExpandable=$(this).prop("checked")});$("#"+t.prefix+"Main div.fht-fixed-body div.fht-tbody").scrollLeft((t.firstCellPrinted-46)*30);t.firstCellPrinted=-1;r=this;Object.keys(r.employeeLists).forEach(function(n,u){lstConfig=r.employeeLists[n];lstConfig.instance=$("#"+lstConfig.id).dxList({dataSource:lstConfig.ds,height:"100%",allowItemDeleting:!0,itemDeleteMode:"static",selectionMode:"none",pageLoadMode:"scrollBottom",noDataText:"",itemTemplate:function(n,i){var f=$("<div>"),e;if(n.IDEmployee>=0){var o="",r=[];if(n.Alerts!=null&&n.Alerts.OnAbsenceDays!=null&&n.Alerts.OnAbsenceDays&&r.push({employeeName:n.EmployeeName,indictment:{ErrorText:Globalize.formatMessage("roEmployeeAbsent")}}),n.Alerts!=null&&n.Alerts.Indictments!=null&&n.Alerts.Indictments.length>0)for(iInd=0;iInd<n.Alerts.Indictments.length;iInd++)r.push({employeeName:n.EmployeeName,indictment:Object.clone(n.Alerts.Indictments[iInd],!0)});if(r.length>0&&(o="budgetDetailOnAbsence"),f.append($("<div>").attr("id",t.ascxPrefix+"_tooltipIndictments_"+u+"_"+i).attr("class",o).attr("title","").text(n.EmployeeName)),r.length>0){var s=$("<div><\/div>").attr("id",t.ascxPrefix+"_tooltipIndictmentsContainer_"+u+"_"+i).attr("class","tooltipIndictmentsContainer"),c=$("<div><\/div>").html('<span class="fontBold fontBig" style="text-align:left">'+Globalize.formatMessage("roIndictmentsTitle")+"<\/span>"),h=$("<ul><\/ul>");for(e=0;e<r.length;e++)h.append($("<li><\/li>").html(r[e].indictment.ErrorText));s.append(c,h);f.append(s)}}else n.EmployeeName==Globalize.formatMessage("roEmployeeNotAssigned")?$("<div>").attr("style","color:red").text(n.EmployeeName).appendTo(f):$("<div>").attr("style","color:#00cc00").text(n.EmployeeName).appendTo(f);return f},onItemDeleting:function(n){var t=$.Deferred();r.AskForDelete(t,n.itemData,parseInt(n.element.attr("data-IdRow"),10));n.cancel=t.promise()},onItemDeleted:function(){i.refreshRowsHeight()},onItemRendered:function(n){n.itemData.IDEmployee<0&&n.itemElement.find(".dx-list-static-delete-button-container").each(function(){$(this).remove()})},onItemClick:function(n){if(n.itemData.IDEmployee<0)r.onAddPositionEmployee(parseInt(n.element.attr("data-IdRow"),10))}}).dxList("instance")});$(".tooltipIndictmentsContainer").each(function(){var n=this.id,t=n.replace("_tooltipIndictmentsContainer_","_tooltipIndictments_");$("#"+n).dxTooltip({target:"#"+t,showEvent:{name:"mouseenter",delay:300},hideEvent:"mouseleave",position:"bottom"})});setTimeout(function(){i.refreshRowsHeight()},200)};Robotics.Client.Controls.roDayDetailSchedule.prototype.AskForDelete=function(n,t,i){var r=this,u=function(t){return Robotics.Client.Global.deferredItemData={oCalendar:r,d:n,itemData:t,idRow:i},function(n){n?Robotics.Client.Global.deferredItemData.oCalendar.finallyDelete():Robotics.Client.Global.deferredItemData.d.resolve(!n)}};DevExpress.ui.dialog.confirm(Globalize.formatMessage("roUnassignEmployeeConfirmation")).done(u(t)).fail(n.reject)};Robotics.Client.Controls.roDayDetailSchedule.prototype.finallyDelete=function(){var t=this.oBaseControl,i=t.oCalendar,n={};n.idOrgChartNode=parseInt(t.employeeFilter,10);n.pUnitModePosition=i[Robotics.Client.Global.deferredItemData.idRow];n.sDate=t.firstDate;n.employeeData=[Robotics.Client.Global.deferredItemData.itemData];n.StampParam=(new Date).getMilliseconds();t.performAction(n,Robotics.Client.Constants.Actions.RemoveEmployeeFromPosition)};Robotics.Client.Controls.roDayDetailSchedule.prototype.refreshRowsHeight=function(){var n=this.oBaseControl,t=n.oCalendar;$(".calendarDailyBodyCell.DailyCell").each(function(t){var i=this.id.replace(n.ascxPrefix+"_calDailyCell_","").split("_")[0],r="height:"+$("#"+n.ascxPrefix+"_calEmployeeResumeCell_"+i).height()+"px !important";$("#"+this.id).attr("style",r);t==0&&($("#"+n.ascxPrefix+"_calPositionCell_"+i).parent().attr("style",r),$("#"+n.ascxPrefix+"_calQuantityCell_"+i).parent().attr("style",r),$("#"+n.ascxPrefix+"_calEmployeeResumeCell_"+i).parent().attr("style",r))})};Robotics.Client.Controls.roDayDetailSchedule.prototype.setSingleSelectedObject=function(n){var t=this.oBaseControl,i=t.oCalendar;n==null?(t.selectedEmployee=null,t.selectedContainer=null):t.selectedEmployee=i[parseInt($(n).attr("data-IDRow"),10)]};Robotics.Client.Controls.roDayDetailSchedule.prototype.refreshModeTables=function(n,t,i){var r=this;n!=null&&(r=n instanceof Robotics.Client.Controls.roCalendar?n.clientMode:n);i&&(r.refreshMainTable(t),this.oBaseControl.mapEvents())};Robotics.Client.Controls.roDayDetailSchedule.prototype.refreshMainTable=function(n){var t=this.oBaseControl;try{$("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).fixedHeaderTable("destroy");$("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).find("tfoot").each(function(){this.id==""&&$(this).remove()})}catch(i){}n||this.createResumeTables(Robotics.Client.Constants.TableNames.Calendar,Robotics.Client.Constants.LayoutNames.Calendar);this.fixedCalendarTable=$("#"+t.prefix+Robotics.Client.Constants.TableNames.Calendar).fixedHeaderTable({altClass:"odd",footer:!1,fixedColumn:!0})};Robotics.Client.Controls.roDayDetailSchedule.prototype.createResumeTables=function(n,t){switch(n){case Robotics.Client.Constants.TableNames.Calendar:this.createPUnitTable(n,t)}};Robotics.Client.Controls.roDayDetailSchedule.prototype.createPUnitTable=function(n,t){var r=this.oBaseControl,u=$("#"+r.prefix+t),i;u.empty();i=$("<table><\/table>").attr("id",r.prefix+n).attr("class","fancyTable");i.append(this.createPUnitTableHeader(n,t));i.append(this.createPUnitTableBody(n,t));u.append(i)};Robotics.Client.Controls.roDayDetailSchedule.prototype.createPUnitTableHeader=function(n){var t=this.oBaseControl,d=t.oCalendar,l=$("<thead><\/thead>").attr("id",t.prefix+n+"_thead").attr("class","HeaderSelectable"),e=$("<tr><\/tr>"),p=$("<th><\/th>"),w=$("<div><\/div>").attr("class","DetailScheduleFixed CalendarFixedHeader"),a=$("<div><\/div>").attr("class","Position_DetailScheduleFixed CalendarSummaryFixedHeader"),v=$("<div><\/div>").attr("class","NorthCell"),o,s,h,r,u;v.append($("<div><\/div>").attr("class","ProductiveUnitHeaderText").html(Globalize.formatMessage("roPUnitPosition")));o=$("<div><\/div>").attr("class","SouthCell");o.append($("<div><\/div>").attr("class","EmpCellTextSouth").html(""));a.append(v,o);s=$("<div><\/div>").attr("class","Quantity_DetailScheduleFixed CalendarEmployeeFixedHeader");r=$("<div><\/div>").attr("class","NorthCell NorthCellHeaderEmployee");r.append($("<div><\/div>").attr("class","ProductiveUnitHeaderText").html(Globalize.formatMessage("roPUnitQuantity")));u=$("<div><\/div>").attr("class","SouthCell");u.append($("<div><\/div>").attr("class","EmpCellTextSouth").html(""));s.append(r,u);h=$("<div><\/div>").attr("class","EmployeeResume_DetailScheduleFixed CalendarEmployeeFixedHeader");r=$("<div><\/div>").attr("class","NorthCell NorthCellHeaderEmployee");r.append($("<div><\/div>").attr("class","ProductiveUnitHeaderText").html(Globalize.formatMessage("roPUnitEmployees")));u=$("<div><\/div>").attr("class","SouthCell");u.append($("<div><\/div>").attr("class","EmpCellTextSouth").html(""));h.append(r,u);e.append(p.append(w.append(a,s,h)));for(var f=moment(t.firstDate).add(-1,"days"),b=moment(t.firstDate).add(2,"days"),c=0;f<b;){if(c>=t.getMinDailyCell()&&c<t.getMaxDailyCell()){var k=$("<th><\/th>"),y=$("<div><\/div>").attr("id",t.ascxPrefix+"_calHeaderCell_"+i).attr("class","CalendarDayFixed ProductiveUnitDetailHeaderCell DailyCell").attr("data-IDColumn",i).attr("style","background:#F2F4F2 ");y.append($("<div><\/div>").attr("class","NorthCell dayInfo DailyCell").html(f.format("HH:mm")));e.append(k.append(y))}f=f.add(30,"minutes");c++}return l.append(e),l};Robotics.Client.Controls.roDayDetailSchedule.prototype.createPUnitTableBody=function(n){var u=this.oBaseControl,r=u.oCalendar,o=$("<tbody><\/tbody>").attr("id",u.prefix+n+"_tbody").attr("class","bodySelectable"),f,e,t,l,a;if(r!=null&&r.length>0)for(t=0;t<r.length;t++){var i=$("<tr><\/tr>"),h=$("<td><\/td>"),c=$("<div><\/div>").attr("class","DetailScheduleFixed CalendarFixedBody"),s=$("<div><\/div>").attr("class","Position_DetailScheduleFixed CalendarSummaryFixedBody");s.append(this.generatePositionSection(t,r[t]));f=$("<div><\/div>").attr("class","Quantity_DetailScheduleFixed CalendarEmployeeFixedBody");f.append(this.generateQuantitySection(t,r[t]));e=$("<div><\/div>").attr("class","EmployeeResume_DetailScheduleFixed CalendarEmployeeFixedBody");e.append(this.generateEmployeeResumeSection(t,r[t]));i.append(h.append(c.append(s,f,e)));this.descriptionExists=!1;this.buildPUnitModePostionRow(t,i);tmpCell=$('<td style="width:100%"><\/td>').html("&nbsp;");i.append(tmpCell);o.append(i)}else{var i=$("<tr><\/tr>"),h=$("<td><\/td>"),c=$("<div><\/div>").attr("class","DetailScheduleFixed CalendarFixedBody"),s=$("<div><\/div>").attr("class","Position_DetailScheduleFixed CalendarSummaryFixedBody"),f=$("<div><\/div>").attr("class","Quantity_DetailScheduleFixed CalendarEmployeeFixedBody"),e=$("<div><\/div>").attr("class","EmployeeResume_DetailScheduleFixed CalendarEmployeeFixedBody");for(i.append(h.append(c.append(s,f,e))),t=u.getMinDailyCell();t<u.getMaxDailyCell();t++)l=$("<td><\/td>"),a=$("<div><\/div>").attr("class","calendarOuterBodyCellInOtherDepartment DailyCell"),i.append(l.append(a));o.append(i)}return o};Robotics.Client.Controls.roDayDetailSchedule.prototype.generatePositionSection=function(n){var t=this.oBaseControl,r=t.oCalendar,i=$("<div><\/div>").attr("id",t.ascxPrefix+"_calPositionCell_"+n).attr("class","productiveUnit-position centerVerticallPUnitHeader");return i.attr("data-IDRow",n).html(n+1),i};Robotics.Client.Controls.roDayDetailSchedule.prototype.generateQuantitySection=function(n,t){var i=this.oBaseControl,s=i.oCalendar,r=$("<div><\/div>").attr("id",i.ascxPrefix+"_calQuantityCell_"+n).attr("data-IDRow",n).attr("class","centerVerticallPUnitHeader"),f=$("<div><\/div>").attr("class","qtyPosition"),e=$("<input>").attr({type:"text",id:i.ascxPrefix+"_qty_"+n,"data-IDRow":n,"class":"productiveUnit-quantity"});$(e).val(t.Quantity);f.append(e);r.append(f);var u=$("<div><\/div>").attr("class","actionsExpandable"),o=$("<div><\/div>").attr("data-IDRow",n).attr("class","fulfillEmployees fulfillEmployeesIcon").attr("title",Globalize.formatMessage("roFulfillEmployees"));return u.append(o),u.attr("style","margin-left:calc(50% - 8px)"),r.append(u),r};Robotics.Client.Controls.roDayDetailSchedule.prototype.generateEmployeeResumeSection=function(n,t){var i=this.oBaseControl,s=i.oCalendar,u=$("<div><\/div>").attr("id",i.ascxPrefix+"_calEmployeeResumeCell_"+n).attr("data-IDRow",n),o=$("<div><\/div>").attr({id:i.ascxPrefix+"_calEmployeeResumeCell_Lst_"+n,style:"min-height:80px;overflow-y: auto;","data-IDRow":n}),f,e,r;for(t.EmployeesData=t.EmployeesData.sortBy(function(n){return n.EmployeeName}),f=t.EmployeesData.length>=t.Quantity?!0:!1,e=t.Quantity-t.EmployeesData.length,r=0;r<e;r++)t.EmployeesData.unshift({IDEmployee:-1,EmployeeName:Globalize.formatMessage("roEmployeeNotAssigned")});return f&&t.IsExpandable&&t.EmployeesData.append({IDEmployee:-1,EmployeeName:Globalize.formatMessage("roEmployeeAddExtraEmployee")}),typeof this.employeeLists[n]=="undefined"&&(this.employeeLists[n]={ds:t.EmployeesData,instance:null,id:i.ascxPrefix+"_calEmployeeResumeCell_Lst_"+n}),u.append(o),u};Robotics.Client.Controls.roDayDetailSchedule.prototype.buildPUnitModePostionRow=function(n,t){for(var r=this.oBaseControl,u=r.oCalendar,f=u[n].ShiftHourData,i=r.getMinDailyCell();i<r.getMaxDailyCell();i++)t.append(this.createDailyCalendarCell(u[n],f[i],n,i))};Robotics.Client.Controls.roDayDetailSchedule.prototype.createDailyCalendarCell=function(n,t,i,r){var f=this.oBaseControl,o=f.oCalendar,e=$("<td><\/td>"),u;return r%2==0&&e.addClass("columnDailyCalendarOdd"),u=$("<div><\/div>").attr("id",f.ascxPrefix+"_calDailyCell_"+i+"_"+r).attr("class","calendarDailyBodyCell DailyCell DailySeparator"),u.attr("data-IDRow",i).attr("data-IDColumn",r),this.createDailyCalendarCellContent(u,n,t,r),e.append(u)};Robotics.Client.Controls.roDayDetailSchedule.prototype.createDailyCalendarCellContent=function(n,t,i,r){var f=this.oBaseControl,v=f.oCalendar,e=$("<div><\/div>").attr("class","calendarDailyInnerBodyCell"),o=null,s=t.ShiftData;if(i.DailyHourType!=Robotics.Client.Constants.DailyHourType.Untyped){var u="#ffffff",h="",c="",l="",a="";l=" - "+s.Name;c="border-bottom: 8px "+s.Color+" solid;";a="margin-top: -30px;";u=t.AssignmentData.Color;h=t.AssignmentData.Name;switch(i.DailyHourType){case Robotics.Client.Constants.DailyHourType.Complementary:u=(new Robotics.Client.Common.roHtmlColor).shadeBlendConvert(-.5,u)}(f.firstCellPrinted==-1&&i.DailyHourType!=Robotics.Client.Constants.DailyHourType.Untyped||r<f.firstCellPrinted)&&(f.firstCellPrinted=r);e.attr("style","background: "+u+";"+c);this.descriptionExists||r!=0&&i.DailyHourType==t.ShiftHourData[r-1].DailyHourType||(this.descriptionExists=!0,o=this.generateShiftTypeInfoDailyContainer(h+l,u,0,a))}n.append(null,e,o)};Robotics.Client.Controls.roDayDetailSchedule.prototype.generateShiftInfoDailyContainer=function(n,t){var r=this.oBaseControl,u=r.oCalendar,i=$("<div><\/div>").attr("class","calendarShiftInfoDailyContainer").attr("title",n).append($("<span class='fontBold calendarFeastLeft'><\/span>").html(n));return i.attr("style","color:"+(new Robotics.Client.Common.roHtmlColor).invertCssColor(t)),i};Robotics.Client.Controls.roDayDetailSchedule.prototype.generateShiftTypeInfoDailyContainer=function(n,t,i,r){var e=this.oBaseControl,o=e.oCalendar,u=n,f=$("<div><\/div>").attr("class","calendarShiftTypeInfoDailyContainer").attr("title",u).html(u);return f.attr("style","color:"+(new Robotics.Client.Common.roHtmlColor).invertCssColor(t)+";"+r),f};Robotics.Client.Controls.roDayDetailSchedule.prototype.endCallback=function(n,t,i){var r=this,u=this.oBaseControl,f=u.oCalendar;switch(n){case Robotics.Client.Constants.Actions.GetAvailablePositionEmployees:u.prepareBudgetEmployeesDialog(t,i);break;case Robotics.Client.Constants.Actions.GetAvailablePositionEmployeesForFulFill:r.assignPossibleEmployees(t,i);break;case Robotics.Client.Constants.Actions.AddEmployeePlanOnPosition:r.manageEmployeeList(t,!0);break;case Robotics.Client.Constants.Actions.RemoveEmployeeFromPosition:r.manageEmployeeList(t,!1);break;case Robotics.Client.Constants.Actions.UpdateProductiveUnitQuantity:r.resizeEmployeeList(t,!1)}n!=Robotics.Client.Constants.Actions.GetAvailablePositionEmployeesForFulFill&&this.loadingFunctionExtended(!1)};Robotics.Client.Controls.roDayDetailSchedule.prototype.resizeEmployeeList=function(n){var i=this,o=this.oBaseControl,s=o.oCalendar,t,r,f,e,u;if(n){for(t=s[Robotics.Client.Global.rowContext.id],r=Robotics.Client.Global.rowContext.id,t.Quantity=Robotics.Client.Global.rowContext.quantity,t.EmployeesData=t.EmployeesData.remove(function(n){return n.IDEmployee==-1}),f=t.EmployeesData.length>=t.Quantity?!0:!1,e=t.Quantity-t.EmployeesData.length,u=0;u<e;u++)t.EmployeesData.unshift({IDEmployee:-1,EmployeeName:Globalize.formatMessage("roEmployeeNotAssigned")});f&&t.IsExpandable&&t.EmployeesData.append({IDEmployee:-1,EmployeeName:Globalize.formatMessage("roEmployeeAddExtraEmployee")});i.employeeLists[r].instance.option("dataSource",{store:i.employeeLists[r].ds});Robotics.Client.Global.deferredItemData={oCalendar:null,d:null,itemData:null,idRow:-1};Robotics.Client.Global.rowContext={id:-1,oObject:null,quantity:0};$(".tooltipIndictmentsContainer").each(function(){var n=this.id,t=n.replace("_tooltipIndictmentsContainer_","_tooltipIndictments_");$("#"+n).dxTooltip({target:"#"+t,showEvent:{name:"mouseenter",delay:300},hideEvent:"mouseleave",position:"bottom"})});setTimeout(function(){i.refreshRowsHeight();i.loadingFunctionExtended(!1)},200)}};Robotics.Client.Controls.roDayDetailSchedule.prototype.manageEmployeeList=function(n,t){var u=this,c=this.oBaseControl,s=c.oCalendar,i,f,e,o,r,h;if(n){if(i=null,f=!1,t){for(i=s[Robotics.Client.Global.rowContext.id],e=Robotics.Client.Global.rowContext.id,i.EmployeesData=i.EmployeesData.remove(function(n){return n.IDEmployee==-1}),r=0;r<Robotics.Client.Global.rowContext.oObject.length;r++)i.EmployeesData.push(Object.clone(Robotics.Client.Global.rowContext.oObject[r],!0));for(i.EmployeesData=i.EmployeesData.sortBy(function(n){return n.EmployeeName}),f=i.EmployeesData.length>=i.Quantity?!0:!1,o=i.Quantity-i.EmployeesData.length,r=0;r<o;r++)i.EmployeesData.unshift({IDEmployee:-1,EmployeeName:Globalize.formatMessage("roEmployeeNotAssigned")})}else{for(i=s[Robotics.Client.Global.deferredItemData.idRow],e=Robotics.Client.Global.deferredItemData.idRow,i.EmployeesData=i.EmployeesData.remove(function(n){return n.IDEmployee==Robotics.Client.Global.deferredItemData.itemData.IDEmployee}),i.EmployeesData=i.EmployeesData.remove(function(n){return n.IDEmployee==-1}),i.EmployeesData=i.EmployeesData.sortBy(function(n){return n.EmployeeName}),f=i.EmployeesData.length>=i.Quantity?!0:!1,o=i.Quantity-i.EmployeesData.length,r=0;r<o;r++)i.EmployeesData.unshift({IDEmployee:-1,EmployeeName:Globalize.formatMessage("roEmployeeNotAssigned")});h=!0;Robotics.Client.Global.deferredItemData.d.resolve(!h)}f&&i.IsExpandable&&i.EmployeesData.append({IDEmployee:-1,EmployeeName:Globalize.formatMessage("roEmployeeAddExtraEmployee")});u.employeeLists[e].instance.option("dataSource",{store:u.employeeLists[e].ds});Robotics.Client.Global.deferredItemData={oCalendar:null,d:null,itemData:null,idRow:-1};Robotics.Client.Global.rowContext={id:-1,oObject:null};$(".tooltipIndictmentsContainer").each(function(){var n=this.id,t=n.replace("_tooltipIndictmentsContainer_","_tooltipIndictments_");$("#"+n).dxTooltip({target:"#"+t,showEvent:{name:"mouseenter",delay:300},hideEvent:"mouseleave",position:"bottom"})});setTimeout(function(){u.refreshRowsHeight();u.loadingFunctionExtended(!1)},200)}};Robotics.Client.Controls.roDayDetailSchedule.prototype.onAcceptBudgetEmployeesDialog=function(){var s=this,n=this.oBaseControl,u=n.oCalendar,t={},i=n.budgetEmployeesManager.getMultipleEmployeeSelection(),o=[],f=i.length,e,r;if(!u[Robotics.Client.Global.rowContext.id].IsExpandable)for(f=0,e=0;e<u[Robotics.Client.Global.rowContext.id].EmployeesData.length;e++)u[Robotics.Client.Global.rowContext.id].EmployeesData[e].IDEmployee<0&&(f+=1);for(f>i.length&&(f=i.length),r=0;r<f;r++)o.push({EmployeeName:i[r].EmployeeName,IDEmployee:i[r].IDEmployee,Alerts:{Indictments:Object.clone(i[r].Indictments,!0)},ShiftData:Object.clone(u[Robotics.Client.Global.rowContext.id].ShiftData,!0)});Robotics.Client.Global.rowContext.oObject=o;t.idOrgChartNode=parseInt(n.employeeFilter,10);t.pUnitModePosition=u[Robotics.Client.Global.rowContext.id];t.sDate=n.firstDate;t.employeeData=Robotics.Client.Global.rowContext.oObject;t.StampParam=(new Date).getMilliseconds();n.performAction(t,Robotics.Client.Constants.Actions.AddEmployeePlanOnPosition);n.budgetEmployeesDialog.dialog("close")};Robotics.Client.Controls.roDayDetailSchedule.prototype.prepareBudgetEmployeesDialog=function(n,t){var r=this.oBaseControl,u=r.oCalendar,f=Robotics.Client.Global.rowContext.id,i={};i.pUnit=this.selectedPUnit;i.pUnitMode=this.selectedPUnitMode;i.pUnitModePosition=u[f];i.sDate=r.firstDate;r.budgetEmployeesDialog.dialog("open");r.budgetEmployeesManager.InitializeDialog(n,t,i)};Robotics.Client.Controls.roDayDetailSchedule.prototype.assignPossibleEmployees=function(n){var r=this.oBaseControl,f=r.oCalendar,h=Robotics.Client.Global.rowContext.id,e=f[h],o=e.Quantity,s,u,i,t;if(n.length!=0){for(s=[],u=0;u<e.EmployeesData.length;u++)e.EmployeesData[u].IDEmployee>0&&(o-=1);for(i=0;i<o;i++)i<n.length&&s.push({EmployeeName:n[i].EmployeeName,IDEmployee:n[i].IDEmployee,ShiftData:Object.clone(f[Robotics.Client.Global.rowContext.id].ShiftData,!0)});Robotics.Client.Global.rowContext.oObject=s;t={};t.idOrgChartNode=parseInt(r.employeeFilter,10);t.pUnitModePosition=f[Robotics.Client.Global.rowContext.id];t.sDate=r.firstDate;t.employeeData=Robotics.Client.Global.rowContext.oObject;t.StampParam=(new Date).getMilliseconds();r.performAction(t,Robotics.Client.Constants.Actions.AddEmployeePlanOnPosition)}else this.loadingFunctionExtended(!1);n.length<o&&DevExpress.ui.dialog.alert(Globalize.formatMessage("roNotEnoughtEmployees"),Globalize.formatMessage("roAlert"))},function(){var n=function(n){for(var r=n.split("."),i=window,t=0;t<r.length;t+=1)i=i[r[t]]=i[r[t]]||{};return i};n("Robotics.Client.Controls");n("Robotics.Client.Language");n("Robotics.Client.Constants")}();Robotics.Client.Controls.roCalendar=function(ascxPrefix,typeView,loadingFunction,showErrorFunction,calendarStateCookie){var clientConfig,cookieValue;this.showErrorPopup=showErrorFunction;this.workMode=parseInt($("#"+ascxPrefix+"_hdnCalendarWorkMode").val(),10);this.clientInstanceName=$("#"+ascxPrefix+"_hdnClientInstanceName").val();this.typeView=typeView;this.viewRange=Robotics.Client.Constants.ViewRange.Period;clientConfig=eval(ascxPrefix+"_hdnCalendarConfigClient");this.cConfig=clientConfig;this.isScheduleActive=clientConfig.Get("HRScheduling");this.saasPremiumActive=clientConfig.Get("SaasPremium");this.isStarter=clientConfig.Get("VTLiveEdition").toLowerCase()=="starter";this.telecommuteEnabled=clientConfig.Get("TelecommuteEnabled");this.languageKey=clientConfig.Get("Language");this.loadHugeDataValue=clientConfig.Get("MinimumCalendarDataWarning");this.translator=new Robotics.Client.Language.translator(clientConfig);this.ascxPrefix=ascxPrefix;this.prefix=ascxPrefix+"_roCalendarRender";this.container=$("#"+ascxPrefix+"_roCalendarRender");this.loadingFunc=loadingFunction;this.requestObject=eval(ascxPrefix+"_ASPxRoCalendarCallbackClient");this.setTypeView(this.typeView);this.pageLayout=null;this.firstCellPrinted=-1;this.remarksColor=["#f00","#ff0","#228b22"];this.firstDate=null;this.endDate=null;this.employeeFilter="";this.calendarStateCookie=calendarStateCookie;cookieValue=(localStorage.getItem(this.calendarStateCookie)||"false@@0@false@false@30").split("@");this.dailyPeriod=30;cookieValue.length>4&&typeof cookieValue[5]!="undefined"&&(this.dailyPeriod=parseInt(cookieValue[5],10));this.loadRecursive=cookieValue[0]=="false"?!1:!0;this.assignmentsFilter=cookieValue[1];this.schedulingView=cookieValue[2]=="0"?Robotics.Client.Constants.CoverageDayView.Planified:Robotics.Client.Constants.CoverageDayView.Real;this.loadIndictments=!1;this.loadCapacities=!1;this.loadPunches=!1;typeof cookieValue[4]!="undefined"&&(cookieValue[4]=="false"?!1:!0);this.oCalendar=null;this.hasChanges=!1;this.selectedEmployee=null;this.selectedDay=null;this.selectedContainer=null;this.selectedMinRow=-1;this.selectedMaxRow=-1;this.selectedMinColumn=-1;this.selectedMaxColumn=-1;this.selectionCopied=!1;this.selectedHeaderContainer=null;this.selectedMinHeaderColumn=-1;this.selectedMaxHeaderColumn=-1;this.selectionHeaderCopied=!1;this.copyWorkingShifts=!1;this.copyHolidaysShifts=!1;this.copyAssignmentsShifts=!1;this.ctrlDown=!1;this.shiftDown=!1;this.shiftKey=16;this.ctrlKey=17;this.vKey=86;this.cKey=67;this.copyDialog=this.createCopyDialog();this.advCopyDialog=this.createAdvancedCopyDialog();this.importDialog=this.createImportDialog();this.complementaryDialog=this.createComplementaryDialog();this.errorDialog=this.createErrorDialog(!1);this.importErrorDialog=this.createErrorDialog(!0);this.filterCalendarDialog=this.createFilterCalendarDialog();this.assignmentsDialog=this.createAssignmentsDialog();this.calendarSortDialog=this.createSortCalendarDialog();this.shiftsDialog=this.createShiftsDialog();this.pUnitsDialog=this.createPUnitsDialog();this.budgetEmployeesDialog=this.createBudgetEmployeesDialog();this.editDailyViewDialog=this.createDailyConfig();this.starterDialog=this.createStarterDialog();this.sourceDialogRow=-1;this.sourceDialogColumn=-1;this.files=null;this.showStarterDialog=!1;this.showComplementaryAssignDialog=!1;this.complementaryShift=null;this.showAssignmentsDialog=!1;this.assignmentShift=null;this.starterShift=null;this.isShowingDialog=!1;this.refreshTimmer=-1;this.timmerEnabled=!0;this.isShowingLoader=!1;this.capacityError=!1;this.capatityEnabled=!1;this.shiftsList={};this.capacityList={};this.assignmentsList={};this.columnShiftsList={};this.columnCapacityList={};this.rowsShiftsList={};this.employeeDataList={};this.columnAssignmentsList={};this.rowsAssignmentsList={};this.accrualsTotal={PlannedHours:{WorkingHours:0,ComplementaryHours:0},HolidayResume:{AssignedHolidays:0}};this.shiftsExtendedDataCache={};this.starterManager=new Robotics.Client.Controls.Forms.StarterForm(this.ascxPrefix+"_dlgStarter",showErrorFunction);this.complementaryManager=new Robotics.Client.Controls.Forms.ComplementaryForm(this.ascxPrefix+"_dlgComplementary",showErrorFunction);this.assignmentsManager=new Robotics.Client.Controls.Forms.AssignmentsForm(this.ascxPrefix+"_dlgAssignments",showErrorFunction);this.shiftSelectorManager=new Robotics.Client.Controls.Forms.ShiftSelectorForm(this.ascxPrefix+"_dlgShiftSelector",showErrorFunction);this.pUnitSelectorManager=new Robotics.Client.Controls.Forms.PUnitSelectorForm(this.ascxPrefix+"_dlgProductiveUnitSelector",showErrorFunction);this.budgetEmployeesManager=new Robotics.Client.Controls.Forms.BudgetAddEmployeeForm(this.ascxPrefix+"_dlgBudgetAddEmployees",showErrorFunction);this.advCopyManager=new Robotics.Client.Controls.Forms.AdvCopyForm(this.ascxPrefix+"_dlgAdvCopy",this.workMode);this.onContinueFunc="";this.defaultMessageAction='window.frames["ifPrincipal"].focus();';this.sortElements="assignment,group,employee,shift,budget";this.sortColumn=-1;this.loadingInfo={initializing:!1,firstDate:undefined,endDate:undefined,employeeFilter:undefined,loadRecursive:undefined,typeView:undefined,calendarFilter:undefined,loadIndictments:undefined,loadPunches:undefined,loadCapacities:undefined};this.lastSelectionLoaded={employeeFilter:"11110",loadRecursive:!1,firstDate:moment().startOf("week").toDate(),endDate:moment().add(1,"week").endOf("week").toDate()}};Robotics.Client.Controls.roCalendar.prototype.setTypeView=function(n){var t,i,r,u;this.typeView=n;t="";i="";this.clientMode!=null&&(t=this.clientMode.name);switch(this.workMode){case Robotics.Client.Constants.WorkMode.roCalendar:this.clientMode=new Robotics.Client.Controls.roSchedulerCalendar(this);break;case Robotics.Client.Constants.WorkMode.roProductiveUnit:this.dailyPeriod=30;this.clientMode=new Robotics.Client.Controls.roProductiveUnitCalendar(this);break;case Robotics.Client.Constants.WorkMode.roDayDetail:this.dailyPeriod=30;this.typeView==Robotics.Client.Constants.TypeView.DayDetail?this.clientMode=new Robotics.Client.Controls.roDayDetailCalendar(this):this.typeView==Robotics.Client.Constants.TypeView.DaySchedule&&(this.clientMode=new Robotics.Client.Controls.roDayDetailSchedule(this));break;case Robotics.Client.Constants.WorkMode.roBudget:this.dailyPeriod=30;r=this.clientMode!=null?this.clientMode.OnSelectedCell:null;u=this.clientMode!=null?this.clientMode.OnDayClick:null;this.typeView==Robotics.Client.Constants.TypeView.Definition?this.clientMode=new Robotics.Client.Controls.roBudgetCalendarDefinition(this):this.typeView==Robotics.Client.Constants.TypeView.Planification?this.clientMode=new Robotics.Client.Controls.roBudgetCalendarSchedule(this):this.typeView==Robotics.Client.Constants.TypeView.Detail&&(this.clientMode=new Robotics.Client.Controls.roBudgetCalendarDetail(this));this.clientMode.OnSelectedCell=r;this.clientMode.OnDayClick=u;break;default:this.clientMode=new Robotics.Client.Controls.roSchedulerCalendar(this)}i=this.clientMode.name;i!=t&&this.pageLayout!=null&&(this.pageLayout.destroy(),this.pageLayoutOptions=this.clientMode.getLayout(),this.workMode==Robotics.Client.Constants.WorkMode.roBudget&&this.clientMode.create())};Robotics.Client.Controls.roCalendar.prototype.setFiltersCookieValue=function(){localStorage.setItem(this.calendarStateCookie,(this.loadRecursive?"true":"false")+"@"+this.assignmentsFilter+"@"+(this.schedulingView==Robotics.Client.Constants.CoverageDayView.Planified?"0":"1")+"@"+(this.loadIndictments?"true":"false")+"@"+(this.loadPunches?"true":"false")+"@"+(this.loadCapacities?"true":"false")+"@"+this.dailyPeriod)};Robotics.Client.Controls.roCalendar.prototype.initialize=function(){this.selectedMinRow=-1;this.selectedMaxRow=-1;this.selectedMinColumn=-1;this.selectedMaxColumn=-1;this.selectedMinHeaderColumn=-1;this.selectedMaxHeaderColumn=-1;this.copyWorkingShifts=!1;this.copyHolidaysShifts=!1;this.copyAssignmentsShifts=!1;this.selectedEmployee=null;this.selectedDay=null;this.selectedContainer=null;this.selectedHeaderContainer=null;this.hasChanges=!1;this.selectionCopied=!1;this.selectionHeaderCopied=!1;this.refreshTimmer!=-1&&clearTimeout(this.refreshTimmer);this.refreshTimmer=-1;this.isShowingDialog=!1;this.columnShiftsList={};this.rowsShiftsList={};this.shiftsList={};this.assignmentsList={};this.employeeDataList={};this.rowsAssignmentsList={};this.columnsAssignmentsList={}};Robotics.Client.Controls.roCalendar.prototype.isBatchMode=function(){return this.selectedMinRow!=this.selectedMaxRow||this.selectedMinColumn!=this.selectedMaxColumn?!0:!1};Robotics.Client.Controls.roCalendar.prototype.performAction=function(n,t,i){n.action=t;var r=JSON.stringify(n);r=encodeURIComponent(r);(typeof i=="undefined"||typeof i!="undefined"&&i==!0)&&this.clientMode.loadingFunctionExtended(!0);this.requestObject.PerformCallback(r)};Robotics.Client.Controls.roCalendar.prototype.loadingFunctionExtended=function(n){this.clientMode.loadingFunctionExtended(n)};Robotics.Client.Controls.roCalendar.prototype.showChangesWarning=function(n){this.onContinueFunc=n;this.loadingFunctionExtended(!1);var t='window.frames["ifPrincipal"].'+this.clientInstanceName+'.saveAndContinue();window.frames["ifPrincipal"].focus();',i='window.frames["ifPrincipal"].'+this.clientInstanceName+'.discardAndContinue();window.frames["ifPrincipal"].focus();';this.showErrorPopup("Info.Title","info","Calendar.Client.SelectOption","","Info.SaveContinue","Info.SaveContinueDesc",t,"Info.DiscardContinue","Info.DiscardContinueDesc",i,"Info.Cancel","Info.CancelDesc",'window.frames["ifPrincipal"].focus();')};Robotics.Client.Controls.roCalendar.prototype.showCapacityWarning=function(){var n='window.frames["ifPrincipal"].'+this.clientInstanceName+'.clientMode.saveChangesFinally();window.frames["ifPrincipal"].focus();';this.showErrorPopup("Capacity.Title","info","Calendar.Client.SelectOption","","Info.SaveAnyway","Info.SaveAnywayDesc",n,"Info.CancelAndCorrect","Info.CancelAndCorrectDesc",'window.frames["ifPrincipal"].focus();')};Robotics.Client.Controls.roCalendar.prototype.getEmployeeCountResume=function(){return this.clientMode.getEmployeeCountResume()};Robotics.Client.Controls.roCalendar.prototype.create=function(){this.clientMode.create()};Robotics.Client.Controls.roCalendar.prototype.saveAndContinue=function(){this.clientMode.saveAndContinue()};Robotics.Client.Controls.roCalendar.prototype.discardAndContinue=function(){this.clientMode.discardAndContinue()};Robotics.Client.Controls.roCalendar.prototype.refresh=function(){var n=this;if(this.loadingInfo.initializing)n.refreshHugeData();else{let t={Filter:this.employeeFilter,Recursive:this.loadRecursive,When:moment(this.firstDate).format("YYYYMMDD")};this.loadingInfo.loadRecursive=this.loadRecursive;$.ajax({type:"POST",url:"./../Employee/GetEmployeeCount",dataType:"json",data:{Filter:t},success:function(t){let i=moment(n.endDate).diff(moment(n.firstDate),"days")+1;if(n.loadHugeDataValue>0&&n.loadHugeDataValue<=parseInt(t,10)*i){n.loadingFunc(!1);let t='window.frames["ifPrincipal"].'+n.clientInstanceName+'.refreshHugeData();window.frames["ifPrincipal"].focus();',i='window.frames["ifPrincipal"].'+n.clientInstanceName+'.discardHugeData();window.frames["ifPrincipal"].focus();';n.showErrorPopup("loadcalendardata.title","info","Calendar.Client.SelectOption","","Info.loadcalendardata","Info.loadcalendardatadesc",t,"Info.cancelloadcalendardata","Info.cancelloadcalendardatarefreshdesc",i)}else n.lastSelectionLoaded={employeeFilter:n.loadingInfo.employeeFilter,loadRecursive:n.loadingInfo.loadRecursive,firstDate:n.loadingInfo.firstDate,endDate:n.loadingInfo.endDate},n.refreshHugeData()},error:function(){}})}};Robotics.Client.Controls.roCalendar.prototype.refreshHugeData=function(){this.clientMode.refresh()};Robotics.Client.Controls.roCalendar.prototype.generateLoadFilters=function(){return this.clientMode.generateLoadFilters()};Robotics.Client.Controls.roCalendar.prototype.loadData=function(n,t,i,r,u,f,e,o,s){var h=this;i=typeof i!="undefined"&&i!=null?i:this.employeeFilter;r=typeof r!="undefined"&&r!=null?r:this.loadRecursive;n=typeof n!="undefined"&&n!=null?n:this.firstDate;t=typeof t!="undefined"&&t!=null?t:this.endDate;this.loadingInfo={initializing:!1,firstDate:n,endDate:t,employeeFilter:i,loadRecursive:r,typeView:u,calendarFilter:f,loadIndictments:e,loadPunches:o,loadCapacities:s};let c={Filter:i,Recursive:r,When:moment(n).format("YYYYMMDD")};i==this.employeeFilter&&moment(n).format("YYYYMMDD")==moment(this.firstDate).format("YYYYMMDD")&&moment(t).format("YYYYMMDD")==moment(this.endDate).format("YYYYMMDD")?h.loadHugeData():$.ajax({type:"POST",url:"./../Employee/GetEmployeeCount",dataType:"json",data:{Filter:c},success:function(n){let t=moment(h.loadingInfo.endDate).diff(moment(h.loadingInfo.firstDate),"days")+1;if(h.loadHugeDataValue>0&&h.loadHugeDataValue<=parseInt(n,10)*t){h.loadingFunc(!1);let n='window.frames["ifPrincipal"].'+h.clientInstanceName+'.loadHugeData();window.frames["ifPrincipal"].focus();',t='window.frames["ifPrincipal"].'+h.clientInstanceName+'.discardHugeData();window.frames["ifPrincipal"].focus();';h.showErrorPopup("loadcalendardata.title","info","Calendar.Client.SelectOption","","Info.loadcalendardata","Info.loadcalendardatadesc",n,"Info.cancelloadcalendardata","Info.cancelloadcalendardatadesc",t)}else h.lastSelectionLoaded={employeeFilter:h.loadingInfo.employeeFilter,loadRecursive:h.loadingInfo.loadRecursive,firstDate:h.loadingInfo.firstDate,endDate:h.loadingInfo.endDate},h.loadHugeData()},error:function(){}})};Robotics.Client.Controls.roCalendar.prototype.discardHugeData=function(){if(this.clientMode.loadingFunctionExtended(!0),this.loadingInfo.employeeFilter!=this.lastSelectionLoaded.employeeFilter){if(typeof window.frames.ifEmployeeSelector.currentView!="undefined"&&window.frames.ifEmployeeSelector.currentView!=null){const n=JSON.parse(localStorage.getItem("empMVCSelector"));n.view.ComposeFilter=this.lastSelectionLoaded.employeeFilter.split("")[0];n.view.Employees=[];n.view.Groups=[];n.timestamp=Date.now();n.view.ComposeFilter.split(",").forEach(function(t){t.indexOf("A")==0?n.view.Groups.push({IdGroup:t.replace("A",""),Name:""}):t.indexOf("B")==0&&n.view.Employees.push({IdEmployee:t.replace("B",""),Name:""})});window.frames.ifEmployeeSelector.currentView=n.view;localStorage.setItem("empMVCSelector",JSON.stringify(n))}this.loadingInfo.employeeFilter=this.lastSelectionLoaded.employeeFilter}if(this.loadingInfo.loadRecursive!=this.lastSelectionLoaded.loadRecursive&&(typeof this.clientMode.setRecursiveData=="function"&&this.clientMode.setRecursiveData(),this.loadingInfo.loadRecursive=this.lastSelectionLoaded.loadRecursive),moment(this.loadingInfo.firstDate).format("YYYYMMDD")!=moment(this.lastSelectionLoaded.firstDate).format("YYYYMMDD")||moment(this.loadingInfo.endDate).format("YYYYMMDD")!=moment(this.lastSelectionLoaded.endDate).format("YYYYMMDD")){this.loadingInfo.firstDate=moment().startOf("week").toDate();this.loadingInfo.endDate=moment().add(1,"week").endOf("week").toDate();let n=FormateaFecha(moment().startOf("week").toDate())+","+FormateaFecha(moment().add(1,"week").endOf("week").toDate());localStorage.setItem("SchedulerIntervalDates",n);localStorage.setItem("PlanView","2");try{forceRefresh=!1;LoadDateSelector(this.cConfig.Get("Language"));forceRefresh=!0}catch(t){}}this.loadHugeData()};Robotics.Client.Controls.roCalendar.prototype.loadHugeData=function(){this.clientMode.loadingFunctionExtended(!0);this.loadingFunc(!0);this.loadingInfo.initializing=!0;this.clientMode.loadData(this.loadingInfo.firstDate,this.loadingInfo.endDate,this.loadingInfo.employeeFilter,this.loadingInfo.loadRecursive,this.loadingInfo.typeView,this.loadingInfo.calendarFilter,this.loadingInfo.loadIndictments,this.loadingInfo.loadPunches,this.loadingInfo.loadCapacities);this.loadingInfo.initializing=!1};Robotics.Client.Controls.roCalendar.prototype.saveChanges=function(){this.clientMode.saveChanges()};Robotics.Client.Controls.roCalendar.prototype.refreshDayWithParams=function(n,t){this.clientMode.refreshDayWithParams(n,t)};Robotics.Client.Controls.roCalendar.prototype.setHasChanges=function(n){this.clientMode.setHasChanges(n)};Robotics.Client.Controls.roCalendar.prototype.endCallback=function(n,t,i){this.clientMode.endCallback(n,t,i)};Robotics.Client.Controls.roCalendar.prototype.setCallbackReturnData=function(n,t){this.clientMode.setCallbackReturnData(n,t)};Robotics.Client.Controls.roCalendar.prototype.refreshFullDay=function(){this.clientMode.refreshFullDay()};Robotics.Client.Controls.roCalendar.prototype.onDrop=function(n){this.clientMode.onDrop(n)};Robotics.Client.Controls.roCalendar.prototype.createImportDialog=function(){var n=this;$("#"+n.ascxPrefix+"_dlgImport_txtFileToImport").on("change",function(t){n.prepareUpload(t,n)});return $("#"+n.ascxPrefix+"_dlgImport_frm").dialog({autoOpen:!1,height:"auto",width:"auto",modal:!0,resizable:!1,draggable:!1,buttons:[{text:n.translator.translate(Robotics.Client.Language.Tags.Accept),"class":"btnFlat btnFlatBlack",click:function(){n.launchImport()}},{text:n.translator.translate(Robotics.Client.Language.Tags.Cancel),"class":"btnFlat btnFlatBlack",click:function(){n.importDialog.dialog("close")}}],close:function(){}})};Robotics.Client.Controls.roCalendar.prototype.importFromExcel=function(){$("#"+this.ascxPrefix+"_dlgImport_txtFileToImport").val("");eval(this.ascxPrefix+"_dlgImport_ckImportCopyMainShiftsClient").SetChecked(!0);eval(this.ascxPrefix+"_dlgImport_ckImportCopyHolidaysClient").SetChecked(!1);eval(this.ascxPrefix+"_dlgImport_ckImportKeepHolidaysClient").SetChecked(!0);eval(this.ascxPrefix+"_dlgImport_ckImportKeepBloquedDaysClient").SetChecked(!0);this.importDialog.dialog("open")};Robotics.Client.Controls.roCalendar.prototype.prepareUpload=function(n,t){t.files=n.target.files};Robotics.Client.Controls.roCalendar.prototype.launchImport=function(){var t=new FormData,n=this;this.files.length>0&&t.append("importFile",this.files[0]);$.ajax({url:"../Base/WebUserControls/roCalendar/Handlers/srvCalendarImport.ashx",type:"POST",data:t,cache:!1,dataType:"json",processData:!1,contentType:!1,success:function(){n.importDialog.dialog("close");n.finallyImportFile()},error:function(){n.showErrorPopup("Error.Title","error","Calendar.Client.UploadFile","","Error.OK","Error.OKDesc",n.defaultMessageAction)}})};Robotics.Client.Controls.roCalendar.prototype.finallyImportFile=function(){this.clientMode.importFile()};Robotics.Client.Controls.roCalendar.prototype.exportToExcel=function(){this.clientMode.exportToExcel()};Robotics.Client.Controls.roCalendar.prototype.createFilterCalendarDialog=function(){var n=this,t=[];return t=[{text:n.translator.translate(Robotics.Client.Language.Tags.Empty),"class":"btnFlat btnFlatBlack",click:function(){n.clearFilterAssignments();n.filterCalendarDialog.dialog("close")}},{text:n.translator.translate(Robotics.Client.Language.Tags.Accept),"class":"btnFlat btnFlatBlack",click:function(){n.changeFilterAssignments();n.filterCalendarDialog.dialog("close")}},{text:n.translator.translate(Robotics.Client.Language.Tags.Cancel),"class":"btnFlat btnFlatBlack",click:function(){n.filterCalendarDialog.dialog("close")}}],$("#"+n.ascxPrefix+"_dlgFilterCalendar_frm").dialog({autoOpen:!1,height:"auto",width:"350px",modal:!0,resizable:!1,draggable:!1,buttons:t,close:function(){}})};Robotics.Client.Controls.roCalendar.prototype.changeFilterAssignments=function(){this.clientMode.changeFilterAssignments()};Robotics.Client.Controls.roCalendar.prototype.openFilterAssignments=function(){var oCal=this,assignmentsGrid=eval(this.ascxPrefix+"_dlgFilterCalendar_grdAssignmentsClient"),rbPlannedView=eval(this.ascxPrefix+"_dlgFilterCalendar_rbPlannedView"),rbRealView=eval(this.ascxPrefix+"_dlgFilterCalendar_rbRealView"),keys,tmpIndex;if(oCal.assignmentsFilter!=""){if(keys=[],typeof assignmentsGrid!="undefined"&&assignmentsGrid!=null){for(tmpIndex=0;tmpIndex<oCal.assignmentsFilter.split(",").length;tmpIndex++)keys.push(parseInt(oCal.assignmentsFilter.split(",")[tmpIndex],10));assignmentsGrid.SelectRowsByKey(keys)}}else typeof assignmentsGrid!="undefined"&&assignmentsGrid!=null&&assignmentsGrid.UnselectRows();oCal.schedulingView==Robotics.Client.Constants.CoverageDayView.Planified?rbPlannedView.SetChecked(!0):rbRealView.SetChecked(!0);oCal.filterCalendarDialog.dialog("open")};Robotics.Client.Controls.roCalendar.prototype.clearFilterAssignments=function(){this.assignmentsFilter="";this.schedulingView=Robotics.Client.Constants.CoverageDayView.Planified;this.setFiltersCookieValue();this.refresh()};Robotics.Client.Controls.roCalendar.prototype.buildErrorMessage=function(objResult,isImport){var errorText="",i,destiny;if(objResult.CalendarDataResult!=null)for(i=0;i<objResult.CalendarDataResult.length;i++)errorText!=""&&(errorText+="\r\n"),errorText+=objResult.CalendarDataResult[i].ErrorText;if(objResult.BudgetDataResult!=null)for(i=0;i<objResult.BudgetDataResult.length;i++)errorText!=""&&(errorText+="\r\n"),errorText+=objResult.BudgetDataResult[i].ErrorText;destiny=isImport?eval(this.ascxPrefix+"_dlgImportError_txtErrorMemoClient"):eval(this.ascxPrefix+"_dlgError_txtErrorMemoClient");destiny.SetValue(errorText)};Robotics.Client.Controls.roCalendar.prototype.parseErrorMessage=function(n,t){var i=!1;switch(n){case Robotics.Client.Constants.Actions.SaveBudgetAndContinue:case Robotics.Client.Constants.Actions.SaveBudgetChanges:case Robotics.Client.Constants.Actions.SaveAndContinue:case Robotics.Client.Constants.Actions.SaveChanges:this.buildErrorMessage(t,!1);this.errorDialog.dialog("open");i=!0}return i};Robotics.Client.Controls.roCalendar.prototype.showDailyConfig=function(){var oCal=this,rbviewmode=eval(oCal.ascxPrefix+"_dlgEditDailyView_rbViewModesClient");rbviewmode.SetValue(oCal.dailyPeriod+"");this.editDailyViewDialog.dialog("open")};Robotics.Client.Controls.roCalendar.prototype.createDailyConfig=function(){var oCal=this,formID="",buttons=[];return formID="#"+oCal.ascxPrefix+"_dlgEditDailyView_frm",buttons=[{text:oCal.translator.translate(Robotics.Client.Language.Tags.Accept),"class":"btnFlat btnFlatBlack",click:function(){var rbviewmode=eval(oCal.ascxPrefix+"_dlgEditDailyView_rbViewModesClient");oCal.dailyPeriod=parseInt(rbviewmode.GetValue(),10);oCal.setFiltersCookieValue();oCal.refresh();oCal.editDailyViewDialog.dialog("close")}},{text:oCal.translator.translate(Robotics.Client.Language.Tags.Cancel),"class":"btnFlat btnFlatBlack",click:function(){oCal.editDailyViewDialog.dialog("close")}}],$(formID).dialog({autoOpen:!1,height:"auto",width:"350px",modal:!0,resizable:!1,draggable:!1,buttons:buttons,close:function(){}})};Robotics.Client.Controls.roCalendar.prototype.createErrorDialog=function(n){var t=this,i="",r=[];return n?(i="#"+t.ascxPrefix+"_dlgImportError_frm",r=[{id:"btDownload",text:t.translator.translate(Robotics.Client.Language.Tags.Download),"class":"btnFlat btnFlatBlack",click:function(){window.open("./../Base/WebUserControls/roCalendar/Wizards/downloadCalendar.aspx")}},{text:t.translator.translate(Robotics.Client.Language.Tags.Accept),"class":"btnFlat btnFlatBlack",click:function(){t.importErrorDialog.dialog("close")}}]):(i="#"+t.ascxPrefix+"_dlgError_frm",r=[{text:t.translator.translate(Robotics.Client.Language.Tags.Accept),"class":"btnFlat btnFlatBlack",click:function(){t.errorDialog.dialog("close")}}]),$(i).dialog({autoOpen:!1,height:"auto",width:"350px",modal:!0,resizable:!1,draggable:!1,buttons:r,close:function(){}})};Robotics.Client.Controls.roCalendar.prototype.createSortCalendarDialog=function(){var n=this;return $(".sortCalendar").sortable({stop:function(){n.sortElements="";$(".sortCalendar li").each(function(t,i){var r=$(i).attr("data-orderElement");n.sortElements+=r+","});n.sortElements!=""&&(n.sortElements=n.sortElements.substring(0,n.sortElements.length-1))}}),$(".sortCalendar").disableSelection(),$("#"+n.ascxPrefix+"_dlgSortCalendar_frm").dialog({autoOpen:!1,height:"auto",width:"250px",modal:!0,resizable:!1,draggable:!1,buttons:[{text:n.translator.translate(Robotics.Client.Language.Tags.Accept),"class":"btnFlat btnFlatBlack",click:function(){n.sortCalendar()}},{text:n.translator.translate(Robotics.Client.Language.Tags.Cancel),"class":"btnFlat btnFlatBlack",click:function(){n.calendarSortDialog.dialog("close")}}],close:function(){}})};Robotics.Client.Controls.roCalendar.prototype.sortCalendar=function(){this.clientMode.sortCalendar()};Robotics.Client.Controls.roCalendar.prototype.createShiftsDialog=function(){var n=this;return $("#"+n.ascxPrefix+"_dlgShiftSelector_frm").dialog({autoOpen:!1,height:"auto",width:"auto",modal:!0,resizable:!1,draggable:!1,buttons:[{text:Globalize.formatMessage("roNext"),"class":"btnFlat btnFlatBlack",click:function(){n.onAcceptShiftsDialog()}},{text:n.translator.translate(Robotics.Client.Language.Tags.Cancel),"class":"btnFlat btnFlatBlack",click:function(){n.shiftsDialog.dialog("close")}}],close:function(){}})};Robotics.Client.Controls.roCalendar.prototype.onAcceptShiftsDialog=function(){this.clientMode.onAcceptShiftsDialog()};Robotics.Client.Controls.roCalendar.prototype.prepareShfitsDialog=function(n){this.clientMode.prepareShfitsDialog(n)};Robotics.Client.Controls.roCalendar.prototype.createPUnitsDialog=function(){var n=this;return $("#"+n.ascxPrefix+"_dlgProductiveUnitSelector_frm").dialog({autoOpen:!1,height:"auto",width:"auto",modal:!0,resizable:!1,draggable:!1,buttons:[{text:Globalize.formatMessage("roNext"),"class":"btnFlat btnFlatBlack",click:function(){n.onAcceptPUnitsDialog()}},{text:n.translator.translate(Robotics.Client.Language.Tags.Cancel),"class":"btnFlat btnFlatBlack",click:function(){n.pUnitsDialog.dialog("close")}}],close:function(){}})};Robotics.Client.Controls.roCalendar.prototype.onAcceptPUnitsDialog=function(){this.clientMode.onAcceptPUnitsDialog()};Robotics.Client.Controls.roCalendar.prototype.preparePUnitsDialog=function(n){this.clientMode.preparePUnitsDialog(n)};Robotics.Client.Controls.roCalendar.prototype.createBudgetEmployeesDialog=function(){var n=this;return $("#"+n.ascxPrefix+"_dlgBudgetAddEmployees_frm").dialog({autoOpen:!1,height:"auto",width:"1100px",modal:!0,resizable:!1,draggable:!1,buttons:[{text:Globalize.formatMessage("roAssign"),"class":"btnFlat btnFlatBlack",click:function(){n.onAcceptBudgetEmployeesDialog()}},{text:n.translator.translate(Robotics.Client.Language.Tags.Cancel),"class":"btnFlat btnFlatBlack",click:function(){n.budgetEmployeesDialog.dialog("close")}}],close:function(){}})};Robotics.Client.Controls.roCalendar.prototype.onAcceptBudgetEmployeesDialog=function(){this.clientMode.onAcceptBudgetEmployeesDialog()};Robotics.Client.Controls.roCalendar.prototype.prepareBudgetEmployeesDialog=function(n,t){this.clientMode.prepareBudgetEmployeesDialog(n,t)};Robotics.Client.Controls.roCalendar.prototype.createAssignmentsDialog=function(){var n=this;return $("#"+n.ascxPrefix+"_dlgAssignments_frm").dialog({autoOpen:!1,height:"auto",width:"auto",modal:!0,resizable:!1,draggable:!1,buttons:[{text:n.translator.translate(Robotics.Client.Language.Tags.Accept),"class":"btnFlat btnFlatBlack",click:function(){n.onAcceptAssignmentsDialog()}},{text:n.translator.translate(Robotics.Client.Language.Tags.Cancel),"class":"btnFlat btnFlatBlack",click:function(){n.assignmentsDialog.dialog("close")}}],close:function(){}})};Robotics.Client.Controls.roCalendar.prototype.onAcceptAssignmentsDialog=function(){this.clientMode.onAcceptAssignmentsDialog()};Robotics.Client.Controls.roCalendar.prototype.prepareAssignmentsDialog=function(n){this.clientMode.prepareAssignmentsDialog(n)};Robotics.Client.Controls.roCalendar.prototype.createStarterDialog=function(){var n=this;return $("#"+n.ascxPrefix+"_dlgStarter_frm").dialog({autoOpen:!1,height:"auto",width:"auto",modal:!0,resizable:!1,draggable:!1,buttons:[{text:n.translator.translate(Robotics.Client.Language.Tags.Accept),"class":"btnFlat btnFlatBlack",click:function(){n.onAcceptStarterDialog()}},{text:n.translator.translate(Robotics.Client.Language.Tags.Cancel),"class":"btnFlat btnFlatBlack",click:function(){n.starterDialog.dialog("close")}}],close:function(){}})};Robotics.Client.Controls.roCalendar.prototype.onAcceptStarterDialog=function(){this.clientMode.onAcceptStarterDialog()};Robotics.Client.Controls.roCalendar.prototype.prepareStarterDialog=function(n){this.clientMode.prepareStarterDialog(n)};Robotics.Client.Controls.roCalendar.prototype.createComplementaryDialog=function(){var n=this;return $("#"+n.ascxPrefix+"_dlgComplementary_frm").dialog({autoOpen:!1,height:"auto",width:"auto",modal:!0,resizable:!1,draggable:!1,buttons:[{text:n.translator.translate(Robotics.Client.Language.Tags.Accept),"class":"btnFlat btnFlatBlack",click:function(){n.onAcceptComplementaryDialog()}},{text:n.translator.translate(Robotics.Client.Language.Tags.Cancel),"class":"btnFlat btnFlatBlack",click:function(){n.complementaryDialog.dialog("close")}}],close:function(){}})};Robotics.Client.Controls.roCalendar.prototype.onAcceptComplementaryDialog=function(){this.clientMode.onAcceptComplementaryDialog()};Robotics.Client.Controls.roCalendar.prototype.prepareComplementaryDialog=function(n){this.clientMode.prepareComplementaryDialog(n)};Robotics.Client.Controls.roCalendar.prototype.createAdvancedCopyDialog=function(){var n=this;return $("#"+n.ascxPrefix+"_dlgAdvCopy_frm").dialog({autoOpen:!1,height:"auto",width:"auto",modal:!0,resizable:!1,draggable:!1,buttons:[{text:n.translator.translate(Robotics.Client.Language.Tags.Accept),"class":"btnFlat btnFlatBlack",click:function(){showCaptcha(!1)}},{text:n.translator.translate(Robotics.Client.Language.Tags.Cancel),"class":"btnFlat btnFlatBlack",click:function(){n.advCopyDialog.dialog("close")}}],close:function(){}})};Robotics.Client.Controls.roCalendar.prototype.closeAdvancedCopyDialog=function(){this.advCopyDialog.dialog("close")};Robotics.Client.Controls.roCalendar.prototype.onAcceptCopyDialog=function(n,t){this.clientMode.onAcceptCopyDialog(n,t)};Robotics.Client.Controls.roCalendar.prototype.createCopyDialog=function(){var oCal=this;return $("#"+oCal.ascxPrefix+"_dlgCopy_frm").dialog({autoOpen:!1,height:"auto",width:"auto",modal:!0,resizable:!1,draggable:!1,buttons:[{text:oCal.translator.translate(Robotics.Client.Language.Tags.Accept),"class":"btnFlat btnFlatBlack",click:function(){var keepLockedDays=eval(oCal.ascxPrefix+"_dlgCopy_ckSPKeepBloquedDaysClient").GetChecked(),KeepDestHolidayDays=eval(oCal.ascxPrefix+"_dlgCopy_ckSPKeepHolidaysClient").GetChecked();oCal.onAcceptCopyDialog(keepLockedDays,KeepDestHolidayDays);oCal.sourceDialogRow=-1;oCal.sourceDialogColumn=-1;oCal.copyDialog.dialog("close")}},{text:oCal.translator.translate(Robotics.Client.Language.Tags.Cancel),"class":"btnFlat btnFlatBlack",click:function(){oCal.sourceDialogRow=-1;oCal.sourceDialogColumn=-1;oCal.copyDialog.dialog("close")}}],close:function(){}})};Robotics.Client.Controls.roCalendar.prototype.buildHeaderContextMenu=function(n){return this.clientMode.buildHeaderContextMenu(n)};Robotics.Client.Controls.roCalendar.prototype.executeHeaderContextMenuAction=function(n,t){return this.clientMode.executeHeaderContextMenuAction(n,t)};Robotics.Client.Controls.roCalendar.prototype.setSingleHeaderSelectedObejct=function(n){return this.clientMode.setSingleHeaderSelectedObejct(n)};Robotics.Client.Controls.roCalendar.prototype.setSingleSelectedObject=function(n){return this.clientMode.setSingleSelectedObject(n)};Robotics.Client.Controls.roCalendar.prototype.buildContextMenu=function(n){return this.clientMode.buildContextMenu(n)};Robotics.Client.Controls.roCalendar.prototype.executeContextMenuAction=function(n,t){return this.clientMode.executeContextMenuAction(n,t)};Robotics.Client.Controls.roCalendar.prototype.getFirstSelectedDay=function(){return this.clientMode.getFirstSelectedDay()};Robotics.Client.Controls.roCalendar.prototype.getFirstObjectSelected=function(){return this.clientMode.getFirstObjectSelected()};Robotics.Client.Controls.roCalendar.prototype.mapEvents=function(){var n=this,i=this.clientMode.getContextMenuSelector(),t=this.clientMode.getContextMenuHeaderSelector();$(document).off("keyup");$(document).on("keyup",function(t){t.keyCode==27?(n.selectionCopied=!1,n.selectionHeaderCopied=!1,n.clientMode.processKeyUpEvent(t)):t.keyCode==n.ctrlKey?n.ctrlDown=!1:t.keyCode==n.shiftKey&&(n.shiftDown=!1)});$(document).off("keydown");$(document).on("keydown",function(t){t.keyCode==n.ctrlKey?n.ctrlDown=!0:t.keyCode==n.shiftKey?n.shiftDown=!0:n.clientMode.processKeyDownEvent(t)});$.contextMenu("destroy",i);$.contextMenu({selector:i,callback:function(t){n.executeContextMenuAction(t,this)},build:function(t){return n.setSingleSelectedObject(t),{items:n.buildContextMenu(t)}}});t!=null&&n.employeeFilter.count("A")==1&&($.contextMenu("destroy",t),$.contextMenu({selector:t,callback:function(t){n.executeHeaderContextMenuAction(t,this)},build:function(t){return n.setSingleHeaderSelectedObejct(t),{items:n.buildHeaderContextMenu(t)}}}));this.clientMode.mapModeEvents()};Robotics.Client.Controls.roCalendar.prototype.refreshTables=function(n,t,i){this.clientMode.refreshModeTables(n,t,i)};Robotics.Client.Controls.roCalendar.prototype.getSelectedIDEmployees=function(){return this.clientMode.getSelectedIDEmployees()};Robotics.Client.Controls.roCalendar.prototype.ConvertHoursToHourFormat=function(n){var r,t,i;try{return r="",n<0&&(r="-",n=n*-1),t=Math.floor(parseInt(n)/60),i="00",(parseInt(n)^60)>0&&(i=parseInt(n)-t*60),t.toString().length==1&&(t="0"+t),i.toString().length==1&&(i="0"+i),r+t+":"+i}catch(u){showError("Robotics.Client.Controls.roCalendar.prototype.ConvertMinutesToHour",u)}};Robotics.Client.Controls.roCalendar.prototype.getMinDailyCell=function(){switch(this.dailyPeriod){case 15:return 88;case 30:return 44;case 60:return 22;default:return 44}return 44};Robotics.Client.Controls.roCalendar.prototype.getMaxDailyCell=function(){switch(this.dailyPeriod){case 15:return 224;case 30:return 112;case 60:return 66;default:return 112}return 112};Robotics.Client.Controls.roCalendar.prototype.dailyPeriodHourFraction=function(){switch(this.dailyPeriod){case 15:return.25;case 30:return.5;case 60:return 1;default:return.5}};Robotics.Client.Controls.roCalendar.prototype.dailyPeriodDescription=function(){switch(this.dailyPeriod){case 15:return Globalize.formatMessage("roPeriod15Min");case 30:return Globalize.formatMessage("roPeriod30Min");case 60:return Globalize.formatMessage("roPeriod60Min");default:return Globalize.formatMessage("roPeriod30Min")}},function(){var n=function(n){for(var r=n.split("."),i=window,t=0;t<r.length;t+=1)i=i[r[t]]=i[r[t]]||{};return i};n("Robotics.Client.Common")}();Robotics.Client.Common.roHtmlColor=function(){};Robotics.Client.Common.roHtmlColor.prototype.randomColorWithSeed=function(n,t,i){return"#"+this.dec2hex(parseInt(n.toString()+t.toString()+i.toString(),10)).substr(0,6)};Robotics.Client.Common.roHtmlColor.prototype.normalize=function(n,t,i){return(n-i)/(t-i)};Robotics.Client.Common.roHtmlColor.prototype.randomColor=function(){var n;return n=Math.floor(Math.random()*16777216),n=n.toString(16),n=("000000"+n).slice(-6),"#"+n};Robotics.Client.Common.roHtmlColor.prototype.ColorLuminance=function(n,t){n=String(n).replace(/[^0-9a-f]/gi,"");n.length<6&&(n=n[0]+n[0]+n[1]+n[1]+n[2]+n[2]);t=t||0;for(var u="#",i,r=0;r<3;r++)i=parseInt(n.substr(r*2,2),16),i=Math.round(Math.min(Math.max(0,i+i*t),255)).toString(16),u+=("00"+i).substr(i.length);return u};Robotics.Client.Common.roHtmlColor.prototype.sbcRip=function(n,t){var u=t.length,i={};if(u>9){if(t=t.split(","),t.length<3||t.length>4)return null;i[0]=n(t[0].slice(4));i[1]=n(t[1]);i[2]=n(t[2]);i[3]=t[3]?parseFloat(t[3]):-1}else{if(u==8||u==6||u<4)return null;u<6&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+(u>4?t[4]+""+t[4]:""));t=n(t.slice(1),16);i[0]=t>>16&255;i[1]=t>>8&255;i[2]=t&255;i[3]=u==9||u==5?r((t>>24&255)/255*1e4)/1e4:-1}return i};Robotics.Client.Common.roHtmlColor.prototype.shadeBlendConvert=function(n,t,i){if(typeof n!="number"||n<-1||n>1||typeof t!="string"||t[0]!="r"&&t[0]!="#"||typeof i!="string"&&typeof i!="undefined")return null;var o=parseInt,f=Math.round,e=t.length>9,e=typeof i=="string"?i.length>9?!0:i=="c"?!e:!1:e,s=n<0,n=s?n*-1:n,i=i&&i!="c"?i:s?"#000000":"#FFFFFF",r=this.sbcRip(o,t),u=this.sbcRip(o,i);return!r||!u?null:e?"rgb("+f((u[0]-r[0])*n+r[0])+","+f((u[1]-r[1])*n+r[1])+","+f((u[2]-r[2])*n+r[2])+(r[3]<0&&u[3]<0?")":","+(r[3]>-1&&u[3]>-1?f(((u[3]-r[3])*n+r[3])*1e4)/1e4:u[3]<0?r[3]:u[3])+")"):"#"+(4294967296+(r[3]>-1&&u[3]>-1?f(((u[3]-r[3])*n+r[3])*255):u[3]>-1?f(u[3]*255):r[3]>-1?f(r[3]*255):255)*16777216+f((u[0]-r[0])*n+r[0])*65536+f((u[1]-r[1])*n+r[1])*256+f((u[2]-r[2])*n+r[2])).toString(16).slice(r[3]>-1||u[3]>-1?1:3)};Robotics.Client.Common.roHtmlColor.prototype.invertCssColor=function(n){var t=this.invertColor(this.hexColor2rgb(n));return this.rgb2hexColor(t)};Robotics.Client.Common.roHtmlColor.prototype.invertSimpleColor=function(n){var t=n;return t=t.substring(1),t=parseInt(t,16),t=16777215^t,t=t.toString(16),t=("000000"+t).slice(-6),"#"+t};Robotics.Client.Common.roHtmlColor.prototype.invertColor=function(n){var t=this.rgb2yuv(n),i=90;return t.y=this.clamp(t.y+(t.y>100?-i:i)),this.yuv2rgb(t)};Robotics.Client.Common.roHtmlColor.prototype.rgb2hexColor=function(n){return"#"+this.dec2hex(n.r)+this.dec2hex(n.g)+this.dec2hex(n.b)};Robotics.Client.Common.roHtmlColor.prototype.hexColor2rgb=function(n){return n=n.substring(1),{r:parseInt(n.substring(0,2),16),g:parseInt(n.substring(2,4),16),b:parseInt(n.substring(4,6),16)}};Robotics.Client.Common.roHtmlColor.prototype.rgb2hexColor=function(n){return"#"+this.dec2hex(n.r)+this.dec2hex(n.g)+this.dec2hex(n.b)};Robotics.Client.Common.roHtmlColor.prototype.dec2hex=function(n){var t=n.toString(16);return t.length<2?"0"+t:t};Robotics.Client.Common.roHtmlColor.prototype.rgb2yuv=function(n){var t=this.clamp(n.r*.299+n.g*.587+n.b*.114),i=this.clamp(n.r*-.16874+n.g*-.33126+n.b*.5+128),r=this.clamp(n.r*.5+n.g*-.41869+n.b*-.08131+128);return{y:t,u:i,v:r}};Robotics.Client.Common.roHtmlColor.prototype.yuv2rgb=function(n){var t=n.y,i=n.u,r=n.v,u=this.clamp(t+(r-128)*1.402),f=this.clamp(t+(i-128)*-.34414+(r-128)*-.71414),e=this.clamp(t+(i-128)*1.772);return{r:u,g:f,b:e}};Robotics.Client.Common.roHtmlColor.prototype.clamp=function(n){return n<0?0:n>255?255:Math.floor(n)};Robotics.Client.Common.roHtmlColor.prototype.fromWin32Color=function(n){n>>>=0;var t=n&255,i=(n&65280)>>>8,r=(n&16711680)>>>16;return this.rgb2hexColor({r:r,g:i,b:t})},function(){var n=function(n){for(var r=n.split("."),i=window,t=0;t<r.length;t+=1)i=i[r[t]]=i[r[t]]||{};return i};n("Robotics.Client.Controls.Forms")}();Robotics.Client.Controls.Forms.AdvCopyForm=function(prefix,calendarType){this.prefix=prefix;this.workMode=calendarType;this.labelCounter=$("#"+this.prefix+"_shiftCount");this.dateInfo=$("#"+this.prefix+"_shiftStartDate");this.rbRepeatUntil=eval(this.prefix+"_rbRepeatUntilClient");this.txtToDate=eval(this.prefix+"_txtToDateClient");this.rbRepeatTimes=eval(this.prefix+"_rbRepeatTimesClient");this.txtRepeatTimes=eval(this.prefix+"_txtRepeatTimesClient");this.ckBloqDestDays=eval(this.prefix+"_ckBloqDestDaysClient");this.rbAdvancedRepeatDisabled=eval(this.prefix+"_rbAdvancedRepeatDisabledClient");this.rbAdvancedRepeatEnabled=eval(this.prefix+"_rbAdvancedRepeatEnabledClient");this.rbAdvancedBloquedDisabled=eval(this.prefix+"_rbAdvancedBloquedDisabledClient");this.rbAdvancedBloquedEnabled=eval(this.prefix+"_rbAdvancedBloquedEnabledClient");this.rbAdvancedHolidaysDisabled=eval(this.prefix+"_rbAdvancedHolidaysDisabledClient");this.rbAdvancedHolidaysEnabled=eval(this.prefix+"_rbAdvancedHolidaysEnabledClient");this.rbStartsInmediately=eval(this.prefix+"_rbStartsInmediately");this.rbStartsNextDay=eval(this.prefix+"_rbStartsNextDayClient");this.cmbRepeatStartsDay=eval(this.prefix+"_cmbRepeatStartsDayClient");this.rbStartsNextMonth=eval(this.prefix+"_rbStartsNextMonthClient");this.txtRepeatStartsMonth=eval(this.prefix+"_txtRepeatStartsMonthClient");this.ckSkipOptions=eval(this.prefix+"_ckSkipOptionsClient");this.txtSkipOptions=eval(this.prefix+"_txtSkipOptionsClient");this.rbRepeatSkipWeek=eval(this.prefix+"_rbRepeatSkipWeekClient");this.cmbSkipsWeekDay=eval(this.prefix+"_cmbSkipsWeekDayClient");this.rbRepeatSkipMonth=eval(this.prefix+"_rbRepeatSkipMonthClient");this.txtSkipMonthDayValue=eval(this.prefix+"_txtSkipMonthDayValueClient");this.rbRepeatSkipDays=eval(this.prefix+"_rbRepeatSkipDaysClient");this.txtRepeatSkipDays=eval(this.prefix+"_txtRepeatSkipDaysClient");this.rbHolidaySkip=eval(this.prefix+"_rbHolidaySkipClient");this.rbHolidayIgnore=eval(this.prefix+"_rbHolidayIgnoreClient");this.rbHolidayOverwrite=eval(this.prefix+"_rbHolidayOverwriteClient");this.rbBloquedSkip=eval(this.prefix+"_rbBloquedSkipClient");this.rbBloquedIgnore=eval(this.prefix+"_rbBloquedIgnoreClient");this.rbBloquedOverWrite=eval(this.prefix+"_rbBloquedOverWriteClient");this.rbTelecommuteKeep=eval(this.prefix+"_rbTelecommuteKeepClient");this.rbTelecommuteCopy=eval(this.prefix+"_rbTelecommuteCopyClient");this.rbTelecommuteDefault=eval(this.prefix+"_rbTelecommuteDefaultClient")};Robotics.Client.Controls.Forms.AdvCopyForm.prototype.prepareForm=function(n,t,i){this.rbRepeatUntil.SetChecked(!1);this.labelCounter.html(n);this.dateInfo.html(moment(t).format("DD/MM/YYYY"));var r=new Date;this.txtToDate.SetDate(moment(t).clone().toDate());this.rbRepeatTimes.SetChecked(!0);this.txtRepeatTimes.SetValue(1);this.ckBloqDestDays.SetChecked(!1);this.rbAdvancedRepeatDisabled.SetChecked(!0);this.rbAdvancedRepeatEnabled.SetChecked(!1);this.rbAdvancedBloquedDisabled.SetChecked(!0);this.rbAdvancedBloquedEnabled.SetChecked(!1);this.rbAdvancedHolidaysDisabled.SetChecked(!0);this.rbAdvancedHolidaysEnabled.SetChecked(!1);this.rbStartsInmediately.SetChecked(!0);this.rbStartsNextDay.SetChecked(!1);this.cmbRepeatStartsDay.SetSelectedItem(this.cmbRepeatStartsDay.FindItemByValue("1"));this.rbStartsNextMonth.SetChecked(!1);this.txtRepeatStartsMonth.SetValue(1);this.ckSkipOptions.SetChecked(!1);this.txtSkipOptions.SetValue(1);this.rbRepeatSkipWeek.SetChecked(!0);this.cmbSkipsWeekDay.SetSelectedItem(this.cmbSkipsWeekDay.FindItemByValue("1"));this.rbRepeatSkipMonth.SetChecked(!1);this.txtSkipMonthDayValue.SetValue(1);this.rbRepeatSkipDays.SetChecked(!1);this.txtRepeatSkipDays.SetValue(1);this.rbHolidaySkip.SetChecked(!0);this.rbHolidayIgnore.SetChecked(!1);this.rbHolidayOverwrite.SetChecked(!1);this.rbBloquedSkip.SetChecked(!0);this.rbBloquedIgnore.SetChecked(!1);this.rbBloquedOverWrite.SetChecked(!1);this.rbTelecommuteKeep.SetChecked(!0);this.rbTelecommuteCopy.SetChecked(!1);this.rbTelecommuteDefault.SetChecked(!1);switch(this.workMode){case Robotics.Client.Constants.WorkMode.roCalendar:$("#"+this.prefix+"_divRepeatOptions").show();$("#"+this.prefix+"_divBloquedDaysOptions").show();$("#"+this.prefix+"_RoGroupBox3_divBlockDestinationDays").show();$("#"+this.prefix+"_RoGroupBox2_divHolidaysIgnore").show();$("#"+this.prefix+"_divBudgetWarning").hide();break;case Robotics.Client.Constants.WorkMode.roBudget:$("#"+this.prefix+"_divRepeatOptions").hide();$("#"+this.prefix+"_divBloquedDaysOptions").hide();$("#"+this.prefix+"_RoGroupBox3_divBlockDestinationDays").hide();$("#"+this.prefix+"_RoGroupBox2_divHolidaysIgnore").hide();switch(i){case Robotics.Client.Constants.TypeView.Planification:$("#"+this.prefix+"_divHolidaysOptions").show();$("#"+this.prefix+"_divBudgetWarning").show();break;case Robotics.Client.Constants.TypeView.Definition:$("#"+this.prefix+"_divHolidaysOptions").hide();$("#"+this.prefix+"_divBudgetWarning").hide()}}};Robotics.Client.Controls.Forms.AdvCopyForm.prototype.getFiltersValue=function(){var n={};return this.rbRepeatUntil.GetChecked()&&(n.RepeatMode=1,n.RepeatModeValue=moment(this.txtToDate.GetDate()).format("YYYY/MM/DD")),this.rbRepeatTimes.GetChecked()&&(n.RepeatMode=0,n.RepeatModeValue=this.txtRepeatTimes.GetValue()),n.LockDestDays=this.ckBloqDestDays.GetChecked()?1:0,this.rbAdvancedRepeatDisabled.GetChecked()?(n.RepeatStartMode=0,n.RepeatStartModeValue="",n.RepeatSkipMode=0,n.RepeatSkipTimes=0,n.RepeatSkipModeValue=""):(this.rbStartsInmediately.GetChecked()?(n.RepeatStartMode=0,n.RepeatStartModeValue=""):this.rbStartsNextDay.GetChecked()?(n.RepeatStartMode=1,n.RepeatStartModeValue=this.cmbRepeatStartsDay.GetSelectedItem().value):this.rbStartsNextMonth.GetChecked()&&(n.RepeatStartMode=2,n.RepeatStartModeValue=this.txtRepeatStartsMonth.GetValue()),this.ckSkipOptions.GetChecked()?(n.RepeatSkipTimes=this.txtSkipOptions.GetValue(),this.rbRepeatSkipWeek.GetChecked()?(n.RepeatSkipMode=1,n.RepeatSkipModeValue=this.cmbSkipsWeekDay.GetSelectedItem().value):this.rbRepeatSkipMonth.GetChecked()?(n.RepeatSkipMode=2,n.RepeatSkipModeValue=this.txtSkipMonthDayValue.GetValue()):this.rbRepeatSkipDays.GetChecked()&&(n.RepeatSkipMode=3,n.RepeatSkipModeValue=this.txtRepeatSkipDays.GetValue())):(n.RepeatSkipMode=0,n.RepeatSkipTimes=0,n.RepeatSkipModeValue="")),this.rbAdvancedHolidaysDisabled.GetChecked()?n.HolidaysMode=0:this.rbHolidaySkip.GetChecked()?n.HolidaysMode=0:this.rbHolidayIgnore.GetChecked()?n.HolidaysMode=1:this.rbHolidayOverwrite.GetChecked()&&(n.HolidaysMode=2),this.rbAdvancedBloquedDisabled.GetChecked()?n.BloquedMode=0:this.rbBloquedSkip.GetChecked()?n.BloquedMode=0:this.rbBloquedIgnore.GetChecked()?n.BloquedMode=1:this.rbBloquedOverWrite.GetChecked()&&(n.BloquedMode=2),this.rbTelecommuteKeep.GetChecked()?n.TelecommuteCopy=0:this.rbTelecommuteCopy.GetChecked()?n.TelecommuteCopy=1:this.rbTelecommuteDefault.GetChecked()&&(n.TelecommuteCopy=2),n},function(){var n=function(n){for(var r=n.split("."),i=window,t=0;t<r.length;t+=1)i=i[r[t]]=i[r[t]]||{};return i};n("Robotics.Client.Controls.Forms")}();Robotics.Client.Controls.Forms.AssignmentsForm=function(prefix,showErrorPopup){this.prefix=prefix;this.oShiftDefinition=null;this.oEmployeeAssignments=null;this.showErrorPopup=showErrorPopup;this.shiftDefinitionCallback=eval(this.prefix+"_shiftDefinitionCallbackClient");this.cmbAvailableAssignments=eval(this.prefix+"_cmbAvailableAssignments");this.showAllAssignments=!1;this.assignmentsDefinition={}};Robotics.Client.Controls.Forms.AssignmentsForm.prototype.prepareAssignmentsDialog=function(n,t,i,r){var u,f;return this.oEmployeeAssignments=typeof t!="undefined"&&t!=null?t:[],typeof r!="undefined"&&r!=null&&(this.assignmentsDefinition=r),i==-2&&(this.showAllAssignments=!0),n==null?(u={},u.idShift=i,u.StampParam=(new Date).getMilliseconds(),u.action="SHIFTLAYERDEFINITION",f=JSON.stringify(u),f=encodeURIComponent(f),this.shiftDefinitionCallback.PerformCallback(f),!1):(this.oShiftDefinition=n,this.finallyPrepareDialogElements(),!0)};Robotics.Client.Controls.Forms.AssignmentsForm.prototype.finallyPrepareDialogElements=function(){var r=this.cmbAvailableAssignments.FindItemByValue(0),t,i,n;if(this.cmbAvailableAssignments.ClearItems(),this.showAllAssignments||this.cmbAvailableAssignments.AddItem(r.text,r.value),typeof this.oShiftDefinition.Assignments!="undefined"&&this.oShiftDefinition.Assignments!=null)for(t=0;t<this.oShiftDefinition.Assignments.length;t++)if(i=this.oShiftDefinition.Assignments[t],this.showAllAssignments){for(n=0;n<this.assignmentsDefinition.length;n++)if(i.IDAssig==this.assignmentsDefinition[n].Id){this.cmbAvailableAssignments.AddItem(this.assignmentsDefinition[n].Name,this.assignmentsDefinition[n].Id);break}}else for(n=0;n<this.oEmployeeAssignments.length;n++)if(i.IDAssig==this.oEmployeeAssignments[n].ID){this.cmbAvailableAssignments.AddItem(this.oEmployeeAssignments[n].Name,this.oEmployeeAssignments[n].ID);break}this.cmbAvailableAssignments.SetSelectedIndex(0)};Robotics.Client.Controls.Forms.AssignmentsForm.prototype.focusDialog=function(){this.cmbAvailableAssignments.Focus()};Robotics.Client.Controls.Forms.AssignmentsForm.prototype.selectcurrentAssignment=function(n){var t="0";typeof n!="undefined"&&n!=null&&(t=n.ID);this.cmbAvailableAssignments.SetSelectedItem(this.cmbAvailableAssignments.FindItemByValue(t))};Robotics.Client.Controls.Forms.AssignmentsForm.prototype.isValid=function(){return this.cmbAvailableAssignments.GetSelectedItem()!=null?!0:!1};Robotics.Client.Controls.Forms.AssignmentsForm.prototype.getDayData=function(){var r=null,u=parseInt(this.cmbAvailableAssignments.GetSelectedItem().value,10),n,t,i,f;if(this.showAllAssignments){for(n=0;n<this.assignmentsDefinition.length;n++)if(u==this.assignmentsDefinition[n].Id){t=1;r={ID:this.assignmentsDefinition[n].Id,Name:this.assignmentsDefinition[n].Name,ShortName:this.assignmentsDefinition[n].ShortName,Color:this.assignmentsDefinition[n].Color,Cover:t};break}}else for(n=0;n<this.oEmployeeAssignments.length;n++)if(u==this.oEmployeeAssignments[n].ID){for(t=1,i=0;i<this.oShiftDefinition.Assignments.length;i++)if(f=this.oShiftDefinition.Assignments[i],f.IDAssig==u){t=f.Cover;break}r={ID:this.oEmployeeAssignments[n].ID,Name:this.oEmployeeAssignments[n].Name,ShortName:this.oEmployeeAssignments[n].ShortName,Color:this.oEmployeeAssignments[n].Color,Cover:t};break}return r},function(){var n=function(n){for(var r=n.split("."),i=window,t=0;t<r.length;t+=1)i=i[r[t]]=i[r[t]]||{};return i};n("Robotics.Client.Controls.Forms")}();Robotics.Client.Controls.Forms.BudgetAddEmployeeForm=function(prefix,showErrorPopup){this.prefix=prefix;this.showErrorPopup=showErrorPopup;this.lblInHolidays=eval(this.prefix+"_lblInHolidays");this.lblInRest=eval(this.prefix+"_lblInRest");this.lblOnAbsence=eval(this.prefix+"_lblOnAbsence");this.lblWithoutAssignment=eval(this.prefix+"_lblWithoutAssignment");this.gridId="#"+prefix+"_divAvailableEmployeesGrid";this.gridInstance=null;this.lblDayInformation=$("#"+this.prefix+"_lblDayInformation");this.selectedEmployee=null;this.selectedMultipleEmployee=null;this.employeesDS=null;this.statusDS=null;this.tooltips={t0:null,t1:null,t2:null,t3:null}};Robotics.Client.Controls.Forms.BudgetAddEmployeeForm.prototype.InitializeDialog=function(n,t,i){this.selectedEmployee=null;this.selectedMultipleEmployee=null;this.employeesDS=Object.clone(n,!0);this.statusDS=Object.clone(t,!0);this.initGrid();this.initTooltips();this.setUpDescription(i)};Robotics.Client.Controls.Forms.BudgetAddEmployeeForm.prototype.initGrid=function(){var n=this;try{try{this.gridInstance=$(this.gridId).dxDataGrid("instance")}catch(t){this.gridInstance=null}this.gridInstance==null?this.gridInstance=$(this.gridId).dxDataGrid({showColumnLines:!0,showRowLines:!0,height:"250px",allowColumnResizing:!0,rowAlternationEnabled:!0,showBorders:!0,dataSource:{store:n.employeesDS},headerFilter:{visible:!0},filterRow:{visible:!0},selection:{mode:"multiple",showCheckBoxesMode:"always"},editing:{mode:"row",allowUpdating:!1,allowDeleting:!1,texts:{deleteRow:"Delete",editRow:"Edit"}},onCellPrepared:function(n){if(n.rowType==="data"&&n.column.command==="edit"){var i=n.row.isEditing,t=n.cellElement.find(".dx-link");t.text("");i?(t.filter(".dx-link-save").addClass("dx-icon-save"),t.filter(".dx-link-cancel").addClass("dx-icon-revert")):(t.filter(".dx-link-edit").addClass("dx-icon-edit"),t.filter(".dx-link-delete").addClass("dx-icon-trash"))}},onSelectionChanged:function(t){var i=t.selectedRowsData;n.selectedMultipleEmployee=i.length>0?i:null},onRowClick:function(t){var i=t.data;n.selectedEmployee=i?i:null},onContentReady:function(){$(".ratingControl").each(function(){var n=$($(this)[0].childNodes[0]),t,i;n[0].tagName.toUpperCase()=="SELECT"&&(n.barrating({theme:"fontawesome-stars",readonly:!0,hoverState:!1,initialRating:n.attr("data-value")}),$(this)[0].childNodes.length>1&&(t=$($(this)[0].childNodes[1]),i=this,t.dxTooltip({target:i,showEvent:{name:"mouseenter",delay:150},hideEvent:"mouseleave",position:"bottom"})))})},remoteOperations:{sorting:!0},paging:{enabled:!1},columns:[{caption:Globalize.formatMessage("roSuitability"),dataField:"TotalIndictments",allowEditing:!1,width:"120px",allowFiltering:!1,allowSearch:!1,cellTemplate:function(n,t){var r,i;if(n.addClass("ratingControl"),r=$('<select><option value="1"> 1<\/option><option value="2">2<\/option><option value="3">3<\/option><option value="4">4<\/option><option value="5">5<\/option><\/select >'),r.attr("data-value",5-t.data.TotalIndictments),n.append(r),t.data.TotalIndictments>0){var u=$("<div><\/div>").attr("id","tooltipIndictmentsContainer").attr("class","tooltipIndictmentsContainer"),e=$("<div><\/div>").html('<span class="fontBold fontBig" style="text-align:left">'+Globalize.formatMessage("roIndictmentsTitle")+"<\/span>"),f=$("<ul><\/ul>");for(i=0;i<t.data.TotalIndictments;i++)f.append($("<li><\/li>").html(t.data.Indictments[i].ErrorText));u.append(e,f);n.append(u)}}},{caption:Globalize.formatMessage("roEmployeeName"),dataField:"EmployeeName",allowEditing:!1,width:"180px"},{caption:Globalize.formatMessage("roActualShift"),dataField:"ShiftName",allowEditing:!1,width:"180px"},{caption:Globalize.formatMessage("roActualAssignment"),dataField:"AssignmentName",allowEditing:!1,width:"100px"},{caption:Globalize.formatMessage("roActualGroup"),dataField:"FullGroupName",allowEditing:!1,width:"350px"},{caption:Globalize.formatMessage("roEmployeeCost"),dataField:"Cost",allowEditing:!1,width:"80px"}]}).dxDataGrid("instance"):(this.gridInstance.option("dataSource",{store:n.employeesDS}),this.gridInstance.option("onSelectionChanged",function(t){var i=t.selectedRowsData;n.selectedMultipleEmployee=i.length>0?i:null}),this.gridInstance.option("onRowClick",function(t){var i=t.data;n.selectedEmployee=i?i:null}),this.gridInstance.clearSelection())}catch(t){}};Robotics.Client.Controls.Forms.BudgetAddEmployeeForm.prototype.initTooltips=function(){var n=this;this.lblOnAbsence.SetText(n.statusDS.EmployeesOnProgrammedAbsence.length);this.lblInRest.SetText(n.statusDS.EmployeesNoWorkingShift.length);this.lblInHolidays.SetText(n.statusDS.EmployeesOnHolidays.length);this.lblWithoutAssignment.SetText(n.statusDS.EmployeesWithoutAssignment.length);this.tooltips.t0=$("#"+this.prefix+"_lblWithoutAssignmentTooltip").dxTooltip({target:"#"+this.prefix+"_lblWithoutAssignmentContainer",showEvent:{name:"mouseenter",delay:300},hideEvent:"dxclick",position:"top",onShowing:n.fulfillList(0,this.prefix+"_lstEmployeesWithousAssignment",n.statusDS.EmployeesWithoutAssignment)}).dxTooltip("instance");this.tooltips.t1=$("#"+this.prefix+"_lblInRestTooltip").dxTooltip({target:"#"+this.prefix+"_lblInRestContainer",showEvent:{name:"mouseenter",delay:300},hideEvent:"dxclick",position:"top",onShowing:n.fulfillList(1,this.prefix+"_lstEmployeesInRest",n.statusDS.EmployeesNoWorkingShift)}).dxTooltip("instance");this.tooltips.t2=$("#"+this.prefix+"_lblInHolidaysTooltip").dxTooltip({target:"#"+this.prefix+"_lblInHolidaysContainer",showEvent:{name:"mouseenter",delay:300},hideEvent:"dxclick",position:"top",onShowing:n.fulfillList(2,this.prefix+"_lstEmployeesInHolidays",n.statusDS.EmployeesOnHolidays)}).dxTooltip("instance");this.tooltips.t3=$("#"+this.prefix+"_lblOnAbsenceTooltip").dxTooltip({target:"#"+this.prefix+"_lblOnAbsenceContainer",showEvent:{name:"mouseenter",delay:300},hideEvent:"dxclick",position:"top",onShowing:n.fulfillList(3,this.prefix+"_lstEmployeesOnAbsence",n.statusDS.EmployeesOnProgrammedAbsence)}).dxTooltip("instance")};Robotics.Client.Controls.Forms.BudgetAddEmployeeForm.prototype.setUpDescription=function(n){var t,r,u;this.lblDayInformation.empty();var f=$("<div><\/div>").attr("class","alignLeft fontBold").html('<span class="lineDescriptionHeight" style="padding-left:10px">'+n.pUnit.Name+"<\/span>"),e=$("<div><\/div>").attr("class","alignLeft").html('<span class="lineDescriptionHeight">'+Globalize.formatDate(n.sDate,{date:"full"})+":<\/span>"),o=$("<div><\/div>").attr("class","alignLeft paddingLeft").html('<span  class="lineDescriptionHeight">'+Globalize.formatMessage("roPUnitMode")+":<\/span>"),s=$("<div><\/div>").attr("class","alignLeft").attr("style","padding:6px;margin-left:5px;background-color:"+n.pUnitMode.HtmlColor+";color:"+(new Robotics.Client.Common.roHtmlColor).invertCssColor(n.pUnitMode.HtmlColor)).html(n.pUnitMode.Name),h=$("<div><\/div>").attr("class","alignLeft paddingLeft").html('<span  class="lineDescriptionHeight">'+Globalize.formatMessage("roPosition")+":<\/span>"),c=$("<div><\/div>").attr("class","alignLeft").attr("style","padding:6px;margin-left:5px;background-color:"+n.pUnitModePosition.AssignmentData.Color+";color:"+(new Robotics.Client.Common.roHtmlColor).invertCssColor(n.pUnitModePosition.AssignmentData.Color)).html(n.pUnitModePosition.AssignmentData.Name),l=$("<div><\/div>").attr("class","alignLeft paddingLeft").html('<span  class="lineDescriptionHeight">'+Globalize.formatMessage("roShift")+":<\/span>"),a=$("<div><\/div>").attr("class","alignLeft").attr("style","padding:6px;margin-left:5px;background-color:"+n.pUnitModePosition.ShiftData.Color+";color:"+(new Robotics.Client.Common.roHtmlColor).invertCssColor(n.pUnitModePosition.ShiftData.Color)).html(n.pUnitModePosition.ShiftData.Name),i=0;for(t=0;t<n.pUnitModePosition.EmployeesData.length;t++)n.pUnitModePosition.EmployeesData[t].IDEmployee>0&&i++;r=$("<div><\/div>").attr("class","alignLeft paddingLeft").html('<span  class="lineDescriptionHeight">'+Globalize.formatMessage("roEmployeesAssigned")+":<\/span>");u=$("<div><\/div>").attr("class","alignLeft fontBold").html('<span  class="lineDescriptionHeight" style="padding-left:6px">'+Globalize.formatNumber(i)+"/"+Globalize.formatNumber(n.pUnitModePosition.Quantity)+"<\/span>");this.lblDayInformation.append(e,f,o,s,h,c,l,a,r,u)};Robotics.Client.Controls.Forms.BudgetAddEmployeeForm.prototype.fulfillList=function(n,t,i){var r=this;return function(){n!=0&&r.tooltips.t0!=null&&r.tooltips.t0.hide();n!=1&&r.tooltips.t1!=null&&r.tooltips.t1.hide();n!=2&&r.tooltips.t2!=null&&r.tooltips.t2.hide();n!=3&&r.tooltips.t3!=null&&r.tooltips.t3.hide();$("#"+t).dxList({dataSource:i,height:"300px",width:"200px",pageLoadMode:"scrollBottom",itemTemplate:function(n){return n.EmployeeName}}).dxList("instance")}};Robotics.Client.Controls.Forms.BudgetAddEmployeeForm.prototype.getSelectedEmployee=function(){return this.selectedEmployee};Robotics.Client.Controls.Forms.BudgetAddEmployeeForm.prototype.getMultipleEmployeeSelection=function(){return this.selectedMultipleEmployee},function(){var n=function(n){for(var r=n.split("."),i=window,t=0;t<r.length;t+=1)i=i[r[t]]=i[r[t]]||{};return i};n("Robotics.Client.Controls.Forms")}();Robotics.Client.Controls.Forms.ComplementaryForm=function(prefix,showErrorPopup){this.prefix=prefix;this.oCalendarShift=null;this.oOriginShiftInfo=null;this.oShiftData=null;this.showErrorPopup=showErrorPopup;this.shiftDefinitionCallback=eval(this.prefix+"_shiftDefinitionCallbackClient");this.txtShiftFloatingStart=eval(this.prefix+"_txtShiftFloatingStartClient");this.cmbStartAtFloating=eval(this.prefix+"_cmbStartAtFloatingClient");this.txtShiftStart1=eval(this.prefix+"_txtShiftStart1Client");this.cmbStartAt1=eval(this.prefix+"_cmbStartAt1Client");this.txtShiftOrdinary1=eval(this.prefix+"_txtShiftOrdinary1Client");this.txtShiftComplementary1=eval(this.prefix+"_txtShiftComplementary1Client");this.txtShiftStart2=eval(this.prefix+"_txtShiftStart2Client");this.cmbStartAt2=eval(this.prefix+"_cmbStartAt2Client");this.txtShiftOrdinary2=eval(this.prefix+"_txtShiftOrdinary2Client");this.txtShiftComplementary2=eval(this.prefix+"_txtShiftComplementary2Client")};Robotics.Client.Controls.Forms.ComplementaryForm.prototype.prepareComplementaryDialog=function(n,t,i){var r,u;return this.oShiftData=typeof i!="undefined"?i:null,n==null?(r={},r.idShift=t,r.StampParam=(new Date).getMilliseconds(),r.action="SHIFTLAYERDEFINITION",u=JSON.stringify(r),u=encodeURIComponent(u),this.shiftDefinitionCallback.PerformCallback(u),!1):(this.oCalendarShift=this.oShiftData!=null?this.getDayDataEditting(n,this.oShiftData):n,this.finallyPrepareDialogElements(),!0)};Robotics.Client.Controls.Forms.ComplementaryForm.prototype.setOffset=function(n){var t=0,i;this.oCalendarShift.IsFloating&&(i=new Date(1999,11,30,this.oCalendarShift.StartFloating.getHours(),this.oCalendarShift.StartFloating.getMinutes(),0,0),t=moment(n).diff(moment(i),"minutes"),t!=0&&this.txtShiftFloatingStart.SetDate(moment(this.oCalendarShift.StartFloating).clone().add(t,"minutes").toDate()));this.oCalendarShift.CountLayers>0&&this.oCalendarShift.AllowModifyIniHour1&&(t==0&&(i=new Date(1999,11,30,this.oCalendarShift.StartLayer1.getHours(),this.oCalendarShift.StartLayer1.getMinutes(),0,0),t=moment(n).diff(moment(i),"minutes")),t!=0&&this.txtShiftStart1.SetDate(moment(this.oCalendarShift.StartLayer1).clone().add(t,"minutes").toDate()));this.oCalendarShift.CountLayers>1&&this.oCalendarShift.AllowModifyIniHour2&&(t==0&&(i=new Date(1999,11,30,this.oCalendarShift.StartLayer2.getHours(),this.oCalendarShift.StartLayer2.getMinutes(),0,0),t=moment(n).diff(moment(i),"minutes")),t!=0&&this.txtShiftStart2.SetDate(moment(this.oCalendarShift.StartLayer2).clone().add(t,"minutes").toDate()))};Robotics.Client.Controls.Forms.ComplementaryForm.prototype.finallyPrepareDialogElements=function(n){var i,t;typeof n!="undefined"&&(this.oCalendarShift=n);this.oCalendarShift.IsFloating?($("#"+this.prefix+"_advShiftStartFloating").show(),this.txtShiftFloatingStart.SetDate(this.oCalendarShift.StartFloating),this.oCalendarShift.StartFloating.getDate()==29?this.cmbStartAtFloating.SetSelectedItem(this.cmbStartAtFloating.FindItemByValue(0)):this.oCalendarShift.StartFloating.getDate()==30?this.cmbStartAtFloating.SetSelectedItem(this.cmbStartAtFloating.FindItemByValue(1)):this.oCalendarShift.StartFloating.getDate()==31&&this.cmbStartAtFloating.SetSelectedItem(this.cmbStartAtFloating.FindItemByValue(2))):$("#"+this.prefix+"_advShiftStartFloating").hide();$("#"+this.prefix+"_advFirstLayer").hide();$("#"+this.prefix+"_advSecondLayer").hide();this.oCalendarShift.CountLayers>0&&($("#"+this.prefix+"_advFirstLayer").show(),this.txtShiftStart1.SetDate(this.oCalendarShift.StartLayer1),this.oCalendarShift.StartLayer1.getDate()==29?this.cmbStartAt1.SetSelectedItem(this.cmbStartAt1.FindItemByValue(0)):this.oCalendarShift.StartLayer1.getDate()==30?this.cmbStartAt1.SetSelectedItem(this.cmbStartAt1.FindItemByValue(1)):this.oCalendarShift.StartLayer1.getDate()==31&&this.cmbStartAt1.SetSelectedItem(this.cmbStartAt1.FindItemByValue(2)),i=0,t=moment(this.oCalendarShift.StartLayer1).clone().startOf("day"),this.oShiftData==null?(i=moment(this.oCalendarShift.EndLayer1).diff(moment(this.oCalendarShift.StartLayer1),"minutes"),this.txtShiftComplementary1.SetDate(t.clone().toDate()),this.txtShiftOrdinary1.SetDate(t.clone().add(i,"minutes").toDate())):this.oCalendarShift.AllowComplementary1?(this.txtShiftComplementary1.SetDate(t.clone().add(parseInt(this.oShiftData.ShiftLayersDefinition[0].LayerComplementaryHours,10),"minutes").toDate()),this.txtShiftOrdinary1.SetDate(t.clone().add(parseInt(this.oShiftData.ShiftLayersDefinition[0].LayerOrdinaryHours,10),"minutes").toDate())):(this.txtShiftComplementary1.SetDate(t.clone().toDate()),this.oCalendarShift.AllowModifyIniHour1?(i=moment(this.oCalendarShift.EndLayer1).diff(moment(this.txtShiftStart1.GetDate()),"minutes"),this.txtShiftOrdinary1.SetDate(t.clone().add(i,"minutes").toDate())):this.txtShiftOrdinary1.SetDate(t.clone().add(parseInt(this.oShiftData.ShiftLayersDefinition[0].LayerDuration,10),"minutes").toDate())),this.oCalendarShift.AllowComplementary1?($("#"+this.prefix+"_firstLayerComplementary").show(),this.txtShiftComplementary1.SetEnabled(!0)):($("#"+this.prefix+"_firstLayerComplementary").hide(),this.txtShiftComplementary1.SetEnabled(!1)),this.oCalendarShift.AllowModifyIniHour1?(this.txtShiftStart1.SetEnabled(!0),this.cmbStartAt1.SetEnabled(!0),this.oCalendarShift.AllowComplementary1||this.oCalendarShift.AllowModifyDuration1?($("#"+this.prefix+"_firstLayerOrdinary").show(),this.txtShiftOrdinary1.SetEnabled(!0)):($("#"+this.prefix+"_firstLayerOrdinary").hide(),this.txtShiftOrdinary1.SetEnabled(!1))):(this.txtShiftStart1.SetEnabled(!1),this.cmbStartAt1.SetEnabled(!1)));this.oCalendarShift.CountLayers>1&&($("#"+this.prefix+"_advSecondLayer").show(),this.txtShiftStart2.SetDate(this.oCalendarShift.StartLayer2),this.oCalendarShift.StartLayer2.getDate()==29?this.cmbStartAt2.SetSelectedItem(this.cmbStartAt2.FindItemByValue(0)):this.oCalendarShift.StartLayer2.getDate()==30?this.cmbStartAt2.SetSelectedItem(this.cmbStartAt2.FindItemByValue(1)):this.oCalendarShift.StartLayer2.getDate()==31&&this.cmbStartAt2.SetSelectedItem(this.cmbStartAt2.FindItemByValue(2)),i=0,t=moment(this.oCalendarShift.StartLayer2).clone().startOf("day"),this.oShiftData==null?(i=moment(this.oCalendarShift.EndLayer2).diff(moment(this.oCalendarShift.StartLayer2),"minutes"),this.txtShiftComplementary2.SetDate(t.clone().toDate()),this.txtShiftOrdinary2.SetDate(t.clone().add(i,"minutes").toDate())):this.oCalendarShift.AllowComplementary2?(this.txtShiftComplementary2.SetDate(t.clone().add(parseInt(this.oShiftData.ShiftLayersDefinition[1].LayerComplementaryHours,10),"minutes").toDate()),this.txtShiftOrdinary2.SetDate(t.clone().add(parseInt(this.oShiftData.ShiftLayersDefinition[1].LayerOrdinaryHours,10),"minutes").toDate())):(this.txtShiftComplementary2.SetDate(t.clone().toDate()),this.oCalendarShift.AllowModifyIniHour1?(i=moment(this.oCalendarShift.EndLayer2).diff(moment(this.txtShiftStart2.GetDate()),"minutes"),this.txtShiftOrdinary2.SetDate(t.clone().add(i,"minutes").toDate())):this.txtShiftOrdinary2.SetDate(t.clone().add(parseInt(this.oShiftData.ShiftLayersDefinition[1].LayerDuration,10),"minutes").toDate())),this.oCalendarShift.AllowComplementary2?($("#"+this.prefix+"_secondLayerComplementary").show(),this.txtShiftComplementary2.SetEnabled(!0)):($("#"+this.prefix+"_secondLayerComplementary").hide(),this.txtShiftComplementary2.SetEnabled(!1)),this.oCalendarShift.AllowModifyIniHour2?(this.txtShiftStart2.SetEnabled(!0),this.cmbStartAt2.SetEnabled(!0),this.oCalendarShift.AllowComplementary2||this.oCalendarShift.AllowModifyDuration2?($("#"+this.prefix+"_secondLayerOrdinary").show(),this.txtShiftOrdinary2.SetEnabled(!0)):($("#"+this.prefix+"_secondLayerOrdinary").hide(),this.txtShiftOrdinary2.SetEnabled(!1))):(this.txtShiftStart2.SetEnabled(!1),this.cmbStartAt2.SetEnabled(!1)))};Robotics.Client.Controls.Forms.ComplementaryForm.prototype.getDateIfNullFromControl=function(n){return n.GetValue()!=null?n.GetDate():new Date(1999,11,30,0,0,0)};Robotics.Client.Controls.Forms.ComplementaryForm.prototype.getDayData=function(){let n={},t=this,i=moment(this.oCalendarShift.EndLayer1).diff(moment(this.oCalendarShift.StartLayer1),"minutes"),r=moment(this.oCalendarShift.EndLayer2).diff(moment(this.oCalendarShift.StartLayer2),"minutes");if(n.ID=this.oCalendarShift.IDShift,n.ShortName=this.oCalendarShift.ShortName,n.Name=this.oCalendarShift.Name,n.Color=this.oCalendarShift.Color,n.ShiftLayers=this.oCalendarShift.CountLayers,n.Type=this.oCalendarShift.Type,n.AdvancedParameters=this.oCalendarShift.AdvancedParameters,n.ExistComplementaryData=this.oCalendarShift.AllowComplementary,n.ExistFloatingData=this.oCalendarShift.AllowFloating,n.ShiftLayersDefinition=[],n.BreakHours=this.oCalendarShift.BreakHours,n.PlannedHours=this.oCalendarShift.WorkingHours,this.oCalendarShift.Type==Robotics.Client.Constants.ShiftType.NormalFloating){let i=30;this.cmbStartAtFloating.GetSelectedItem().value==0?i=29:this.cmbStartAtFloating.GetSelectedItem().value==2&&(i=31);n.StartHour=new Date(1999,11,i,t.getDateIfNullFromControl(t.txtShiftFloatingStart).getHours(),t.getDateIfNullFromControl(t.txtShiftFloatingStart).getMinutes(),0,0)}else if(n.ShiftLayers>0){let i=30;this.cmbStartAt1.GetSelectedItem().value==0?i=29:this.cmbStartAt1.GetSelectedItem().value==2&&(i=31);n.StartHour=new Date(1999,11,i,t.getDateIfNullFromControl(t.txtShiftStart1).getHours(),t.getDateIfNullFromControl(t.txtShiftStart1).getMinutes(),0,0)}else n.StartHour=this.oCalendarShift.StartFloating;if(n.ShiftLayers==0)n.PlannedHours=this.oCalendarShift.WorkingHours,n.EndHour=moment(n.StartHour).add(n.PlannedHours,"minutes").toDate();else{if(n.ShiftLayers>0){let f=30;this.cmbStartAt1.GetSelectedItem().value==0?f=29:this.cmbStartAt1.GetSelectedItem().value==2&&(f=31);let e=moment(t.getDateIfNullFromControl(t.txtShiftOrdinary1)),c=moment(t.getDateIfNullFromControl(t.txtShiftComplementary1)),o=e.clone().startOf("day"),s=e.clone().diff(o,"minutes"),h=c.clone().diff(o,"minutes"),r=s+h,u=new Date(1999,11,f,t.getDateIfNullFromControl(t.txtShiftStart1).getHours(),t.getDateIfNullFromControl(t.txtShiftStart1).getMinutes(),0,0);n.EndHour=this.oCalendarShift.AllowModifyIniHour1&&!this.oCalendarShift.HasLayer1FixedEnd?this.oCalendarShift.AllowModifyDuration1?moment(u).add(r,"minutes").toDate():moment(u).add(i,"minutes").toDate():this.oCalendarShift.AllowModifyIniHour1||this.oCalendarShift.HasLayer1FixedEnd?this.oCalendarShift.EndLayer1:moment(u).add(r,"minutes").toDate();n.PlannedHours=r;n.ShiftLayersDefinition.push({LayerStartTime:u,ExistLayerStartTime:t.oCalendarShift.AllowModifyIniHour1,LayerOrdinaryHours:s,LayerDuration:r,ExistLayerDuration:t.oCalendarShift.AllowModifyDuration1,LayerID:t.oCalendarShift.IDLayer1,LayerComplementaryHours:h})}if(n.ShiftLayers>1){let f=30;this.cmbStartAt2.GetSelectedItem().value==0?f=29:this.cmbStartAt2.GetSelectedItem().value==2&&(f=31);let e=moment(t.getDateIfNullFromControl(t.txtShiftOrdinary2)),c=moment(t.getDateIfNullFromControl(t.txtShiftComplementary2)),o=e.clone().startOf("day"),s=e.clone().diff(o,"minutes"),h=c.clone().diff(o,"minutes"),i=s+h,u=new Date(1999,11,f,t.getDateIfNullFromControl(t.txtShiftStart2).getHours(),t.getDateIfNullFromControl(t.txtShiftStart2).getMinutes(),0,0);n.EndHour=this.oCalendarShift.AllowModifyIniHour2&&!this.oCalendarShift.HasLayer2FixedEnd?this.oCalendarShift.AllowModifyDuration2?moment(u).add(i,"minutes").toDate():moment(u).add(r,"minutes").toDate():this.oCalendarShift.AllowModifyIniHour2||this.oCalendarShift.HasLayer2FixedEnd?this.oCalendarShift.EndLayer2:moment(u).add(i,"minutes").toDate();n.PlannedHours=n.PlannedHours+i;n.ShiftLayersDefinition.push({LayerStartTime:u,ExistLayerStartTime:t.oCalendarShift.AllowModifyIniHour2,LayerOrdinaryHours:s,LayerDuration:i,ExistLayerDuration:t.oCalendarShift.AllowModifyDuration2,LayerID:t.oCalendarShift.IDLayer2,LayerComplementaryHours:h})}n.PlannedHours=n.PlannedHours-t.oCalendarShift.BreakHours}return n};Robotics.Client.Controls.Forms.ComplementaryForm.prototype.getDayDataEditting=function(n,t){let r=moment(n.EndLayer1).diff(moment(n.StartLayer1),"minutes"),u=moment(n.EndLayer2).diff(moment(n.StartLayer2),"minutes");var i={};return i.Type=t.Type,i.IDShift=t.ID,i.IsFloating=n.IsFloating,i.WorkingHours=t.PlannedHours,i.AllowFloating=n.AllowFloating,i.StartFloating=moment(t.StartHour).clone().toDate(),i.AllowComplementary=n.AllowComplementary,i.Color=n.Color,i.Name=n.Name,i.ShortName=n.ShortName,i.IDLayer1=n.IDLayer1,i.IDLayer2=n.IDLayer2,i.CountLayers=n.CountLayers,i.HasLayer1FixedEnd=n.HasLayer1FixedEnd,i.HasLayer2FixedEnd=n.HasLayer2FixedEnd,i.AllowComplementary1=n.AllowComplementary1,i.AllowComplementary2=n.AllowComplementary2,i.AllowModifyIniHour1=n.AllowModifyIniHour1,i.AllowModifyIniHour2=n.AllowModifyIniHour2,i.AllowModifyDuration1=n.AllowModifyDuration1,i.AllowModifyDuration2=n.AllowModifyDuration2,i.BreakHours=n.BreakHours,i.AdvancedParameters=n.AdvancedParameters,i.BreakLayers=n.BreakLayers,n.CountLayers>0&&n.AllowModifyIniHour1?(i.StartLayer1=moment(t.ShiftLayersDefinition[0].LayerStartTime).clone().toDate(),i.EndLayer1=n.AllowModifyDuration1?moment(t.ShiftLayersDefinition[0].LayerStartTime).clone().add(t.ShiftLayersDefinition[0].LayerDuration,"minutes").toDate():n.HasLayer1FixedEnd?n.EndLayer1:moment(i.StartLayer1).add(r,"minutes").toDate()):(i.StartLayer1=n.StartLayer1,i.EndLayer1=n.EndLayer1),n.CountLayers>1&&n.AllowModifyIniHour2?(i.StartLayer2=moment(t.ShiftLayersDefinition[1].LayerStartTime).clone().toDate(),i.EndLayer2=n.AllowModifyDuration2?moment(t.ShiftLayersDefinition[1].LayerStartTime).clone().add(t.ShiftLayersDefinition[1].LayerDuration,"minutes").toDate():n.HasLayer2FixedEnd?n.EndLayer2:moment(i.StartLayer2).add(u,"minutes").toDate()):(i.StartLayer2=n.StartLayer2,i.EndLayer2=n.EndLayer2),i};Robotics.Client.Controls.Forms.ComplementaryForm.prototype.canChangeShift=function(n,t,i,r){if(!n)return!0;if(i!=null&&r!=null&&t.MainShift.ID==i.ID&&t.AssigData.ID==r.ID){if(t.MainShift.PlannedHours!=i.PlannedHours||!moment(t.MainShift.StartHour).isSame(moment(i.StartHour)))return!1}else return!1;return!0};Robotics.Client.Controls.Forms.ComplementaryForm.prototype.isValid=function(){var n=this,t=!0,f=-1,e=-1,h=-1,o=-1,ut=-1,c=null,k=null,nt=null,tt=null,i,u,d,g,rt,s,w,b;let ft=moment(this.oCalendarShift.EndLayer1).diff(moment(this.oCalendarShift.StartLayer1),"minutes"),et=moment(this.oCalendarShift.EndLayer2).diff(moment(this.oCalendarShift.StartLayer2),"minutes");if(this.oCalendarShift.IDLayer1>0){var a=moment(n.getDateIfNullFromControl(n.txtShiftOrdinary1)),it=moment(n.getDateIfNullFromControl(n.txtShiftComplementary1)),r=null,v=moment(n.oCalendarShift.EndLayer1),u=30;if(this.cmbStartAt1.GetSelectedItem().value==0?u=29:this.cmbStartAt1.GetSelectedItem().value==2&&(u=31),r=moment(new Date(1999,11,u,n.getDateIfNullFromControl(n.txtShiftStart1).getHours(),n.getDateIfNullFromControl(n.txtShiftStart1).getMinutes(),0,0)),c=r.toDate(),i=a.clone().startOf("day"),f=a.clone().diff(i,"minutes"),e=it.clone().diff(i,"minutes"),v=this.oCalendarShift.AllowModifyDuration1?r.clone().add(f+e,"minutes"):this.oCalendarShift.AllowModifyIniHour1?this.oCalendarShift.HasLayer1FixedEnd?r.clone().add(moment(this.oCalendarShift.EndLayer1).diff(moment(this.oCalendarShift.StartLayer1),"minutes"),"minutes"):r.clone().add(ft,"minutes"):r.clone().add(ft,"minutes"),nt=v.toDate(),h=r.clone().diff(i,"minutes"),o=v.clone().diff(i,"minutes"),!this.oCalendarShift.AllowModifyDuration1&&!this.oCalendarShift.AllowModifyIniHour1&&f+e!=o-h)return t=!1,this.showErrorPopup("Error.Title","error","Calendar.Client.InvalidDataNoDurationNoIniDurationF1","","Error.OK","Error.OKDesc",""),t;if(!this.oCalendarShift.AllowModifyDuration1&&this.oCalendarShift.AllowModifyIniHour1&&f+e!=o-h)return t=!1,this.showErrorPopup("Error.Title","error","Calendar.Client.InvalidDataNoDurationYesIniDurationF1","","Error.OK","Error.OKDesc",""),t;if(this.oCalendarShift.AllowModifyDuration1&&!this.oCalendarShift.AllowModifyIniHour1&&f+e!=o-h)return t=!1,this.showErrorPopup("Error.Title","error","Calendar.Client.InvalidDataYesDurationNoIniDurationF1","","Error.OK","Error.OKDesc",""),t;if(this.oCalendarShift.AllowModifyDuration1&&this.oCalendarShift.AllowModifyIniHour1&&f+e<=0)return t=!1,this.showErrorPopup("Error.Title","error","Calendar.Client.InvalidDataYesDurationYesIniDurationF1","","Error.OK","Error.OKDesc",""),t}if(this.oCalendarShift.IDLayer2>0){var a=moment(n.getDateIfNullFromControl(n.txtShiftOrdinary2)),it=moment(n.getDateIfNullFromControl(n.txtShiftComplementary2)),r=null,v=moment(n.oCalendarShift.EndLayer2),u=30;if(this.cmbStartAt2.GetSelectedItem().value==0?u=29:this.cmbStartAt2.GetSelectedItem().value==2&&(u=31),r=moment(new Date(1999,11,u,n.getDateIfNullFromControl(n.txtShiftStart2).getHours(),n.getDateIfNullFromControl(n.txtShiftStart2).getMinutes(),0,0)),k=r.toDate(),i=a.clone().startOf("day"),f=a.clone().diff(i,"minutes"),e=it.clone().diff(i,"minutes"),v=this.oCalendarShift.AllowModifyDuration2?r.clone().add(f+e,"minutes"):this.oCalendarShift.AllowModifyIniHour2?this.oCalendarShift.HasLayer2FixedEnd?r.clone().add(moment(this.oCalendarShift.EndLayer2).diff(moment(this.oCalendarShift.StartLayer2),"minutes"),"minutes"):r.clone().add(et,"minutes"):r.clone().add(et,"minutes"),tt=v.toDate(),h=r.clone().diff(i,"minutes"),o=v.clone().diff(i,"minutes"),!this.oCalendarShift.AllowModifyDuration2&&!this.oCalendarShift.AllowModifyIniHour2&&f+e!=o-h)return t=!1,this.showErrorPopup("Error.Title","error","Calendar.Client.InvalidDataNoDurationNoIniDurationF2","","Error.OK","Error.OKDesc",""),t;if(!this.oCalendarShift.AllowModifyDuration2&&this.oCalendarShift.AllowModifyIniHour2&&f+e!=o-h)return t=!1,this.showErrorPopup("Error.Title","error","Calendar.Client.InvalidDataNoDurationYesIniDurationF2","","Error.OK","Error.OKDesc",""),t;if(this.oCalendarShift.AllowModifyDuration2&&!this.oCalendarShift.AllowModifyIniHour2&&f+e!=o-h)return t=!1,this.showErrorPopup("Error.Title","error","Calendar.Client.InvalidDataYesDurationNoIniDurationF2","","Error.OK","Error.OKDesc",""),t;if(this.oCalendarShift.AllowModifyDuration2&&this.oCalendarShift.AllowModifyIniHour2&&f+e<=0)return t=!1,this.showErrorPopup("Error.Title","error","Calendar.Client.InvalidDataYesDurationYesIniDurationF2","","Error.OK","Error.OKDesc",""),t}if(this.oCalendarShift.IDLayer2>0&&this.oCalendarShift.IDLayer1>0){if(u=30,this.cmbStartAt1.GetSelectedItem().value==0?u=29:this.cmbStartAt1.GetSelectedItem().value==2&&(u=31),d=new Date(1900,0,1,0,0,0,0),d=new Date(1999,11,u,n.getDateIfNullFromControl(n.txtShiftStart1).getHours(),n.getDateIfNullFromControl(n.txtShiftStart1).getMinutes(),0,0),g=new Date(1900,0,1,0,0,0,0),g=new Date(1999,11,u,this.oCalendarShift.EndLayer1.getHours(),this.oCalendarShift.EndLayer1.getMinutes(),0,0),this.oCalendarShift.AllowModifyDuration1){var a=moment(n.getDateIfNullFromControl(n.txtShiftOrdinary1)),it=moment(n.getDateIfNullFromControl(n.txtShiftComplementary1)),i=a.clone().startOf("day");f=a.clone().diff(i,"minutes");e=it.clone().diff(i,"minutes");g=r.clone().add(f+e,"minutes").toDate()}if(h=moment(d).clone().diff(i,"minutes"),o=moment(g).clone().diff(i,"minutes"),this.oCalendarShift.AllowModifyDuration1&&(o=moment(n.getDateIfNullFromControl(n.txtShiftOrdinary1)).diff(i,"minutes")+moment(n.getDateIfNullFromControl(n.txtShiftComplementary1)).diff(i,"minutes"),o=o+moment(d).diff(i,"minutes")),u=30,this.cmbStartAt2.GetSelectedItem().value==0?u=29:this.cmbStartAt2.GetSelectedItem().value==2&&(u=31),rt=new Date(1900,0,1,0,0,0,0),rt=new Date(1999,11,u,n.getDateIfNullFromControl(n.txtShiftStart2).getHours(),n.getDateIfNullFromControl(n.txtShiftStart2).getMinutes(),0,0),ut=moment(rt).clone().diff(i,"minutes"),o>=ut)return t=!1,this.showErrorPopup("Error.Title","error","Calendar.Client.OverlappedLayers","","Error.OK","Error.OKDesc",""),t}for(s=0;s<this.oCalendarShift.BreakLayers.length;s++){var l=!1,y=null,p=null;if(c!=null&&(moment(this.oCalendarShift.BreakLayers[s].Start).get("date")==1?(w=moment(this.oCalendarShift.BreakLayers[s].Start),b=moment(this.oCalendarShift.BreakLayers[s].Finish),y=moment(c).add(w.get("hour"),"hours").add(w.get("minute"),"minutes").toDate(),p=moment(c).add(b.get("hour"),"hours").add(b.get("minute"),"minutes").toDate()):(y=this.oCalendarShift.BreakLayers[s].Start,p=this.oCalendarShift.BreakLayers[s].Finish),l=moment(y).isBetween(moment(c),moment(nt),null,"[]"),l=l&&moment(p).isBetween(moment(c),moment(nt),null,"[]")),l||k==null||(moment(this.oCalendarShift.BreakLayers[s].Start).get("date")==1?(w=moment(this.oCalendarShift.BreakLayers[s].Start),b=moment(this.oCalendarShift.BreakLayers[s].Finish),y=moment(c).add(w.get("hour"),"hours").add(w.get("minute"),"minutes").toDate(),p=moment(c).add(b.get("hour"),"hours").add(b.get("minute"),"minutes").toDate()):(y=this.oCalendarShift.BreakLayers[s].Start,p=this.oCalendarShift.BreakLayers[s].Finish),l=moment(y).isBetween(moment(k),moment(tt),null,"[]"),l=l&&moment(p).isBetween(moment(k),moment(tt),null,"[]")),!l&&(c!=null||k!=null))return t=!1,this.showErrorPopup("Error.Title","error","Calendar.Client.BreakNotFit","","Error.OK","Error.OKDesc",""),t}return t},function(){var n=function(n){for(var r=n.split("."),i=window,t=0;t<r.length;t+=1)i=i[r[t]]=i[r[t]]||{};return i};n("Robotics.Client.Controls.Forms")}();Robotics.Client.Controls.Forms.PUnitSelectorForm=function(prefix,showErrorPopup){this.prefix=prefix;this.showErrorPopup=showErrorPopup;this.cmbAvailablePUnits=eval(this.prefix+"_cmbAvailablePUnits")};Robotics.Client.Controls.Forms.PUnitSelectorForm.prototype.getSelectedItem=function(){return this.cmbAvailablePUnits.GetSelectedItem()!=null?this.cmbAvailablePUnits.GetSelectedItem().value:-1},function(){var n=function(n){for(var r=n.split("."),i=window,t=0;t<r.length;t+=1)i=i[r[t]]=i[r[t]]||{};return i};n("Robotics.Client.Controls.Forms")}();Robotics.Client.Controls.Forms.ShiftSelectorForm=function(prefix,showErrorPopup){this.prefix=prefix;this.showErrorPopup=showErrorPopup;this.shiftDefinition={};this.assignmentsDefinition={};this.cmbAvailableShifts=eval(this.prefix+"_cmbAvailableShifts");this.cmbSelectedShiftProperties=null};Robotics.Client.Controls.Forms.ShiftSelectorForm.prototype.getShiftsDefinition=function(){return this.shiftDefinition=JSON.parse(this.cmbAvailableShifts.cpShiftDefinition,roDateReviver),this.shiftDefinition};Robotics.Client.Controls.Forms.ShiftSelectorForm.prototype.getAssignmentsDefinition=function(){return this.assignmentsDefinition=JSON.parse(this.cmbAvailableShifts.cpAssignmentsDefinition,roDateReviver),this.assignmentsDefinition};Robotics.Client.Controls.Forms.ShiftSelectorForm.prototype.getSelectedItem=function(){if(this.shiftDefinition=JSON.parse(this.cmbAvailableShifts.cpShiftDefinition,roDateReviver),this.assignmentsDefinition=JSON.parse(this.cmbAvailableShifts.cpAssignmentsDefinition,roDateReviver),this.cmbAvailableShifts.GetSelectedItem()!=null)for(var n=0;n<this.shiftDefinition.length;n++)if(this.shiftDefinition[n].Id==parseInt(this.cmbAvailableShifts.GetSelectedItem().value,10)){this.cmbSelectedShiftProperties=Object.clone(this.shiftDefinition[n],!0);break}return this.cmbSelectedShiftProperties},function(){var n=function(n){for(var r=n.split("."),i=window,t=0;t<r.length;t+=1)i=i[r[t]]=i[r[t]]||{};return i};n("Robotics.Client.Controls.Forms")}();Robotics.Client.Controls.Forms.StarterForm=function(prefix,showErrorPopup){this.prefix=prefix;this.oCalendarShift=null;this.oOriginShiftInfo=null;this.oShiftData=null;this.showErrorPopup=showErrorPopup;this.shiftDefinitionCallback=eval(this.prefix+"_shiftDefinitionCallbackClient");this.txtShiftStart1=eval(this.prefix+"_txtShiftStart1Client");this.txtShiftEnd1=eval(this.prefix+"_txtShiftEnd1Client");this.txtShiftOrdinary1=eval(this.prefix+"_txtShiftOrdinary1Client")};Robotics.Client.Controls.Forms.StarterForm.prototype.prepareStarterDialog=function(n,t,i){var r,u;return this.oShiftData=typeof i!="undefined"?i:null,n==null?(r={},r.idShift=t,r.StampParam=(new Date).getMilliseconds(),r.action="SHIFTLAYERDEFINITION",u=JSON.stringify(r),u=encodeURIComponent(u),this.shiftDefinitionCallback.PerformCallback(u),!1):(this.oCalendarShift=this.oShiftData!=null?this.getDayDataEditting(n,this.oShiftData):n,this.finallyPrepareDialogElements(),!0)};Robotics.Client.Controls.Forms.StarterForm.prototype.finallyPrepareDialogElements=function(n){typeof n!="undefined"&&(this.oCalendarShift=n);this.txtShiftStart1.SetDate(this.oCalendarShift.StartFloating);this.txtShiftEnd1.SetDate(this.oCalendarShift.EndFloating);var t=moment(this.oCalendarShift.StartLayer1).clone().startOf("day");this.txtShiftOrdinary1.SetDate(t.clone().add(this.oCalendarShift.WorkingHours,"minutes").toDate())};Robotics.Client.Controls.Forms.StarterForm.prototype.setOffset=function(n){var t=0,i;t==0&&(i=new Date(1999,11,30,this.oCalendarShift.StartFloating.getHours(),this.oCalendarShift.StartFloating.getMinutes(),0,0),t=moment(n).diff(moment(i),"minutes"));t!=0&&(this.txtShiftStart1.SetDate(moment(this.oCalendarShift.StartFloating).clone().add(t,"minutes").toDate()),this.txtEndStart1.SetDate(moment(this.oCalendarShift.EndFloating).clone().add(t,"minutes").toDate()))};Robotics.Client.Controls.Forms.StarterForm.prototype.isValid=function(){var n=this,u=!0,t=new Date(1900,0,1,0,0,0,0),i,r,f,e;return(t=new Date(1999,11,n.getDateIfNullFromControl(n.txtShiftStart1).getDate(),n.getDateIfNullFromControl(n.txtShiftStart1).getHours(),n.getDateIfNullFromControl(n.txtShiftStart1).getMinutes(),0,0),i=new Date(1900,0,1,0,0,0,0),i=new Date(1999,11,n.getDateIfNullFromControl(n.txtShiftEnd1).getDate(),n.getDateIfNullFromControl(n.txtShiftEnd1).getHours(),n.getDateIfNullFromControl(n.txtShiftEnd1).getMinutes(),0,0),r=moment(i).diff(moment(t),"minutes"),r<0&&(i=moment(i).clone().add(1,"days").toDate(),this.txtShiftEnd1.SetDate(i),r=moment(i).diff(moment(t),"minutes")),t=new Date(1900,0,1,0,0,0,0),t=new Date(1999,11,n.getDateIfNullFromControl(n.txtShiftStart1).getDate(),n.getDateIfNullFromControl(n.txtShiftOrdinary1).getHours(),n.getDateIfNullFromControl(n.txtShiftOrdinary1).getMinutes(),0,0),f=moment(t).clone().startOf("day"),e=moment(t).diff(moment(f.toDate()),"minutes"),r<e)?(u=!1,this.showErrorPopup("Error.Title","error","Calendar.Client.WorkingHoursOverDuration","","Error.OK","Error.OKDesc",""),u):u};Robotics.Client.Controls.Forms.StarterForm.prototype.getDateIfNullFromControl=function(n){return n.GetValue()!=null?n.GetDate():new Date(1999,11,30,0,0,0)};Robotics.Client.Controls.Forms.StarterForm.prototype.getDayDataEditting=function(n,t){var i={};return i.Type=t.Type,i.AdvancedParameters=t.AdvancedParameters,i.IDShift=t.ID,i.IsFloating=n.IsFloating,i.WorkingHours=t.PlannedHours,i.AllowFloating=n.AllowFloating,i.StartFloating=moment(t.StartHour).clone().toDate(),i.EndFloating=moment(t.EndHour).clone().toDate(),i.AllowComplementary=n.AllowComplementary,i.Color=n.Color,i.Name=n.Name,i.ShortName=n.ShortName,i.IDLayer1=n.IDLayer1,i.IDLayer2=n.IDLayer2,i.CountLayers=n.CountLayers,i.HasLayer1FixedEnd=n.HasLayer1FixedEnd,i.HasLayer2FixedEnd=n.HasLayer2FixedEnd,i.AllowComplementary1=n.AllowComplementary1,i.AllowComplementary2=n.AllowComplementary2,i.AllowModifyIniHour1=n.AllowModifyIniHour1,i.AllowModifyIniHour2=n.AllowModifyIniHour2,i.AllowModifyDuration1=n.AllowModifyDuration1,i.AllowModifyDuration2=n.AllowModifyDuration2,i.BreakHours=n.BreakHours,i.StartLayer1=n.StartLayer1,i.EndLayer1=n.EndLayer1,i.StartLayer2=n.StartLayer2,i.EndLayer2=n.EndLayer2,i};Robotics.Client.Controls.Forms.StarterForm.prototype.getDayData=function(){var t={},n=this,i=new Date(1900,0,1,0,0,0,0);i=new Date(1999,11,n.getDateIfNullFromControl(n.txtShiftStart1).getDate(),n.getDateIfNullFromControl(n.txtShiftOrdinary1).getHours(),n.getDateIfNullFromControl(n.txtShiftOrdinary1).getMinutes(),0,0);var f=moment(i).clone().startOf("day"),r=moment(i).diff(moment(f.toDate()),"minutes"),u="U"+n.getDateIfNullFromControl(n.txtShiftStart1).getHours().toString().padStart(2,"0")+n.getDateIfNullFromControl(n.txtShiftStart1).getMinutes().toString().padStart(2,"0")+(n.getDateIfNullFromControl(n.txtShiftEnd1).getHours().toString().padStart(2,"0")+n.getDateIfNullFromControl(n.txtShiftEnd1).getMinutes().toString().padStart(2,"0")+r);var e=n.getDateIfNullFromControl(n.txtShiftStart1).getMinutes().toString().padStart(2,"0")+n.getDateIfNullFromControl(n.txtShiftStart1).getHours().toString().padStart(2,"0"),o=n.getDateIfNullFromControl(n.txtShiftEnd1).getMinutes().toString().padStart(2,"0")+n.getDateIfNullFromControl(n.txtShiftEnd1).getHours().toString().padStart(2,"0"),s=r;return t.ID=this.oCalendarShift.IDShift,t.ShortName=u,t.Name=u,t.Color=(new Robotics.Client.Common.roHtmlColor).randomColorWithSeed(e,o,s),t.ShiftLayers=this.oCalendarShift.CountLayers,t.Type=this.oCalendarShift.Type,t.AdvancedParameters=this.oCalendarShift.AdvancedParameters,t.ExistComplementaryData=!1,t.ExistFloatingData=!1,t.ShiftLayersDefinition=[],t.BreakHours=this.oCalendarShift.BreakHours,t.PlannedHours=this.oCalendarShift.WorkingHours,t.AdvancedParameters=this.oCalendarShift.AdvancedParameters,t.StartHour=new Date(1999,11,30,n.getDateIfNullFromControl(n.txtShiftStart1).getHours(),n.getDateIfNullFromControl(n.txtShiftStart1).getMinutes(),0,0),t.EndHour=n.getDateIfNullFromControl(n.txtShiftEnd1).getHours()>=n.getDateIfNullFromControl(n.txtShiftStart1).getHours()?new Date(1999,11,30,n.getDateIfNullFromControl(n.txtShiftEnd1).getHours(),n.getDateIfNullFromControl(n.txtShiftEnd1).getMinutes(),0,0):new Date(1999,11,31,n.getDateIfNullFromControl(n.txtShiftEnd1).getHours(),n.getDateIfNullFromControl(n.txtShiftEnd1).getMinutes(),0,0),t.PlannedHours=r,t},function(n){"use strict";n.widget("ui.selectableScroll",n.ui.selectable,{options:{scrollElement:null,scrollSnapX:5,scrollSnapY:5,scrollAmount:25,scrollIntervalTime:100},_create:function(){this.element.addClass("ui-selectable");this.dragged=!1;this.helperClasses=["no-top","no-right","no-bottom","no-left"];this.scrollElement=this.options.scrollElement||this.element;this.refresh();this._mouseInit();this.helper=n('<div class="ui-selectable-helper"><\/div>')},refresh:function(){var t=this.scrollElement.offset(),i=this.scrollElement.prop("scrollLeft"),r=this.scrollElement.prop("scrollTop");this.selectees=n(this.options.filter,this.scrollElement[0]);this.selectees.addClass("ui-selectee");this.selectees.each(function(){var u=n(this),f=u.offset();n.data(this,"selectable-item",{element:this,$element:u,left:f.left,top:f.top,right:f.left+u.outerWidth(),bottom:f.top+u.outerHeight(),relative:{left:f.left-t.left+i,top:f.top-t.top+r,right:f.left-t.left+i+u.outerWidth(),bottom:f.top-t.top+r+u.outerHeight()},startselected:!1,selected:u.hasClass("ui-selected"),selecting:u.hasClass("ui-selecting"),unselecting:u.hasClass("ui-unselecting")})})},_mouseStart:function(t){var i=this.scrollElement.offset(),r;return t.pageX>this.scrollElement.prop("clientWidth")+i.left||t.pageY>this.scrollElement.prop("clientHeight")+i.top?!1:(r=n.ui.selectable.prototype._mouseStart.call(this,t),this.lastDragEvent=null,this.scrollInfo={elementOffset:this.scrollElement.offset(),scrollWidth:this.scrollElement.prop("scrollWidth"),scrollHeight:this.scrollElement.prop("scrollHeight"),elementWidth:this.scrollElement.prop("clientWidth"),elementHeight:this.scrollElement.prop("clientHeight")},this.scrollInfo.dragStartXPos=t.pageX-this.scrollInfo.elementOffset.left+this.scrollElement.prop("scrollLeft"),this.scrollInfo.dragStartYPos=t.pageY-this.scrollInfo.elementOffset.top+this.scrollElement.prop("scrollTop"),this.scrollIntervalId=null,r)},_updateHelper:function(t){var r,u,o,s,i=[],f,e;for(t.x1-t.scrollLeft<0?(i.push("no-left"),r=this.scrollInfo.elementOffset.left):r=this.scrollInfo.elementOffset.left+t.x1-t.scrollLeft,t.y1-t.scrollTop<0?(i.push("no-top"),u=this.scrollInfo.elementOffset.top):u=this.scrollInfo.elementOffset.top+t.y1-t.scrollTop,t.x2-t.scrollLeft>this.scrollInfo.elementWidth?(i.push("no-right"),o=this.scrollInfo.elementOffset.left+this.scrollInfo.elementWidth):o=this.scrollInfo.elementOffset.left+t.x2-t.scrollLeft,t.y2-t.scrollTop>this.scrollInfo.elementHeight?(i.push("no-bottom"),s=this.scrollInfo.elementOffset.top+this.scrollInfo.elementHeight):s=this.scrollInfo.elementOffset.top+t.y2-t.scrollTop,f=0;f<this.helperClasses.length;f++)e=this.helperClasses[f],n.inArray(e,i)!==-1?this.helper.addClass(e):this.helper.removeClass(e);this.helper.css({left:r,top:u,width:o-r,height:s-u})},_scrollIfNeeded:function(){var n=this.scrollElement.prop("scrollLeft"),t=this.scrollElement.prop("scrollTop"),i=!1;return this.lastDragEvent.pageX-this.scrollInfo.elementOffset.left<this.options.scrollSnapX&&n>0&&(n=n<this.options.scrollAmount?0:n-this.options.scrollAmount,this.scrollElement.prop("scrollLeft",n),i=!0),this.lastDragEvent.pageY-this.scrollInfo.elementOffset.top<this.options.scrollSnapY&&t>0&&(t=t<this.options.scrollAmount?0:t-this.options.scrollAmount,this.scrollElement.prop("scrollTop",t),i=!0),this.lastDragEvent.pageX-this.scrollInfo.elementOffset.left>this.scrollInfo.elementWidth-this.options.scrollSnapX&&this.scrollInfo.scrollWidth>n+this.scrollInfo.elementWidth&&(n=n+this.options.scrollAmount>this.scrollInfo.scrollWidth-this.scrollInfo.elementWidth?this.scrollInfo.scrollWidth-this.scrollInfo.elementWidth:n+this.options.scrollAmount,this.scrollElement.prop("scrollLeft",n),i=!0),this.lastDragEvent.pageY-this.scrollInfo.elementOffset.top>this.scrollInfo.elementHeight-this.options.scrollSnapY&&this.scrollInfo.scrollHeight>n+this.scrollInfo.elementHeight&&(t=t+this.options.scrollAmount>this.scrollInfo.scrollHeight-this.scrollInfo.elementHeight?this.scrollInfo.scrollHeight-this.scrollInfo.elementHeight:t+this.options.scrollAmount,this.scrollElement.prop("scrollTop",t),i=!0),{scrollLeft:n,scrollTop:t,keepScrolling:i}},_calcRelativePosition:function(n){var t=n.x-this.scrollInfo.elementOffset.left+n.scrollLeft,i=n.y-this.scrollInfo.elementOffset.top+n.scrollTop;return{x:t,y:i}},_calcRelativeArea:function(n){var t=n.xPos<this.scrollInfo.dragStartXPos?n.xPos:this.scrollInfo.dragStartXPos,i=n.yPos<this.scrollInfo.dragStartYPos?n.yPos:this.scrollInfo.dragStartYPos,r=n.xPos>this.scrollInfo.dragStartXPos?n.xPos:this.scrollInfo.dragStartXPos,u=n.yPos>this.scrollInfo.dragStartYPos?n.yPos:this.scrollInfo.dragStartYPos;return{x1:t,y1:i,x2:r,y2:u}},_updateSelectees:function(t){var i=this;this.selectees.each(function(){var r=n.data(this,"selectable-item"),u=!1;r&&r.element!==i.element[0]&&(i.options.tolerance==="touch"?u=!(r.relative.left>t.x2||r.relative.right<t.x1||r.relative.top>t.y2||r.relative.bottom<t.y1):i.options.tolerance==="fit"&&(u=r.relative.left>t.x1&&r.relative.right<t.x2&&r.relative.top>t.y1&&r.relative.bottom<t.y2),u?(r.selected&&(r.$element.removeClass("ui-selected"),r.selected=!1),r.unselecting&&(r.$element.removeClass("ui-unselecting"),r.unselecting=!1),r.selecting||(r.$element.addClass("ui-selecting"),r.selecting=!0,i._trigger("selecting",i.lastDragEvent,{selecting:r.element}))):(r.selecting&&((i.lastDragEvent.metaKey||i.lastDragEvent.ctrlKey)&&r.startselected?(r.$element.removeClass("ui-selecting"),r.selecting=!1,r.$element.addClass("ui-selected"),r.selected=!0):(r.$element.removeClass("ui-selecting"),r.selecting=!1,r.startselected&&(r.$element.addClass("ui-unselecting"),r.unselecting=!0),i._trigger("unselecting",i.lastDragEvent,{unselecting:r.element}))),r.selected&&(i.lastDragEvent.metaKey||i.lastDragEvent.ctrlKey||r.startselected||(r.$element.removeClass("ui-selected"),r.selected=!1,r.$element.addClass("ui-unselecting"),r.unselecting=!0,i._trigger("unselecting",i.lastDragEvent,{unselecting:r.element})))))})},_mouseDrag:function(n){if(this.dragged=!0,!this.options.disabled){this.lastDragEvent=n;var t=this._scrollIfNeeded();return this._updateIntervals({keepScrolling:t.keepScrolling}),this._updateUi({doUpdateHelper:!0}),!1}},_updateUi:function(n){var i=this._scrollIfNeeded({pageX:this.lastDragEvent.pageX,pageY:this.lastDragEvent.pageY}),r=this._calcRelativePosition({x:this.lastDragEvent.pageX,y:this.lastDragEvent.pageY,scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}),t=this._calcRelativeArea({xPos:r.x,yPos:r.y});n.doUpdateHelper&&this._updateHelper({scrollLeft:i.scrollLeft,scrollTop:i.scrollTop,x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2});this._updateSelectees({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2})},_updateIntervals:function(n){var t=this;n.keepScrolling&&!this.scrollIntervalId&&(this.scrollIntervalId=setInterval(function(){t._updateUi({doUpdateHelper:!1})},this.options.scrollIntervalTime));!n.keepScrolling&&this.scrollIntervalId&&this._clearIntervals()},_clearIntervals:function(){this.scrollIntervalId&&clearInterval(this.scrollIntervalId);this.scrollIntervalId=null},_mouseStop:function(t){this._clearIntervals();return n.ui.selectable.prototype._mouseStop.call(this,t)}})}(jQuery);