function onReportConfigurationPopUpHidden(){$(".updateReport").hide();$(".runReport").show();loadRequest();updating=!1}function onReportConfigurationPopupShown(){initializePopUpComponents();existingView=!0;viewUtilsManager.loadViewOptions("Genius","read",function(){let n=parseInt(SelectedTask,10);n!=-1&&loadGeniusByTask(n)},()=>{},"LiveGenius");$("#ReportUsers").off("click");$("#ReportUsers").on("click",function(){let n={Employees:[],Groups:[],Filter:"11110",UserFields:"",ComposeMode:"Custom",ComposeFilter:"",Advanced:!1,Operation:"or"};if(currentGeniusView!=null){let t=currentGeniusView.Employees.split("#")[0].split(",");for(let i=0;i<t.length;i++)t[i].charAt(0)=="A"?n.ComposeFilter+=n.ComposeFilter==""?`A${t[i].substring(1)}`:`,A${t[i].substring(1)}`:t[i].charAt(0)=="B"&&(n.ComposeFilter+=n.ComposeFilter==""?`B${t[i].substring(1)}`:`,B${t[i].substring(1)}`)}parent.showLoader(!0);$("#divGeniusEmployeeSelector").load("/Employee/EmployeeSelectorPartial?feature=Employees&pageName=genius&config=100&unionType=or&advancedMode=1&advancedFilter=0&allowAll=0&allowNone=0",function(){loadPartialInfo();initUniversalSelector(n,!1,"geniusSelector");parent.showLoader(!1)});existingView=!0});currentGeniusEditParameters.Causes=currentGeniusView.Causes;currentGeniusEditParameters.UpdatedCauses=!1;$("#txtCauses").off("click");$("#txtCauses").on("click",function(){$("#CauesPopUp").dxPopup("instance").show();setTimeout(function(){currentGeniusEditParameters.UpdatedCauses=!0;currentGeniusView.Causes!=""?($("#ckIncludeAllCauses").dxRadioGroup("instance").option("value","1"),lstCauses.SelectValues(currentGeniusView.Causes.split(",")),lstCauses.SetEnabled(!0)):($("#ckIncludeAllCauses").dxRadioGroup("instance").option("value","0"),lstCauses.UnselectAll(),lstCauses.SetEnabled(!1))},100)});initializeReportPopUpFields();isCostCenterDefaultView(currentGeniusView)?$(".costCenterInfo").show():$(".costCenterInfo").hide();isCostCenterAndIncidencesDefaultView(currentGeniusView)?$(".costcenterAndIncidencesinfo").show():$(".costcenterAndIncidencesinfo").hide();isBalancesDefaultView(currentGeniusView)?$(".conceptsInfo").show():$(".conceptsInfo").hide();isCausesDefaultView(currentGeniusView)?$(".causesInfo").show():$(".causesInfo").hide();isRequestsDefaultView(currentGeniusView)?$(".requestsInfo").show():$(".requestsInfo").hide();isJustificationsByTimeDefaultView(currentGeniusView)&&!updating?$(".timeInfo").show():$(".timeInfo").hide();currentGeniusView.IdPassport<=0?($(".divDestination").show(),$("#newView").show(),$(".runsDescriptionPopUp").hide(),$("#runView").hide()):(updating?$(".divDestination").show():(currentGeniusView.Employees?$(".divDestination").hide():$(".divDestination").show(),$(".costCenterInfo").hide(),$(".costcenterAndIncidencesinfo").hide(),$(".conceptsInfo").hide(),$(".causesInfo").hide(),$(".zeroAvailable").hide(),$(".zeroCausesAvailable").hide(),$(".requestsInfo").hide()),$("#newView").hide(),$(".runsDescriptionPopUp").show(),$("#runView").show());clearNewForm()}function initializeUserFieldsTagBox(){if(currentGeniusView.UserFields!=null&&currentGeniusView.UserFields!=""){var n=currentGeniusView.UserFields.split(",");$("#UserFieldsUpdateText").dxTagBox("instance").option("value",n)}else $("#UserFieldsUpdateText").dxTagBox("instance").option("value",null)}function costCentersSelected2Str(){var t,i,n;if(typeof lstCostCenters!="undefined"){for(t=lstCostCenters.GetSelectedValues(),i="",n=0;n<t.length;n++)n==0?i=t[n]:i+=","+t[n];return i}return""}function costCentersSelected2StrTagBox(){var t,i,n;if($("#txtCostCenters").dxTagBox("instance")!=null){if(t=$("#txtCostCenters").dxTagBox("instance").option("value"),t!=null){for(i="",n=0;n<t.length;n++)n==0?i=t[n]:i+=","+t[n];return i}return""}return""}function conceptsSelected2Str(){var t,i,n;if(typeof lstConcepts!="undefined"){for(t=lstConcepts.GetSelectedValues(),i="",n=0;n<t.length;n++)n==0?i=t[n]:i+=","+t[n];return i}return""}function conceptsSelected2StrTagBox(){var t,i,n;if($("#txtConcepts").dxTagBox("instance")!=null){if(t=$("#txtConcepts").dxTagBox("instance").option("value"),t!=null){for(i="",n=0;n<t.length;n++)n==0?i=t[n]:i+=","+t[n];return i}return""}return""}function causesSelected2Str(){var t,i,n;if(typeof lstCauses!="undefined"){for(t=lstCauses.GetSelectedValues(),i="",n=0;n<t.length;n++)n==0?i=t[n]:i+=","+t[n];return i}return""}function requestsSelected2Str(){var t,i,n;if(typeof lstRequests!="undefined"){for(t=lstRequests.GetSelectedValues(),i="",n=0;n<t.length;n++)n==0?i=t[n]:i+=","+t[n];return i}return""}function requestsSelected2StrTagBox(){var t,i,n;if($("#txtRequests").dxTagBox("instance")!=null){if(t=$("#txtRequests").dxTagBox("instance").option("value"),t!=null){for(i="",n=0;n<t.length;n++)n==0?i=t[n]:i+=","+t[n];return i}return""}return""}function onPlanningListLoaded(n){currentGeniusView.PlanningList=n}function initializeCostCentersTagBox(){if(currentGeniusView.BusinessCenters!=null&&currentGeniusView.BusinessCenters!=""){var n=currentGeniusView.BusinessCenters.split(",").map(function(n){return parseInt(n)});$("#txtCostCenters").dxTagBox("instance").option("value",n)}else $("#txtCostCenters").dxTagBox("instance").option("value",null)}function initializeConceptssTagBox(){if(currentGeniusView.Concepts!=null&&currentGeniusView.Concepts!=""){var n=currentGeniusView.Concepts.split(",").map(function(n){return parseInt(n)});$("#txtConcepts").dxTagBox("instance").option("value",n)}else $("#txtConcepts").dxTagBox("instance").option("value",null)}function initializeRequestsTagBox(){if(currentGeniusView.CustomFields!=null&&currentGeniusView.CustomFields.RequestTypes!=null&&currentGeniusView.CustomFields.RequestTypes!=""){var n=currentGeniusView.CustomFields.RequestTypes.split(",").map(function(n){return parseInt(n)});$("#txtRequests").dxTagBox("instance").option("value",n)}else $("#txtRequests").dxTagBox("instance").option("value",null)}function initializeCheckedChekboxes(){var t,n;if(resetReadCheckboxes(),currentGeniusView.CheckedCheckBoxes!=null&&currentGeniusView.CustomFields.CheckedCheckBoxes!="")for(t=currentGeniusView.CheckedCheckBoxes,n=0;n<t.length;n++)$("#chkCheckbox"+t[n]).dxCheckBox("instance").option("value",!0)}function initializeEmployeeTextFields(){var i=[],r=[],t,n;if(currentGeniusView.Employees!=""){for(t=currentGeniusView.Employees.split("#")[0].split(","),n=0,n=0;n<t.length;n++)t[n].charAt(0)=="A"?r.append(t[n].substring(1,t[n].length)):i.append(t[n].substring(1,t[n].length));i.length>0&&r.length>0?$("#ReportUsers").dxTextBox("instance").option("value",i.length+" "+viewUtilsManager.DXTranslate("roGeniusEmployees")+" "+viewUtilsManager.DXTranslate("roGeniusAnd")+" "+r.length+" "+viewUtilsManager.DXTranslate("roGeniusGroups")):i.length>0?$("#ReportUsers").dxTextBox("instance").option("value",i.length+" "+viewUtilsManager.DXTranslate("roGeniusEmployees")):r.length>0?$("#ReportUsers").dxTextBox("instance").option("value",r.length+" "+viewUtilsManager.DXTranslate("roGeniusGroups")):$("#ReportUsers").dxTextBox("instance").option("value","")}else $("#ReportUsers").dxTextBox("instance").option("value",null)}function onCauesPopUpHidden(){var n,t;updating&&(n=causesSelected2Str(),currentGeniusEditParameters.Causes=n,currentGeniusView.Causes=n,currentGeniusEditParameters.UpdatedCauses=!1,n==""?$("#txtCauses").dxTextBox("instance").option("value",$("#hdnAllCausesText").val()):(t=n.split(",").length,t==1?$("#txtCauses").dxTextBox("instance").option("value",t+" "+$("#hdnCauseSelectedText").val()):$("#txtCauses").dxTextBox("instance").option("value",t+" "+$("#hdnSomeCausesSelectedText").val())))}function initializeReportPopUpFields(){if(initializeEmployeeTextFields(),$("#txtUpdatedName").dxTextBox("instance").option("value",currentGeniusView.Name),$("#selectLanguage").dxSelectBox("instance").option("value",currentGeniusView.CustomFields.LanguageKey),$("#ckIncludeConceptsWithZeros").dxCheckBox("instance").option("value",currentGeniusView.CustomFields.IncludeZeros),$("#ckIncludeCausesWithZeros").dxCheckBox("instance").option("value",currentGeniusView.CustomFields.IncludeZeroCauses),$("#ckIncludeBusinessCenterWithZeros").dxCheckBox("instance").option("value",currentGeniusView.CustomFields.IncludeZeroBusinessCenter),$("#ckUpdatedSendEmail").dxCheckBox("instance").option("value",currentGeniusView.CustomFields.SendEmail),BIIntegration=="True"&&($("#ckUpdatedDownloadBI").dxCheckBox("instance").option("value",currentGeniusView.CustomFields.DownloadBI),currentGeniusView.CustomFields.DownloadBI?($("#ckUpdatedOverwriteResults").dxCheckBox("instance").option("value",currentGeniusView.CustomFields.OverwriteResults),$("#ckUpdatedOverwriteResults").show()):$("#ckUpdatedOverwriteResults").hide()),currentGeniusView.Causes=="")$("#txtCauses").dxTextBox("instance").option("value",$("#hdnAllCausesText").val());else{var n=currentGeniusView.Causes.split(",").length;n==1?$("#txtCauses").dxTextBox("instance").option("value",n+" "+$("#hdnCauseSelectedText").val()):$("#txtCauses").dxTextBox("instance").option("value",n+" "+$("#hdnSomeCausesSelectedText").val())}currentGeniusView.DSFunction.includes("@causesFilter")?$(".causesInfo").show():$(".causesInfo").hide();currentGeniusView.DSFunction.includes("Genius_Concepts(")||currentGeniusView.DSFunction.includes("Genius_ConceptsAndPunches")?$(".zeroAvailable").show():$(".zeroAvailable").hide();currentGeniusView.DSFunction.includes("Genius_CostCenters_Detail(")?$(".zeroCausesAvailable").show():$(".zeroCausesAvailable").hide();initializeUserFieldsTagBox();initializeCostCentersTagBox();initializeConceptssTagBox();initializeRequestsTagBox();initializeCheckedChekboxes()}function showCausesPopUp(){$("#CauesPopUp").dxPopup("instance").show()}function showCostsCenterPopUp(){$("#CostsCenterPopUp").dxPopup("instance").show()}function showBalancesPopUp(){$("#ConceptsPopUp").dxPopup("instance").show()}function showRequestsPopUp(){$("#ReuqestsPopUp").dxPopup("instance").show()}function userFieldsSelected(n){if(n.addedItems.length>0||n.removedItems.length>0){if($("#hdnUserFieldsSelected").val(n.addedItems),currentGeniusView!=null&&currentGeniusView.UserFields!=null&&currentGeniusView.UserFields.length>0){var t=currentGeniusView.UserFields.split(",");n.component.option("items").map(n=>{n.disabled=t.includes(n.Name)})}else n.component.option("items").map(n=>{n.disabled=!1});n.component.repaint()}}function userFieldValueChanged(n){if(n.value!=null&&n.value.length>10){const t=n.previousValue;n.component.option("value",t);DevExpress.ui.notify(viewUtilsManager.DXTranslate("roMaxUserFieldsSelected"),"error",2e3)}}function userFieldContentReady(n){if(!userFieldsLoaded&&n.component.option("items")!=null&&n.component.option("items").length>0){var t=currentGeniusView.UserFields.split(",");n.component.option("items").map(n=>{n.disabled=t.includes(n.Name)});userFieldsLoaded=!0}}function userFieldsInitialized(n){n.component.registerKeyHandler("backspace",function(){return!0})}function userFieldsKeyDown(n){n.evet.keycode==8&&(n.event.stopPropagation(),n.event.preventDefault())}function userFieldListOpened(n){userFieldsOpened||(userFieldsOpened=!0,n.component.repaint())}function costCentersSelected(n){n.addedItems.length>0&&$("#hdnCostCentersSelected").val(n.addedItems)}function conceptsSelected(n){n.addedItems.length>0&&$("#hdnConceptsSelected").val(n.addedItems)}function requestsSelected(n){n.addedItems.length>0&&$("#hdnRequestsSelected").val(n.addedItems)}function onChkAnalyticTypeChange(n){disableCheckBoxes(n);$(".conceptsInfoNew").hide();$(".causesInfoNew").hide();switch(n.element[0].id){case"chkAnalyticType1":n.value==!0?($("#btnCausesInfo").dxButton("instance").option("disabled",!1),typeof lstCauses!="undefined"&&($("#ckIncludeAllCauses").dxRadioGroup("instance").option("value","0"),lstCauses.UnselectAll(),lstCauses.SetEnabled(!1))):$("#btnCausesInfo").dxButton("instance").option("disabled",!0);break;case"chkAnalyticType4":n.value==!0?$("#btnCostCenterInfo").dxButton("instance").option("disabled",!1):$("#btnCostCenterInfo").dxButton("instance").option("disabled",!0);break;case"chkAnalyticType6":n.value==!0?$("#btnBalancesInfo").dxButton("instance").option("disabled",!1):$("#btnBalancesInfo").dxButton("instance").option("disabled",!0);break;case"chkAnalyticType5":n.value==!0?$("#btnRequestsInfo").dxButton("instance").option("disabled",!1):$("#btnRequestsInfo").dxButton("instance").option("disabled",!0)}var t=getCheckedCheckboxes();typeof t!=undefined&&(t.length==1&&t[0]==6||t.length==2&&t.includes("6")&&t.includes("2"))?$(".conceptsInfoNew").show():$(".conceptsInfoNew").hide();typeof t!=undefined&&t.length==2&&t.includes("1")&&t.includes("4")?$(".causesInfoNew").show():$(".causesInfoNew").hide()}function getCheckedClasses(){for(var t,u,r=$(".checkBoxAnalyticType").dxCheckBox(),n=[],i=0;i<r.length;i++)t=r[i].id,$("#"+t).dxCheckBox("instance").option("value")&&(n.length==0?n=$("#"+t).dxCheckBox("instance").element().attr("class").replace("dx-widget dx-checkbox dx-checkbox-has-text ","").replace("checkBoxAnalyticType","").split(" "):(u=$("#"+t).dxCheckBox("instance").element().attr("class").replace("dx-widget dx-checkbox dx-checkbox-has-text ","").replace("checkBoxAnalyticType","").split(" "),n=n.filter(n=>n!=""&&u.includes(n))));return n}function getCheckedCheckboxes(){for(var t,i=$(".checkBoxAnalyticType").dxCheckBox(),r=[],n=0;n<i.length;n++)t=i[n].id,$("#"+t).dxCheckBox("instance").option("value")&&r.append(t.replace("chkAnalyticType",""));return r}function resetCheckboxes(){for(var i,t=$(".checkBoxAnalyticType").dxCheckBox(),n=0;n<t.length;n++)i=t[n].id,$("#"+i).dxCheckBox("instance").option("value",!1)}function resetReadCheckboxes(){for(var i,t=$(".checkBoxAnalyticTypeRead").dxCheckBox(),n=0;n<t.length;n++)i=t[n].id,$("#"+i).dxCheckBox("instance").option("value",!1)}function disableCheckBoxes(){var r=getCheckedClasses(),i=$(".checkBoxAnalyticType").dxCheckBox(),u,n,t;if(r.length>0)for(n=0;n<i.length;n++){t=i[n].id;u=$("#"+t).dxCheckBox("instance").element().attr("class").replace("dx-widget dx-checkbox dx-checkbox-has-text ","").replace("checkBoxAnalyticType","").split(" ");const f=r.filter(n=>n!=""&&u.includes(n));f.length>0?$("#"+t).dxCheckBox("instance").option("disabled",!1):$("#"+t).dxCheckBox("instance").option("disabled",!0)}else for(n=0;n<i.length;n++)t=i[n].id,$("#"+t).dxCheckBox("instance").option("disabled",!1)}function closeUpdatePopUp(){$("#reportConfigurationPopup").dxPopup("instance").hide()}function isCostCenterDefaultView(n){return n.DS==5}function isCostCenterAndIncidencesDefaultView(n){return n.DSFunction.indexOf("Genius_CostCenters_Detail")>=0}function isCostCenterCustomView(n){return n.CheckedCheckBoxes!=null&&n.CheckedCheckBoxes.includes("4")}function isBalancesDefaultView(n){return n.DS==2}function isBalancesCustomView(n){return n.CheckedCheckBoxes!=null&&n.CheckedCheckBoxes.includes("6")}function isCausesDefaultView(n){return n.DSFunction.toString().toLowerCase().indexOf("incidences")>=0||n.DSFunction.toString().indexOf("Genius_CostCenters_Detail")>=0}function isRequestsDefaultView(n){return n.DS==9}function isRequestsCustomView(n){return n.CheckedCheckBoxes!=null&&n.CheckedCheckBoxes.includes("5")}function isJustificationsByTimeDefaultView(n){return n.DSFunction.indexOf("Genius_IncidencesByTime")>=0}function RefreshPlanningList(){$("#PlanningList").dxDataGrid("instance").refresh()}function GetCurrentGeniusView(){return currentGeniusView!=null&&currentGeniusView.Id!=null?currentGeniusView.Id:null}function onBeforeSendPlanning(n,t){if(n=="update"||n=="insert"){var i=calculatePeriodInfo(t.data.Name);t.data.schedulerText=i.scheduledSentence;t.data.scheduledParam=i.scheduledParam;t.data.scheduledFrequency=i.shceduledFrequency;t.data.periodType=$("#radioGeniusSchedulerConfig").dxRadioGroup("instance").option("value");t.data.beginPeriod=date2DateTime(new Date($("#selectedFromDate").dxDateBox("instance").option("value")));t.data.endPeriod=date2DateTime(new Date($("#selectedToDate").dxDateBox("instance").option("value")));(t.data.ID==null||t.data.ID==undefined)&&(t.data.ID=-1)}n=="insert"&&(t.data.idGeniusView=currentGeniusView.Id)}function OnPlanningListLoading(n){(currentGeniusView==null||currentGeniusView.Id==null)&&(n.cancel=!0)}function onConfigChanged(n){var t,i;const r=new Date;switch(n.value){case 1:const n=new Date(r);n.setDate(n.getDate()+1);t=new Date(n);t.setHours(0);t.setMinutes(0);i=new Date(n);i.setHours(23);i.setMinutes(59);$("#selectedFromDate").dxDateBox("instance").option("value",t);$("#selectedToDate").dxDateBox("instance").option("value",i);break;case 2:t=new Date(r);t.setHours(0);t.setMinutes(0);i=new Date(r);i.setHours(23);i.setMinutes(59);$("#selectedFromDate").dxDateBox("instance").option("value",t);$("#selectedToDate").dxDateBox("instance").option("value",i);break;case 3:const u=new Date(r);u.setDate(u.getDate()-1);t=new Date(u);t.setHours(0);t.setMinutes(0);i=new Date(u);i.setHours(23);i.setMinutes(59);$("#selectedFromDate").dxDateBox("instance").option("value",t);$("#selectedToDate").dxDateBox("instance").option("value",i);break;case 4:t=new Date(r.setDate(r.getDate()-r.getDay()+1));i=new Date(r.setDate(r.getDate()-r.getDay()+7));t.setHours(0);t.setMinutes(0);i.setHours(23);i.setMinutes(59);$("#selectedFromDate").dxDateBox("instance").option("value",t);$("#selectedToDate").dxDateBox("instance").option("value",i);break;case 5:t=new Date(r.setDate(r.getDate()-r.getDay()+1));i=new Date(r.setDate(r.getDate()-r.getDay()+7));t.setDate(t.getDate()-7);t.setHours(0);t.setMinutes(0);i.setDate(i.getDate()-7);i.setHours(23);i.setMinutes(59);$("#selectedFromDate").dxDateBox("instance").option("value",t);$("#selectedToDate").dxDateBox("instance").option("value",i);break;case 6:t=new Date(r.getFullYear(),r.getMonth(),1);i=new Date(r.getFullYear(),r.getMonth()+1,0);t.setHours(0);t.setMinutes(0);i.setHours(23);i.setMinutes(59);$("#selectedFromDate").dxDateBox("instance").option("value",t);$("#selectedToDate").dxDateBox("instance").option("value",i);break;case 7:t=new Date(r.getFullYear(),r.getMonth()-1,1);i=new Date(r.getFullYear(),r.getMonth(),0);t.setHours(0);t.setMinutes(0);i.setHours(23);i.setMinutes(59);$("#selectedFromDate").dxDateBox("instance").option("value",t);$("#selectedToDate").dxDateBox("instance").option("value",i);break;case 8:t=new Date(r.getFullYear(),0,1);i=new Date(r);t.setHours(0);t.setMinutes(0);i.setHours(23);i.setMinutes(59);$("#selectedFromDate").dxDateBox("instance").option("value",t);$("#selectedToDate").dxDateBox("instance").option("value",i);break;case 9:t=new Date(r.setDate(r.getDate()-r.getDay()+1));i=new Date(r.setDate(r.getDate()-r.getDay()+7));t.setDate(t.getDate()+7);t.setHours(0);t.setMinutes(0);i.setDate(i.getDate()+7);i.setHours(23);i.setMinutes(59);$("#selectedFromDate").dxDateBox("instance").option("value",t);$("#selectedToDate").dxDateBox("instance").option("value",i);break;case 10:t=new Date(r.getFullYear(),r.getMonth()+1,1);i=new Date(r.getFullYear(),r.getMonth()+2,0);t.setHours(0);t.setMinutes(0);i.setHours(23);i.setMinutes(59);$("#selectedFromDate").dxDateBox("instance").option("value",t);$("#selectedToDate").dxDateBox("instance").option("value",i)}}function markRowAsUpdated(){var t,i,n;if(!onInitializing)for(t=$("#PlanningList").dxDataGrid("instance"),i=t.getVisibleRows(),n=0;n<i.length;n++)i[n].isEditing&&(t.cellValue(n,"LastDateTimeUpdated",new Date),t.cellValue(n,"Name",t.cellValue(n,"Name")))}function onSchedulerChanged(n){markRowAsUpdated(n);switch(n.value){case 0:$("#dailySchedule").show();$("#weeklySchedule").hide();$("#monthlySchedule").hide();$("#onceSchedule").hide();$("#intervalSchedule").hide();break;case 1:$("#dailySchedule").hide();$("#weeklySchedule").show();$("#monthlySchedule").hide();$("#onceSchedule").hide();$("#intervalSchedule").hide();break;case 2:$("#dailySchedule").hide();$("#weeklySchedule").hide();$("#monthlySchedule").show();$("#onceSchedule").hide();$("#intervalSchedule").hide();break;case 3:$("#dailySchedule").hide();$("#weeklySchedule").hide();$("#monthlySchedule").hide();$("#onceSchedule").show();$("#intervalSchedule").hide();break;case 4:$("#dailySchedule").hide();$("#weeklySchedule").hide();$("#monthlySchedule").hide();$("#onceSchedule").hide();$("#intervalSchedule").show()}}function onPlanningUpdating(n){(n==null||n.newData==null||n.newData.length==0||n.newData.Name!=null&&n.newData.Name=="")&&(DevExpress.ui.notify(viewUtilsManager.DXTranslate("roSchedulerSaveNameError"),"error",2e3),n.cancel=!0)}function onPlanningInserting(n){(n==null||n.data==null||n.data.length==0||n.data.Name==null||n.data.Name=="")&&(DevExpress.ui.notify(viewUtilsManager.DXTranslate("roSchedulerSaveNameError"),"error",2e3),n.cancel=!0)}function calculatePeriodInfo(n){var i;let t="",r="";switch($("#radioGeniusSchedulerPlan").dxRadioGroup("instance").option("value")){case 0:t=$("#radioGeniusSchedulerPlan").dxRadioGroup("instance").option("value")+"@"+$("#timeOfDay").dxDateBox("instance").option("text")+"@";t+=$("#txtDays").dxNumberBox("instance").option("value");r="Cada "+$("#txtDays").dxNumberBox("instance").option("value")+" días, a las "+$("#timeOfDay").dxDateBox("instance").option("text").padStart(5,"0");break;case 1:t=$("#radioGeniusSchedulerPlan").dxRadioGroup("instance").option("value")+"@"+$("#timeOfDayWeekly").dxDateBox("instance").option("text")+"@";t+=$("#txtWeeks").dxNumberBox("instance").option("value")+"@"+selectedWeekDaysToStr();r="Cada "+$("#txtWeeks").dxNumberBox("instance").option("value")+" semanas, los "+selectedWeekDaysToSentence()+", a las "+$("#timeOfDayWeekly").dxDateBox("instance").option("text").padStart(5,"0");break;case 2:t=$("#radioGeniusSchedulerPlan").dxRadioGroup("instance").option("value")+"@"+$("#timeOfDayMonthly").dxDateBox("instance").option("text")+"@";t+=monthlyType+"@";t+=monthlyType===0?$("#txtDayOfMonth").dxNumberBox("instance").option("value")+"@"+$("#lstDaysOfWeekMonthly").dxSelectBox("instance").option("value"):$("#lstWeeksOfMonth").dxSelectBox("instance").option("value")+"@"+$("#lstDaysOfWeekMonthly").dxSelectBox("instance").option("value");r=monthlyType===0?"El día "+$("#txtDayOfMonth").dxNumberBox("instance").option("text")+" de cada mes, a las "+$("#timeOfDayMonthly").dxDateBox("instance").option("text").padStart(5,"0"):"El "+$("#lstWeeksOfMonth").dxSelectBox("instance").option("text")+" "+$("#lstDaysOfWeekMonthly").dxSelectBox("instance").option("text")+" de cada mes, a las "+$("#timeOfDayMonthly").dxDateBox("instance").option("text").padStart(5,"0");break;case 3:i=new Date($("#selectedDateTime").dxDateBox("instance").option("value"));t=$("#radioGeniusSchedulerPlan").dxRadioGroup("instance").option("value")+"@"+date2Time(i)+"@";t+=date2DateTime(i);r="El "+date2Date(i)+" a las "+date2ShortTime(i);break;case 4:i=new Date($("#timeOfInterval").dxDateBox("instance").option("value"));t=$("#radioGeniusSchedulerPlan").dxRadioGroup("instance").option("value")+"@"+date2ShortTime(i)+"@";r="Cada "+date2ShortTime(i)+" horas"}return{scheduledSentence:r,description:n,scheduledParam:t}}function date2DateTime(n){return n.getFullYear()+"/"+("0"+(n.getMonth()+1)).slice(-2)+"/"+("0"+n.getDate()).slice(-2)+" "+("0"+n.getHours()).slice(-2)+":"+("0"+n.getMinutes()).slice(-2)}function dateTime2Str(n){return("0"+n.getDate()).slice(-2)+"-"+("0"+(n.getMonth()+1)).slice(-2)+"-"+n.getFullYear()+" "+n.getHours()+("0"+n.getHours()).slice(-2)}function date2Date(n){return("0"+n.getDate()).slice(-2)+"-"+("0"+(n.getMonth()+1)).slice(-2)+"-"+n.getFullYear()}function date2Time(n){return("0"+n.getHours()).slice(-2)+":"+("0"+n.getMinutes()).slice(-2)+":"+("0"+n.getSeconds()).slice(-2)}function date2ShortTime(n){return("0"+n.getHours()).slice(-2)+":"+("0"+n.getMinutes()).slice(-2)}function onPlanningInitNewRow(n){n.data.Name=viewUtilsManager.DXTranslate("roGeniusNewPlanification");clearPlanningConfig();clearPlanningScheduler()}function clearPlanningScheduler(){$("#radioGeniusSchedulerPlan").dxRadioGroup("instance").option("value",3);$("#txtDays").dxNumberBox("instance").option("value",1);$("#timeOfDay").dxDateBox("instance").option("value",null);$("#txtWeeks").dxNumberBox("instance").option("value",1);$("#lstDaysOfWeek").dxTagBox("instance").option("value",null);$("#timeOfDayWeekly").dxDateBox("instance").option("value",null);$("#txtDayOfMonth").dxNumberBox("instance").option("value",null);$("#lstWeeksOfMonth").dxSelectBox("instance").option("value",0);$("#lstDaysOfWeekMonthly").dxSelectBox("instance").option("value",null);$("#timeOfDayMonthly").dxDateBox("instance").option("value",null);const t=new Date,n=new Date(t);n.setDate(n.getDate()+1);$("#selectedDateTime").dxDateBox("instance").option("value",n);$("#timeOfInterval").dxDateBox("instance").option("value",0)}function clearPlanningConfig(){var n,t;$("#radioGeniusSchedulerConfig").dxRadioGroup("instance").option("value",2);n=new Date;n.setHours(0);n.setMinutes(0);t=new Date;t.setHours(23);t.setMinutes(59);$("#selectedFromDate").dxDateBox("instance").option("value",n);$("#selectedToDate").dxDateBox("instance").option("value",t)}function onPlanningEditingStart(n){$("#geniusPlannerScheduler").show();$("#geniusConfigScheduler").show();clearPlanningConfig();clearPlanningScheduler();initializePlanningConfig(n);initializePlanningScheduler(n)}function getWeekDays(n){for(var i=[],t=0;t<7;t++)n[t]==1&&i.push(t);return i}function initializePlanningConfig(n){onInitializing=!0;$("#radioGeniusSchedulerConfig").dxRadioGroup("instance").option("value",n.data.PeriodType);n.data.ScheduleBeginDate!=null&&$("#selectedFromDate").dxDateBox("instance").option("value",n.data.ScheduleBeginDate);n.data.ScheduleEndDate!=null&&$("#selectedToDate").dxDateBox("instance").option("value",n.data.ScheduleEndDate);onInitializing=!1}function initializePlanningScheduler(n){onInitializing=!0;$("#radioGeniusSchedulerPlan").dxRadioGroup("instance").option("value",n.data.Scheduler.ScheduleType);var t=new Date(n.data.Scheduler.DateSchedule.replace("00:00:00",n.data.Scheduler.Hour.padStart(5,"0")));switch(n.data.Scheduler.ScheduleType){case 0:$("#txtDays").dxNumberBox("instance").option("value",n.data.Scheduler.Days);$("#timeOfDay").dxDateBox("instance").option("value",date2DateTime(t));break;case 1:$("#txtWeeks").dxNumberBox("instance").option("value",n.data.Scheduler.Weeks);$("#lstDaysOfWeek").dxTagBox("instance").option("value",getWeekDays(n.data.Scheduler.WeekDays));$("#timeOfDayWeekly").dxDateBox("instance").option("value",date2DateTime(t));break;case 2:n.data.Scheduler.MonthlyType==0?($("#txtDayOfMonth").dxNumberBox("instance").option("value",n.data.Scheduler.Day),$("#monthlyOption2").css("color","#D3D3D3"),$("#monthlyOption1").css("color","#212529"),$("#monthlyOption2 input").css("color","#D3D3D3"),$("#monthlyOption1 input").css("color","#212529"),monthlyType=0):($("#lstWeeksOfMonth").dxSelectBox("instance").option("value",n.data.Scheduler.Start),$("#lstDaysOfWeekMonthly").dxSelectBox("instance").option("value",n.data.Scheduler.WeekDay),$("#monthlyOption1").css("color","#D3D3D3"),$("#monthlyOption2").css("color","#212529"),$("#monthlyOption1 input").css("color","#D3D3D3"),$("#monthlyOption2 input").css("color","#212529"),monthlyType=1);$("#timeOfDayMonthly").dxDateBox("instance").option("value",date2DateTime(t));break;case 3:$("#selectedDateTime").dxDateBox("instance").option("value",t);break;case 4:$("#timeOfInterval").dxDateBox("instance").option("value",date2DateTime(t))}onInitializing=!1}function validateSchedulerData(n){switch($("#radioGeniusSchedulerPlan").dxRadioGroup("instance").option("value")){case 0:$("#timeOfDay").dxDateBox("instance").option("value")===null||$("#timeOfDay").dxDateBox("instance").option("value")===undefined||$("#timeOfDay").dxDateBox("instance").option("value")===""||$("#txtDays").dxNumberBox("instance").option("value")===null||$("#txtDays").dxNumberBox("instance").option("value")===undefined||$("#txtDays").dxNumberBox("instance").option("value")===""||$("#selectedFromDate").dxDateBox("instance").option("value")===null||$("#selectedFromDate").dxDateBox("instance").option("value")===undefined||$("#selectedFromDate").dxDateBox("instance").option("value")===""||$("#selectedToDate").dxDateBox("instance").option("value")===null||$("#selectedToDate").dxDateBox("instance").option("value")===undefined||$("#selectedToDate").dxDateBox("instance").option("value")===""?(DevExpress.ui.notify(viewUtilsManager.DXTranslate("roValidationError"),"error",2e3),n.isValid=!1):n.isValid=!0;break;case 1:$("#timeOfDayWeekly").dxDateBox("instance").option("value")===null||$("#timeOfDayWeekly").dxDateBox("instance").option("value")===undefined||$("#timeOfDayWeekly").dxDateBox("instance").option("value")===""||$("#txtWeeks").dxNumberBox("instance").option("value")===null||$("#txtWeeks").dxNumberBox("instance").option("value")===undefined||$("#txtWeeks").dxNumberBox("instance").option("value")===""||$("#lstDaysOfWeek").dxTagBox("instance").option("value")===null||$("#lstDaysOfWeek").dxTagBox("instance").option("value")===undefined||$("#lstDaysOfWeek").dxTagBox("instance").option("value")===""||$("#selectedFromDate").dxDateBox("instance").option("value")===null||$("#selectedFromDate").dxDateBox("instance").option("value")===undefined||$("#selectedFromDate").dxDateBox("instance").option("value")===""||$("#selectedToDate").dxDateBox("instance").option("value")===null||$("#selectedToDate").dxDateBox("instance").option("value")===undefined||$("#selectedToDate").dxDateBox("instance").option("value")===""?(DevExpress.ui.notify(viewUtilsManager.DXTranslate("roValidationError"),"error",2e3),n.isValid=!1):n.isValid=!0;break;case 2:monthlyType===0?$("#txtDayOfMonth").dxNumberBox("instance").option("value")===null||$("#txtDayOfMonth").dxNumberBox("instance").option("value")===undefined||$("#txtDayOfMonth").dxNumberBox("instance").option("value")===""||$("#timeOfDayMonthly").dxDateBox("instance").option("value")===null||$("#timeOfDayMonthly").dxDateBox("instance").option("value")===undefined||$("#timeOfDayMonthly").dxDateBox("instance").option("value")===""||$("#selectedFromDate").dxDateBox("instance").option("value")===null||$("#selectedFromDate").dxDateBox("instance").option("value")===undefined||$("#selectedFromDate").dxDateBox("instance").option("value")===""||$("#selectedToDate").dxDateBox("instance").option("value")===null||$("#selectedToDate").dxDateBox("instance").option("value")===undefined||$("#selectedToDate").dxDateBox("instance").option("value")===""?(DevExpress.ui.notify(viewUtilsManager.DXTranslate("roValidationError"),"error",2e3),n.isValid=!1):n.isValid=!0:$("#lstWeeksOfMonth").dxSelectBox("instance").option("value")===null||$("#lstWeeksOfMonth").dxSelectBox("instance").option("value")===undefined||$("#lstWeeksOfMonth").dxSelectBox("instance").option("value")===""||$("#lstWeeksOfMonth").dxSelectBox("instance").option("value")===null||$("#lstWeeksOfMonth").dxSelectBox("instance").option("value")===undefined||$("#lstWeeksOfMonth").dxSelectBox("instance").option("value")===""||$("#lstDaysOfWeekMonthly").dxSelectBox("instance").option("value")===null||$("#lstDaysOfWeekMonthly").dxSelectBox("instance").option("value")===undefined||$("#lstDaysOfWeekMonthly").dxSelectBox("instance").option("value")===""||$("#timeOfDayMonthly").dxDateBox("instance").option("value")===null||$("#timeOfDayMonthly").dxDateBox("instance").option("value")===undefined||$("#timeOfDayMonthly").dxDateBox("instance").option("value")===""||$("#selectedFromDate").dxDateBox("instance").option("value")===null||$("#selectedFromDate").dxDateBox("instance").option("value")===undefined||$("#selectedFromDate").dxDateBox("instance").option("value")===""||$("#selectedToDate").dxDateBox("instance").option("value")===null||$("#selectedToDate").dxDateBox("instance").option("value")===undefined||$("#selectedToDate").dxDateBox("instance").option("value")===""?(DevExpress.ui.notify(viewUtilsManager.DXTranslate("roValidationError"),"error",2e3),n.isValid=!1):n.isValid=!0;break;case 3:$("#selectedDateTime").dxDateBox("instance").option("value")===null||$("#selectedDateTime").dxDateBox("instance").option("value")===undefined||$("#selectedDateTime").dxDateBox("instance").option("value")===""||$("#selectedFromDate").dxDateBox("instance").option("value")===null||$("#selectedFromDate").dxDateBox("instance").option("value")===undefined||$("#selectedFromDate").dxDateBox("instance").option("value")===""||$("#selectedToDate").dxDateBox("instance").option("value")===null||$("#selectedToDate").dxDateBox("instance").option("value")===undefined||$("#selectedToDate").dxDateBox("instance").option("value")===""?(DevExpress.ui.notify(viewUtilsManager.DXTranslate("roValidationError"),"error",2e3),n.isValid=!1):n.isValid=!0;break;case 4:$("#timeOfInterval").dxDateBox("instance").option("value")===null||$("#timeOfInterval").dxDateBox("instance").option("value")===undefined||$("#timeOfInterval").dxDateBox("instance").option("value")===""||$("#selectedFromDate").dxDateBox("instance").option("value")===null||$("#selectedFromDate").dxDateBox("instance").option("value")===undefined||$("#selectedFromDate").dxDateBox("instance").option("value")===""||$("#selectedToDate").dxDateBox("instance").option("value")===null||$("#selectedToDate").dxDateBox("instance").option("value")===undefined||$("#selectedToDate").dxDateBox("instance").option("value")===""?(DevExpress.ui.notify(viewUtilsManager.DXTranslate("roValidationError"),"error",2e3),n.isValid=!1):n.isValid=!0}}function selectedWeekDaysToStr(){var n="0000000";return $("#lstDaysOfWeek").dxTagBox("instance").option("selectedItems").forEach(t=>n=n.replaceAt(t.Id,"1")),n}function selectedWeekDaysToSentence(){var n="";return $("#lstDaysOfWeek").dxTagBox("instance").option("selectedItems").forEach(t=>{n==""?n=t.Text:n+=", "+t.Text}),n}function formatDate(n){if(n!=null&&n.NextDateTimeExecuted!=null)return dateTime2Str(new Date(n.NextDateTimeExecuted))}function formatNextDate(n){let t="";return n!=null&&n.NextDateTimeExecuted!=null&&(t=new Date(n.NextDateTimeExecuted).toLocaleString()),t}function ckDownloadBI_valueChanged(n){n.value?$("#ckOverwriteResults").show():($("#ckOverwriteResults").hide(),$("#ckOverwriteResults").dxCheckBox("instance").option("value",null))}function initializePopUpComponents(){$("#dtDateInf").dxDateBox();$("#dtDateSup").dxDateBox();$("#rgDateFilterType").dxRadioGroup()}function ckIncludeCausesWithZero_Changed(n){n.value==!0?$("#ckIncludeBusinessCenterWithZerosNew").dxCheckBox("instance").option("value",!1):$("#ckIncludeBusinessCenterWithZerosNew").dxCheckBox("instance").option("value",!0)}var currentGeniusView={},currentGeniusEditParameters={},currentExecution=null,existingView=!1,updating=!1,monthlyType=-1,onInitializing=!1,userFieldsLoaded=!1,userFieldsOpened=!1;(function(){function l(n){n.preventDefault();const t=$(n.currentTarget).find(".cardsTree-CardInfo").attr("data-card-id");viewUtilsManager.makeServiceCall("Genius","GetGeniusViewSharedList","POST",{id:t},null,function(i){if(i!=null){const r=i.length;if($('.sharedInfo[data-id="'+t+'"]').length==0){const u=r>0?"<h5><span class='btnShare'><\/span>"+viewUtilsManager.DXTranslate("sharedInfoGeniusTitle")+"<\/h5>":"<p>"+viewUtilsManager.DXTranslate("sharedInfoGeniusNotYet")+"<\/p>",f=i.map(n=>"<p>"+n+"<\/p>"),e=$('<div class="sharedInfo" data-id="'+t+'">'+u+"<\/div>").css({left:n.pageX+"px",top:n.pageY+"px"}).append($(f.join(""))).appendTo(document.body);setTimeout(function(){e.remove()},2500+r*500)}}else DevExpress.ui.notify(viewUtilsManager.DXTranslate("roPermissionsError"),"error",2e3)},null,null)}function rt(n){var t=n.detail;viewUtilsManager.print(t.currentState+" state");switch(t.currentState){}}function ht(n){var t={valid:!0,msg:""};return isCostCenterCustomView(n)&&(n.BusinessCenters==null||n.BusinessCenters=="")&&(t={valid:!1,msg:viewUtilsManager.DXTranslate("roLayoutSaveCostCenterError")}),isBalancesCustomView(n)&&(n.Concepts==null||n.Concepts=="")&&(t={valid:!1,msg:viewUtilsManager.DXTranslate("roLayoutSaveConceptsError")}),isRequestsCustomView(n)&&(n.CustomFields==null||n.CustomFields.RequestTypes==null||n.CustomFields.RequestTypes=="")&&(t={valid:!1,msg:viewUtilsManager.DXTranslate("roLayoutSaveRequestsError")}),(n.Employees==null||n.Employees=="")&&(t={valid:!1,msg:viewUtilsManager.DXTranslate("MSG_VALIDATION_EMPLOYEE")}),(n.Name==null||n.Name=="")&&(t={valid:!1,msg:viewUtilsManager.DXTranslate("roLayoutSaveNameError")}),(n.CheckedCheckBoxes==null||n.CheckedCheckBoxes=="")&&(t={valid:!1,msg:viewUtilsManager.DXTranslate("roLayoutSaveCheckboxError")}),n.DateInf!=null&&n.DateInf!=""&&n.DateSup!=null&&n.DateSup!=""||updating||(t={valid:!1,msg:viewUtilsManager.DXTranslate("geniusWarning")}),t}function u(n){var t={valid:!0,msg:""};return isCostCenterDefaultView(n)&&(n.BusinessCenters==null||n.BusinessCenters=="")&&(t={valid:!1,msg:viewUtilsManager.DXTranslate("roLayoutSaveCostCenterError")}),isBalancesDefaultView(n)&&(n.Concepts==null||n.Concepts=="")&&(t={valid:!1,msg:viewUtilsManager.DXTranslate("roLayoutSaveConceptsError")}),isRequestsDefaultView(n)&&(n.CustomFields==null||n.CustomFields.RequestTypes==null||n.CustomFields.RequestTypes=="")&&(t={valid:!1,msg:viewUtilsManager.DXTranslate("roLayoutSaveRequestsError")}),(n.Employees==null||n.Employees=="")&&(t={valid:!1,msg:viewUtilsManager.DXTranslate("MSG_VALIDATION_EMPLOYEE")}),(n.Name==null||n.Name=="")&&(t={valid:!1,msg:viewUtilsManager.DXTranslate("roLayoutSaveNameError")}),n.DateInf!=null&&n.DateInf!=""&&n.DateSup!=null&&n.DateSup!=""||updating||(t={valid:!1,msg:viewUtilsManager.DXTranslate("geniusWarning")}),t}function y(){$("#txtName").dxTextBox("instance").option("value",null);resetCheckboxes();$("#ReportUsersNew").dxTextBox("instance").option("value",null);$("#ReportUsersNew").dxTextBox("instance").option("value",null);$("#UserFieldsText").dxTagBox("instance").option("value",null);$("#dtDateInfNew").dxDateBox("instance").option("value",null);$("#dtDateInfNew").dxDateBox("instance").repaint();$("#dtDateSupNew").dxDateBox("instance").option("value",null);$("#dtDateSupNew").dxDateBox("instance").repaint();typeof lstCostCenters!="undefined"&&lstCostCenters.UnselectAll();typeof lstConcepts!="undefined"&&lstConcepts.UnselectAll();typeof lstCauses!="undefined"&&($("#ckIncludeAllCauses").dxRadioGroup("instance").option("value","0"),lstCauses.UnselectAll());typeof lstRequests!="undefined"&&lstRequests.UnselectAll();$("#ckIncludeConceptsWithZerosNew").dxCheckBox("instance").option("value",!1);$("#ckIncludeCausesWithZerosNew").dxCheckBox("instance").option("value",!1);$("#ckIncludeBusinessCenterWithZerosNew").dxCheckBox("instance").option("value",!0);$("#ckSendEmail").dxCheckBox("instance").option("value",!1);BIIntegration=="True"&&($("#ckDownloadBI").dxCheckBox("instance").option("value",!1),$("#ckOverwriteResults").dxCheckBox("instance").option("value",!1))}function lt(){$("#dtDateInf").dxDateBox("instance").option("value",null);$("#dtDateInf").dxDateBox("instance").repaint();$("#dtDateSup").dxDateBox("instance").option("value",null);$("#dtDateSup").dxDateBox("instance").repaint();$("#txtInitialTime").dxDateBox("instance").option("value",null);$("#txtInitialTime").dxDateBox("instance").repaint();$("#txtEndTime").dxDateBox("instance").option("value",null);$("#txtEndTime").dxDateBox("instance").repaint()}function p(){$("#ReportUsers").dxTextBox("instance").option("value",null);$("#UserFieldsUpdateText").dxTagBox("instance").option("value",null);$("#txtRequests").dxTagBox("instance").option("value",null);$("#txtConcepts").dxTagBox("instance").option("value",null);$("#txtCostCenters").dxTagBox("instance").option("value",null)}function w(n){viewUtilsManager.makeServiceCall("Genius","GetAzureFileInfo","POST",{id:n.Id},null,n=>{n&&typeof n.FileSize!="undefined"?n.FileSize<=520192e3?k(n):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roLargeFileError"),"error",2e3):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roDownloadFileError"),"error",2e3)},n=>console.error(n),null)}function vt(n){var i=n>=0?1:-1,t;n=n*i;var r=Math.floor(n),u=n-r,f=1/60;return u=f*Math.round(u/f),t=Math.floor(u*60)+"",t.length<2&&(t="0"+t),t=="60"&&(t="00",r=r+1),i=i==1?"":"-",time=i+r+":"+t}function yt(n,t){var i,r,e,o,u,f,s;if(!isNaN(t.value)&&typeof currentGeniusView.ContextMenu!=null&&currentGeniusView.ContextMenu!="")for(i=JSON.parse(currentGeniusView.ContextMenu),r=0;r<i.length;r++){if(e=!0,o="",typeof i[r].parameters!=undefined&&i[r].parameters!="")for(u=0;u<i[r].parameters.length;u++)if(f=t.rows.filter(n=>n.dimensionName.toString()==i[r].parameters[u].toString()),s=t.columns.filter(n=>n.dimensionName.toString()==i[r].parameters[u].toString()),f.length==0&&s.length==0){e=!1;break}else o+=f.length>0?" "+f[0].caption:" "+s[0].caption;e&&n.push({id:r,parameters:o,label:viewUtilsManager.DXTranslate(i[r].text),handler:function(){alert("Action = "+i[this.id].action+" - "+i[this.id].link+" - "+this.parameters)}})}return n}function pt(n,t){if(t.measure!=null&&t.measure.uniqueName.indexOf("_ToHours")>0||t.measure!=null&&t.measure.caption.indexOf("_ToHours")>0||t.measure!=null&&t.measure.caption.indexOf("(HH:MM)")>0){var i=n.text.replace(/\s/g,"").replace(",",".");isNaN(i)||i!=""&&(n.text=vt(i))}else n.text=="Infinity"?n.text="":t.member!=null&&t.member.hierarchyCaption!=null&&(t.member.hierarchyCaption=="Dia semana"||t.member.hierarchyCaption=="Dia setmana"||t.member.hierarchyCaption=="Asteko eguna"||t.member.hierarchyCaption=="Day week"||t.member.hierarchyCaption=="Jour semaine"||t.member.hierarchyCaption=="Giorno settimana"||t.member.hierarchyCaption=="Dia da semana")&&(n.text=n.text.split("- ")[1])}function wt(n){var t=n.getTabs(),i;n.getTabs=function(){return t.shift(),t.shift(),t.shift(),t.splice(0,0,{id:"saveLayout",title:viewUtilsManager.DXTranslate("roScheduleYes"),handler:v,icon:this.icons.save}),t.splice(0,0,{divider:"true"}),t.splice(0,0,{id:"backToLauncher",title:"Volver",handler:b,icon:i}),t[3].menu=t[3].menu.slice(2,4).concat(t[3].menu.slice(5,6)),t};i="<svg xmlns='http://www.w3.org/2000/svg'  viewBox='0 0 24 24' width='42px' height='42px'><path d='M10.121,14.121c0.586-0.586,6.414-6.414,7-7c1.172-1.172,1.172-3.071,0-4.243\tc-1.172-1.172-3.071-1.172-4.243,0c-0.586,0.586-6.414,6.414-7,7c-1.172,1.172-1.172,3.071,0,4.243\tC7.05,15.293,8.95,15.293,10.121,14.121z' opacity='.35'/><path d='M5.879,14.121c0.586,0.586,6.414,6.414,7,7c1.172,1.172,3.071,1.172,4.243,0c1.172-1.172,1.172-3.071,0-4.243\tc-0.586-0.586-6.414-6.414-7-7c-1.172-1.172-3.071-1.172-4.243,0C4.707,11.05,4.707,12.95,5.879,14.121z'/><\/svg>"}function dt(){const n=document.body,t={childList:!0,subtree:!0};return new Promise(i=>{const r=new MutationObserver(()=>{n.contains(document.querySelector(".dxcvCardToUpdate"))||(r.disconnect(),i())});r.observe(n,t)})}async function f(n,t){if(n==="save"){$(".dxcvCard").addClass("dxcvCardToUpdate");refreshCardTree(t);await dt();$(".dxcvCard").off("contextmenu");$(".dxcvCard").on("contextmenu",n=>{l(n)})}else r=!1}function i(){var n={...currentGeniusView},t,i,r,u,f,e;if(n.Id==null){let t=parseInt(viewUtilsManager.getSelectedCardId(),10);n.Id=t}return viewUtilsManager.getHtmlControl("rgDateFilterType")!=null&&(n.DateInf=viewUtilsManager.getHtmlControl("dtDateInf").option("value"),n.DateSup=viewUtilsManager.getHtmlControl("dtDateSup").option("value"),n.DateInf!=null&&(n.DateInf=typeof n.DateInf=="string"?new Date(n.DateInf).toISOString():n.DateInf.toISOString()),n.DateSup!=null&&(n.DateSup=typeof n.DateSup=="string"?new Date(n.DateSup).toISOString():n.DateSup.toISOString())),$("#txtInitialTime").dxDateBox("instance")!=null&&(t=$("#txtInitialTime").dxDateBox("instance").option("value"),n.TimeInf=t!=null?t.toISOString():null),$("#txtEndTime").dxDateBox("instance")!=null&&(i=$("#txtEndTime").dxDateBox("instance").option("value"),n.TimeSup=i!=null?i.toISOString():null),r=costCentersSelected2StrTagBox(),r!=""&&(n.BusinessCenters=r),u=conceptsSelected2StrTagBox(),u!=""&&(n.Concepts=u),f=causesSelected2Str(),f!=""&&(n.Causes=f),n.CheckedCheckBoxes==null&&(n.CheckedCheckBoxes=""),e=requestsSelected2StrTagBox(),n.CustomFields.RequestTypes=e,n.Executions=[],n}function ti(){var n={},s,r,i,t,u,f,e,o;for(n.Employees=$("#ReportUsersNew").dxTextBox("instance").option("value")!=null&&$("#ReportUsersNew").dxTextBox("instance").option("value")!=""?currentGeniusView.Employees:"",n.DateInf=viewUtilsManager.getHtmlControl("dtDateInfNew").option("value"),n.DateSup=viewUtilsManager.getHtmlControl("dtDateSupNew").option("value"),n.DateInf!=null&&(n.DateInf=typeof n.DateInf=="string"?new Date(n.DateInf).toISOString():n.DateInf.toISOString()),n.DateSup!=null&&(n.DateSup=typeof n.DateSup=="string"?new Date(n.DateSup).toISOString():n.DateSup.toISOString()),n.Executions=[],n.Name=$("#txtName").dxTextBox("instance").option("value"),s=getCheckedCheckboxes(),n.CheckedCheckBoxes=s,r=$("#UserFieldsText").dxTagBox("instance").option("selectedItems"),i="",t=0;t<r.length;t++)t==0?i=r[t].Name:i+=","+r[t].Name;return i!=""&&(n.UserFields=i),u=costCentersSelected2Str(),u!=""&&(n.BusinessCenters=u),f=conceptsSelected2Str(),f!=""&&(n.Concepts=f),e=causesSelected2Str(),e!=""&&(n.Causes=e),n.CustomFields={},n.CustomFields.IncludeZeros=$("#ckIncludeConceptsWithZerosNew").dxCheckBox("instance").option("value"),n.CustomFields.IncludeZeroCauses=$("#ckIncludeCausesWithZerosNew").dxCheckBox("instance").option("value"),n.CustomFields.IncludeZeroBusinessCenter=$("#ckIncludeBusinessCenterWithZerosNew").dxCheckBox("instance").option("value"),n.CustomFields.SendEmail=$("#ckSendEmail").dxCheckBox("instance").option("value"),BIIntegration=="True"&&(n.CustomFields.DownloadBI=$("#ckDownloadBI").dxCheckBox("instance").option("value"),n.CustomFields.OverwriteResults=$("#ckOverwriteResults").dxCheckBox("instance").option("value")),o=requestsSelected2Str(),o!=""&&(n.CustomFields.RequestTypes=o),n}function ii(){var n={...currentGeniusView},i,r,t,u,f,e,o;if(n.Id==null){let t=parseInt(viewUtilsManager.getSelectedCardId(),10);n.Id=t}for(n.Employees=currentGeniusView.Employees,n.Name=$("#txtUpdatedName").dxTextBox("instance").option("value"),n.CustomFields.IncludeZeros=$("#ckIncludeConceptsWithZeros").dxCheckBox("instance").option("value"),n.CustomFields.IncludeZeroCauses=$("#ckIncludeCausesWithZeros").dxCheckBox("instance").option("value"),n.CustomFields.IncludeZeroBusinessCenter=$("#ckIncludeBusinessCenterWithZeros").dxCheckBox("instance").option("value"),n.CustomFields.LanguageKey=$("#selectLanguage").dxSelectBox("instance").option("value"),i=$("#UserFieldsUpdateText").dxTagBox("instance").option("selectedItems"),r="",t=0;t<i.length;t++)t==0?r=i[t].Name:r+=","+i[t].Name;return n.UserFields=r,u=costCentersSelected2StrTagBox(),n.BusinessCenters=u,f=conceptsSelected2StrTagBox(),n.Concepts=f,currentGeniusEditParameters.UpdatedCauses?(e=causesSelected2Str(),n.Causes=e):n.Causes=currentGeniusEditParameters.Causes,o=requestsSelected2StrTagBox(),n.CustomFields.RequestTypes=o,n.CustomFields.SendEmail=$("#ckUpdatedSendEmail").dxCheckBox("instance").option("value"),BIIntegration=="True"&&(n.CustomFields.DownloadBI=$("#ckUpdatedDownloadBI").dxCheckBox("instance").option("value"),n.CustomFields.OverwriteResults=$("#ckUpdatedOverwriteResults").dxCheckBox("instance").option("value")),n}function ri(){return!0}function o(){var n,t,f;currentGeniusView!=null?(n=i(),t=!1,currentGeniusView.DSFunction!=""?(currentGeniusView.DSFunction.indexOf("employeeFilter")>0&&currentGeniusView.Employees==""&&(t=!0),currentGeniusView.DSFunction.indexOf("conceptsFilter")>0&&currentGeniusView.Concepts==""&&(t=!0),currentGeniusView.DSFunction.indexOf("businessCenterFilter")>0&&currentGeniusView.BusinessCenters==""&&(t=!0)):(currentGeniusView.DS!="B"?currentGeniusView.Employees==""&&(t=!0):currentGeniusView.Employees==""&&currentGeniusView.TypeView!=1&&(t=!0),currentGeniusView.DS=="S"&&currentGeniusView.TypeView==1&&currentGeniusView.Concepts==""&&(t=!0),currentGeniusView.DS=="B"&&currentGeniusView.BusinessCenters==""&&(t=!0)),t?(r=!1,f=u(n),DevExpress.ui.notify(f.msg,"error",2e3)):n.DateInf==null||n.DateSup==null||isJustificationsByTimeDefaultView(n)&&(n.TimeInf==null||n.TimeSup==null)?n.DateInf==null||n.DateSup==null?this.parent.Robotics.Client.JSErrors.showJSerrorPopup(this.parent.Robotics.Client.JSErrors.JSErrorTypes.roJsInfo,"",{text:"",key:"roJsError"},{text:"",key:"geniusWarning"},{text:"",textkey:"roErrorClose",desc:"",desckey:"",script:""},this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton()):this.parent.Robotics.Client.JSErrors.showJSerrorPopup(this.parent.Robotics.Client.JSErrors.JSErrorTypes.roJsInfo,"",{text:"",key:"roJsError"},{text:"",key:"geniusTimeWarning"},{text:"",textkey:"roErrorClose",desc:"",desckey:"",script:""},this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton()):viewUtilsManager.makeServiceCall("Genius","runGeniusView","POST",{geniusView:n},null,n=>{n!=null?h(n):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roPermissionsError"),"error",2e3)},n=>console.error(n),null)):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roNoGeniusViewSelected"),"error",2e3);$("#reportConfigurationPopup").dxPopup("instance").hide();lt()}function ui(){$(".generalDiv").hide();$("#planificationDiv").show();$("#geniusGeneral").removeClass("bTabGeniusMenu-active");$("#geniusPlanification").addClass("bTabGeniusMenu-active");$("#PlanningList").dxDataGrid("instance").addRow();$("#geniusPlannerScheduler").show();$("#geniusConfigScheduler").show()}function fi(n){if(currentGeniusView!=null){n.DateInf=viewUtilsManager.getHtmlControl("dtDateInfNew").option("value");n.DateSup=viewUtilsManager.getHtmlControl("dtDateSupNew").option("value");n.DateInf!=null&&(n.DateInf=typeof n.DateInf=="string"?new Date(n.DateInf).toISOString():n.DateInf.toISOString());n.DateSup!=null&&(n.DateSup=typeof n.DateSup=="string"?new Date(n.DateSup).toISOString():n.DateSup.toISOString());var t=!1;currentGeniusView.DSFunction!=""?(currentGeniusView.DSFunction.indexOf("employeeFilter")>0&&currentGeniusView.Employees==""&&(t=!0),currentGeniusView.DSFunction.indexOf("conceptsFilter")>0&&currentGeniusView.Concepts==""&&(t=!0),currentGeniusView.DSFunction.indexOf("businessCenterFilter")>0&&currentGeniusView.BusinessCenters==""&&(t=!0)):(currentGeniusView.DS!="B"?currentGeniusView.Employees==""&&(t=!0):currentGeniusView.Employees==""&&currentGeniusView.TypeView!=1&&(t=!0),currentGeniusView.DS=="S"&&currentGeniusView.TypeView==1&&currentGeniusView.Concepts==""&&(t=!0),currentGeniusView.DS=="B"&&currentGeniusView.BusinessCenters==""&&(t=!0));t?r=!0:n.DateInf!=null&&n.DateSup!=null?viewUtilsManager.makeServiceCall("Genius","runGeniusView","POST",{geniusView:n},null,n=>{n!=null?h(n):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roPermissionsError"),"error",2e3)},n=>console.error(n),null):this.parent.Robotics.Client.JSErrors.showJSerrorPopup(this.parent.Robotics.Client.JSErrors.JSErrorTypes.roJsInfo,"",{text:"",key:"roJsError"},{text:"",key:"geniusWarning"},{text:"",textkey:"roErrorClose",desc:"",desckey:"",script:""},this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton())}else DevExpress.ui.notify(viewUtilsManager.DXTranslate("roNoGeniusViewSelected"),"error",2e3);$("#reportConfigurationPopup").dxPopup("instance").hide();y()}function ei(){var n=$("#CostsCenterPopUp").dxPopup("instance");n.hide()}function oi(){typeof lstCostCenters!="undefined"&&lstCostCenters.UnselectAll();var n=$("#CostsCenterPopUp").dxPopup("instance");n.hide()}function si(){var n=$("#ConceptsPopUp").dxPopup("instance");n.hide()}function hi(){lstConcepts.UnselectAll();var n=$("#ConceptsPopUp").dxPopup("instance");n.hide()}function ci(){var n=$("#CauesPopUp").dxPopup("instance");n.hide()}function li(){lstCauses.UnselectAll();var n=$("#CauesPopUp").dxPopup("instance");n.hide()}function ai(n){n.value==0?(lstCauses.UnselectAll(),lstCauses.SetEnabled(!1)):lstCauses.SetEnabled(!0)}function vi(){var n=$("#ReuqestsPopUp").dxPopup("instance");n.hide()}function yi(){lstRequests.UnselectAll();var n=$("#ReuqestsPopUp").dxPopup("instance");n.hide()}var s=null,n=null,it,c=null,r=!1,t="dd/M/yyyy",tt;$(document).ready(async function(){isGeniusAdvanced=="False"?$(".btnShare").parent().hide():$(".btnShare").parent().show();viewUtilsManager.initAccordions();viewUtilsManager.setupCardListFilterButton("Genius");viewUtilsManager.print("Genius Module loaded");s=viewUtilsManager.createViewStateHandler();window.loadRequest=g;window.openReportConfigurationPopUp=gt;window.saveData=ni;window.deleteCurrentGenius=tt;window.deleteConfirmed=nt;window.runGeniusView=o;window.saveGeniusView=ot;window.createGeniusView=at;window.updateGeniusView=st;window.editCurrentGenius=kt;window.switchToExecution=k;window.backToLauncher=b;window.saveGeniusLayout=v;window.loadGeniusByTask=e;window.waitForExecutionToFinish=d;window.shareCurrentGenius=ut;window.convert2SystemCurrentGenius=et;window.addPlanificationCurrentGenius=ui;window.onShareGeniusAccept=ft;window.saveCustomView=ct;window.cancelCostCenterInfo=oi;window.saveCostCenterInfo=ei;window.cancelConceptsInfo=hi;window.saveConceptsInfo=si;window.saveCausesInfo=ci;window.cancelCausesInfo=li;window.ckIncludeAllCauses_OnChange=ai;window.cancelRequestsInfo=yi;window.saveRequestsInfo=vi;window.clearNewForm=y;window.onBeforeSendPlanning=onBeforeSendPlanning;window.onPlanningListLoaded=onPlanningListLoaded;window.ckIncludeCausesWithZero_Changed=ckIncludeCausesWithZero_Changed;document.addEventListener("startStateEvent",n=>rt(n),!1);s.transition(s.value,"read");viewUtilsManager.loadViewOptions("Genius","read",function(){let n=parseInt(SelectedTask,10);n!=-1&&e(n)},()=>{},"LiveGenius");const i=new Proxy(new URLSearchParams(window.location.search),{get:(n,t)=>n.get(t)}),n=i.loadView;n&&e(n);switch(JSON.parse(localStorage.getItem("roLanguage")).key){case"es":case"ca":case"pt":case"gl":case"it":case"fr":case"eu":t="DD/M/yyyy HH:mm";shortFormat="DD/M/yyyy";break;case"en":default:t="M/DD/yyyy HH:mm";shortFormat="M/DD/yyyy"}$("#ReportUsersNew").off("click");$("#ReportUsersNew").on("click",function(){existingView=!1;let n={Employees:[],Groups:[],Filter:"11110",UserFields:"",ComposeMode:"Custom",ComposeFilter:"",Advanced:!1,Operation:"or"};if(currentGeniusView!=null&&currentGeniusView.Employees!=""&&(existingView||$("#ReportUsersNew").dxTextBox("instance").option("value")!=null&&$("#ReportUsersNew").dxTextBox("instance").option("value")!="")){let t=currentGeniusView.Employees.split("#")[0].split(",");for(let i=0;i<t.length;i++)t[i].charAt(0)=="A"?n.ComposeFilter+=n.ComposeFilter==""?`A${t[i].substring(1)}`:`,A${t[i].substring(1)}`:t[i].charAt(0)=="B"&&(n.ComposeFilter+=n.ComposeFilter==""?`B${t[i].substring(1)}`:`,B${t[i].substring(1)}`)}parent.showLoader(!0);$("#divGeniusEmployeeSelector").load("/Employee/EmployeeSelectorPartial?feature=Employees&pageName=genius&config=100&unionType=or&advancedMode=1&advancedFilter=0&allowAll=0&allowNone=0",function(){loadPartialInfo();initUniversalSelector(n,!1,"geniusSelector");parent.showLoader(!1)})});$("#geniusGeneral").off("click");$("#geniusGeneral").on("click",function(){$(".generalDiv").show();$("#planificationDiv").hide();$("#geniusGeneral").addClass("bTabGeniusMenu-active");$("#geniusPlanification").removeClass("bTabGeniusMenu-active")});$("#geniusPlanification").off("click");$("#geniusPlanification").on("click",function(){$(".generalDiv").hide();$("#planificationDiv").show();$("#geniusGeneral").removeClass("bTabGeniusMenu-active");$("#geniusPlanification").addClass("bTabGeniusMenu-active")});$("#monthlyOption1").off("click");$("#monthlyOption1").on("click",function(){monthlyType=0;$("#txtDayOfMonth").dxNumberBox("instance").option("value")==null&&$("#txtDayOfMonth").dxNumberBox("instance").option("value",1);$("#monthlyOption2").css("color","#D3D3D3");$("#monthlyOption1").css("color","#212529");$("#monthlyOption2 input").css("color","#D3D3D3");$("#monthlyOption1 input").css("color","#212529")});$("#monthlyOption2").off("click");$("#monthlyOption2").on("click",function(){monthlyType=1;$("#monthlyOption1").css("color","#D3D3D3");$("#monthlyOption2").css("color","#212529");$("#monthlyOption1 input").css("color","#D3D3D3");$("#monthlyOption2 input").css("color","#212529")});$(".dxcvCard").off("contextmenu");$(".dxcvCard").on("contextmenu",n=>{l(n)})});const a=n=>{var u,i;if(currentGeniusView=n,$("#PlanningList").dxDataGrid("instance").refresh(),$("#geniusPlannerScheduler").hide(),$("#geniusConfigScheduler").hide(),r)r=!1,o();else{n.DateInf=null;n.DateSup=null;n.CreatedOn=moment(n.CreatedOn).toDate();viewUtilsManager.viewBinding(n);viewUtilsManager.clearValidationForm();u=[];const r="Cargando datos...";for(i=0;i<n.Executions.length;i++)n.Executions[i].ExecutionDate=moment(n.Executions[i].ExecutionDate).toDate(),n.CustomFields.DownloadBI?n.Executions[i].FileLink!="Error"&&n.Executions[i].Id!=""&&u.push({Fecha:moment(n.Executions[i].ExecutionDate).format(t),Enlace:n.Executions[i].SASLink||r,ID:n.Executions[i].Id,FileName:n.Executions[i].FileLink}):n.Executions[i].FileLink!="Error"?n.Executions[i].FileLink!=""?u.push({text:moment(n.Executions[i].ExecutionDate).format(t),icon:"chart",data:n.Executions[i]}):u.push({text:moment(n.Executions[i].ExecutionDate).format(t),icon:"refresh",data:n.Executions[i]}):u.push({text:moment(n.Executions[i].ExecutionDate).format(t),icon:"clear",data:n.Executions[i]});BIIntegration=="True"&&currentGeniusView.CustomFields.DownloadBI?($("#geniusExecutionsBI").dxDataGrid({dataSource:u,columns:[{dataField:"Fecha",width:150},"Enlace"],showBorders:!1,rowAlternationEnabled:!0,filterRow:{visible:!0,applyFilter:"auto"},headerFilter:{visible:!0},hoverStateEnabled:!0,selection:{mode:"single"},onRowClick(n){const t=n.data;if(t&&t.Enlace.length>0&&t.Enlace!=r){navigator.clipboard.writeText(t.Enlace);const n=$("#toastBILinkCopied").dxToast({displayTime:1e3}).dxToast("instance");n.option({type:"custom",contentTemplate:function(){return $("<p />").text("Enlace copiado").css("background-color","#0046fe").css("padding","3px 20px").css("border-radius","5px")}});n.show()}},editing:{allowDeleting:!0},onRowRemoving:function(n){bt(n)}}),$("#geniusExecutions").hide(),$("#geniusExecutionsBI").show()):($("#geniusExecutions").dxTileView({dataSource:u,noDataText:viewUtilsManager.DXTranslate("roNotExecuted"),direction:"vertical",height:450,itemTemplate:function(n,t,i){i.parent().addClass("roGeniusTile");i.append("<div class='roTile dx-icon dx-icon-"+n.icon+"'><\/div>","<p class='roTileDesc'>"+n.text+"<\/p>")},onItemClick:function(n){w(n.itemData.data)}}),$("#geniusExecutions").show(),$("#geniusExecutionsBI").hide())}},ut=()=>{currentGeniusView!=null?($("#sharePopup").dxPopup("instance").show(),$("#ShareEmployeeText").dxTagBox("instance").option("value",[])):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roNoGeniusViewSelected"),"error",2e3)},ft=async()=>{let t=i(),n=$("#ShareEmployeeText").dxTagBox("instance").option("value");t!=null&&n!=null?await $.ajax({url:`${BASE_URL}Genius/ShareGeniusView`,data:{idView:t.Id,users:n},type:"POST",dataType:"json",success:t=>{t?($("#sharePopup").dxPopup("instance").hide(),DevExpress.ui.notify(viewUtilsManager.DXTranslate("roShared"),"success",2e3)):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roShareSaveError"),"error",2e3),n=null},error:n=>console.error(n)}):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roNoSelectedUserToShare"),"error",2e3)},et=async()=>{let t=i(),n=0;t!=null&&n!=null?await $.ajax({url:`${BASE_URL}Genius/ConvertGeniusView`,data:{idView:t.Id,idPassport:n},type:"POST",dataType:"json",success:t=>{t?DevExpress.ui.notify(viewUtilsManager.DXTranslate("roConverted"),"success",2e3):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roConvertedError"),"error",2e3),n=null},error:n=>console.error(n)}):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roNoSelectedUserToShare"),"error",2e3)},v=()=>{var i=n.getReport(),t={...i};delete t.dataSource;delete t.version;currentExecution.CubeLayout=JSON.stringify(t);viewUtilsManager.makeServiceCall("Genius","updateGeniusView","PUT",{geniusExecution:currentExecution},null,n=>{n?DevExpress.ui.notify(viewUtilsManager.DXTranslate("roLayoutSaved"),"success",2e3):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roLayoutSaveError"),"error",2e3)},n=>console.error(n),null)},ot=()=>{var n=i(),t=u(n);t.valid?(viewUtilsManager.makeServiceCall("Genius","saveGeniusView","POST",{geniusView:n},null,n=>{currentGeniusView=n,f("save",n.Id),n?DevExpress.ui.notify(viewUtilsManager.DXTranslate("roLayoutSaved"),"success",2e3):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roLayoutSaveError"),"error",2e3),o()},n=>console.error(n),null),$("#reportConfigurationPopup").dxPopup("instance").hide()):DevExpress.ui.notify(t.msg,"error",2e3)},st=()=>{var n=ii(),t=u(n);t.valid?(viewUtilsManager.makeServiceCall("Genius","saveGeniusView","POST",{geniusView:n},null,t=>{currentGeniusView=t,n=t,f("save",t.Id),t?DevExpress.ui.notify(viewUtilsManager.DXTranslate("roLayoutSaved"),"success",2e3):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roLayoutSaveError"),"error",2e3),p(),g()},n=>console.error(n),null),$("#reportConfigurationPopup").dxPopup("instance").hide()):DevExpress.ui.notify(t.msg,"error",2e3)};const ct=()=>{var n=ti(),t=ht(n);t.valid?viewUtilsManager.makeServiceCall("Genius","saveCustomView","POST",{geniusView:n},null,t=>{currentGeniusView=t,n=t,f("save",t.Id),t?DevExpress.ui.notify(viewUtilsManager.DXTranslate("roLayoutSaved"),"success",2e3):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roLayoutSaveError"),"error",2e3),fi(n)},()=>DevExpress.ui.notify(viewUtilsManager.DXTranslate("roInvalidCombination"),"error",2e3),null):DevExpress.ui.notify(t.msg,"error",2e3)};const at=()=>{var n=i(),t=u(n);t.valid?(viewUtilsManager.makeServiceCall("Genius","createGeniusView","POST",{geniusView:n},null,n=>{currentGeniusView=n,f("save",n.Id),n?DevExpress.ui.notify(viewUtilsManager.DXTranslate("roLayoutSaved"),"success",2e3):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roLayoutSaveError"),"error",2e3),o(),p()},n=>console.error(n),null),$("#reportConfigurationPopup").dxPopup("instance").hide()):DevExpress.ui.notify(t.msg,"error",2e3)},b=()=>{$("#geniusAnalyticViewer").hide(),$("#geniusAnalyticLauncher").show(),$("#geniusAnalyticNew").show(),currentGeniusView!=null&&selectCardById(currentGeniusView.Id),currentExecution=null,n!=null&&(n.dispose(),$("#flxAnalytic").empty(),n=null)},k=t=>{var e,i,u,f,r;if(!currentGeniusView.CustomFields.DownloadBI){if($("#geniusAnalyticViewer").show(),$("#geniusAnalyticLauncher").hide(),$("#geniusAnalyticNew").hide(),e=JSON.parse(localStorage.getItem("roLanguage")).key,t.ExecutionLanguage!=null&&(e=t.ExecutionLanguage),currentExecution=t,n!=null&&(n.dispose(),$("#flxAnalytic").empty(),n=null),i={dataSourceType:"json",filename:t.AzureSaSKey,options:{defaultDateType:"date string",datePattern:shortFormat},formats:[{name:"",thousandsSeparator:"",decimalSeparator:",",decimalPlaces:2}]},t.CubeLayout!=""){u=JSON.parse(t.CubeLayout);for(const[n]of Object.entries(u))i[n]=i[n]==null?u[n]:Array.isArray(i[n])&&Array.isArray(u[n])?[...i[n],...u[n]]:{...i[n],...u[n]}}if(typeof i.slice=="undefined"?i.slice={expands:{expandAll:!0}}:typeof i.slice.expands=="undefined"&&(i.slice.expands={expandAll:!0}),typeof i.slice.measures!="undefined"&&i.slice.measures.some(n=>n.uniqueName==="dynamic_concepts"))for(i.slice.measures=[],f=0;f<currentGeniusView.Concepts.split(",").length;f++)r=concepts.filter(n=>n.ID==currentGeniusView.Concepts.split(",")[f]),r!=null&&r!=undefined&&r.length>0&&(i.slice.measures=i.slice.measures.add({uniqueName:199+r[0].ID+"",caption:r[0].Name+"(HH:MM)",formula:"sum('"+(99+r[0].ID)+"')"}));n=new Flexmonster({container:"flxAnalytic",componentFolder:FLEX_BASE_URL,beforetoolbarcreated:wt,toolbar:!0,height:800,report:i,customizeCell:pt,customizeContextMenu:yt,global:{localization:FLEX_BASE_URL+"locale/"+e+".json"},licenseKey:_LCODE_});n.on("update",function(){isGeniusAdvanced=="False"&&($("#fm-tab-format-cells").addClass("disabled"),$("#fm-tab-format-conditional").addClass("disabled"))});isGeniusAdvanced=="False"&&(n.setOptions({showCalculatedValuesButton:!1}),n.refresh())}};const h=n=>{currentExecution=n,d(),$("#popupContainer").dxPopup({showTitle:!1,visible:!0,width:400,height:220,contentTemplate:function(n){n.append($("<div class='waitingFile'/>").append($("<p />").text(viewUtilsManager.DXTranslate("roGeniusContinueText")),$("<div />").dxLoadIndicator({height:60,width:60}),$("<br />"),$("<br />"),$("<div />").attr("id","buttonContainer").dxButton({text:viewUtilsManager.DXTranslate("roGeniusContinue"),type:"default",onClick:function(){$("#popupContainer").dxPopup("toggle",!1);clearTimeout(c);selectCardById(currentGeniusView.Id)}})))}}),$("#popupContainer").dxPopup("toggle",!0)},bt=async n=>{window.loadingRequest=!0;try{await $.ajax({url:`${BASE_URL}Genius/DeleteGeniusBIExecution`,data:{geniusExecutionID:n.data.ID,fileName:n.data.FileName},type:"DELETE",dataType:"json",success:n=>{console.log(n);const t=$("#toastBIDeleted").dxToast({displayTime:1500}).dxToast("instance");t.option({type:"success",message:"Ejecución eliminada correctamente"});t.show()},error:t=>{console.error(t);n.cancel=!0;const i=$("#toastBIDeleted").dxToast({displayTime:2e3}).dxToast("instance");i.option({type:"error",message:"Ha habido un problema al eliminar la ejecución"});i.show()}})}catch(t){console.error(t);n.cancel=!0;const i=$("#toastBIDeleted").dxToast({displayTime:2e3}).dxToast("instance");i.option({type:"error",message:"Ha habido un problema al eliminar la ejecución"});i.show()}finally{window.loadingRequest=!1}},d=()=>{viewUtilsManager.makeServiceCall("Genius","getGeniusViewStatus","POST",{id:currentExecution.Id},null,n=>{n?(e(currentExecution.IdTask),$("#popupContainer").dxPopup("toggle",!1)):c=setTimeout(()=>{window.waitForExecutionToFinish()},2e3)},n=>console.error(n),null)},kt=()=>{$("#reportConfigurationPopup").dxPopup("instance").show(),setTimeout(()=>$("#reportConfigurationPopup").dxPopup("instance").repaint(),0),$(".updateReport").show(),$(".runReport").hide(),updating=!0};const gt=()=>{updating=!1,$("#reportConfigurationPopup").dxPopup("instance").show(),setTimeout(()=>$("#reportConfigurationPopup").dxPopup("instance").repaint(),0)},g=()=>{$("#geniusAnalyticViewer").hide(),$("#geniusAnalyticLauncher").show(),$("#geniusAnalyticNew").show(),$("#PlanningList").dxDataGrid("instance").cancelEditData(),viewUtilsManager.makeServiceCall("Genius","GetGeniusView","POST",{id:viewUtilsManager.getSelectedCardId()},null,function(n){n!=null?(it=n,a(n),isConsultor=="False"?$(".btnConvert").parent().hide():$(".btnConvert").parent().show(),isGeniusAdvanced=="False"?$(".btnShare").parent().hide():$(".btnShare").parent().show(),n.IdPassport==0?($(".btnTbDel2").parent().hide(),$(".btnEditGenius").parent().hide(),$(".btnShare").parent().hide(),$(".btnConvert").parent().hide(),$(".btnAddPlanification").parent().hide(),$("#geniusPlanification").hide()):($(".btnTbDel2").parent().show(),$(".btnEditGenius").parent().show(),$(".btnAddPlanification").parent().show(),$("#geniusPlanification").show())):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roPermissionsError"),"error",2e3)},null,null)},ni=async()=>{window.loadingRequest=!0};const nt=async()=>{window.loadingRequest=!0;let n=i();if(ri(n))try{await $.ajax({url:`${BASE_URL}Genius/DeleteGeniusView`,data:{geniusView:n},type:"DELETE",dataType:"json",success:()=>{currentGeniusView=null},error:n=>console.error(n)})}catch(t){console.error(t);response=!1}finally{window.refreshCardTree("-1");window.loadingRequest=!1}},e=async n=>{let t=null;await $.ajax({url:`${BASE_URL}Genius/GetGeniusByTask`,data:{id:n},type:"POST",dataType:"json",success:n=>{n!=null?(t=n,n.Id>0&&t.Executions.length>0?(selectCardById(n.Id),a(t),currentGeniusView.CustomFields.DownloadBI||w(t.Executions[0])):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roNoSelectedTaskAvailable"),"error",2e3)):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roPermissionsError"),"error",2e3)},error:()=>DevExpress.ui.notify(viewUtilsManager.DXTranslate("roNoSelectedTaskAvailable"),"error",2e3)})};tt=function(){if(currentGeniusView!=null)if(currentGeniusView.PlanningList!=null&&currentGeniusView.PlanningList.length>0)DevExpress.ui.notify(viewUtilsManager.DXTranslate("roHasPlanifications"),"error",2e3);else{var n=[];n.push(viewUtilsManager.buildButtonDialog("Yes","Yes",nt));n.push(viewUtilsManager.buildButtonDialog("No","No",function(){}));viewUtilsManager.showModalDialog(this.parent.Robotics.Client.JSErrors.JSErrorTypes.roJsWarning,"","roJsWarning","roGeniusConfirmDelete",n)}else DevExpress.ui.notify(viewUtilsManager.DXTranslate("roNoGeniusViewSelected"),"error",2e3)}})();window.parentCloseAndApplySelector=function(n){currentGeniusView==null&&(currentGeniusView={});currentGeniusView.Employees=n.ComposeFilter+"#"+n.Filter+"#"+n.UserFields;existingView?$("#ReportUsers").dxTextBox("instance").option("value",buildSelectedEmployeesString(n)):$("#ReportUsersNew").dxTextBox("instance").option("value",buildSelectedEmployeesString(n))};String.prototype.replaceAt=function(n,t){return this.substr(0,n)+t+this.substr(n+t.length)};