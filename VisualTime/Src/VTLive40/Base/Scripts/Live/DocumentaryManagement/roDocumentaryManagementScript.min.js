(function(){function f(i){n=i;viewUtilsManager.makeServiceCall("DocumentaryManagement","FindAllDocuments","POST",{searchTerm:n},null,function(){t()},null,null)}function e(n){var t=n.detail;viewUtilsManager.print(t.currentState+" state");switch(t.currentState){}}function o(n,t){setTimeout(function(){var t=$('<form name="frmDownload_'+n.dataItem.id+'"><\/form>').attr("action",`${BASE_URL}DocumentaryManagement/GetDocument`).attr("method","post");t.append($("<input><\/input>").attr("type","hidden").attr("name","documentId").attr("value",n.dataItem.id));t.appendTo("body").submit().remove()},1e3*t)}var r=null,n="",u,i=!1;$(document).ready(async function(){window.hasChanges(!1);viewUtilsManager.initAccordions();viewUtilsManager.setupCardListFilterButton("DocumentaryManagement");viewUtilsManager.print("Documentary Management Module loaded");r=viewUtilsManager.createViewStateHandler();window.loadRequest=t;window.editCurrentDocumentTemplate=h;window.deleteCurrentDocumentTemplate=l;top.confirmDeleteDocumentTemplate=a;window.addNewDocumentTemplate=c;window.RefreshScreen=s;$("#fmDocuments_limit__button").on("click",()=>{$("#fmDocuments_limit__button").toggleClass("active"),t(),$("#fmDocuments .dx-filemanager-files-view.dx-filemanager-thumbnails").append('<div id="fmDocuments__customLoadPanel" class="dx-overlay dx-widget dx-visibility-change-handler dx-loadpanel" > <div class="dx-overlay-content dx-resizable dx-loadpanel-content" style="width: 200px; height: 90px; z-index: 20002; margin: 0px; left: 0px; top: 0px; transform: translate(661px, 180px); transition: all 0s ease 0s;" aria-hidden="true"><div class="dx-loadpanel-content-wrapper"><div class="dx-loadpanel-indicator dx-loadindicator dx-widget"><div class="dx-loadindicator-wrapper"><div class="dx-loadindicator-content"><div class="dx-loadindicator-icon"><div class="dx-loadindicator-segment dx-loadindicator-segment7"><\/div><div class="dx-loadindicator-segment dx-loadindicator-segment6"><\/div><div class="dx-loadindicator-segment dx-loadindicator-segment5"><\/div><div class="dx-loadindicator-segment dx-loadindicator-segment4"><\/div><div class="dx-loadindicator-segment dx-loadindicator-segment3"><\/div><div class="dx-loadindicator-segment dx-loadindicator-segment2"><\/div><div class="dx-loadindicator-segment dx-loadindicator-segment1"><\/div><div class="dx-loadindicator-segment dx-loadindicator-segment0"><\/div><\/div><\/div><\/div><\/div><div class="dx-loadpanel-message">Cargando...<\/div><\/div><\/div><\/div >')});document.addEventListener("startStateEvent",n=>e(n),!1);r.transition(r.value,"read");viewUtilsManager.loadViewOptions("DocumentaryManagement","read",function(){$("#tbGlobalSearchToolbar").dxTextBox({placeholder:viewUtilsManager.DXTranslate("SearchInAllFolders"),mode:"search",valueChangeEvent:"keyup",onValueChanged:function(){var n=$("#tbGlobalSearchToolbar").dxTextBox("instance").option("text").toString();$("#fmDocuments_limit").removeClass("show");$("#fmDocuments_limit__button").removeClass("active");clearTimeout(u);u=setTimeout(function(){i=!0;f(n)},1e3)}});viewUtilsManager.getHtmlControl("fmDocuments").option("toolbar",{items:[{name:"upload",text:viewUtilsManager.DXTranslate("UploaFile"),visible:!0,location:"before"},{widget:"dxTextBox",location:"after",id:"fmTextBoxS",options:{id:"fileManagerSearchTerm",buttons:[{name:"search",location:"after",options:{icon:"search",type:"normal",onClick:function(){t()}}}],valueChangeEvent:"keyup",onValueChanged:function(n){t(n.value)}}},"refresh",{name:"separator",location:"after"},"switchView"]});viewUtilsManager.getHtmlControl("fmDocuments").option("fileSystemProvider",new DevExpress.fileManagement.CustomFileSystemProvider({keyExpr:"keyExpr",getItems:function(){var t=viewUtilsManager.getSelectedCardId();i&&(t=-1);const r=$("#fmDocuments_limit__button").hasClass("active");return viewUtilsManager.makeServiceCall("DocumentaryManagement","GetDocuments","POST",{templateId:t,searchTerm:n,showAll:r},null,function(n){return n?$.ajax({url:`${BASE_URL}DocumentaryManagement/GetLimitReached`,type:"POST",contentType:!1,processData:!1,success:function(t){(t==!0||t=="True")&&n.length==200?($("#fmDocuments_limit").hasClass("show")||$("#fmDocuments_limit").addClass("show"),$("#fmDocuments_limit .js-text_warning").css("opacity","1"),r&&($("#fmDocuments_limit .js-text_warning").css("opacity","0"),$("#fmDocuments_limit__button").removeClass("active"))):($("#fmDocuments_limit").removeClass("show"),$("#fmDocuments_limit__button").removeClass("active"),$("#fmDocuments__customLoadPanel").remove())},error:function(n){console.error(n)}}):$("#fmDocuments_limit").removeClass("show"),i&&CardView.UnselectCards(),$(".cardsTree-CardIcon").css("background","url('Base/Images/StartMenuIcos/Documents.png')"),$(".CardsTree-cardClicked .cardsTree-CardIcon").css("background","url('Base/Images/StartMenuIcos/DocumentsAbsences.png')"),i=!1,n},null,null)},deleteItem:function(n){return viewUtilsManager.makeServiceCall("DocumentaryManagement","RemoveDocument","POST",{documentId:n.dataItem.id},null,function(n){return n},null,null)},uploadFileChunk:function(n){var t=$.Deferred(),i=new FormData;return i.append(n.name,n),i.append("templateId",viewUtilsManager.getSelectedCardId()),$.ajax({url:`${BASE_URL}DocumentaryManagement/AddDocument`,type:"POST",contentType:!1,processData:!1,data:i,success:function(i){i.StatusCode==200&&i.StatusDescription==""?t.resolve({errorId:0,fileItem:n,errorText:i.StatusDescription}):i.StatusCode==200&&i.StatusDescription!=""?(t.resolve({errorId:0,fileItem:n,errorText:""}),Robotics.Client.JSErrors.showJSerrorPopup(Robotics.Client.JSErrors.JSErrorTypes.roJsInfo,"",{text:"",key:"roJsInfo"},{text:i.StatusDescription,key:""},{text:"",textkey:"roErrorClose",desc:"",desckey:"",script:""},Robotics.Client.JSErrors.createEmptyButton(),Robotics.Client.JSErrors.createEmptyButton(),Robotics.Client.JSErrors.createEmptyButton())):t.reject({errorId:0,fileItem:n,errorText:i.StatusDescription})},error:function(i){t.reject({errorId:0,fileItem:n,errorText:i.StatusDescription})}}),t.promise()},abortFileUpload:function(){},downloadItems:function(n){$(n).each(function(t){o(n[t],t)})}}));viewUtilsManager.getHtmlControl("fmDocuments").option("customizeThumbnail",function(n){const t=n.getFileExtension();switch(t){case".pdf":return"Base/Images/Documents/pdf-file-icon.svg";case".xlsx":return"Base/Images/Documents/xlsx-file-icon.png";case".txt":return"Base/Images/Documents/txt-file-icon.png";case".rar":case".zip":return"Base/Images/Documents/compressed-file-icon.png";case".jpeg":return"Base/Images/Documents/jpg-file-icon.png";case".png":case".jpg":case".jpeg":return"Base/Images/Documents/jpg-file-icon.png";default:return""}});$(".dx-widget.dx-filemanager-breadcrumbs").hide()})});const v=()=>{},t=t=>{n!=undefined&&t!=undefined&&(n=t);var i=viewUtilsManager.getHtmlControl("fmDocuments");i!=null&&i.refresh()},s=(n,t)=>{n=="save"&&refreshCardTree(t)},h=()=>{var t=viewUtilsManager.getSelectedCardIsSystem(),n;t=="True"?this.parent.Robotics.Client.JSErrors.showJSerrorPopup(this.parent.Robotics.Client.JSErrors.JSErrorTypes.roJsInfo,"",{text:"",key:"roJsInfo"},{text:"",key:"roDocumentaryManagementIsSystem"},{text:"",textkey:"Done",desc:"",desckey:"",script:""},this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton()):(n="Documents/DocumentTemplateWizard.aspx?IDdocumentTemplate="+viewUtilsManager.getSelectedCardId(),top.ShowExternalForm2(n,1150,750,"","",!1,!1,!1))},c=()=>{top.ShowExternalForm2("Documents/DocumentTemplateWizard.aspx?IDdocumentTemplate=-1",1150,750,"","",!1,!1,!1)},l=()=>{var n=viewUtilsManager.getSelectedCardIsSystem();n=="True"?this.parent.Robotics.Client.JSErrors.showJSerrorPopup(this.parent.Robotics.Client.JSErrors.JSErrorTypes.roJsInfo,"",{text:"",key:"roJsInfo"},{text:"",key:"roDocumentaryManagementIsSystem"},{text:"",textkey:"OK",desc:"",desckey:"",script:""},this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton()):this.parent.Robotics.Client.JSErrors.showJSerrorPopup(this.parent.Robotics.Client.JSErrors.JSErrorTypes.roJsWarning,"",{text:"",key:"roJsWarning"},{text:"",key:"roDocumentaryManagementConfirmDelete"},{text:"",textkey:"OK",desc:"",desckey:"",script:"confirmDeleteDocumentTemplate()"},{text:"",textkey:"Cancel",desc:"",desckey:"",script:""},this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton())},a=()=>{viewUtilsManager.makeServiceCall("DocumentaryManagement","RemoveDocumentTemplate","POST",{templateId:viewUtilsManager.getSelectedCardId()},null,null,function(n){n.status==200?this.parent.Robotics.Client.JSErrors.showJSerrorPopup(this.parent.Robotics.Client.JSErrors.JSErrorTypes.roJsSuccess,"",{text:"",key:"roJsSuccess"},{text:"",key:"roDocumentaryManagementOkDelete"},{text:"",textkey:"OK",desc:"",desckey:"",script:""},this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton()):this.parent.Robotics.Client.JSErrors.showJSerrorPopup(this.parent.Robotics.Client.JSErrors.JSErrorTypes.roJsError,"",{text:"",key:"roJsError"},{text:n.statusText,key:"roDocumentaryManagementKoDelete"},{text:"",textkey:"OK",desc:"",desckey:"",script:""},this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton());refreshCardTree()},null)},y=()=>{}})();