(function(){let n={};$(document).ready(async function(){window.HistoricGrid={init:async(n,t,r,u)=>i(n,t,r,u),selectRow:async(t,i)=>u(i,n[t]),updateDS:async(t,i)=>f(i,n[t])};const i=async(t,i,u,f)=>{let e={};i=[...i].filter(n=>typeof n.EditionStatus!="undefined"?n.EditionStatus!==2:!0);i=[...i].sort((n,t)=>{const i=moment(n[f.historyDate]).toDate(),r=moment(t[f.historyDate]).toDate();return r-i});typeof n[t]=="undefined"?(e={id:t,container:$(`#${t}`),ds:i,title:u,keys:f,dataGridHistoric:null,lastIdSelected:-1},n[t]=e):(n[t].container=$(`#${t}`),n[t].ds=i,n[t].title=u,n[t].keys=f,n[t].dataGridHistoric=null,e=n[t]);r(e)},r=n=>{n.container.html("");const i=$("<div>").attr("class","headerSaveBar"),u=$("<div>").css({display:"flex","flex-direction":"row"}),f=$('<div class="objectName" style="line-height: 20px;">').append($(`<span id="${n.id}_spanTitle">`).attr("class","historyGridTitle").text(n.title)),e=$("<div>").attr("id",`newHistoryItem_${n.id}`).css({"margin-left":"auto"});i.append(u.append(f,e));const r=$("<div>").css({display:"inline-block","margin-left":"10px"}),o=$("<div>").attr("id",`gridHistoryItem_${n.id}`);r.append(o);n.container.attr("style","width: 100%;display: flex;flex-direction: column;gap: 10px;");n.container.append(i,r);$(`#newHistoryItem_${n.id}`).dxButton({icon:"plus",text:"",elementAttr:{id:`newHistoryItem_${n.id}`},onClick:async function(t){let i=`${n.id}_OnNewClick`;typeof window[i]=="function"?await window[i](t):console.error(`Function ${i} not found.`)},type:"default"});n.dataGridHistoric=$(`#gridHistoryItem_${n.id}`).dxTreeList({dataSource:n.ds,keyExpr:n.keys.id,columns:[{dataField:n.keys.description,caption:getTextFromCatalog(undefined,"roHistoryGrid_Description"),allowSorting:!1},{dataField:n.keys.historyDate,dataType:"date",caption:getTextFromCatalog(undefined,"roHistoryGrid_Date"),width:100,calculateCellValue:function(t){const i=t[n.keys.historyDate];return i?moment(i).format(getDateLocalizationFormats().moment):null}}],selection:{mode:"single"},showBorders:!0,showRowLines:!0,onSelectionChanged:async function(t){let i=`${n.id}_OnHistoryItemClick`;typeof window[i]=="function"?await window[i](t):console.error(`Function ${i} not found.`)}}).dxTreeList("instance");t(n)},t=n=>{if(n&&n.ds.length!=0){const t=n.ds[0][n.keys.id];n.dataGridHistoric.selectRows([t],!1);n.dataGridHistoric.navigateToRow(t)}},u=async(n,t)=>{t&&t.dataGridHistoric&&(n===null||n===undefined?t.dataGridHistoric.clearSelection():(t.dataGridHistoric.selectRows([n],!1),t.dataGridHistoric.navigateToRow(n)))},f=async(n,i)=>{if(i&&i.dataGridHistoric)try{const u=i.dataGridHistoric.getSelectedRowKeys?i.dataGridHistoric.getSelectedRowKeys():[],r=u.length>0?u[0]:null;if(n=[...n].filter(n=>typeof n.EditionStatus!="undefined"?n.EditionStatus!==2:!0),n=[...n].sort((n,t)=>{const r=moment(n[i.keys.historyDate]).toDate(),u=moment(t[i.keys.historyDate]).toDate();return u-r}),i.ds=n,i.dataGridHistoric.option("dataSource",n),i.dataGridHistoric.refresh(),r){const u=n.some(n=>n[i.keys.id]===r);u?(i.dataGridHistoric.selectRows([r],!1),i.dataGridHistoric.navigateToRow(r)):t(i)}else t(i)}catch(r){console.error("Error en updateDS:",r)}}})})();