(function(){async function lh(){if(!n.Permissions.Remove){await DevExpress.ui.dialog.alert(cr,wt);return}const t=await o.dialogDx(uf,wt);if(t){const t=await fc(n.Id);t?(v.find(n=>n.classList.contains("reportCardClicked")).remove(),ir()):DevExpress.ui.dialog.alert(cr,wt)}}function uu(n,t=null){let i;if(at){let n="";if(t){const i=[];while(t){const r=fi.find(n=>n.Id===t);i.push(r);t=r.MotherCategoryId;i.map(t=>n+=` cat:${t.Name};`)}}i=at.innerText===or?"":`cat:${at.innerText}`}else i="";ri.value=`${i} ${document.querySelector("#customSearchBar").value}`;ri.onchange()}function ir(){ri=document.querySelector("#CardView_DXSE_I");v=[...document.querySelectorAll(".reportCard")];tt=document.querySelector(".dxcvCSD");eu();v.length>0&&(ii=u.scrollTransparencyLayer(tt),fu(),wi.observe(v[v.length-1]));fr();u.blurAllTabs();u.blurAnyReportCard(v);$(".reportCard").off("click");$(".reportCard").on("click",cu)}function fu(){wi=new IntersectionObserver(n=>{ii.style.opacity=n[0].isIntersecting&&n[0].intersectionRatio>=.5?0:1},{root:tt,threshold:[0,.5,1]})}async function ou(){await $.ajax({url:`${BASE_URL}Report/GetReportCategoriesAsJson`,type:"POST",dataType:"json",success:n=>fi=n,error:n=>console.error(n)});fi&&u.categoryTreeMenu(lt,[{ID:7,Description:or},...fi,]);su()}async function hu(t=""){let r=-1;if(!!document.querySelector("#plannerPage")){o.removeIdNewPlanifications();let n=JSON.stringify(i.ParametersList);t!=""&&(n=JSON.stringify(t));const u=$("#reportPlannedList").dxDataGrid("instance");r=u.option("focusedRowKey")==="newPlanification"?i.PlannedExecutionsList.length-1:i.PlannedExecutionsList.findIndex(n=>n.Id===u.option("focusedRowKey"));i.PlannedExecutionsList[r]===undefined?(i.PlannedExecutionsList[r]={},i.PlannedExecutionsList[r].ParametersJson={},i.PlannedExecutionsList[r].ParametersJson=n):i.PlannedExecutionsList[r].ParametersJson=n;const e=await f.acceptEdition(!1,"planifications");e&&rt();return}const u=n.Id;if(!u)throw new Error("no se Identifica ningún Report seleccionado");const e=r!=-1?await vu(u,JSON.stringify(t),JSON.stringify(i.PlannedExecutionsList[r].ViewFields)):await vu(u,JSON.stringify(t));e||DevExpress.ui.dialog.alert(`${yf} ${pf}`,tf);n.ExecutionsList.unshift({BlobLink:"",ExecutionDate:new Date,FileLink:"#",Guid:"",LayoutID:n.Id,Status:1});er(n);setTimeout(au,3e3)}function rr(){var r=i.ParametersList.filter(n=>n.TemplateName!=="hidden"),e,u;if(s=!0,r.length>t&&r[t])switch(r[t].TemplateName){case"selectorEmployees":r[t].Value==="-1@11110@"&&(this.parent.Robotics.Client.JSErrors.showJSerrorPopup(this.parent.Robotics.Client.JSErrors.JSErrorTypes.roJsError,"",{text:h,key:""},{text:wo,key:""},{text:"",textkey:"SI",desc:"",desckey:"",script:""},this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton()),s=!1);break;case"selectorPeriodTime":if(r[t].Value===""){const i="YYYY-MM-DD HH:mm:ss",n=document.querySelector("input[type=radio]:checked").value,o=$("#desdeDateTime").dxDateBox("instance"),s=$("#hastaDateTime").dxDateBox("instance"),{initDate:u,finalDate:e}=f.selectorDatetime(parseInt(n,10),o,s),h=n!=="0"?`${n},${u.format()},${e.format(i)}`:()=>`${n},${window.parent.moment(u()).format(i)},${window.parent.moment(e()).format(i)}`;r[t].Value=h}break;case"selectorViewFormat":r[t].Value===""&&(r[t].Value={ckDetail:!1,ckTotal:!1,ckShowChart:!1});r[t].Value.ckDetail===!1&&r[t].Value.ckTotal===!1&&(collectParamValues("chart",!1,null),this.parent.Robotics.Client.JSErrors.showJSerrorPopup(this.parent.Robotics.Client.JSErrors.JSErrorTypes.roJsError,"",{text:h,key:""},{text:et,key:""},{text:"",textkey:"SI",desc:"",desckey:"",script:""},this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton()),s=!1);r[t].Value.ckShowChart===!0&&n.Name=="Saldos con detalle"&&n.ParametersList!=null&&n.ParametersList.length>0&&n.ParametersList[3]!=null&&n.ParametersList[3].Value.split(",").length>10&&(this.parent.Robotics.Client.JSErrors.showJSerrorPopup(this.parent.Robotics.Client.JSErrors.JSErrorTypes.roJsError,"",{text:h,key:""},{text:yo,key:""},{text:"",textkey:"SI",desc:"",desckey:"",script:""},this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton()),s=!1);break;case"selectorAccessType":r[t].Value===""&&(r[t].Value={ckValids:!1,ckInvalids:!1});r[t].Value.ckValids===!1&&r[t].Value.ckInvalids===!1&&(this.parent.Robotics.Client.JSErrors.showJSerrorPopup(this.parent.Robotics.Client.JSErrors.JSErrorTypes.roJsError,"",{text:h,key:""},{text:et,key:""},{text:"",textkey:"SI",desc:"",desckey:"",script:""},this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton()),s=!1);break;case"selectorProfileTypes":let i=r[t].Value;r[t].Value===""&&(r[t].Value={profileTypes:0});const v=[1,2,3,4].includes(i.profileTypes);let o=!1;e=$("#valorCriterio").dxValidator("instance");u=e.validate();const w=i.criterio!==undefined&&i.rangoCriterio!==undefined&&i.valorCriterio!==null&&i.valorCriterio!==undefined&&u.isValid;if(v)switch(i.profileTypes){case 1:o=i.selectConcepts!==undefined&&i.selectConcepts!==""&&i.selectConcepts.length!==0&&i.selectConcepts.every(n=>parseInt(n.value,10)!==0)&&!i.selectConcepts.every(n=>parseInt(n.value,10)===-1)&&typeof i.rangoCriterio=="string";break;case 2:o=i.selectCauses!==undefined&&i.selectCauses!==""&&i.selectCauses.length!=0;break;case 3:o=i.selectIncidences!==undefined&&i.selectIncidences!==""&&i.selectIncidences.length!=0;break;case 4:o=i.selectCauses!==undefined&&i.selectCauses!==""&&i.selectCauses.length!=0&&i.selectIncidences!==undefined&&i.selectIncidences!==""&&i.selectIncidences.length!=0}const b=i?.tipoValorCriterio!="campo"||i?.tipoValorCriterio=="campo"&&oi.find(n=>n.value==i?.valorFichaCriterio);v&&o&&w&&b||(u==null||u.isValid?this.parent.Robotics.Client.JSErrors.showJSerrorPopup(this.parent.Robotics.Client.JSErrors.JSErrorTypes.roJsError,"",{text:h,key:""},{text:et,key:""},{text:"",textkey:"SI",desc:"",desckey:"",script:""},this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton()):this.parent.Robotics.Client.JSErrors.showJSerrorPopup(this.parent.Robotics.Client.JSErrors.JSErrorTypes.roJsError,"",{text:h,key:""},{text:br,key:""},{text:"",textkey:"SI",desc:"",desckey:"",script:""},this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton()),s=!1);break;case"selectorCausesRegistroJL":let c=r[t].Value,y=!1;r[t].Value===""&&(r[t].Value={showCauses:0});c.showCauses==!0&&(y=c.selectCauses!==undefined&&c.selectCauses!==""&&c.selectCauses.length!=0,y||(this.parent.Robotics.Client.JSErrors.showJSerrorPopup(this.parent.Robotics.Client.JSErrors.JSErrorTypes.roJsError,"",{text:h,key:""},{text:et,key:""},{text:"",textkey:"SI",desc:"",desckey:"",script:""},this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton()),s=!1));break;case"selectorConceptsRegistroJL":let l=r[t].Value,p=!1;r[t].Value===""&&(r[t].Value={showConcepts:0});l.showConcepts==!0&&(p=l.selectConcepts!==undefined&&l.selectConcepts!==""&&l.selectConcepts.length!=0,p||(this.parent.Robotics.Client.JSErrors.showJSerrorPopup(this.parent.Robotics.Client.JSErrors.JSErrorTypes.roJsError,"",{text:h,key:""},{text:et,key:""},{text:"",textkey:"SI",desc:"",desckey:"",script:""},this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton()),s=!1));break;case"selectorConcepts":r[t].Value===""&&(this.parent.Robotics.Client.JSErrors.showJSerrorPopup(this.parent.Robotics.Client.JSErrors.JSErrorTypes.roJsError,"",{text:h,key:""},{text:kr,key:""},{text:"",textkey:"SI",desc:"",desckey:"",script:""},this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton()),s=!1);break;case"selectorCauses":r[t].Value===""&&(this.parent.Robotics.Client.JSErrors.showJSerrorPopup(this.parent.Robotics.Client.JSErrors.JSErrorTypes.roJsError,"",{text:h,key:""},{text:kr,key:""},{text:"",textkey:"SI",desc:"",desckey:"",script:""},this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton()),s=!1);break;case"selectorDate":if(r[t].Value===""){const n=document.querySelector("input[type=radio]:checked").value,u=$("#parameterDate").dxDateBox("instance"),{initDate:i}=f.selectorDatetime(parseInt(n,10),u),e=n!=="0"?`${n},${i.format()}`:()=>`${n},${i()}`;r[t].Value=e}break;case"selectorProjectsVSL":let a=r[t].Value;const k=a.startProject!==undefined&&a.endProject!==undefined&&a.startProject>a.endProject;k&&(this.parent.Robotics.Client.JSErrors.showJSerrorPopup(this.parent.Robotics.Client.JSErrors.JSErrorTypes.roJsError,"",{text:h,key:""},{text:ko,key:""},{text:"",textkey:"SI",desc:"",desckey:"",script:""},this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton()),s=!1);break;case"selectorUniversal":if(!isNaN(r[t].Description)&&r[t].Type=="Robotics.Base.userFieldsSelector"){let n=parseInt(r[t].Description,10);r[t].Value.split(",").length>n&&(this.parent.Robotics.Client.JSErrors.showJSerrorPopup(this.parent.Robotics.Client.JSErrors.JSErrorTypes.roJsError,"",{text:h,key:""},{text:bo.replace("(1)",n),key:""},{text:"",textkey:"SI",desc:"",desckey:"",script:""},this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton()),s=!1)}r[t].Type=="Robotics.Base.conceptGroupsSelector"&&n.Name=="Saldos día a día"&&n.ParametersList!=null&&n.ParametersList.length>0&&n.ParametersList[5]!=null&&n.ParametersList[5].Value.split(",").length>1&&(this.parent.Robotics.Client.JSErrors.showJSerrorPopup(this.parent.Robotics.Client.JSErrors.JSErrorTypes.roJsError,"",{text:h,key:""},{text:po,key:""},{text:"",textkey:"SI",desc:"",desckey:"",script:""},this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton(),this.parent.Robotics.Client.JSErrors.createEmptyButton()),s=!1)}}function ur(){const t=document.querySelector("#planificationsTab");t.classList.contains("activeTab")?ut(n.Id):([...ui].map(n=>n.style.display=""),yh(n.LayoutPreviewXMLBinary),er(n),ph(n))}async function cu(){const n=$(this).find(".reportCardInfo").attr("data-report-id");var i=$(".treeCaption");await hi(n);const t=document.querySelector("#planificationsTab"),r=document.querySelector("#generalTab");t.classList.contains("activeTab")&&document.querySelector("#planificationsTab").click();ur();ah($(this))}function fr(){tt.parentNode.style.height=`${window.innerHeight-250}px`}function yh(n=""){const t=document.querySelector("#reportPdfViewer > .imgPreview");t.style.backgroundImage=`url("data:image/png;base64,${n}")`}function ph(n){const t=[...ui].find(n=>"reportConfigContainer"===n.getAttribute("id")),i=t.querySelector("#reportInfo");u.reportLayoutInfo(n,i)}function er(t){const i=document.querySelector("#reportExecContainer"),r=i.querySelector("#reportsHistoricContainer"),f=i.querySelector("ul.reportsHistoric");ut(n.Id,n.LastExecution&&n.LastExecution.Guid||null);u.executionsList(f,t.ExecutionsList.sort((n,t)=>n.ExecutionDate>t.ExecutionDate?-1:1),r)}function wh(n){at.innerText=n.Description;uu(null,null);kh(n.Description)}function bh(i){var f;switch(i){case"selectorDate":f=n.ParametersList.find(n=>n.TemplateName==="selectorDate"&&n.Name===r[t].Name);const i=$("#parameterDate").dxDateBox("instance");i.option("value",moment(i.option("value")).format("YYYY-MM-DD"));var e=0,u=null,o=null;if(f.Value.indexOf(",")>0)e=f.Value.split(",")[0],u=f.Value.split(",")[1],o=document.querySelector(`#selectorDate input[value='${e}']`);else{u=f.Value;var s=new Date(u).getDate(),h=new Date(u).getMonth()+1,c=new Date(u).getFullYear();(isNaN(s)||isNaN(h)||isNaN(c))&&(u=new Date,s=new Date(u).getDate(),h=new Date(u).getMonth()+1,c=new Date(u).getFullYear());o=document.querySelector(`#selectorDate input[value='0']`)}o&&o.setAttribute("checked","");e!==0&&e!=="0"&&i.option("disabled",!0)}}function kh(n){nu=document.querySelectorAll(".categoryText tr .dx-treelist-text-content");const t=[...nu].filter(t=>t.innerText===n);t.map(n=>{n.parentNode.classList.toggle("targetCategory")})}async function si(t){const u=t.path?t.path[0]:t.currentTarget,i=u.getAttribute("data-guid")||n.LastExecution&&n.LastExecution.Guid||0,r=await dh(i);if(r.size>0){var f=n.ExecutionsList.find(n=>n.Guid===i).Extension;const t=document.createElement("a");t.setAttribute("download",`${n.DisplayName=="NotFound"?n.Name:n.DisplayName}.${f}`);t.setAttribute("href",window.URL.createObjectURL(r));t.click();t.remove()}else DevExpress.ui.dialog.alert(lf,nf)}const or=window.parent.Globalize.formatMessage("TODAS_CATEGORIAS"),pu=window.parent.Globalize.formatMessage("SIN_EJECUCIONES"),wu=window.parent.Globalize.formatMessage("ELIMINA"),ec=window.parent.Globalize.formatMessage("CREAR"),sr=window.parent.Globalize.formatMessage("CANCELAR"),bu=window.parent.Globalize.formatMessage("EDITAR"),oc=window.parent.Globalize.formatMessage("CONTINUAR"),ku=window.parent.Globalize.formatMessage("ACEPTAR"),ci=window.parent.Globalize.formatMessage("GUARDANDO_DATOS"),h="Atención",du="No hay planificaciones para el informe seleccionado.",sc=window.parent.Globalize.formatMessage("CREAR_PLANIFICACION"),gu=window.parent.Globalize.formatMessage("CLONANDO_INFORME"),nf=window.parent.Globalize.formatMessage("DESCARGANDO_EJECUCION"),hr=window.parent.Globalize.formatMessage("GESTIONANDO_PERMISOS"),tf=window.parent.Globalize.formatMessage("LANZANDO_INFORME"),rf=window.parent.Globalize.formatMessage("CONFIRMAR_BORRAR_PLANIFICACION"),uf=window.parent.Globalize.formatMessage("CONFIRMAR_BORRAR_INFORME"),ff=window.parent.Globalize.formatMessage("LANGUAGES_SELECT_PLACEHOLDER"),ef=window.parent.Globalize.formatMessage("FORMAT_SELECT_PLACEHOLDER"),sf=window.parent.Globalize.formatMessage("CLONE_NAME_PLACEHOLDER"),li=window.parent.Globalize.formatMessage("SI"),ai=window.parent.Globalize.formatMessage("NO"),wt=window.parent.Globalize.formatMessage("ELIMINAR_INFORME"),cr=window.parent.Globalize.formatMessage("NO_PERMISOS_PARA_BORRAR_INFORME"),lr=window.parent.Globalize.formatMessage("FALTA_COMPLETAR_ALGUNOS_CAMPOS"),hf=window.parent.Globalize.formatMessage("ALGO_MAL_INTENTAR_GUARDAR_DATOS"),cf=window.parent.Globalize.formatMessage("ALGO_MAL_INTENTAR_CLONAR_INFORME"),lf=window.parent.Globalize.formatMessage("NO_SE_PUEDE_RECUPERAR_EJECUCION"),af=window.parent.Globalize.formatMessage("PRIMERO_SELECIONA_USUARIO_DE_LISTA"),vf=window.parent.Globalize.formatMessage("USUARIO_YA_TIENE_PERMISOS"),yf=window.parent.Globalize.formatMessage("NO_SE_PUDO_LANZAR_INFORME"),pf=window.parent.Globalize.formatMessage("INTENTELO_DE_NUEVO"),wf=window.parent.Globalize.formatMessage("DESTINATION_PLACEHOLDER"),bf=window.parent.Globalize.formatMessage("REPORT_PARAMETER_SHIFT_DATE"),kf=window.parent.Globalize.formatMessage("REPORT_PARAMETER_HOLIDAY_DATE"),ar=window.parent.Globalize.formatMessage("REPORT_PARAMETER_CONCEPT_GROUP"),df=window.parent.Globalize.formatMessage("REPORT_PARAMETER_SELECTOR_EMPLEADOS"),gf=window.parent.Globalize.formatMessage("REPORT_PARAMETER_DATES"),vr=window.parent.Globalize.formatMessage("REPORT_PARAMETER_CAUSES"),ne=window.parent.Globalize.formatMessage("REPORT_PARAMETER_INCIDENCES"),te=window.parent.Globalize.formatMessage("REPORT_PARAMETER_ZONES"),ie=window.parent.Globalize.formatMessage("REPORT_PARAMETER_TERMINALS"),re="Tasks",ue=window.parent.Globalize.formatMessage("REPORT_PARAMETER_USER_FIELDS"),yr=window.parent.Globalize.formatMessage("REPORT_PARAMETER_CONCEPT_DESCRIPTION"),pr=window.parent.Globalize.formatMessage("REPORT_PARAMETER_CONCEPTS"),fe="Visualización",ee="Tipo de acceso",oe=window.parent.Globalize.formatMessage("REPORT_PARAMETER_FILTER_PROFILE"),se=window.parent.Globalize.formatMessage("REPORT_PARAMETER_CAUSES_RJL"),he=window.parent.Globalize.formatMessage("REPORT_PARAMETER_CONCEPTS_RJL"),ce=window.parent.Globalize.formatMessage("REPORT_PARAMETER_YEAR_MONTH"),le=window.parent.Globalize.formatMessage("REPORT_PARAMETER_YEAR_MONTH"),vi=window.parent.Globalize.formatMessage("FORMAT"),ae=window.parent.Globalize.formatMessage("REPORT_PARAMETER_FILTERVALUES"),yi=window.parent.Globalize.formatMessage("SELECT_ALL"),wr=window.parent.Globalize.formatMessage("VIEWMORE"),ft=window.parent.Globalize.formatMessage("SELECT"),ve=window.parent.Globalize.formatMessage("DISPLAY"),ye=window.parent.Globalize.formatMessage("TOTALS"),bt=window.parent.Globalize.formatMessage("REPORT_PARAMETER_DETAIL"),pe=window.parent.Globalize.formatMessage("REPORT_PARAMETER_CHART"),we=window.parent.Globalize.formatMessage("REPORT_PARAMETER_PROJECT_VSL"),be=window.parent.Globalize.formatMessage("ACCESSTYPE"),ke=window.parent.Globalize.formatMessage("REPORT_PARAMETER_VALID_ACCESS"),de=window.parent.Globalize.formatMessage("REPORT_PARAMETER_INVALID_ACCESS"),hc=window.parent.Globalize.formatMessage("REPORT_PARAMETER_FORMAT_MSG"),ge=window.parent.Globalize.formatMessage("REPORT_FILTER_VALUES"),no=window.parent.Globalize.formatMessage("REPORT_VALUESRANGE_FILTER"),to=window.parent.Globalize.formatMessage("AND"),io=window.parent.Globalize.formatMessage("VALUE"),ro=window.parent.Globalize.formatMessage("FIELDCAMP"),uo=window.parent.Globalize.formatMessage("PERIOD"),fo=window.parent.Globalize.formatMessage("NEXT_REPORT"),eo=window.parent.Globalize.formatMessage("DESTINATION"),oo=window.parent.Globalize.formatMessage("LANGUAGE"),so=window.parent.Globalize.formatMessage("WHO"),ho=window.parent.Globalize.formatMessage("DESCRIPTION"),co=window.parent.Globalize.formatMessage("OVERRIDE_PLANIFICATION_PARAMS"),lo=window.parent.Globalize.formatMessage("KEEPPARAMS"),ao=window.parent.Globalize.formatMessage("CHANGEPARAMS"),vo=window.parent.Globalize.formatMessage("REPORT_PARAMATERS"),et=window.parent.Globalize.formatMessage("MSG_VALIDATION_DISPLAY"),yo=window.parent.Globalize.formatMessage("MSG_VALIDATION_DISPLAY"),po=window.parent.Globalize.formatMessage("MSG_VALIDATION_CONCEPTGROUPS"),br=window.parent.Globalize.formatMessage("MSG_VALIDATION_DISPLAY"),wo=window.parent.Globalize.formatMessage("MSG_VALIDATION_EMPLOYEE"),kr=window.parent.Globalize.formatMessage("MSG_VALIDATION_CONCEPTS"),bo=window.parent.Globalize.formatMessage("MSG_VALIDATION_MAXNUMBER"),ko=window.parent.Globalize.formatMessage("MSG_VALIDATION_PROJECTS_MINMAX"),go=window.parent.Globalize.formatMessage("USERFIELDS"),ns=window.parent.Globalize.formatMessage("SHIFTS"),ts=window.parent.Globalize.formatMessage("HOLIDAYSSHIFTS"),is=window.parent.Globalize.formatMessage("CONCEPTGROUP"),rs=window.parent.Globalize.formatMessage("SALDOS"),us=window.parent.Globalize.formatMessage("JUSTIFICACIONES"),fs=window.parent.Globalize.formatMessage("INCIDENCIAS"),es=window.parent.Globalize.formatMessage("INCIDENCIASYJUSTIFICACIONES"),os=window.parent.Globalize.formatMessage("SUPERA"),ss=window.parent.Globalize.formatMessage("NOSUPERA"),hs=window.parent.Globalize.formatMessage("ELVALOR"),cs=window.parent.Globalize.formatMessage("ELVALORDELCAMPO"),ls=window.parent.Globalize.formatMessage("DIARIAMENTE"),as=window.parent.Globalize.formatMessage("ENPERIODOSELECCIONADO"),dr=window.parent.Globalize.formatMessage("SELECCIONASALDOS"),gr=window.parent.Globalize.formatMessage("SELECCIONACONCEPTS"),vs=window.parent.Globalize.formatMessage("SELECCIONAINCIDENCIAS"),cc=window.parent.Globalize.formatMessage("MAXINCIDENCIASJUSTIFICACIONES"),lc=window.parent.Globalize.formatMessage("MAXINCIDENCIAS"),ac=window.parent.Globalize.formatMessage("MAXJUSTIFICACIONES"),ys=window.parent.Globalize.formatMessage("MAXSALDOS"),ps=window.parent.Globalize.formatMessage("MONTH_01"),ws=window.parent.Globalize.formatMessage("MONTH_02"),bs=window.parent.Globalize.formatMessage("MONTH_03"),ks=window.parent.Globalize.formatMessage("MONTH_04"),ds=window.parent.Globalize.formatMessage("MONTH_05"),gs=window.parent.Globalize.formatMessage("MONTH_06"),nh=window.parent.Globalize.formatMessage("MONTH_07"),th=window.parent.Globalize.formatMessage("MONTH_08"),ih=window.parent.Globalize.formatMessage("MONTH_09"),rh=window.parent.Globalize.formatMessage("MONTH_10"),uh=window.parent.Globalize.formatMessage("MONTH_11"),fh=window.parent.Globalize.formatMessage("MONTH_12"),ot=window.parent.Globalize.formatMessage("MONTH_CURRENT"),st=window.parent.Globalize.formatMessage("MONTH_PREV"),ht=window.parent.Globalize.formatMessage("MONTH_NEXT");var pi,kt="DD-MM-YYYY";const dt=[{title:window.parent.Globalize.formatMessage("DAILY"),range:"optDiary",value:0},{title:window.parent.Globalize.formatMessage("WEEKLY"),range:"optWeekly",value:1},{title:window.parent.Globalize.formatMessage("MONTHLY"),range:"optMonthly",value:2},{title:window.parent.Globalize.formatMessage("ONCE"),range:"optOneTime",value:3},{title:window.parent.Globalize.formatMessage("INTERVAL"),range:"optHours",value:4}],k=[{title:"PDF",value:0},{title:"Excel",value:1},{title:"CSV",value:3},{title:"Text",value:5},],eh=[{Description:"1",value:1},{Description:"2",value:2},{Description:"3",value:3},{Description:"4",value:4},{Description:"5",value:5},{Description:"6",value:6},{Description:"7",value:7},{Description:"8",value:8},{Description:"9",value:9},{Description:"10",value:10},{Description:"11",value:11},],d=[],gt=13,ni=14,ti=15,g=new Date,w=[{title:ot,value:gt},{title:st,value:ni},{title:ht,value:ti},{title:ps,value:1},{title:ws,value:2},{title:bs,value:3},{title:ks,value:4},{title:ds,value:5},{title:gs,value:6},{title:nh,value:7},{title:th,value:8},{title:ih,value:9},{title:rh,value:10},{title:uh,value:11},{title:fh,value:12}],nt=[2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030];let r,t=0,ct=!1,v,oh,tt,nu,n,i,wi,ii,ri,bi,ki,lt,sh,ui,at,fi,tu,l={},it,hh,iu,di=1,s=!0,gi=!1,nr=!1,tr=!1,ei=null,vt=null,oi=[];$(document).ready(async function(){v=[...document.querySelectorAll(".reportCard")];oh=document.querySelectorAll(".switchMainViewTabs span");ui=document.querySelectorAll("#mainPanelDisplay > div#reportConfigContainer, #mainPanelDisplay > div#reportExecContainer, #mainPanelDisplay > div#execSchedulerPage");tt=document.querySelector(".dxcvCSD");ri=document.querySelector("#CardView_DXSE_I");bi=document.querySelector("#customSearchBar");ki=document.querySelector("#reportCategoriesBtn");lt=document.querySelector("#customSearchPanel .menuCategories");hh=document.querySelector("#mainPanelDisplay .removeExecBtn");sh=document.querySelector(".switchMainViewTabs #reportRemoveBtn");at=document.querySelector("#reportCategoriesBtn > nobr > span");eu();ii=u.scrollTransparencyLayer(tt);fu();v.length>0&&wi.observe(v[v.length-1]);window.reloadCardsPanel=ir;fr();$(".reportCard").off("click");$(ki).off("click");$(bi).off("keyup");$(".reportCard").on("click",cu);$(ki).on("click",ou);$(bi).on("keyup",uu);tu=await tc();di=await ic()});switch(lang){case"es-ES":case"ca-ES":case"pt-PT":case"gl-ES":case"it-IT":case"fr-FR":case"eu-ES":kt="dd/M/yyyy";break;case"en-US":default:kt="M/dd/yyyy"}window.onresize=()=>{fr()};window.collectParamValues=async(u,e,o)=>{var p,tt,b,it,c,rt,ut,l;let h="";const k=document.querySelector("#editView > form").getAttribute("id"),w=document.querySelector("#fieldsEditor #"+k),d=i.ParametersList.find(n=>n.TemplateName===k&&n.Name===r[t].Name);let s={};switch(k){case"selectorEmployees":const kt=`${u||-1}@${e||-1}@${o||""}`;h=kt;break;case"selectorPeriodTime":const lt="YYYY-MM-DD HH:mm:ss",at=w.querySelector("input[type=radio]:checked").value,dt=$("#desdeDateTime").dxDateBox("instance"),gt=$("#hastaDateTime").dxDateBox("instance"),{initDate:wt,finalDate:bt}=f.selectorDatetime(parseInt(at,10),dt,gt),ni=at!=="0"?`${at},${wt.hour(0).minute(0).second(0).format(lt)},${bt.hour(23).minute(59).second(59).format(lt)}`:()=>`${at},${window.parent.moment(wt()).hour(0).minute(0).second(0).format(lt)},${window.parent.moment(bt()).hour(23).minute(59).second(59).format(lt)}`;h=ni;break;case"selectorString":const ti=w.querySelector("#parameterString").value;h=ti;break;case"selectorNumber":const ii=w.querySelector("#parameterNumber").value;h=ii;break;case"selectorDate":var g="YYYY-MM-DD",nt=w.querySelector("input[type=radio]:checked").value,y="";const ot=$("#parameterDate").dxDateBox("instance");p=!1;switch(nt){case"0":ot.option("disabled",!1);const n=ot.option("value");y=n.format(g);ot.option("value",y);p=i.Name=="Control de vacaciones por días";break;case"2":ot.option("disabled",!0);y=moment().format(g);p=!1;break;case"3":ot.option("disabled",!0);y=moment().add("days",-1).format(g);p=!1}p?$("#hintDataSelection").css("opacity","1"):$("#hintDataSelection").css("opacity","0");const ri=`${nt},${y}`;h=ri;break;case"selectorDestination":f.addDestination(u);return;case"selectorUniversal":if(d.Type=="Robotics.Base.userFieldsSelector"||d.Type=="Robotics.Base.userFieldsSelectorRadioBtn"){if(h="",u===null&&(c=n.ParametersList.find(n=>n.Name===r[t].Name).Value,c!==undefined&&c!==""&&(h=c)),h!==""||!(u===undefined||u===null)){u===undefined||u===null||(h=u);let i=0,t=0;for(paramArray in n.ParametersList)i=0,n.ParametersList[paramArray].Type==="Robotics.Base.userFieldIdentifier"&&t<11&&(tt="userfield"+(t+1).toString(),n.ParametersList[paramArray].Name===tt&&(h.split(",")[t]===undefined||h.split(",")[t]===null||(i=h.split(",")[t]),n.ParametersList[paramArray].Value=i),t++);b=$("#selectorUniversal").dxDataGrid("instance");b.selectRows(h.split(","),!0)}}else h="",u===null&&(c=n.ParametersList.find(n=>n.Name===r[t].Name).Value,c!==undefined&&c!==""&&(h=c),h===""&&(u===undefined||u===null)||(b=$("#selectorUniversal").dxDataGrid("instance"),b.selectRows(h.split(","),!0)));break;case"selectorConcepts":if(h="",u===null&&(c=n.ParametersList.find(n=>n.Name===r[t].Name).Value,c!==undefined&&c!==""&&(h=c)),h!==""||!(u===undefined||u===null)){u===undefined||u===null||(h=u);let i=0,t=0;for(paramArray in n.ParametersList)i=0,n.ParametersList[paramArray].Type==="Robotics.Base.conceptIdentifier"&&t<16&&(it="concept"+(t+1).toString(),n.ParametersList[paramArray].Name===it&&(h.split(",")[t]===undefined||h.split(",")[t]===null||(i=h.split(",")[t]),n.ParametersList[paramArray].Value=i),t++);typeof h=="object"&&(h=h.Value);document.getElementById("selecttionItemsConcepts").innerText=h;nr&&h&&$("#listConcepts").dxList("instance").option("selectedItemKeys",h.split(","));gi&&(document.getElementById("selecttionItemsGroups").innerText=$("#listGroupsConcepts").dxList("instance").option("selectedItemKeys").join(","))}break;case"selectorCauses":if(h="",u===null&&(c=n.ParametersList.find(n=>n.Name===r[t].Name).Value,c!==undefined&&c!==""&&(h=c)),h!==""||!(u===undefined||u===null)){u===undefined||u===null||(h=u);let i=0,t=0;for(paramArray in n.ParametersList)i=0,n.ParametersList[paramArray].Type==="Robotics.Base.causeIdentifier"&&t<11&&(rt="cause"+(t+1).toString(),n.ParametersList[paramArray].Name===rt&&(h.split(",")[t]===undefined||h.split(",")[t]===null||(i=h.split(",")[t]),n.ParametersList[paramArray].Value=i),t++);if(document.getElementById("selecttionItemsCauses").innerText=h,tr)try{$("#listCauses").dxList("instance").option("selectedItemKeys",h.split(","))}catch{}}break;case"selectorFormat":s.format=$("#typeDocReport").dxSelectBox("instance").option("value");switch(u){case"format":s.format=e;planificationsTab.classList.contains("activeTab")&&$("#typeDocReport").dxSelectBox("instance").option("value",e)}h=s;break;case"selectorViewFormat":s.ckDetail=$("#ckAllDetails").dxCheckBox("instance").option("value");s.ckTotal=$("#ckTotals").dxCheckBox("instance").option("value");s.ckShowChart=$("#ckShowChart").dxCheckBox("instance").option("value");switch(u){case"detail":s.ckDetail=e;break;case"total":s.ckTotal=e;break;case"chart":s.ckShowChart=e}h=s;break;case"selectorAccessType":s.ckValids=$("#ckValids").dxCheckBox("instance").option("value");s.ckInvalids=$("#ckInvalids").dxCheckBox("instance").option("value");switch(u){case"valids":s.ckValids=e;break;case"invalids":s.ckInvalids=e}h=s;break;case"selectorProfileTypes":s.profileTypes=u=="profileTypes"?e:$("#profileTypes").dxRadioGroup("instance").option("value");s.criterio=u=="criterio"?e:$("#criterio").dxSelectBox("instance").option("value");s.tipoValorCriterio=u=="tipoValorCriterio"?e:$("#tipoValorCriterio").dxSelectBox("instance").option("value");s.valorCriterio=u=="valorCriterio"?e:ei;s.valorFichaCriterio=u=="valorFichaCriterio"?e:$("#valorFichaCriterio").dxSelectBox("instance").option("value");s.rangoCriterio=u=="rangoCriterio"?e:$("#rangoCriterio").dxSelectBox("instance").option("value");["selectConcepts","selectCauses","selectIncidences"].map(n=>s[n]=$("#"+n).dxTagBox("instance")?$("#"+n).dxTagBox("instance").option("value"):"");h=s;let k,st=0,ht=0,ct=0;for(paramArray in n.ParametersList){k=null;switch(n.ParametersList[paramArray].Name){case"PTTipoCriterio":k=s.profileTypes;break;case"PTRangoCriterio":k=s.rangoCriterio;break;case"PTTipoValorCriterio":k=s.tipoValorCriterio;break;case"PTValorCriterio":k=s.valorCriterio!==undefined&&s.valorCriterio.length==5?s.valorCriterio.slice(0,3)+":"+s.valorCriterio.slice(3):s.valorCriterio;break;case"PTValorFichaCriterio":k=s.valorFichaCriterio;break;case"PTCriterio":k=s.criterio;break;case"PTConcepts":s.selectConcepts!==undefined&&(k=typeof s.selectConcepts[0]=="object"&&s.selectConcepts[0].value!==undefined?s.selectConcepts.map(n=>n.value).join(","):s.selectConcepts.join(","));break;case"PTCauses":s.selectCauses!==undefined&&(k=typeof s.selectCauses[0]=="object"&&s.selectCauses[0].value!==undefined?s.selectCauses.map(n=>n.value).join(","):s.selectCauses.join(","));break;case"PTIncidences":s.selectIncidences!==undefined&&(k=typeof s.selectIncidences[0]=="object"&&s.selectIncidences[0].value!==undefined?s.selectIncidences.map(n=>n.value).join(","):s.selectIncidences.join(","));break;default:k=null}if(n.ParametersList[paramArray].Type==="Robotics.Base.conceptIdentifier"&&st<11){let i="concept"+(st+1).toString(),t=null;s.selectConcepts!==undefined&&(t=typeof s.selectConcepts[0]=="object"&&s.selectConcepts[0].value!==undefined?s.selectConcepts[st]?.value:s.selectConcepts[st]);n.ParametersList[paramArray].Name===i&&(k=t===undefined||t===null?"-1":t);st++}else if(n.ParametersList[paramArray].Type==="Robotics.Base.causeIdentifier"&&ht<11){let i="cause"+(ht+1).toString(),t=null;s.selectCauses!==undefined&&(t=typeof s.selectCauses[0]=="object"&&s.selectCauses[0].value!==undefined?s.selectCauses[ht]?.value:s.selectCauses[ht]);n.ParametersList[paramArray].Name===i&&(k=t===undefined||t===null?"-1":t);ht++}else if(n.ParametersList[paramArray].Type==="Robotics.Base.incidenceIdentifier"&&ct<11){let i="incidence"+(ct+1).toString(),t=null;s.selectIncidences!==undefined&&(t=typeof s.selectIncidences[0]=="object"&&s.selectIncidences[0].value!==undefined?s.selectIncidences[ct]?.value:s.selectIncidences[ct]);n.ParametersList[paramArray].Name===i&&(k=t===undefined||t===null?"-1":t);ct++}k!==null&&(n.ParametersList[paramArray].Value=k)}break;case"selectorCausesRegistroJL":s.showCauses=u=="showCauses"?e:$("#showCauses").dxRadioGroup("instance").option("value");["selectCauses"].map(n=>s[n]=$("#"+n).dxTagBox("instance")?$("#"+n).dxTagBox("instance").option("value"):"");h=s;let ft,vt=0;for(paramArray in n.ParametersList){switch(n.ParametersList[paramArray].Name){case"PTShowCauses":ft=s.showCauses;break;case"PTCauses":s.selectCauses!==undefined&&(ft=Array.isArray(s.selectCauses)?s.selectCauses.length>0&&typeof s.selectCauses[0]=="object"&&s.selectCauses[0].value!==undefined?s.selectCauses.map(n=>n.value).join(","):s.selectCauses.join(","):s.selectCauses.toString());break;default:ft=null}if(n.ParametersList[paramArray].Type==="Robotics.Base.causeIdentifier"&&vt<11){let i="cause"+(vt+1).toString(),t=s.selectCauses!==undefined?s.selectCauses.map(n=>n.value)[vt]:null;n.ParametersList[paramArray].Name===i&&(ft=t===undefined||t===null?"-1":t);vt++}ft!==null&&(n.ParametersList[paramArray].Value=ft)}break;case"selectorConceptsRegistroJL":s.showConcepts=u=="showConcepts"?e:$("#showConcepts").dxRadioGroup("instance").option("value");["selectConcepts"].map(n=>s[n]=$("#"+n).dxTagBox("instance")?$("#"+n).dxTagBox("instance").option("value"):"");h=s;let et,pt=0;for(paramArray in n.ParametersList){switch(n.ParametersList[paramArray].Name){case"PTShowConcepts":et=s.showConcepts;break;case"PTConcepts":s.selectConcepts!==undefined&&(et=Array.isArray(s.selectConcepts)&&s.selectConcepts.length>0?typeof s.selectConcepts[0]=="object"&&s.selectConcepts[0].value!==undefined?s.selectConcepts.map(n=>n.value).join(","):s.selectConcepts.join(","):"");break;default:et=null}if(n.ParametersList[paramArray].Type==="Robotics.Base.causeIdentifier"&&pt<11){let i="concept"+(pt+1).toString(),t=s.selectConcepts!==undefined?s.selectConcepts.map(n=>n.value)[pt]:null;n.ParametersList[paramArray].Name===i&&(et=t===undefined||t===null?"-1":t);pt++}et!==null&&(n.ParametersList[paramArray].Value=et)}break;case"selectorYearAndMonth":s.month=u=="month"?e:$("#month").dxSelectBox("instance").option("value");s.year=u=="year"?e:$("#year").dxSelectBox("instance").option("value");for(paramArray in n.ParametersList)l=n.ParametersList[paramArray].Name,l=="month"?n.ParametersList[paramArray].Value=ru(s[l]):l=="year"&&(n.ParametersList[paramArray].Value=yt(s[l],s.month));h=s;break;case"selectorBetweenYearAndMonth":s.monthStart=u=="monthStart"?e:$("#monthStart").dxSelectBox("instance").option("value");s.yearStart=u=="yearStart"?e:$("#yearStart").dxSelectBox("instance").option("value");s.monthEnd=u=="monthEnd"?e:$("#monthEnd").dxSelectBox("instance").option("value");s.yearEnd=u=="yearEnd"?e:$("#yearEnd").dxSelectBox("instance").option("value");h=s;for(paramArray in n.ParametersList)l=n.ParametersList[paramArray].Name,l=="monthStart"||l=="monthEnd"?n.ParametersList[paramArray].Value=ru(s[l]):l=="yearStart"?n.ParametersList[paramArray].Value=yt(s[l],s.monthStart):l=="yearEnd"&&(n.ParametersList[paramArray].Value=yt(s[l],s.monthEnd));break;case"selectorFilterValues":var u=u,e=e,a="",v="";s.optionFilterValues=u===null?document.getElementById("optionFilter").value:$("#titleFilterValues").dxCheckBox("instance").option("value");s.typeFilterSince=$("#typeFilterMin").dxSelectBox("instance").option("value");s.typeFilterTo=$("#typeFilterMax").dxSelectBox("instance").option("value");s.typeFilterSince==="text"?(a=$("#valueTextMin").dxNumberBox("instance").option("value"),a=a===undefined?"0":a,v=$("#valueTextMinDec").dxNumberBox("instance").option("value"),v=v===undefined?"00":v,s.valueSince=a+":"+v):s.valueSince=$("#valueFieldsMin").dxSelectBox("instance").option("value");s.typeFilterTo==="text"?(a=$("#valueTextMax").dxNumberBox("instance").option("value"),a=a===undefined?"0":a,v=$("#valueTextMaxDec").dxNumberBox("instance").option("value"),v=v===undefined?"00":v,s.valueTo=a+":"+v):s.valueTo=$("#valueFieldsMax").dxSelectBox("instance").option("value");switch(u){case"titleFilterValues":s.optionFilterValues=e;break;case"typeFilterMin":s.typeFilterSince=e;e==="text"?s.valueSince=$("#valueTextMin").dxNumberBox("instance").option("value"):e==="field"&&(s.valueSince=$("#valueFieldsMin").dxSelectBox("instance").option("value"));break;case"valueTextMin":a=$("#valueTextMinDec").dxNumberBox("instance").option("value");s.valueSince=e+":"+a;break;case"valueTextMinDec":a=$("#valueTextMin").dxNumberBox("instance").option("value");s.valueSince=a+":"+e;break;case"valueFieldsMin":s.valueSince=e;break;case"typeFilterMax":s.typeFilterTo=e;e==="text"?s.valueTo=$("#valueTextMax").dxNumberBox("instance").option("value"):e==="field"&&(s.valueTo=$("#valueFieldsMax").dxSelectBox("instance").option("value"));break;case"valueTextMax":v=$("#valueTextMaxDec").dxNumberBox("instance").option("value");s.valueTo=e+":"+v;break;case"valueTextMaxDec":a=$("#valueTextMax").dxNumberBox("instance").option("value");s.valueTo=a+":"+e;break;case"valueFieldsMax":s.valueTo=e}document.getElementById("optionFilter").value=s.optionFilterValues;h=s;break;case"selectorTasks":ut=document.getElementById("hdnTasksSelected");h=u!=""?e!=""?u+","+e:u:e;ut.value=h;break;case"selectorProjectsVSL":s.startProject=u=="startProject"?e:$("#startProject").dxNumberBox("instance").option("value");s.endProject=u=="endProject"?e:$("#endProject").dxNumberBox("instance").option("value");for(paramArray in n.ParametersList)l=n.ParametersList[paramArray].Name,l=="startProject"?n.ParametersList[paramArray].Value=$("#startProject").dxNumberBox("instance").option("value"):l=="endProject"&&(n.ParametersList[paramArray].Value=$("#endProject").dxNumberBox("instance").option("value"));h=s}d.Value=h};window.preventDefaultOnSubmit=n=>n.preventDefault();window.pushPreviowsParamsDestination=()=>{const n=i.PlannedExecutionsList.findIndex(n=>n.Id===$("#reportPlannedList").dxDataGrid("instance").option("focusedRowKey"));frmAddDestinationV2_Show(iu)};window.GetSelectedTreeTask=(n,t)=>{collectParamValues(n,t)};const ru=n=>{let t=0;const i=g.getMonth();switch(n){case gt:case ot:t=i+1;break;case ni:case st:t=i==0?12:i;break;case ti:case ht:t=i==11?1:i+2;break;default:t=n}return t},yt=(n,t)=>{let i=0;const r=g.getFullYear();switch(t){case ot:case gt:i=r;break;case st:case ni:i=g.getMonth()==0?r-1:r;break;case ht:case ti:i=g.getMonth()==11?r+1:r;break;default:i=n}return i},rt=async()=>{var t,r;const s=document.querySelector("#planificationsTab"),i=document.querySelector("#mainPanelDisplay"),f=document.createElement("div");document.querySelector("#plannerPage")&&document.querySelector("#plannerPage").remove();s.classList.contains("activeTab")&&(document.querySelector("#reportExecContainer").style="display:none",document.querySelector("#reportConfigContainer").style="display:none");f.setAttribute("id","plannerPage");f.innerHTML=await p("plannerPage");[...i.querySelectorAll("#reportConfigContainer, #reportExecContainer"),].map(n=>n.style.display="none");const e=i.querySelector("#plannerPage");e&&e.remove();i.insertBefore(f,i.firstChild);const h=i.querySelector("#reportPlannedList");u.planifications(h);f.style.display="block";const o=[...document.querySelectorAll(".switchMainViewTabs .viewTab")];if(o.map(n=>n.classList.remove("activeTab")),o.find(n=>n.getAttribute("id")==="planificationsTab").classList.add("activeTab"),t="imagePlanReport"+n.Id,document.getElementById(t)!==null){while(document.getElementById(t).childNodes[0]!==undefined)document.getElementById(t).removeChild(document.getElementById(t).childNodes[0]);n.PlannedExecutionsList.length>0&&(r=document.createElement("img"),r.setAttribute("src",BASE_URL+"Base/Images/StartMenuIcos/Events.png"),r.setAttribute("readonly","true"),r.setAttribute("width","16px"),document.getElementById(t).appendChild(r))}},ch=async t=>{const i=document.querySelector("#mainPanelDisplay #plannerPage"),r=await p("switchMainViewTabs");!!i&&i.remove();t.innerHTML=r;await ut(n.Id);const u=document.querySelector(".reportCard.reportCardClicked");u.click()};const eu=()=>{const n=[...document.querySelectorAll(".reportCard li.lastExecution"),];u.lastExecutions(n)};const su=(n=false)=>{const t=$("#reportCategoriesBtn"),i=$("#reportCategoriesInnerScope");if(!!$("#reportCategoriesInnerScope").length)if(ct=n?!0:ct,ct){const n=document.querySelector("#surrounder");n!==null&&n.remove();t.removeClass("reportTagsBtnActive");i.removeClass("active");t.find(".fa.fa-caret-down.fa-caret-downDroped").removeClass("fa-caret-downDroped");lt.classList.remove("menuCategoriesDisplayed")}else{t.addClass("reportTagsBtnActive");t.find(".fa.fa-caret-down").addClass("fa-caret-downDroped");i.addClass("active");lt.classList.add("menuCategoriesDisplayed");const n=document.createElement("div");n.setAttribute("id","surrounder");lt.parentNode.appendChild(n);n.addEventListener("click",ou,!1)}ct=!ct};const vc=n=>new Promise(t=>setTimeout(t,n)),pt=async i=>{var l,a,w,v,nt,b,e,g;if(i!=undefined)if(l=n.ParametersList,planificationsTab.classList.contains("activeTab")){if(v=n.PlannedExecutionsList.findIndex(n=>n.Id===$("#reportPlannedList").dxDataGrid("instance").option("focusedRowKey")),nt=n.PlannedExecutionsList[v].Id==="newPlanification",v>=0&&!nt&&(w=n.PlannedExecutionsList[v].ParametersJson),w!=undefined)for(cd in l)a=JSON.parse(w).find(n=>n.TemplateName===l[cd].TemplateName&&n.Name===l[cd].Name),a!=undefined&&(l[cd].Value=a.Value)}else if(b=n.LastParameters,b!=undefined)for(cd in l)a=JSON.parse(b).find(n=>n.TemplateName===l[cd].TemplateName&&n.Name===l[cd].Name),a!=undefined&&(l[cd].Value=a.Value);r=n.ParametersList.filter(n=>n.TemplateName!=="hidden");const tt=n.ParametersList.filter(n=>n.TemplateName==="hidden");if(!r||r.length<1){hu(!!tt&&tt);return}for(let n=0;n<r.length;n++)if(r[n].TemplateName=="selectorEmployees"){if(sessionStorage.ReportEmployees_hdnNodes=r[n].Value,typeof i!="undefined"){await getroTreeState("objContainerTreeV3_treeEmployeesReportExecution").then(n=>n.reset());await getroTreeState("objContainerTreeV3_treeEmployeesReportExecutionGrid").then(n=>n.reset());let t=r[n].Value.split("@"),e=t[0],u="11110",f="";t.length>=2&&(u=t[1],f=t[2]);let i=await getroTreeState("objContainerTreeV3_treeEmployeesReportExecutionGrid",!0);await i.setLocalData(e,"","","","");i=await getroTreeState("objContainerTreeV3_treeEmployeesReportExecution",!0);await i.setLocalData("","","",u,f)}}else if(r[n].TemplateName=="selectorTasks"&&typeof i!="undefined"){await getroTreeState("objContainerTreeV3_treeTaskReportProfile").then(n=>n.reset());let f=r[n].Value.split("@"),t=f[0].split(","),i=[],u=[];for(let n=0;n<t.length;n++)isNaN(parseInt(t[n],10))?u.push(t[n]):i.push(t[n]);let e=await getroTreeState("objContainerTreeV3_treeTaskReportProfile",!0);await e.setLocalData(i.join(","),u.join(","),"","","")}const c=document.querySelector("#fieldsEditor");c.style.display="";n.Name=="cumplen criterio"&&(c.style.width="40vw",c.style.left="30vw",c.style.minWidth="800px");const it=t===0,ut=t===r.length-1,ft=await p(r[t].TemplateName);if(it){const n=await p("selectorTitle");c.innerHTML=n}const et=c.querySelector("#parametersTitle #parametersCounter");et.innerText=`${t+1}`;const ot=c.querySelector("#parametersTitle #parametersCounterTotal");ot.innerText=`${r.length}`;const st=c.querySelector("span#parametersName > b"),ht=o.translateParamName(r[t]);if(st.innerText=ht,c.innerHTML+=ft,it){const n=await p("editViewBtns");c.innerHTML+=n}const y=c.querySelector(".editViewBtns"),k=y.querySelector("#acceptEdition"),ct=y.querySelector("#cancelEdition"),d=y.querySelector("#nextEdition"),rt=y.querySelector("#previousEdition");ut?(k.parentElement.style.display="",d.parentElement.style.display="none"):(k.parentElement.style.display="none",d.parentElement.style.display="",d.parentElement.addEventListener("click",f.nextEdition,!1));t!==0&&(rt.parentElement.style.display="",rt.parentElement.addEventListener("click",f.previousEdition,!1));k.parentElement.addEventListener("click",()=>{f.acceptExecutionParams(),s&&(t=0)},!1);ct.parentElement.addEventListener("click",()=>{f.cancelEdition(),t=0},!1);let h=r[t].TemplateName;switch(h){case"selectorViewFormat":e=mainPanelDisplay.querySelector("#"+h);u.selectorViewFormat(e);break;case"selectorAccessType":e=mainPanelDisplay.querySelector("#"+h);u.selectorAccessType(e);break;case"selectorProfileTypes":e=mainPanelDisplay.querySelector("#"+h);u.selectorProfileTypes(e);break;case"selectorConceptsRegistroJL":e=mainPanelDisplay.querySelector("#"+h);u.selectorConceptsRegistroJL(e);break;case"selectorCausesRegistroJL":e=mainPanelDisplay.querySelector("#"+h);u.selectorCausesRegistroJL(e);break;case"selectorYearAndMonth":e=mainPanelDisplay.querySelector("#"+h);u.selectorYearAndMonth(e);break;case"selectorBetweenYearAndMonth":e=mainPanelDisplay.querySelector("#"+h);u.selectorBetweenYearAndMonth(e);break;case"selectorFormat":e=mainPanelDisplay.querySelector("#"+h);u.selectorFormat(e);break;case"selectorFilterValues":e=mainPanelDisplay.querySelector("#"+h);u.selectorFilterValues(e);break;case"selectorDate":e=mainPanelDisplay.querySelector("#"+h);u.selectorDate(e);break;case"selectorProjectsVSL":e=mainPanelDisplay.querySelector("#"+h);u.selectorProjectsVSL(e);break;default:g=document.querySelector("#editView>Form").getAttribute("id");u[g]!==undefined&&u[g]()}bh(h)};const ah=n=>{v.map(n=>{n.classList.remove("reportCardClicked");const t=n.querySelector(".reportExecution.executiuonIsFine > i");t&&t.classList.remove("active")}),n.addClass("reportCardClicked"),n.find(".reportExecution.executiuonIsFine > i").addClass("active")},vh=async()=>{const r=await p("nameClonedReport"),t=document.querySelector("#fieldsEditor");t.style.height="150px";t.style.display="flex";t.style.justifyContent="center";t.style.flexFlow="column nowrap";t.innerHTML=r;const i=$("#clonedReportInput").dxTextBox({placeholder:sf,width:350}).dxValidator({validationRules:[{type:"required",message:"Debes informar el nombre del informe"}]});t.querySelector("#acceptEdition").parentNode.addEventListener("click",async()=>{const t=i.dxValidator("instance").validate();if(t.isValid){const t=i.dxTextBox("instance").option("value"),r=await nc(n.Id,t);r?(f.hideEditor(),ir(),o.searchInCardsPanel(t,!0)):DevExpress.ui.dialog.alert(cf,gu)}},!1);t.querySelector("#cancelEdition").parentNode.addEventListener("click",()=>{f.hideEditor()},!1)},lu=(n,t,i)=>{const r=document.querySelector("#divTree");i?(r.style.display="none",n.style.display="none",t.style.display=""):(r.style.display="",t.style.display="none",n.style.display="")},ut=async t=>{const tt=document.querySelector("#reportConfigContainer .executionActions");await u.reportActions(tt,"listTabReportActions");const ft=tt.querySelector("#triggerExecutionBtn"),b=document.querySelector("#treeShrinkBtn"),k=document.querySelector("#treeExpandBtn"),h=document.querySelector("#reportEditBtn"),c=document.querySelector("#reportCreateBtn"),l=document.querySelector("#reportRemoveBtn"),a=document.querySelector("#reportCloneBtn"),d=document.querySelector("#generalTab"),g=document.querySelector("#planificationsTab"),v=document.querySelector("#reportAddPlanificationBtn"),p=b.cloneNode(!0),w=k.cloneNode(!0),r=h&&h.cloneNode(!0),nt=c&&c.cloneNode(!0),e=l&&l.cloneNode(!0),s=a&&a.cloneNode(!0),it=d.cloneNode(!0),ut=g.cloneNode(!0),y=v&&v.cloneNode(!0);b.parentNode.replaceChild(p,b);k.parentNode.replaceChild(w,k);h&&h.parentNode.replaceChild(r,h);c&&c.parentNode.replaceChild(nt,c);l&&l.parentNode.replaceChild(e,l);a&&a.parentNode.replaceChild(s,a);d.parentNode.replaceChild(it,d);g.parentNode.replaceChild(ut,g);v&&v.parentNode.replaceChild(y,v);ft.addEventListener("click",()=>{i={...n},pt()},!1);e&&e.addEventListener("click",lh,!1);s&&s.addEventListener("click",vh,!1);it.addEventListener("click",()=>{ch(document.querySelector(".switchMainViewTabs"))},!1);ut.addEventListener("click",rt,!1);y&&y.addEventListener("click",async()=>{await rt(),f.addPlanification(document.querySelector("#reportPlannedList"))},!1);p.addEventListener("click",()=>{lu(p,w,!0)},!1);w.addEventListener("click",()=>{lu(p,w,!1)},!1);nt&&(nt.style.display="");n.Permissions.Remove&&o.permissionsOverUser(9)?e&&(e.style.display=""):e&&(e.style.display="none");n.Permissions.Edit?(r&&(r.style.display=""),r&&r.setAttribute("href",`javascript:openDesignerLink(/OpenReportDesigner/,${t})`)):r&&(r.style.display="none");y&&(y.style.display="");n.IsEmergencyReport?s&&(s.style.display="none"):s&&(s.style.display="")},yc=(n,t)=>"0".repeat(t-n.toString().length)+n.toString();const au=async()=>{const t=[...n.ExecutionsList.filter(n=>n.Status===1),];await t.map(async()=>{status!==1&&(await hi(n.Id),er(n),u.singleCard(document.querySelector(".reportCard.reportCardClicked"),n))});t.length>0&&setTimeout(au,3e3)},hi=async t=>{let r;await $.ajax({url:`${BASE_URL}Report/GetReportByIdAsJson`,data:{reportId:t},type:"POST",dataType:"json",success:n=>r=n,error:n=>console.error(n)});n=o.viewFieldsToParsed(r);i&&i?.Id==n?.Id||(i={...n});window.currentReportData=n},dh=async n=>{let t;return await $.ajax({url:`${BASE_URL}Report/GetExportDataAndExtension`,data:{executionId:n},type:"POST",xhrFields:{responseType:"blob"},success:n=>{t=n},error:()=>{}}),t},vu=async(n,t,i)=>{let r;return await $.ajax({url:`${BASE_URL}Report/TriggerExecution`,data:{reportId:n,reportParameters:t,viewFields:i},type:"POST",dataType:"json",success:n=>r=n,error:n=>console.error(n)}),r},pc=async n=>{let t;return await $.ajax({url:`${BASE_URL}Report/GetExecutionStatus`,data:{executionId:n},type:"POST",dataType:"json",success:n=>t=n,error:n=>console.error(n)}),t},gh=async()=>{let n;return await $.ajax({url:`${BASE_URL}Report/GetAllLanguages`,data:{},type:"POST",dataType:"json",success:t=>n=t,error:()=>{}}),n},nc=async(n,t)=>{let i;return await $.ajax({url:`${BASE_URL}Report/CopyReport`,data:{reportId:n,newReportName:t},type:"POST",dataType:"text",success:n=>i=n,error:()=>{}}),i==="True"},yu=async(n,t,i)=>{let r;return await $.ajax({url:`${BASE_URL}Report/UpdateReportCategories`,data:{reportId:n,categoryId:t,categoryLevel:i},type:"POST",dataType:"text",success:n=>r=n,error:()=>{}}),r==="True"},tc=async()=>{let n;return await $.ajax({url:`${BASE_URL}Report/GetReportsPageConfiguration`,data:{},type:"POST",dataType:"json",success:t=>n=t,error:n=>console.error(n)}),n},ic=async()=>{let n;return await $.ajax({url:`${BASE_URL}Report/GetUserPassportID`,data:{},type:"POST",dataType:"json",success:t=>n=t,error:n=>console.error(n)}),n},rc=async()=>{let n;return await $.ajax({url:`${BASE_URL}Report/GetUsers`,data:{},type:"POST",dataType:"json",success:t=>n=t,error:n=>console.error(n)}),n},y=async t=>{let i;return await $.ajax({url:`${BASE_URL}Report/GetSelectorUniversalParamOptions`,data:{paramType:t,isEmergencyReport:n.IsEmergencyReport},type:"POST",dataType:"json",success:n=>i=n,error:n=>console.error(n)}),i},uc=async(n,t="report")=>{t!="report"&&(n.LayoutXMLBinary="",n.LayoutPreviewXMLBinary="");const r=JSON.stringify(o.viewFieldsToString(n));let i;return await $.ajax({url:`${BASE_URL}Report/SaveReportInfo`,data:{reportData:r,flag:t},type:"POST",dataType:"text",success:n=>i=n,error:n=>console.error(n)}),i==="True"},fc=async n=>{let t;return await $.ajax({url:`${BASE_URL}Report/DeleteReportLayout`,data:{reportId:n},type:"POST",dataType:"text",success:n=>t=n,error:n=>console.error(n)}),t=t==="False"?!1:!0},p=async(t="editReportViewers",i=n.Id)=>{let r;return await $.ajax({url:`${BASE_URL}Report/GetViewTemplate`,data:{templateName:t,idreport:i},type:"POST",dataType:"html",success:n=>r=n,error:n=>console.error(n)}),r},u={singleCard:(n,t)=>{const u=n.querySelector("li.lastExecution span");let i=n.querySelector("span.descriptionText"),r=n.querySelector("span.categoryText");const f=n.querySelector(".fa.fa-download");if(!i&&t.Description){const t=document.createElement("div");i=document.createElement("span");t.classList.add("reportDescription");i.classList.add("descriptionText");t.appendChild(i);n.querySelector(".reportCardInfo").appendChild(t)}if(!r&&t.CategoriesString){const t=document.createElement("div");r=document.createElement("span");t.classList.add("reportCategories");r.classList.add("categoryText");t.appendChild(r);n.querySelector(".reportCardInfo").appendChild(t)}if(t.LastExecution){if(u.parentNode.classList.add("reportExecution","executiuonIsFine"),u.innerText=o.getStringDate(new Date(t.LastExecution.ExecutionDate),!0),!f){const t=o.iElementFontAwesome("fa fa-download");t.classList.add("active");n.querySelector("li.lastExecution").insertBefore(t,u);t.addEventListener("click",si,!1)}}else u.innerText=pu,f&&f.remove();i&&(i.innerText=t.Description.replace(/\n/g," "));r&&(r.innerText=t.CategoriesString.replace("ǁ","")||"")},reportActions:async(n,t)=>{const i=await p(t);n.innerHTML=i},editReportViewers:async n=>{const u=await rc().then(n=>n.map(n=>({PassportId:n.ID,Name:n.Name}))),t=n.querySelector("ul#viewersList"),r=t.querySelector("datalist#adminusers");[...t.querySelectorAll("li[data-passportid]")].map(n=>n.remove());i.Viewers.map(n=>{const i=document.createElement("li");i.setAttribute("data-passportid",n.PassportId);i.innerText=n.Name;i.append(o.iElementFontAwesome("fa fa-minus-circle"));t.append(i);i.addEventListener("click",()=>f.removeViewer(n.PassportId),!1)});r.innerHTML="";u.map(n=>{const t=document.createElement("option");t.value=n.Name;t.setAttribute("data-userid",n.ID);r.append(t)});t.append(r);t.querySelector("i#addViewerBtn").addEventListener("click",f.addViewer,!1)},editReportDescription:n=>{const t=n.querySelector("textarea#descriptionEdition");t.value=i.Description;t.addEventListener("change",()=>f.description(t.value),!1)},reportLayoutInfo:(n,t)=>{const s=t.querySelector("p span#reportTitle"),h=t.querySelector("p span#reportDescription"),c=t.querySelector("p span#reportCreationDate"),e=t.querySelector("p span#reportCreationAuthor"),p=t.querySelector(".reportCategories .categoryTextEditable"),o=t.querySelector(".reportCategories .categoryText"),l=t.querySelector(".reportCategories .levelText"),i=new Date(n.CreationDate);s.innerText=n.DisplayName||"";h.innerText=n.Description;c.innerText=`${i.getDate()}-${i.getMonth()+1}-${i.getFullYear()} ${i.getHours()}:${i.getMinutes()<10?"0":""}${i.getMinutes()}`;e.innerHTML=n.CreatorName||"<b style='color:#FF5C35'>Robotics<\/b>";e.setAttribute("data-author-id",n.CreatorPassportId);var f=n.CategoriesList&&n.CategoriesList.map(n=>n.ID).join(", "),a=n.CategoriesList&&n.CategoriesList.map(n=>n.Description).join(", "),r=n.CategoriesList&&n.CategoriesList.map(n=>n.CategoryLevel).join(", "),v=window.currentReportData.CreatorPassportId===di,y=v;o&&(y?(document.getElementById("listCategoryEditable").style.display="",document.getElementById("levelCategoryEditable").style.display="",document.getElementById("listCategory").style.display="none",document.getElementById("levelCategory").style.display="none",f=parseInt(f.split(",")),r=parseInt(r.split(",")),u.listCategories(f,r)):(document.getElementById("listCategory").style.display="",document.getElementById("levelCategory").style.display="",document.getElementById("listCategoryEditable").style.display="none",document.getElementById("levelCategoryEditable").style.display="none",o.innerText=a,l.innerText=r))},executionsList:(t,i,r)=>{for([...t.querySelectorAll("li")].map(n=>n.remove());i.length>3;)i.pop();!n||i.map(n=>{const i=document.createElement("li"),s=document.createElement("span"),r=document.createElement("div"),h=new Date(n.ExecutionDate),{statusClass:c,iconClass:l}=o.getExecutionStatusClasses(n.Status),u=o.iElementFontAwesome(l),e=o.iElementFontAwesome("fa fa-trash");i.classList.add("reportExecution",c);s.innerText=o.getStringDate(h);r.classList.add("executionIcon");r.style.backgroundImage=`url("Base/Images/file.png")`;u.setAttribute("data-guid",n.Guid);e.setAttribute("id","removeExecBtn");u.setAttribute("id","downloadExecBtn");i.appendChild(e);r.appendChild(u);i.appendChild(r);i.appendChild(s);t.appendChild(i);u.addEventListener("click",si,!1);e.addEventListener("click",()=>{f.removeExecution(i)},!1)});const u=[...r.querySelectorAll(".reportExecution.executionIsInProgress"),],e=[...r.querySelectorAll(".reportExecution.executionIsFuture"),],s=[...r.querySelectorAll(".reportExecution.executionIsError"),],h=[...r.querySelectorAll(".reportExecution.executiuonIsFine"),];u.map(n=>{!n.querySelector(".executionIcon")&&n.querySelector(".executionIcon").appendChild(o.iElementFontAwesome("fa fa-spinner"));const t=n.querySelector(".fa.fa-spinner");t.style.opacity=".8";t.style.color="#FF5C35"});e.map(n=>{!n.querySelector("i")&&n.querySelector("span").before(o.iElementFontAwesome("fa fa-hourglass-o"))});s.map(n=>{!n.querySelector(".executionIcon")&&n.querySelector(".executionIcon").appendChild(o.iElementFontAwesome("fa fa-times"));const t=n.querySelector(".fa.fa-times");t.style.opacity=".8";t.style.color="tomato"});h.map(n=>{!n.querySelector(".executionIcon")&&n.querySelector(".executionIcon").appendChild(o.iElementFontAwesome("fa fa-download"));const t=n.querySelector(".fa.fa-download");t.setAttribute("id","downloadExecBtn");t.addEventListener("click",si,!1)})},categoryTreeReport:(n,t)=>{DevExpress.ui.dxTreeList.getInstance($(n))!=undefined,$(n).dxTreeList({dataSource:t.map(n=>({...n,ID:n.ID+1})),keyExpr:"ID",columns:[{dataField:"Description",caption:"Categorías"},],onCellClick:()=>{},scrolling:{showScrollbar:"Never"},expandedRowKeys:[1],showRowLines:!0,showBorders:!0,columnAutoWidth:!0})},categoryTreeMenu:(n,t)=>{DevExpress.ui.dxTreeList.getInstance($(n))!=undefined&&$(n).dxTreeList("dispose"),$(n).dxTreeList({dataSource:t.map(n=>({...n,ID:n.ID+1})),keyExpr:"ID",columns:[{dataField:"Description"},],onCellClick:function(n){wh(n.data);su(!0)},scrolling:{showScrollbar:"Never"},expandedRowKeys:[1],showRowLines:!0,showBorders:!0,columnAutoWidth:!0})},listCategories:(t,i)=>{var r=JSON.parse(document.querySelector("#reportCategoryTree>p").innerText);$("#listCategoryEditable").dxSelectBox({dataSource:new DevExpress.data.ArrayStore({data:r,key:"Description"}),width:"200px",displayExpr:"Description",valueExpr:"ID",value:t,readOnly:!1,visible:!0,placeholder:"...",onValueChanged:function(t){var r=n.Id,i=$("#levelCategoryEditable").dxSelectBox("instance").option("value");i===""&&(i="1",$("#levelCategoryEditable").dxSelectBox("instance").option("value",1));yu(n.Id,t.value,i)}});$("#levelCategoryEditable").dxSelectBox({dataSource:new DevExpress.data.ArrayStore({data:eh,key:"Description"}),width:"200px",displayExpr:"Description",valueExpr:"value",value:i,readOnly:!1,visible:!0,placeholder:"...",onValueChanged:function(t){var r=n.Id,i=$("#listCategoryEditable").dxSelectBox("instance").option("value");i!==""&&yu(n.Id,i,t.value)}})},lastExecutions:n=>{n.map(n=>{const u=parseInt(n.getAttribute("data-status"),10),t=n.querySelector("i"),{statusClass:i,iconClass:r}=o.getExecutionStatusClasses(u);if(!!r&&!!i){const u=o.iElementFontAwesome(r);u.addEventListener("click",si,!1);n.classList.add("reportExecution",i);!t||t.remove();n.insertBefore(u,n.querySelector("span"))}})},scrollTransparencyLayer:n=>{const t=document.createElement("div"),i=n.parentNode;return t.classList.add("scrollPanelLayer"),i.appendChild(t),i.style.verticalAlign="top",i.style.position="relative",t},blurAllTabs:()=>{[...ui].map(n=>n.style.display="none")},blurAnyReportCard:n=>{n.map(n=>n.classList.remove("reportCardClicked"))},selectorEmployees:()=>{const n=i.ParametersList.find(n=>n.TemplateName==="selectorEmployees").Value},selectorDate:()=>{const n=document.querySelector("#editView > form").getAttribute("id"),t=document.querySelector("#fieldsEditor #"+n);$("#parameterDate").dxDateBox({value:new Date,onValueChanged:function(){let n=t.querySelector("input[type=radio]:checked").value;(n==0||n=="0")&&collectParamValues()}}).dxDateBox("instance")},selectorPeriodTime:()=>{const e=document.querySelector("#editView > form").getAttribute("id"),u=document.querySelector("#fieldsEditor #"+e),h=$("#desdeDateTime").dxDateBox({value:new Date,displayFormat:kt,onValueChanged:function(n){o.option("min",n.value);let t=u.querySelector("input[type=radio]:checked").value;(t==0||t=="0")&&collectParamValues()}}).dxDateBox("instance"),o=$("#hastaDateTime").dxDateBox({value:new Date,displayFormat:kt,onValueChanged:function(){let n=u.querySelector("input[type=radio]:checked").value;(n==0||n=="0")&&collectParamValues()}}).dxDateBox("instance"),s=i.ParametersList.find(n=>n.TemplateName==="selectorPeriodTime").Value,n=s.split(","),t=$("#desdeDateTime").dxDateBox("instance"),r=$("#hastaDateTime").dxDateBox("instance");if(n.length!=3){const n=2,i=n?document.querySelector(`#selectorPeriodTime input[value='${n}']`):null,{}=f.selectorDatetime(parseInt(n,10),t,r);i&&i.setAttribute("checked","")}else{const i=n[0],u=i?document.querySelector(`#selectorPeriodTime input[value='${i}']`):null;t.value=window.parent.moment(n[1]).format("YYYY-MM-DD");r.value=window.parent.moment(n[2]).format("YYYY-MM-DD");const{}=f.selectorDatetime(parseInt(i,10),t,r);u&&u.setAttribute("checked","")}},selectorString:()=>{document.querySelector("input#parameterString").value=i.ParametersList.find(n=>n.TemplateName==="selectorString").Value},selectorNumber:()=>{document.querySelector("input#parameterNumber").value=i.ParametersList.find(n=>n.TemplateName==="selectorNumber").Value},selectorFormat:async()=>{$("#viewFormat").text(vi);var u=function(){var h=document.querySelector("#editView > form").getAttribute("id"),u=i.ParametersList.find(n=>n.TemplateName===h&&n.Name===r[t].Name),f="",e,s,o;planificationsTab.classList.contains("activeTab")?(typeof u.Value===undefined||typeof u.Value=="string"&&(u.value===undefined||u.value===""))&&(e=n.PlannedExecutionsList.findIndex(n=>n.Id===$("#reportPlannedList").dxDataGrid("instance").option("focusedRowKey")),s=n.PlannedExecutionsList[e].Id==="newPlanification",e>=0&&!s&&(f=JSON.parse(n.PlannedExecutionsList[e].ParametersJson).find(n=>n.Name===r[t].Name),f!==undefined&&(u=f.Value))):(typeof u.Value===undefined||typeof u.Value=="string"&&(u.value===undefined||u.value===""))&&n.LastParameters!==undefined&&(f=JSON.parse(n.LastParameters).find(n=>n.Name===r[t].Name),f!==undefined&&(u=f.Value));typeof u.Value=="object"&&(u=u.Value);o=isNaN(u.format)?0:parseInt(u.format,10);planificationsTab.classList.contains("activeTab")&&(o=$("#plannerFormat").is(":empty")?0:$("#plannerFormat").dxSelectBox("instance"));$("#typeDocReport").dxSelectBox("instance").option("value",o);collectParamValues("format",o,null)};$("#typeDocReport").dxSelectBox({width:"30%",dataSource:new DevExpress.data.DataSource({store:k,type:"array",key:"value"}),valueExpr:"value",displayExpr:"title",readOnly:!1,placeholder:ft,onValueChanged:function(n){collectParamValues("format",n.value,null)},onInitialized:function(){u()}})},selectorViewFormat:async()=>{$("#viewCheckSelection").text(ve);var u=function(){var l=document.querySelector("#editView > form").getAttribute("id"),u=i.ParametersList.find(n=>n.TemplateName===l&&n.Name===r[t].Name),f="",e,c;planificationsTab.classList.contains("activeTab")?(typeof u.Value===undefined||typeof u.Value=="string"&&(u.value===undefined||u.value===""))&&(e=n.PlannedExecutionsList.findIndex(n=>n.Id===$("#reportPlannedList").dxDataGrid("instance").option("focusedRowKey")),c=n.PlannedExecutionsList[e].Id==="newPlanification",e>=0&&!c&&(f=JSON.parse(n.PlannedExecutionsList[e].ParametersJson).find(n=>n.Name===r[t].Name),f!==undefined&&(u=f.Value))):(typeof u.Value===undefined||typeof u.Value=="string"&&(u.value===undefined||u.value===""))&&n.LastParameters!==undefined&&(f=JSON.parse(n.LastParameters).find(n=>n.Name===r[t].Name),f!==undefined&&(u=f.Value));typeof u.Value=="object"&&(u=u.Value);var o=u.ckDetail,s=u.ckTotal,h=u.ckShowChart;o!==!0&&(o=!1);$("#ckAllDetails").dxCheckBox("instance").option("value",o);s!==!0&&(s=!1);$("#ckTotals").dxCheckBox("instance").option("value",s);h!==!0&&(h=!1);$("#ckShowChart").dxCheckBox("instance").option("value",h)};$("#ckAllDetails").dxCheckBox({width:400,text:bt,onValueChanged:function(n){collectParamValues("detail",n.value,null)}});$("#ckTotals").dxCheckBox({width:400,text:ye,onValueChanged:function(n){collectParamValues("total",n.value,null)}});$("#ckShowChart").dxCheckBox({width:400,text:pe,visible:n.Name==="Saldos con detalle",onValueChanged:function(n){collectParamValues("chart",n.value,null)},onInitialized:function(){setTimeout(function(){u()},100)}})},selectorAccessType:async()=>{console.log("entra selectorAccessType");$("#viewCheckSelection").text(be);var u=function(){var c=document.querySelector("#editView > form").getAttribute("id"),u=i.ParametersList.find(n=>n.TemplateName===c&&n.Name===r[t].Name),f="",e,h,o,s;planificationsTab.classList.contains("activeTab")?(typeof u.Value===undefined||typeof u.Value=="string"&&(u.value===undefined||u.value===""))&&(e=n.PlannedExecutionsList.findIndex(n=>n.Id===$("#reportPlannedList").dxDataGrid("instance").option("focusedRowKey")),h=n.PlannedExecutionsList[e].Id==="newPlanification",e>=0&&!h&&(f=JSON.parse(n.PlannedExecutionsList[e].ParametersJson).find(n=>n.Name===r[t].Name),f!==undefined&&(u=f.Value))):(typeof u.Value===undefined||typeof u.Value=="string"&&(u.value===undefined||u.value===""))&&n.LastParameters!==undefined&&(f=JSON.parse(n.LastParameters).find(n=>n.Name===r[t].Name),f!==undefined&&(u=f.Value));typeof u.Value=="object"&&(u=u.Value);o=u.ckValids;s=u.ckInvalids;o!==!0&&(o=!1);$("#ckValids").dxCheckBox("instance").option("value",o);s!==!0&&(s=!1);$("#ckInvalids").dxCheckBox("instance").option("value",s)};$("#ckValids").dxCheckBox({width:300,text:ke,onValueChanged:function(n){collectParamValues("valids",n.value,null)}});$("#ckInvalids").dxCheckBox({width:300,text:de,onValueChanged:function(n){collectParamValues("invalids",n.value,null)},onInitialized:function(){u()}})},selectorProfileTypes:async()=>{function p(n){pi===undefined&&(pi=$("#selectorProfileTypes > div.selectores > p").html());$("#selectorProfileTypes > div.selectores > p").text(pi);switch(n){case 1:$("#selectorProfileTypes > div.selectores > p").append("<strong> "+ys+".<\/strong>");break;case 2:$("#selectorProfileTypes > div.selectores > p");break;case 3:$("#selectorProfileTypes > div.selectores > p");break;case 4:$("#selectorProfileTypes > div.selectores > p")}}const h=n=>{$("#selectorProfileTypes .selectores > div").hide(),$("#selectorProfileTypes .comboHelperText").hide(),n==1&&$("#selectConcepts").show(),(n==2||n==4)&&$("#selectCauses").show(),(n==3||n==4)&&$("#selectIncidences").show()};var u=function(u=null){var y=document.querySelector("#editView > form").getAttribute("id"),f=i.ParametersList.find(n=>n.TemplateName===y&&n.Name===r[t].Name),e="",c,l;if(planificationsTab.classList.contains("activeTab")?(typeof f.Value===undefined||typeof f.Value=="string"&&(f.value===undefined||f.value===""))&&(c=n.PlannedExecutionsList.findIndex(n=>n.Id===$("#reportPlannedList").dxDataGrid("instance").option("focusedRowKey")),l=n.PlannedExecutionsList[c].Id==="newPlanification",c>=0&&!l&&(e=JSON.parse(n.PlannedExecutionsList[c].ParametersJson).find(n=>n.Name===r[t].Name),e!==undefined&&(f=e.Value))):(typeof f.Value===undefined||typeof f.Value=="string"&&(f.value===undefined||f.value===""))&&n.LastParameters!==undefined&&(e=JSON.parse(n.LastParameters).find(n=>n.Name===r[t].Name),e!==undefined&&(f=e.Value)),typeof f.Value=="object"&&(f=f.Value),u)switch(u){case"selectConcepts":if(typeof f.selectConcepts!="undefined"&&$("#selectConcepts")&&$("#selectConcepts").dxTagBox("instance")){let n;n=Array.isArray(f.selectConcepts)&&f.selectConcepts.length>0&&typeof f.selectConcepts[0]=="object"?f.selectConcepts.map(n=>n.value):f.selectConcepts;$("#selectConcepts").dxTagBox("instance").option("value",n)}break;case"selectCauses":if(typeof f.selectCauses!="undefined"&&$("#selectCauses")&&$("#selectCauses").dxTagBox("instance")){let n;n=Array.isArray(f.selectCauses)&&f.selectCauses.length>0&&typeof f.selectCauses[0]=="object"?f.selectCauses.map(n=>n.value):f.selectCauses;$("#selectCauses").dxTagBox("instance").option("value",n)}break;case"selectIncidences":if(typeof f.selectIncidences!="undefined"&&$("#selectIncidences")&&$("#selectIncidences").dxTagBox("instance")){let n;n=Array.isArray(f.selectIncidences)&&f.selectIncidences.length>0&&typeof f.selectIncidences[0]=="object"?f.selectIncidences.map(n=>n.value):f.selectIncidences;$("#selectIncidences").dxTagBox("instance").option("value",n)}break;case"criterio":typeof f.criterio!="undefined"?$("#criterio").dxSelectBox("instance").option("value",f.criterio):$("#criterio").dxSelectBox("instance").option("value",a[0].value);break;case"tipoValorCriterio":typeof f.tipoValorCriterio!="undefined"?$("#tipoValorCriterio").dxSelectBox("instance").option("value",f.tipoValorCriterio):$("#tipoValorCriterio").dxSelectBox("instance").option("value",v[0].value);break;case"valorCriterio":typeof f.valorCriterio!="undefined"?(f.valorCriterio.length==4?($("#valorCriterio").dxTextBox("instance").option("value",f.valorCriterio.substring(0,2)+":"+f.valorCriterio.substring(2,4)),vt=f.valorCriterio.substring(0,2)+":"+f.valorCriterio.substring(2,4)):($("#valorCriterio").dxTextBox("instance").option("value",f.valorCriterio.substring(0,3)+":"+f.valorCriterio.substring(3,5)),vt=f.valorCriterio.substring(0,3)+":"+f.valorCriterio.substring(3,5)),ei=f.valorCriterio):(ei="00000",vt="000:00",$("#valorCriterio").dxTextBox("instance").option("value",vt));break;case"valorFichaCriterio":typeof f.valorFichaCriterio!="undefined"?$("#valorFichaCriterio").dxSelectBox("instance").option("value",f.valorFichaCriterio):$("#valorFichaCriterio").dxSelectBox("instance").option("value",oi[0]?.value);break;case"rangoCriterio":typeof f.rangoCriterio!="undefined"?typeof f.rangoCriterio=="object"?$("#rangoCriterio").dxSelectBox("instance").option("value",f.rangoCriterio?.value):$("#rangoCriterio").dxSelectBox("instance").option("value",f.rangoCriterio):typeof o[0]=="object"?$("#rangoCriterio").dxSelectBox("instance").option("value",o[0]?.value):$("#rangoCriterio").dxSelectBox("instance").option("value",o[0])}else{let n=f.profileTypes;n!==1&&n!==2&&n!==3&&n!==4&&(n=1);$("#profileTypes").dxRadioGroup("instance").option("value",n);p(n);s=n;h(n)}};const c=6;let w;let f,s=0;const e=function(n,t){const i=t.map(n=>n.value).join(",");collectParamValues(n,i)},l=n=>{h(n),p(n),s=n,n==4&&($("#selectorProfileTypes .comboHelperText").show(),auxVal=$("#selectIncidences")?$("#selectIncidences").dxTagBox("instance").option("value"):"",auxVal!==undefined&&$("#selectIncidences").dxTagBox("instance").option("value",auxVal))},b=[{title:rs,value:1},{title:fs,value:3},{title:us,value:2},{title:es,value:4}],a=[{title:os,value:"mayor"},{title:ss,value:"menor"}],v=[{title:hs,value:"valor"},{title:cs,value:"campo"}];oi=await y("Robotics.Base.userFieldsNumberSelector");const o=[{text:ls,value:"diariamente"},{text:as,value:"en el periodo seleccionado"},],k=await y("Robotics.Base.conceptsSelector"),d=await y("Robotics.Base.causesSelector"),g=await y("Robotics.Base.incidencesSelector");$("#profileTypes").dxRadioGroup({dataSource:b,valueExpr:n=>n.value,displayExpr:"title",activeStateEnabled:!0,focusStateEnabled:!0,hoverStateEnabled:!0,text:bt,onValueChanged:function(n){collectParamValues("profileTypes",n.value,null);l(n.value)},onInitialized:function(){u()}});$("#selectConcepts").dxTagBox({items:k,displayExpr:"title",valueExpr:"value",placeholder:dr,showSelectionControls:!0,applyValueMode:"useButtons",searchEnabled:!0,searchExpr:"title",searchMode:"contains",searchTimeout:200,minSearchLength:0,onValueChanged:function(n){if(n.value.length>c){w=!0;const t=n.value.slice(0,c);n.component.option("value",t);e("selectConcepts",t)}else e("selectConcepts",n.value)},onInitialized:function(){u("selectConcepts")}});$("#selectCauses").dxTagBox({items:d,displayExpr:"title",valueExpr:"value",placeholder:gr,showSelectionControls:!0,applyValueMode:"useButtons",searchEnabled:!0,searchExpr:"title",searchMode:"contains",searchTimeout:200,minSearchLength:0,onValueChanged:function(n){if(f){f=!1;return}e("selectCauses",n.value)},onInitialized:function(){u("selectCauses")}});$("#selectIncidences").dxTagBox({items:g,displayExpr:"title",valueExpr:"value",placeholder:vs,showSelectionControls:!0,applyValueMode:"useButtons",searchEnabled:!0,searchExpr:"title",searchMode:"contains",searchTimeout:200,minSearchLength:0,onValueChanged:function(n){if(f){f=!1;return}e("selectIncidences",n.value)},onInitialized:function(){u("selectIncidences");l(s)}});$("#criterio").dxSelectBox({items:a,displayExpr:"title",valueExpr:"value",width:"150px",dropDownOptions:{minWidth:150},onValueChanged:function(n){collectParamValues("criterio",n.value,null)},onInitialized:function(){u("criterio")}});$("#valorCriterio").dxTextBox({value:"00000",onValueChanged:function(n){vt=n.value;n.value=n.value.replace(":","");n.value.length==4&&(n.value="0"+n.value);ei=n.value;collectParamValues("valorCriterio",n.value,null)},onInitialized:function(){u("valorCriterio")}}).dxValidator({validationRules:[{type:"pattern",pattern:/^(\d{2,3}):(\d{2})$/,message:br}]});$("#valorFichaCriterio").dxSelectBox({items:oi,displayExpr:"title",valueExpr:"value",width:"270px",dropDownOptions:{minWidth:270},onValueChanged:function(n){collectParamValues("valorFichaCriterio",n.value,null)},onInitialized:function(){u("valorFichaCriterio")}});$("#tipoValorCriterio").dxSelectBox({items:v,displayExpr:"title",valueExpr:"value",onValueChanged:function(n){collectParamValues("tipoValorCriterio",n.value,null);n.value=="campo"?($("#valorCriterio").dxTextBox("instance").option("visible",!1),$("#valorFichaCriterio").dxSelectBox("instance").option("visible",!0)):($("#valorCriterio").dxTextBox("instance").option("visible",!0),$("#valorFichaCriterio").dxSelectBox("instance").option("visible",!1))},onInitialized:function(){u("tipoValorCriterio");$("#tipoValorCriterio").dxSelectBox("instance").option("value")=="campo"?($("#valorCriterio").dxTextBox("instance").option("visible",!1),$("#valorFichaCriterio").dxSelectBox("instance").option("visible",!0)):($("#valorCriterio").dxTextBox("instance").option("visible",!0),$("#valorFichaCriterio").dxSelectBox("instance").option("visible",!1))}});$("#rangoCriterio").dxSelectBox({dataSource:o,displayExpr:"text",valueExpr:"value",onValueChanged:function(n){collectParamValues("rangoCriterio",n.value,null)},onInitialized:function(){u("rangoCriterio")}});setTimeout(function(){collectParamValues(null,null,null)},100)},selectorCausesRegistroJL:async()=>{const u=n=>{$("#selectorCausesRegistroJL .selectores > div").hide(),$("#selectorCausesRegistroJL .comboHelperText").hide(),n==1&&$("#selectCauses").show()};var f=function(f=null){var l=document.querySelector("#editView > form").getAttribute("id"),o=i.ParametersList.find(n=>n.TemplateName===l&&n.Name===r[t].Name),s="",h,c;if(planificationsTab.classList.contains("activeTab")?(typeof o.Value===undefined||typeof o.Value=="string"&&(o.value===undefined||o.value===""))&&(h=n.PlannedExecutionsList.findIndex(n=>n.Id===$("#reportPlannedList").dxDataGrid("instance").option("focusedRowKey")),c=n.PlannedExecutionsList[h].Id==="newPlanification",h>=0&&!c&&(s=JSON.parse(n.PlannedExecutionsList[h].ParametersJson).find(n=>n.Name===r[t].Name),s!==undefined&&(o=s.Value))):(typeof o.Value===undefined||typeof o.Value=="string"&&(o.value===undefined||o.value===""))&&n.LastParameters!==undefined&&(s=JSON.parse(n.LastParameters).find(n=>n.Name===r[t].Name),s!==undefined&&(o=s.Value)),typeof o.Value=="object"&&(o=o.Value),f)switch(f){case"selectCauses":typeof o.selectCauses!=undefined&&o.showCauses==1&&$("#selectCauses")&&$("#selectCauses").dxTagBox("instance")&&($("#selectCauses").dxTagBox("instance").option("value",o.selectCauses),typeof o.selectCauses!="undefined"&&e("selectCauses",o.selectCauses))}else{let n=o.showCauses;n!==1&&n!==0&&(n=0);$("#showCauses").dxRadioGroup("instance").option("value",n);u(n)}};const e=function(n,t){const i=t.map(n=>n.value).join(",");collectParamValues(n,i)},o=n=>{u(n)},s=[{title:ai,value:0},{title:li,value:1},],h=await y("Robotics.Base.causesSelector");$("#showCauses").dxRadioGroup({dataSource:s,valueExpr:n=>n.value,displayExpr:"title",activeStateEnabled:!0,focusStateEnabled:!0,hoverStateEnabled:!0,text:bt,onValueChanged:function(n){collectParamValues("showCauses",n.value,null);o(n.value)},onInitialized:function(){f()}});$("#selectCauses").dxTagBox({items:h,displayExpr:"title",valueExpr:"value",placeholder:gr,showSelectionControls:!0,applyValueMode:"useButtons",searchEnabled:!0,searchExpr:"title",searchMode:"contains",searchTimeout:200,minSearchLength:0,onValueChanged:function(n){e("selectCauses",n.value)},onInitialized:function(){f("selectCauses")}})},selectorConceptsRegistroJL:async()=>{const u=n=>{$("#selectorConceptsRegistroJL .selectores > div").hide(),$("#selectorConceptsRegistroJL .comboHelperText").hide(),n==1&&$("#selectConcepts").show()};var f=function(f=null){var l=document.querySelector("#editView > form").getAttribute("id"),o=i.ParametersList.find(n=>n.TemplateName===l&&n.Name===r[t].Name),s="",h,c;if(planificationsTab.classList.contains("activeTab")?(typeof o.Value===undefined||typeof o.Value=="string"&&(o.value===undefined||o.value===""))&&(h=n.PlannedExecutionsList.findIndex(n=>n.Id===$("#reportPlannedList").dxDataGrid("instance").option("focusedRowKey")),c=n.PlannedExecutionsList[h].Id==="newPlanification",h>=0&&!c&&(s=JSON.parse(n.PlannedExecutionsList[h].ParametersJson).find(n=>n.Name===r[t].Name),s!==undefined&&(o=s.Value))):(typeof o.Value===undefined||typeof o.Value=="string"&&(o.value===undefined||o.value===""))&&n.LastParameters!==undefined&&(s=JSON.parse(n.LastParameters).find(n=>n.Name===r[t].Name),s!==undefined&&(o=s.Value)),typeof o.Value=="object"&&(o=o.Value),f)switch(f){case"selectConcepts":if(typeof o.selectConcepts!=undefined&&o.showConcepts==1&&$("#selectConcepts")&&$("#selectConcepts").dxTagBox("instance")){let n;n=Array.isArray(o.selectConcepts)&&o.selectConcepts.length>0&&typeof o.selectConcepts[0]=="object"?o.selectConcepts.map(n=>n.value):o.selectConcepts;$("#selectConcepts").dxTagBox("instance").option("value",n);typeof o.selectConcepts!="undefined"&&e("selectConcepts",n)}}else{let n=o.showConcepts;n!==1&&n!==0&&(n=0);$("#showConcepts").dxRadioGroup("instance").option("value",n);u(n)}};const e=function(n,t){const i=t.map(n=>n.value).join(",");collectParamValues(n,i)},o=n=>{u(n)},s=[{title:ai,value:0},{title:li,value:1},],h=await y("Robotics.Base.conceptsSelector");$("#showConcepts").dxRadioGroup({dataSource:s,valueExpr:n=>n.value,displayExpr:"title",activeStateEnabled:!0,focusStateEnabled:!0,hoverStateEnabled:!0,text:bt,onValueChanged:function(n){collectParamValues("showConcepts",n.value,null);o(n.value)},onInitialized:function(){f()}});$("#selectConcepts").dxTagBox({items:h,displayExpr:"title",valueExpr:"value",placeholder:dr,showSelectionControls:!0,applyValueMode:"useButtons",searchEnabled:!0,searchExpr:"title",searchMode:"contains",searchTimeout:200,minSearchLength:0,onValueChanged:function(n){e("selectConcepts",n.value)},onInitialized:function(){f("selectConcepts")}})},selectorYearAndMonth:()=>{let u=!1;var f=function(u=null){var f=i.ParametersList.find(n=>n.TemplateName==="selectorYearAndMonth"&&n.Name===r[t].Name),e="";if((typeof f.Value===undefined||typeof f.Value=="string"&&(f.value===undefined||f.value===""))&&n.LastParameters!==undefined&&(e=JSON.parse(n.LastParameters).find(n=>n.Name===r[t].Name),e!==undefined&&(f=e.Value)),typeof f.Value=="object"&&(f=f.Value),u){let n="";switch(u){case"month":n=typeof f.month!="undefined"?f.month:w[0].value;break;case"year":n=typeof f.year!="undefined"?f.year:nt[0]}$("#"+u).dxSelectBox("instance").option("value",n)}};const e=n=>{const t=n!=null?n.component.option("selectedItem").title:$("#month").dxSelectBox("instance").option("text"),i=t==w[0].title||t==ot||t==st||t==ht||t==gt||t==ni||t==ti;i&&$("#year").dxSelectBox("instance")?($("#year").dxSelectBox("instance").option("value",yt(g.getFullYear(),t)),$("#year").dxSelectBox("instance").option("disabled",!0)):$("#year").dxSelectBox("instance")&&$("#year").dxSelectBox("instance").option("disabled",!1)};$("#year").dxSelectBox({items:nt,onValueChanged:function(n){u&&collectParamValues("year",n.value,null)}});$("#month").dxSelectBox({items:w,displayExpr:"title",valueExpr:"value",onValueChanged:function(n){u&&(collectParamValues("month",n.value,null),e(n))}});setTimeout(function(){u=!1;f("year");f("month");e(null);u=!0;collectParamValues(null,null,null)},100)},selectorBetweenYearAndMonth:()=>{let u=!1;var f=function(u=null){var f=i.ParametersList.find(n=>n.TemplateName==="selectorBetweenYearAndMonth"&&n.Name===r[t].Name),e="";if((typeof f.Value===undefined||typeof f.Value=="string"&&(f.value===undefined||f.value===""))&&n.LastParameters!==undefined&&(e=JSON.parse(n.LastParameters).find(n=>n.Name===r[t].Name),e!==undefined&&(f=e.Value)),typeof f.Value=="object"&&(f=f.Value),u){let n="";switch(u){case"monthStart":n=typeof f.monthStart!="undefined"?f.monthStart:w[0].value;break;case"yearStart":n=typeof f.yearStart!="undefined"?f.yearStart:nt[0];break;case"monthEnd":n=typeof f.monthEnd!="undefined"?f.monthEnd:w[1].value;break;case"yearEnd":n=typeof f.yearEnd!="undefined"?f.yearEnd:nt[0]}$("#"+u).dxSelectBox("instance").option("value",n)}};const e=(n,t)=>{const i=n!=null?n.component.option("selectedItem").title:$("#month"+t).dxSelectBox("instance").option("text"),r=i==w[0].title||i==ot||i==st||i==ht;r&&$("#year"+t).dxSelectBox("instance")?($("#year"+t).dxSelectBox("instance").option("value",yt(g.getFullYear(),i)),$("#year"+t).dxSelectBox("instance").option("disabled",!0)):$("#year"+t).dxSelectBox("instance")&&$("#year"+t).dxSelectBox("instance").option("disabled",!1)};$("#yearStart").dxSelectBox({items:nt,onValueChanged:function(n){u&&collectParamValues("yearStart",n.value,null)}});$("#monthStart").dxSelectBox({items:w,displayExpr:"title",valueExpr:"value",onValueChanged:function(n){u&&(collectParamValues("monthStart",n.value,null),e(n,"Start"))}});$("#yearEnd").dxSelectBox({items:nt,onValueChanged:function(n){u&&collectParamValues("yearEnd",n.value,null)}});$("#monthEnd").dxSelectBox({items:w,displayExpr:"title",valueExpr:"value",onValueChanged:function(n){u&&(collectParamValues("monthEnd",n.value,null),e(n,"End"))}});setTimeout(function(){u=!1;f("yearStart");f("monthStart");e(null,"Start");f("yearEnd");f("monthEnd");e(null,"End");u=!0;collectParamValues(null,null,null)},100)},selectorFilterValues:async()=>{const e=await y("Robotics.Base.filterValuesSelector"),f=[{title:io,value:"text"},{title:ro,value:"field"}];var o=function(){var l=document.querySelector("#editView > form").getAttribute("id"),u=i.ParametersList.find(n=>n.TemplateName===l&&n.Name===r[t].Name),a=planificationsTab.classList.contains("activeTab"),e,s,f;a&&typeof n.PlannedExecutionsList!="undefined"&&(typeof u.Value===undefined||typeof u.Value=="string"&&(u.value===undefined||u.value===""))&&(e=n.PlannedExecutionsList.findIndex(n=>n.Id===$("#reportPlannedList").dxDataGrid("instance").option("focusedRowKey")),s=n.PlannedExecutionsList[e].Id==="newPlanification",e>=0&&!s&&(f=JSON.parse(n.PlannedExecutionsList[e].ParametersJson).find(n=>n.Name===r[t].Name),f!==undefined&&(u=f.Value)));typeof u.Value=="object"&&(u=u.Value);var v=u.typeFilterSince,y=u.typeFilterTo,h=u.valueSince,c=u.valueTo,o=u.optionFilterValues;o!==!0&&(o=!1);v===undefined&&y===undefined&&(h===""||h===undefined)&&(c===""||c===undefined)&&o===!1&&n.LastParameters!==undefined&&(f=JSON.parse(n.LastParameters).find(n=>n.Name===r[t].Name),f!==undefined&&(u=f.Value));u.optionFilterValues===undefined&&(u.optionFilterValues=!1,u.typeFilterSince="",u.typeFilterTo="",u.valueSince="",u.valueTo="");document.getElementById("optionFilter").value=u.optionFilterValues;document.getElementById("typeMin").innerText=u.typeFilterSince;document.getElementById("typeMax").innerText=u.typeFilterTo;document.getElementById("valueMin").innerText=u.valueSince;document.getElementById("valueMax").innerText=u.valueTo},s=function(){var u=document.getElementById("optionFilter").value,i=document.getElementById("typeMin").innerText,r=document.getElementById("typeMax").innerText,n=document.getElementById("valueMin").innerText,t=document.getElementById("valueMax").innerText;u===!0?($("#titleFilterValues").dxCheckBox("instance").option("value",!1),$("#titleFilterValues").dxCheckBox("instance").option("value",!0)):($("#titleFilterValues").dxCheckBox("instance").option("value",!0),$("#titleFilterValues").dxCheckBox("instance").option("value",!1));$("#typeFilterMin").dxSelectBox("instance").option("value",i);$("#typeFilterMax").dxSelectBox("instance").option("value",r);switch(i){case"text":tmpValue=n.split(":")[0];tmpValueDec=n.split(":")[1];tmpValue=tmpValue===undefined||tmpValue==="undefined"?"0":tmpValue;tmpValueDec=tmpValueDec===undefined||tmpValueDec==="undefined"?"00":tmpValueDec;$("#valueTextMin").dxNumberBox("instance").option("value",tmpValue);$("#valueTextMinDec").dxNumberBox("instance").option("value",tmpValueDec);break;case"field":$("#valueFieldsMin").dxSelectBox("instance").option("value",n)}switch(r){case"text":tmpValue=t.split(":")[0];tmpValueDec=t.split(":")[1];tmpValue=tmpValue===undefined||tmpValue==="undefined"?"0":tmpValue;tmpValueDec=tmpValueDec===undefined||tmpValueDec==="undefined"?"00":tmpValueDec;$("#valueTextMax").dxNumberBox("instance").option("value",tmpValue);$("#valueTextMaxDec").dxNumberBox("instance").option("value",tmpValueDec);break;case"field":$("#valueFieldsMax").dxSelectBox("instance").option("value",t)}collectParamValues(null,null,null)},u=function(){var i=document.getElementById("optionFilter").value,n,t;$("#titleFilterValues").dxCheckBox("instance").option("value",i);n=$("#typeFilterMin").dxSelectBox("instance").option("value");t=$("#typeFilterMax").dxSelectBox("instance").option("value");$("#valueFieldsMin").dxSelectBox("instance").option("visible",!1);$("#valueFieldsMax").dxSelectBox("instance").option("visible",!1);$("#lbMinDecimal").text("");$("#lbMaxDecimal").text("");$("#valueTextMin").dxNumberBox("instance").option("visible",!1);$("#valueTextMinDec").dxNumberBox("instance").option("visible",!1);$("#valueTextMax").dxNumberBox("instance").option("visible",!1);$("#valueTextMaxDec").dxNumberBox("instance").option("visible",!1);i?($("#label0").text(no),$("#label1").text(to),$("#typeFilterMin").dxSelectBox("instance").option("visible",!0),$("#typeFilterMax").dxSelectBox("instance").option("visible",!0),n==="text"?($("#lbMinDecimal").text(":"),$("#valueTextMin").dxNumberBox("instance").option("visible",!0),$("#valueTextMinDec").dxNumberBox("instance").option("visible",!0)):n==="field"&&$("#valueFieldsMin").dxSelectBox("instance").option("visible",!0),t==="text"?($("#lbMaxDecimal").text(":"),$("#valueTextMax").dxNumberBox("instance").option("visible",!0),$("#valueTextMaxDec").dxNumberBox("instance").option("visible",!0)):t==="field"&&$("#valueFieldsMax").dxSelectBox("instance").option("visible",!0)):($("#label0").text(""),$("#label1").text(""),$("#typeFilterMax").dxSelectBox("instance").option("visible",!1),$("#typeFilterMin").dxSelectBox("instance").option("visible",!1))};$("#valueTextMin").dxNumberBox({format:"####0",max:99999,visible:!1,width:"65px",onChange:function(n){var t=n.event.currentTarget.value;collectParamValues("valueTextMin",t,null);u()}});$("#lbMinDecimal").text(":");$("#valueTextMinDec").dxNumberBox({format:"00",max:59,visible:!1,width:"45px",onChange:function(n){var t=n.event.currentTarget.value;collectParamValues("valueTextMinDec",t,null);u()}});$("#valueTextMax").dxNumberBox({format:"####0",max:99999,visible:!1,width:"65px",onChange:function(n){var t=n.event.currentTarget.value;collectParamValues("valueTextMax",t,null);u()}});$("#lbMaxDecimal").text(":");$("#valueTextMaxDec").dxNumberBox({format:"00",max:59,visible:!1,width:"45px",onChange:function(n){var t=n.event.currentTarget.value;collectParamValues("valueTextMaxDec",t,null);u()}});$("#valueFieldsMin").dxSelectBox({dataSource:new DevExpress.data.ArrayStore({data:e,key:"value"}),width:"200px",displayExpr:"title",valueExpr:"value",placeholder:ft,visible:!1,onValueChanged:function(n){collectParamValues("valueFieldsMin",n.value,null);u()}});$("#valueFieldsMax").dxSelectBox({dataSource:new DevExpress.data.ArrayStore({data:e,key:"value"}),width:"200px",displayExpr:"title",valueExpr:"value",value:f[0].value,readOnly:!1,placeholder:ft,visible:!1,onValueChanged:function(n){collectParamValues("valueFieldsMax",n.value,null);u()}});$("#typeFilterMin").dxSelectBox({width:"200px",dataSource:new DevExpress.data.ArrayStore({data:f,key:"value"}),displayExpr:"title",valueExpr:"value",readOnly:!1,visible:!1,placeholder:ft,onValueChanged:function(n){collectParamValues("typeFilterMin",n.value,null);u()}});$("#typeFilterMax").dxSelectBox({dataSource:new DevExpress.data.ArrayStore({data:f,key:"value"}),width:"200px",displayExpr:"title",valueExpr:"value",readOnly:!1,visible:!1,placeholder:ft,onValueChanged:function(n){collectParamValues("typeFilterMax",n.value,null);u()}});$("#titleFilterValues").dxCheckBox({text:ge,hint:"Detalle",height:25,onContentReady:function(){o();s();u()},onValueChanged:function(n){collectParamValues("titleFilterValues",n.value,null);u()}})},selectorProjectsVSL:()=>{$("#startProject").dxNumberBox({min:0,width:"65px",format:"#0",onChange:function(n){var t=n.event.currentTarget.value;collectParamValues("startProject",t,null)}}),$("#endProject").dxNumberBox({min:0,width:"65px",format:"#0",onChange:function(n){var t=n.event.currentTarget.value;collectParamValues("endProject",t,null)}})},selectorUniversal:async()=>{const f=await y(r[t].Type);var e=function(n){if(r[t].Type=="Robotics.Base.userFieldsSelector"||r[t].Type=="Robotics.Base.userFieldsSelectorRadioBtn"){var u=n.selectedRowKeys.join(",");collectParamValues(u)}else r[t].Value=n.selectedRowKeys.join(","),i.ParametersList=[...new Set([...r,...i.ParametersList,]),]};let u={allowSelectAll:!0,mode:"multiple",showCheckBoxesMode:"always"},n=r[t].Name;switch(r[t].Type){case"Robotics.Base.userFieldsSelectorRadioBtn":n=r[t].Description;break;case"Robotics.Base.userFieldsSelector":n=go;break;case"Robotics.Base.shiftsSelector":n=ns;break;case"Robotics.Base.holidaysSelector":n=ts;break;case"Robotics.Base.conceptGroupsSelector":n=is}r[t].Type=="Robotics.Base.userFieldsSelectorRadioBtn"&&(u={allowSelectAll:!1,mode:"single",showCheckBoxesMode:"onClick"});$("#selectorUniversal").dxDataGrid({dataSource:f,keyExpr:"value",width:300,height:460,scrolling:{mode:"virtual",preloadEnabled:!0},showColumnLines:!1,columns:[{caption:n,dataField:"title"},],selection:u,paging:{enabled:!1},onSelectionChanged:n=>{e(n)}});collectParamValues(null,null,null)},selectorConcepts:async()=>{var tt,it;$("#conceptDescription").text(yr);$("#titleGroupConcepts").text(ar);$("#titleConcepts").text(pr);DevExpress.localization.loadMessages({en:{"dxList-nextButtonText":wr}});var o=[],u=[],s=[],l=[],rt=!1,p=!1,f="";gi=!1;nr=!1;var d=function(){var s=document.querySelector("#editView > form").getAttribute("id"),u=i.ParametersList.find(n=>n.TemplateName===s&&n.Name===r[t].Name),f="",e,o;planificationsTab.classList.contains("activeTab")?(typeof u.Value===undefined||typeof u.Value=="string"&&(u.value===undefined||u.value===""))&&(e=n.PlannedExecutionsList.findIndex(n=>n.Id===$("#reportPlannedList").dxDataGrid("instance").option("focusedRowKey")),o=n.PlannedExecutionsList[e].Id==="newPlanification",e>=0&&!o&&(f=JSON.parse(n.PlannedExecutionsList[e].ParametersJson).find(n=>n.Name===r[t].Name),f!==undefined&&(u=f.Value))):(typeof u.Value===undefined||typeof u.Value=="string"&&(u.value===undefined||u.value===""))&&n.LastParameters!==undefined&&(f=JSON.parse(n.LastParameters).find(n=>n.Name===r[t].Name),f!==undefined&&(u=f.Value));typeof u.Value=="object"&&(u=u.Value);collectParamValues(u,null,null)},w=function(n){if(f==="")switch(n){case"change_concept":f="listConcepts";break;case"change_group":f="listGroupsConcepts"}s=document.getElementById("selecttionItemsGroups").innerText.split(",");l=document.getElementById("selecttionItemsConcepts").innerText.split(",");o=$("#listGroupsConcepts").dxList("instance").option("selectedItemKeys");u=$("#listConcepts").dxList("instance").option("selectedItemKeys");rt=JSON.stringify(o.join(",").split(","))!==JSON.stringify(s);p=JSON.stringify(u)!==JSON.stringify(l)},v=function(n){w(f);f==="listConcepts"&&p&&(document.getElementById("selecttionItemsConcepts").innerText=u.toString());f===""&&p&&(document.getElementById("selecttionItemsConcepts").innerText=u.join(",").toString(),$("#listConcepts").dxList("instance").option("selectedItemKeys",u));n==="Groups"&&ut(nt,u)},ut=function(n,t){var i=!0,r=[],u,f,e;for(a in n){u=n[a].value;f=u.split(",");i=!0;for(b in f)e=t.includes(f[b]),e||(i=!1);i&&r.push(u)}$("#listGroupsConcepts").dxList("instance").option("selectedItemKeys",r);document.getElementById("selecttionItemsGroups").innerText=r},ft=function(){v("Concepts");v("Groups");d()},g=function(){var n=$("#listConcepts").dxList("instance").option("selectedItemKeys").join(",");v("Groups");collectParamValues(n,null)},et=function(){var f=document.querySelector("#editView > form").getAttribute("id"),u=i.ParametersList.find(n=>n.TemplateName===f&&n.Name===r[t].Name),n=null;u.Value!==undefined&&(n=u.Value.split(","));n!==null&&$("#listConcepts").dxList("instance").option("selectedItemKeys",n);v("Groups")},ot=function(n,t){var i=n.indexOf(t);i!==-1&&n.splice(i,1)},k=function(n,t,i){var r=[],u=[],e,f;if(n.length>t.length?(r=n,u=t):(r=t,u=n),i==="value")for(a in u)f=r.findIndex(n=>n.value===u[a].value),f+1>0&&r.splice(f,1);else for(a in u)e=r.includes(u[a]),e&&(f=r.indexOf(u[a]),r.splice(f,1));return r},st=function(n,t,i){var r=n[t];return n.splice(t,1),n.splice(i,0,r),n},ht=function(n){if(n.component.isItemSelected(n.toIndex)){var t=n.component.option("selectedItemKeys"),i=n.component.option("selectedItemKeys").indexOf(n.itemData.value),r=n.toIndex,u=st(t,i,r);n.component.option("selectedItemKeys",u);g(n)}},ct=function(){var t,n,i;if(f!=="listConcepts"){if(s=document.getElementById("selecttionItemsGroups").innerText.split(","),l=document.getElementById("selecttionItemsConcepts").innerText.split(","),o=$("#listGroupsConcepts").dxList("instance").option("selectedItemKeys"),u=$("#listConcepts").dxList("instance").option("selectedItemKeys"),s.length>o.join(",").split(",").length){t=k(s,o.join(",").split(","));for(e in t)ot(u,t[e])}if(s.length<o.join(",").split(",").length&&l.join(",").toString()==u.join(",").toString()){n=k(s,o.join(",").split(","));for(e in n)i=u.indexOf(n[e]),i<0&&u.push(n[e])}$("#selecttionItemsGroups").text(o.join(","));$("#listConcepts").dxList("instance").option("selectedItemKeys",u);$("#selecttionItemsConcepts").text(u.join(","))}};const nt=await y("Robotics.Base.groupConceptsSelector"),h=await y(r[t].Type);d();tt=function(){var f=document.getElementById("selecttionItemsConcepts").innerText.split(","),n="",t,i="",e=[],r=[],u;for(c in f)n=f[c],t=h.findIndex(t=>t.value==n),t+1>0&&(i=h[t].title,e.push({value:n,title:i}),r.push({value:n,title:i}));u=k(h,e,"value");for(c2 in u)n=u[c2].value,t=h.findIndex(t=>t.value==n),t+1>0&&(i=h[t].title,r.push({value:n,title:i}));return r};it=tt();$("#listGroupsConcepts").dxList({dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.ArrayStore({key:"value",data:nt})}),displayExpr:"title",height:400,showSelectionControls:!0,selectionMode:"all",selectAllMode:"allPages",selectAllText:yi,onInitialized:function(){gi=!0},onSelectionChanged:function(){w("change_group");ct();f=""},onContentReady:function(){}}).dxList("instance");$("#listConcepts").dxList({dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.ArrayStore({key:"value",data:it})}),itemDragging:{allowReordering:!0},displayExpr:"title",height:400,showSelectionControls:!0,selectionMode:"all",selectAllMode:"allPages",selectAllText:yi,onInitialized:function(n){nr=!0;ft(n)},onSelectionChanged:function(n){w("change_concept");g(n);f=""},onItemReordered:ht,onContentReady:function(n){et(n)}}).dxList("instance")},selectorCauses:async()=>{var p,w;$("#causeDescription").text(yr);$("#titleCauses").text(vr);DevExpress.localization.loadMessages({en:{"dxList-nextButtonText":wr}});var f=[],s=[],o=!1,u="";tr=!1;var h=function(n){if(u==="")switch(n){case"change_cause":u="listCauses"}s=document.getElementById("selecttionItemsCauses").innerText.split(",");f=$("#listCauses").dxList("instance").option("selectedItemKeys");o=JSON.stringify(f)!==JSON.stringify(s)},b=function(){h(u);u==="listCauses"&&o&&(document.getElementById("selecttionItemsCauses").innerText=f.toString());u===""&&o&&(document.getElementById("selecttionItemsCauses").innerText=f.join(",").toString(),$("#listCauses").dxList("instance").option("selectedItemKeys",f))},l=function(){var s=document.querySelector("#editView > form").getAttribute("id"),u=i.ParametersList.find(n=>n.TemplateName===s&&n.Name===r[t].Name),f="",e,o;planificationsTab.classList.contains("activeTab")?(typeof u.Value===undefined||typeof u.Value=="string"&&(u.value===undefined||u.value===""))&&(e=n.PlannedExecutionsList.findIndex(n=>n.Id===$("#reportPlannedList").dxDataGrid("instance").option("focusedRowKey")),o=n.PlannedExecutionsList[e].Id==="newPlanification",e>=0&&!o&&(f=JSON.parse(n.PlannedExecutionsList[e].ParametersJson).find(n=>n.Name===r[t].Name),f!==undefined&&(u=f.Value))):(typeof u.Value===undefined||typeof u.Value=="string"&&(u.value===undefined||u.value===""))&&n.LastParameters!==undefined&&(f=JSON.parse(n.LastParameters).find(n=>n.Name===r[t].Name),f!==undefined&&(u=f.Value));typeof u.Value=="object"&&(u=u.Value);collectParamValues(u,null,null)},k=function(){b("Causes");l()},v=function(){var n=$("#listCauses").dxList("instance").option("selectedItemKeys").join(",");collectParamValues(n,null)},d=function(){var f=document.querySelector("#editView > form").getAttribute("id"),u=i.ParametersList.find(n=>n.TemplateName===f&&n.Name===r[t].Name),n=null;if(u.Value!==undefined)try{n=u.Value.split(",")}catch{}n!==null&&$("#listCauses").dxList("instance").option("selectedItemKeys",n)},it=function(n,t){var i=n.indexOf(t);i!==-1&&n.splice(i,1)},g=function(n,t,i){var r=[],u=[],e,f;if(n.length>t.length?(r=n,u=t):(r=t,u=n),i==="value")for(a in u)f=r.findIndex(n=>n.value===u[a].value),f+1>0&&r.splice(f,1);else for(a in u)e=r.includes(u[a]),e&&(f=r.indexOf(u[a]),r.splice(f,1));return r},nt=function(n,t,i){var r=n[t];return n.splice(t,1),n.splice(i,0,r),n},tt=function(n){var u,i,t,f;if(n.component.isItemSelected(n.toIndex)){for(u=n.component.option("items"),i=null,t=n.toIndex-1;t>0;t--)if(f=u[t],n.component.isItemSelected(t)){i=f.value;break}var r=n.component.option("selectedItemKeys"),e=r.indexOf(n.itemData.value),o=r.indexOf(i)+1,s=nt(r,e,o);n.component.option("selectedItemKeys",s);v(n)}};const e=await y(r[t].Type);l();p=function(){var f=document.getElementById("selecttionItemsCauses").innerText.split(","),n="",t,i="",o=[],r=[],u;for(c in f)n=f[c],t=e.findIndex(t=>t.value==n),t+1>0&&(i=e[t].title,o.push({value:n,title:i}),r.push({value:n,title:i}));u=g(e,o,"value");for(c2 in u)n=u[c2].value,t=e.findIndex(t=>t.value==n),t+1>0&&(i=e[t].title,r.push({value:n,title:i}));return r};w=p();$("#listCauses").dxList({dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.ArrayStore({key:"value",data:w})}),itemDragging:{allowReordering:!0},displayExpr:"title",height:400,showSelectionControls:!0,selectionMode:"all",selectAllMode:"allPages",selectAllText:yi,onInitialized:function(n){tr=!0;k(n)},onSelectionChanged:function(n){h("change_cause");v(n);u=""},onItemReordered:tt,onContentReady:function(n){d(n)}}).dxList("instance")},planifications:t=>{const r=n.PlannedExecutionsList.map(n=>Object.assign({},n,n.ViewFields));$(t).dxDataGrid({dataSource:r,noDataText:du,keyExpr:"Id",rowType:"data",columns:[{caption:ho,dataField:"description",dataType:"string",width:250,allowEditing:!0,editorOptions:{onFocusOut:n=>{const r=n.component.option("value"),u=$(t).dxDataGrid("instance").option("focusedRowKey"),f=i.PlannedExecutionsList.findIndex(n=>n.Id===u);i.PlannedExecutionsList[f].ViewFields.description=r}}},{caption:uo,dataField:"scheduledSentence",width:250,allowEditing:!1},{caption:fo,dataField:"NextExecutionDate",dataType:"string",alignment:"center",width:140,allowEditing:!1,calculateCellValue:n=>typeof n.NextExecutionDate!="undefined"?o.getStringDate(new Date(n.NextExecutionDate)):""},{caption:eo,dataField:"Destination",width:130,alignment:"center",allowEditing:!1,calculateCellValue:n=>{const t=JSON.parse(n.Destination);return t.display||t.type}},{caption:oo,dataField:"Language",width:70,alignment:"center",allowEditing:!1,visible:!n.CreatorPassportId},{caption:vi,dataField:"Format",calculateCellValue:n=>{var r;if(n.ParametersJson!=undefined){var u=JSON.parse(n.ParametersJson),i=u.find(n=>n.Type=="Robotics.Base.formatSelector"),t=0;return i!=undefined?i.Value!=null&&i.Value!=""?t=k.findIndex(n=>n.value===i.Value.format):(r=u.find(n=>n.Name=="forceExcel"),r!=null&&r.Value==!0&&(t=1)):t=k.findIndex(t=>t.value===n.Format),k[t]?k[t].title:t}return k[0].title},width:80,alignment:"center",allowEditing:!1},{caption:so,dataField:"CreatorName",alignment:"center",allowEditing:!1},{width:250,type:"buttons",alignment:"center",allowEditing:!1,buttons:[{name:"edit",text:bu,cssClass:"hiddenButton"},{text:ku,name:"save",onClick:async t=>{const i=$("#plannerLanguage").is(":empty")?null:$("#plannerLanguage").dxSelectBox("instance"),r=$("#plannerFormat").is(":empty")?null:$("#plannerFormat").dxSelectBox("instance"),u=o.isThisWidgetSet([r,i,$("#plannerScheduler > .stepOne").dxRadioGroup("instance").option("value"),]);if(u)await f.schedule(it,l,t),await ut(n.Id);else{o.removeIdNewPlanifications();const n=await f.acceptEdition(!0,"planifications");n&&await rt()}}},{text:wu,name:"delete",cssClass:"hiddenButton",onClick:async t=>{const r=await o.dialogDx(rf,wt);if(r){t.component.deleteRow(t.row.rowIndex);i.PlannedExecutionsList=i.PlannedExecutionsList.filter(n=>n.Id!==t.component.option("focusedRowKey"));const n=await f.acceptEdition(!0,"planifications");n&&rt()}await ut(n.Id)}},{text:sr,name:"cancel",onClick:n=>{if(n.row.key==="newPlanification"){n.component.cancelEditData();n.component.deselectRows(["newPlanification"]);n.component.deleteRow(n.row.rowIndex);return}f.cancelEdition(!1);rt()}},]},{visible:!1,caption:"update",dataField:"updating"},],onEditingStart:async n=>{n.data.updating=Date.now();const i=n.component.getCellElement(n.component.getRowIndexByKey(n.key),0);n.component.focus(i);const t=document.querySelector("#reportPlanOptions"),r=document.querySelector("#plannerScheduler > .stepOne"),f=document.querySelector("#plannerLanguage"),e=document.querySelector("#plannerFormat"),o=document.querySelector("#plannerDestination");t.style.display="";t.style.opacity=1;t.style.pointerEvents="auto";u.schedulerStepOne(r,{selection:"optOneTime"},n.data);await u.plannerLanguage(f,n.data);u.plannerFormat(e,n.data);u.plannerDestination(o,n.data)},onFocusedRowChanged:async n=>{var i=n.row,t=i.data;i.cells[i.cells.length-1].cellElement.find("a").css("display","inline-block");i.data.updating=Date.now();n.component.focus(i);const r=document.querySelector("#reportPlanOptions");r.style.display="";r.style.opacity=.8;r.style.pointerEvents="none";const f=document.querySelector("#plannerScheduler > .stepOne"),e=document.querySelector("#plannerLanguage"),o=document.querySelector("#plannerFormat"),s=document.querySelector("#plannerDestination");u.schedulerStepOne(f,{selection:"optOneTime"},t);await u.plannerLanguage(e,t);u.plannerFormat(o,t);const h=$("#planificationDestinationTextBox").dxTextBox({readOnly:!0,width:"400px",placeholder:wf,value:t&&t.Destination?JSON.parse(t.Destination).display:null}).dxTextBox("instance")},showColumnLines:!1,showBorders:!1,editing:{mode:"row",allowUpdating:!0,allowDeleting:!0,texts:{confirmDeleteMessage:""}},paging:{enabled:!1},hoverStateEnabled:!0,focusedRowEnabled:!0})},schedulerStepOne:(n,t,{Scheduler:i})=>{const r=$(n).dxRadioGroup({dataSource:dt,valueExpr:n=>n,displayExpr:"title",activeStateEnabled:!1,focusStateEnabled:!1,hoverStateEnabled:!1}).dxRadioGroup("instance");r.off("valueChanged");r.on("valueChanged",function(n){const t=document.querySelector("#plannerScheduler > .stepTwo");d.map(n=>{n.dispose(),n.element().remove()});u.schedulerStepTwo(t,{range:n.value&&n.value.range,title:n.value&&n.value.title},i&&n.value&&i.substring(0,1)==dt.find(t=>t.range==n.value.range).value?i:"")});r.option("value",dt.find(n=>n.value===parseInt(i.substring(0,1),10))||null)},schedulerStepTwo:async(n,t,i)=>{n.innerHTML=!!t.range&&await p(`scheduler-${t.range}`);const f=n.querySelector(".opt1"),e=n.querySelector(".opt2"),o=n.querySelector(".opt3"),s=n.querySelector(".opt4"),h={...t},u={},r=i&&i.split("@");switch(t.range){case"optHours":it=4;u.Hour=$(f).dxDateBox({type:"time",value:new Date(`1/1/2019 ${r?r[1]:"12:00:00"}`),pickerType:"native"}).dxDateBox("instance");d.push(u.Hour);break;case"optDiary":it=0;u.Days=$(f).dxNumberBox({value:r?r[2]:1,showSpinButtons:!0,max:366,min:1}).dxNumberBox("instance");u.Hour=$(e).dxDateBox({type:"time",value:new Date(`1/1/2019 ${r?r[1]:"12:00:00"}`),displayFormat:"HH:mm"}).dxDateBox("instance");d.push(u.Days,u.Hour);break;case"optWeekly":it=1;const n=[{title:"Lunes"},{title:"Martes"},{title:"Miercoles"},{title:"Jueves"},{title:"Viernes"},{title:"Sábado"},{title:"Domingo"},];u.Weeks=$(f).dxNumberBox({value:r?r[2]:1,showSpinButtons:!0,max:100,min:1}).dxNumberBox("instance");const t=t=>t.split("").reduce((t,i,r)=>(i==1&&t.push(n[r].title),t),[]).join(", ");u.WeekDay=$(e).dxDropDownBox({keyExpr:"title",dataSource:n,value:r?t(r[3]):"",onInitialized:()=>{l&&(l.WeekDaysSentence=r?t(r[3]):"",l.WeekDays=r?r[3]:"0000000")},contentTemplate:i=>$("<div>").dxDataGrid({dataSource:i.component.option("dataSource"),columns:[{dataField:"title"}],keyExpr:"title",value:r?t(r[3]):"",selectedRowKeys:r?r[3].split("").reduce((t,i,r)=>(i==1&&t.push(n[r].title),t),[]):[],selection:{mode:"multiple",showCheckBoxesMode:"always"},filterBuilderPopup:{fullScreen:!0},showColumnHeaders:!1,showColumnLines:!1,showBorders:!0,onContentReady:n=>n.element.parent().css("padding","0"),onSelectionChanged:t=>{l.WeekDaysSentence=t.selectedRowKeys.join(", "),l.WeekDays=n.map(n=>!t.selectedRowKeys.find(t=>t===n.title)?0:1).join(""),i.component.field().val(t.selectedRowKeys.join(", "))}})}).dxDropDownBox("instance");u.Hour=$(o).dxDateBox({type:"time",value:new Date(`1/1/2019 ${r?r[1]:"12:00:00"}`),displayFormat:"HH:mm"}).dxDateBox("instance");d.push(u.Weeks,u.WeekDay,u.Hour);break;case"optMonthly":it=2;const i=[{title:"1er.",value:1},{title:"2o.",value:2},{title:"3o.",value:3},{title:"4o.",value:4},{title:"Último",value:5},],h=[{title:"Lunes",value:1},{title:"Martes",value:2},{title:"Miercoles",value:3},{title:"Jueves",value:4},{title:"Viernes",value:5},{title:"Sábado",value:6},{title:"Domingo",value:7},];u.Day=$(f).dxNumberBox({value:r?r[2]==0?r[3]:1:1,showSpinButtons:!0,max:31,min:1,onInitialized:()=>{r[2]==0&&($(".monthlyOpt1").fadeTo(1,1),$(".monthlyOpt2").fadeTo(1,.6)),l.MonthlyType=0},onFocusIn:()=>{$(".monthlyOpt1").fadeTo(1,1),$(".monthlyOpt2").fadeTo(1,.6),l.MonthlyType=0}}).dxNumberBox("instance");u.Start=$(e).dxSelectBox({text:"value",keyExpr:"title",displayExpr:"title",dataSource:i,value:r&&r[2]==1?i.find(n=>n.value==r[3]):null,onInitialized:()=>{r[2]==1&&($(".monthlyOpt2").fadeTo(1,1),$(".monthlyOpt1").fadeTo(1,.6),l.MonthlyType=1)},onFocusIn:()=>{l.MonthlyType=1,$(".monthlyOpt2").fadeTo(1,1),$(".monthlyOpt1").fadeTo(1,.6)}}).dxSelectBox("instance");u.WeekDay=$(o).dxSelectBox({text:"value",keyExpr:"title",displayExpr:"title",dataSource:h,value:r&&r[2]==1?h.find(n=>n.value==r[4]):null,onInitialized:()=>{r[2]==1&&($(".monthlyOpt2").fadeTo(1,1),$(".monthlyOpt1").fadeTo(1,.6))},onFocusIn:()=>{l.MonthlyType=1,$(".monthlyOpt2").fadeTo(1,1),$(".monthlyOpt1").fadeTo(1,.6)}}).dxSelectBox("instance");u.Hour=$(s).dxDateBox({type:"time",value:new Date(`1/1/2019 ${r?r[1]:"12:00:00"}`),displayFormat:"HH:mm"}).dxDateBox("instance");d.push(u.Day,u.Start,u.WeekDay,u.Hour);break;case"optOneTime":it=3;const c=(new Date).setDate((new Date).getDate()+1),a=new Date(c).setHours(0,0,0,0);u.DateTime=$(f).dxDateBox({type:"datetime",displayFormat:"dd-MM-yyyy, HH:mm",invalidDateMessage:"",value:r?new Date(`${r[2].split(" ")[0]} ${r[1]}`):a}).dxDateBox("instance");d.push(u.DateTime);u.Hour=u.DateTime;u.Day=u.DateTime}l={...l,...u}},plannerLanguage:async(t,i)=>{const r=typeof n.CreatorPassportId!="undefined";if(!r){const n=await gh();$(t).dxSelectBox({dataSource:n,placeholder:ff,displayExpr:"Key",valueExpr:"Key",value:i.Language})}},plannerFormat:(n,t)=>{!0||$(n).dxSelectBox({dataSource:k,placeholder:ef,valueExpr:"value",displayExpr:"title",value:t.Format})},plannerDestination:(t,r)=>{$("#planificationDestination").off("click");$("#planificationDestination").on("click",async()=>{const e=await p("selectorDestination"),o=await p("editViewBtns"),t=document.querySelector("#fieldsEditor"),u=i.PlannedExecutionsList.findIndex(n=>n.Id===$("#reportPlannedList").dxDataGrid("instance").option("focusedRowKey"));t.style.top="50%";t.style.left="50%";t.style.transform="translate(-50%, -50%)";t.style.width="850px";t.style.height="90vh";t.style.maxHeight="590px";t.style.display="block";t.innerHTML=e+o;f.fillUpDestinationSelector(JSON.parse(r.Destination));t.querySelector("#acceptEdition").parentNode.addEventListener("click",()=>{f.hideEditor()},!1);t.querySelector("#cancelEdition").parentNode.addEventListener("click",()=>{i.PlannedExecutionsList[u].Destination=n.PlannedExecutionsList[u].Destination,f.hideEditor()},!1)})}},f={addPlanification:t=>{const u={Id:"newPlanification",Destination:"{}",Format:0,Language:"ESP",PassportId:di,ReportId:n.Id,Scheduler:"3@00:00:00@"+window.parent.moment().add(1,"days").startOf("day").format("YYYY-MM-DD HH:mm:ss"),ViewFields:{scheduledSentence:window.parent.Globalize.formatMessage("SCHEDULE_SENTENCE"),description:window.parent.Globalize.formatMessage("NEW_SCHEDULE"),actions:"",updating:""}},r=$(t).dxDataGrid("instance");i.PlannedExecutionsList.push(u);const f=n.PlannedExecutionsList.map(n=>Object.assign({},n,n.ViewFields));r.option("onContentReady",n=>{const t=n.component.getRowIndexByKey("newPlanification");n.component.editRow(t);r.option("onContentReady",null)});r.option("dataSource",f)},addDestination:n=>{const t=i.PlannedExecutionsList.findIndex(n=>n.Id===$("#reportPlannedList").dxDataGrid("instance").option("focusedRowKey"));i.PlannedExecutionsList[t].Destination=JSON.stringify(n);$("#planificationDestinationTextBox").dxTextBox("instance").option("value",n.display||n.type)},fillUpDestinationSelector:n=>{iu=n},plannerSetValuesOfSelection:n=>{const t=$("#plannerScheduler .stepOne").dxRadioGroup("instance"),i=t.element().find(".dx-widget > .dx-item.dx-radiobutton"),r=dt.findIndex(t=>{const i=n.data.ViewFields.radioGroupIntervalOpt&&n.data.ViewFields.radioGroupIntervalOpt.range||"optHours";return t.range===i});i[r].click()},schedule:async(t,r,u)=>{if(Object.keys(r).length<1||typeof t=="undefined"||t===null){DevExpress.ui.dialog.alert(lr,ci);return}const e=window.parent.moment(r.Hour.option("value"));let s=`${t}@${e.format("HH:mm:ss")}@`,h="";switch(t){case 0:s+=`${r.Days.option("value")}`;h=`Cada ${r.Days.option("value")} días, a las ${e.format("HH:mm")}.`;break;case 4:s+=`${1}`;h=`Cada ${e.format("HH:mm")} horas.`;break;case 1:s+=`${r.Weeks.option("value")}@${r.WeekDays}`;h=`Cada ${r.Weeks.option("value")} semanas, los ${r.WeekDaysSentence}, a las ${e.format("HH:mm")}.`;break;case 2:s+=`${r.MonthlyType}@${r.MonthlyType===0?r.Day.option("value"):r.Start.option("value").value+"@"+r.WeekDay.option("value").value}`;h=r.MonthlyType===0?`El día ${r.Day.option("value")} de cada més, a las ${e.format("HH:mm")}.`:`El ${r.Start.option("value").title} ${r.WeekDay.option("value").title} de cada més, a las ${e.format("HH:mm")}.`;break;case 3:r.DateTime=window.parent.moment(e);s+=`${r.DateTime.format("YYYY/MM/DD")} 00:00:00`;h=`El ${o.getStringDate(r.DateTime,!0)}, a las ${e.format("HH:mm")}.`}const c=$("#plannerLanguage").is(":empty")?"---":$("#plannerLanguage").dxSelectBox("instance").option("value"),l=$("#plannerFormat").is(":empty")?0:$("#plannerFormat").dxSelectBox("instance").option("value"),v=s.indexOf("undefined",0);if(v>-1||!c||typeof l!="number"){DevExpress.ui.dialog.alert(lr,ci);return}const y={radioGroupIntervalOpt:{range:r.range,title:r.title},shceduledFrequency:t,scheduledSentence:h,scheduledParam:s,exportFormat:l,exportLanguage:c},p=$("#reportPlannedList").dxDataGrid("instance"),a=p.option("focusedRowKey");if(!!a){const t=i.PlannedExecutionsList.findIndex(n=>n.Id===a);if(t!=-1&&(Object.assign(i.PlannedExecutionsList[t].ViewFields,y),i.PlannedExecutionsList[t].Scheduler=s,i.PlannedExecutionsList[t].Language=c,i.PlannedExecutionsList[t].Format=l),u.row.data.ParametersJson&&JSON.parse(u.row.data.ParametersJson).filter(n=>n.TemplateName!=="hidden").length>0){const t=await o.dialogDx(co,vo,{SI:ao,NO:lo,CANCELAR:sr});if(typeof t!="undefined"){if(t){pt("editPlan");return}f.acceptExecutionParams(JSON.parse(n.PlannedExecutionsList[u.row.dataIndex].ParametersJson))}}if(i.PlannedExecutionsList.findIndex(n=>n.Id==="newPlanification")>-1){pt("newPlanification");return}return}},selectorDatetime:(n,t,i)=>{let u,f;const r=new Date;t.option("disabled",!0);i!=null&&i.option("disabled",!0);switch(n){case 0:t.option("disabled",!1);i!=null&&i.option("disabled",!1);u=()=>t.option("value");i!=null&&(f=()=>i.option("value"));break;case 1:u=window.parent.moment(r.setDate(r.getDate()+1));i!=null&&(f=u);break;case 2:u=window.parent.moment(r);i!=null&&(f=u);break;case 3:u=window.parent.moment(r.setDate(r.getDate()-1));i!=null&&(f=u);break;case 4:u=window.parent.moment(r).startOf("week");i!=null&&(f=window.parent.moment(f).endOf("week"));break;case 5:u=window.parent.moment(r).subtract(1,"weeks").startOf("week");i!=null&&(f=window.parent.moment(r).subtract(1,"weeks").endOf("week"));break;case 6:u=window.parent.moment(r).startOf("month");i!=null&&(f=window.parent.moment(f).endOf("month"));break;case 7:u=window.parent.moment(r).subtract(1,"months").startOf("month");i!=null&&(f=window.parent.moment(r).subtract(1,"months").endOf("month"));break;case 8:u=window.parent.moment(r).startOf("year");i!=null&&(f=window.parent.moment(r));break;case 9:u=window.parent.moment(r).add(1,"weeks").startOf("week");i!=null&&(f=window.parent.moment(r).add(1,"weeks").endOf("week"));break;case 10:u=window.parent.moment(r).add(1,"months").startOf("month");i!=null&&(f=window.parent.moment(r).add(1,"months").endOf("month"))}return n!==0&&(t.option("value",u.format("YYYY-MM-DD")),i!=null&&i.option("value",f.format("YYYY-MM-DD"))),{initDate:u,finalDate:f}},removeExecution:n=>{const t=n.querySelector(".executionIcon > i ").getAttribute("data-guid");i.ExecutionsList=i.ExecutionsList.filter(n=>n.Guid!==t);f.acceptEdition(!0,"executions")},description:n=>{i.Description=n},removeViewer:n=>{i.Viewers=i.Viewers.filter(t=>t.PassportId!==n),u.editReportViewers(document.querySelector("#editView"),!0)},addViewer:()=>{const f=[...document.querySelectorAll("datalist#adminusers option"),],t=document.querySelector("input#addViewerInput"),n=f.find(n=>n.value===t.value);if(!n){DevExpress.ui.dialog.alert(af,hr);return}const r=parseInt(n.getAttribute("data-userid"),10),e=n.value,o=i.Viewers.find(n=>n.PassportId===r);if(o){DevExpress.ui.dialog.alert(vf,hr);return}i.Viewers.push({Name:e,PassportId:r});u.editReportViewers(document.querySelector("#editView"),!0);t.value=""},nextEdition:()=>{i.ParametersList=o.resolveFunctionValues(i.ParametersList),rr(),s&&(f.hideEditor(),t++,pt())},previousEdition:()=>{i.ParametersList=o.resolveFunctionValues(i.ParametersList),f.hideEditor(),t--,pt()},acceptExecutionParams:async(n=false)=>{i.ParametersList=o.resolveFunctionValues(n||i.ParametersList),rr(),s&&(await hu(i.ParametersList),f.hideEditor())},acceptEdition:async(t=true,r="report")=>{if(rr(),s){const o=await uc(i,r);if(o){var e=n.Id;return n=null,i=null,await hi(e),t&&(ur(),u.singleCard(document.querySelector(".reportCard.reportCardClicked"),n),await ut(n.Id)),!0}return f.cancelEdition(t),DevExpress.ui.dialog.alert(hf,ci),!1}},cancelEdition:async(t=true)=>{var u=n.PlannedExecutionsList.findIndex(n=>n.Id===$("#reportPlannedList")?.dxDataGrid("instance")?.option("focusedRowKey")),e=n.PlannedExecutionsList[u]?.Id==="newPlanification",r;n==null||e||(r=n.Id,i=null,await hi(r));t&&(document.querySelector("#plannerPage")||ur(),f.hideEditor())},hideEditor:()=>{const n=document.querySelector("#fieldsEditor");n.style.display="none";n.style.width="";n.style.height="";const t=document.querySelector("#fieldsEditor > #editView");t&&t.remove()}},o={translateParamName:n=>{switch(n.Type){case"Robotics.Base.shiftsSelector":return bf;case"Robotics.Base.holidaysSelector":return kf;case"Robotics.Base.conceptGroupsSelector":return ar;case"Robotics.Base.conceptsSelector":return pr;case"Robotics.Base.employeesSelector":return df;case"Robotics.Base.zonesSelector":return te;case"Robotics.Base.causesSelector":return vr;case"Robotics.Base.incidencesSelector":return ne;case"Robotics.Base.viewAndFormatSelector":return fe;case"Robotics.Base.accessTypeSelector":return ee;case"Robotics.Base.filterProfileTypesSelector":return oe;case"Robotics.Base.filterSelectorCausesRegistroJL":return se;case"Robotics.Base.filterSelectorConceptsRegistroJL":return he;case"Robotics.Base.yearAndMonthSelector":return ce;case"Robotics.Base.betweenYearAndMonthSelector":return le;case"Robotics.Base.formatSelector":return vi;case"Robotics.Base.filterValuesSelector":return ae;case"Robotics.Base.terminalsSelector":return ie;case"Robotics.Base.tasksSelector":return re;case"Robotics.Base.userFieldsSelectorRadioBtn":case"Robotics.Base.userFieldsSelector":return ue;case"System.DateTime":return gf;case"Robotics.Base.projectsVSL":return we;default:return n.Name}},dialogDx:async(n,t="",i={SI:li,NO:ai})=>{let r;const u=[{text:i.SI,onClick:()=>r=!0},{text:i.NO,onClick:()=>r=!1},];!!i.CANCELAR&&u.push({text:i.CANCELAR,onClick:()=>{}});const f=DevExpress.ui.dialog.custom({showTitle:!!t,title:t,messageHtml:n,dragEnabled:!0,buttons:u});return await f.show(),r},resolveFunctionValues:n=>n.map(n=>(typeof n.Value=="function"&&(n.Value=n.Value()),n)),viewFieldsToString:n=>(n.PlannedExecutionsList.map((t,i)=>{n.PlannedExecutionsList[i].ViewFields=JSON.stringify(t.ViewFields)}),n),viewFieldsToParsed:n=>(n.PlannedExecutionsList.map((t,i)=>{while(typeof n.PlannedExecutionsList[i].ViewFields=="string")n.PlannedExecutionsList[i].ViewFields=JSON.parse(t.ViewFields||"{}")}),n),getStringDate:(n,t=false)=>{var i="DD-MM-YYYY";switch(lang){case"es-ES":case"ca-ES":case"pt-PT":case"gl-ES":case"it-IT":case"fr-FR":case"eu-ES":i="DD-MM-YYYY";break;case"en-US":default:i="MM-DD-YYYY"}const r=t?i:i+", HH: mm";return window.parent.moment(n).format(r)},iElementFontAwesome:n=>{const t=document.createElement("i");return t.setAttribute("class",n),t},getExecutionStatusClasses:n=>{let t,i;switch(n){case 1:t="executionIsInProgress";i="fa fa-spinner";break;case 4:t="executionIsFuture";i="fa fa-hourglass-o";break;case 3:t="executionIsError";i="fa fa-times";break;case 2:i="fa fa-download";t="executiuonIsFine"}return{statusClass:t,iconClass:i}},isThisWidgetSet:n=>{const t=n.find(n=>n!==null);return t!==null&&typeof t!="undefined"},removeIdNewPlanifications:()=>{let n=i.PlannedExecutionsList.findIndex(n=>n.Id==="newPlanification");while(n>-1)delete i.PlannedExecutionsList[n].Id,n=i.PlannedExecutionsList.findIndex(n=>n.Id==="newPlanification")},searchInCardsPanel:(n,t=false)=>{const i=document.querySelector("#customSearchBar");i.value=n;$(i).keyup();t&&setTimeout(()=>document.querySelector(".reportCard").click(),2e3);$(i).focus()},permissionsOverUser:n=>parseInt(tu.reportManagerPermissionByUser,10)>=n}})();