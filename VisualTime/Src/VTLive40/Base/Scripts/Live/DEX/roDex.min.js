function btnRecoverComplaintOnClick(){grecaptcha.execute()}function onDexValidationSubmit(n){let t=$("#complaintReference").dxTextBox("instance").option("value"),i=$("#password").dxTextBox("instance").option("value");t==null||t.length==0||i==null||i.length==0?DevExpress.ui.notify(jsLabels["DEX#MissingMandatoryData"],"error",5e3):n!=null&&n.length>0&&document.forms[0].submit()}function initDEX(){let n=window.location.pathname.split("/");n.length>2&&(dexPath=n[2]);document.title="cegid Visualtime";$("#sendDEX").show();$("#sendDEX1").show();$("#sendDEX2").hide();$("#sendDEXResult").hide()}function goToHome(){document.location="/DEX/"+dexPath}function invalidateCurrentSession(){$.ajax({type:"POST",url:BASE_URL+"DEX/"+dexPath+"/Logout",dataType:"json",data:{id:dexPath},success:function(n){typeof n=="string"?DevExpress.ui.notify(n,"error",5e3):location.reload()},error:function(){DevExpress.ui.notify(jsLabels["DEX#closeSessionError"],"error",5e3)}})}function btnCopyClipboard(){navigator.clipboard.writeText(currentDexView.Conversation.ReferenceNumber).then(()=>{DevExpress.ui.notify(jsLabels["DEX#complaintGuidCopied"],"success",2e3)}).catch(()=>{DevExpress.ui.notify(jsLabels["DEX#complaintGuidNotCopied"],"error",2e3)})}function btnCloseDEX(){window.location.replace(dexPath)}function btnNextDEXClick(){$("#Privacy").dxCheckBox("instance").option("value")?$("#IdentificationPwd").dxTextBox("instance").option("value")==$("#IdentificationRepeatPwd").dxTextBox("instance").option("value")?$.ajax({type:"POST",url:BASE_URL+"DEX/"+dexPath+"/ValidateData",dataType:"json",data:{id:dexPath,key:$("#IdentificationPwd").dxTextBox("instance").option("value"),email:$("#IdentificationMail").dxTextBox("instance").option("value"),phone:$("#IdentificationPhone").dxTextBox("instance").option("value")},success:function(n){typeof n=="string"?(DevExpress.ui.notify(n,"error",2e3),jsLabels["DEX#ComplaintPwdValidationError"]==n?$("#IdentificationPwd").dxTextBox("instance").focus():jsLabels["DEX#ComplaintEmailValidationError"]==n?$("#IdentificationMail").dxTextBox("instance").focus():jsLabels["DEX#ComplaintPhoneValidationError"]==n&&$("#IdentificationPhone").dxTextBox("instance").focus()):(currentDexView={Body:"",IsResponse:!1,IsAnonymous:!0,CreatedBy:0,CreatedOn:new Date,Conversation:{Title:"",IsAnonymous:!0,Password:$("#IdentificationPwd").dxTextBox("instance").option("value"),CreatedOn:new Date,ExtraData:{FullName:$("#IdentificationName").dxTextBox("instance").option("value"),Mail:$("#IdentificationMail").dxTextBox("instance").option("value"),Phone:$("#IdentificationPhone").dxTextBox("instance").option("value"),Customer:$("#IdentificationCompany").dxTextBox("instance").option("value"),Other:""}}},$("#sendDEX1").hide(),$("#sendDEX2").show(),$("#DEXMessage").dxTextArea("instance").option("value",""),$("#DEXTitle").dxTextBox("instance").option("value",""),$("#DEXTitle").dxTextBox("instance").focus())},error:function(){DevExpress.ui.notify(jsLabels["DEX#ComplaintPwdValidationError"],"error",2e3)}}):DevExpress.ui.notify(jsLabels["DEX#ComplaintPwdRepeatError"],"error",2e3):DevExpress.ui.notify(jsLabels["DEX#ComplaintPrivacyRequiered"],"error",2e3)}function btnSaveDEX(){currentDexView.Body=$("#DEXMessage").dxTextArea("instance").option("value");currentDexView.Conversation.Title=$("#DEXTitle").dxTextBox("instance").option("value");currentDexView.Body.length<6e3?currentDexView.Body.length==0||currentDexView.Conversation.Title.length==0?DevExpress.ui.notify(jsLabels["DEX#ComplaintValidationError"],"error",2e3):$.ajax({type:"POST",url:BASE_URL+"DEX/"+dexPath+"/Send",dataType:"json",data:{id:dexPath,dexMessage:currentDexView},success:function(n){typeof n=="string"?DevExpress.ui.notify(n,"error",5e3):(currentDexView=n,$("#sendDEX").hide(),$("#sendDEX1").show(),$("#sendDEX2").hide(),$("#sendDEXResult").show(),$("#DEXIdentifier").dxTextBox("instance").option("value",currentDexView.Conversation.ReferenceNumber))},error:function(){DevExpress.ui.notify(jsLabels["DEX#ComplaintMsgSaveError"],"error",2e3)}}):DevExpress.ui.notify(jsLabels["DEX#MessageTooLarge"],"error",5e3)}function createNewMessage(){let n=$("#newMsgText").dxTextArea("instance").option("value"),t=selectedComplaint;n.length<6e3?bSendingMessage||(n!=null&&n.trim().length>0?(bSendingMessage=!0,$.ajax({type:"POST",url:BASE_URL+"DEX/"+dexPath+"/AddMessage",dataType:"json",data:{IdComplaint:t,Message:n},success:function(n){bSendingMessage=!1;typeof n=="string"?DevExpress.ui.notify(n,"error",5e3):($("#newMsgText").dxTextArea("instance").option("value",""),$("#divMessagesList").load("Reload",{id:dexPath,complaintReference:selectedReference},function(){$("#divMessagesList").scrollTop($("#divMessagesList")[0].scrollHeight)}))},error:function(){bSendingMessage=!1;DevExpress.ui.notify(viewUtilsManager.DXTranslate("roChannelUnkown"),"error",5e3)}})):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roChannelEmptyMessage"),"error",3e3)):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roMessageTooLarge"),"error",5e3)}function changeMsgState(){}function calcMessageWidth(){return document.documentElement.clientWidth-"1%"}function printComplaintMessages(){var n=$("#divMessagesList").clone().addClass("print").prependTo("body");window.print();n.remove()}var currentDexView=null,dexPath=null,bSendingMessage=!1;window.addEventListener("pageshow",function(n){var t=n.persisted||typeof performance!="undefined"&&window.performance.navigation.type===2;t&&window.location.reload(!0)});$(()=>{const n=[{id:0,text:jsLabels["DEX#ComplaintAnonymous"]},{id:1,text:jsLabels["DEX#ComplaintIdentified"]}];$("#identificationOptions").length>0&&($("#IdentificationPwd").dxTextBox("instance").option("value",""),$("#IdentificationRepeatPwd").dxTextBox("instance").option("value",""),$("#identificationOptions").dxRadioGroup({items:n,valueExpr:"id",displayExpr:"text",onValueChanged(n){n.value===0?($("#identificationData").hide(),$("#IdentificationName").dxTextBox("instance").option("value",""),$("#IdentificationMail").dxTextBox("instance").option("value",""),$("#IdentificationPhone").dxTextBox("instance").option("value",""),$("#IdentificationCompany").dxTextBox("instance").option("value","")):$("#identificationData").show()}}).dxRadioGroup("instance").option("value",0));$("#privacyPolicyCTA").off("click");$("#privacyPolicyCTA").on("click",function(){$("#privacyPolicyPopup").dxPopup("instance").show()});$("#privacyPolicyPopup").dxPopup("instance").option("toolbarItems",[{widget:"dxButton",toolbar:"bottom",location:"after",options:{icon:"check",text:jsLabels["DEX#AcceptPrivacyPopup"],onClick(){$("#Privacy").dxCheckBox("instance").option("value",!0);$("#privacyPolicyPopup").dxPopup("instance").hide()}}},{widget:"dxButton",toolbar:"bottom",location:"after",options:{icon:"close",text:jsLabels["DEX#ClosePrivacyPopup"],onClick(){$("#privacyPolicyPopup").dxPopup("instance").hide()}}}])});