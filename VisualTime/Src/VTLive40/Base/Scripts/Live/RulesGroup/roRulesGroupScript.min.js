(function(){let t=null,n=null,i=[],r=[],u=[],f=[],e=null;$(document).ready(async function(){viewUtilsManager.initAccordions();viewUtilsManager.setupCardListFilterButton("RulesGroup");viewUtilsManager.print("RulesGroup Module loaded");t=viewUtilsManager.createViewStateHandler();window.RuleMng_undo=()=>fr();window.RuleMng_save=()=>or();window.RulesManager={AddRule:async t=>st(t,n),UpdateRule:async t=>ct(t,n),DeleteRule:async t=>lt(t,n),ReloadRule:async t=>at(t,n),RuleExists:async t=>ht(t,n),GetRuleHistoryItem:async(t,i)=>vt(t,n,i),GetDS:()=>n,SetDS:t=>n=t,Server:{lastServerResponse:e,validateHistoryItem:async n=>sr(n),save:async t=>hr(n,t)},Events:{onLoad:async()=>c(),refresh:async()=>di(),edit:n=>nr(n),order:n=>gi(n)},Toolbar:{Search:()=>tr(),New:()=>ur()},Data:{Tags:()=>k(),RuleGroups:()=>d(),Shifts:()=>u,RuleTypes:()=>r,ShiftGroups:()=>f}};const w=(n,t)=>{Array.isArray(n.Tags)&&n.Tags.forEach(n=>t.add(n))},b=(n,t)=>{Array.isArray(n.Rules)&&n.Rules.forEach(n=>w(n,t))},k=()=>{const n=new Set;return window.RulesManager.GetDS().forEach(t=>b(t,n)),i.forEach(t=>n.add(t.id)),Array.from(n).map(n=>({id:n})).sort((n,t)=>n.id<t.id?-1:n.id>t.id?1:void 0)},d=()=>{const n=new Map;return window.RulesManager.GetDS().forEach(t=>{n.set(t.Id,{Id:t.Id,Name:t.Name})}),Array.from(n.values())};document.addEventListener("startStateEvent",n=>g(n),!1);t.transition(t.value,"read");viewUtilsManager.loadViewOptions("RulesGroup","read",function(){window.RulesManager.Events.onLoad()},()=>{},"LiveRules");const g=()=>{},c=async()=>{setEntityChanges("RuleMng",!1),setEntityChanges("Rule",!1),sb_hasChanges("Rule",!1),sb_hasChanges("RuleMng",!1),setDeleteStatus("Rule",!1),setDeleteStatus("RuleMng",!1),await ut(),await tt(),await rt(),await it(),await ft(),nt()},nt=()=>{$("#searchRulesGroupBar").html("");const n=$("<div>").attr("id","filterToolbar").appendTo("#searchRulesGroupBar");$("<div>").attr("id","newActionPopover").appendTo("#searchRulesGroupBar");n.dxToolbar({items:[{widget:"dxSelectBox",location:"before",options:{elementAttr:{id:"dashboardViewType"},placeholder:getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_View","RulesGroup"),stylingMode:"outlined",width:200,items:[{id:1,name:getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_Rule","RulesGroup")},{id:2,name:getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_Shift","RulesGroup")}],valueExpr:"id",displayExpr:"name",value:1,onValueChanged:()=>window.RulesManager.Events.refresh()}},{widget:"dxTextBox",location:"before",options:{elementAttr:{id:"dashboardTextFilter"},placeholder:getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_WriteToSearch","RulesGroup"),stylingMode:"text",width:420,value:null,onValueChanged:()=>window.RulesManager.Events.refresh()}},{widget:"dxDateBox",location:"before",options:{elementAttr:{id:"dashboardDateFilter"},placeholder:getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_SelectDate","RulesGroup"),stylingMode:"outlined",width:180,type:"date",displayFormat:getDateLocalizationFormats().format,value:new Date,showClearButton:!0,onValueChanged:()=>window.RulesManager.Events.refresh()}},{widget:"dxTagBox",location:"after",options:{elementAttr:{id:"dashboardShiftFilter"},width:200,value:null,multiline:!1,showMultiTagOnly:!0,maxDisplayedTags:1,hideSelectedItems:!1,placeholder:getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_Shifts","RulesGroup"),valueExpr:"Id",displayExpr:"Name",searchEnabled:!0,searchExpr:"Name",searchMode:"contains",showClearButton:!0,items:window.RulesManager.Data.Shifts(),onValueChanged:()=>window.RulesManager.Events.refresh()}},{widget:"dxTagBox",location:"after",options:{elementAttr:{id:"dashboardRuleTypeFilter"},width:200,value:null,multiline:!1,showMultiTagOnly:!0,maxDisplayedTags:1,hideSelectedItems:!1,placeholder:getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_Types","RulesGroup"),valueExpr:"Id",displayExpr:"Name",searchEnabled:!0,searchExpr:"Name",searchMode:"contains",showClearButton:!0,items:window.RulesManager.Data.RuleTypes(),onValueChanged:()=>window.RulesManager.Events.refresh()}},{widget:"dxTagBox",location:"after",options:{elementAttr:{id:"dashboardTagFilter"},width:200,value:null,multiline:!1,showMultiTagOnly:!0,maxDisplayedTags:1,hideSelectedItems:!1,placeholder:getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_Tags","RulesGroup"),valueExpr:"id",displayExpr:"id",searchEnabled:!0,searchExpr:"id",searchMode:"contains",showClearButton:!0,items:window.RulesManager.Data.Tags(),onValueChanged:()=>window.RulesManager.Events.refresh()}},{widget:"dxButton",location:"after",options:{visible:!1,icon:"search",onClick:()=>window.RulesManager.Toolbar.Search()}},{widget:"dxButton",location:"after",options:{elementAttr:{id:"btn_createNewRule"},icon:"add",onClick:()=>window.RulesManager.Toolbar.New()}}]})},tt=async()=>{await $.ajax({url:`${BASE_URL}Tag/GetCustomTagBox?type=rulettypes`,data:{},type:"GET",dataType:"json",success:n=>{typeof n=="object"&&n!=null?r=n:DevExpress.ui.notify(getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_UnknownError","RulesGroup"),"error",2e3)},error:n=>console.error(n)})},it=async()=>{await $.ajax({url:`${BASE_URL}Tag/GetCustomTagBox?type=shiftgroups`,data:{},type:"GET",dataType:"json",success:n=>{typeof n=="object"&&n!=null?f=n:DevExpress.ui.notify(getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_UnknownError","RulesGroup"),"error",2e3)},error:n=>console.error(n)})},rt=async()=>{await $.ajax({url:`${BASE_URL}Tag/GetCustomTagBox?type=shifts`,data:{},type:"GET",dataType:"json",success:n=>{typeof n=="object"&&n!=null?u=n:DevExpress.ui.notify(getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_UnknownError","RulesGroup"),"error",2e3)},error:n=>console.error(n)})},ut=async()=>{await $.ajax({url:`${BASE_URL}Tag/GetAvailableTags`,data:{},type:"GET",dataType:"json",success:n=>{typeof n=="object"&&n!=null?i=n:DevExpress.ui.notify(getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_UnknownError","RulesGroup"),"error",2e3)},error:n=>console.error(n)})},ft=async()=>{let n=n=>{window.RulesManager.SetDS(n),window.RulesManager.Events.refresh()};await $.ajax({url:`${BASE_URL}RulesGroup/GetDashboard`,data:{filter:{}},type:"POST",dataType:"json",success:t=>{typeof t=="object"&&t!=null?t.Success?n(t.Data):DevExpress.ui.notify(t.ErrorText,"error",2e3):DevExpress.ui.notify(getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_UnknownError","RulesGroup"),"error",2e3)},error:n=>console.error(n)})},l=n=>{if(!n||n.length===0)return-1;let t=n.reduce((n,t)=>t.Id<n?t.Id:n,n[0].Id);return t>0&&(t=0),t-1},et=n=>!n.Rules||!Array.isArray(n.Rules)?[]:n.Rules,ot=n=>{if(!n||n.length==0)return-1;let t=Infinity;const i=[];return(n.forEach(n=>{const t=et(n);i.push(...t)}),i.length===0)?-1:(t=Math.min(...i.map(n=>n.Id)),t>0&&(t=0),t-1)},st=async(n,t)=>{if(!n||!t)return!1;const i=t.find(t=>t.Id===n.GroupId);if(i!=null)i.Rules.push(n);else{const i={Id:l(t),Name:n.GroupName||getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_NewGroup","RulesGroup"),Rules:[n],EditionStatus:3};t.push(i)}return s(),window.RulesManager.Events.refresh(),!0},ht=async(n,t)=>{if(!n||!t)return!1;for(const i of t){const t=i.Rules.findIndex(t=>t.Id===n.Id);if(t!==-1)return!0}return!1},ct=async(n,t)=>{if(!n||!t)return!1;let i=!1;for(const r of t){const u=r.Rules.findIndex(t=>t.Id===n.Id);if(u!==-1){if(i=!0,n.EditionStatus!==3&&(n.EditionStatus=1),r.Id===n.GroupId)r.Rules[u]={...r.Rules[u],...n};else{r.Rules.splice(u,1);const i=t.find(t=>t.Id===n.GroupId);if(i)i.Rules.push(n);else{const i={Id:l(t),Name:n.GroupName||getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_NewGroup","RulesGroup"),Rules:[n],EditionStatus:3};t.push(i)}}break}}return s(),window.RulesManager.Events.refresh(),i},lt=async(n,t)=>{if(!n||!t)return!1;let i=!1;for(const r of t){const t=r.Rules.findIndex(t=>t.Id===n.Id);if(t!==-1){n.EditionStatus=2;r.Rules[t]={...r.Rules[t],...n};i=!0;break}}return s(),window.RulesManager.Events.refresh(),i},at=async(n,t)=>{let r=n.Id,i=h(t,r);i!=null&&window.Rule.SetValue(i)},vt=async(n,t,i)=>{let u=n.Id,r=h(t,u);if(r!=null){const t=r.RuleDefinitions.findIndex(n=>n.Id===i);t!==-1?(n.RuleDefinitions[t]={...r.RuleDefinitions[t]},window.Rule.SetValue(n)):(n.RuleDefinitions.find(n=>n.Id==i).Description="",n.RuleDefinitions.find(n=>n.Id==i).EffectiveFrom=dateToJsonIsoString((new Date).getTime()),n.RuleDefinitions.find(n=>n.Id==i).Shifts=[],n.RuleDefinitions.find(n=>n.Id==i).EmployeeContext=null,window.Rule.SetValue(n))}},yt=(n,t)=>typeof n.EditionStatus!="undefined"&&n.EditionStatus===2?!1:pt(n,t.keyword)?wt(n,t.types)?bt(n,t.tags)?(n.RuleDefinitions=kt(n.RuleDefinitions,t),n.RuleDefinitions.length>0):!1:!1:!1,pt=(n,t)=>{if(!t||t.trim()==="")return!0;if(!n)return!1;const i=t.toLowerCase().trim(),r=n.Name?n.Name.toLowerCase().includes(i):!1,u=n.Description?n.Description.toLowerCase().includes(i):!1;return r||u},wt=(n,t)=>!t||t.length===0||t.includes(n.Type),bt=(n,t)=>!t||t.length===0||n.Tags.some(n=>t.includes(n)),kt=(n,t)=>n.filter(n=>dt(n,t.date)?gt(n,t.shifts):!1),dt=(n,t)=>{const i=moment(n.EffectiveFrom).toDate(),r=n.EffectiveUntil?moment(n.EffectiveUntil).toDate():new Date(9999,11,31);return t>=i&&t<=r},gt=(n,t)=>!t||t.length===0||n.Shifts.some(n=>t.includes(n.IdShift)),ni=(n,t)=>{if(!t||!n)return n;for(let i of n)i.Rules=i.Rules.filter(n=>yt(n,t));return n.filter(n=>n.Rules.length>0)},o=()=>{const n={},t=$("#dashboardViewType").dxSelectBox("instance");n.selectedOption=t?t.option("value"):1;const i=$("#dashboardDateFilter").dxDateBox("instance");n.date=i?i.option("value"):new Date;const r=$("#dashboardTextFilter").dxTextBox("instance");n.keyword=r?r.option("value"):"";const u=$("#dashboardShiftFilter").dxTagBox("instance");n.shifts=u?u.option("value"):[];const f=$("#dashboardRuleTypeFilter").dxTagBox("instance");n.types=f?f.option("value"):[];const e=$("#dashboardTagFilter").dxTagBox("instance");return n.tags=e?e.option("value"):[],n},s=()=>{const n=$("#dashboardTagFilter").dxTagBox("instance");n.option("items",window.RulesManager.Data.Tags());n.repaint()},h=(n,t)=>{for(const i of n){const n=i.Rules.find(n=>n.Id===t);if(n)return structuredClone(n)}return null},ti=()=>parseInt(o().selectedOption,10)==1?si():hi(),a=()=>{let n=o(),t=structuredClone(window.RulesManager.GetDS());return ni(t,n)},ii=(n,t)=>({id:n.Id,groupName:t,ruleName:n.Name,type:n.Type,tags:n.Tags}),ri=(n,t)=>({id:n.Id,name:n.Name,description:n.Description,type:n.Type,tags:n.Tags,shift:t.IdShift,groupName:t.IdShiftGroup,order:t.Order}),ui=(n,t)=>{n.Rules&&Array.isArray(n.Rules)&&n.Rules.forEach(i=>{t.push(ii(i,n.Name))})},fi=(n,t,i)=>{t.Shifts&&Array.isArray(t.Shifts)&&t.Shifts.forEach(t=>{i.push(ri(n,t))})},ei=(n,t)=>{if(n.RuleDefinitions&&Array.isArray(n.RuleDefinitions)){const i=n.RuleDefinitions[0];i&&fi(n,i,t)}},oi=(n,t)=>{n.Rules&&Array.isArray(n.Rules)&&n.Rules.forEach(n=>{ei(n,t)})},si=()=>{const n=[];return a().forEach(t=>ui(t,n)),n},hi=()=>{let t=a();const n=[];return t.forEach(t=>{oi(t,n)}),n.sort((n,t)=>n.groupName<t.groupName?-1:n.groupName>t.groupName?1:n.shift<t.shift?-1:n.shift>t.shift?1:n.order-t.order),n},ci=n=>{if(!n||!Array.isArray(n)||n.length===0)return $();const t=$("<div style='display:flex; flex-wrap:wrap; gap:5px;'>");return n.forEach(n=>{t.append(li(n))}),t},li=n=>$("<div>").text(n).css({padding:"2px 8px","background-color":"#f0f0f0","border-radius":"12px","font-size":"12px",border:"1px solid #e0e0e0",color:"#666","white-space":"nowrap"}),ai=n=>$("<div style='line-height:20px'>").text(n.value),vi=n=>{let t=$("<div style='line-height:20px;margin-left:auto'>");return t.append($("<button style='margin-left:auto;margin-right:10px'>").addClass("dx-button").addClass("dx-button-mode-contained").addClass("dx-button-success").text(getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_btnEdit","RulesGroup")).on("click",t=>{t.stopPropagation(),window.RulesManager.Events.edit(n)}))},yi=n=>{const t=window.RulesManager.Data.Shifts().find(t=>t.Id===n.data.key);if(!t)return"unknown";let i=$("<div style='display:flex; flex-direction:row' >"),r=$("<span>").text(t.Name).css("margin-right","10px"),u=$("<button style='margin-left:auto;margin-right:10px'>").addClass("dx-button").addClass("dx-button-mode-contained").text(getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_btnOrder","RulesGroup")).on("click",function(t){t.stopPropagation();const i=n.data?.items?.[0]??n.data?.collapsedItems?.[0],r=i?.items?.[0]??i?.collapsedItems?.[0];window.RulesManager.Events.order(r)});return i.append(r).append(u)},v=n=>{let t=$("<div style='display:flex; flex-direction:row; gap:10px'>");return t.append(ai(n)),typeof n.data!="undefined"&&typeof n.data.tags!="undefined"&&n.data.tags.length>0&&t.append(ci(n.data.tags)),t.append(vi(n.data)),t},y=n=>{const t=window.RulesManager.Data.RuleTypes().find(t=>t.Id===n.data.key);if(t!=null){let n=$("<div style='display:flex; flex-direction:row' >"),i=$("<span>").text(t.Name).css("margin-right","10px");return n.append(i)}return"unknown"},pi=n=>{const t=window.RulesManager.Data.ShiftGroups().find(t=>t.Id===n.data.key);if(!t)return"unknown";let i=$("<div style='display:flex; flex-direction:row' >"),r=$("<span>").text(t.Name).css("margin-right","10px");return i.append(r)},wi=n=>{let t=$("<div style='display:flex; flex-direction:row' >"),i=$("<span>").text(n.text).css("margin-right","10px");return t.append(i)},bi=n=>{$("#rulesGroupDashboard").dxDataGrid({dataSource:n,keyExpr:"id",showBorders:!0,rowAlternationEnabled:!0,grouping:{autoExpandAll:!0},groupPanel:{visible:!0},paging:{enabled:!1},sorting:{enabled:!1},searchPanel:{visible:!1},columns:[{dataField:"groupName",groupIndex:0,groupCellTemplate:function(n,t){n.html("").append(wi(t))}},{dataField:"type",groupIndex:1,sortOrder:"desc",allowSorting:!1,groupCellTemplate:function(n,t){n.html("").append(y(t))}},{dataField:"ruleName",cellTemplate:function(n,t){n.append(v(t))}}],rowDragging:{allowReordering:!1},onRowDblClick:function(n){n.rowType==="data"&&(n.event.preventDefault(),window.RulesManager.Events.edit(n.data))}})},ki=n=>{$("#rulesGroupDashboard").dxDataGrid({dataSource:n,keyExpr:"id",showBorders:!0,rowAlternationEnabled:!0,grouping:{autoExpandAll:!0},groupPanel:{visible:!0},paging:{enabled:!1},sorting:{enabled:!1},searchPanel:{visible:!1},columns:[{dataField:"groupName",groupIndex:0,groupCellTemplate:function(n,t){n.html("").append(pi(t))}},{dataField:"shift",groupIndex:1,groupCellTemplate:function(n,t){n.html("").append(yi(t))}},{dataField:"type",groupIndex:2,sortOrder:"desc",allowSorting:!1,groupCellTemplate:function(n,t){n.html("").append(y(t))}},{dataField:"name",cellTemplate:function(n,t){n.append(v(t))}}],rowDragging:{allowReordering:!1},onRowDblClick:function(n){if(n.rowType==="data")n.event.preventDefault(),window.RulesManager.Events.edit(n.data);else if(n.rowType==="group"&&n.groupIndex===1){n.event.preventDefault();const t=n.data?.items?.[0]??n.data?.collapsedItems?.[0],i=t?.items?.[0]??t?.collapsedItems?.[0];window.RulesManager.Events.order(i)}}})},di=async()=>{const n=ti();parseInt(o().selectedOption,10)==1?bi(n):ki(n)},gi=()=>{DevExpress.ui.notify("Ordenar horarios","success",2e3)},nr=n=>{let i=n.id,t=h(window.RulesManager.GetDS(),i);t==null?DevExpress.ui.notify(getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_UnknownError","RulesGroup"),"error",2e3):(window.Rule.SetValue(structuredClone(t)),$("#ruleFrm").dxPopup("instance").show())},tr=async()=>{},ir=()=>{$("#listaOpciones").dxList({items:window.RulesManager.Data.RuleTypes(),height:"auto",itemTemplate:function(n){return $("<div>").addClass("list-item").append($("<span>").text(n.Name).css("margin-left","10px")).css({display:"flex","align-items":"center",padding:"8px 0"})},onItemClick:function(n){rr(n.itemData)}})},rr=n=>{$("#newActionPopover").dxPopover("instance").hide(),window.Rule.SetValue({Id:ot(window.RulesManager.GetDS()),Name:"",Type:n.Id,RuleDefinitions:[{Id:-1,Description:getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_NewHistoricRule","RulesGroup"),EffectiveFrom:dateToJsonIsoString(moment().startOf("day").toDate()),EffectiveUntil:null,EditionStatus:3}],EditionStatus:3}),$("#ruleFrm").dxPopup("instance").show()},ur=async()=>{$("#newActionPopover").html(""),$("#newActionPopover").dxPopover({target:"#btn_createNewRule",position:"bottom",width:250,showTitle:!1,visible:!1,contentTemplate:function(n){$("<div id='listaOpciones'>").appendTo(n);ir()}}),$("#newActionPopover").dxPopover("instance").show()},fr=async()=>(c(),{Success:!0,Data:null,ErrorText:""}),er=n=>{function r(n,t){e(n,t)&&(u(n.Rules,t,o),u(n.RuleDefinitions,t,s),u(n.Shifts,t,h),u(n.Actions,t,c),u(n.Conditions,t,l))}function e(n,t){return n.EditionStatus===undefined?!0:(n.EditionStatus>0&&f.push({Path:t,Action:n.EditionStatus}),n.EditionStatus!==2)}function u(n,t,i){Array.isArray(n)&&n.forEach((n,r)=>{n&&typeof n=="object"&&i(n,r,t)})}function o(n,u,f){const e=n.EditionStatus===0?"":`(${i[n.EditionStatus]})`,o=`${f} > ${t.rule}: ${n.Name}${e}`;r(n,o)}function s(n,u,f){const e=n.EditionStatus===0?"":`(${i[n.EditionStatus]})`,o=`${f} > ${t.definition}: ${moment(n.EffectiveFrom).format(getDateLocalizationFormats().moment)} - ${n.Description}${e}`;r(n,o)}function h(n,u,f){const e=n.EditionStatus===0?"":`(${i[n.EditionStatus]})`,o=`${n.ShiftName}: ${t.order}: ${n.Order}${e}`,s=`${f} > ${t.shift}: ${o}`;r(n,s)}function c(n,u,f){const e=n.EditionStatus===0?"":`(${i[n.EditionStatus]})`,o=`${f} > ${t.action}[${u}]${e}`;r(n,o)}function l(n,u,f){const e=n.EditionStatus===0?"":`(${i[n.EditionStatus]})`,o=`${f} > ${t.condition}[${u}]${e}`;r(n,o)}const f=[];let i={0:getTextFromCatalog(undefined,`editionStatus_0`,""),1:getTextFromCatalog(undefined,`editionStatus_1`,""),2:getTextFromCatalog(undefined,`editionStatus_2`,""),3:getTextFromCatalog(undefined,`editionStatus_3`,"")},t={group:getTextFromCatalog(undefined,"editionStatus_Grupo",""),rule:getTextFromCatalog(undefined,"editionStatus_Rule",""),definition:getTextFromCatalog(undefined,"editionStatus_Definition",""),order:getTextFromCatalog(undefined,`editionStatus_Order`,""),shift:getTextFromCatalog(undefined,`editionStatus_Shift`,""),action:getTextFromCatalog(undefined,`editionStatus_Action`,""),condition:getTextFromCatalog(undefined,`editionStatus_Condition`,"")};return n.forEach(n=>{const u=n.EditionStatus===0?"":`(${i[n.EditionStatus]})`;r(n,`${t.group}: ${n.Name}${u}`)}),f},or=async()=>{let n=er(window.RulesManager.GetDS());if(n.length>0){let i=n.map(n=>`<li>${n.Path}</li>`).join(""),r=`<div style="max-width:640px;">
                                  <div style="color:#b94a48;margin-bottom:8px;">
                                    <strong>${getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_Attention","RulesGroup")}:</strong> ${getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_WarnAboutChanges","RulesGroup")}
                                  </div>
                                  <div style="margin-bottom:8px;">${getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_ChangesDetected","RulesGroup")}:</div>
                                  <ul style="max-height:220px;overflow-y:auto;padding-left:18px;margin-bottom:8px;border:1px solid #eee;background:#fafafa;">
                                      ${i}
                                  </ul>
                                  <div style="margin-top:12px;">${getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_ValidateSave","RulesGroup")}</div>
                              </div>`,t=await DevExpress.ui.dialog.confirm(r,`${getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_ConfirmSave","RulesGroup")}`);return t?(t=t&&await window.RulesManager.Server.save(n),t&&DevExpress.ui.notify(getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_SaveOK","RulesGroup"),"success",2e3),{Success:t,Data:null,ErrorText:""}):{Success:!1,Data:null,ErrorText:getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_CancelByUser","RulesGroup")}}return{Success:!0,Data:null,ErrorText:""}},p=n=>{let t=!1;return window.RulesManager.lastServerResponse=n,typeof n=="object"&&n!=null?n.Success?t=!0:DevExpress.ui.notify(n.ErrorText,"error",2e3):DevExpress.ui.notify(getTextFromCatalog(window.RuleGroups.i18n,"roRuleDashboard_UnknownError","RulesGroup"),"error",2e3),t},sr=async n=>{let t=!1;return await $.ajax({url:`${BASE_URL}Rule/ValidateRuleHistory`,data:{historyEntry:n},type:"POST",dataType:"json",success:n=>{t=p(n)},error:n=>console.error(n)}),t},hr=async(n,t)=>{let i=!1;return await $.ajax({url:`${BASE_URL}RulesGroup/SaveDashboard`,data:{scenario:n,changes:t},type:"POST",dataType:"json",success:n=>{i=p(n)},error:n=>console.error(n)}),i}})})();