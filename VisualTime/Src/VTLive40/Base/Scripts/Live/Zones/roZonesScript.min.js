function getWidth(){return document.documentElement.clientWidth-40}function getHeight(){return document.documentElement.clientHeight-40}function OnZoneClick(n){n!=null&&n.rowType!="header"&&n.columnIndex!=0&&n.rowType=="data"&&($("#idZoneEdit").val(n.data.ID),openEditZonePopUp())}function selectZoneByDefault(n){firstLoad&&(n.component.selectRowsByIndexes([0]),firstLoad=!1)}function onZoneLocationWorkingModeChanged(){let t=$("#ckZoneLocationWorkingMode").dxSwitch("instance"),n=t.option("value");n?$(".sectionMap").hide():$(".sectionMap").show();let i=$("#gridZones").dxDataGrid("instance"),r=i.option("columns");r.find(function(n){return n.dataField=="IpsRestriction"}).visible=n;i.option("columns",r);ipInitialized&&$.ajax({type:"POST",url:BASE_URL+"Zones/SetIpRestrictionStatus",dataType:"json",data:{status:n},success:function(i){typeof i=="string"&&(ipInitialized=!1,t.option("value",!n),DevExpress.ui.notify(i,"error",5e3),setTimeout(function(){ipInitialized=!0},500))},error:function(){}})}function selection_changed(){let n=$("#gridZones").dxDataGrid("instance"),t=n.getSelectedRowsData();updateGlobalMap(t)}function RefreshZonesList(){let n=$("#gridZones").dxDataGrid("instance");n.refresh()}function initializeGlobalMap(n){mapInitialized||(globalMap=n.originalMap,navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){let t={lat:n.coords.latitude,lng:n.coords.longitude};$("#globalMap").dxMap({center:t})}),mapInitialized=!0)}function deleteAllShape(){for(const n of allzones)n.setMap(null);allzones=[]}function updateGlobalMap(n){let i=$("#ckZoneLocationWorkingMode").dxSwitch("instance"),r=i.option("value");if(!r){dynamicZoomBounds=[];deleteAllShape();for(const t of n){let n=t.GoogleMapInfo;n!=null&&globalMap!=null&&(globalMap.setCenter(new google.maps.LatLng(n.Center.Latitud.toString(),n.Center.Longitud.toString())),globalMap.setZoom(n.Zoom),n.Coordinates.length>0&&(n.Shape==_RECTANGLE_SHAPE?drawGlobalMapRectZone(n,t.Color):n.Shape==_POLYGON_SHAPE&&drawGlobalMapPolyZone(n,t.Color)))}let t=new google.maps.LatLngBounds;for(const n of dynamicZoomBounds)t.extend(n);dynamicZoomBounds.length>0&&globalMap.fitBounds(t)}}function updateMainMapDrawedRectangle(n){drawedMainMapRectangle.setOptions(n)}function updateMainMapDrawedPolygon(n){drawedMainMapPolygon.setOptions(n)}function drawGlobalMapRectZone(n,t){let u=parseFloat(n.Coordinates[0].Latitud),f=parseFloat(n.Coordinates[0].Longitud),e=parseFloat(n.Coordinates[1].Latitud),o=parseFloat(n.Coordinates[1].Longitud),s=new google.maps.LatLngBounds(new google.maps.LatLng(e,o),new google.maps.LatLng(u,f));drawedMainMapRectangle=new google.maps.Rectangle({bounds:s,map:globalMap});let i=decimalToRgb(parseInt(t)),r=rgbToHex(i.red,i.green,i.blue),h={strokeColor:r,fillColor:r,fillOpacity:.2};updateMainMapDrawedRectangle(h);allzones.push(drawedMainMapRectangle);for(const t of n.Coordinates)dynamicZoomBounds.push(new google.maps.LatLng(t.Latitud,t.Longitud))}function drawGlobalMapPolyZone(n,t){var u,f;const r=[];for(let t=0;t<n.Coordinates.length;t++)u=parseFloat(n.Coordinates[t].Latitud),f=parseFloat(n.Coordinates[t].Longitud),r.push(new google.maps.LatLng(u,f));drawedMainMapPolygon=new google.maps.Polygon({paths:r,map:globalMap});var i=decimalToRgb(parseInt(t)),e=rgbToHex(i.red,i.green,i.blue),o={strokeColor:e,fillColor:e,fillOpacity:.2};updateMainMapDrawedPolygon(o);allzones.push(drawedMainMapPolygon);for(let t=0;t<n.Coordinates.length;t++)dynamicZoomBounds.push(new google.maps.LatLng(n.Coordinates[t].Latitud,n.Coordinates[t].Longitud))}function decimalToRgb(n){return{red:n>>16&255,green:n>>8&255,blue:n&255}}function componentToHex(n){var t=n.toString(16);return t.length==1?"0"+t:t}function rgbToHex(n,t,i){return"#"+componentToHex(n)+componentToHex(t)+componentToHex(i)}function dbCoordsArray2JSON(n){for(var t=0,i="[",t=0;t<n.length;t++)i+=t<n.length-1?JSON.stringify({Latitud:n[t].Latitud,Longitud:n[t].Longitud})+",":JSON.stringify({Latitud:n[t].Latitud,Longitud:n[t].Longitud});return i+"]"}function mapCoordsArray2JSON(n){for(var t=0,i="[",t=0;t<n.length;t++)i+=t<n.length-1?JSON.stringify({Latitud:n[t].lat(),Longitud:n[t].lng()})+",":JSON.stringify({Latitud:n[t].lat(),Longitud:n[t].lng()});return i+"]"}function selectPresenceZoneChanged(n){var t=$("#selectPresenceZone").dxSelectBox("option","value");$.ajax({type:"GET",url:BASE_URL+"Zones/LoadEmployeesInZone",contentType:"application/json; charset=utf-8",data:{id:t},success:function(t){$("#lstPresentsInZone").dxList({dataSource:new DevExpress.data.DataSource({store:{type:"array",data:t,key:"ID"},paginate:!0,pageSize:57,pageLoadMode:"scrollBottom"})});n.component.close()}})}function onSelectPresenceZoneLoaded(n){n.component.getDataSource()._store._array!=null&&n.component.getDataSource()._store._array.length>0&&$("#selectPresenceZone").dxSelectBox("option","value",n.component.getDataSource()._store._array[0].ID)}function selectAbsenceZoneChanged(n){var t=$("#selectAbsenceZone").dxSelectBox("option","value");$.ajax({type:"GET",url:BASE_URL+"Zones/LoadEmployeesInZoneLastHour",contentType:"application/json; charset=utf-8",data:{id:t},success:function(t){$("#lstAbsentsInZone").dxList({dataSource:new DevExpress.data.DataSource({store:{type:"array",data:t,key:"ID"},paginate:!0,pageSize:57,pageLoadMode:"scrollBottom"})});n.component.close()}})}function onSelectAbsenceZoneLoaded(n){n.component.getDataSource()._store._array!=null&&n.component.getDataSource()._store._array.length>0&&$("#selectAbsenceZone").dxSelectBox("option","value",n.component.getDataSource()._store._array[0].ID)}function onEmployeesInZoneInitialized(n){n.component.option("items").length>20&&n.element.addClass("minimize")}function onEmployeesAbsentsInZoneInitialized(n){n.component.option("items").length>20&&n.element.addClass("minimize")}var drawedMainMapRectangle,drawedMainMapPolygon,globalMap,allzones=[],isFirstShape,dynamicZoomBounds=[],firstLoad=!0,mapInitialized=!1,ipInitialized=!1;const _RECTANGLE_SHAPE="rectangle",_POLYGON_SHAPE="polygon";$(document).ready(function(){ipInitialized=!1;let n=$("#gridZones").dxDataGrid("instance");n.option("pager.displayMode","compact");n.option("scrolling.RowRenderingMode","1");onZoneLocationWorkingModeChanged();ipInitialized=!0});