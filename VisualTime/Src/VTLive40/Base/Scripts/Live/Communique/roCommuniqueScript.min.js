function addImageShown(){var t=$("#messageEditor").dxHtmlEditor("instance"),n;currentFormat=t.getFormat();n=t.getSelection();cursorIndex=n?n.index:0;cursorLength=n?n.length:0;currentFormat.imageSrc?($("#txtImageURL").dxTextBox("instance").option("value",currentFormat.imageSrc),$("#txtHeightImage").dxTextBox("instance").option("value",currentFormat.height),$("#txtWidthImage").dxTextBox("instance").option("value",currentFormat.width),$("#txtAltImage").dxTextBox("instance").option("value",currentFormat.alt)):($("#txtImageURL").dxTextBox("instance").option("value",null),$("#txtHeightImage").dxTextBox("instance").option("value",null),$("#txtWidthImage").dxTextBox("instance").option("value",null),$("#txtAltImage").dxTextBox("instance").option("value",null))}function cancelImage(){var n=$("#addImagePopup").dxPopup("instance");n.hide()}function addImage(){var n=$("#txtImageURL").dxTextBox("instance").option("value"),i=$("#txtHeightImage").dxTextBox("instance").option("value"),r=$("#txtWidthImage").dxTextBox("instance").option("value"),f=$("#txtAltImage").dxTextBox("instance").option("value"),t,u;n==null||n==""?DevExpress.ui.notify(window.parent.Globalize.formatMessage("roCommuniqueeEmptyImageURLError"),"error",3e3):isBase64(n)?checkOnlyDigitsOrEmpty(i)&&checkOnlyDigitsOrEmpty(r)?(t=$("#messageEditor").dxHtmlEditor("instance"),!currentFormat.imageSrc||t.delete(cursorIndex-1,1),t.insertEmbed(cursorIndex,"extendedImage",{src:n,alt:f,width:r,height:i}),u=$("#addImagePopup").dxPopup("instance"),u.hide()):DevExpress.ui.notify(window.parent.Globalize.formatMessage("roCommuniqueeInvalidMeasureError"),"error",3e3):DevExpress.ui.notify(window.parent.Globalize.formatMessage("roCommuniqueeInvalidImageURLError"),"error",3e3)}function isBase64(n){if(n===""||n.trim()==="")return!1;try{return btoa(atob(n.split(",")[1]))==n.split(",")[1]}catch(t){return!1}}function checkImage(n){return n.match(/\.(jpeg|jpg|gif|png)$/)!=null}function checkOnlyDigitsOrEmpty(n){return n==null||n==""?!0:n.match(/^[0-9]*$/)!=null?!0:!1}(function(){async function a(){let i=!0;if(n.selectedCommunique===-1&&n.inEdition===!0&&(i=await DevExpress.ui.dialog.confirm(si,c),t(!1)),n.inEdition===!0&&(i=await DevExpress.ui.dialog.confirm(nt,c),t(!1)),i){delete n.communiques[-1];const t=$(this).find(".communiqueCardInfo").attr("data-communique-id"),i=await hf(t);n.selectedCommunique=t;ni({message:st,config:k,commReadOnly:ht,confReadOnly:ct,statistics:lt},n.communiques[n.selectedCommunique],n);g("div.switchMainViewTabs",!i&&n.communiques[t]||i);tf($(this))}else return}function yt(n=""){const t=document.querySelector("#CardView_DXSE_I");t.value=t.value===`${h.value}${n}`?`${h.value}`:`${h.value}${n}`;t.onchange();v()}function gt(n){n.parentNode.style.height=`${window.innerHeight-250}px`}function df(n){var t=new ExcelJS.Workbook,i=t.addWorksheet("Main sheet");DevExpress.excelExporter.exportDataGrid({worksheet:i,component:n.component,customizeCell:function(n){n.excelCell.font={name:"Arial",size:12};n.excelCell.alignment={horizontal:"left"}}}).then(function(){t.xlsx.writeBuffer().then(function(n){saveAs(new Blob([n],{type:"application/octet-stream"}),"estado.xlsx")})})}function gf(n){const t=document.createElement("div"),i=n.parentNode;return t.classList.add("scrollPanelLayer"),i.appendChild(t),i.style.verticalAlign="top",i.style.position="relative",new IntersectionObserver(n=>{t.style.opacity=n[0].isIntersecting&&n[0].intersectionRatio>=.5?0:1},{root:n,threshold:[0,.5,1]})}const ri=window.parent.Globalize.formatMessage("AL_LLEGAR_A_LA_FECHA_Y_HORA"),ui=window.parent.Globalize.formatMessage("CUANDO_QUIERES_ENVIAR"),fi=window.parent.Globalize.formatMessage("CUANDO_HAYAN_RESPONDIDO_MAS_DEL"),ei=window.parent.Globalize.formatMessage("ES_OBLIGATORIO_LEER_Y_CONTESTAR_AL_ENTRAR_A_VISUAL_TIME_PORTAL"),oi=window.parent.Globalize.formatMessage("COLGAR_EN_EL_TABLON_DE_ANUNCIOS"),si=window.parent.Globalize.formatMessage("ASEGURESE_DE_GUARDAR_CAMBIOS_QUIERE_PERDER_NUEVO_COMUNICADO"),c=window.parent.Globalize.formatMessage("GUARDAR_COMUNICADO"),y=window.parent.Globalize.formatMessage("ENVIAR_COMUNICADO"),hi=window.parent.Globalize.formatMessage("CANCELAR_COMUNICADO"),nt=window.parent.Globalize.formatMessage("QUIERE_SEGUIR_PERDER_CAMBIOS"),ci=window.parent.Globalize.formatMessage("NO_SE_HA_PODIDO_CANCELAR"),li=window.parent.Globalize.formatMessage("NO_SE_HA_PODIDO_REACTIVAR"),ai=window.parent.Globalize.formatMessage("REACTIVAR_COMUNICADO"),tt=window.parent.Globalize.formatMessage("PARA_MANDAR_COMUNICADO_DEBE_CONTENER"),vi=window.parent.Globalize.formatMessage("PARA_MANDAR_COMUNICADO_DEBE_TENER_DESTINATARIOS"),p=window.parent.Globalize.formatMessage("ASUNTO"),it=window.parent.Globalize.formatMessage("MENSAJE"),yi=window.parent.Globalize.formatMessage("ELIMINAR_COMUNICADO"),pi=window.parent.Globalize.formatMessage("SEGURO_QUIERE_ELIMINAR_COMUNICADO"),wi=window.parent.Globalize.formatMessage("roEmployeeName"),ne=window.parent.Globalize.formatMessage("roActualGroup"),l=window.parent.Globalize.formatMessage("COMUNICADO"),bi=window.parent.Globalize.formatMessage("ESCRIBE_AQUI"),rt=window.parent.Globalize.formatMessage("ANADIR_ADJUNTOS"),ki=window.parent.Globalize.formatMessage("ADJUNTAR"),di=window.parent.Globalize.formatMessage("HASTA_X_ADJUNTOS",["2"]),gi=window.parent.Globalize.formatMessage("MAXIMO_X_ADJUNTOS",["2"]),nr=window.parent.Globalize.formatMessage("ADJUNTAR_DOCUMENTOS"),tr=window.parent.Globalize.formatMessage("ES_DE_LECTURA_OBLIGATORIA"),ut=window.parent.Globalize.formatMessage("PARA"),ir=window.parent.Globalize.formatMessage("SELECCIONADOS"),rr=window.parent.Globalize.formatMessage("SELECCIONA_DESTINATARIOS"),ft=window.parent.Globalize.formatMessage("RESPUESTAS"),ur=window.parent.Globalize.formatMessage("PERMITIR_RESPUESTAS_PERSONALIZADAS"),fr=window.parent.Globalize.formatMessage("ANADE_OPCIONES_DE_RESPUESTA"),er=window.parent.Globalize.formatMessage("ELIMINAR_RESPUESTA"),w=4,or=window.parent.Globalize.formatMessage("ANADOR_RESPUESTA_MAXIMO_DE_X",[w]),sr=window.parent.Globalize.formatMessage("MAXIMO_DE_X_RESPUESTAS_POSIBLES",[w]),hr=window.parent.Globalize.formatMessage("ANADIR_OPCION_DE_RESPUESTA"),et=window.parent.Globalize.formatMessage("PERMITIR_CAMBIAR_DE_OPINION"),cr=window.parent.Globalize.formatMessage("ANADE_OPCIONES_DE_RESPUESTA_PARA_HABILITAR"),lr=window.parent.Globalize.formatMessage("BORRADOR"),ar=window.parent.Globalize.formatMessage("ENVIADO"),vr=window.parent.Globalize.formatMessage("CADUCADO"),yr=window.parent.Globalize.formatMessage("CANCELADO"),pr=window.parent.Globalize.formatMessage("LECTURA_OBLIGATORIA"),wr=window.parent.Globalize.formatMessage("ADJUNTOS"),br=window.parent.Globalize.formatMessage("DESCARGAR_DOCUMENTO"),kr=window.parent.Globalize.formatMessage("ELIMINAR_DOCUMENTO_ADJUNTO"),dr=window.parent.Globalize.formatMessage("QUIERE_BORRAR_DEFINITIVAMENTE_EL_ADJUNTO"),gr=window.parent.Globalize.formatMessage("BORRAR_ADJUNTO"),nu=window.parent.Globalize.formatMessage("DESTINATARIOS"),tu=window.parent.Globalize.formatMessage("NO_HAY_OPCIONES_DE_RESPUESTA"),iu=window.parent.Globalize.formatMessage("CADUCIDAD"),ru=window.parent.Globalize.formatMessage("PLANIFICACION"),uu=window.parent.Globalize.formatMessage("LEIDOS"),fu=window.parent.Globalize.formatMessage("PENDIENTES"),eu=window.parent.Globalize.formatMessage("LISTA_DE_RESULTADOS"),ou=window.parent.Globalize.formatMessage("LEIDO"),su=window.parent.Globalize.formatMessage("RESPONDIDO"),hu=window.parent.Globalize.formatMessage("RESPUESTA"),cu=window.parent.Globalize.formatMessage("FECHA_LECTURA"),lu=window.parent.Globalize.formatMessage("FECHA_RESPUESTA"),ot=window.parent.Globalize.formatMessage("EXPORTAR_DATOS_FILTRADOS"),au=window.parent.Globalize.formatMessage("LISTA_RESULTADOS_COMUNICADO"),vu=window.parent.Globalize.formatMessage("PARA_GUARDAR_COMUNICADO_DEBE_CONTENER_ASUNTO"),yu=window.parent.Globalize.formatMessage("NO_SE_HA_PODIDO_GUARDAR_COMUNICADO"),pu=window.parent.Globalize.formatMessage("DESCARTAR_CAMBIOS"),wu=window.parent.Globalize.formatMessage("ARCHIVAR_COMUNICADO"),bu=window.parent.Globalize.formatMessage("NO_SE_HA_PODIDO_ARCHIVAR_COMUNICADO"),ku=window.parent.Globalize.formatMessage("DESARCHIVAR_COMUNICADO"),du=window.parent.Globalize.formatMessage("NO_SE_HA_PODIDO_DESARCHIVAR_COMUNICADO"),gu=window.parent.Globalize.formatMessage("NO_HAY_COMUNICADOS_ARCHIVADOS"),nf=window.parent.Globalize.formatMessage("COMUNICADOS_ARCHIVADOS"),r=window.parent.Globalize.formatMessage("INSERTAR_TABLA"),u=window.parent.Globalize.formatMessage("NUMERO_FILAS"),f=window.parent.Globalize.formatMessage("NUMERO_COLUMNAS");DevExpress.localization.loadMessages({es:{"dxHtmlEditor-dialogInsertTableCaption":r,"dxHtmlEditor-dialogInsertTableRowsField":u,"dxHtmlEditor-dialogInsertTableColumnsField":f},zh:{"dxHtmlEditor-dialogInsertTableCaption":r,"dxHtmlEditor-dialogInsertTableRowsField":u,"dxHtmlEditor-dialogInsertTableColumnsField":f},pt:{"dxHtmlEditor-dialogInsertTableCaption":r,"dxHtmlEditor-dialogInsertTableRowsField":u,"dxHtmlEditor-dialogInsertTableColumnsField":f},it:{"dxHtmlEditor-dialogInsertTableCaption":r,"dxHtmlEditor-dialogInsertTableRowsField":u,"dxHtmlEditor-dialogInsertTableColumnsField":f},gl:{"dxHtmlEditor-dialogInsertTableCaption":r,"dxHtmlEditor-dialogInsertTableRowsField":u,"dxHtmlEditor-dialogInsertTableColumnsField":f},fr:{"dxHtmlEditor-dialogInsertTableCaption":r,"dxHtmlEditor-dialogInsertTableRowsField":u,"dxHtmlEditor-dialogInsertTableColumnsField":f},eu:{"dxHtmlEditor-dialogInsertTableCaption":r,"dxHtmlEditor-dialogInsertTableRowsField":u,"dxHtmlEditor-dialogInsertTableColumnsField":f},en:{"dxHtmlEditor-dialogInsertTableCaption":r,"dxHtmlEditor-dialogInsertTableRowsField":u,"dxHtmlEditor-dialogInsertTableColumnsField":f},ca:{"dxHtmlEditor-dialogInsertTableCaption":r,"dxHtmlEditor-dialogInsertTableRowsField":u,"dxHtmlEditor-dialogInsertTableColumnsField":f}});const n={communiques:{0:{Id:0,Subject:"",Message:"",Employees:[],AdvancedEmployees:[],Groups:[],AdvancedGroups:[],CreatedBy:1,SentOn:"",IdCompany:0,Documents:[],AllowedResponses:[],AllowCustomResponses:!0,AllowChangeResponse:!0,ExpirationDate:"2079-01-01T00:00:00",ResponsePercentageLimit:75,forceFeedback:0,MandatoryRead:!1,Status:0,expiration:[{option:1,active:!1},{option:2,active:!1},],Statistics:[]}},drafts:[2,3],sent:[0,1],feedbackOptions:[ei,oi,],selectedCommunique:0,expirations:{1:{id:1,label:ri,defaultValue:new Date((new Date).setDate((new Date).getDate()+1)).setHours(0,0,0,0)},2:{id:2,label:fi}},planifications:{1:{id:1,label:ui,defaultValue:new Date((new Date).setDate((new Date).getDate()+1)).setHours(0,0,0,0)}},inEdition:!1};let b,h,i;const st="div#messageCommunique > div.widgetForm",k="div#configCommunique > div.widgetForm",ht="div#messageCommunique > div.widgetForm",ct="div#configCommunique > div.widgetForm",lt="div#statisticsCommunique > div.widgetStatistics";$(document).ready(async function(){b=document.querySelectorAll(".communiqueCard");h=document.querySelector("#customSearchBar");i=document.querySelector("#fieldsEditor");window.reloadCardsPanel=v;const t=await cf();t.map(n=>bt(n));await g("div.switchMainViewTabs",n.communiques[n.selectedCommunique]);$(b).off("click",a);$(b).on("click",a);$(h).on("keyup",()=>yt(""));v();$("#communiqueeConfiguration").off("click");$("#communiqueeConfiguration").on("click",function(){$("#configCommunique").show();$("#messageCommunique").hide();$("#statisticsCommunique").hide();$("#communiqueStatisticsContainer .VTpageSeparator").hide();$("#communiqueeConfiguration").addClass("bTabCommuniquees-active");$("#communiqueeDesign").removeClass("bTabCommuniquees-active");$("#communiqueeResults").removeClass("bTabCommuniquees-active")});$("#communiqueeDesign").off("click");$("#communiqueeDesign").on("click",function(){$("#configCommunique").hide();$("#messageCommunique").show();$("#statisticsCommunique").hide();$("#communiqueStatisticsContainer .VTpageSeparator").hide();$("#communiqueeConfiguration").removeClass("bTabCommuniquees-active");$("#communiqueeDesign").addClass("bTabCommuniquees-active");$("#communiqueeResults").removeClass("bTabCommuniquees-active")});$("#communiqueeResults").off("click");$("#communiqueeResults").on("click",function(){$("#configCommunique").hide();$("#messageCommunique").hide();$("#statisticsCommunique").show();$("#communiqueStatisticsContainer .VTpageSeparator").show();$("#communiqueeConfiguration").removeClass("bTabCommuniquees-active");$("#communiqueeDesign").removeClass("bTabCommuniquees-active");$("#communiqueeResults").addClass("bTabCommuniquees-active")})});window.parentCloseAndApplySelector=function(i){var r=n.communiques[n.selectedCommunique];r.Employees=i.Employees;r.Groups=i.Groups;e(k,r,n);t(!0)};const t=(t=true)=>{n.inEdition=t;const i=[...document.querySelectorAll(".saveOrDiscartDiv"),];t?i.map(n=>n.style.display=""):i.map(n=>n.style.display="none")};const at=(n,t,i)=>{const r=document.querySelector("#divTree");i?(r.style.display="none",n.style.display="none",t.style.display=""):(r.style.display="",t.style.display="none",n.style.display="")},tf=n=>{[...document.querySelectorAll(".communiqueCard")].map(n=>{n.classList.remove("communiqueCardClicked")}),n.addClass("communiqueCardClicked")},vt=async t=>{const r=[...document.querySelectorAll(".communiqueCard")];t==="active"?r.map(t=>{const i=t.getElementsByClassName("communiqueCardInfo")[0].getAttribute("data-communique-id");t.style.display=n.communiques[i]&&n.communiques[i].Archived?"none":""}):t==="archived"&&r.map(t=>{const i=t.getElementsByClassName("communiqueCardInfo")[0].getAttribute("data-communique-id");t.style.display=n.communiques[i]&&n.communiques[i].Archived?"":"none"});const u=document.querySelector(`.communiqueCard div[data-communique-id='${n.selectedCommunique}']`);let i;if(n.selectedCommunique!==0&&n.selectedCommunique!==-1){if(!u){v();return}i=u.parentElement.parentElement}else i=r.find(n=>n.style.display!=="none");if(!i||i.style.display==="none"){const i=r.find(n=>n.style.display!=="none");if(i)i.click();else if(t==="active"){const t=Object.keys(n.communiques).find(t=>t!=="0"&&!n.communiques[t].Archived);t||d()}else t==="archived"&&(DevExpress.ui.dialog.alert(gu,nf),document.querySelector("#filterActiveCommBtn").click())}else i.click()};const pt=n=>{const t=atob(n),i=new Array(t.length);for(let n=0;n<t.length;n++)i[n]=t.charCodeAt(n);const r=new Uint8Array(i);return new Blob([r],{type:"application/octet-binary"})},wt=n=>{const i=n.name||n.Title,r=n.name?n:pt(n.Document),t=document.createElement("a");t.setAttribute("download",i);t.setAttribute("href",window.URL.createObjectURL(r));t.click();t.remove()},d=async()=>{$("#communiqueeResults").hide();const i={...n.communiques[0],Id:-1,CreatedOn:Date.now(),Subject:"",Message:"",Employees:[],AdvancedEmployees:[],Groups:[],AdvancedGroups:[],CreatedBy:1,SentOn:"",IdCompany:0,Documents:[],AllowedResponses:[],AllowChangeResponse:!0,ExpirationDate:"2079-01-01T00:00:00",PlanificationDate:"2000-01-01T00:00:00",ResponsePercentageLimit:75,forceFeedback:0,MandatoryRead:!1,Status:0,expiration:[{option:1,active:!1},{option:2,active:!1},],planification:[{option:1,active:!1}],Statistics:[]};n.communiques[i.Id]=i;n.selectedCommunique=i.Id;ni({message:st,config:k,commReadOnly:ht,confReadOnly:ct,statistics:lt},i,n);await g("div.switchMainViewTabs",i);[...document.querySelectorAll(".communiqueCard")].map(n=>{n.classList.remove("communiqueCardClicked")});$("#EmployeeText").dxTagBox("instance")!=null&&$("#EmployeeText").dxTagBox("instance").option("value",null);$("#GroupText").dxTagBox("instance")!=null&&$("#GroupText").dxTagBox("instance").option("value",null);t(!0);await vf()},rf=async n=>{if(n.Subject.length<1){DevExpress.ui.dialog.alert(tt+p,y);return}if(n.Message.length<1){DevExpress.ui.dialog.alert(tt+it,y);return}if(n.Employees.length<1&&n.Groups.length<1){DevExpress.ui.dialog.alert(vi,y);return}const t=await o({...n,Status:1});(t||!t)&&s()},uf=async n=>{n.Status=3;n.Archived=!0;const i=await o(n);i?(s(),t(!1)):DevExpress.ui.dialog.alert(ci,hi)},ff=async n=>{n.Status=1;const i=await o(n);i?(s(),t(!1)):DevExpress.ui.dialog.alert(li,ai)},ef=async t=>{const i=await DevExpress.ui.dialog.confirm(pi,yi);if(i){const i=await yf(t.Id);if(i||!i){const t=$(".communiqueCard").first().find(".communiqueCardInfo").attr("data-communique-id");n.selectedCommunique=t;s()}}},sf=async n=>{const t={...n};return t.Id=n.Id===0?-1:n.Id,t.ExpirationDate=n.expiration.find(n=>n.option===1).active?t.ExpirationDate:window.parent.moment(34397532e5).format("YYYY-MM-DDTHH:mm:ss"),t.PlanificationDate=n.planification.find(n=>n.option===1).active?t.PlanificationDate:window.parent.moment.utc("2000-01-01T00:00:00").format("YYYY-MM-DDTHH:mm:ss"),t.ResponsePercentageLimit=n.expiration.find(n=>n.option===2).active?t.ResponsePercentageLimit:-1,t.AllowedResponses=t.AllowCustomResponses?n.AllowedResponses.filter(n=>n.length>0):[],t.AllowedResponses.length===0&&(t.AllowChangeResponse=!1),t.CreatedBy=await pf(),t.CreatedOn=typeof n.CreatedOn=="number"?window.parent.moment(n.CreatedOn).format("YYYY-MM-DDTHH:mm:ss"):n.CreatedOn,delete t.expiration,delete t.planification,delete t.forceFeedback,delete t.Asunto,delete t.Mensaje,t},bt=t=>{if(t){t={Communique:!t.Communique?t:t.Communique,Statistics:!t.EmployeeCommuniqueStatus?{}:t.EmployeeCommuniqueStatus};const i={Groups:[],Employees:[],...t.Communique,Documents:t.Communique.Documents.map(n=>(n.Title=`${n.Title}${n.DocumentType}`,n)),ExpirationDate:t.Communique.ExpirationDate==="2079-01-01T00:00:00"?"2079-01-01T00:00:00":t.Communique.ExpirationDate,expiration:[{option:1,active:t.Communique.ExpirationDate!=="2079-01-01T00:00:00"},{option:2,active:!t.Communique.ResponsePercentageLimit||t.Communique.ResponsePercentageLimit===-1?!1:!0},],PlanificationDate:t.Communique.PlanificationDate==="2000-01-01T00:00:00"?"2000-01-01T00:00:00":t.Communique.PlanificationDate,planification:[{option:1,active:t.Communique.PlanificationDate!=="2000-01-01T00:00:00"}],AllowCustomResponses:t.Communique.AllowedResponses.length!==0,Statistics:t.Statistics};return n.communiques[t.Communique.Id]=i,i}},hf=async n=>{let t;return await $.ajax({url:`${BASE_URL}Communique/GetCommunique`,data:{Id:n},type:"POST",dataType:"json",success:n=>t=n,error:n=>console.error(n)}),bt(t)},cf=async()=>{let n;return await $.ajax({url:`${BASE_URL}Communique/GetAllCommuniques`,data:{},type:"POST",dataType:"json",success:t=>n=t,error:n=>console.error(n)}),n},kt=async()=>{let n;try{await $.ajax({url:`${BASE_URL}Communique/GetPermisionOverCommuniques`,data:{},type:"POST",dataType:"json",success:t=>n=t,error:n=>console.error(n)})}catch(t){}return n},lf=async()=>{let n;try{await $.ajax({url:`${BASE_URL}Communique/GetPermissionToAttachDocuments`,data:{},type:"POST",dataType:"json",success:t=>n=t,error:n=>console.error(n)})}catch(t){}return n},af=async n=>{let t;return await $.ajax({url:`${BASE_URL}Communique/GetViewTemplate`,data:{templateName:n},type:"POST",dataType:"html",success:n=>t=n,error:n=>console.error(n)}),t},o=async i=>{let r={};const u=await sf(i);try{await $.ajax({url:`${BASE_URL}Communique/SaveCommunique`,data:{communique:JSON.stringify(u)},type:"POST",dataType:"json",success:n=>r=n,error:n=>console.error(n)})}catch(f){console.error(f);r=!1}finally{!r.Communique||(n.selectedCommunique=r.Communique.Id,n.communiques[r.Communique.Id]=r.Communique,t(!1))}return r},dt=async n=>{let t;try{await $.ajax({url:`${BASE_URL}Communique/RemoveAttachedFile`,data:{documentTitle:n},type:"POST",dataType:"text",success:n=>t=n,error:n=>console.error(n)})}catch(i){console.error(i)}finally{t=!0}return t},vf=async()=>{let n;try{await $.ajax({url:`${BASE_URL}Communique/CleanAttachedFilesFromSession`,data:{},type:"POST",dataType:"text",success:t=>n=t,error:n=>console.error(n)})}catch(t){console.error(t)}finally{n=!0}return n},yf=async t=>{let i;try{await $.ajax({url:`${BASE_URL}Communique/DeleteCommunique`,data:{IdCommunique:t},type:"POST",dataType:"text",success:n=>i=n,error:n=>console.error(n)})}catch(r){}finally{i=!0;delete n.communiques[t];n.selectedCommunique=parseInt(n.communiques[Object.keys(n.communiques)[0]],10)}return i},pf=async()=>{let n;return await $.ajax({url:`${BASE_URL}Communique/GetCurrentEmployeePassport`,data:{},type:"POST",dataType:"json",success:t=>n=t,error:n=>console.error(n)}),n},wf=n=>{const t=n.substring(0,n.indexOf("@")).split(",");return t.reduce((n,t)=>(t.indexOf("A")>-1?n.groups.push(t.substring(1,t.length)):t.indexOf("B")>-1&&n.employees.push(t.substring(1,t.length)),n),{employees:[],groups:[]})};window.collectParamValues=async(t,i,r)=>{const u=n.communiques[n.selectedCommunique],f=`${t||-1}@${i||-1}@${r||""}`,{employees:e,groups:o}=wf(f);u.AdvancedEmployees=e;u.AdvancedGroups=o};const v=()=>{const t=document.querySelector(".dxcvCSD");gt(t);const n=[...document.querySelectorAll(".communiqueCard")],i=gf(t);n.length>0?i.observe(n[n.length-1]):(document.querySelector("#commRemoveBtn").style.display="none",document.querySelector("#commSendBtn").style.display="none");$(".communiqueCard").off("click",a);$(".communiqueCard").on("click",a);document.querySelector(".mainActionBtn.viewTab.activeTab").click()},s=t=>{$("#customSearchBar").val(null);yt(" ");let i=0;const r=setInterval(()=>{const u=document.querySelector(`.communiqueCard div[data-communique-id='${t||n.selectedCommunique}']`);u||i===60?(clearInterval(r),u.click()):i++},1e3)};window.onresize=()=>{gt(document.querySelector(".dxcvCSD"))};const ni=async(n,t,i)=>{const r=await kt(),u=await lf();Object.entries(n).map(n=>document.querySelector(n[1]).parentElement.parentElement.style.display="none");r>3?typeof t!="undefined"&&(t.Status===0?(bf(n.message,t,i),e(n.config,t,i),$("#communiqueeResults").hasClass("bTabCommuniquees-active")&&($("#communiqueeConfiguration").addClass("bTabCommuniquees-active"),$("#communiqueeResults").removeClass("bTabCommuniquees-active"),$("#communiqueeDesign").removeClass("bTabCommuniquees-active"),$("#configCommunique").show(),$("#messageCommunique").hide()),$("#communiqueeResults").hide()):t.Status>0&&(ti(n.commReadOnly,n.confReadOnly,t,i),ii(n.statistics,t,i),$("#communiqueeResults").show()),t.Id===-1&&(document.querySelector("#commRemoveBtn").style.display="none",document.querySelector("#commSendBtn").style.display="none"),u||($(".comm-config-fileuploader").hide(),$(".dx-field-item-label-text").filter(function(){const n=$(this).text().replace(/\s+/g," ").trim();return n===rt}).hide())):(ti(n.commReadOnly,n.confReadOnly,t,i),ii(n.statistics,t,i),$("#communiqueeResults").show())},bf=async(n,i)=>{$(n).empty(),$(n).dxForm({formData:i,width:"100%",name:"mainForm",alignItemLabels:!0,alignItemLabelsInAllGroups:!0,colCount:4,items:[{itemType:"group",cssClass:"first-group",name:"message",colSpan:4,colCount:3,items:[{cssClass:"VTpageSeparator",colSpan:3,label:{text:l,showColon:!1},itemType:"group"},{dataField:bi,label:{location:"top",showColon:!1},colSpan:3,cssClass:"form-group-indented communique-html-content",editorType:"dxHtmlEditor",editorOptions:{elementAttr:{id:"messageEditor"},height:500,value:i.Message,toolbar:{items:[{name:"undo",options:{hint:window.parent.Globalize.formatMessage("dxDiagram-commandUndo")}},{name:"redo",options:{hint:window.parent.Globalize.formatMessage("dxDiagram-commandRedo")}},"separator",{name:"size",acceptedValues:["8pt","10pt","12pt","14pt","18pt","24pt","36pt"],options:{placeholder:window.parent.Globalize.formatMessage("dxHtmlEditor-commandFontSize"),hint:window.parent.Globalize.formatMessage("dxHtmlEditor-commandFontSize"),displayExpr:function(){return window.parent.Globalize.formatMessage("dxHtmlEditor-commandFontSize")},itemTemplate:function(n,t,i){i.text(n)}}},{name:"font",acceptedValues:["Arial","Courier New","Georgia","Impact","Lucida Console","Tahoma","Times New Roman","Verdana"],options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-commandFontName"),placeholder:window.parent.Globalize.formatMessage("dxHtmlEditor-commandFontName"),displayExpr:function(){return window.parent.Globalize.formatMessage("dxHtmlEditor-commandFontName")},itemTemplate:function(n,t,i){i.text(n)}}},"separator",{name:"bold",options:{hint:window.parent.Globalize.formatMessage("dxDiagram-commandBold")}},{name:"italic",options:{hint:window.parent.Globalize.formatMessage("dxDiagram-commandItalic")}},{name:"strike",options:{hint:window.parent.Globalize.formatMessage("dxDiagram-commandStrike")}},{name:"underline",options:{hint:window.parent.Globalize.formatMessage("dxDiagram-commandUnderline")}},"separator",{name:"alignLeft",options:{hint:window.parent.Globalize.formatMessage("dxDiagram-commandAlignLeft")}},{name:"alignCenter",options:{hint:window.parent.Globalize.formatMessage("dxDiagram-commandAlignCenter")}},{name:"alignRight",options:{hint:window.parent.Globalize.formatMessage("dxDiagram-commandAlignRight")}},{name:"alignJustify",options:{hint:window.parent.Globalize.formatMessage("dxDiagram-commandAlignJustify")}},"separator",{name:"orderedList",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-orderedList")}},{name:"bulletList",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-bulletList")}},"separator",{name:"header",acceptedValues:[!1,1,2,3,4,5],options:{placeholder:window.parent.Globalize.formatMessage("dxHtmlEditor-heading"),displayExpr:function(){return window.parent.Globalize.formatMessage("dxHtmlEditor-heading")},itemTemplate:function(n,t,i){t===0?i.text(window.parent.Globalize.formatMessage("dxHtmlEditor-normalText")):i.text(window.parent.Globalize.formatMessage("dxHtmlEditor-heading"+n))}}},"separator",{name:"color",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-color")}},{name:"background",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-background")}},"separator",{name:"link",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-link")}},{widget:"dxButton",name:"image",options:{text:window.parent.Globalize.formatMessage("dxDiagram-commandInsertShapeImage"),stylingMode:"text",onClick:function(){var n=$("#addImagePopup").dxPopup("instance");n.show()},hint:window.parent.Globalize.formatMessage("dxDiagram-commandInsertShapeImage")}},"separator",{name:"clear",options:{hint:window.parent.Globalize.formatMessage("Clear")}},{name:"codeBlock",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-codeblock")}},"separator",{name:"insertTable",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-insertTable")}},{name:"deleteTable",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-deleteTable")}},{name:"insertRowAbove",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-insertRowAbove")}},{name:"insertRowBelow",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-insertRowBelow")}},{name:"deleteRow",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-deleteRow")}},{name:"insertColumnLeft",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-insertColumnLeft")}},{name:"insertColumnRight",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-insertColumnRight")}},{name:"deleteColumn",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-deleteColumn")}}]},onValueChanged:n=>{i.Message=n.value,t(!0)}}}]},]}),document.querySelector(n).parentElement.parentElement.style.display=""},e=async(n,i,r)=>{$(n).empty(),$(n).dxForm({formData:i,width:"100%",name:"mainForm",alignItemLabels:!1,alignItemLabelsInAllGroups:!1,colCount:4,items:[{itemType:"group",cssClass:"comm-config-form-group",colSpan:4,colCount:4,items:[{itemType:"group",name:"response",colSpan:4,items:[{itemType:"group",cssClass:"first-group",name:"message",colSpan:4,colCount:3,items:[{cssClass:"VTpageSeparator",colSpan:3,label:{text:l,showColon:!1},itemType:"group"},{colSpan:3,dataField:p,label:{location:"top",showColon:!1},cssClass:"form-group-indented",editorOptions:{value:i.Subject,maxLength:50,onValueChanged:n=>{i.Subject=n.event.target.value,t(!0)}}},{colSpan:3,itemType:"group",cssClass:"form-group-indented",dataField:rt,label:{location:"top",showColon:!1},items:[{cssClass:"comm-config-fileuploader",template:(n,r)=>{const u=$(r).dxFileUploader({selectButtonText:ki,multiple:!0,uploadMode:"instantly",uploadUrl:`${BASE_URL}Communique/SaveAttachedFile/${i.Id}`,name:"file",labelText:di,accept:"*",allowedExtensions:[".pdf",".png",".jpg",".jpeg"],maxFileSize:MAX_FILE_SIZE*1e3,readyToUploadMessage:"",value:i.Documents.map(n=>!!n.Title&&new File([pt(n.Document)],n.Title)||n),onValueChanged:n=>{if(n.value.length<=2)n.value.length>n.previousValue.length&&n.value.map(n=>{const t=i.Documents.filter(t=>t.name===n.name).length===0;t&&i.Documents.push(n)}),n.value.length<n.previousValue.length&&i.Documents.map(async t=>{!n.value.filter(function(n){return n.name===t.Title}).length>0&&await dt(t.Title)});else{const t=n.value.filter(t=>n.previousValue.find(n=>n===t)===t).filter((n,t)=>t<2);n.component.reset();n.component.option("value",t);DevExpress.ui.dialog.alert(gi,nr)}t(!0)},onContentReady:n=>{[...document.querySelectorAll(".dx-fileuploader-files-container .dx-fileuploader-file .dx-fileuploader-file-name"),].map(t=>{n.component.option("value").map(n=>{n.name===t.innerText&&t.addEventListener("click",()=>wt(n),!1)})})}}).dxFileUploader("instance")}},]},{editorType:"dxRadioGroup",cssClass:"form-group-indented",colSpan:3,dataField:tr,label:{location:"top",showColon:!1},editorOptions:{items:r.feedbackOptions,value:i.MandatoryRead?r.feedbackOptions[0]:r.feedbackOptions[1],onValueChanged:n=>{i.MandatoryRead=n.value===r.feedbackOptions[0],t(!0)}}},{cssClass:"VTpageSeparator",colSpan:3,label:{text:ut,showColon:!1},itemType:"group"},{colSpan:3,colCount:4,cssClass:"form-group-indented",name:"recipients",itemType:"group",items:[{colSpan:1,editorType:"dxTextBox",name:"sentence",datafield:ir,editorOptions:{text:function(){let n={Employees:[],Groups:[],Filter:"11110",UserFields:"",ComposeMode:"Custom",ComposeFilter:"",Advanced:!1,Operation:"or"};if(i!=null){if(i.Employees!=null)for(let t=0;t<i.Employees.length;t++)n.ComposeFilter+=n.ComposeFilter==""?`B${i.Employees[t]}`:`,B${i.Employees[t]}`;if(i.Groups!=null)for(let t=0;t<i.Groups.length;t++)n.ComposeFilter+=n.ComposeFilter==""?`A${i.Groups[t]}`:`,A${i.Groups[t]}`}return buildSelectedEmployeesString(n)},readOnly:!0,onValueChanged:()=>t(!0)}},{colSpan:1,editorType:"dxButton",cssClass:"comm-select-recipients-button CY-btnSelectDest",editorOptions:{text:rr,onClick:async()=>{let n={Employees:[],Groups:[],Filter:"11110",UserFields:"",ComposeMode:"Custom",ComposeFilter:"",Advanced:!1,Operation:"or"};if(i!=null){if(i.Employees!=null)for(let t=0;t<i.Employees.length;t++)n.ComposeFilter+=n.ComposeFilter==""?`B${i.Employees[t]}`:`,B${i.Employees[t]}`;if(i.Groups!=null)for(let t=0;t<i.Groups.length;t++)n.ComposeFilter+=n.ComposeFilter==""?`A${i.Groups[t]}`:`,A${i.Groups[t]}`}parent.showLoader(!0);$("#divCommuniqueEmployeeSelector").load("/Employee/EmployeeSelectorPartial?feature=Employees&pageName=communique&config=100&unionType=or&advancedMode=1&advancedFilter=0",function(){loadPartialInfo();initUniversalSelector(n,!1,"communiqueSelector");parent.showLoader(!1)})}}},]},]},{cssClass:"VTpageSeparator",colSpan:4,label:{text:ft,showColon:!1},itemType:"group"},{editorType:"dxCheckBox",editorOptions:{text:ur,hint:fr,value:i.AllowCustomResponses,onValueChanged:u=>{i.AllowCustomResponses=u.value,u.value||(i.AllowedResponses=[]),e(n,i,r),t(!0)}}},{itemType:"group",cssClass:"answers-group",name:"answers",colCount:6,items:[...i.AllowedResponses.map((u,f)=>({colSpan:1,width:"35px",editorType:"dxTextBox",name:`answer-${f}`,editorOptions:{readOnly:!i.AllowCustomResponses,value:u,maxLength:50,onValueChanged:n=>{i.AllowedResponses[f]=n.event.target.value,t(!0)},buttons:[{name:"removeAnswer",options:{icon:"close",stylingMode:"text",hint:er,onClick:()=>{i.AllowedResponses=i.AllowedResponses.filter((n,t)=>t!==f),e(n,i,r),t(!0)}}},]}})),{colSpan:1,editorType:"dxButton",editorOptions:{icon:"plus",disabled:!i.AllowCustomResponses,hint:or,onClick:async()=>{i.AllowedResponses.length<w?(i.AllowedResponses.push(""),await e(n,i,r),t(!0)):DevExpress.ui.dialog.alert(sr,hr)}}},]},{editorType:"dxCheckBox",editorOptions:{text:et,hint:cr,readOnly:i.AllowedResponses.length===0,value:i.AllowedResponses.length===0?!1:i.AllowChangeResponse,onValueChanged:n=>{i.AllowChangeResponse=n.value,t(!0)}}},]},{visible:AdvancedCommuniques=="True",cssClass:"VTpageSeparator",colSpan:4,label:{text:"Planificación",showColon:!1},itemType:"group"},{itemType:"group",cssCLass:"com-planification-group",cssClass:"form-group-indented",colSpan:4,colCount:18,items:[{editorType:"dxCheckBox",colSpan:4,editorOptions:{text:r.planifications[1].label,visible:AdvancedCommuniques=="True",value:i.planification.find(n=>n.option===1).active,onValueChanged:u=>{i.planification.find(n=>n.option===1).active=u.value,i.PlanificationDate=u.value?window.parent.moment().add(1,"day").startOf("day").format("YYYY-MM-DDTHH:mm:ss"):"2000-01-01T00:00:00",e(n,i,r),t(!0)}}},{colSpan:3,editorType:"dxDateBox",editorOptions:{type:"datetime",min:new Date,displayFormat:"dd-MM-yyyy, HH:mm",visible:AdvancedCommuniques=="True",disabled:!i.planification.find(n=>n.option===1).active,value:i.PlanificationDate!=="2000-01-01T00:00:00"?window.parent.moment(i.PlanificationDate,"YYYY-MM-DDTHH:mm:ss"):new Date((new Date).setDate((new Date).getDate()+1)).setHours(0,0,0,0),onValueChanged:n=>{i.PlanificationDate=window.parent.moment(n.value).format("YYYY-MM-DDTHH:mm:ss"),t(!0)}}},{itemType:"empty",colSpan:11},]},{cssClass:"VTpageSeparator",colSpan:4,label:{text:"Finalización",showColon:!1},itemType:"group"},{itemType:"group",cssClass:"form-group-indented com-caducidad-group",colSpan:4,colCount:18,items:[{editorType:"dxCheckBox",colSpan:4,editorOptions:{text:r.expirations[1].label,value:i.expiration.find(n=>n.option===1).active,onValueChanged:u=>{i.expiration.find(n=>n.option===1).active=u.value,u.value||(i.ExpirationDate="2079-01-01T00:00:00"),e(n,i,r),t(!0)}}},{colSpan:3,editorType:"dxDateBox",editorOptions:{type:"datetime",min:new Date,displayFormat:"dd-MM-yyyy, HH:mm",disabled:!i.expiration.find(n=>n.option===1).active,value:i.ExpirationDate!=="2079-01-01T00:00:00"?window.parent.moment(i.ExpirationDate,"YYYY-MM-DDTHH:mm:ss"):new Date((new Date).setDate((new Date).getDate()+7)).setHours(0,0,0,0),onValueChanged:n=>{i.ExpirationDate=window.parent.moment(n.value).format("YYYY-MM-DDTHH:mm:ss"),t(!0)}}},{itemType:"empty",colSpan:11},{itemType:"group",colSpan:18,colCount:18,items:[{editorType:"dxCheckBox",colSpan:4,editorOptions:{text:r.expirations[2].label+":",hint:"Añade opciones de respuesta para habilitar este campo",readOnly:i.AllowedResponses.length===0,value:i.AllowedResponses.length===0?!1:i.expiration.find(n=>n.option===2).active,onValueChanged:u=>{i.expiration.find(n=>n.option===2).active=u.value,u.value||(i.ResponsePercentageLimit=-1),e(n,i,r),t(!0)}}},{editorType:"dxSlider",colSpan:5,editorOptions:{disabled:!i.expiration.find(n=>n.option===2).active,value:i.ResponsePercentageLimit===-1||!i.ResponsePercentageLimit?100:i.ResponsePercentageLimit,label:{visible:!0,position:"top",format:n=>`${n}%`},tooltip:{enabled:!0,format:n=>`${n}%`,position:"bottom",showMode:"always"},onValueChanged:n=>{i.ResponsePercentageLimit=n.value,t(!0)}}},]},]},]},]}),document.querySelector(n).parentElement.parentElement.style.display=""},ti=async(n,i,r,u)=>{const f=[lr,ar,vr,yr];$(n).empty();$(i).empty();$(i).dxForm({formData:r,width:"100%",name:"mainForm",colCount:4,items:[{cssClass:"VTpageSeparator",colSpan:4,label:{text:f[r.Status],showColon:!1},itemType:"group"},{itemType:"group",cssClass:"first-group",name:"message",colSpan:4,colCount:4,items:[{cssClass:"VTpageSeparator",colSpan:4,label:{text:l,showColon:!1},itemType:"group"},{dataField:p,label:{location:"top",showColon:!1},cssClass:"form-group-indented",colSpan:4,editorOptions:{readOnly:!0,value:r.Subject}},{editorType:"dxCheckBox",cssClass:"comm-MandatoryRead-checkbox form-group-indented",colSpan:4,editorOptions:{text:pr,value:r.MandatoryRead,readOnly:!0}},{colSpan:4,itemType:"group",cssClass:"form-group-indented",dataField:wr,label:{location:"top",showColon:!1},colCount:4,items:r.Documents.map(n=>({editorType:"dxTextBox",colSpan:4,editorOptions:{value:n.Title,buttons:[{name:"downloadDocument",location:"after",options:{type:"normal",icon:"download",stylingMode:"text",hint:br,onClick:()=>wt(n)}},{name:"removeDocument",location:"before",options:{type:"normal",icon:"close",stylingMode:"text",hint:kr,onClick:async()=>{const t=await DevExpress.ui.dialog.confirm(dr,gr);t&&(await dt(n.Title),await o(r),document.querySelector(".communiqueCardClicked").click())}}},]}}))},{cssClass:"VTpageSeparator",colSpan:4,label:{text:ut,showColon:!1},itemType:"group"},{dataField:nu,label:{location:"top",showColon:!1},cssClass:"form-group-indented",colSpan:4,editorType:"dxTextBox",editorOptions:{text:function(){let n={Employees:[],Groups:[],Filter:"11110",UserFields:"",ComposeMode:"Custom",ComposeFilter:"",Advanced:!1,Operation:"or"};if(r!=null){if(r.Employees!=null)for(let t=0;t<r.Employees.length;t++)n.ComposeFilter+=n.ComposeFilter==""?`B${r.Employees[t]}`:`,B${r.Employees[t]}`;if(r.Groups!=null)for(let t=0;t<r.Groups.length;t++)n.ComposeFilter+=n.ComposeFilter==""?`A${r.Groups[t]}`:`,A${r.Groups[t]}`}return buildSelectedEmployeesString(n)},readOnly:!0}},]},{itemType:"group",colSpan:4,colCount:4,items:[{cssClass:"VTpageSeparator",colSpan:4,label:{text:ft,showColon:!1},itemType:"group"},{itemType:"group",cssClass:"form-group-indented",name:"response",colSpan:4,items:[{itemType:"group",cssClass:"answers-group",name:"answers",colCount:6,items:r.AllowedResponses.length===0&&[{colSpan:6,cssClass:"comm-simulate-label",editorType:"dxTextBox",editorOptions:{stylingMode:"filled",readOnly:!0,value:tu}},]||r.AllowedResponses.map((n,t)=>({colSpan:4,width:"35px",editorType:"dxTextBox",name:`answer-${t}`,editorOptions:{value:n,readOnly:!0}}))},{editorType:"dxCheckBox",editorOptions:{text:et,value:r.AllowChangeResponse,readOnly:!0}},]},{visible:AdvancedCommuniques=="True",cssClass:"VTpageSeparator",colSpan:4,label:{text:ru,showColon:!1},itemType:"group"},{itemType:"group",cssClass:"form-group-indented",colSpan:4,colCount:9,items:[{editorType:"dxCheckBox",colSpan:2,editorOptions:{text:u.planifications[1].label,visible:AdvancedCommuniques=="True",value:r.planification.find(n=>n.option===1).active,readOnly:!0}},{colSpan:2,editorType:"dxDateBox",editorOptions:{type:"datetime",displayFormat:"dd-MM-yyyy, HH:mm",visible:AdvancedCommuniques=="True",value:r.PlanificationDate.indexOf("2000")>-1?"":r.PlanificationDate,showDropDownButton:!1,disabled:r.PlanificationDate.indexOf("2000")>-1,readOnly:!0}},{itemType:"empty",colSpan:4},]},{cssClass:"VTpageSeparator",colSpan:4,label:{text:iu,showColon:!1},itemType:"group"},{itemType:"group",cssClass:"form-group-indented",colSpan:4,colCount:18,items:[{editorType:"dxCheckBox",colSpan:4,editorOptions:{text:u.expirations[1].label,value:r.expiration.find(n=>n.option===1).active,readOnly:!0}},{colSpan:3,editorType:"dxDateBox",editorOptions:{type:"datetime",displayFormat:"dd-MM-yyyy, HH:mm",value:r.ExpirationDate.indexOf("2079")>-1?"":r.ExpirationDate,showDropDownButton:!1,disabled:r.ExpirationDate.indexOf("2079")>-1,readOnly:!0}},{itemType:"empty",colSpan:11},{itemType:"group",colSpan:18,colCount:18,items:[{editorType:"dxCheckBox",colSpan:4,editorOptions:{text:u.expirations[2].label+":",value:r.expiration.find(n=>n.option===2).active,readOnly:!0}},{editorType:"dxTextBox",colSpan:5,editorOptions:{value:`${r.ResponsePercentageLimit===-1||!r.ResponsePercentageLimit?"--":r.ResponsePercentageLimit}%`,disabled:!r.expiration.find(n=>n.option===2).active,readOnly:!0}},]},]},]},]});document.querySelector(i).parentElement.parentElement.style.display="";$(n).dxForm({formData:r,width:"100%",name:"mainForm",alignItemLabels:!0,alignItemLabelsInAllGroups:!0,colCount:4,items:[{itemType:"group",cssClass:"first-group",name:"message",colSpan:4,colCount:3,items:[{cssClass:"VTpageSeparator",colSpan:3,label:{text:l,showColon:!1},itemType:"group"},{dataField:it,label:{location:"top",showColon:!1},cssClass:"form-group-indented communique-html-content",colSpan:3,editorType:"dxHtmlEditor",editorOptions:{height:500,value:r.Message,readOnly:!0,toolbar:{items:[{name:"undo",options:{hint:window.parent.Globalize.formatMessage("dxDiagram-commandUndo")}},{name:"redo",options:{hint:window.parent.Globalize.formatMessage("dxDiagram-commandRedo")}},"separator",{name:"size",acceptedValues:["8pt","10pt","12pt","14pt","18pt","24pt","36pt"],options:{placeholder:window.parent.Globalize.formatMessage("dxHtmlEditor-commandFontSize"),hint:window.parent.Globalize.formatMessage("dxHtmlEditor-commandFontSize"),displayExpr:function(){return window.parent.Globalize.formatMessage("dxHtmlEditor-commandFontSize")},itemTemplate:function(n,t,i){i.text(n)}}},{name:"font",acceptedValues:["Arial","Courier New","Georgia","Impact","Lucida Console","Tahoma","Times New Roman","Verdana"],options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-commandFontName"),placeholder:window.parent.Globalize.formatMessage("dxHtmlEditor-commandFontName"),displayExpr:function(){return window.parent.Globalize.formatMessage("dxHtmlEditor-commandFontName")},itemTemplate:function(n,t,i){i.text(n)}}},"separator",{name:"bold",options:{hint:window.parent.Globalize.formatMessage("dxDiagram-commandBold")}},{name:"italic",options:{hint:window.parent.Globalize.formatMessage("dxDiagram-commandItalic")}},{name:"strike",options:{hint:window.parent.Globalize.formatMessage("dxDiagram-commandStrike")}},{name:"underline",options:{hint:window.parent.Globalize.formatMessage("dxDiagram-commandUnderline")}},"separator",{name:"alignLeft",options:{hint:window.parent.Globalize.formatMessage("dxDiagram-commandAlignLeft")}},{name:"alignCenter",options:{hint:window.parent.Globalize.formatMessage("dxDiagram-commandAlignCenter")}},{name:"alignRight",options:{hint:window.parent.Globalize.formatMessage("dxDiagram-commandAlignRight")}},{name:"alignJustify",options:{hint:window.parent.Globalize.formatMessage("dxDiagram-commandAlignJustify")}},"separator",{name:"orderedList",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-orderedList")}},{name:"bulletList",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-bulletList")}},"separator",{name:"header",acceptedValues:[!1,1,2,3,4,5],options:{placeholder:window.parent.Globalize.formatMessage("dxHtmlEditor-heading"),displayExpr:function(){return window.parent.Globalize.formatMessage("dxHtmlEditor-heading")},itemTemplate:function(n,t,i){t===0?i.text(window.parent.Globalize.formatMessage("dxHtmlEditor-normalText")):i.text(window.parent.Globalize.formatMessage("dxHtmlEditor-heading"+n))}}},"separator",{name:"color",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-color")}},{name:"background",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-background")}},"separator",{name:"link",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-link")}},{name:"image",widget:"dxButton",options:{text:window.parent.Globalize.formatMessage("dxDiagram-commandInsertShapeImage"),stylingMode:"text",onClick:function(){var n=$("#addImagePopup").dxPopup("instance");n.show()}}},"separator",{name:"clear",options:{hint:window.parent.Globalize.formatMessage("Clear")}},{name:"codeBlock",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-codeblock")}},"separator",{name:"insertTable",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-insertTable")}},{name:"deleteTable",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-deleteTable")}},{name:"insertRowAbove",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-insertRowAbove")}},{name:"insertRowBelow",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-insertRowBelow")}},{name:"deleteRow",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-deleteRow")}},{name:"insertColumnLeft",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-insertColumnLeft")}},{name:"insertColumnRight",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-insertColumnRight")}},{name:"deleteColumn",options:{hint:window.parent.Globalize.formatMessage("dxHtmlEditor-deleteColumn")}}]},onValueChanged:n=>{r.Message=n.value,t(!0)}}}]},]});document.querySelector(n).parentElement.parentElement.style.display=""},ii=(n,t)=>{const r=t.Statistics,u=document.querySelector(n);if(u.innerHTML="",r){const o=[{type:uu,value:r.reduce((n,t)=>t.Read&&++n||n,0)},{type:fu,value:r.reduce((n,t)=>!t.Read&&++n||n,0)},],e=t.AllowedResponses.map(n=>({answer:n,value:r.reduce((t,i)=>i.Answer===n&&++t||t,0)})),f=document.createElement("div"),i=document.createElement("a");if(f.classList.add("pieChartStatistics"),i.classList.add("mainActionBtn"),i.setAttribute("id","commStatisticsGridBtn"),i.setAttribute("href","#"),i.addEventListener("click",()=>{kf(r)},!1),i.innerText=eu,u.append(f),$(f).dxPieChart({palette:"soft",dataSource:o,series:[{argumentField:"type",valueField:"value",label:{visible:!0,connector:{visible:!0,width:1}}},],size:{height:350}}),e.length>0){const n=document.createElement("div");n.classList.add("barChartStatistics");u.append(n);$(n).dxPieChart({palette:"softpastel",dataSource:e,series:[{argumentField:"answer",valueField:"value",label:{visible:!0,connector:{visible:!0,width:1}}},],size:{height:350}})}u.append(i);document.querySelector(n).parentElement.parentElement.style.display=""}},kf=async t=>{i.style.display="";i.style.width="auto";const u=await af("editViewBtns"),r=document.createElement("div");r.classList.add("statisticsGrid");i.appendChild(r);i.innerHTML+=u;i.querySelector("#cancelEdition").parentElement.style.display="none";i.querySelector("#acceptEdition").parentElement.addEventListener("click",()=>{while(i.lastChild)i.removeChild(i.lastChild);i.style.display="none";i.style.width=""},!1);$(".statisticsGrid").dxDataGrid({dataSource:t,showBorders:!0,rowAlternationEnabled:!0,columnAutoWidth:!0,headerFilter:{visible:!0},filterRow:{visible:!0,applyFilter:"auto"},columns:[{dataField:"EmployeeName",caption:wi,dataType:"number",width:"auto"},{dataField:"Read",caption:ou,width:"auto"},{dataField:"Answered",caption:su,width:"auto"},{dataField:"Answer",caption:hu,dataType:"string",width:"auto"},{dataField:"ReadTimeStamp",caption:cu,dataType:"date",width:"auto",calculateCellValue:n=>n.ReadTimeStamp==="1970-01-01T00:00:00"?"":window.parent.moment(n.ReadTimeStamp).format("DD-MM-YYYY")},{dataField:"AnswerTimeStamp",caption:lu,dataType:"date",width:"auto",calculateCellValue:n=>n.AnswerTimeStamp==="1970-01-01T00:00:00"?"":window.parent.moment(n.AnswerTimeStamp).format("DD-MM-YYYY")},],"export":{enabled:!0,fileName:`${n.communiques[n.selectedCommunique].Subject}_CommuniqueResults`,texts:{exportAll:ot,exportTo:ot},allowExportSelectedData:!1},groupPanel:{visible:!0,allowColumnDragging:!0,emptyPanelText:au},paging:{pageSize:10},onExporting:df})};const g=async(i,r)=>{const wt=await kt(),ct=[...document.querySelectorAll(".commSaveBtn")],lt=[...document.querySelectorAll(".commDiscartBtn")],k=document.querySelector("#commSendBtn"),g=document.querySelector("#commRemoveBtn"),tt=document.querySelector("#commCreateBtn"),it=document.querySelector("#commArchiveBtn"),rt=document.querySelector("#commUnarchiveBtn"),ut=document.querySelector("#commShrinkBtn"),ft=document.querySelector("#commExpandBtn"),et=document.querySelector("#commCancelBtn"),ot=document.querySelector("#commUncancelBtn"),st=document.querySelector("#filterActiveCommBtn"),ht=document.querySelector("#filterArchiveCommBtn"),yt=ct.map(n=>n.cloneNode(!0)),pt=lt.map(n=>n.cloneNode(!0)),f=k.cloneNode(!0),u=g.cloneNode(!0),a=tt.cloneNode(!0),e=it.cloneNode(!0),h=rt.cloneNode(!0),v=ut.cloneNode(!0),y=ft.cloneNode(!0),l=et.cloneNode(!0),p=ot.cloneNode(!0),w=st.cloneNode(!0),b=ht.cloneNode(!0);ct.map(n=>yt.map(t=>n.parentNode.replaceChild(t,n)));lt.map(n=>pt.map(t=>n.parentNode.replaceChild(t,n)));k.parentNode.replaceChild(f,k);g.parentNode.replaceChild(u,g);tt.parentNode.replaceChild(a,tt);it.parentNode.replaceChild(e,it);rt.parentNode.replaceChild(h,rt);ut.parentNode.replaceChild(v,ut);ft.parentNode.replaceChild(y,ft);et.parentNode.replaceChild(l,et);ot.parentNode.replaceChild(p,ot);st.parentNode.replaceChild(w,st);ht.parentNode.replaceChild(b,ht);wt<=3?(f.style.display="none",l.style.display="none",e.style.display="none",h.style.display="none",u.style.display="none",a.style.display="none"):(typeof r!="undefined"?r.Status===0?(r.Id!=-1&&r.Id!=0&&(f.style.display=""),l.style.display="none",e.style.display="none",h.style.display="none",r.Id!=-1&&r.Id!=0&&(u.style.display=""),u.addEventListener("click",()=>ef(r),!1),yt.map(n=>n.addEventListener("click",async()=>{if(r.Subject.length<1){DevExpress.ui.dialog.alert(vu,c);return}const n=await o(r);if(!n)DevExpress.ui.dialog.alert(yu,c);else{const n=r.Id>-1?r.Id:null;s(n)}},!1)),pt.map(n=>n.addEventListener("click",async()=>{const n=document.querySelector(".communiqueCardClicked");if(n){const i=await DevExpress.ui.dialog.confirm(nt,pu);i&&(t(!1),n.click())}else{const i=[...document.querySelectorAll(".communiqueCard"),],n=i.find(n=>n.style.display!=="none");n?(t(!1),n.click()):d()}},!1)),f.addEventListener("click",()=>rf(r),!1)):r.Status===1?(f.style.display="none",l.style.display="",p.style.display="none",u.style.display="none",l.addEventListener("click",()=>uf(r),!1),r.Archived?(e.style.display="none",h.style.display="",u.style.display="none",h.addEventListener("click",async()=>{r.Archived=!1;const n=await o(r);n?(s(),t(!1)):DevExpress.ui.dialog.alert(du,ku)},!1)):(e.style.display="",h.style.display="none",e.addEventListener("click",async()=>{r.Archived=!0;const n=await o(r);n?(s(),t(!1)):DevExpress.ui.dialog.alert(bu,wu)},!1))):r.Status===3&&(f.style.display="none",l.style.display="none",p.style.display="",e.style.display="none",h.style.display="none",u.style.display="none",p.addEventListener("click",()=>ff(r),!1)):(u.style.display="none",f.style.display="none"),(typeof r=="undefined"||r.Id!==-1&&Object.entries(n.communiques).filter(n=>n[1].Subject===""&&n[1].Id!==0).length===0)&&(a.style.display="",a.addEventListener("click",d,!1)));v.addEventListener("click",()=>{at(v,y,!0)},!1);y.addEventListener("click",()=>{at(v,y,!1)},!1);w.addEventListener("click",()=>{w.classList.add("activeTab"),b.classList.remove("activeTab"),vt("active")},!1);b.addEventListener("click",()=>{w.classList.remove("activeTab"),b.classList.add("activeTab"),vt("archived")},!1)}})();var cursorIndex,cursorLength=0,currentFormat;