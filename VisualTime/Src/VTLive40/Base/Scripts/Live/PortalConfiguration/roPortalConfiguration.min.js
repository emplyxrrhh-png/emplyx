function onPortalChanges(){loading||(hasPortalChanges=!0)}function onTimegateChanges(){loading||(hasTimegateChanges=!0)}function onTimegateIDChange(n){loading||(hasTimegateChanges=!0);$("#timegateUserFieldId").dxSelectBox("instance").option("disabled",!n.value)}function onLimitDRDays(n){loading||(hasPortalChanges=!0);let i=n.value,t=$("#drLimitDays").dxNumberBox("instance");t.option("value",i?t.option("value"):null);t.option("disabled",!i);i&&t.focus()}function drLimitDaysValueChanged(){loading||(hasPortalChanges=!0)}function changePosition(n){position=n.value;loading||(hasPortalChanges=!0);fileContent!=null&&setImagePreview(fileContent,n.value)}function changeTGPosition(n){position=n.value;loading||(hasTimegateChanges=!0);fileContentTG!=null&&setTGImagePreview(fileContentTG,n.value)}function changeOpacity(n){opacity=n.value;fileContent!=null&&setImagePreview(fileContent,position)}function changeTimeGateOpacity(n){opacity=n.value;fileContentTG!=null&&setTGImagePreview(fileContentTG,position)}function setImagePreview(n,t){loading||(hasPortalChanges=!0);t=3;var r=document.getElementById("backgroundPhoto"),u=opacity/10,i="";if(n==null||n==""||(i=fileContent),t==null)r.setAttribute("style","background: url("+i+") no-repeat center; background-size: contain !important;height:100%;opacity:"+u+"");else switch(t){case 4:r.setAttribute("style","background: url("+i+") no-repeat center; background-size: cover !important;height:100%;opacity:"+u+"");break;case 3:r.setAttribute("style","background: url("+i+") no-repeat right; background-size: contain !important;height:100%;opacity:"+u+"");break;case 2:r.setAttribute("style","background: url("+i+") no-repeat center; background-size: contain !important;height:100%;opacity:"+u+"");break;case 1:r.setAttribute("style","background: url("+i+") no-repeat left; background-size: contain !important;height:100%;opacity:"+u+"");break;default:r.setAttribute("style","background: url("+i+") no-repeat center; background-size: contain !important;height:100%;opacity:"+u+"")}}function setTGImagePreview(n,t){loading||(hasTimegateChanges=!0);t=3;var r=document.getElementById("backgroundTGPhoto"),u=opacity/10,i="";n==null||n==""||(i=fileContentTG);r.setAttribute("style","background: url("+i+") no-repeat top left; background-size: cover !important;height:100%;opacity:"+u+"")}function setColorPreview(n,t){(n==null||n=="")&&(colorLeft="#FF5C35");(t==null||t=="")&&(colorRight="#f8aa32");let i=document.getElementById("previewDiv");i.setAttribute("style",'background: url("Base/Images/bgHeaderPortal.png"), linear-gradient(to right, '+colorLeft+", "+colorRight+");border-radius:5px;height:100px;")}function setTGColorPreview(n,t){(n==null||n=="")&&(colorLeft="#FF5C35");(t==null||t=="")&&(colorRight="#f8aa32");let i=document.getElementById("previewTGDiv");i.setAttribute("style",'background: url("Base/Images/bgTimeGate.png"), linear-gradient(to right, '+colorLeft+", "+colorRight+");border-radius:5px;height:100px;")}function onColorChangedLeft(n){if(n.value!=""){loading||(hasPortalChanges=!0);colorLeft=n.value;let t=document.getElementById("previewDiv");t.setAttribute("style",'background: url("Base/Images/bgHeaderPortal.png"), linear-gradient(to right, '+colorLeft+", "+colorRight+");border-radius:5px;height:100px;")}}function onTGColorChangedLeft(n){if(n.value!=""){loading||(hasTimegateChanges=!0);colorLeft=n.value;let t=document.getElementById("previewTGDiv");t.setAttribute("style",'background: url("Base/Images/bgTimeGate.png"), linear-gradient(to right, '+colorLeft+", "+colorRight+");border-radius:5px;height:100px;")}}function onColorChangedRight(n){if(n.value!=""){loading||(hasPortalChanges=!0);colorRight=n.value;let t=document.getElementById("previewDiv");t.setAttribute("style",'background: url("Base/Images/bgHeaderPortal.png"), linear-gradient(to right, '+colorLeft+", "+colorRight+");border-radius:5px;height:100px;")}}function onTGColorChangedRight(n){if(n.value!=""){loading||(hasTimegateChanges=!0);colorRight=n.value;let t=document.getElementById("previewTGDiv");t.setAttribute("style",'background: url("Base/Images/bgTimeGate.png"), linear-gradient(to right, '+colorLeft+", "+colorRight+");border-radius:5px;height:100px;")}}async function saveApplicationChanges(){let n=!0,t=validateData();t==""?(hasTimegateChanges&&(n=await saveTimegateChanges()),n&&hasPortalChanges&&await savePortalConfiguration()):DevExpress.ui.notify(t,"error",2e3)}function validateData(){if(hasTimegateChanges){let n=$("#chkTimegateUsesUserField").dxSwitch("instance").option("value"),t=$("#timegateUserFieldId").dxSelectBox("instance").option("value");if(t==null&&n)return viewUtilsManager.DXTranslate("roTimegateMissingConfiguration")}if(hasPortalChanges&&document.getElementById("isDailyRecordEnabled").value=="1"){let n=$("#chkLimitDRDays").dxSwitch("instance").option("value"),t=$("#drLimitDays").dxNumberBox("instance").option("value");if(t==null&&n)return $("#drLimitDays").dxNumberBox("instance").focus(),viewUtilsManager.DXTranslate("roDRMaxDaysNotInformed")}return""}async function saveTimegateChanges(){let n=!1,i=$("#chkTimegateUsesUserField").dxSwitch("instance").option("value"),r=$("#timegateUserFieldId").dxSelectBox("instance").option("value"),u=$("#timegateUserFieldId").dxSelectBox("instance").option("text"),f=fileContentTG,e=$("#selectTGLeftColor").dxColorBox("instance").option("value"),o=$("#selectTGRightColor").dxColorBox("instance").option("value"),s=$("#selectPositionTimeGateBackground").dxSelectBox("instance").option("value"),h=$("#selectOpacityTimegateBackground").dxSlider("instance").option("value"),c={customUserFieldEnabled:i,userFieldId:r,userFieldName:u,image:f,position:s,opacity:h,leftColor:e,rightColor:o};loading=!0;let t=await fetch(BASE_URL+"PortalConfiguration/SaveTimegateConfiguration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});return t.ok?(n=await t.json(),typeof n=="string"?DevExpress.ui.notify(n,"error",5e3):n?(DevExpress.ui.notify(viewUtilsManager.DXTranslate("roPortalConfigurationSaved"),"success",2e3),hasTimegateChanges=!1):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roPortalConfigurationSaveError"),"error",2e3)):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roPortalConfigurationSaveError"),"error",2e3),loading=!1,n}async function savePortalConfiguration(){let n=!1,u=fileContent,f=$("#selectLeftColor").dxColorBox("instance").option("value"),e=$("#selectRightColor").dxColorBox("instance").option("value"),o=$("#selectPositionPortalConfiguration").dxSelectBox("instance").option("value"),s=$("#selectOpacityPortalConfiguration").dxSlider("instance").option("value"),h=$("#chkImpersonate").dxSwitch("instance").option("value"),c=$("#selectGeolocalization").dxSelectBox("instance").option("value"),l=$("#chkPunchRequireZone").dxSwitch("instance").option("value"),t=-1,i=!1;document.getElementById("isDailyRecordEnabled").value=="1"&&($("#chkLimitDRDays").dxSwitch("instance").option("value")&&$("#drLimitDays").dxNumberBox("instance").option("value")!=null&&(t=$("#drLimitDays").dxNumberBox("instance").option("value")),$("#chkDR")&&(i=$("#chkDR").dxSwitch("instance").option("value")));loading=!0;let r=await fetch(BASE_URL+"PortalConfiguration/SavePortalConfiguration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Image:u,Position:o,Opacity:s,LeftColor:f,RightColor:e,Geolocalization:c,PunchZoneRequired:l,DailyRecordPattern:i,Impersonate:h,DrMaxDaysOnPast:t})});return r.ok?(n=await r.json(),n?(DevExpress.ui.notify(viewUtilsManager.DXTranslate("roPortalConfigurationSaved"),"success",2e3),hasPortalChanges=!1):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roPortalConfigurationSaveError"),"error",2e3)):DevExpress.ui.notify(viewUtilsManager.DXTranslate("roPortalConfigurationSaveError"),"error",2e3),loading=!1,n}function cancelPortalConfiguration(){onPortalConfigurationShown()}function restorePortalConfiguration(){loading=!0;$.ajax({type:"POST",url:BASE_URL+"PortalConfiguration/RestorePortalConfiguration",dataType:"json",success:function(n){n==!1?DevExpress.ui.notify(viewUtilsManager.DXTranslate("roPortalConfigurationSaveError"),"error",2e3):(DevExpress.ui.notify(viewUtilsManager.DXTranslate("roPortalConfigurationSaved"),"success",2e3),onPortalConfigurationShown());loading=!1},error:function(){DevExpress.ui.notify(viewUtilsManager.DXTranslate("roPortalConfigurationSaveError"),"error",2e3);loading=!1}})}async function onPortalConfigurationShown(){loading=!0;let n=!1,t=await fetch(BASE_URL+"PortalConfiguration/GetPortalConfiguration",{method:"GET",headers:{"Content-Type":"application/json"}});if(t.ok){let n=await t.json();currentView=n;n!=null&&n.HeaderConfiguration!=null?(fileContent=n.HeaderConfiguration.Image,fileContent!=null&&fileContent!=""?($("#dropzone-text")[0].style.display="none",$("#dropzone-image")[0].src=fileContent,$("#btnDeleteImage")[0].style.display=""):($("#dropzone-text")[0].style.display="",$("#dropzone-image")[0].src="",$("#btnDeleteImage")[0].style.display="none"),$("#selectLeftColor").dxColorBox("instance").option("value",n.HeaderConfiguration.LeftColor),$("#selectRightColor").dxColorBox("instance").option("value",n.HeaderConfiguration.RightColor),$("#selectPositionPortalConfiguration").dxSelectBox("instance").option("value",n.HeaderConfiguration.Position),$("#chkImpersonate").dxSwitch("instance").option("value",n.GeneralConfiguration.Impersonate),$("#selectGeolocalization").dxSelectBox("instance").option("value",n.GeolocalizationConfiguration.Geolocalization),$("#chkPunchRequireZone").dxSwitch("instance").option("value",n.PunchOptions.ZoneRequired),$("#chkDR")&&document.getElementById("isDailyRecordEnabled").value=="1"&&$("#chkDR").dxSwitch("instance").option("value",n.DailyRecordPattern),document.getElementById("isDailyRecordEnabled").value=="1"&&(n.DailyRecordMaxDaysOnPast>-1?($("#chkLimitDRDays").dxSwitch("instance").option("value",!0),$("#drLimitDays").dxNumberBox("instance").option("value",n.DailyRecordMaxDaysOnPast)):($("#chkLimitDRDays").dxSwitch("instance").option("value",!1),$("#drLimitDays").dxNumberBox("instance").option("value",null),$("#drLimitDays").dxNumberBox("instance").option("disabled",!0))),$("#selectOpacityPortalConfiguration").dxSlider("instance").option("value",n.HeaderConfiguration.Opacity),opacity=parseInt(n.HeaderConfiguration.Opacity),position=parseInt(n.HeaderConfiguration.Position),setColorPreview(n.HeaderConfiguration.LeftColor,n.HeaderConfiguration.RightColor)):(n==null||n.HeaderConfiguration==null)&&(colorLeft="#0046fe",colorRight="#57aeeb",fileContent="",$("#dropzone-text")[0].style.display="",$("#dropzone-image")[0].src="",$("#btnDeleteImage")[0].style.display="none",$("#selectLeftColor").dxColorBox("instance").option("value",colorLeft),$("#selectRightColor").dxColorBox("instance").option("value",colorRight),$("#selectPositionPortalConfiguration").dxSelectBox("instance").option("value",1),$("#chkDR")&&document.getElementById("isDailyRecordEnabled").value=="1"&&$("#chkDR").dxSwitch("instance").option("value",!1),opacity=10,position=1,$("#selectOpacityPortalConfiguration").dxSlider("instance").option("value","10"),setImagePreview(fileContent,position),setColorPreview(colorLeft,colorRight),n.GeolocalizationConfiguration==null?($("#selectGeolocalization").dxSelectBox("instance").option("value",1),$("#chkPunchRequireZone").dxSwitch("instance").option("value",!1)):($("#selectGeolocalization").dxSelectBox("instance").option("value",n.GeolocalizationConfiguration.Geolocalization),$("#chkPunchRequireZone").dxSwitch("instance").option("value",n.PunchOptions.ZoneRequired)));n!=null&&n.GeneralConfiguration!=null?$("#chkImpersonate").dxSwitch("instance").option("value",n.GeneralConfiguration.Impersonate):$("#chkImpersonate").dxSwitch("instance").option("value",!0)}else n=!0;if(!n){let t=await fetch(BASE_URL+"PortalConfiguration/GetTimegateConfiguration",{method:"GET",headers:{"Content-Type":"application/json"}});if(t.ok){let n=await t.json();$("#chkTimegateUsesUserField").dxSwitch("instance").option("value",n.CustomUserFieldEnabled);$("#timegateUserFieldId").dxSelectBox("instance").option("value",n.CustomUserFieldEnabled?""+n.UserFieldId:null);n!=null&&n.BackgroundConfiguration!=null?(fileContentTG=n.BackgroundConfiguration.Image,fileContentTG!=null&&fileContentTG!=""?($("#dropzonetg-text")[0].style.display="none",$("#dropzonetg-image")[0].src=fileContentTG,$("#btnDeleteTGImage")[0].style.display=""):($("#dropzonetg-text")[0].style.display="",$("#dropzonetg-image")[0].src="",$("#btnDeleteTGImage")[0].style.display="none"),$("#selectTGLeftColor").dxColorBox("instance").option("value",n.BackgroundConfiguration.LeftColor),$("#selectTGRightColor").dxColorBox("instance").option("value",n.BackgroundConfiguration.RightColor),$("#selectPositionTimeGateBackground").dxSelectBox("instance").option("value",n.BackgroundConfiguration.Position),$("#selectOpacityTimegateBackground").dxSlider("instance").option("value",n.BackgroundConfiguration.Opacity),opacity=parseInt(n.BackgroundConfiguration.Opacity),position=parseInt(n.BackgroundConfiguration.Position),setTGImagePreview(fileContentTG,position),setTGColorPreview(n.BackgroundConfiguration.LeftColor,n.BackgroundConfiguration.RightColor)):(n==null||n.BackgroundConfiguration==null)&&(colorLeft="#0046fe",colorRight="#57aeeb",fileContent="",$("#dropzonetg-text")[0].style.display="",$("#dropzonetg-image")[0].src="",$("#btnDeleteTGImage")[0].style.display="none",$("#selectTGLeftColor").dxColorBox("instance").option("value",colorLeft),$("#selectTGRightColor").dxColorBox("instance").option("value",colorRight),$("#selectPositionTimeGateBackground").dxSelectBox("instance").option("value",1),opacity=10,position=1,$("#selectOpacityTimegateBackground").dxSlider("instance").option("value","10"),setTGImagePreview(fileContentTG,position),setTGColorPreview(colorLeft,colorRight))}else n=!0}n;loading=!1}function getProgressBarInstance(){return $("#upload-progress").dxProgressBar("instance")}function getProgressBarTGInstance(){return $("#uploadtg-progress").dxProgressBar("instance")}function fileUploader_dropZoneEnter(n){n.dropZoneElement.id==="dropzone-external"&&toggleDropZoneActive(n.dropZoneElement,!0)}function fileUploaderTG_dropZoneEnter(n){n.dropZoneElement.id==="dropzonetg-external"&&toggleDropZoneTGActive(n.dropZoneElement,!0)}function fileUploader_dropZoneLeave(n){n.dropZoneElement.id==="dropzone-external"&&toggleDropZoneActive(n.dropZoneElement,!1)}function fileUploaderTG_dropZoneLeave(n){n.dropZoneElement.id==="dropzonetg-external"&&toggleDropZoneTGActive(n.dropZoneElement,!1)}function fileUploader_uploaded(n){loading||(hasPortalChanges=!0);const i=n.file,t=new FileReader;t.onload=function(){toggleDropZoneActive($("#dropzone-external")[0],!1);$("#dropzone-image")[0].src=t.result;fileContent=t.result;setImagePreview(fileContent,position)};t.readAsDataURL(i);$("#dropzone-text")[0].style.display="none";$("#btnDeleteImage")[0].style.display="";getProgressBarInstance().option({visible:!1,value:0})}function fileUploaderTG_uploaded(n){loading||(hasTimegateChanges=!0);const i=n.file,t=new FileReader;t.onload=function(){toggleDropZoneTGActive($("#dropzonetg-external")[0],!1);$("#dropzonetg-image")[0].src=t.result;fileContentTG=t.result;setTGImagePreview(fileContentTG,position)};t.readAsDataURL(i);$("#dropzonetg-text")[0].style.display="none";$("#btnDeleteTGImage")[0].style.display="";getProgressBarTGInstance().option({visible:!1,value:0})}function fileUploader_progress(n){getProgressBarInstance().option("value",n.bytesLoaded/n.bytesTotal*100)}function fileUploaderTG_progress(n){getProgressBarTGInstance().option("value",n.bytesLoaded/n.bytesTotal*100)}function fileUploader_uploadStarted(){toggleImageVisible(!1);getProgressBarInstance().option("visible",!0)}function fileUploaderTG_uploadStarted(){toggleTGImageVisible(!1);getProgressBarTGInstance().option("visible",!0)}function toggleDropZoneActive(n,t){loading||(hasPortalChanges=!0);t?(n.classList.add("dx-theme-accent-as-border-color"),n.classList.remove("dx-theme-border-color"),n.classList.add("dropzone-active")):(n.classList.remove("dx-theme-accent-as-border-color"),n.classList.add("dx-theme-border-color"),n.classList.remove("dropzone-active"))}function toggleDropZoneTGActive(n,t){loading||(hasTimegateChanges=!0);t?(n.classList.add("dx-theme-accent-as-border-color"),n.classList.remove("dx-theme-border-color"),n.classList.add("dropzone-active")):(n.classList.remove("dx-theme-accent-as-border-color"),n.classList.add("dx-theme-border-color"),n.classList.remove("dropzone-active"))}function toggleImageVisible(n){$("#dropzone-image")[0].hidden=!n}function toggleTGImageVisible(n){$("#dropzonetg-image")[0].hidden=!n}function fileUploaderReset(){$("#dropzone-text")[0].style.display="";$("#dropzone-image")[0].src="";$("#btnDeleteImage")[0].style.display="none";fileContent=null;toggleImageVisible(!0);setImagePreview(null,3)}function fileUploaderTGReset(){$("#dropzonetg-text")[0].style.display="";$("#dropzonetg-image")[0].src="";$("#btnDeleteTGImage")[0].style.display="none";fileContentTG=null;toggleTGImageVisible(!0);setTGImagePreview(null,3)}var currentView=null,currentTgView=null,fileContent=null,fileContentTG=null,colorLeft="#FF5C35",colorRight="#f8aa32",opacity=10,position=2;let hasTimegateChanges=!1,hasPortalChanges=!1,loading=!1;$(document).ready(function(){onPortalConfigurationShown();$("#portalGeneralConfiguration").off("click");$("#portalGeneralConfiguration").on("click",function(){$(".generalConfigurationDiv").show();$(".timegateConfDiv").hide();$(".geolocalizationConfigurationDiv").hide();$(".drConfigurationDiv").hide();$("#portalGeneralConfiguration").addClass("bTabPortalConfigurationMenu-active");$("#timegateConfiguration").removeClass("bTabPortalConfigurationMenu-active");$("#portalDRConfiguration").removeClass("bTabPortalConfigurationMenu-active");$("#portalGeolocalizationConfiguration").removeClass("bTabPortalConfigurationMenu-active")});$("#timegateConfiguration").off("click");$("#timegateConfiguration").on("click",function(){$(".generalConfigurationDiv").hide();$(".timegateConfDiv").show();$(".geolocalizationConfigurationDiv").hide();$(".drConfigurationDiv").hide();$("#portalGeneralConfiguration").removeClass("bTabPortalConfigurationMenu-active");$("#timegateConfiguration").addClass("bTabPortalConfigurationMenu-active");$("#portalDRConfiguration").removeClass("bTabPortalConfigurationMenu-active");$("#portalGeolocalizationConfiguration").removeClass("bTabPortalConfigurationMenu-active")});$("#portalGeolocalizationConfiguration").off("click");$("#portalGeolocalizationConfiguration").on("click",function(){$(".generalConfigurationDiv").hide();$(".timegateConfDiv").hide();$(".drConfigurationDiv").hide();$(".geolocalizationConfigurationDiv").show();$("#portalGeneralConfiguration").removeClass("bTabPortalConfigurationMenu-active");$("#timegateConfiguration").removeClass("bTabPortalConfigurationMenu-active");$("#portalDRConfiguration").removeClass("bTabPortalConfigurationMenu-active");$("#portalGeolocalizationConfiguration").addClass("bTabPortalConfigurationMenu-active")});$("#portalDRConfiguration").off("click");$("#portalDRConfiguration").on("click",function(){$(".drConfigurationDiv").show();$(".timegateConfDiv").hide();$(".geolocalizationConfigurationDiv").hide();$(".generalConfigurationDiv").hide();$("#portalDRConfiguration").addClass("bTabPortalConfigurationMenu-active");$("#timegateConfiguration").removeClass("bTabPortalConfigurationMenu-active");$("#portalGeolocalizationConfiguration").removeClass("bTabPortalConfigurationMenu-active");$("#portalGeneralConfiguration").removeClass("bTabPortalConfigurationMenu-active")});setTimeout(function(){$("#timegateUserFieldId").dxSelectBox("instance").option("disabled",!$("#chkTimegateUsesUserField").dxSwitch("instance").option("value"))},200)});