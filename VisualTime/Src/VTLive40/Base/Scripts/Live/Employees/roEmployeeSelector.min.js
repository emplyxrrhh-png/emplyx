async function initUniversalSelector(n,t,i){swapMode=!0;syncSelectorWithServer=t;universalSelectorName=i;typeof selectAllEnabled!="undefined"&&(selectMode=selectAllEnabled?"all":"onlyCustom");typeof selectNoneEnabled!="undefined"&&(allowNone=selectNoneEnabled);selectorView=await initSelectorView(n);$("#desinationPopupAdvanced").dxPopup("instance").hide();$("#desinationPopup").dxPopup("instance").show();swapMode=!1}async function initSelectorView(n){let t=null;return typeof n!="undefined"?typeof n=="object"?(t=n,t=fillComponentsData(t)):t=generateDefaultFilter(n):typeof currentView!="undefined"?(t=await syncDefaultFilter(currentView),t=fillComponentsData(t)):t=generateDefaultFilter(selectMode=="all"?"All":"Custom"),typeof t.ComposeMode=="undefined"&&(t.ComposeMode=selectMode=="all"?"All":"Custom"),typeof t.Operation=="undefined"&&(t.Operation="or"),t}async function syncDefaultFilter(n){let t=n;if(typeof t.ByPassCache=="undefined"&&(t.ByPassCache=!1),syncSelectorWithServer)if(n.ByPassCache)typeof t.ByPassCache!="undefined"&&delete t.ByPassCache,await sendFilterToServer(t);else{let n=await loadSelectorViewFromServer(serverURL,universalSelectorName,pageName);n!=null&&(t=n)}return typeof t.ByPassCache!="undefined"&&delete t.ByPassCache,t}async function sendFilterToServer(n){typeof n.Employees!="undefined"&&delete n.Employees;typeof n.Groups!="undefined"&&delete n.Groups;typeof n.Collectives!="undefined"&&delete n.Collectives;typeof n.LabAgrees!="undefined"&&delete n.LabAgrees;let t=await fetch(serverURL+"/SetUniversalSelector",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sSelectorName:universalSelectorName,sSelectorValue:JSON.stringify(n)})});if(!t.ok)throw new Error("Error en la solicitud POST");return await t.json()}function plainSelectorEmployeeShown(){let n=document.getElementById("simpleUniversalSelector");if(n){let t=n.parentElement,i=t?.parentElement;t&&(t.style.height="");i&&(i.style.height="")}selectorView.ComposeFilter!="All"&&selectorView.ComposeFilter!="None"&&selectorSimpleGroupsShown();selectorSimpleEmployeesShown();selectorCollectivesShown();selectorLabagreesShown();selectMode=="onlyCustom"||selectorView.ComposeMode=="Custom"?$(".usCustomFilter").css("display","flex"):$(".usCustomFilter").css("display","none");allowNone?$(".usNoneFilter").show():$(".usNoneFilter").hide();$("#selectOperation").dxSwitch("instance").option("value",operationValue);$("#userFieldsFilter").dxCheckBox("instance").option("value",selectorView.Filter!="11110"&&selectorView.UserFields!="");$(`input[name="rbSelectionMode"][value="${selectorView.ComposeMode}"]`).prop("checked",!0)}function advSelectorEmployeeShown(){}function updateUniversalSelectorMode(n){n.defaultValue=="Custom"&&n.checked?$(".usCustomFilter").css("display","flex"):$(".usCustomFilter").css("display","none");n.checked&&(selectorView.ComposeMode=n.defaultValue)}function selectorSimpleEmployeesShown(){let n=$("#EmployeeText").dxTagBox("instance").getDataSource();n.reload();n.store()._array.length>200?($("#EmployeeText").dxTagBox("instance").option("minSearchLength",3),$("#EmployeeText").dxTagBox("instance").option("openOnFieldClick",!1),jsLabels&&$("#EmployeeText").dxTagBox("instance").option("placeholder",jsLabels["EmployeeSelector#roemployeeplaceholderlarge"])):($("#EmployeeText").dxTagBox("instance").option("minSearchLength",0),$("#EmployeeText").dxTagBox("instance").option("openOnFieldClick",!0),jsLabels&&$("#EmployeeText").dxTagBox("instance").option("placeholder",jsLabels["EmployeeSelector#roemployeeplaceholder"]));typeof selectorView.Employees=="undefined"&&(selectorView.Employees=[]);$("#EmployeeText").dxTagBox("instance").option("value",selectorView.Employees.map(n=>n.IdEmployee));$("#EmployeeText").dxTagBox("instance").repaint()}function selectorSimpleGroupsShown(){let n=$("#GroupText").dxTagBox("instance").getDataSource();n.reload();n.store()._array.length>200?($("#GroupText").dxTagBox("instance").option("minSearchLength",3),$("#GroupText").dxTagBox("instance").option("openOnFieldClick",!1),jsLabels&&$("#GroupText").dxTagBox("instance").option("placeholder",jsLabels["EmployeeSelector#rogroupplaceholderlarge"])):($("#GroupText").dxTagBox("instance").option("minSearchLength",0),$("#GroupText").dxTagBox("instance").option("openOnFieldClick",!0),jsLabels&&$("#GroupText").dxTagBox("instance").option("placeholder",jsLabels["EmployeeSelector#rogroupplaceholder"]));typeof selectorView.Groups=="undefined"&&(selectorView.Groups=[]);$("#GroupText").dxTagBox("instance").option("value",selectorView.Groups.map(n=>n.IdGroup));$("#GroupText").dxTagBox("instance").repaint()}function selectorCollectivesShown(){let n=$("#CollectiveText").dxTagBox("instance").getDataSource();n.reload();n.store()._array.length>200?($("#CollectiveText").dxTagBox("instance").option("minSearchLength",3),$("#CollectiveText").dxTagBox("instance").option("openOnFieldClick",!1),jsLabels&&$("#CollectiveText").dxTagBox("instance").option("placeholder",jsLabels["EmployeeSelector#rocollectiveplaceholderlarge"])):($("#CollectiveText").dxTagBox("instance").option("minSearchLength",0),$("#CollectiveText").dxTagBox("instance").option("openOnFieldClick",!0),jsLabels&&$("#CollectiveText").dxTagBox("instance").option("placeholder",jsLabels["EmployeeSelector#rocollectiveplaceholder"]));typeof selectorView.Collectives=="undefined"&&(selectorView.Collectives=[]);$("#CollectiveText").dxTagBox("instance").option("value",selectorView.Collectives.map(n=>n.FieldValue));$("#CollectiveText").dxTagBox("instance").repaint()}function selectorLabagreesShown(){let n=$("#LabagreeText").dxTagBox("instance").getDataSource();n.reload();n.store()._array.length>200?($("#LabagreeText").dxTagBox("instance").option("minSearchLength",3),$("#LabagreeText").dxTagBox("instance").option("openOnFieldClick",!1),jsLabels&&$("#LabagreeText").dxTagBox("instance").option("placeholder",jsLabels["EmployeeSelector#rolabagreeplaceholderlarge"])):($("#LabagreeText").dxTagBox("instance").option("minSearchLength",0),$("#LabagreeText").dxTagBox("instance").option("openOnFieldClick",!0),jsLabels&&$("#LabagreeText").dxTagBox("instance").option("placeholder",jsLabels["EmployeeSelector#rolabagreeplaceholder"]));typeof selectorView.LabAgrees=="undefined"&&(selectorView.LabAgrees=[]);$("#LabagreeText").dxTagBox("instance").option("value",selectorView.LabAgrees.map(n=>n.FieldValue));$("#LabagreeText").dxTagBox("instance").repaint()}function setSelectorDisabled(n){$("#GroupText").dxTagBox("instance").option("disabled",n);$("#EmployeeText").dxTagBox("instance").option("disabled",n);$("#CollectiveText").dxTagBox("instance").option("disabled",n);$("#LabagreeText").dxTagBox("instance").option("disabled",n)}async function showAdvancedSelector(){swapMode=!0;let n="";loadSimpleSelectedItems();selectorView.Groups.length>0&&(n=selectorView.Groups.map(function(n){return"A"+n.IdGroup}).join(","));selectorView.Employees.length>0&&(n!=""&&(n=n+","),n=n+selectorView.Employees.map(function(n){return"B"+n.IdEmployee}).join(","));await getroTreeState("objContainerTreeV3_mvcTreeSelector").then(n=>n.reset());await getroTreeState("objContainerTreeV3_mvcTreeSelectorGrid").then(n=>n.reset());let t=await getroTreeState("objContainerTreeV3_mvcTreeSelector",!0);t.setLocalData("","","",selectorView.Filter,selectorView.UserFields);t=await getroTreeState("objContainerTreeV3_mvcTreeSelectorGrid",!0);t.setLocalData(n,"","",selectorView.Filter,selectorView.UserFields);setTimeout(function(){$("#desinationPopup").dxPopup("instance").hide();$("#desinationPopupAdvanced").dxPopup("instance").show();swapMode=!1},400)}function backToSimpleSelector(){swapMode=!0;saveAdvancedDestination();$("#desinationPopupAdvanced").dxPopup("instance").hide();$("#desinationPopup").dxPopup("instance").show();swapMode=!1}function employeeMVCSelector_groupSelected(){}function employeeMVCSelector_empSelected(){}function employeeMVCSelector_collectiveSelected(){}function employeeMVCSelector_labagreeSelected(){}function employeeMVCSelector_collectParamValues(n,t,i){n==""?(document.getElementById("hdnMVCEmployees").value="",document.getElementById("hdnMVCFilter").value="",document.getElementById("hdnMVCFilterUser").value=""):(document.getElementById("hdnMVCEmployees").value=n,document.getElementById("hdnMVCFilter").value=t,document.getElementById("hdnMVCFilterUser").value=i)}function saveAdvancedDestination(){let n=[],t=[],i=document.getElementById("hdnMVCEmployees").value.split(",");for(let r of i)if(r!==""){let i=parseInt(r.substring(1),10);r.charAt(0)==="A"?n.push({IdGroup:i,Name:""}):t.push({IdEmployee:i,EmployeeName:""})}selectorView.Employees=t;selectorView.Groups=n;selectorView.Filter=document.getElementById("hdnMVCFilter").value;selectorView.UserFields=document.getElementById("hdnMVCFilterUser").value}function loadSimpleSelectedItems(){selectMode=="onlyCustom"||$(`input[name="rbSelectionMode"][value="Custom"]`).prop("checked")?(selectorView.Employees=$("#EmployeeText").dxTagBox("instance").option("selectedItems"),selectorView.Groups=$("#GroupText").dxTagBox("instance").option("selectedItems"),selectorView.Collectives=$("#CollectiveText").dxTagBox("instance").option("selectedItems"),selectorView.LabAgrees=$("#LabagreeText").dxTagBox("instance").option("selectedItems"),selectorView.ComposeFilter="",selectorView.Groups.length>0&&(selectorView.ComposeFilter=selectorView.Groups.map(function(n){return"A"+n.IdGroup}).join(",")),selectorView.Employees.length>0&&(selectorView.ComposeFilter!=""&&(selectorView.ComposeFilter=selectorView.ComposeFilter+","),selectorView.ComposeFilter=selectorView.ComposeFilter+selectorView.Employees.map(function(n){return"B"+n.IdEmployee}).join(",")),selectorView.Collectives.length>0&&(selectorView.ComposeFilter!=""&&(selectorView.ComposeFilter=selectorView.ComposeFilter+","),selectorView.ComposeFilter=selectorView.ComposeFilter+selectorView.Collectives.map(function(n){return"C"+n.FieldValue}).join(",")),selectorView.LabAgrees.length>0&&(selectorView.ComposeFilter!=""&&(selectorView.ComposeFilter=selectorView.ComposeFilter+","),selectorView.ComposeFilter=selectorView.ComposeFilter+selectorView.LabAgrees.map(function(n){return"L"+n.FieldValue}).join(",")),selectorView.ComposeMode="Custom"):(selectorView.Groups=[],selectorView.Employees=[],selectorView.Collectives=[],selectorView.LabAgrees=[],selectorView.ComposeFilter="",selectorView.Filter="11110",selectorView.UserFields="",selectorView.ComposeMode=$(`input[name="rbSelectionMode"][value="All"]`).prop("checked")?"All":"None")}async function saveDestination(){selectorView.Operation=$("#selectOperation").dxSwitch("instance").option("value")?"and":"or";selectorView.Advanced=!1;loadSimpleSelectedItems();$("#desinationPopup").dxPopup("instance").hide();await closeAndApplySelector()}async function cleanFilter(){selectorView.Groups=[];selectorView.Employees=[];selectorView.Collectives=[];selectorView.LabAgrees=[];selectorView.ComposeFilter="";selectorView.Filter="11110";selectorView.UserFields="";selectorView.Advanced=!1;$("#GroupText").dxTagBox("instance").option("value",[]);$("#GroupText").dxTagBox("instance").repaint();$("#EmployeeText").dxTagBox("instance").option("value",[]);$("#EmployeeText").dxTagBox("instance").repaint();$("#CollectiveText").dxTagBox("instance").option("value",[]);$("#CollectiveText").dxTagBox("instance").repaint();$("#LabagreeText").dxTagBox("instance").option("value",[]);$("#LabagreeText").dxTagBox("instance").repaint();$("#selectOperation").dxSwitch("instance").option("value",selectorView.Operation);$("#userFieldsFilter").dxCheckBox("instance").option("value",!1)}async function closeAndApplySelector(){try{let n={Employees:[],Groups:[],Collectives:[],LabAgrees:[],Operation:"or",Filter:"",UserFields:"",ComposeMode:"Custom",ComposeFilter:"",Advanced:!1,Description:""};n.ComposeMode=selectorView.ComposeMode;n.ComposeFilter=selectorView.ComposeFilter;n.Employees=selectorView.Employees.map(function(n){return n.IdEmployee});n.Groups=selectorView.Groups.map(function(n){return n.IdGroup});n.Collectives=selectorView.Collectives.map(function(n){return n.FieldValue});n.LabAgrees=selectorView.LabAgrees.map(function(n){return n.FieldValue});n.Operation=selectorView.Operation;n.Filter=selectorView.Filter;n.UserFields=selectorView.UserFields;n.Description=buildSelectedEmployeesString(selectorView);let t=Date.now();if(localStorage.setItem(pageName,JSON.stringify({view:selectorView,timestamp:t})),syncSelectorWithServer&&await sendFilterToServer(selectorView),partialMode)try{parentCloseAndApplySelector(n)}catch(i){}else await window.parent.closeAndApplySelector(n)}catch(n){}}function selectorOnHiding(){swapMode||partialMode||window.parent.PopupSelectorEmployeesClient.Hide()}let partialMode=undefined,operationValue=undefined,selectAllEnabled=undefined,selectNoneEnabled=undefined,componentLabels=undefined,pageName=undefined,swapMode=!1,syncSelectorWithServer=!1,universalSelectorName="",selectorView=null,serverURL="/Cookie",selectMode="onlyCustom",allowNone=!1;registerFunction("initUniversalSelector");